import{_ as n,D as a,o as p,c as l,I as o,w as e,R as t,a as c}from"./chunks/framework.zUbWieqp.js";const r="/assets/pat2.gFnakN33.jpg",y="/assets/pat3.2aFBfHk2.jpg",E="/assets/pat1.qKbXQMhZ.png",F="/assets/patroni1.VyYWAO9B.jpg",i="/assets/patroni2.rTnMKCXR.jpg",C="/assets/patroni3.Q5SJ9Koq.jpg",B="/assets/patroni4.lBAPZs0C.jpg",d="/assets/patroni5.KMN6FDX4.jpg",b=JSON.parse('{"title":"一、postgresql高可用方案","description":"","frontmatter":{},"headers":[],"relativePath":"guide/Database/pgSql/cluster/4.patroni.md","filePath":"guide/Database/pgSql/cluster/4.patroni.md","lastUpdated":1703063387000}'),u={name:"guide/Database/pgSql/cluster/4.patroni.md"},g=t(`<h1 id="一、postgresql高可用方案" tabindex="-1">一、postgresql高可用方案 <a class="header-anchor" href="#一、postgresql高可用方案" aria-label="Permalink to &quot;一、postgresql高可用方案&quot;">​</a></h1><p>PostgreSQL 至今都没有特别流行的高可用方案，之前介绍过两种高可用方案，如下:</p><p>Pgpool-II方案</p><p>Keepalived方案</p><p>以上两种方案都能实现基本的 PostgreSQL 高可用，当主库宕机时，备库能正常接管，但存在一些不足</p><p><strong>Pgpool-II方案</strong></p><ul><li>故障切换时并不会判断备库与主库存在的数据差异，这块逻辑需要自定义。</li><li>性能下降明显，根据之前的只读场景测试，大概降幅有20%</li><li>自动化程度不高，例如备库实例挂掉后不会自动拉起，主备切换后，需人工介入将老的主库进行角色转换</li></ul><p><strong>Keepalived方案</strong></p><ul><li>程序移值性不好，不方便部署和安装。</li><li>自动化程度不高，例如备库实例挂掉后不会自动拉起，主备切换后，需人工介入将老的主库进行角色转换</li></ul><p><strong>Patroni + Etcd 方案优点</strong></p><ul><li><strong>健壮性</strong>: 使用分布式key-value数据库作为数据存储，主节点故障时进行主节点重新选举，具有很强的健壮性。</li><li><strong>支持多种复制方式</strong>: 基于内置流复制，支持同步流复制、异步流复制、级联复制。</li><li><strong>支持主备延迟设置</strong>: 可以设置备库延迟主库WAL的字节数，当备库延迟大于指定值时不做故障切换。</li><li><strong>自动化程度高</strong>: 1)支持自动化初始PostgreSQL实例并部署流复制; 2)当备库实例关闭后，支持自动拉起; 3)当主库实例关闭后，首先会尝试自动拉起; 4)支持switchover命令，能自动将老的主库进行角色转换。</li><li><strong>避免脑裂</strong>: 数据库信息记录到 ETCD 中，通过优化部署策略（多机房部署、增加实例数)可以避免脑裂</li></ul><p>patroni+etcd 特点</p><p>• 由etcd来进行选举leader，利用其分布式锁，防止脑裂</p><p>• master 正常down 自动拉起</p><p>• master 异常down 自动切换</p><p>• 可以控制主备lag大小</p><p>• Old master 恢复后自动加入集群</p><p>• 提供rest api</p><p>Patroni 其他特性</p><p>• 修改节点参数</p><p>• 启停节点</p><p>• Switchover/Failover</p><p>• Patroni 的暂停和恢复</p><p>• 对watchdog/haproxy的支持</p><h2 id="集群优势" tabindex="-1">集群优势 <a class="header-anchor" href="#集群优势" aria-label="Permalink to &quot;集群优势&quot;">​</a></h2><p>自动检测主备状态进行切换</p><p>统一模板配置</p><p>利用etcd等DCS系统，有效防止脑裂</p><p>在线添加etcd、patroni节点以及数据节点</p><p>支持同步异步流复制，级联流复制</p><p>可用pg_rewind进行恢复，缩短恢复时间</p><p>异步流复制可设置最小丢失数据量</p><p>haproxy+keeplived可以保持在主备切换或者节点故障后，实</p><p>现ip漂移。对外的ip+端口不变</p><p>官方：</p><p><a href="https://patroni.readthedocs.io/en/latest/SETTINGS.html" target="_blank" rel="noreferrer">https://patroni.readthedocs.io/en/latest/SETTINGS.html</a></p><h1 id="二、patroni-简介" tabindex="-1">二、Patroni 简介 <a class="header-anchor" href="#二、patroni-简介" aria-label="Permalink to &quot;二、Patroni 简介&quot;">​</a></h1><p><a href="https://patroni.readthedocs.io/en/latest/index.html" target="_blank" rel="noreferrer">Patroni</a>基于Python开发的模板，结合DCS(例如 ZooKeeper, etcd, Consul )可以定制PostgreSQL高可用方案。</p><p>Patroni并不是一套拿来即用的PostgreSQL高可用组件，涉及较多的配置和定制工作。</p><p>Patroni接管PostgreSQL数据库的启停，同时监控本地的PostgreSQL数据库，并将本地的PostgreSQL数据库信息写入DCS。</p><p>Patroni的主备端是通过是否能获得 leader key 来控制的，获取到了leader key的Patroni为主节点，其它的为备节点</p><p>patroni 是一款运用 dcs 存储集群来存储信息、主备状态与配置,通过 patroni 来检测并且实 现主备库自动切换的软件。使用一套模板化的配置文件来自动搭建初始化数据库流复制集群 以及配置数据库。</p><p>patroni 高可用集群由 postgresql,patroni,dcs 存储组成</p><p>patroni:通过参数文件来配置自动初始化数据库搭建流复制（配置 pg 参数 文件、创建用户、可以配置预加脚本），指定 etcd 节点等。负责通过一个 api 接口连接到 dcs(分布式存储系统:etcd 集群)，向其</p><p>插入键值记录 patroni 参数、数据库参数、主备信息以及连接信息。平常通过 etcd 对其 它节点做心跳检测。与数据库的主备切换或者做恢复时通过向 etcd 拿取键 值中储存的主备信息来判断各节点的状态进行切换。</p><p>etcd:最少需要三个节点且为奇数来进行 leader 选举（脑裂发生时会 etcd 集群会僵死等待恢复，不会发生都认为自己是主的情况）。在各个节点上同 步健康状态信息以及数据库节点的主备状态与连接、配置信息。平常会对 其余节点做心跳检测</p><h1 id="三、部署规划" tabindex="-1">三、部署规划 <a class="header-anchor" href="#三、部署规划" aria-label="Permalink to &quot;三、部署规划&quot;">​</a></h1><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">操作系统: CentOS Linux 8</span></span>
<span class="line"><span style="color:#e1e4e8;">数据库: PostgreSQL 12.2</span></span>
<span class="line"><span style="color:#e1e4e8;">Python: Python 3.8.2</span></span>
<span class="line"><span style="color:#e1e4e8;">Etcd: etcd-v3.4.7</span></span>
<span class="line"><span style="color:#e1e4e8;">Patroni: patroni 2.1.0</span></span>
<span class="line"><span style="color:#e1e4e8;">本次只用patroni的高可用</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">操作系统: CentOS Linux 8</span></span>
<span class="line"><span style="color:#24292e;">数据库: PostgreSQL 12.2</span></span>
<span class="line"><span style="color:#24292e;">Python: Python 3.8.2</span></span>
<span class="line"><span style="color:#24292e;">Etcd: etcd-v3.4.7</span></span>
<span class="line"><span style="color:#24292e;">Patroni: patroni 2.1.0</span></span>
<span class="line"><span style="color:#24292e;">本次只用patroni的高可用</span></span></code></pre></div><p>etcd保证集群强一致性</p><p>patroni负责postgresql集群管理，包括数据同步、switchover/failover、节点重新初始化</p><p>对外提供服务比较好的两种方案：</p><ol><li><p>callback脚本提供vip，集群只有一个节点对外服务</p></li><li><p>haproxy+pacemaker实现vip和负载均衡功能，主节点可供读写，从节点同时提供只读服务</p></li></ol><p>部署规划如下:</p><table><thead><tr><th style="text-align:center;">主机</th><th style="text-align:center;">IP</th><th style="text-align:center;">组件</th><th style="text-align:center;">备注</th></tr></thead><tbody><tr><td style="text-align:center;">ydtf01</td><td style="text-align:center;">192.168.122.251</td><td style="text-align:center;">PostgreSQL、Patroni、Etcd</td><td style="text-align:center;">主节点</td></tr><tr><td style="text-align:center;">ydtf02</td><td style="text-align:center;">192.168.122.14</td><td style="text-align:center;">PostgreSQL、Patroni、Etcd</td><td style="text-align:center;">备节点1</td></tr><tr><td style="text-align:center;">ydtf03</td><td style="text-align:center;">192.168.122.249</td><td style="text-align:center;">PostgreSQL、Patroni、Etcd</td><td style="text-align:center;">备节点2</td></tr></tbody></table><p>Patroni支持自动化初始化PostgreSQL数据库并部署流复制，这两块工作个人建议还是手工来做比较好</p><p>部署一主两从PostgreSQL流复制，主机ydtf01部署主库，ydtf02、ydtf03部署从库</p><p>关闭ydtf01、ydtf02、ydtf03主机上的防火墙</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">setenforce 0</span></span>
<span class="line"><span style="color:#e1e4e8;">sed -i.bak &quot;s/SELINUX=enforcing/SELINUX=disabled/g&quot; /etc/selinux/config</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">#或者</span></span>
<span class="line"><span style="color:#e1e4e8;">sed -i &#39;s/SELINUX=.*/SELINUX=disabled/g&#39; /etc/selinux/config</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">systemctl disable firewalld.service</span></span>
<span class="line"><span style="color:#e1e4e8;">systemctl stop firewalld.service</span></span>
<span class="line"><span style="color:#e1e4e8;">iptables -F</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">setenforce 0</span></span>
<span class="line"><span style="color:#24292e;">sed -i.bak &quot;s/SELINUX=enforcing/SELINUX=disabled/g&quot; /etc/selinux/config</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">#或者</span></span>
<span class="line"><span style="color:#24292e;">sed -i &#39;s/SELINUX=.*/SELINUX=disabled/g&#39; /etc/selinux/config</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">systemctl disable firewalld.service</span></span>
<span class="line"><span style="color:#24292e;">systemctl stop firewalld.service</span></span>
<span class="line"><span style="color:#24292e;">iptables -F</span></span></code></pre></div><h1 id="四、安装" tabindex="-1">四、安装 <a class="header-anchor" href="#四、安装" aria-label="Permalink to &quot;四、安装&quot;">​</a></h1><p>etcd省略。。。</p><ul><li>python3安装</li></ul><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">#centos7</span></span>
<span class="line"><span style="color:#e1e4e8;"># wget -c https://www.python.org/ftp/python/3.8.2/Python-3.8.2.tar.xz</span></span>
<span class="line"><span style="color:#e1e4e8;"># ./configure</span></span>
<span class="line"><span style="color:#e1e4e8;"># make</span></span>
<span class="line"><span style="color:#e1e4e8;"># make install</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">#创建软链接,如下:</span></span>
<span class="line"><span style="color:#e1e4e8;">rm -f /usr/bin/python</span></span>
<span class="line"><span style="color:#e1e4e8;">ln -s /usr/local/bin/python3 /usr/bin/python</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">python3安装后’yum’命令执行会报错，需要修改以下配置:</span></span>
<span class="line"><span style="color:#e1e4e8;">/usr/bin/yum: 将文件第一行改为/usr/bin/python2.7。(2.7.x也改为2.7)</span></span>
<span class="line"><span style="color:#e1e4e8;">/usr/libexec/urlgrabber-ext-down: 将文件第一行改为/usr/bin/python2.7</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">#centos8 python3 自带</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">#centos7</span></span>
<span class="line"><span style="color:#24292e;"># wget -c https://www.python.org/ftp/python/3.8.2/Python-3.8.2.tar.xz</span></span>
<span class="line"><span style="color:#24292e;"># ./configure</span></span>
<span class="line"><span style="color:#24292e;"># make</span></span>
<span class="line"><span style="color:#24292e;"># make install</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">#创建软链接,如下:</span></span>
<span class="line"><span style="color:#24292e;">rm -f /usr/bin/python</span></span>
<span class="line"><span style="color:#24292e;">ln -s /usr/local/bin/python3 /usr/bin/python</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">python3安装后’yum’命令执行会报错，需要修改以下配置:</span></span>
<span class="line"><span style="color:#24292e;">/usr/bin/yum: 将文件第一行改为/usr/bin/python2.7。(2.7.x也改为2.7)</span></span>
<span class="line"><span style="color:#24292e;">/usr/libexec/urlgrabber-ext-down: 将文件第一行改为/usr/bin/python2.7</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">#centos8 python3 自带</span></span></code></pre></div><h2 id="_4-2-patroni-安装" tabindex="-1">4.2 Patroni 安装 <a class="header-anchor" href="#_4-2-patroni-安装" aria-label="Permalink to &quot;4.2 Patroni 安装&quot;">​</a></h2><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">#每台机器上面都安装</span></span>
<span class="line"><span style="color:#B392F0;">yum</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-y</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">install</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">libffi-devel</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">pip3</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">install</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni[etcd]</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-i</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">https://mirrors.aliyun.com/pypi/simple/</span></span>
<span class="line"><span style="color:#B392F0;">pip3</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">install</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">psycopg2</span></span>
<span class="line"><span style="color:#B392F0;">pip3</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">install</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">psycopg2-binary</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-i</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">https://mirrors.aliyun.com/pypi/simple/</span></span>
<span class="line"><span style="color:#B392F0;">pip3</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">install</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-i</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">https://mirrors.aliyun.com/pypi/simple/</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">设置ptgres拥有免密的sudoer权限</span></span>
<span class="line"><span style="color:#79B8FF;">echo</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;ptgres        ALL=(ALL)       NOPASSWD: ALL&#39;</span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/etc/sudoers.d/postgres</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">#每台机器上面都安装</span></span>
<span class="line"><span style="color:#6F42C1;">yum</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-y</span><span style="color:#24292E;"> </span><span style="color:#032F62;">install</span><span style="color:#24292E;"> </span><span style="color:#032F62;">libffi-devel</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">pip3</span><span style="color:#24292E;"> </span><span style="color:#032F62;">install</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni[etcd]</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-i</span><span style="color:#24292E;"> </span><span style="color:#032F62;">https://mirrors.aliyun.com/pypi/simple/</span></span>
<span class="line"><span style="color:#6F42C1;">pip3</span><span style="color:#24292E;"> </span><span style="color:#032F62;">install</span><span style="color:#24292E;"> </span><span style="color:#032F62;">psycopg2</span></span>
<span class="line"><span style="color:#6F42C1;">pip3</span><span style="color:#24292E;"> </span><span style="color:#032F62;">install</span><span style="color:#24292E;"> </span><span style="color:#032F62;">psycopg2-binary</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-i</span><span style="color:#24292E;"> </span><span style="color:#032F62;">https://mirrors.aliyun.com/pypi/simple/</span></span>
<span class="line"><span style="color:#6F42C1;">pip3</span><span style="color:#24292E;"> </span><span style="color:#032F62;">install</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-i</span><span style="color:#24292E;"> </span><span style="color:#032F62;">https://mirrors.aliyun.com/pypi/simple/</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">设置ptgres拥有免密的sudoer权限</span></span>
<span class="line"><span style="color:#005CC5;">echo</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;ptgres        ALL=(ALL)       NOPASSWD: ALL&#39;</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/etc/sudoers.d/postgres</span></span></code></pre></div><h2 id="_4-3修改配置" tabindex="-1">4.3修改配置 <a class="header-anchor" href="#_4-3修改配置" aria-label="Permalink to &quot;4.3修改配置&quot;">​</a></h2><ul><li>master上</li></ul><p>mkdir /data/patroni_data</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">scope: batman</span></span>
<span class="line"><span style="color:#e1e4e8;">namespace: /service/</span></span>
<span class="line"><span style="color:#e1e4e8;">name: pg12_master</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">restapi:</span></span>
<span class="line"><span style="color:#e1e4e8;">  listen: 0.0.0.0:8008</span></span>
<span class="line"><span style="color:#e1e4e8;">  connect_address: 192.168.122.251:8008</span></span>
<span class="line"><span style="color:#e1e4e8;">etcd3:</span></span>
<span class="line"><span style="color:#e1e4e8;">  hosts: 192.168.122.251:2379,192.168.122.14:2379,192.168.122.249:2379</span></span>
<span class="line"><span style="color:#e1e4e8;">#raft:</span></span>
<span class="line"><span style="color:#e1e4e8;">#  data_dir: .</span></span>
<span class="line"><span style="color:#e1e4e8;">#  self_addr: 127.0.0.1:2222</span></span>
<span class="line"><span style="color:#e1e4e8;">#  partner_addrs:</span></span>
<span class="line"><span style="color:#e1e4e8;">#  - 127.0.0.1:2223</span></span>
<span class="line"><span style="color:#e1e4e8;">#  - 127.0.0.1:2224</span></span>
<span class="line"><span style="color:#e1e4e8;">log:</span></span>
<span class="line"><span style="color:#e1e4e8;">  dir: /etc/patroni</span></span>
<span class="line"><span style="color:#e1e4e8;">  file_size: 50000000</span></span>
<span class="line"><span style="color:#e1e4e8;">  file_num: 10</span></span>
<span class="line"><span style="color:#e1e4e8;">  dateformat: &#39;%Y-%m-%d %H:%M:%S&#39;</span></span>
<span class="line"><span style="color:#e1e4e8;">  loggers:</span></span>
<span class="line"><span style="color:#e1e4e8;">    patroni.postmaster: WARNING</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">bootstrap:</span></span>
<span class="line"><span style="color:#e1e4e8;">  # this section will be written into Etcd:/&lt;namespace&gt;/&lt;scope&gt;/config after initializing new cluster</span></span>
<span class="line"><span style="color:#e1e4e8;">  # and all other cluster members will use it as a \`global configuration\`</span></span>
<span class="line"><span style="color:#e1e4e8;">  dcs:</span></span>
<span class="line"><span style="color:#e1e4e8;">    ttl: 30</span></span>
<span class="line"><span style="color:#e1e4e8;">    loop_wait: 10</span></span>
<span class="line"><span style="color:#e1e4e8;">    retry_timeout: 10</span></span>
<span class="line"><span style="color:#e1e4e8;">    maximum_lag_on_failover: 1048576</span></span>
<span class="line"><span style="color:#e1e4e8;">    master_start_timeout: 300</span></span>
<span class="line"><span style="color:#e1e4e8;">    synchronous_mode: false</span></span>
<span class="line"><span style="color:#e1e4e8;">    #standby_cluster:</span></span>
<span class="line"><span style="color:#e1e4e8;">      #host: 127.0.0.1</span></span>
<span class="line"><span style="color:#e1e4e8;">      #port: 1111</span></span>
<span class="line"><span style="color:#e1e4e8;">      #primary_slot_name: patroni</span></span>
<span class="line"><span style="color:#e1e4e8;">    postgresql:</span></span>
<span class="line"><span style="color:#e1e4e8;">      use_pg_rewind: true</span></span>
<span class="line"><span style="color:#e1e4e8;">#      use_slots: true</span></span>
<span class="line"><span style="color:#e1e4e8;">      parameters:</span></span>
<span class="line"><span style="color:#e1e4e8;">#        wal_level: hot_standby</span></span>
<span class="line"><span style="color:#e1e4e8;">#        hot_standby: &quot;on&quot;</span></span>
<span class="line"><span style="color:#e1e4e8;">#        max_connections: 100</span></span>
<span class="line"><span style="color:#e1e4e8;">#        max_worker_processes: 8</span></span>
<span class="line"><span style="color:#e1e4e8;">#        wal_keep_segments: 8</span></span>
<span class="line"><span style="color:#e1e4e8;">#        max_wal_senders: 10</span></span>
<span class="line"><span style="color:#e1e4e8;">#        max_replication_slots: 10</span></span>
<span class="line"><span style="color:#e1e4e8;">#        max_prepared_transactions: 0</span></span>
<span class="line"><span style="color:#e1e4e8;">#        max_locks_per_transaction: 64</span></span>
<span class="line"><span style="color:#e1e4e8;">#        wal_log_hints: &quot;on&quot;</span></span>
<span class="line"><span style="color:#e1e4e8;">#        track_commit_timestamp: &quot;off&quot;</span></span>
<span class="line"><span style="color:#e1e4e8;">#        archive_mode: &quot;on&quot;</span></span>
<span class="line"><span style="color:#e1e4e8;">#        archive_timeout: 1800s</span></span>
<span class="line"><span style="color:#e1e4e8;">#        archive_command: mkdir -p ../wal_archive &amp;&amp; test ! -f ../wal_archive/%f &amp;&amp; cp %p ../wal_archive/%f</span></span>
<span class="line"><span style="color:#e1e4e8;">#      recovery_conf:</span></span>
<span class="line"><span style="color:#e1e4e8;">#        restore_command: cp ../wal_archive/%f %p</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">  # some desired options for &#39;initdb&#39;</span></span>
<span class="line"><span style="color:#e1e4e8;">  initdb:  # Note: It needs to be a list (some options need values, others are switches)</span></span>
<span class="line"><span style="color:#e1e4e8;">  - encoding: UTF8</span></span>
<span class="line"><span style="color:#e1e4e8;">  - data-checksums</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">  pg_hba:  # Add following lines to pg_hba.conf after running &#39;initdb&#39;</span></span>
<span class="line"><span style="color:#e1e4e8;">  # For kerberos gss based connectivity (discard @.*$)</span></span>
<span class="line"><span style="color:#e1e4e8;">  #- host replication replicator 127.0.0.1/32 gss include_realm=0</span></span>
<span class="line"><span style="color:#e1e4e8;">  #- host all all 0.0.0.0/0 gss include_realm=0</span></span>
<span class="line"><span style="color:#e1e4e8;">  - host replication replicator 127.0.0.1/32 md5</span></span>
<span class="line"><span style="color:#e1e4e8;">  - host all all 0.0.0.0/0 md5</span></span>
<span class="line"><span style="color:#e1e4e8;">#  - hostssl all all 0.0.0.0/0 md5</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">  # Additional script to be launched after initial cluster creation (will be passed the connection URL as parameter)</span></span>
<span class="line"><span style="color:#e1e4e8;"># post_init: /usr/local/bin/setup_cluster.sh</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">  # Some additional users users which needs to be created after initializing new cluster</span></span>
<span class="line"><span style="color:#e1e4e8;">  users:</span></span>
<span class="line"><span style="color:#e1e4e8;">    admin:</span></span>
<span class="line"><span style="color:#e1e4e8;">      password: admin123</span></span>
<span class="line"><span style="color:#e1e4e8;">      options:</span></span>
<span class="line"><span style="color:#e1e4e8;">        - createrole</span></span>
<span class="line"><span style="color:#e1e4e8;">        - createdb</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">postgresql:</span></span>
<span class="line"><span style="color:#e1e4e8;">  listen: 0.0.0.0:5532</span></span>
<span class="line"><span style="color:#e1e4e8;">  connect_address: 192.168.122.251:5532</span></span>
<span class="line"><span style="color:#e1e4e8;">  data_dir: /data/pgdata/data</span></span>
<span class="line"><span style="color:#e1e4e8;">  bin_dir: /data/apps/pgsql/12/bin</span></span>
<span class="line"><span style="color:#e1e4e8;">#  bin_dir:</span></span>
<span class="line"><span style="color:#e1e4e8;">#  config_dir:</span></span>
<span class="line"><span style="color:#e1e4e8;">#  pgpass: /tmp/pgpass0</span></span>
<span class="line"><span style="color:#e1e4e8;">  authentication:</span></span>
<span class="line"><span style="color:#e1e4e8;">    replication:</span></span>
<span class="line"><span style="color:#e1e4e8;">      username: repuser</span></span>
<span class="line"><span style="color:#e1e4e8;">      password: admin123</span></span>
<span class="line"><span style="color:#e1e4e8;">    superuser:</span></span>
<span class="line"><span style="color:#e1e4e8;">      username: postgres</span></span>
<span class="line"><span style="color:#e1e4e8;">      password: admin123</span></span>
<span class="line"><span style="color:#e1e4e8;">    rewind:  # Has no effect on postgres 10 and lower</span></span>
<span class="line"><span style="color:#e1e4e8;">      username: postgres</span></span>
<span class="line"><span style="color:#e1e4e8;">      password: admin123</span></span>
<span class="line"><span style="color:#e1e4e8;">  # Server side kerberos spn</span></span>
<span class="line"><span style="color:#e1e4e8;">#  krbsrvname: postgres</span></span>
<span class="line"><span style="color:#e1e4e8;">  parameters:</span></span>
<span class="line"><span style="color:#e1e4e8;">    # Fully qualified kerberos ticket file for the running user</span></span>
<span class="line"><span style="color:#e1e4e8;">    # same as KRB5CCNAME used by the GSS</span></span>
<span class="line"><span style="color:#e1e4e8;">#   krb_server_keyfile: /var/spool/keytabs/postgres</span></span>
<span class="line"><span style="color:#e1e4e8;">#    unix_socket_directories: &#39;.&#39;</span></span>
<span class="line"><span style="color:#e1e4e8;">  # Additional fencing script executed after acquiring the leader lock but before promoting the replica</span></span>
<span class="line"><span style="color:#e1e4e8;">  #pre_promote: /path/to/pre_promote.sh</span></span>
<span class="line"><span style="color:#e1e4e8;">  callbacks: # 本次配置没有使用haproxy+keepalived实现VIP切换和负载均衡，因为callbacks方式更快速，对系统资源消耗更小，操作更简单，脚本&gt;后面提供</span></span>
<span class="line"><span style="color:#e1e4e8;">    on_start: /bin/bash /etc/patroni/patroni_callback.sh # patroni服务启动时候的触发的操作</span></span>
<span class="line"><span style="color:#e1e4e8;">    on_stop: /bin/bash /etc/patroni/patroni_callback.sh # patroni服务停止时候触发的操作</span></span>
<span class="line"><span style="color:#e1e4e8;">    on_role_change: /bin/bash /etc/patroni/patroni_callback.sh # patroni服务角色切换时触发的操作</span></span>
<span class="line"><span style="color:#e1e4e8;">#watchdog:</span></span>
<span class="line"><span style="color:#e1e4e8;">#  mode: automatic # Allowed values: off, automatic, required</span></span>
<span class="line"><span style="color:#e1e4e8;">#  device: /dev/watchdog</span></span>
<span class="line"><span style="color:#e1e4e8;">#  safety_margin: 5</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">tags:</span></span>
<span class="line"><span style="color:#e1e4e8;">    nofailover: false</span></span>
<span class="line"><span style="color:#e1e4e8;">    noloadbalance: false</span></span>
<span class="line"><span style="color:#e1e4e8;">    clonefrom: false</span></span>
<span class="line"><span style="color:#e1e4e8;">    nosync: false</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">scope: batman</span></span>
<span class="line"><span style="color:#24292e;">namespace: /service/</span></span>
<span class="line"><span style="color:#24292e;">name: pg12_master</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">restapi:</span></span>
<span class="line"><span style="color:#24292e;">  listen: 0.0.0.0:8008</span></span>
<span class="line"><span style="color:#24292e;">  connect_address: 192.168.122.251:8008</span></span>
<span class="line"><span style="color:#24292e;">etcd3:</span></span>
<span class="line"><span style="color:#24292e;">  hosts: 192.168.122.251:2379,192.168.122.14:2379,192.168.122.249:2379</span></span>
<span class="line"><span style="color:#24292e;">#raft:</span></span>
<span class="line"><span style="color:#24292e;">#  data_dir: .</span></span>
<span class="line"><span style="color:#24292e;">#  self_addr: 127.0.0.1:2222</span></span>
<span class="line"><span style="color:#24292e;">#  partner_addrs:</span></span>
<span class="line"><span style="color:#24292e;">#  - 127.0.0.1:2223</span></span>
<span class="line"><span style="color:#24292e;">#  - 127.0.0.1:2224</span></span>
<span class="line"><span style="color:#24292e;">log:</span></span>
<span class="line"><span style="color:#24292e;">  dir: /etc/patroni</span></span>
<span class="line"><span style="color:#24292e;">  file_size: 50000000</span></span>
<span class="line"><span style="color:#24292e;">  file_num: 10</span></span>
<span class="line"><span style="color:#24292e;">  dateformat: &#39;%Y-%m-%d %H:%M:%S&#39;</span></span>
<span class="line"><span style="color:#24292e;">  loggers:</span></span>
<span class="line"><span style="color:#24292e;">    patroni.postmaster: WARNING</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">bootstrap:</span></span>
<span class="line"><span style="color:#24292e;">  # this section will be written into Etcd:/&lt;namespace&gt;/&lt;scope&gt;/config after initializing new cluster</span></span>
<span class="line"><span style="color:#24292e;">  # and all other cluster members will use it as a \`global configuration\`</span></span>
<span class="line"><span style="color:#24292e;">  dcs:</span></span>
<span class="line"><span style="color:#24292e;">    ttl: 30</span></span>
<span class="line"><span style="color:#24292e;">    loop_wait: 10</span></span>
<span class="line"><span style="color:#24292e;">    retry_timeout: 10</span></span>
<span class="line"><span style="color:#24292e;">    maximum_lag_on_failover: 1048576</span></span>
<span class="line"><span style="color:#24292e;">    master_start_timeout: 300</span></span>
<span class="line"><span style="color:#24292e;">    synchronous_mode: false</span></span>
<span class="line"><span style="color:#24292e;">    #standby_cluster:</span></span>
<span class="line"><span style="color:#24292e;">      #host: 127.0.0.1</span></span>
<span class="line"><span style="color:#24292e;">      #port: 1111</span></span>
<span class="line"><span style="color:#24292e;">      #primary_slot_name: patroni</span></span>
<span class="line"><span style="color:#24292e;">    postgresql:</span></span>
<span class="line"><span style="color:#24292e;">      use_pg_rewind: true</span></span>
<span class="line"><span style="color:#24292e;">#      use_slots: true</span></span>
<span class="line"><span style="color:#24292e;">      parameters:</span></span>
<span class="line"><span style="color:#24292e;">#        wal_level: hot_standby</span></span>
<span class="line"><span style="color:#24292e;">#        hot_standby: &quot;on&quot;</span></span>
<span class="line"><span style="color:#24292e;">#        max_connections: 100</span></span>
<span class="line"><span style="color:#24292e;">#        max_worker_processes: 8</span></span>
<span class="line"><span style="color:#24292e;">#        wal_keep_segments: 8</span></span>
<span class="line"><span style="color:#24292e;">#        max_wal_senders: 10</span></span>
<span class="line"><span style="color:#24292e;">#        max_replication_slots: 10</span></span>
<span class="line"><span style="color:#24292e;">#        max_prepared_transactions: 0</span></span>
<span class="line"><span style="color:#24292e;">#        max_locks_per_transaction: 64</span></span>
<span class="line"><span style="color:#24292e;">#        wal_log_hints: &quot;on&quot;</span></span>
<span class="line"><span style="color:#24292e;">#        track_commit_timestamp: &quot;off&quot;</span></span>
<span class="line"><span style="color:#24292e;">#        archive_mode: &quot;on&quot;</span></span>
<span class="line"><span style="color:#24292e;">#        archive_timeout: 1800s</span></span>
<span class="line"><span style="color:#24292e;">#        archive_command: mkdir -p ../wal_archive &amp;&amp; test ! -f ../wal_archive/%f &amp;&amp; cp %p ../wal_archive/%f</span></span>
<span class="line"><span style="color:#24292e;">#      recovery_conf:</span></span>
<span class="line"><span style="color:#24292e;">#        restore_command: cp ../wal_archive/%f %p</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">  # some desired options for &#39;initdb&#39;</span></span>
<span class="line"><span style="color:#24292e;">  initdb:  # Note: It needs to be a list (some options need values, others are switches)</span></span>
<span class="line"><span style="color:#24292e;">  - encoding: UTF8</span></span>
<span class="line"><span style="color:#24292e;">  - data-checksums</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">  pg_hba:  # Add following lines to pg_hba.conf after running &#39;initdb&#39;</span></span>
<span class="line"><span style="color:#24292e;">  # For kerberos gss based connectivity (discard @.*$)</span></span>
<span class="line"><span style="color:#24292e;">  #- host replication replicator 127.0.0.1/32 gss include_realm=0</span></span>
<span class="line"><span style="color:#24292e;">  #- host all all 0.0.0.0/0 gss include_realm=0</span></span>
<span class="line"><span style="color:#24292e;">  - host replication replicator 127.0.0.1/32 md5</span></span>
<span class="line"><span style="color:#24292e;">  - host all all 0.0.0.0/0 md5</span></span>
<span class="line"><span style="color:#24292e;">#  - hostssl all all 0.0.0.0/0 md5</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">  # Additional script to be launched after initial cluster creation (will be passed the connection URL as parameter)</span></span>
<span class="line"><span style="color:#24292e;"># post_init: /usr/local/bin/setup_cluster.sh</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">  # Some additional users users which needs to be created after initializing new cluster</span></span>
<span class="line"><span style="color:#24292e;">  users:</span></span>
<span class="line"><span style="color:#24292e;">    admin:</span></span>
<span class="line"><span style="color:#24292e;">      password: admin123</span></span>
<span class="line"><span style="color:#24292e;">      options:</span></span>
<span class="line"><span style="color:#24292e;">        - createrole</span></span>
<span class="line"><span style="color:#24292e;">        - createdb</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">postgresql:</span></span>
<span class="line"><span style="color:#24292e;">  listen: 0.0.0.0:5532</span></span>
<span class="line"><span style="color:#24292e;">  connect_address: 192.168.122.251:5532</span></span>
<span class="line"><span style="color:#24292e;">  data_dir: /data/pgdata/data</span></span>
<span class="line"><span style="color:#24292e;">  bin_dir: /data/apps/pgsql/12/bin</span></span>
<span class="line"><span style="color:#24292e;">#  bin_dir:</span></span>
<span class="line"><span style="color:#24292e;">#  config_dir:</span></span>
<span class="line"><span style="color:#24292e;">#  pgpass: /tmp/pgpass0</span></span>
<span class="line"><span style="color:#24292e;">  authentication:</span></span>
<span class="line"><span style="color:#24292e;">    replication:</span></span>
<span class="line"><span style="color:#24292e;">      username: repuser</span></span>
<span class="line"><span style="color:#24292e;">      password: admin123</span></span>
<span class="line"><span style="color:#24292e;">    superuser:</span></span>
<span class="line"><span style="color:#24292e;">      username: postgres</span></span>
<span class="line"><span style="color:#24292e;">      password: admin123</span></span>
<span class="line"><span style="color:#24292e;">    rewind:  # Has no effect on postgres 10 and lower</span></span>
<span class="line"><span style="color:#24292e;">      username: postgres</span></span>
<span class="line"><span style="color:#24292e;">      password: admin123</span></span>
<span class="line"><span style="color:#24292e;">  # Server side kerberos spn</span></span>
<span class="line"><span style="color:#24292e;">#  krbsrvname: postgres</span></span>
<span class="line"><span style="color:#24292e;">  parameters:</span></span>
<span class="line"><span style="color:#24292e;">    # Fully qualified kerberos ticket file for the running user</span></span>
<span class="line"><span style="color:#24292e;">    # same as KRB5CCNAME used by the GSS</span></span>
<span class="line"><span style="color:#24292e;">#   krb_server_keyfile: /var/spool/keytabs/postgres</span></span>
<span class="line"><span style="color:#24292e;">#    unix_socket_directories: &#39;.&#39;</span></span>
<span class="line"><span style="color:#24292e;">  # Additional fencing script executed after acquiring the leader lock but before promoting the replica</span></span>
<span class="line"><span style="color:#24292e;">  #pre_promote: /path/to/pre_promote.sh</span></span>
<span class="line"><span style="color:#24292e;">  callbacks: # 本次配置没有使用haproxy+keepalived实现VIP切换和负载均衡，因为callbacks方式更快速，对系统资源消耗更小，操作更简单，脚本&gt;后面提供</span></span>
<span class="line"><span style="color:#24292e;">    on_start: /bin/bash /etc/patroni/patroni_callback.sh # patroni服务启动时候的触发的操作</span></span>
<span class="line"><span style="color:#24292e;">    on_stop: /bin/bash /etc/patroni/patroni_callback.sh # patroni服务停止时候触发的操作</span></span>
<span class="line"><span style="color:#24292e;">    on_role_change: /bin/bash /etc/patroni/patroni_callback.sh # patroni服务角色切换时触发的操作</span></span>
<span class="line"><span style="color:#24292e;">#watchdog:</span></span>
<span class="line"><span style="color:#24292e;">#  mode: automatic # Allowed values: off, automatic, required</span></span>
<span class="line"><span style="color:#24292e;">#  device: /dev/watchdog</span></span>
<span class="line"><span style="color:#24292e;">#  safety_margin: 5</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">tags:</span></span>
<span class="line"><span style="color:#24292e;">    nofailover: false</span></span>
<span class="line"><span style="color:#24292e;">    noloadbalance: false</span></span>
<span class="line"><span style="color:#24292e;">    clonefrom: false</span></span>
<span class="line"><span style="color:#24292e;">    nosync: false</span></span></code></pre></div><h3 id="启动方式" tabindex="-1">启动方式 <a class="header-anchor" href="#启动方式" aria-label="Permalink to &quot;启动方式&quot;">​</a></h3><h4 id="systemd" tabindex="-1">systemd <a class="header-anchor" href="#systemd" aria-label="Permalink to &quot;systemd&quot;">​</a></h4><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">vi</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/etc/systemd/system/patroni.service</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">[Unit]</span></span>
<span class="line"><span style="color:#E1E4E8;">Description</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">Runners</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">to</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">orchestrate</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">a</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">high-availability</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">PostgreSQL</span></span>
<span class="line"><span style="color:#E1E4E8;">After</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">syslog.target</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">network.target</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">[Service]</span></span>
<span class="line"><span style="color:#E1E4E8;">Type</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">simple</span></span>
<span class="line"><span style="color:#E1E4E8;">User</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">ptgres</span></span>
<span class="line"><span style="color:#E1E4E8;">Group</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">ptgres</span></span>
<span class="line"><span style="color:#E1E4E8;">LimitNOFILE</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">40000</span></span>
<span class="line"><span style="color:#6A737D;">#StandardOutput=syslog</span></span>
<span class="line"><span style="color:#6A737D;">#ExecStartPre=-/usr/bin/sudo /sbin/modprobe softdog</span></span>
<span class="line"><span style="color:#6A737D;">#ExecStartPre=-/usr/bin/sudo /bin/chown ptgres /dev/watchdog</span></span>
<span class="line"><span style="color:#E1E4E8;">ExecStart</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">/usr/local/bin/patroni</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">/data/patroni_data/patroni.yml</span></span>
<span class="line"><span style="color:#E1E4E8;">ExecReload</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">/bin/kill</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">-s</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">HUP</span><span style="color:#E1E4E8;"> $MAINPID</span></span>
<span class="line"><span style="color:#E1E4E8;">KillMode</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">process</span></span>
<span class="line"><span style="color:#E1E4E8;">TimeoutSec</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">30</span></span>
<span class="line"><span style="color:#E1E4E8;">Restart</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">no</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">[Install]</span></span>
<span class="line"><span style="color:#E1E4E8;">WantedBy</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">multi-user.target</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">vi</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/etc/systemd/system/patroni.service</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">[Unit]</span></span>
<span class="line"><span style="color:#24292E;">Description</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">Runners</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">to</span><span style="color:#24292E;"> </span><span style="color:#032F62;">orchestrate</span><span style="color:#24292E;"> </span><span style="color:#032F62;">a</span><span style="color:#24292E;"> </span><span style="color:#032F62;">high-availability</span><span style="color:#24292E;"> </span><span style="color:#032F62;">PostgreSQL</span></span>
<span class="line"><span style="color:#24292E;">After</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">syslog.target</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">network.target</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">[Service]</span></span>
<span class="line"><span style="color:#24292E;">Type</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">simple</span></span>
<span class="line"><span style="color:#24292E;">User</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">ptgres</span></span>
<span class="line"><span style="color:#24292E;">Group</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">ptgres</span></span>
<span class="line"><span style="color:#24292E;">LimitNOFILE</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">40000</span></span>
<span class="line"><span style="color:#6A737D;">#StandardOutput=syslog</span></span>
<span class="line"><span style="color:#6A737D;">#ExecStartPre=-/usr/bin/sudo /sbin/modprobe softdog</span></span>
<span class="line"><span style="color:#6A737D;">#ExecStartPre=-/usr/bin/sudo /bin/chown ptgres /dev/watchdog</span></span>
<span class="line"><span style="color:#24292E;">ExecStart</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">/usr/local/bin/patroni</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">/data/patroni_data/patroni.yml</span></span>
<span class="line"><span style="color:#24292E;">ExecReload</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">/bin/kill</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">-s</span><span style="color:#24292E;"> </span><span style="color:#032F62;">HUP</span><span style="color:#24292E;"> $MAINPID</span></span>
<span class="line"><span style="color:#24292E;">KillMode</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">process</span></span>
<span class="line"><span style="color:#24292E;">TimeoutSec</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">30</span></span>
<span class="line"><span style="color:#24292E;">Restart</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">no</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">[Install]</span></span>
<span class="line"><span style="color:#24292E;">WantedBy</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">multi-user.target</span></span></code></pre></div><p>或者</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">[ptgres@slave patroni_data]$ patroni pg_ydtf03.yml &gt;/data/patroni_data/log/pat.log  2&gt;&amp;1 &amp;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">[ptgres@slave patroni_data]$ patroni pg_ydtf03.yml &gt;/data/patroni_data/log/pat.log  2&gt;&amp;1 &amp;</span></span></code></pre></div><ul><li>slave01</li></ul><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">[ptgres@slave01 patroni_data]$ cat pg_ydtf02.yml </span></span>
<span class="line"><span style="color:#e1e4e8;">scope: pg_ydtf</span></span>
<span class="line"><span style="color:#e1e4e8;">namespace: /service/</span></span>
<span class="line"><span style="color:#e1e4e8;">name: slave01</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">restapi:</span></span>
<span class="line"><span style="color:#e1e4e8;">  listen: 192.168.122.14:8008</span></span>
<span class="line"><span style="color:#e1e4e8;">  connect_address: 192.168.122.14:8008</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">etcdv3:</span></span>
<span class="line"><span style="color:#e1e4e8;">  #Provide host to do the initial discovery of the cluster topology:</span></span>
<span class="line"><span style="color:#e1e4e8;">  host: 192.168.122.14:2379</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">bootstrap:</span></span>
<span class="line"><span style="color:#e1e4e8;">  # this section will be written into Etcd:/&lt;namespace&gt;/&lt;scope&gt;/config after initializing new cluster</span></span>
<span class="line"><span style="color:#e1e4e8;">  # and all other cluster members will use it as a \`global configuration\`</span></span>
<span class="line"><span style="color:#e1e4e8;">  dcs:</span></span>
<span class="line"><span style="color:#e1e4e8;">    ttl: 30</span></span>
<span class="line"><span style="color:#e1e4e8;">    loop_wait: 10</span></span>
<span class="line"><span style="color:#e1e4e8;">    retry_timeout: 10</span></span>
<span class="line"><span style="color:#e1e4e8;">    maximum_lag_on_failover: 1048576</span></span>
<span class="line"><span style="color:#e1e4e8;">    master_start_timeout: 300</span></span>
<span class="line"><span style="color:#e1e4e8;">    synchronous_mode: false</span></span>
<span class="line"><span style="color:#e1e4e8;">    #standby_cluster:</span></span>
<span class="line"><span style="color:#e1e4e8;">      #host: 127.0.0.1</span></span>
<span class="line"><span style="color:#e1e4e8;">      #port: 1111</span></span>
<span class="line"><span style="color:#e1e4e8;">      #primary_slot_name: patroni</span></span>
<span class="line"><span style="color:#e1e4e8;">    postgresql:</span></span>
<span class="line"><span style="color:#e1e4e8;">      use_pg_rewind: true</span></span>
<span class="line"><span style="color:#e1e4e8;">      use_slots: true</span></span>
<span class="line"><span style="color:#e1e4e8;">      parameters:</span></span>
<span class="line"><span style="color:#e1e4e8;">      wal_level: locical</span></span>
<span class="line"><span style="color:#e1e4e8;">      hot_standby: &quot;on&quot;</span></span>
<span class="line"><span style="color:#e1e4e8;">      wal_keep_segments: 128</span></span>
<span class="line"><span style="color:#e1e4e8;">      max_wal_senders: 10</span></span>
<span class="line"><span style="color:#e1e4e8;">      max_replication_slots: 10</span></span>
<span class="line"><span style="color:#e1e4e8;">      wal_log_hints: &quot;on&quot;</span></span>
<span class="line"><span style="color:#e1e4e8;">      archive_mode: &quot;on&quot;</span></span>
<span class="line"><span style="color:#e1e4e8;">     # primary_conninfo: &#39;host=192.168.2.11 port=1921 user=repuser&#39;</span></span>
<span class="line"><span style="color:#e1e4e8;">      hot_standby: on</span></span>
<span class="line"><span style="color:#e1e4e8;">      archive_timeout: 1800s</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">postgresql:</span></span>
<span class="line"><span style="color:#e1e4e8;">  listen: 0.0.0.0:5532</span></span>
<span class="line"><span style="color:#e1e4e8;">  connect_address: 192.168.122.14:5532</span></span>
<span class="line"><span style="color:#e1e4e8;">  data_dir: /data/pgdata/data</span></span>
<span class="line"><span style="color:#e1e4e8;">  bin_dir: /data/apps/pgsql/12/bin</span></span>
<span class="line"><span style="color:#e1e4e8;">  config_dir: /data/pgdata/data</span></span>
<span class="line"><span style="color:#e1e4e8;">  #pgpass: /home/pg12/patroni/.pgpass</span></span>
<span class="line"><span style="color:#e1e4e8;">  authentication:</span></span>
<span class="line"><span style="color:#e1e4e8;">    replication:</span></span>
<span class="line"><span style="color:#e1e4e8;">      username: repuser</span></span>
<span class="line"><span style="color:#e1e4e8;">      password: admin123</span></span>
<span class="line"><span style="color:#e1e4e8;">    superuser:</span></span>
<span class="line"><span style="color:#e1e4e8;">      username: postgres</span></span>
<span class="line"><span style="color:#e1e4e8;">      password: admin123</span></span>
<span class="line"><span style="color:#e1e4e8;">    rewind:  # Has no effect on postgres 10 and lower</span></span>
<span class="line"><span style="color:#e1e4e8;">      username: repuser</span></span>
<span class="line"><span style="color:#e1e4e8;">      password: admin123</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">tags:</span></span>
<span class="line"><span style="color:#e1e4e8;">    nofailover: false</span></span>
<span class="line"><span style="color:#e1e4e8;">    noloadbalance: false</span></span>
<span class="line"><span style="color:#e1e4e8;">    clonefrom: false</span></span>
<span class="line"><span style="color:#e1e4e8;">    nosync: false</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">[ptgres@slave01 patroni_data]$ cat pg_ydtf02.yml </span></span>
<span class="line"><span style="color:#24292e;">scope: pg_ydtf</span></span>
<span class="line"><span style="color:#24292e;">namespace: /service/</span></span>
<span class="line"><span style="color:#24292e;">name: slave01</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">restapi:</span></span>
<span class="line"><span style="color:#24292e;">  listen: 192.168.122.14:8008</span></span>
<span class="line"><span style="color:#24292e;">  connect_address: 192.168.122.14:8008</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">etcdv3:</span></span>
<span class="line"><span style="color:#24292e;">  #Provide host to do the initial discovery of the cluster topology:</span></span>
<span class="line"><span style="color:#24292e;">  host: 192.168.122.14:2379</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">bootstrap:</span></span>
<span class="line"><span style="color:#24292e;">  # this section will be written into Etcd:/&lt;namespace&gt;/&lt;scope&gt;/config after initializing new cluster</span></span>
<span class="line"><span style="color:#24292e;">  # and all other cluster members will use it as a \`global configuration\`</span></span>
<span class="line"><span style="color:#24292e;">  dcs:</span></span>
<span class="line"><span style="color:#24292e;">    ttl: 30</span></span>
<span class="line"><span style="color:#24292e;">    loop_wait: 10</span></span>
<span class="line"><span style="color:#24292e;">    retry_timeout: 10</span></span>
<span class="line"><span style="color:#24292e;">    maximum_lag_on_failover: 1048576</span></span>
<span class="line"><span style="color:#24292e;">    master_start_timeout: 300</span></span>
<span class="line"><span style="color:#24292e;">    synchronous_mode: false</span></span>
<span class="line"><span style="color:#24292e;">    #standby_cluster:</span></span>
<span class="line"><span style="color:#24292e;">      #host: 127.0.0.1</span></span>
<span class="line"><span style="color:#24292e;">      #port: 1111</span></span>
<span class="line"><span style="color:#24292e;">      #primary_slot_name: patroni</span></span>
<span class="line"><span style="color:#24292e;">    postgresql:</span></span>
<span class="line"><span style="color:#24292e;">      use_pg_rewind: true</span></span>
<span class="line"><span style="color:#24292e;">      use_slots: true</span></span>
<span class="line"><span style="color:#24292e;">      parameters:</span></span>
<span class="line"><span style="color:#24292e;">      wal_level: locical</span></span>
<span class="line"><span style="color:#24292e;">      hot_standby: &quot;on&quot;</span></span>
<span class="line"><span style="color:#24292e;">      wal_keep_segments: 128</span></span>
<span class="line"><span style="color:#24292e;">      max_wal_senders: 10</span></span>
<span class="line"><span style="color:#24292e;">      max_replication_slots: 10</span></span>
<span class="line"><span style="color:#24292e;">      wal_log_hints: &quot;on&quot;</span></span>
<span class="line"><span style="color:#24292e;">      archive_mode: &quot;on&quot;</span></span>
<span class="line"><span style="color:#24292e;">     # primary_conninfo: &#39;host=192.168.2.11 port=1921 user=repuser&#39;</span></span>
<span class="line"><span style="color:#24292e;">      hot_standby: on</span></span>
<span class="line"><span style="color:#24292e;">      archive_timeout: 1800s</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">postgresql:</span></span>
<span class="line"><span style="color:#24292e;">  listen: 0.0.0.0:5532</span></span>
<span class="line"><span style="color:#24292e;">  connect_address: 192.168.122.14:5532</span></span>
<span class="line"><span style="color:#24292e;">  data_dir: /data/pgdata/data</span></span>
<span class="line"><span style="color:#24292e;">  bin_dir: /data/apps/pgsql/12/bin</span></span>
<span class="line"><span style="color:#24292e;">  config_dir: /data/pgdata/data</span></span>
<span class="line"><span style="color:#24292e;">  #pgpass: /home/pg12/patroni/.pgpass</span></span>
<span class="line"><span style="color:#24292e;">  authentication:</span></span>
<span class="line"><span style="color:#24292e;">    replication:</span></span>
<span class="line"><span style="color:#24292e;">      username: repuser</span></span>
<span class="line"><span style="color:#24292e;">      password: admin123</span></span>
<span class="line"><span style="color:#24292e;">    superuser:</span></span>
<span class="line"><span style="color:#24292e;">      username: postgres</span></span>
<span class="line"><span style="color:#24292e;">      password: admin123</span></span>
<span class="line"><span style="color:#24292e;">    rewind:  # Has no effect on postgres 10 and lower</span></span>
<span class="line"><span style="color:#24292e;">      username: repuser</span></span>
<span class="line"><span style="color:#24292e;">      password: admin123</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">tags:</span></span>
<span class="line"><span style="color:#24292e;">    nofailover: false</span></span>
<span class="line"><span style="color:#24292e;">    noloadbalance: false</span></span>
<span class="line"><span style="color:#24292e;">    clonefrom: false</span></span>
<span class="line"><span style="color:#24292e;">    nosync: false</span></span></code></pre></div><ul><li>slave</li></ul><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">[ptgres@slave patroni_data]$ cat pg_ydtf03.yml </span></span>
<span class="line"><span style="color:#e1e4e8;">scope: pg_ydtf</span></span>
<span class="line"><span style="color:#e1e4e8;">namespace: /service/</span></span>
<span class="line"><span style="color:#e1e4e8;">name: slave</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">restapi:</span></span>
<span class="line"><span style="color:#e1e4e8;">  listen: 192.168.122.249:8008</span></span>
<span class="line"><span style="color:#e1e4e8;">  connect_address: 192.168.122.249:8008</span></span>
<span class="line"><span style="color:#e1e4e8;">#这里建议使用etcdv3，默认是etcdv2，默认写入到etcd中的键值都是不可见的(仅patroni如此)</span></span>
<span class="line"><span style="color:#e1e4e8;">etcdv3:</span></span>
<span class="line"><span style="color:#e1e4e8;">  #Provide host to do the initial discovery of the cluster topology:</span></span>
<span class="line"><span style="color:#e1e4e8;">  host: 192.168.122.249:2379</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">bootstrap:</span></span>
<span class="line"><span style="color:#e1e4e8;">  # this section will be written into Etcd:/&lt;namespace&gt;/&lt;scope&gt;/config after initializing new cluster</span></span>
<span class="line"><span style="color:#e1e4e8;">  # and all other cluster members will use it as a \`global configuration\`</span></span>
<span class="line"><span style="color:#e1e4e8;">  dcs:</span></span>
<span class="line"><span style="color:#e1e4e8;">    ttl: 30</span></span>
<span class="line"><span style="color:#e1e4e8;">    loop_wait: 10</span></span>
<span class="line"><span style="color:#e1e4e8;">    retry_timeout: 10</span></span>
<span class="line"><span style="color:#e1e4e8;">    maximum_lag_on_failover: 1048576</span></span>
<span class="line"><span style="color:#e1e4e8;">    master_start_timeout: 300</span></span>
<span class="line"><span style="color:#e1e4e8;">    synchronous_mode: false</span></span>
<span class="line"><span style="color:#e1e4e8;">    #standby_cluster:</span></span>
<span class="line"><span style="color:#e1e4e8;">      #host: 127.0.0.1</span></span>
<span class="line"><span style="color:#e1e4e8;">      #port: 1111</span></span>
<span class="line"><span style="color:#e1e4e8;">      #primary_slot_name: patroni</span></span>
<span class="line"><span style="color:#e1e4e8;">    postgresql:</span></span>
<span class="line"><span style="color:#e1e4e8;">      use_pg_rewind: true</span></span>
<span class="line"><span style="color:#e1e4e8;">      use_slots: true</span></span>
<span class="line"><span style="color:#e1e4e8;">      parameters:</span></span>
<span class="line"><span style="color:#e1e4e8;">      wal_level: locical</span></span>
<span class="line"><span style="color:#e1e4e8;">      hot_standby: &quot;on&quot;</span></span>
<span class="line"><span style="color:#e1e4e8;">      wal_keep_segments: 128</span></span>
<span class="line"><span style="color:#e1e4e8;">      max_wal_senders: 10</span></span>
<span class="line"><span style="color:#e1e4e8;">      max_replication_slots: 10</span></span>
<span class="line"><span style="color:#e1e4e8;">      wal_log_hints: &quot;on&quot;</span></span>
<span class="line"><span style="color:#e1e4e8;">      archive_mode: &quot;on&quot;</span></span>
<span class="line"><span style="color:#e1e4e8;">     # primary_conninfo: &#39;host=192.168.2.11 port=1921 user=repuser&#39;</span></span>
<span class="line"><span style="color:#e1e4e8;">      hot_standby: on</span></span>
<span class="line"><span style="color:#e1e4e8;">      archive_timeout: 1800s</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">postgresql:</span></span>
<span class="line"><span style="color:#e1e4e8;">  listen: 0.0.0.0:5532</span></span>
<span class="line"><span style="color:#e1e4e8;">  connect_address: 192.168.122.249:5532</span></span>
<span class="line"><span style="color:#e1e4e8;">  data_dir: /data/pgdata/data</span></span>
<span class="line"><span style="color:#e1e4e8;">  bin_dir: /data/apps/pgsql/12/bin</span></span>
<span class="line"><span style="color:#e1e4e8;">  config_dir: /data/pgdata/data</span></span>
<span class="line"><span style="color:#e1e4e8;">  #pgpass: /home/pg12/patroni/.pgpass</span></span>
<span class="line"><span style="color:#e1e4e8;">  authentication:</span></span>
<span class="line"><span style="color:#e1e4e8;">    replication:</span></span>
<span class="line"><span style="color:#e1e4e8;">      username: repuser</span></span>
<span class="line"><span style="color:#e1e4e8;">      password: admin123</span></span>
<span class="line"><span style="color:#e1e4e8;">    superuser:</span></span>
<span class="line"><span style="color:#e1e4e8;">      username: postgres</span></span>
<span class="line"><span style="color:#e1e4e8;">      password: admin123</span></span>
<span class="line"><span style="color:#e1e4e8;">    rewind:  # Has no effect on postgres 10 and lower</span></span>
<span class="line"><span style="color:#e1e4e8;">      username: repuser</span></span>
<span class="line"><span style="color:#e1e4e8;">      password: admin123</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">tags:</span></span>
<span class="line"><span style="color:#e1e4e8;">    nofailover: false</span></span>
<span class="line"><span style="color:#e1e4e8;">    noloadbalance: false</span></span>
<span class="line"><span style="color:#e1e4e8;">    clonefrom: false</span></span>
<span class="line"><span style="color:#e1e4e8;">    nosync: false</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">[ptgres@slave patroni_data]$ cat pg_ydtf03.yml </span></span>
<span class="line"><span style="color:#24292e;">scope: pg_ydtf</span></span>
<span class="line"><span style="color:#24292e;">namespace: /service/</span></span>
<span class="line"><span style="color:#24292e;">name: slave</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">restapi:</span></span>
<span class="line"><span style="color:#24292e;">  listen: 192.168.122.249:8008</span></span>
<span class="line"><span style="color:#24292e;">  connect_address: 192.168.122.249:8008</span></span>
<span class="line"><span style="color:#24292e;">#这里建议使用etcdv3，默认是etcdv2，默认写入到etcd中的键值都是不可见的(仅patroni如此)</span></span>
<span class="line"><span style="color:#24292e;">etcdv3:</span></span>
<span class="line"><span style="color:#24292e;">  #Provide host to do the initial discovery of the cluster topology:</span></span>
<span class="line"><span style="color:#24292e;">  host: 192.168.122.249:2379</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">bootstrap:</span></span>
<span class="line"><span style="color:#24292e;">  # this section will be written into Etcd:/&lt;namespace&gt;/&lt;scope&gt;/config after initializing new cluster</span></span>
<span class="line"><span style="color:#24292e;">  # and all other cluster members will use it as a \`global configuration\`</span></span>
<span class="line"><span style="color:#24292e;">  dcs:</span></span>
<span class="line"><span style="color:#24292e;">    ttl: 30</span></span>
<span class="line"><span style="color:#24292e;">    loop_wait: 10</span></span>
<span class="line"><span style="color:#24292e;">    retry_timeout: 10</span></span>
<span class="line"><span style="color:#24292e;">    maximum_lag_on_failover: 1048576</span></span>
<span class="line"><span style="color:#24292e;">    master_start_timeout: 300</span></span>
<span class="line"><span style="color:#24292e;">    synchronous_mode: false</span></span>
<span class="line"><span style="color:#24292e;">    #standby_cluster:</span></span>
<span class="line"><span style="color:#24292e;">      #host: 127.0.0.1</span></span>
<span class="line"><span style="color:#24292e;">      #port: 1111</span></span>
<span class="line"><span style="color:#24292e;">      #primary_slot_name: patroni</span></span>
<span class="line"><span style="color:#24292e;">    postgresql:</span></span>
<span class="line"><span style="color:#24292e;">      use_pg_rewind: true</span></span>
<span class="line"><span style="color:#24292e;">      use_slots: true</span></span>
<span class="line"><span style="color:#24292e;">      parameters:</span></span>
<span class="line"><span style="color:#24292e;">      wal_level: locical</span></span>
<span class="line"><span style="color:#24292e;">      hot_standby: &quot;on&quot;</span></span>
<span class="line"><span style="color:#24292e;">      wal_keep_segments: 128</span></span>
<span class="line"><span style="color:#24292e;">      max_wal_senders: 10</span></span>
<span class="line"><span style="color:#24292e;">      max_replication_slots: 10</span></span>
<span class="line"><span style="color:#24292e;">      wal_log_hints: &quot;on&quot;</span></span>
<span class="line"><span style="color:#24292e;">      archive_mode: &quot;on&quot;</span></span>
<span class="line"><span style="color:#24292e;">     # primary_conninfo: &#39;host=192.168.2.11 port=1921 user=repuser&#39;</span></span>
<span class="line"><span style="color:#24292e;">      hot_standby: on</span></span>
<span class="line"><span style="color:#24292e;">      archive_timeout: 1800s</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">postgresql:</span></span>
<span class="line"><span style="color:#24292e;">  listen: 0.0.0.0:5532</span></span>
<span class="line"><span style="color:#24292e;">  connect_address: 192.168.122.249:5532</span></span>
<span class="line"><span style="color:#24292e;">  data_dir: /data/pgdata/data</span></span>
<span class="line"><span style="color:#24292e;">  bin_dir: /data/apps/pgsql/12/bin</span></span>
<span class="line"><span style="color:#24292e;">  config_dir: /data/pgdata/data</span></span>
<span class="line"><span style="color:#24292e;">  #pgpass: /home/pg12/patroni/.pgpass</span></span>
<span class="line"><span style="color:#24292e;">  authentication:</span></span>
<span class="line"><span style="color:#24292e;">    replication:</span></span>
<span class="line"><span style="color:#24292e;">      username: repuser</span></span>
<span class="line"><span style="color:#24292e;">      password: admin123</span></span>
<span class="line"><span style="color:#24292e;">    superuser:</span></span>
<span class="line"><span style="color:#24292e;">      username: postgres</span></span>
<span class="line"><span style="color:#24292e;">      password: admin123</span></span>
<span class="line"><span style="color:#24292e;">    rewind:  # Has no effect on postgres 10 and lower</span></span>
<span class="line"><span style="color:#24292e;">      username: repuser</span></span>
<span class="line"><span style="color:#24292e;">      password: admin123</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">tags:</span></span>
<span class="line"><span style="color:#24292e;">    nofailover: false</span></span>
<span class="line"><span style="color:#24292e;">    noloadbalance: false</span></span>
<span class="line"><span style="color:#24292e;">    clonefrom: false</span></span>
<span class="line"><span style="color:#24292e;">    nosync: false</span></span></code></pre></div><h2 id="_4-4查看集群状态" tabindex="-1">4.4查看集群状态 <a class="header-anchor" href="#_4-4查看集群状态" aria-label="Permalink to &quot;4.4查看集群状态&quot;">​</a></h2><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">[ptgres@master patroni_data]$ patronictl -c pg_ydtf01.yml  list</span></span>
<span class="line"><span style="color:#e1e4e8;">+ Cluster: pg_ydtf (6979496997780856318) --+---------+----+-----------+-----------------+</span></span>
<span class="line"><span style="color:#e1e4e8;">| Member  | Host                 | Role    | State   | TL | Lag in MB | Pending restart |</span></span>
<span class="line"><span style="color:#e1e4e8;">+---------+----------------------+---------+---------+----+-----------+-----------------+</span></span>
<span class="line"><span style="color:#e1e4e8;">| master  | 192.168.122.251:5532 | Leader  | running |  2 |           | *               |</span></span>
<span class="line"><span style="color:#e1e4e8;">| slave   | 192.168.122.249:5532 | Replica | running |  2 |         0 | *               |</span></span>
<span class="line"><span style="color:#e1e4e8;">| slave01 | 192.168.122.14:5532  | Replica | running |  2 |         0 | *               |</span></span>
<span class="line"><span style="color:#e1e4e8;">+---------+----------------------+---------+---------+----+-----------+-----------------+</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">[ptgres@master patroni_data]$ patronictl -c pg_ydtf01.yml  list</span></span>
<span class="line"><span style="color:#24292e;">+ Cluster: pg_ydtf (6979496997780856318) --+---------+----+-----------+-----------------+</span></span>
<span class="line"><span style="color:#24292e;">| Member  | Host                 | Role    | State   | TL | Lag in MB | Pending restart |</span></span>
<span class="line"><span style="color:#24292e;">+---------+----------------------+---------+---------+----+-----------+-----------------+</span></span>
<span class="line"><span style="color:#24292e;">| master  | 192.168.122.251:5532 | Leader  | running |  2 |           | *               |</span></span>
<span class="line"><span style="color:#24292e;">| slave   | 192.168.122.249:5532 | Replica | running |  2 |         0 | *               |</span></span>
<span class="line"><span style="color:#24292e;">| slave01 | 192.168.122.14:5532  | Replica | running |  2 |         0 | *               |</span></span>
<span class="line"><span style="color:#24292e;">+---------+----------------------+---------+---------+----+-----------+-----------------+</span></span></code></pre></div><p>或者</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">[root@master patroni_data]# curl -s http://192.168.122.251:8008/cluster |jq .</span></span>
<span class="line"><span style="color:#e1e4e8;">{</span></span>
<span class="line"><span style="color:#e1e4e8;">  &quot;members&quot;: [</span></span>
<span class="line"><span style="color:#e1e4e8;">    {</span></span>
<span class="line"><span style="color:#e1e4e8;">      &quot;name&quot;: &quot;master&quot;,</span></span>
<span class="line"><span style="color:#e1e4e8;">      &quot;role&quot;: &quot;leader&quot;,</span></span>
<span class="line"><span style="color:#e1e4e8;">      &quot;state&quot;: &quot;running&quot;,</span></span>
<span class="line"><span style="color:#e1e4e8;">      &quot;api_url&quot;: &quot;http://192.168.122.251:8008/patroni&quot;,</span></span>
<span class="line"><span style="color:#e1e4e8;">      &quot;host&quot;: &quot;192.168.122.251&quot;,</span></span>
<span class="line"><span style="color:#e1e4e8;">      &quot;port&quot;: 5532,</span></span>
<span class="line"><span style="color:#e1e4e8;">      &quot;timeline&quot;: 2,</span></span>
<span class="line"><span style="color:#e1e4e8;">      &quot;pending_restart&quot;: true</span></span>
<span class="line"><span style="color:#e1e4e8;">    },</span></span>
<span class="line"><span style="color:#e1e4e8;">    {</span></span>
<span class="line"><span style="color:#e1e4e8;">      &quot;name&quot;: &quot;slave&quot;,</span></span>
<span class="line"><span style="color:#e1e4e8;">      &quot;role&quot;: &quot;replica&quot;,</span></span>
<span class="line"><span style="color:#e1e4e8;">      &quot;state&quot;: &quot;running&quot;,</span></span>
<span class="line"><span style="color:#e1e4e8;">      &quot;api_url&quot;: &quot;http://192.168.122.249:8008/patroni&quot;,</span></span>
<span class="line"><span style="color:#e1e4e8;">      &quot;host&quot;: &quot;192.168.122.249&quot;,</span></span>
<span class="line"><span style="color:#e1e4e8;">      &quot;port&quot;: 5532,</span></span>
<span class="line"><span style="color:#e1e4e8;">      &quot;timeline&quot;: 2,</span></span>
<span class="line"><span style="color:#e1e4e8;">      &quot;pending_restart&quot;: true,</span></span>
<span class="line"><span style="color:#e1e4e8;">      &quot;lag&quot;: 0</span></span>
<span class="line"><span style="color:#e1e4e8;">    },</span></span>
<span class="line"><span style="color:#e1e4e8;">    {</span></span>
<span class="line"><span style="color:#e1e4e8;">      &quot;name&quot;: &quot;slave01&quot;,</span></span>
<span class="line"><span style="color:#e1e4e8;">      &quot;role&quot;: &quot;replica&quot;,</span></span>
<span class="line"><span style="color:#e1e4e8;">      &quot;state&quot;: &quot;running&quot;,</span></span>
<span class="line"><span style="color:#e1e4e8;">      &quot;api_url&quot;: &quot;http://192.168.122.14:8008/patroni&quot;,</span></span>
<span class="line"><span style="color:#e1e4e8;">      &quot;host&quot;: &quot;192.168.122.14&quot;,</span></span>
<span class="line"><span style="color:#e1e4e8;">      &quot;port&quot;: 5532,</span></span>
<span class="line"><span style="color:#e1e4e8;">      &quot;timeline&quot;: 2,</span></span>
<span class="line"><span style="color:#e1e4e8;">      &quot;pending_restart&quot;: true,</span></span>
<span class="line"><span style="color:#e1e4e8;">      &quot;lag&quot;: 0</span></span>
<span class="line"><span style="color:#e1e4e8;">    }</span></span>
<span class="line"><span style="color:#e1e4e8;">  ]</span></span>
<span class="line"><span style="color:#e1e4e8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">[root@master patroni_data]# curl -s http://192.168.122.251:8008/cluster |jq .</span></span>
<span class="line"><span style="color:#24292e;">{</span></span>
<span class="line"><span style="color:#24292e;">  &quot;members&quot;: [</span></span>
<span class="line"><span style="color:#24292e;">    {</span></span>
<span class="line"><span style="color:#24292e;">      &quot;name&quot;: &quot;master&quot;,</span></span>
<span class="line"><span style="color:#24292e;">      &quot;role&quot;: &quot;leader&quot;,</span></span>
<span class="line"><span style="color:#24292e;">      &quot;state&quot;: &quot;running&quot;,</span></span>
<span class="line"><span style="color:#24292e;">      &quot;api_url&quot;: &quot;http://192.168.122.251:8008/patroni&quot;,</span></span>
<span class="line"><span style="color:#24292e;">      &quot;host&quot;: &quot;192.168.122.251&quot;,</span></span>
<span class="line"><span style="color:#24292e;">      &quot;port&quot;: 5532,</span></span>
<span class="line"><span style="color:#24292e;">      &quot;timeline&quot;: 2,</span></span>
<span class="line"><span style="color:#24292e;">      &quot;pending_restart&quot;: true</span></span>
<span class="line"><span style="color:#24292e;">    },</span></span>
<span class="line"><span style="color:#24292e;">    {</span></span>
<span class="line"><span style="color:#24292e;">      &quot;name&quot;: &quot;slave&quot;,</span></span>
<span class="line"><span style="color:#24292e;">      &quot;role&quot;: &quot;replica&quot;,</span></span>
<span class="line"><span style="color:#24292e;">      &quot;state&quot;: &quot;running&quot;,</span></span>
<span class="line"><span style="color:#24292e;">      &quot;api_url&quot;: &quot;http://192.168.122.249:8008/patroni&quot;,</span></span>
<span class="line"><span style="color:#24292e;">      &quot;host&quot;: &quot;192.168.122.249&quot;,</span></span>
<span class="line"><span style="color:#24292e;">      &quot;port&quot;: 5532,</span></span>
<span class="line"><span style="color:#24292e;">      &quot;timeline&quot;: 2,</span></span>
<span class="line"><span style="color:#24292e;">      &quot;pending_restart&quot;: true,</span></span>
<span class="line"><span style="color:#24292e;">      &quot;lag&quot;: 0</span></span>
<span class="line"><span style="color:#24292e;">    },</span></span>
<span class="line"><span style="color:#24292e;">    {</span></span>
<span class="line"><span style="color:#24292e;">      &quot;name&quot;: &quot;slave01&quot;,</span></span>
<span class="line"><span style="color:#24292e;">      &quot;role&quot;: &quot;replica&quot;,</span></span>
<span class="line"><span style="color:#24292e;">      &quot;state&quot;: &quot;running&quot;,</span></span>
<span class="line"><span style="color:#24292e;">      &quot;api_url&quot;: &quot;http://192.168.122.14:8008/patroni&quot;,</span></span>
<span class="line"><span style="color:#24292e;">      &quot;host&quot;: &quot;192.168.122.14&quot;,</span></span>
<span class="line"><span style="color:#24292e;">      &quot;port&quot;: 5532,</span></span>
<span class="line"><span style="color:#24292e;">      &quot;timeline&quot;: 2,</span></span>
<span class="line"><span style="color:#24292e;">      &quot;pending_restart&quot;: true,</span></span>
<span class="line"><span style="color:#24292e;">      &quot;lag&quot;: 0</span></span>
<span class="line"><span style="color:#24292e;">    }</span></span>
<span class="line"><span style="color:#24292e;">  ]</span></span>
<span class="line"><span style="color:#24292e;">}</span></span></code></pre></div><h2 id="_4-5启动日志状态" tabindex="-1">4.5启动日志状态 <a class="header-anchor" href="#_4-5启动日志状态" aria-label="Permalink to &quot;4.5启动日志状态&quot;">​</a></h2><p><img src="`+r+'" alt=""></p><p><img src="'+y+'" alt=""></p><p><img src="'+E+`" alt=""></p><h2 id="_4-6常见问题" tabindex="-1">4.6常见问题 <a class="header-anchor" href="#_4-6常见问题" aria-label="Permalink to &quot;4.6常见问题&quot;">​</a></h2><h3 id="patroni-安装报错" tabindex="-1">patroni 安装报错 <a class="header-anchor" href="#patroni-安装报错" aria-label="Permalink to &quot;patroni 安装报错&quot;">​</a></h3><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">[root@master ~]# pip3 install patroni[etcd] -i https://mirrors.aliyun.com/pypi/simple/</span></span>
<span class="line"><span style="color:#e1e4e8;">Looking in indexes: https://mirrors.aliyun.com/pypi/simple/</span></span>
<span class="line"><span style="color:#e1e4e8;">Collecting patroni[etcd]</span></span>
<span class="line"><span style="color:#e1e4e8;">  Using cached https://mirrors.aliyun.com/pypi/packages/25/01/e4656c541ac648a530fc1b6094324969f9f2ed8d7005ad0fa2598cbf1199/patroni-1.6.5-py3-none-any.whl</span></span>
<span class="line"><span style="color:#e1e4e8;">Collecting psutil&gt;=2.0.0 (from patroni[etcd])</span></span>
<span class="line"><span style="color:#e1e4e8;">  Downloading https://mirrors.aliyun.com/pypi/packages/c4/b8/3512f0e93e0db23a71d82485ba256071ebef99b227351f0f5540f744af41/psutil-5.7.0.tar.gz (449kB)</span></span>
<span class="line"><span style="color:#e1e4e8;">     |████████████████████████████████| 450kB 10.2MB/s</span></span>
<span class="line"><span style="color:#e1e4e8;">    ERROR: Command errored out with exit status 1:</span></span>
<span class="line"><span style="color:#e1e4e8;">     command: /usr/local/bin/python3.8 -c &#39;import sys, setuptools, tokenize; sys.argv[0] = &#39;&quot;&#39;&quot;&#39;/tmp/pip-install-at3fg3sc/psutil/setup.py&#39;&quot;&#39;&quot;&#39;; __file__=&#39;&quot;&#39;&quot;&#39;/tmp/pip-install-at3fg3sc/psutil/setup.py&#39;&quot;&#39;&quot;&#39;;f=getattr(tokenize, &#39;&quot;&#39;&quot;&#39;open&#39;&quot;&#39;&quot;&#39;, open)(__file__);code=f.read().replace(&#39;&quot;&#39;&quot;&#39;\\r\\n&#39;&quot;&#39;&quot;&#39;, &#39;&quot;&#39;&quot;&#39;\\n&#39;&quot;&#39;&quot;&#39;);f.close();exec(compile(code, __file__, &#39;&quot;&#39;&quot;&#39;exec&#39;&quot;&#39;&quot;&#39;))&#39; egg_info --egg-base pip-egg-info</span></span>
<span class="line"><span style="color:#e1e4e8;">         cwd: /tmp/pip-install-at3fg3sc/psutil/</span></span>
<span class="line"><span style="color:#e1e4e8;">    Complete output (11 lines):</span></span>
<span class="line"><span style="color:#e1e4e8;">    Traceback (most recent call last):</span></span>
<span class="line"><span style="color:#e1e4e8;">      File &quot;&lt;string&gt;&quot;, line 1, in &lt;module&gt;</span></span>
<span class="line"><span style="color:#e1e4e8;">      File &quot;/usr/local/lib/python3.8/site-packages/setuptools/__init__.py&quot;, line 20, in &lt;module&gt;</span></span>
<span class="line"><span style="color:#e1e4e8;">        from setuptools.dist import Distribution, Feature</span></span>
<span class="line"><span style="color:#e1e4e8;">      File &quot;/usr/local/lib/python3.8/site-packages/setuptools/dist.py&quot;, line 35, in &lt;module&gt;</span></span>
<span class="line"><span style="color:#e1e4e8;">        from setuptools import windows_support</span></span>
<span class="line"><span style="color:#e1e4e8;">      File &quot;/usr/local/lib/python3.8/site-packages/setuptools/windows_support.py&quot;, line 2, in &lt;module&gt;</span></span>
<span class="line"><span style="color:#e1e4e8;">        import ctypes</span></span>
<span class="line"><span style="color:#e1e4e8;">      File &quot;/usr/local/lib/python3.8/ctypes/__init__.py&quot;, line 7, in &lt;module&gt;</span></span>
<span class="line"><span style="color:#e1e4e8;">        from _ctypes import Union, Structure, Array</span></span>
<span class="line"><span style="color:#e1e4e8;">    ModuleNotFoundError: No module named &#39;_ctypes&#39;</span></span>
<span class="line"><span style="color:#e1e4e8;">    ----------------------------------------</span></span>
<span class="line"><span style="color:#e1e4e8;">ERROR: Command errored out with exit status 1: python setup.py egg_info Check the logs for full command output.</span></span>
<span class="line"><span style="color:#e1e4e8;">WARNING: You are using pip version 19.2.3, however version 20.1.1 is available.</span></span>
<span class="line"><span style="color:#e1e4e8;">You should consider upgrading via the &#39;pip install --upgrade pip&#39; command.</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">[root@master ~]# pip3 install patroni[etcd] -i https://mirrors.aliyun.com/pypi/simple/</span></span>
<span class="line"><span style="color:#24292e;">Looking in indexes: https://mirrors.aliyun.com/pypi/simple/</span></span>
<span class="line"><span style="color:#24292e;">Collecting patroni[etcd]</span></span>
<span class="line"><span style="color:#24292e;">  Using cached https://mirrors.aliyun.com/pypi/packages/25/01/e4656c541ac648a530fc1b6094324969f9f2ed8d7005ad0fa2598cbf1199/patroni-1.6.5-py3-none-any.whl</span></span>
<span class="line"><span style="color:#24292e;">Collecting psutil&gt;=2.0.0 (from patroni[etcd])</span></span>
<span class="line"><span style="color:#24292e;">  Downloading https://mirrors.aliyun.com/pypi/packages/c4/b8/3512f0e93e0db23a71d82485ba256071ebef99b227351f0f5540f744af41/psutil-5.7.0.tar.gz (449kB)</span></span>
<span class="line"><span style="color:#24292e;">     |████████████████████████████████| 450kB 10.2MB/s</span></span>
<span class="line"><span style="color:#24292e;">    ERROR: Command errored out with exit status 1:</span></span>
<span class="line"><span style="color:#24292e;">     command: /usr/local/bin/python3.8 -c &#39;import sys, setuptools, tokenize; sys.argv[0] = &#39;&quot;&#39;&quot;&#39;/tmp/pip-install-at3fg3sc/psutil/setup.py&#39;&quot;&#39;&quot;&#39;; __file__=&#39;&quot;&#39;&quot;&#39;/tmp/pip-install-at3fg3sc/psutil/setup.py&#39;&quot;&#39;&quot;&#39;;f=getattr(tokenize, &#39;&quot;&#39;&quot;&#39;open&#39;&quot;&#39;&quot;&#39;, open)(__file__);code=f.read().replace(&#39;&quot;&#39;&quot;&#39;\\r\\n&#39;&quot;&#39;&quot;&#39;, &#39;&quot;&#39;&quot;&#39;\\n&#39;&quot;&#39;&quot;&#39;);f.close();exec(compile(code, __file__, &#39;&quot;&#39;&quot;&#39;exec&#39;&quot;&#39;&quot;&#39;))&#39; egg_info --egg-base pip-egg-info</span></span>
<span class="line"><span style="color:#24292e;">         cwd: /tmp/pip-install-at3fg3sc/psutil/</span></span>
<span class="line"><span style="color:#24292e;">    Complete output (11 lines):</span></span>
<span class="line"><span style="color:#24292e;">    Traceback (most recent call last):</span></span>
<span class="line"><span style="color:#24292e;">      File &quot;&lt;string&gt;&quot;, line 1, in &lt;module&gt;</span></span>
<span class="line"><span style="color:#24292e;">      File &quot;/usr/local/lib/python3.8/site-packages/setuptools/__init__.py&quot;, line 20, in &lt;module&gt;</span></span>
<span class="line"><span style="color:#24292e;">        from setuptools.dist import Distribution, Feature</span></span>
<span class="line"><span style="color:#24292e;">      File &quot;/usr/local/lib/python3.8/site-packages/setuptools/dist.py&quot;, line 35, in &lt;module&gt;</span></span>
<span class="line"><span style="color:#24292e;">        from setuptools import windows_support</span></span>
<span class="line"><span style="color:#24292e;">      File &quot;/usr/local/lib/python3.8/site-packages/setuptools/windows_support.py&quot;, line 2, in &lt;module&gt;</span></span>
<span class="line"><span style="color:#24292e;">        import ctypes</span></span>
<span class="line"><span style="color:#24292e;">      File &quot;/usr/local/lib/python3.8/ctypes/__init__.py&quot;, line 7, in &lt;module&gt;</span></span>
<span class="line"><span style="color:#24292e;">        from _ctypes import Union, Structure, Array</span></span>
<span class="line"><span style="color:#24292e;">    ModuleNotFoundError: No module named &#39;_ctypes&#39;</span></span>
<span class="line"><span style="color:#24292e;">    ----------------------------------------</span></span>
<span class="line"><span style="color:#24292e;">ERROR: Command errored out with exit status 1: python setup.py egg_info Check the logs for full command output.</span></span>
<span class="line"><span style="color:#24292e;">WARNING: You are using pip version 19.2.3, however version 20.1.1 is available.</span></span>
<span class="line"><span style="color:#24292e;">You should consider upgrading via the &#39;pip install --upgrade pip&#39; command.</span></span></code></pre></div><p>解决方法: 安装 libffi-devel包，之后重新编译安装 python3.8</p><h3 id="patroni-运行报错之一" tabindex="-1">patroni 运行报错之一 <a class="header-anchor" href="#patroni-运行报错之一" aria-label="Permalink to &quot;patroni 运行报错之一&quot;">​</a></h3><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">[ptgres@master patroni]$ patroni pg_ydtf02.yml</span></span>
<span class="line"><span style="color:#e1e4e8;">2020-04-29 08:25:22,183 ERROR: Failed to get list of machines from http://192.168.2.12:2379/v2: EtcdException(&#39;Bad response : 404 page not found\\n&#39;)</span></span>
<span class="line"><span style="color:#e1e4e8;">2020-04-29 08:25:22,184 INFO: waiting on etcd</span></span>
<span class="line"><span style="color:#e1e4e8;">2020-04-29 08:25:27,193 ERROR: Failed to get list of machines from http://192.168.2.12:2379/v2: EtcdException(&#39;Bad response : 404 page not found\\n&#39;)</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">[ptgres@master patroni]$ patroni pg_ydtf02.yml</span></span>
<span class="line"><span style="color:#24292e;">2020-04-29 08:25:22,183 ERROR: Failed to get list of machines from http://192.168.2.12:2379/v2: EtcdException(&#39;Bad response : 404 page not found\\n&#39;)</span></span>
<span class="line"><span style="color:#24292e;">2020-04-29 08:25:22,184 INFO: waiting on etcd</span></span>
<span class="line"><span style="color:#24292e;">2020-04-29 08:25:27,193 ERROR: Failed to get list of machines from http://192.168.2.12:2379/v2: EtcdException(&#39;Bad response : 404 page not found\\n&#39;)</span></span></code></pre></div><p>Etcd3.4的默认API为v3版本，Patroni现阶段不支持 v3 API，因此在三台主机的<code>etcd</code>启动脚本里加上<code>--enable-v2</code>属性即可</p><h3 id="patroni-运行报错之二" tabindex="-1">patroni 运行报错之二 <a class="header-anchor" href="#patroni-运行报错之二" aria-label="Permalink to &quot;patroni 运行报错之二&quot;">​</a></h3><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">[pg12@ydtf01 patroni]$ patroni pg_ydtf01.yml</span></span>
<span class="line"><span style="color:#e1e4e8;">2020-05-05 22:22:26,559 INFO: No PostgreSQL configuration items changed, nothing to reload.</span></span>
<span class="line"><span style="color:#e1e4e8;">2020-05-05 22:22:26,567 INFO: establishing a new patroni connection to the postgres cluster</span></span>
<span class="line"><span style="color:#e1e4e8;">2020-05-05 22:22:27,226 INFO: establishing a new patroni connection to the postgres cluster</span></span>
<span class="line"><span style="color:#e1e4e8;">2020-05-05 22:22:27,230 WARNING: Retry got exception: &#39;connection problems&#39;</span></span>
<span class="line"><span style="color:#e1e4e8;">192.168.2.11:1921 - accepting connections</span></span>
<span class="line"><span style="color:#e1e4e8;">Traceback (most recent call last):</span></span>
<span class="line"><span style="color:#e1e4e8;">  File &quot;/usr/local/bin/patroni&quot;, line 10, in &lt;module&gt;</span></span>
<span class="line"><span style="color:#e1e4e8;">    sys.exit(main())</span></span>
<span class="line"><span style="color:#e1e4e8;">  File &quot;/usr/local/lib/python3.8/site-packages/patroni/__init__.py&quot;, line 235, in main</span></span>
<span class="line"><span style="color:#e1e4e8;">    return patroni_main()</span></span>
<span class="line"><span style="color:#e1e4e8;">  File &quot;/usr/local/lib/python3.8/site-packages/patroni/__init__.py&quot;, line 197, in patroni_main</span></span>
<span class="line"><span style="color:#e1e4e8;">    patroni = Patroni(conf)</span></span>
<span class="line"><span style="color:#e1e4e8;">  File &quot;/usr/local/lib/python3.8/site-packages/patroni/__init__.py&quot;, line 36, in __init__</span></span>
<span class="line"><span style="color:#e1e4e8;">    self.postgresql = Postgresql(self.config[&#39;postgresql&#39;])</span></span>
<span class="line"><span style="color:#e1e4e8;">  File &quot;/usr/local/lib/python3.8/site-packages/patroni/postgresql/__init__.py&quot;, line 99, in __init__</span></span>
<span class="line"><span style="color:#e1e4e8;">    self.set_role(&#39;master&#39; if self.is_leader() else &#39;replica&#39;)</span></span>
<span class="line"><span style="color:#e1e4e8;">  File &quot;/usr/local/lib/python3.8/site-packages/patroni/postgresql/__init__.py&quot;, line 305, in is_leader</span></span>
<span class="line"><span style="color:#e1e4e8;">    return bool(self._cluster_info_state_get(&#39;timeline&#39;))</span></span>
<span class="line"><span style="color:#e1e4e8;">  File &quot;/usr/local/lib/python3.8/site-packages/patroni/postgresql/__init__.py&quot;, line 300, in _cluster_info_state_get</span></span>
<span class="line"><span style="color:#e1e4e8;">    raise PostgresConnectionException(self._cluster_info_state[&#39;error&#39;])</span></span>
<span class="line"><span style="color:#e1e4e8;">patroni.exceptions.PostgresConnectionException: &quot;&#39;Too many retry attempts&#39;&quot;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">[pg12@ydtf01 patroni]$ patroni pg_ydtf01.yml</span></span>
<span class="line"><span style="color:#24292e;">2020-05-05 22:22:26,559 INFO: No PostgreSQL configuration items changed, nothing to reload.</span></span>
<span class="line"><span style="color:#24292e;">2020-05-05 22:22:26,567 INFO: establishing a new patroni connection to the postgres cluster</span></span>
<span class="line"><span style="color:#24292e;">2020-05-05 22:22:27,226 INFO: establishing a new patroni connection to the postgres cluster</span></span>
<span class="line"><span style="color:#24292e;">2020-05-05 22:22:27,230 WARNING: Retry got exception: &#39;connection problems&#39;</span></span>
<span class="line"><span style="color:#24292e;">192.168.2.11:1921 - accepting connections</span></span>
<span class="line"><span style="color:#24292e;">Traceback (most recent call last):</span></span>
<span class="line"><span style="color:#24292e;">  File &quot;/usr/local/bin/patroni&quot;, line 10, in &lt;module&gt;</span></span>
<span class="line"><span style="color:#24292e;">    sys.exit(main())</span></span>
<span class="line"><span style="color:#24292e;">  File &quot;/usr/local/lib/python3.8/site-packages/patroni/__init__.py&quot;, line 235, in main</span></span>
<span class="line"><span style="color:#24292e;">    return patroni_main()</span></span>
<span class="line"><span style="color:#24292e;">  File &quot;/usr/local/lib/python3.8/site-packages/patroni/__init__.py&quot;, line 197, in patroni_main</span></span>
<span class="line"><span style="color:#24292e;">    patroni = Patroni(conf)</span></span>
<span class="line"><span style="color:#24292e;">  File &quot;/usr/local/lib/python3.8/site-packages/patroni/__init__.py&quot;, line 36, in __init__</span></span>
<span class="line"><span style="color:#24292e;">    self.postgresql = Postgresql(self.config[&#39;postgresql&#39;])</span></span>
<span class="line"><span style="color:#24292e;">  File &quot;/usr/local/lib/python3.8/site-packages/patroni/postgresql/__init__.py&quot;, line 99, in __init__</span></span>
<span class="line"><span style="color:#24292e;">    self.set_role(&#39;master&#39; if self.is_leader() else &#39;replica&#39;)</span></span>
<span class="line"><span style="color:#24292e;">  File &quot;/usr/local/lib/python3.8/site-packages/patroni/postgresql/__init__.py&quot;, line 305, in is_leader</span></span>
<span class="line"><span style="color:#24292e;">    return bool(self._cluster_info_state_get(&#39;timeline&#39;))</span></span>
<span class="line"><span style="color:#24292e;">  File &quot;/usr/local/lib/python3.8/site-packages/patroni/postgresql/__init__.py&quot;, line 300, in _cluster_info_state_get</span></span>
<span class="line"><span style="color:#24292e;">    raise PostgresConnectionException(self._cluster_info_state[&#39;error&#39;])</span></span>
<span class="line"><span style="color:#24292e;">patroni.exceptions.PostgresConnectionException: &quot;&#39;Too many retry attempts&#39;&quot;</span></span></code></pre></div><p>解决方法: 修改pg_ydtf01.yml文件的postgresql 模块参数 listen: 0.0.0.0:1921</p><p>或者加上ipv6地址</p><p>host all all ::1/128 trust</p><h1 id="五、自动切换和脑裂防护" tabindex="-1">五、自动切换和脑裂防护 <a class="header-anchor" href="#五、自动切换和脑裂防护" aria-label="Permalink to &quot;五、自动切换和脑裂防护&quot;">​</a></h1><h2 id="_5-1-patroni如何防止脑裂" tabindex="-1">5.1 Patroni如何防止脑裂 <a class="header-anchor" href="#_5-1-patroni如何防止脑裂" aria-label="Permalink to &quot;5.1 Patroni如何防止脑裂&quot;">​</a></h2><p>利用PostgreSQL同步复制防止脑裂</p><p>patroni.yml中设置同步模式</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">synchronous_mode:true</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">synchronous_mode:true</span></span></code></pre></div><p>另一种方式：</p><p>部署在数据库节点上的patroni进程会执行一些保护操作，确保不会出现多个“主库”</p><ol><li>非Leader节点的PG处于生产模式时，重启PG并切换到恢复模式作为备库运行</li><li>Leader节点的patroni无法连接etcd时，不能确保自己仍然是Leader，将本机的PG降级为备库</li><li>正常停止patroni时，patroni会顺便把本机的PG进程也停掉</li></ol><p>然而，当patroni进程自身无法正常工作时，以上的保护措施难以得到贯彻。比如patroni进程异常终止或主机临时hang等。</p><p>为了更可靠的防止脑裂，Patroni支持通过Linux的watchdog监视patroni进程的运行，当patroni进程无法正常往watchdog设备写入心跳时，由watchdog触发Linux重启。具体的配置方法如下</p><p>设置Patroni的systemd service配置文件<code>/usr/lib/systemd/system/patroni.service</code></p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">[Unit]</span></span>
<span class="line"><span style="color:#e1e4e8;">Description=Runners to orchestrate a high-availability PostgreSQL</span></span>
<span class="line"><span style="color:#e1e4e8;">After=syslog.target network.target</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">[Service]</span></span>
<span class="line"><span style="color:#e1e4e8;">Type=simple</span></span>
<span class="line"><span style="color:#e1e4e8;">User=postgres</span></span>
<span class="line"><span style="color:#e1e4e8;">Group=postgres</span></span>
<span class="line"><span style="color:#e1e4e8;">#StandardOutput=syslog</span></span>
<span class="line"><span style="color:#e1e4e8;">ExecStartPre=-/usr/bin/sudo /sbin/modprobe softdog</span></span>
<span class="line"><span style="color:#e1e4e8;">ExecStartPre=-/usr/bin/sudo /bin/chown postgres /dev/watchdog</span></span>
<span class="line"><span style="color:#e1e4e8;">ExecStart=/usr/bin/patroni /etc/patroni.yml</span></span>
<span class="line"><span style="color:#e1e4e8;">ExecReload=/bin/kill -s HUP $MAINPID</span></span>
<span class="line"><span style="color:#e1e4e8;">KillMode=process</span></span>
<span class="line"><span style="color:#e1e4e8;">TimeoutSec=30</span></span>
<span class="line"><span style="color:#e1e4e8;">Restart=no</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">[Install]</span></span>
<span class="line"><span style="color:#e1e4e8;">WantedBy=multi-user.target</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">[Unit]</span></span>
<span class="line"><span style="color:#24292e;">Description=Runners to orchestrate a high-availability PostgreSQL</span></span>
<span class="line"><span style="color:#24292e;">After=syslog.target network.target</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">[Service]</span></span>
<span class="line"><span style="color:#24292e;">Type=simple</span></span>
<span class="line"><span style="color:#24292e;">User=postgres</span></span>
<span class="line"><span style="color:#24292e;">Group=postgres</span></span>
<span class="line"><span style="color:#24292e;">#StandardOutput=syslog</span></span>
<span class="line"><span style="color:#24292e;">ExecStartPre=-/usr/bin/sudo /sbin/modprobe softdog</span></span>
<span class="line"><span style="color:#24292e;">ExecStartPre=-/usr/bin/sudo /bin/chown postgres /dev/watchdog</span></span>
<span class="line"><span style="color:#24292e;">ExecStart=/usr/bin/patroni /etc/patroni.yml</span></span>
<span class="line"><span style="color:#24292e;">ExecReload=/bin/kill -s HUP $MAINPID</span></span>
<span class="line"><span style="color:#24292e;">KillMode=process</span></span>
<span class="line"><span style="color:#24292e;">TimeoutSec=30</span></span>
<span class="line"><span style="color:#24292e;">Restart=no</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">[Install]</span></span>
<span class="line"><span style="color:#24292e;">WantedBy=multi-user.target</span></span></code></pre></div><p>修改Patroni配置文件<code>/etc/patroni.yml</code>，添加以下内容</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">watchdog:</span></span>
<span class="line"><span style="color:#e1e4e8;">mode: automatic # Allowed values: off, automatic, required</span></span>
<span class="line"><span style="color:#e1e4e8;">device: /dev/watchdog</span></span>
<span class="line"><span style="color:#e1e4e8;">safety_margin: 5</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">watchdog:</span></span>
<span class="line"><span style="color:#24292e;">mode: automatic # Allowed values: off, automatic, required</span></span>
<span class="line"><span style="color:#24292e;">device: /dev/watchdog</span></span>
<span class="line"><span style="color:#24292e;">safety_margin: 5</span></span></code></pre></div><p><code>safety_margin</code>指如果Patroni没有及时更新watchdog，watchdog会在Leader key过期前多久触发重启。在本例的配置下(ttl=30，loop_wait=10，safety_margin=5)下，patroni进程每隔10秒（<code>loop_wait</code>）都会更新Leader key和watchdog。如果Leader节点异常导致patroni进程无法及时更新watchdog，会在Leader key过期的前5秒触发重启。重启如果在5秒之内完成，Leader节点有机会再次获得Leader锁，否则Leader key过期后，由备库通过选举选出新的Leader。</p><p>这套机制基本上可以保证不会出现&quot;双主&quot;，但是这个保证是依赖于watchdog的可靠性的，从生产实践上这个保证对绝大部分场景可能是足够的，但是从理论上难以证明它100%可靠。</p><p>另一方面，自动重启机器的方式会不会太暴力导致&quot;误杀&quot;呢？比如由于突发的业务访问导致机器负载过高，进而导致patroni进程不能及时分配到CPU资源，此时自动重启机器就未必是我们期望的行为</p><h2 id="_5-2-利用postgresql同步复制防止脑裂" tabindex="-1"><strong>5.2 利用PostgreSQL同步复制防止脑裂</strong> <a class="header-anchor" href="#_5-2-利用postgresql同步复制防止脑裂" aria-label="Permalink to &quot;**5.2 利用PostgreSQL同步复制防止脑裂**&quot;">​</a></h2><p>防止脑裂的另一个手段是把PostgreSQL集群配置成同步复制模式。利用同步复制模式下的主库在没有同步备库应答日志时写入会阻塞的特点，在数据库内部确保即使出现“双主”也不会发生&quot;双写&quot;。采用这种方式防止脑裂是最可靠最安全的，代价是同步复制相对异步复制会降低一点性能。具体设置方法如下</p><p>初始运行Patroni时，在Patroni配置文件<code>/etc/patroni.yml</code>中设置同步模式</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">synchronous_mode:true</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">synchronous_mode:true</span></span></code></pre></div><p>对于已部署的Patroni可以通过patronictl命令修改配置</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">patronictl edit-config -s &#39;synchronous_mode=true&#39;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">patronictl edit-config -s &#39;synchronous_mode=true&#39;</span></span></code></pre></div><p>此配置下，如果同步备库临时不可用，Patroni会把主库的复制模式降级成了异步复制，确保服务不中断。效果类似于MySQL的半同步复制，但是相比MySQL使用固定的超时时间控制复制降级，这种方式更加智能，同时还具有防脑裂的功效。</p><p>在同步模式下，只有同步备库具有被提升为主库的资格。因此如果主库被降级为异步复制，由于没有同步备库作为候选主库failover不会被触发，也就不会出现“双主”。如果主库没有被降级为异步复制，那么即使出现“双主”，由于旧主处于同步复制模式，数据无法被写入，也不会出现“双写”。</p><p>Patroni通过动态调整PostgreSQL参数<code>synchronous_standby_names</code>控制同步异步复制的切换。并且Patroni会把同步的状态记录到etcd中，确保同步状态在Patroni集群中的一致性。</p><p>正常的同步模式的元数据示例如下</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">[root@node4 ~]# etcdctl get /service/cn/sync</span></span>
<span class="line"><span style="color:#e1e4e8;">{&quot;leader&quot;:&quot;pg1&quot;,&quot;sync_standby&quot;:&quot;pg2&quot;}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">[root@node4 ~]# etcdctl get /service/cn/sync</span></span>
<span class="line"><span style="color:#24292e;">{&quot;leader&quot;:&quot;pg1&quot;,&quot;sync_standby&quot;:&quot;pg2&quot;}</span></span></code></pre></div><p>备库故障导致主库临时降级为异步复制的元数据如下：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">[root@node4 ~]# etcdctl get /service/cn/sync</span></span>
<span class="line"><span style="color:#e1e4e8;">{&quot;leader&quot;:&quot;pg1&quot;,&quot;sync_standby&quot;:null}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">[root@node4 ~]# etcdctl get /service/cn/sync</span></span>
<span class="line"><span style="color:#24292e;">{&quot;leader&quot;:&quot;pg1&quot;,&quot;sync_standby&quot;:null}</span></span></code></pre></div><p>如果集群中包含3个以上的节点，还可以考虑采取更严格的同步策略，禁止Patroni把同步模式降级为异步。这样可以确保任何写入的数据至少存在于2个以上的节点。对数据安全要求极高的业务可以采用这种方式</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">synchronous_mode:true</span></span>
<span class="line"><span style="color:#e1e4e8;">synchronous_mode_strict:true</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">synchronous_mode:true</span></span>
<span class="line"><span style="color:#24292e;">synchronous_mode_strict:true</span></span></code></pre></div><p>如果集群包含异地的灾备节点，可以根据需要配置该节点为不参与选主，不参与负载均衡，也不作为同步备库</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">tags:</span></span>
<span class="line"><span style="color:#e1e4e8;">nofailover: true</span></span>
<span class="line"><span style="color:#e1e4e8;">noloadbalance: true</span></span>
<span class="line"><span style="color:#e1e4e8;">clonefrom: false</span></span>
<span class="line"><span style="color:#e1e4e8;">nosync: true</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">tags:</span></span>
<span class="line"><span style="color:#24292e;">nofailover: true</span></span>
<span class="line"><span style="color:#24292e;">noloadbalance: true</span></span>
<span class="line"><span style="color:#24292e;">clonefrom: false</span></span>
<span class="line"><span style="color:#24292e;">nosync: true</span></span></code></pre></div><h2 id="_5-3-etcd不可访问的影响" tabindex="-1"><strong>5.3 etcd不可访问的影响</strong> <a class="header-anchor" href="#_5-3-etcd不可访问的影响" aria-label="Permalink to &quot;**5.3 etcd不可访问的影响**&quot;">​</a></h2><p>当Patroni无法访问etcd时，将不能确认自己所处的角色。为了防止这种状态下产生脑裂，如果本机的PG是主库，Patroni会把PG降级为备库。如果集群中所有Patroni节点都无法访问etcd，集群中将全部都是备库，业务无法写入数据。这就要求etcd集群具有非常高的可用性，特别是当我们用一套中心的etcd集群管理几百几千套PG集群的时候。</p><p>当我们使用集中式的一套etcd集群管理很多套PG集群时，为了预防etcd集群故障带来的严重影响，可以考虑设置超大的<code>retry_timeout</code>参数，比如1万天，同时通过同步复制模式防止脑裂</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">retry_timeout:864000000</span></span>
<span class="line"><span style="color:#e1e4e8;">synchronous_mode:true</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">retry_timeout:864000000</span></span>
<span class="line"><span style="color:#24292e;">synchronous_mode:true</span></span></code></pre></div><p><code>retry_timeout</code>用于控制操作DCS和PostgreSQL的重试超时。Patroni对需要重试的操作，除了时间上的限制还有重试次数的限制。对于PostgreSQL操作，目前似乎只有调用<code>GET /patroni</code>的REST API时会重试，而且最多只重试1次，所以把<code>retry_timeout</code>调大不会带来其他副作用</p><h2 id="_5-4自动failover" tabindex="-1">5.4自动failover <a class="header-anchor" href="#_5-4自动failover" aria-label="Permalink to &quot;5.4自动failover&quot;">​</a></h2><ul><li>节点断网，通信失败，服务不停</li><li>节点断电，通信失败，停服</li><li>通信成功，服务停</li><li>dcs 失效, 集群变为只读</li><li>失联节点重新加入集群</li></ul><h2 id="_5-5-备份恢复" tabindex="-1">5.5 备份恢复 <a class="header-anchor" href="#_5-5-备份恢复" aria-label="Permalink to &quot;5.5 备份恢复&quot;">​</a></h2><ul><li>etcd 备份恢复</li></ul><ol><li>patroni 节点关闭后删除etcd数据 ，重新启动后数据再次生成</li><li>正在运行的集群删除etcd数据 , 数据再次自动生成。</li></ol><ul><li>pg 备份恢复</li></ul><ol><li>全量备份</li><li>wal 备份</li></ol><h1 id="六、日常操作" tabindex="-1">六、日常操作 <a class="header-anchor" href="#六、日常操作" aria-label="Permalink to &quot;六、日常操作&quot;">​</a></h1><ul><li>查看patroni 状态</li></ul><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">curl -s http://127.0.0.1:8008/patroni | jq .</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">curl -s http://127.0.0.1:8008/patroni | jq .</span></span></code></pre></div><ul><li>查看版本</li></ul><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">[root@master ~]# patroni --version </span></span>
<span class="line"><span style="color:#e1e4e8;">patroni 2.1.0</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">[root@master ~]# patroni --version </span></span>
<span class="line"><span style="color:#24292e;">patroni 2.1.0</span></span></code></pre></div><ul><li>查看集群状态</li></ul><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">patronictl -c /data/patroni_data/postgres0.yml list</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">patronictl -c /data/patroni_data/postgres0.yml list</span></span></code></pre></div><ul><li>手动切换master</li></ul><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">[ptgres@slave patroni]$ patronictl -c patroni.yml  switchover</span></span>
<span class="line"><span style="color:#e1e4e8;">Master [master]: master</span></span>
<span class="line"><span style="color:#e1e4e8;">Candidate [&#39;slave&#39;, &#39;slave01&#39;] []: slave</span></span>
<span class="line"><span style="color:#e1e4e8;">When should the switchover take place (e.g. 2021-07-14T00:17 )  [now]: now</span></span>
<span class="line"><span style="color:#e1e4e8;">Current cluster topology</span></span>
<span class="line"><span style="color:#e1e4e8;">+ Cluster: pgydtf (6982843055379144189) ---+---------+----+-----------+-----------------+</span></span>
<span class="line"><span style="color:#e1e4e8;">| Member  | Host                 | Role    | State   | TL | Lag in MB | Pending restart |</span></span>
<span class="line"><span style="color:#e1e4e8;">+---------+----------------------+---------+---------+----+-----------+-----------------+</span></span>
<span class="line"><span style="color:#e1e4e8;">| master  | 192.168.210.251:5532 | Leader  | running |  1 |           |                 |</span></span>
<span class="line"><span style="color:#e1e4e8;">| slave   | 192.168.210.249:5532 | Replica | running |  1 |         0 | *               |</span></span>
<span class="line"><span style="color:#e1e4e8;">| slave01 | 192.168.210.14:5532  | Replica | running |  1 |         0 | *               |</span></span>
<span class="line"><span style="color:#e1e4e8;">+---------+----------------------+---------+---------+----+-----------+-----------------+</span></span>
<span class="line"><span style="color:#e1e4e8;">Are you sure you want to switchover cluster pgydtf, demoting current master master? [y/N]: y</span></span>
<span class="line"><span style="color:#e1e4e8;">2021-07-13 23:17:36.20374 Successfully switched over to &quot;slave&quot;</span></span>
<span class="line"><span style="color:#e1e4e8;">+ Cluster: pgydtf (6982843055379144189) ---+---------+----+-----------+-----------------+</span></span>
<span class="line"><span style="color:#e1e4e8;">| Member  | Host                 | Role    | State   | TL | Lag in MB | Pending restart |</span></span>
<span class="line"><span style="color:#e1e4e8;">+---------+----------------------+---------+---------+----+-----------+-----------------+</span></span>
<span class="line"><span style="color:#e1e4e8;">| master  | 192.168.210.251:5532 | Replica | stopped |    |   unknown |                 |</span></span>
<span class="line"><span style="color:#e1e4e8;">| slave   | 192.168.210.249:5532 | Leader  | running |  1 |           | *               |</span></span>
<span class="line"><span style="color:#e1e4e8;">| slave01 | 192.168.210.14:5532  | Replica | running |  1 |         0 | *               |</span></span>
<span class="line"><span style="color:#e1e4e8;">+---------+----------------------+---------+---------+----+-----------+-----------------+</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">#如果写错，提示503</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">[ptgres@slave patroni]$ patronictl -c patroni.yml  switchover</span></span>
<span class="line"><span style="color:#24292e;">Master [master]: master</span></span>
<span class="line"><span style="color:#24292e;">Candidate [&#39;slave&#39;, &#39;slave01&#39;] []: slave</span></span>
<span class="line"><span style="color:#24292e;">When should the switchover take place (e.g. 2021-07-14T00:17 )  [now]: now</span></span>
<span class="line"><span style="color:#24292e;">Current cluster topology</span></span>
<span class="line"><span style="color:#24292e;">+ Cluster: pgydtf (6982843055379144189) ---+---------+----+-----------+-----------------+</span></span>
<span class="line"><span style="color:#24292e;">| Member  | Host                 | Role    | State   | TL | Lag in MB | Pending restart |</span></span>
<span class="line"><span style="color:#24292e;">+---------+----------------------+---------+---------+----+-----------+-----------------+</span></span>
<span class="line"><span style="color:#24292e;">| master  | 192.168.210.251:5532 | Leader  | running |  1 |           |                 |</span></span>
<span class="line"><span style="color:#24292e;">| slave   | 192.168.210.249:5532 | Replica | running |  1 |         0 | *               |</span></span>
<span class="line"><span style="color:#24292e;">| slave01 | 192.168.210.14:5532  | Replica | running |  1 |         0 | *               |</span></span>
<span class="line"><span style="color:#24292e;">+---------+----------------------+---------+---------+----+-----------+-----------------+</span></span>
<span class="line"><span style="color:#24292e;">Are you sure you want to switchover cluster pgydtf, demoting current master master? [y/N]: y</span></span>
<span class="line"><span style="color:#24292e;">2021-07-13 23:17:36.20374 Successfully switched over to &quot;slave&quot;</span></span>
<span class="line"><span style="color:#24292e;">+ Cluster: pgydtf (6982843055379144189) ---+---------+----+-----------+-----------------+</span></span>
<span class="line"><span style="color:#24292e;">| Member  | Host                 | Role    | State   | TL | Lag in MB | Pending restart |</span></span>
<span class="line"><span style="color:#24292e;">+---------+----------------------+---------+---------+----+-----------+-----------------+</span></span>
<span class="line"><span style="color:#24292e;">| master  | 192.168.210.251:5532 | Replica | stopped |    |   unknown |                 |</span></span>
<span class="line"><span style="color:#24292e;">| slave   | 192.168.210.249:5532 | Leader  | running |  1 |           | *               |</span></span>
<span class="line"><span style="color:#24292e;">| slave01 | 192.168.210.14:5532  | Replica | running |  1 |         0 | *               |</span></span>
<span class="line"><span style="color:#24292e;">+---------+----------------------+---------+---------+----+-----------+-----------------+</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">#如果写错，提示503</span></span></code></pre></div><ul><li>查询所有key</li></ul><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">[root@master data]# etcdctl --endpoints=&#39;192.168.122.251:2379&#39; get / --prefix --keys-only</span></span>
<span class="line"><span style="color:#e1e4e8;">/service/twpg/config</span></span>
<span class="line"><span style="color:#e1e4e8;">/service/twpg/history</span></span>
<span class="line"><span style="color:#e1e4e8;">/service/twpg/initialize</span></span>
<span class="line"><span style="color:#e1e4e8;">/service/twpg/leader</span></span>
<span class="line"><span style="color:#e1e4e8;">/service/twpg/members/pg1</span></span>
<span class="line"><span style="color:#e1e4e8;">/service/twpg/members/pg2</span></span>
<span class="line"><span style="color:#e1e4e8;">/service/twpg/members/pg3</span></span>
<span class="line"><span style="color:#e1e4e8;">/service/twpg/optime/leader</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">[root@master data]# etcdctl --endpoints=&#39;192.168.122.251:2379&#39; get / --prefix --keys-only</span></span>
<span class="line"><span style="color:#24292e;">/service/twpg/config</span></span>
<span class="line"><span style="color:#24292e;">/service/twpg/history</span></span>
<span class="line"><span style="color:#24292e;">/service/twpg/initialize</span></span>
<span class="line"><span style="color:#24292e;">/service/twpg/leader</span></span>
<span class="line"><span style="color:#24292e;">/service/twpg/members/pg1</span></span>
<span class="line"><span style="color:#24292e;">/service/twpg/members/pg2</span></span>
<span class="line"><span style="color:#24292e;">/service/twpg/members/pg3</span></span>
<span class="line"><span style="color:#24292e;">/service/twpg/optime/leader</span></span></code></pre></div><ul><li><p>查询具体key</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">[root@pg_node1 data]# etcdctl --endpoints=&#39;192.168.122.251:2379&#39; get /service/twpg/config</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">[root@pg_node1 data]# etcdctl --endpoints=&#39;192.168.122.251:2379&#39; get /service/twpg/config</span></span></code></pre></div><ul><li>读取配置文件</li></ul><p>curl -s <a href="http://192.168.122.251:8008/config" target="_blank" rel="noreferrer">http://192.168.122.251:8008/config</a> | jq .</p></li><li><p>读取集群信息</p></li></ul><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">curl -s http://10.10.1.11:8008/cluster | jq .</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">curl -s http://10.10.1.11:8008/cluster | jq .</span></span></code></pre></div><ul><li>获取节点角色信息</li></ul><p>curl -s <a href="http://10.10.1.12:8008/health" target="_blank" rel="noreferrer">http://10.10.1.12:8008/health</a> | jq .role</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">-- 根据response code status</span></span>
<span class="line"><span style="color:#e1e4e8;">主节点 200 , 从节点503 </span></span>
<span class="line"><span style="color:#e1e4e8;">curl -si http://10.10.1.13:8008/master</span></span>
<span class="line"><span style="color:#e1e4e8;">从节点 200 ,主节点503</span></span>
<span class="line"><span style="color:#e1e4e8;">curl -si http://10.10.1.13:8008/replica</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">-- 根据response code status</span></span>
<span class="line"><span style="color:#24292e;">主节点 200 , 从节点503 </span></span>
<span class="line"><span style="color:#24292e;">curl -si http://10.10.1.13:8008/master</span></span>
<span class="line"><span style="color:#24292e;">从节点 200 ,主节点503</span></span>
<span class="line"><span style="color:#24292e;">curl -si http://10.10.1.13:8008/replica</span></span></code></pre></div><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">#模拟etcd节点出现问题，停掉etcd的LEADER节点</span></span>
<span class="line"><span style="color:#E1E4E8;">[root@pg_node1 </span><span style="color:#F97583;">~</span><span style="color:#E1E4E8;">]# etcdctl endpoint status --endpoints=</span><span style="color:#9ECBFF;">&#39;192.168.210.15:2379,192.168.210.81:2379,192.168.210.33:2379&#39;</span><span style="color:#E1E4E8;"> -w table</span></span>
<span class="line"><span style="color:#B392F0;">+---------------------+------------------+---------+---------+-----------+------------+-----------+------------+--------------------+--------+</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">      </span><span style="color:#B392F0;">ENDPOINT</span><span style="color:#E1E4E8;">       </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">        </span><span style="color:#B392F0;">ID</span><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">VERSION</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">DB</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">SIZE</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">IS</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">LEADER</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">IS</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">LEARNER</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">RAFT</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">TERM</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">RAFT</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">INDEX</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">RAFT</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">APPLIED</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">INDEX</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">ERRORS</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#B392F0;">+---------------------+------------------+---------+---------+-----------+------------+-----------+------------+--------------------+--------+</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">192.168.210.15:2379</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">2baa1a77ec379977</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">   </span><span style="color:#B392F0;">3.5.0</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">1.0</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">MB</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">     </span><span style="color:#79B8FF;">false</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">      </span><span style="color:#79B8FF;">false</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">        </span><span style="color:#B392F0;">15</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">       </span><span style="color:#B392F0;">4866</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">               </span><span style="color:#B392F0;">4866</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">192.168.210.81:2379</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">ff5595d67d21105</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">   </span><span style="color:#B392F0;">3.5.0</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">1.0</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">MB</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">      </span><span style="color:#79B8FF;">true</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">      </span><span style="color:#79B8FF;">false</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">        </span><span style="color:#B392F0;">15</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">       </span><span style="color:#B392F0;">4866</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">               </span><span style="color:#B392F0;">4866</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">192.168.210.33:2379</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">b5d9c4826815356e</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">   </span><span style="color:#B392F0;">3.5.0</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">1.0</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">MB</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">     </span><span style="color:#79B8FF;">false</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">      </span><span style="color:#79B8FF;">false</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">        </span><span style="color:#B392F0;">15</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">       </span><span style="color:#B392F0;">4866</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">               </span><span style="color:#B392F0;">4866</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#B392F0;">+---------------------+------------------+---------+---------+-----------+------------+-----------+------------+--------------------+--------+</span></span>
<span class="line"><span style="color:#E1E4E8;">[root@pg_node2 </span><span style="color:#F97583;">~</span><span style="color:#E1E4E8;">]# systemctl stop etcd</span></span>
<span class="line"><span style="color:#E1E4E8;">[root@pg_node2 </span><span style="color:#F97583;">~</span><span style="color:#E1E4E8;">]# etcdctl endpoint status --endpoints=</span><span style="color:#9ECBFF;">&#39;192.168.210.15:2379,192.168.210.81:2379,192.168.210.33:2379&#39;</span><span style="color:#E1E4E8;"> -w table</span></span>
<span class="line"><span style="color:#E1E4E8;">{</span><span style="color:#B392F0;">&quot;level&quot;</span><span style="color:#79B8FF;">:</span><span style="color:#B392F0;">&quot;warn&quot;</span><span style="color:#B392F0;">,</span><span style="color:#B392F0;">&quot;ts&quot;</span><span style="color:#79B8FF;">:</span><span style="color:#B392F0;">&quot;2021-06-23T09:20:00.826+0800&quot;</span><span style="color:#B392F0;">,</span><span style="color:#B392F0;">&quot;logger&quot;</span><span style="color:#79B8FF;">:</span><span style="color:#B392F0;">&quot;etcd-client&quot;</span><span style="color:#B392F0;">,</span><span style="color:#B392F0;">&quot;caller&quot;</span><span style="color:#79B8FF;">:</span><span style="color:#B392F0;">&quot;v3/retry_interceptor.go:62&quot;</span><span style="color:#B392F0;">,</span><span style="color:#B392F0;">&quot;msg&quot;</span><span style="color:#79B8FF;">:</span><span style="color:#B392F0;">&quot;retrying of unary invoker failed&quot;</span><span style="color:#B392F0;">,</span><span style="color:#B392F0;">&quot;target&quot;</span><span style="color:#79B8FF;">:</span><span style="color:#B392F0;">&quot;etcd-endpoints://0xc0003fea80/#initially=[192.168.210.15:2379;192.168.210.81:2379;192.168.210.33:2379]&quot;</span><span style="color:#B392F0;">,</span><span style="color:#B392F0;">&quot;attempt&quot;</span><span style="color:#B392F0;">:0,</span><span style="color:#B392F0;">&quot;error&quot;</span><span style="color:#79B8FF;">:</span><span style="color:#B392F0;">&quot;rpc error: code = DeadlineExceeded desc = latest balancer error: last connection error: connection error: desc = </span><span style="color:#79B8FF;">\\&quot;</span><span style="color:#B392F0;">transport: Error while dialing dial tcp 192.168.210.81:2379: connect: connection refused</span><span style="color:#79B8FF;">\\&quot;</span><span style="color:#B392F0;">&quot;</span><span style="color:#B392F0;">}</span></span>
<span class="line"><span style="color:#B392F0;">Failed</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">to</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">get</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">the</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">status</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">of</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">endpoint</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">192.168</span><span style="color:#9ECBFF;">.210.81:2379</span><span style="color:#E1E4E8;"> (context </span><span style="color:#9ECBFF;">deadline</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">exceeded</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#B392F0;">+---------------------+------------------+---------+---------+-----------+------------+-----------+------------+--------------------+--------+</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">      </span><span style="color:#B392F0;">ENDPOINT</span><span style="color:#E1E4E8;">       </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">        </span><span style="color:#B392F0;">ID</span><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">VERSION</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">DB</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">SIZE</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">IS</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">LEADER</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">IS</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">LEARNER</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">RAFT</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">TERM</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">RAFT</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">INDEX</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">RAFT</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">APPLIED</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">INDEX</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">ERRORS</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#B392F0;">+---------------------+------------------+---------+---------+-----------+------------+-----------+------------+--------------------+--------+</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">192.168.210.15:2379</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">2baa1a77ec379977</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">   </span><span style="color:#B392F0;">3.5.0</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">1.0</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">MB</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">     </span><span style="color:#79B8FF;">false</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">      </span><span style="color:#79B8FF;">false</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">        </span><span style="color:#B392F0;">16</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">       </span><span style="color:#B392F0;">4867</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">               </span><span style="color:#B392F0;">4867</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">192.168.210.33:2379</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">b5d9c4826815356e</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">   </span><span style="color:#B392F0;">3.5.0</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">1.0</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">MB</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">      </span><span style="color:#79B8FF;">true</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">      </span><span style="color:#79B8FF;">false</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">        </span><span style="color:#B392F0;">16</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">       </span><span style="color:#B392F0;">4867</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">               </span><span style="color:#B392F0;">4867</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#B392F0;">+---------------------+------------------+---------+---------+-----------+------------+-----------+------------+--------------------+--------+</span></span>
<span class="line"><span style="color:#E1E4E8;">[root@pg_node1 </span><span style="color:#F97583;">~</span><span style="color:#E1E4E8;">]# etcdctl endpoint status --endpoints=</span><span style="color:#9ECBFF;">&#39;192.168.210.15:2379,192.168.210.81:2379,192.168.210.33:2379&#39;</span><span style="color:#E1E4E8;"> -w table</span></span>
<span class="line"><span style="color:#E1E4E8;">{</span><span style="color:#B392F0;">&quot;level&quot;</span><span style="color:#79B8FF;">:</span><span style="color:#B392F0;">&quot;warn&quot;</span><span style="color:#B392F0;">,</span><span style="color:#B392F0;">&quot;ts&quot;</span><span style="color:#79B8FF;">:</span><span style="color:#B392F0;">&quot;2021-06-23T09:16:37.350+0800&quot;</span><span style="color:#B392F0;">,</span><span style="color:#B392F0;">&quot;logger&quot;</span><span style="color:#79B8FF;">:</span><span style="color:#B392F0;">&quot;etcd-client&quot;</span><span style="color:#B392F0;">,</span><span style="color:#B392F0;">&quot;caller&quot;</span><span style="color:#79B8FF;">:</span><span style="color:#B392F0;">&quot;v3/retry_interceptor.go:62&quot;</span><span style="color:#B392F0;">,</span><span style="color:#B392F0;">&quot;msg&quot;</span><span style="color:#79B8FF;">:</span><span style="color:#B392F0;">&quot;retrying of unary invoker failed&quot;</span><span style="color:#B392F0;">,</span><span style="color:#B392F0;">&quot;target&quot;</span><span style="color:#79B8FF;">:</span><span style="color:#B392F0;">&quot;etcd-endpoints://0xc00037c700/#initially=[192.168.210.15:2379;192.168.210.81:2379;192.168.210.33:2379]&quot;</span><span style="color:#B392F0;">,</span><span style="color:#B392F0;">&quot;attempt&quot;</span><span style="color:#B392F0;">:0,</span><span style="color:#B392F0;">&quot;error&quot;</span><span style="color:#79B8FF;">:</span><span style="color:#B392F0;">&quot;rpc error: code = DeadlineExceeded desc = latest balancer error: last connection error: connection error: desc = </span><span style="color:#79B8FF;">\\&quot;</span><span style="color:#B392F0;">transport: Error while dialing dial tcp 192.168.210.81:2379: connect: connection refused</span><span style="color:#79B8FF;">\\&quot;</span><span style="color:#B392F0;">&quot;</span><span style="color:#B392F0;">}</span></span>
<span class="line"><span style="color:#B392F0;">Failed</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">to</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">get</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">the</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">status</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">of</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">endpoint</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">192.168</span><span style="color:#9ECBFF;">.210.81:2379</span><span style="color:#E1E4E8;"> (context </span><span style="color:#9ECBFF;">deadline</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">exceeded</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#B392F0;">+---------------------+------------------+---------+---------+-----------+------------+-----------+------------+--------------------+--------+</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">      </span><span style="color:#B392F0;">ENDPOINT</span><span style="color:#E1E4E8;">       </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">        </span><span style="color:#B392F0;">ID</span><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">VERSION</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">DB</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">SIZE</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">IS</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">LEADER</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">IS</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">LEARNER</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">RAFT</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">TERM</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">RAFT</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">INDEX</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">RAFT</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">APPLIED</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">INDEX</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">ERRORS</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#B392F0;">+---------------------+------------------+---------+---------+-----------+------------+-----------+------------+--------------------+--------+</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">192.168.210.15:2379</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">2baa1a77ec379977</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">   </span><span style="color:#B392F0;">3.5.0</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">1.0</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">MB</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">     </span><span style="color:#79B8FF;">false</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">      </span><span style="color:#79B8FF;">false</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">        </span><span style="color:#B392F0;">16</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">       </span><span style="color:#B392F0;">4867</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">               </span><span style="color:#B392F0;">4867</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">192.168.210.33:2379</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">b5d9c4826815356e</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">   </span><span style="color:#B392F0;">3.5.0</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">1.0</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">MB</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">      </span><span style="color:#79B8FF;">true</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">      </span><span style="color:#79B8FF;">false</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">        </span><span style="color:#B392F0;">16</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">       </span><span style="color:#B392F0;">4867</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">               </span><span style="color:#B392F0;">4867</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#B392F0;">+---------------------+------------------+---------+---------+-----------+------------+-----------+------------+--------------------+--------+</span></span>
<span class="line"><span style="color:#E1E4E8;">[root@pg_node3 </span><span style="color:#F97583;">~</span><span style="color:#E1E4E8;">]# etcdctl endpoint status --endpoints=</span><span style="color:#9ECBFF;">&#39;192.168.210.15:2379,192.168.210.81:2379,192.168.210.33:2379&#39;</span><span style="color:#E1E4E8;"> -w table</span></span>
<span class="line"><span style="color:#E1E4E8;">{</span><span style="color:#B392F0;">&quot;level&quot;</span><span style="color:#79B8FF;">:</span><span style="color:#B392F0;">&quot;warn&quot;</span><span style="color:#B392F0;">,</span><span style="color:#B392F0;">&quot;ts&quot;</span><span style="color:#79B8FF;">:</span><span style="color:#B392F0;">&quot;2021-06-23T09:20:39.338+0800&quot;</span><span style="color:#B392F0;">,</span><span style="color:#B392F0;">&quot;logger&quot;</span><span style="color:#79B8FF;">:</span><span style="color:#B392F0;">&quot;etcd-client&quot;</span><span style="color:#B392F0;">,</span><span style="color:#B392F0;">&quot;caller&quot;</span><span style="color:#79B8FF;">:</span><span style="color:#B392F0;">&quot;v3/retry_interceptor.go:62&quot;</span><span style="color:#B392F0;">,</span><span style="color:#B392F0;">&quot;msg&quot;</span><span style="color:#79B8FF;">:</span><span style="color:#B392F0;">&quot;retrying of unary invoker failed&quot;</span><span style="color:#B392F0;">,</span><span style="color:#B392F0;">&quot;target&quot;</span><span style="color:#79B8FF;">:</span><span style="color:#B392F0;">&quot;etcd-endpoints://0xc00013a380/#initially=[192.168.210.15:2379;192.168.210.81:2379;192.168.210.33:2379]&quot;</span><span style="color:#B392F0;">,</span><span style="color:#B392F0;">&quot;attempt&quot;</span><span style="color:#B392F0;">:0,</span><span style="color:#B392F0;">&quot;error&quot;</span><span style="color:#79B8FF;">:</span><span style="color:#B392F0;">&quot;rpc error: code = DeadlineExceeded desc = latest balancer error: last connection error: connection error: desc = </span><span style="color:#79B8FF;">\\&quot;</span><span style="color:#B392F0;">transport: Error while dialing dial tcp 192.168.210.81:2379: connect: connection refused</span><span style="color:#79B8FF;">\\&quot;</span><span style="color:#B392F0;">&quot;</span><span style="color:#B392F0;">}</span></span>
<span class="line"><span style="color:#B392F0;">Failed</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">to</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">get</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">the</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">status</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">of</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">endpoint</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">192.168</span><span style="color:#9ECBFF;">.210.81:2379</span><span style="color:#E1E4E8;"> (context </span><span style="color:#9ECBFF;">deadline</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">exceeded</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#B392F0;">+---------------------+------------------+---------+---------+-----------+------------+-----------+------------+--------------------+--------+</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">      </span><span style="color:#B392F0;">ENDPOINT</span><span style="color:#E1E4E8;">       </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">        </span><span style="color:#B392F0;">ID</span><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">VERSION</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">DB</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">SIZE</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">IS</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">LEADER</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">IS</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">LEARNER</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">RAFT</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">TERM</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">RAFT</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">INDEX</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">RAFT</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">APPLIED</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">INDEX</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">ERRORS</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#B392F0;">+---------------------+------------------+---------+---------+-----------+------------+-----------+------------+--------------------+--------+</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">192.168.210.15:2379</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">2baa1a77ec379977</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">   </span><span style="color:#B392F0;">3.5.0</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">1.0</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">MB</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">     </span><span style="color:#79B8FF;">false</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">      </span><span style="color:#79B8FF;">false</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">        </span><span style="color:#B392F0;">16</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">       </span><span style="color:#B392F0;">4867</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">               </span><span style="color:#B392F0;">4867</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">192.168.210.33:2379</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">b5d9c4826815356e</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">   </span><span style="color:#B392F0;">3.5.0</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">1.0</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">MB</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">      </span><span style="color:#79B8FF;">true</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">      </span><span style="color:#79B8FF;">false</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">        </span><span style="color:#B392F0;">16</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">       </span><span style="color:#B392F0;">4867</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">               </span><span style="color:#B392F0;">4867</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#B392F0;">+---------------------+------------------+---------+---------+-----------+------------+-----------+------------+--------------------+--------+</span></span>
<span class="line"><span style="color:#6A737D;">#从以上信息可以看到，etcd已重新选举了LEADER，pg_node2节点已拒绝连接</span></span>
<span class="line"><span style="color:#6A737D;">#下面再次启动pg_node2节点的etcd，节点加入集群</span></span>
<span class="line"><span style="color:#E1E4E8;">[root@pg_node2 </span><span style="color:#F97583;">~</span><span style="color:#E1E4E8;">]# systemctl start etcd</span></span>
<span class="line"><span style="color:#E1E4E8;">[root@pg_node2 </span><span style="color:#F97583;">~</span><span style="color:#E1E4E8;">]# etcdctl endpoint status --endpoints=</span><span style="color:#9ECBFF;">&#39;192.168.210.15:2379,192.168.210.81:2379,192.168.210.33:2379&#39;</span><span style="color:#E1E4E8;"> -w table</span></span>
<span class="line"><span style="color:#B392F0;">+---------------------+------------------+---------+---------+-----------+------------+-----------+------------+--------------------+--------+</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">      </span><span style="color:#B392F0;">ENDPOINT</span><span style="color:#E1E4E8;">       </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">        </span><span style="color:#B392F0;">ID</span><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">VERSION</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">DB</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">SIZE</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">IS</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">LEADER</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">IS</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">LEARNER</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">RAFT</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">TERM</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">RAFT</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">INDEX</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">RAFT</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">APPLIED</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">INDEX</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">ERRORS</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#B392F0;">+---------------------+------------------+---------+---------+-----------+------------+-----------+------------+--------------------+--------+</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">192.168.210.15:2379</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">2baa1a77ec379977</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">   </span><span style="color:#B392F0;">3.5.0</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">1.0</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">MB</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">     </span><span style="color:#79B8FF;">false</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">      </span><span style="color:#79B8FF;">false</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">        </span><span style="color:#B392F0;">16</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">       </span><span style="color:#B392F0;">4868</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">               </span><span style="color:#B392F0;">4868</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">192.168.210.81:2379</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">ff5595d67d21105</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">   </span><span style="color:#B392F0;">3.5.0</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">1.0</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">MB</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">     </span><span style="color:#79B8FF;">false</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">      </span><span style="color:#79B8FF;">false</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">        </span><span style="color:#B392F0;">16</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">       </span><span style="color:#B392F0;">4868</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">               </span><span style="color:#B392F0;">4868</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">192.168.210.33:2379</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">b5d9c4826815356e</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">   </span><span style="color:#B392F0;">3.5.0</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">1.0</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">MB</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">      </span><span style="color:#79B8FF;">true</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">      </span><span style="color:#79B8FF;">false</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">        </span><span style="color:#B392F0;">16</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">       </span><span style="color:#B392F0;">4868</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">               </span><span style="color:#B392F0;">4868</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#B392F0;">+---------------------+------------------+---------+---------+-----------+------------+-----------+------------+--------------------+--------+</span></span>
<span class="line"><span style="color:#E1E4E8;">[root@pg_node1 </span><span style="color:#F97583;">~</span><span style="color:#E1E4E8;">]# etcdctl endpoint status --endpoints=</span><span style="color:#9ECBFF;">&#39;192.168.210.15:2379,192.168.210.81:2379,192.168.210.33:2379&#39;</span><span style="color:#E1E4E8;"> -w table</span></span>
<span class="line"><span style="color:#B392F0;">+---------------------+------------------+---------+---------+-----------+------------+-----------+------------+--------------------+--------+</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">      </span><span style="color:#B392F0;">ENDPOINT</span><span style="color:#E1E4E8;">       </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">        </span><span style="color:#B392F0;">ID</span><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">VERSION</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">DB</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">SIZE</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">IS</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">LEADER</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">IS</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">LEARNER</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">RAFT</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">TERM</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">RAFT</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">INDEX</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">RAFT</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">APPLIED</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">INDEX</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">ERRORS</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#B392F0;">+---------------------+------------------+---------+---------+-----------+------------+-----------+------------+--------------------+--------+</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">192.168.210.15:2379</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">2baa1a77ec379977</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">   </span><span style="color:#B392F0;">3.5.0</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">1.0</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">MB</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">     </span><span style="color:#79B8FF;">false</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">      </span><span style="color:#79B8FF;">false</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">        </span><span style="color:#B392F0;">16</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">       </span><span style="color:#B392F0;">4868</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">               </span><span style="color:#B392F0;">4868</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">192.168.210.81:2379</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">ff5595d67d21105</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">   </span><span style="color:#B392F0;">3.5.0</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">1.0</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">MB</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">     </span><span style="color:#79B8FF;">false</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">      </span><span style="color:#79B8FF;">false</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">        </span><span style="color:#B392F0;">16</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">       </span><span style="color:#B392F0;">4868</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">               </span><span style="color:#B392F0;">4868</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">192.168.210.33:2379</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">b5d9c4826815356e</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">   </span><span style="color:#B392F0;">3.5.0</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">1.0</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">MB</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">      </span><span style="color:#79B8FF;">true</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">      </span><span style="color:#79B8FF;">false</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">        </span><span style="color:#B392F0;">16</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">       </span><span style="color:#B392F0;">4868</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">               </span><span style="color:#B392F0;">4868</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#B392F0;">+---------------------+------------------+---------+---------+-----------+------------+-----------+------------+--------------------+--------+</span></span>
<span class="line"><span style="color:#E1E4E8;">[root@pg_node3 </span><span style="color:#F97583;">~</span><span style="color:#E1E4E8;">]# etcdctl endpoint status --endpoints=</span><span style="color:#9ECBFF;">&#39;192.168.210.15:2379,192.168.210.81:2379,192.168.210.33:2379&#39;</span><span style="color:#E1E4E8;"> -w table</span></span>
<span class="line"><span style="color:#B392F0;">+---------------------+------------------+---------+---------+-----------+------------+-----------+------------+--------------------+--------+</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">      </span><span style="color:#B392F0;">ENDPOINT</span><span style="color:#E1E4E8;">       </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">        </span><span style="color:#B392F0;">ID</span><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">VERSION</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">DB</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">SIZE</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">IS</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">LEADER</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">IS</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">LEARNER</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">RAFT</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">TERM</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">RAFT</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">INDEX</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">RAFT</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">APPLIED</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">INDEX</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">ERRORS</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#B392F0;">+---------------------+------------------+---------+---------+-----------+------------+-----------+------------+--------------------+--------+</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">192.168.210.15:2379</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">2baa1a77ec379977</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">   </span><span style="color:#B392F0;">3.5.0</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">1.0</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">MB</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">     </span><span style="color:#79B8FF;">false</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">      </span><span style="color:#79B8FF;">false</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">        </span><span style="color:#B392F0;">16</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">       </span><span style="color:#B392F0;">4868</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">               </span><span style="color:#B392F0;">4868</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">192.168.210.81:2379</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">ff5595d67d21105</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">   </span><span style="color:#B392F0;">3.5.0</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">1.0</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">MB</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">     </span><span style="color:#79B8FF;">false</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">      </span><span style="color:#79B8FF;">false</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">        </span><span style="color:#B392F0;">16</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">       </span><span style="color:#B392F0;">4868</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">               </span><span style="color:#B392F0;">4868</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">192.168.210.33:2379</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">b5d9c4826815356e</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">   </span><span style="color:#B392F0;">3.5.0</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">1.0</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">MB</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">      </span><span style="color:#79B8FF;">true</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">      </span><span style="color:#79B8FF;">false</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">        </span><span style="color:#B392F0;">16</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">       </span><span style="color:#B392F0;">4868</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">               </span><span style="color:#B392F0;">4868</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#B392F0;">+---------------------+------------------+---------+---------+-----------+------------+-----------+------------+--------------------+--------+</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#模拟etcd节点出现问题，停掉任意2个etcd节点</span></span>
<span class="line"><span style="color:#E1E4E8;">[root@pg_node2 </span><span style="color:#F97583;">~</span><span style="color:#E1E4E8;">]# systemctl stop etcd</span></span>
<span class="line"><span style="color:#E1E4E8;">[root@pg_node2 </span><span style="color:#F97583;">~</span><span style="color:#E1E4E8;">]# etcdctl endpoint status --endpoints=</span><span style="color:#9ECBFF;">&#39;192.168.210.15:2379,192.168.210.81:2379,192.168.210.33:2379&#39;</span><span style="color:#E1E4E8;"> -w table</span></span>
<span class="line"><span style="color:#E1E4E8;">{</span><span style="color:#B392F0;">&quot;level&quot;</span><span style="color:#79B8FF;">:</span><span style="color:#B392F0;">&quot;warn&quot;</span><span style="color:#B392F0;">,</span><span style="color:#B392F0;">&quot;ts&quot;</span><span style="color:#79B8FF;">:</span><span style="color:#B392F0;">&quot;2021-06-23T09:20:00.826+0800&quot;</span><span style="color:#B392F0;">,</span><span style="color:#B392F0;">&quot;logger&quot;</span><span style="color:#79B8FF;">:</span><span style="color:#B392F0;">&quot;etcd-client&quot;</span><span style="color:#B392F0;">,</span><span style="color:#B392F0;">&quot;caller&quot;</span><span style="color:#79B8FF;">:</span><span style="color:#B392F0;">&quot;v3/retry_interceptor.go:62&quot;</span><span style="color:#B392F0;">,</span><span style="color:#B392F0;">&quot;msg&quot;</span><span style="color:#79B8FF;">:</span><span style="color:#B392F0;">&quot;retrying of unary invoker failed&quot;</span><span style="color:#B392F0;">,</span><span style="color:#B392F0;">&quot;target&quot;</span><span style="color:#79B8FF;">:</span><span style="color:#B392F0;">&quot;etcd-endpoints://0xc0003fea80/#initially=[192.168.210.15:2379;192.168.210.81:2379;192.168.210.33:2379]&quot;</span><span style="color:#B392F0;">,</span><span style="color:#B392F0;">&quot;attempt&quot;</span><span style="color:#B392F0;">:0,</span><span style="color:#B392F0;">&quot;error&quot;</span><span style="color:#79B8FF;">:</span><span style="color:#B392F0;">&quot;rpc error: code = DeadlineExceeded desc = latest balancer error: last connection error: connection error: desc = </span><span style="color:#79B8FF;">\\&quot;</span><span style="color:#B392F0;">transport: Error while dialing dial tcp 192.168.210.81:2379: connect: connection refused</span><span style="color:#79B8FF;">\\&quot;</span><span style="color:#B392F0;">&quot;</span><span style="color:#B392F0;">}</span></span>
<span class="line"><span style="color:#B392F0;">Failed</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">to</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">get</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">the</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">status</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">of</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">endpoint</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">192.168</span><span style="color:#9ECBFF;">.210.81:2379</span><span style="color:#E1E4E8;"> (context </span><span style="color:#9ECBFF;">deadline</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">exceeded</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#B392F0;">+---------------------+------------------+---------+---------+-----------+------------+-----------+------------+--------------------+--------+</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">      </span><span style="color:#B392F0;">ENDPOINT</span><span style="color:#E1E4E8;">       </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">        </span><span style="color:#B392F0;">ID</span><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">VERSION</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">DB</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">SIZE</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">IS</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">LEADER</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">IS</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">LEARNER</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">RAFT</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">TERM</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">RAFT</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">INDEX</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">RAFT</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">APPLIED</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">INDEX</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">ERRORS</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#B392F0;">+---------------------+------------------+---------+---------+-----------+------------+-----------+------------+--------------------+--------+</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">192.168.210.15:2379</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">2baa1a77ec379977</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">   </span><span style="color:#B392F0;">3.5.0</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">1.0</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">MB</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">     </span><span style="color:#79B8FF;">false</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">      </span><span style="color:#79B8FF;">false</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">        </span><span style="color:#B392F0;">16</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">       </span><span style="color:#B392F0;">4867</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">               </span><span style="color:#B392F0;">4867</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">192.168.210.33:2379</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">b5d9c4826815356e</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">   </span><span style="color:#B392F0;">3.5.0</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">1.0</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">MB</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">      </span><span style="color:#79B8FF;">true</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">      </span><span style="color:#79B8FF;">false</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">        </span><span style="color:#B392F0;">16</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">       </span><span style="color:#B392F0;">4867</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">               </span><span style="color:#B392F0;">4867</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#B392F0;">+---------------------+------------------+---------+---------+-----------+------------+-----------+------------+--------------------+--------+</span></span>
<span class="line"><span style="color:#E1E4E8;">[root@pg_node3 </span><span style="color:#F97583;">~</span><span style="color:#E1E4E8;">]# systemctl stop etcd</span></span>
<span class="line"><span style="color:#E1E4E8;">[root@pg_node3 </span><span style="color:#F97583;">~</span><span style="color:#E1E4E8;">]# etcdctl endpoint status --endpoints=</span><span style="color:#9ECBFF;">&#39;192.168.210.15:2379,192.168.210.81:2379,192.168.210.33:2379&#39;</span><span style="color:#E1E4E8;"> -w table</span></span>
<span class="line"><span style="color:#E1E4E8;">{</span><span style="color:#B392F0;">&quot;level&quot;</span><span style="color:#79B8FF;">:</span><span style="color:#B392F0;">&quot;warn&quot;</span><span style="color:#B392F0;">,</span><span style="color:#B392F0;">&quot;ts&quot;</span><span style="color:#79B8FF;">:</span><span style="color:#B392F0;">&quot;2021-06-23T09:27:22.438+0800&quot;</span><span style="color:#B392F0;">,</span><span style="color:#B392F0;">&quot;logger&quot;</span><span style="color:#79B8FF;">:</span><span style="color:#B392F0;">&quot;etcd-client&quot;</span><span style="color:#B392F0;">,</span><span style="color:#B392F0;">&quot;caller&quot;</span><span style="color:#79B8FF;">:</span><span style="color:#B392F0;">&quot;v3/retry_interceptor.go:62&quot;</span><span style="color:#B392F0;">,</span><span style="color:#B392F0;">&quot;msg&quot;</span><span style="color:#79B8FF;">:</span><span style="color:#B392F0;">&quot;retrying of unary invoker failed&quot;</span><span style="color:#B392F0;">,</span><span style="color:#B392F0;">&quot;target&quot;</span><span style="color:#79B8FF;">:</span><span style="color:#B392F0;">&quot;etcd-endpoints://0xc000150000/#initially=[192.168.210.15:2379;192.168.210.81:2379;192.168.210.33:2379]&quot;</span><span style="color:#B392F0;">,</span><span style="color:#B392F0;">&quot;attempt&quot;</span><span style="color:#B392F0;">:0,</span><span style="color:#B392F0;">&quot;error&quot;</span><span style="color:#79B8FF;">:</span><span style="color:#B392F0;">&quot;rpc error: code = DeadlineExceeded desc = latest balancer error: last connection error: connection error: desc = </span><span style="color:#79B8FF;">\\&quot;</span><span style="color:#B392F0;">transport: Error while dialing dial tcp 192.168.210.81:2379: connect: connection refused</span><span style="color:#79B8FF;">\\&quot;</span><span style="color:#B392F0;">&quot;</span><span style="color:#B392F0;">}</span></span>
<span class="line"><span style="color:#B392F0;">Failed</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">to</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">get</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">the</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">status</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">of</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">endpoint</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">192.168</span><span style="color:#9ECBFF;">.210.81:2379</span><span style="color:#E1E4E8;"> (context </span><span style="color:#9ECBFF;">deadline</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">exceeded</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">{</span><span style="color:#B392F0;">&quot;level&quot;</span><span style="color:#79B8FF;">:</span><span style="color:#B392F0;">&quot;warn&quot;</span><span style="color:#B392F0;">,</span><span style="color:#B392F0;">&quot;ts&quot;</span><span style="color:#79B8FF;">:</span><span style="color:#B392F0;">&quot;2021-06-23T09:27:27.439+0800&quot;</span><span style="color:#B392F0;">,</span><span style="color:#B392F0;">&quot;logger&quot;</span><span style="color:#79B8FF;">:</span><span style="color:#B392F0;">&quot;etcd-client&quot;</span><span style="color:#B392F0;">,</span><span style="color:#B392F0;">&quot;caller&quot;</span><span style="color:#79B8FF;">:</span><span style="color:#B392F0;">&quot;v3/retry_interceptor.go:62&quot;</span><span style="color:#B392F0;">,</span><span style="color:#B392F0;">&quot;msg&quot;</span><span style="color:#79B8FF;">:</span><span style="color:#B392F0;">&quot;retrying of unary invoker failed&quot;</span><span style="color:#B392F0;">,</span><span style="color:#B392F0;">&quot;target&quot;</span><span style="color:#79B8FF;">:</span><span style="color:#B392F0;">&quot;etcd-endpoints://0xc000150000/#initially=[192.168.210.15:2379;192.168.210.81:2379;192.168.210.33:2379]&quot;</span><span style="color:#B392F0;">,</span><span style="color:#B392F0;">&quot;attempt&quot;</span><span style="color:#B392F0;">:0,</span><span style="color:#B392F0;">&quot;error&quot;</span><span style="color:#79B8FF;">:</span><span style="color:#B392F0;">&quot;rpc error: code = DeadlineExceeded desc = latest balancer error: last connection error: connection error: desc = </span><span style="color:#79B8FF;">\\&quot;</span><span style="color:#B392F0;">transport: Error while dialing dial tcp 192.168.210.33:2379: connect: connection refused</span><span style="color:#79B8FF;">\\&quot;</span><span style="color:#B392F0;">&quot;</span><span style="color:#B392F0;">}</span></span>
<span class="line"><span style="color:#B392F0;">Failed</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">to</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">get</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">the</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">status</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">of</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">endpoint</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">192.168</span><span style="color:#9ECBFF;">.210.33:2379</span><span style="color:#E1E4E8;"> (context </span><span style="color:#9ECBFF;">deadline</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">exceeded</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#B392F0;">+---------------------+------------------+---------+---------+-----------+------------+-----------+------------+--------------------+-----------------------+</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">      </span><span style="color:#B392F0;">ENDPOINT</span><span style="color:#E1E4E8;">       </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">        </span><span style="color:#B392F0;">ID</span><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">VERSION</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">DB</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">SIZE</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">IS</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">LEADER</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">IS</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">LEARNER</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">RAFT</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">TERM</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">RAFT</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">INDEX</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">RAFT</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">APPLIED</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">INDEX</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">        </span><span style="color:#B392F0;">ERRORS</span><span style="color:#E1E4E8;">         </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#B392F0;">+---------------------+------------------+---------+---------+-----------+------------+-----------+------------+--------------------+-----------------------+</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">192.168.210.15:2379</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">2baa1a77ec379977</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">   </span><span style="color:#B392F0;">3.5.0</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">1.0</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">MB</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">     </span><span style="color:#79B8FF;">false</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">      </span><span style="color:#79B8FF;">false</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">        </span><span style="color:#B392F0;">17</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">       </span><span style="color:#B392F0;">4869</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">               </span><span style="color:#B392F0;">4869</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">etcdserver:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">no</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">leader</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#B392F0;">+---------------------+------------------+---------+---------+-----------+------------+-----------+------------+--------------------+-----------------------+</span></span>
<span class="line"><span style="color:#6A737D;">#从以上信息可以看到，停止3个中任意两个节点，etcd集群不再可用</span></span>
<span class="line"><span style="color:#6A737D;">#启动后集群恢复正常，健壮性非常强</span></span>
<span class="line"><span style="color:#E1E4E8;">[root@pg_node3 </span><span style="color:#F97583;">~</span><span style="color:#E1E4E8;">]# systemctl start etcd</span></span>
<span class="line"><span style="color:#E1E4E8;">[root@pg_node3 </span><span style="color:#F97583;">~</span><span style="color:#E1E4E8;">]# etcdctl endpoint status --endpoints=</span><span style="color:#9ECBFF;">&#39;192.168.210.15:2379,192.168.210.81:2379,192.168.210.33:2379&#39;</span><span style="color:#E1E4E8;"> -w table</span></span>
<span class="line"><span style="color:#E1E4E8;">{</span><span style="color:#B392F0;">&quot;level&quot;</span><span style="color:#79B8FF;">:</span><span style="color:#B392F0;">&quot;warn&quot;</span><span style="color:#B392F0;">,</span><span style="color:#B392F0;">&quot;ts&quot;</span><span style="color:#79B8FF;">:</span><span style="color:#B392F0;">&quot;2021-06-23T09:28:31.642+0800&quot;</span><span style="color:#B392F0;">,</span><span style="color:#B392F0;">&quot;logger&quot;</span><span style="color:#79B8FF;">:</span><span style="color:#B392F0;">&quot;etcd-client&quot;</span><span style="color:#B392F0;">,</span><span style="color:#B392F0;">&quot;caller&quot;</span><span style="color:#79B8FF;">:</span><span style="color:#B392F0;">&quot;v3/retry_interceptor.go:62&quot;</span><span style="color:#B392F0;">,</span><span style="color:#B392F0;">&quot;msg&quot;</span><span style="color:#79B8FF;">:</span><span style="color:#B392F0;">&quot;retrying of unary invoker failed&quot;</span><span style="color:#B392F0;">,</span><span style="color:#B392F0;">&quot;target&quot;</span><span style="color:#79B8FF;">:</span><span style="color:#B392F0;">&quot;etcd-endpoints://0xc000150a80/#initially=[192.168.210.15:2379;192.168.210.81:2379;192.168.210.33:2379]&quot;</span><span style="color:#B392F0;">,</span><span style="color:#B392F0;">&quot;attempt&quot;</span><span style="color:#B392F0;">:0,</span><span style="color:#B392F0;">&quot;error&quot;</span><span style="color:#79B8FF;">:</span><span style="color:#B392F0;">&quot;rpc error: code = DeadlineExceeded desc = latest balancer error: last connection error: connection error: desc = </span><span style="color:#79B8FF;">\\&quot;</span><span style="color:#B392F0;">transport: Error while dialing dial tcp 192.168.210.81:2379: connect: connection refused</span><span style="color:#79B8FF;">\\&quot;</span><span style="color:#B392F0;">&quot;</span><span style="color:#B392F0;">}</span></span>
<span class="line"><span style="color:#B392F0;">Failed</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">to</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">get</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">the</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">status</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">of</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">endpoint</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">192.168</span><span style="color:#9ECBFF;">.210.81:2379</span><span style="color:#E1E4E8;"> (context </span><span style="color:#9ECBFF;">deadline</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">exceeded</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#B392F0;">+---------------------+------------------+---------+---------+-----------+------------+-----------+------------+--------------------+--------+</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">      </span><span style="color:#B392F0;">ENDPOINT</span><span style="color:#E1E4E8;">       </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">        </span><span style="color:#B392F0;">ID</span><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">VERSION</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">DB</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">SIZE</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">IS</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">LEADER</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">IS</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">LEARNER</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">RAFT</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">TERM</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">RAFT</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">INDEX</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">RAFT</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">APPLIED</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">INDEX</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">ERRORS</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#B392F0;">+---------------------+------------------+---------+---------+-----------+------------+-----------+------------+--------------------+--------+</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">192.168.210.15:2379</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">2baa1a77ec379977</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">   </span><span style="color:#B392F0;">3.5.0</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">1.0</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">MB</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">      </span><span style="color:#79B8FF;">true</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">      </span><span style="color:#79B8FF;">false</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">        </span><span style="color:#B392F0;">18</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">       </span><span style="color:#B392F0;">4883</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">               </span><span style="color:#B392F0;">4883</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">192.168.210.33:2379</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">b5d9c4826815356e</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">   </span><span style="color:#B392F0;">3.5.0</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">1.0</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">MB</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">     </span><span style="color:#79B8FF;">false</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">      </span><span style="color:#79B8FF;">false</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">        </span><span style="color:#B392F0;">18</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">       </span><span style="color:#B392F0;">4883</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">               </span><span style="color:#B392F0;">4883</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#B392F0;">+---------------------+------------------+---------+---------+-----------+------------+-----------+------------+--------------------+--------+</span></span>
<span class="line"><span style="color:#E1E4E8;">[root@pg_node2 </span><span style="color:#F97583;">~</span><span style="color:#E1E4E8;">]# systemctl start etcd</span></span>
<span class="line"><span style="color:#E1E4E8;">[root@pg_node2 </span><span style="color:#F97583;">~</span><span style="color:#E1E4E8;">]# etcdctl endpoint status --endpoints=</span><span style="color:#9ECBFF;">&#39;192.168.210.15:2379,192.168.210.81:2379,192.168.210.33:2379&#39;</span><span style="color:#E1E4E8;"> -w table</span></span>
<span class="line"><span style="color:#B392F0;">+---------------------+------------------+---------+---------+-----------+------------+-----------+------------+--------------------+--------+</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">      </span><span style="color:#B392F0;">ENDPOINT</span><span style="color:#E1E4E8;">       </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">        </span><span style="color:#B392F0;">ID</span><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">VERSION</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">DB</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">SIZE</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">IS</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">LEADER</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">IS</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">LEARNER</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">RAFT</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">TERM</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">RAFT</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">INDEX</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">RAFT</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">APPLIED</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">INDEX</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">ERRORS</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#B392F0;">+---------------------+------------------+---------+---------+-----------+------------+-----------+------------+--------------------+--------+</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">192.168.210.15:2379</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">2baa1a77ec379977</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">   </span><span style="color:#B392F0;">3.5.0</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">1.0</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">MB</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">      </span><span style="color:#79B8FF;">true</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">      </span><span style="color:#79B8FF;">false</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">        </span><span style="color:#B392F0;">18</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">       </span><span style="color:#B392F0;">4888</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">               </span><span style="color:#B392F0;">4888</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">192.168.210.81:2379</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">ff5595d67d21105</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">   </span><span style="color:#B392F0;">3.5.0</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">1.0</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">MB</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">     </span><span style="color:#79B8FF;">false</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">      </span><span style="color:#79B8FF;">false</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">        </span><span style="color:#B392F0;">18</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">       </span><span style="color:#B392F0;">4888</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">               </span><span style="color:#B392F0;">4888</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">192.168.210.33:2379</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">b5d9c4826815356e</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">   </span><span style="color:#B392F0;">3.5.0</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">1.0</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">MB</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">     </span><span style="color:#79B8FF;">false</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">      </span><span style="color:#79B8FF;">false</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">        </span><span style="color:#B392F0;">18</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">       </span><span style="color:#B392F0;">4888</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">               </span><span style="color:#B392F0;">4888</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#B392F0;">+---------------------+------------------+---------+---------+-----------+------------+-----------+------------+--------------------+--------+</span></span>
<span class="line"><span style="color:#E1E4E8;">[root@pg_node1 </span><span style="color:#F97583;">~</span><span style="color:#E1E4E8;">]# etcdctl endpoint status --endpoints=</span><span style="color:#9ECBFF;">&#39;192.168.210.15:2379,192.168.210.81:2379,192.168.210.33:2379&#39;</span><span style="color:#E1E4E8;"> -w table</span></span>
<span class="line"><span style="color:#B392F0;">+---------------------+------------------+---------+---------+-----------+------------+-----------+------------+--------------------+--------+</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">      </span><span style="color:#B392F0;">ENDPOINT</span><span style="color:#E1E4E8;">       </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">        </span><span style="color:#B392F0;">ID</span><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">VERSION</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">DB</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">SIZE</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">IS</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">LEADER</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">IS</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">LEARNER</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">RAFT</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">TERM</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">RAFT</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">INDEX</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">RAFT</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">APPLIED</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">INDEX</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">ERRORS</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#B392F0;">+---------------------+------------------+---------+---------+-----------+------------+-----------+------------+--------------------+--------+</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">192.168.210.15:2379</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">2baa1a77ec379977</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">   </span><span style="color:#B392F0;">3.5.0</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">1.0</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">MB</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">      </span><span style="color:#79B8FF;">true</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">      </span><span style="color:#79B8FF;">false</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">        </span><span style="color:#B392F0;">19</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">       </span><span style="color:#B392F0;">4905</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">               </span><span style="color:#B392F0;">4905</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">192.168.210.81:2379</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">ff5595d67d21105</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">   </span><span style="color:#B392F0;">3.5.0</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">1.0</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">MB</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">     </span><span style="color:#79B8FF;">false</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">      </span><span style="color:#79B8FF;">false</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">        </span><span style="color:#B392F0;">19</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">       </span><span style="color:#B392F0;">4905</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">               </span><span style="color:#B392F0;">4905</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">192.168.210.33:2379</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">b5d9c4826815356e</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">   </span><span style="color:#B392F0;">3.5.0</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">1.0</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">MB</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">     </span><span style="color:#79B8FF;">false</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">      </span><span style="color:#79B8FF;">false</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">        </span><span style="color:#B392F0;">19</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">       </span><span style="color:#B392F0;">4905</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">               </span><span style="color:#B392F0;">4905</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#B392F0;">+---------------------+------------------+---------+---------+-----------+------------+-----------+------------+--------------------+--------+</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#模拟PostgreSQL数据库出现问题</span></span>
<span class="line"><span style="color:#6A737D;">#停止主库服务</span></span>
<span class="line"><span style="color:#E1E4E8;">[postgres@pg_node1 </span><span style="color:#F97583;">~</span><span style="color:#E1E4E8;">]$ pg_ctl stop -D /opt/PostgreSQL/13/data</span></span>
<span class="line"><span style="color:#B392F0;">waiting</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">for</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">server</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">to</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">shut</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">down....</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">done</span></span>
<span class="line"><span style="color:#B392F0;">server</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">stopped</span></span>
<span class="line"><span style="color:#E1E4E8;">[postgres@pg_node1 </span><span style="color:#F97583;">~</span><span style="color:#E1E4E8;">]$ ps -ef</span><span style="color:#F97583;">|</span><span style="color:#B392F0;">grep</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">postgres</span></span>
<span class="line"><span style="color:#B392F0;">postgres</span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">4447</span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">4367</span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:37</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pts/0</span><span style="color:#E1E4E8;">    </span><span style="color:#79B8FF;">00</span><span style="color:#9ECBFF;">:00:00</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">grep</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--color=auto</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">postgres</span></span>
<span class="line"><span style="color:#E1E4E8;">[postgres@pg_node1 </span><span style="color:#F97583;">~</span><span style="color:#E1E4E8;">]$ ps -ef</span><span style="color:#F97583;">|</span><span style="color:#B392F0;">grep</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">postgres</span></span>
<span class="line"><span style="color:#B392F0;">postgres</span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">4451</span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">4367</span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:37</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pts/0</span><span style="color:#E1E4E8;">    </span><span style="color:#79B8FF;">00</span><span style="color:#9ECBFF;">:00:00</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">grep</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--color=auto</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">postgres</span></span>
<span class="line"><span style="color:#E1E4E8;">[postgres@pg_node1 </span><span style="color:#F97583;">~</span><span style="color:#E1E4E8;">]$ ps -ef</span><span style="color:#F97583;">|</span><span style="color:#B392F0;">grep</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">postgres</span></span>
<span class="line"><span style="color:#B392F0;">postgres</span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">4453</span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">4367</span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:37</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pts/0</span><span style="color:#E1E4E8;">    </span><span style="color:#79B8FF;">00</span><span style="color:#9ECBFF;">:00:00</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">grep</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--color=auto</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">postgres</span></span>
<span class="line"><span style="color:#E1E4E8;">[postgres@pg_node1 </span><span style="color:#F97583;">~</span><span style="color:#E1E4E8;">]$ ps -ef</span><span style="color:#F97583;">|</span><span style="color:#B392F0;">grep</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">postgres</span></span>
<span class="line"><span style="color:#B392F0;">postgres</span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">4459</span><span style="color:#E1E4E8;">     </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:37</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">?</span><span style="color:#E1E4E8;">        </span><span style="color:#79B8FF;">00</span><span style="color:#9ECBFF;">:00:00</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/opt/PostgreSQL/13/bin/postgres</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-D</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/opt/PostgreSQL/13/data</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--config-file=/opt/PostgreSQL/13/data/postgresql.conf</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--listen_addresses=0.0.0.0</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--max_worker_processes=8</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--max_prepared_transactions=0</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--wal_level=replica</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--track_commit_timestamp=off</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--max_locks_per_transaction=64</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--port=5432</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--max_replication_slots=10</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--max_connections=100</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--hot_standby=on</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--cluster_name=twpg</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--wal_log_hints=on</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--max_wal_senders=10</span></span>
<span class="line"><span style="color:#B392F0;">postgres</span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">4462</span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">4459</span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:37</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">?</span><span style="color:#E1E4E8;">        </span><span style="color:#79B8FF;">00</span><span style="color:#9ECBFF;">:00:00</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">postgres:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">twpg:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">checkpointer</span><span style="color:#E1E4E8;"> </span></span>
<span class="line"><span style="color:#B392F0;">postgres</span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">4463</span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">4459</span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:37</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">?</span><span style="color:#E1E4E8;">        </span><span style="color:#79B8FF;">00</span><span style="color:#9ECBFF;">:00:00</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">postgres:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">twpg:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">background</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">writer</span><span style="color:#E1E4E8;"> </span></span>
<span class="line"><span style="color:#B392F0;">postgres</span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">4464</span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">4459</span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:37</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">?</span><span style="color:#E1E4E8;">        </span><span style="color:#79B8FF;">00</span><span style="color:#9ECBFF;">:00:00</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">postgres:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">twpg:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">stats</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">collector</span><span style="color:#E1E4E8;"> </span></span>
<span class="line"><span style="color:#B392F0;">postgres</span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">4472</span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">4459</span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:37</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">?</span><span style="color:#E1E4E8;">        </span><span style="color:#79B8FF;">00</span><span style="color:#9ECBFF;">:00:00</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">postgres:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">twpg:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">twsm</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">postgres</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">127.0</span><span style="color:#9ECBFF;">.0.1</span><span style="color:#E1E4E8;">(</span><span style="color:#B392F0;">40298</span><span style="color:#E1E4E8;">) </span><span style="color:#9ECBFF;">idle</span></span>
<span class="line"><span style="color:#B392F0;">postgres</span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">4487</span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">4459</span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:37</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">?</span><span style="color:#E1E4E8;">        </span><span style="color:#79B8FF;">00</span><span style="color:#9ECBFF;">:00:00</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">postgres:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">twpg:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">walwriter</span><span style="color:#E1E4E8;"> </span></span>
<span class="line"><span style="color:#B392F0;">postgres</span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">4488</span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">4459</span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:37</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">?</span><span style="color:#E1E4E8;">        </span><span style="color:#79B8FF;">00</span><span style="color:#9ECBFF;">:00:00</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">postgres:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">twpg:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">autovacuum</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">launcher</span><span style="color:#E1E4E8;"> </span></span>
<span class="line"><span style="color:#B392F0;">postgres</span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">4489</span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">4459</span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:37</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">?</span><span style="color:#E1E4E8;">        </span><span style="color:#79B8FF;">00</span><span style="color:#9ECBFF;">:00:00</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">postgres:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">twpg:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">logical</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">replication</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">launcher</span><span style="color:#E1E4E8;"> </span></span>
<span class="line"><span style="color:#B392F0;">postgres</span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">4490</span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">4459</span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:37</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">?</span><span style="color:#E1E4E8;">        </span><span style="color:#79B8FF;">00</span><span style="color:#9ECBFF;">:00:00</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">postgres:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">twpg:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">walsender</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">repuser</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">192.168</span><span style="color:#9ECBFF;">.210.33</span><span style="color:#E1E4E8;">(</span><span style="color:#B392F0;">52430</span><span style="color:#E1E4E8;">) </span><span style="color:#9ECBFF;">streaming</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0</span><span style="color:#9ECBFF;">/5000668</span></span>
<span class="line"><span style="color:#B392F0;">postgres</span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">4491</span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">4459</span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:37</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">?</span><span style="color:#E1E4E8;">        </span><span style="color:#79B8FF;">00</span><span style="color:#9ECBFF;">:00:00</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">postgres:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">twpg:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">walsender</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">repuser</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">192.168</span><span style="color:#9ECBFF;">.210.81</span><span style="color:#E1E4E8;">(</span><span style="color:#B392F0;">62184</span><span style="color:#E1E4E8;">) </span><span style="color:#9ECBFF;">streaming</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0</span><span style="color:#9ECBFF;">/5000668</span></span>
<span class="line"><span style="color:#6A737D;">#PostgreSQL服务被patroni自动拉起，未发生故障转移</span></span>
<span class="line"><span style="color:#E1E4E8;">[root@pg_node1 log]# patronictl -c /etc/patroni/patroni.yml list</span></span>
<span class="line"><span style="color:#B392F0;">+</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Cluster:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">twpg</span><span style="color:#E1E4E8;"> (6976142033405049133) ---+---------+----+-----------+</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Member</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Host</span><span style="color:#E1E4E8;">                </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Role</span><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">State</span><span style="color:#E1E4E8;">   </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">TL</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Lag</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">in</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">MB</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#B392F0;">+--------+---------------------+---------+---------+----+-----------+</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">pg1</span><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">192.168.210.15:5432</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Leader</span><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">running</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">6</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">           </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">pg2</span><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">192.168.210.81:5432</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Replica</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">running</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">6</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">       </span><span style="color:#B392F0;">0.0</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">pg3</span><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">192.168.210.33:5432</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Replica</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">running</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">6</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">       </span><span style="color:#B392F0;">0.0</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#B392F0;">+--------+---------------------+---------+---------+----+-----------+</span></span>
<span class="line"><span style="color:#6A737D;">#查看下刚刚停止PG服务后的patroni日志，patroni检测到PG服务关闭，会尝试把PG服务启动</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:37:45</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2021</span><span style="color:#9ECBFF;">-06-23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:37:45,395</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">INFO:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">no</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">action.</span><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">i</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">am</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">the</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">leader</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">with</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">the</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">lock</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:37:47</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2021</span><span style="color:#9ECBFF;">-06-23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:37:47.040</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">CST</span><span style="color:#E1E4E8;"> [4012] LOG:  received fast shutdown request</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:37:47</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2021</span><span style="color:#9ECBFF;">-06-23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:37:47.047</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">CST</span><span style="color:#E1E4E8;"> [4012] LOG:  aborting any active transactions</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:37:47</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2021</span><span style="color:#9ECBFF;">-06-23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:37:47.047</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">CST</span><span style="color:#E1E4E8;"> [4056] FATAL:  terminating connection due to administrator command</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:37:47</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2021</span><span style="color:#9ECBFF;">-06-23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:37:47.048</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">CST</span><span style="color:#E1E4E8;"> [4012] LOG:  background worker </span><span style="color:#9ECBFF;">&quot;logical replication launcher&quot;</span><span style="color:#E1E4E8;"> (</span><span style="color:#B392F0;">PID</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">4258</span><span style="color:#E1E4E8;">) exited with exit code 1</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:37:47</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2021</span><span style="color:#9ECBFF;">-06-23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:37:47.049</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">CST</span><span style="color:#E1E4E8;"> [4015] LOG:  shutting down</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:37:47</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2021</span><span style="color:#9ECBFF;">-06-23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:37:47.122</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">CST</span><span style="color:#E1E4E8;"> [4012] LOG:  database system is shut down</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:37:55</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2021</span><span style="color:#9ECBFF;">-06-23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:37:55,389</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">WARNING:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Postgresql</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">is</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">not</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">running.</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:37:55</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2021</span><span style="color:#9ECBFF;">-06-23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:37:55,390</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">INFO:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Lock</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">owner:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg1</span><span style="color:#E1E4E8;">; </span><span style="color:#B392F0;">I</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">am</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg1</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:37:55</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2021</span><span style="color:#9ECBFF;">-06-23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:37:55,404</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">INFO:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_controldata:</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:37:55</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Database</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">system</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">identifier:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">6976142033405049133</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:37:55</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_control</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">last</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">modified:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Wed</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:37:47</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2021</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:37:55</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Blocks</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">per</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">segment</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">of</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">large</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">relation:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">131072</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:37:55</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Size</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">of</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">a</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">large-object</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">chunk:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2048</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:37:55</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">WAL</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">block</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">size:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">8192</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:37:55</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Latest</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">checkpoint&#39;s oldestActiveXID: 0</span></span>
<span class="line"><span style="color:#9ECBFF;">Jun 23 09:37:55 pg_node1 patroni: Latest checkpoint&#39;s</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">TimeLineID:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:37:55</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Bytes</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">per</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">WAL</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">segment:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">16777216</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:37:55</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Fake</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">LSN</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">counter</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">for</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">unlogged</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">rels:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0</span><span style="color:#9ECBFF;">/3E8</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:37:55</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">max_connections</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">setting:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">100</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:37:55</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Latest</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">checkpoint</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">location:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0</span><span style="color:#9ECBFF;">/5000510</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:37:55</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Float8</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">argument</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">passing:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">by</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">value</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:37:55</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Minimum</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">recovery</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">ending</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">location:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0</span><span style="color:#9ECBFF;">/0</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:37:55</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">track_commit_timestamp</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">setting:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">off</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:37:55</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Latest</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">checkpoint&#39;s newestCommitTsXid: 0</span></span>
<span class="line"><span style="color:#9ECBFF;">Jun 23 09:37:55 pg_node1 patroni: Latest checkpoint&#39;s</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">NextMultiXactId:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">1</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:37:55</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Maximum</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">size</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">of</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">a</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">TOAST</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">chunk:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">1996</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:37:55</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Maximum</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">data</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">alignment:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">8</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:37:55</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Date/time</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">type</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">storage:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">64</span><span style="color:#9ECBFF;">-bit</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">integers</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:37:55</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Database</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">block</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">size:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">8192</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:37:55</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Data</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">page</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">checksum</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">version:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">1</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:37:55</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Time</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">of</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">latest</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">checkpoint:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Wed</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:37:47</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2021</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:37:55</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">wal_log_hints</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">setting:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">on</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:37:55</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Latest</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">checkpoint&#39;s full_page_writes: on</span></span>
<span class="line"><span style="color:#9ECBFF;">Jun 23 09:37:55 pg_node1 patroni: End-of-backup record required: no</span></span>
<span class="line"><span style="color:#9ECBFF;">Jun 23 09:37:55 pg_node1 patroni: max_prepared_xacts setting: 0</span></span>
<span class="line"><span style="color:#9ECBFF;">Jun 23 09:37:55 pg_node1 patroni: Latest checkpoint&#39;s</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">NextMultiOffset:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:37:55</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Backup</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">start</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">location:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0</span><span style="color:#9ECBFF;">/0</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:37:55</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Latest</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">checkpoint&#39;s oldestMultiXid: 1</span></span>
<span class="line"><span style="color:#9ECBFF;">Jun 23 09:37:55 pg_node1 patroni: Mock authentication nonce: 020ac2d0808d3cf471a8d90e23263e8a317b31c5f7e494fc3fba551683e5c39b</span></span>
<span class="line"><span style="color:#9ECBFF;">Jun 23 09:37:55 pg_node1 patroni: Latest checkpoint&#39;s</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">NextOID:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">16385</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:37:55</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Maximum</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">columns</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">in</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">an</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">index:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">32</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:37:55</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Latest</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">checkpoint&#39;s oldestXID: 479</span></span>
<span class="line"><span style="color:#9ECBFF;">Jun 23 09:37:55 pg_node1 patroni: Catalog version number: 202007201</span></span>
<span class="line"><span style="color:#9ECBFF;">Jun 23 09:37:55 pg_node1 patroni: max_worker_processes setting: 8</span></span>
<span class="line"><span style="color:#9ECBFF;">Jun 23 09:37:55 pg_node1 patroni: Maximum length of identifiers: 64</span></span>
<span class="line"><span style="color:#9ECBFF;">Jun 23 09:37:55 pg_node1 patroni: Min recovery ending loc&#39;s</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">timeline:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:37:55</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">max_locks_per_xact</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">setting:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">64</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:37:55</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">max_wal_senders</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">setting:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">10</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:37:55</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Latest</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">checkpoint&#39;s NextXID: 0:488</span></span>
<span class="line"><span style="color:#9ECBFF;">Jun 23 09:37:55 pg_node1 patroni: Latest checkpoint&#39;s</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">REDO</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">location:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0</span><span style="color:#9ECBFF;">/5000510</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:37:55</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Backup</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">end</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">location:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0</span><span style="color:#9ECBFF;">/0</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:37:55</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Database</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">cluster</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">state:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">shut</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">down</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:37:55</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_control</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">version</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">number:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">1300</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:37:55</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">wal_level</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">setting:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">replica</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:37:55</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Latest</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">checkpoint&#39;s REDO WAL file: 000000050000000000000005</span></span>
<span class="line"><span style="color:#9ECBFF;">Jun 23 09:37:55 pg_node1 patroni: Latest checkpoint&#39;s</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">oldestCommitTsXid:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:37:55</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Latest</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">checkpoint&#39;s oldestXID&#39;s</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">DB:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">1</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:37:55</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Latest</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">checkpoint&#39;s oldestMulti&#39;s</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">DB:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">1</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:37:55</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Latest</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">checkpoint&#39;s PrevTimeLineID: 5</span></span>
<span class="line"><span style="color:#9ECBFF;">Jun 23 09:37:55 pg_node1 patroni: 2021-06-23 09:37:55,406 INFO: Lock owner: pg1; I am pg1</span></span>
<span class="line"><span style="color:#9ECBFF;">Jun 23 09:37:55 pg_node1 patroni: 2021-06-23 09:37:55,406 INFO: Lock owner: pg1; I am pg1</span></span>
<span class="line"><span style="color:#9ECBFF;">Jun 23 09:37:55 pg_node1 patroni: 2021-06-23 09:37:55,418 INFO: starting as readonly because i had the session lock</span></span>
<span class="line"><span style="color:#9ECBFF;">Jun 23 09:37:55 pg_node1 patroni: 2021-06-23 09:37:55,420 INFO: closed patroni connection to the postgresql cluster</span></span>
<span class="line"><span style="color:#9ECBFF;">Jun 23 09:37:55 pg_node1 patroni: 2021-06-23 09:37:55,452 INFO: postmaster pid=4459</span></span>
<span class="line"><span style="color:#9ECBFF;">Jun 23 09:37:55 pg_node1 patroni: localhost:5432 - no response</span></span>
<span class="line"><span style="color:#9ECBFF;">Jun 23 09:37:55 pg_node1 patroni: 2021-06-23 09:37:55.485 CST [4459] LOG:  starting PostgreSQL 13.3 on x86_64-pc-linux-gnu, compiled by gcc (GCC) 4.8.5 20150623 (Red Hat 4.8.5-44), 64-bit</span></span>
<span class="line"><span style="color:#9ECBFF;">Jun 23 09:37:55 pg_node1 patroni: 2021-06-23 09:37:55.485 CST [4459] LOG:  listening on IPv4 address &quot;0.0.0.0&quot;, port 5432</span></span>
<span class="line"><span style="color:#9ECBFF;">Jun 23 09:37:55 pg_node1 patroni: 2021-06-23 09:37:55.508 CST [4459] LOG:  listening on Unix socket &quot;/tmp/.s.PGSQL.5432&quot;</span></span>
<span class="line"><span style="color:#9ECBFF;">Jun 23 09:37:55 pg_node1 patroni: 2021-06-23 09:37:55.524 CST [4461] LOG:  database system was shut down at 2021-06-23 09:37:47 CST</span></span>
<span class="line"><span style="color:#9ECBFF;">Jun 23 09:37:55 pg_node1 patroni: 2021-06-23 09:37:55.525 CST [4461] WARNING:  specified neither primary_conninfo nor restore_command</span></span>
<span class="line"><span style="color:#9ECBFF;">Jun 23 09:37:55 pg_node1 patroni: 2021-06-23 09:37:55.525 CST [4461] HINT:  The database server will regularly poll the pg_wal subdirectory to check for files placed there.</span></span>
<span class="line"><span style="color:#9ECBFF;">Jun 23 09:37:55 pg_node1 patroni: 2021-06-23 09:37:55.525 CST [4461] LOG:  entering standby mode</span></span>
<span class="line"><span style="color:#9ECBFF;">Jun 23 09:37:55 pg_node1 patroni: 2021-06-23 09:37:55.533 CST [4461] LOG:  consistent recovery state reached at 0/5000588</span></span>
<span class="line"><span style="color:#9ECBFF;">Jun 23 09:37:55 pg_node1 patroni: 2021-06-23 09:37:55.534 CST [4461] LOG:  invalid record length at 0/5000588: wanted 24, got 0</span></span>
<span class="line"><span style="color:#9ECBFF;">Jun 23 09:37:55 pg_node1 patroni: 2021-06-23 09:37:55.535 CST [4459] LOG:  database system is ready to accept read only connections</span></span>
<span class="line"><span style="color:#9ECBFF;">Jun 23 09:37:56 pg_node1 patroni: localhost:5432 - accepting connections</span></span>
<span class="line"><span style="color:#9ECBFF;">Jun 23 09:37:56 pg_node1 patroni: localhost:5432 - accepting connections</span></span>
<span class="line"><span style="color:#9ECBFF;">Jun 23 09:37:56 pg_node1 patroni: this is patroni callback on_role_change replica twpg</span></span>
<span class="line"><span style="color:#9ECBFF;">Jun 23 09:37:56 pg_node1 patroni: 2021-06-23 09:37:56,544 INFO: Lock owner: pg1; I am pg1</span></span>
<span class="line"><span style="color:#9ECBFF;">Jun 23 09:37:56 pg_node1 patroni: 2021-06-23 09:37:56,545 INFO: establishing a new patroni connection to the postgres cluster</span></span>
<span class="line"><span style="color:#9ECBFF;">Jun 23 09:37:56 pg_node1 systemd: Started Session c31 of user root.</span></span>
<span class="line"><span style="color:#9ECBFF;">Jun 23 09:37:56 pg_node1 patroni: 2021-06-23 09:37:56,570 INFO: Software Watchdog activated with 25 second timeout, timing slack 15 seconds</span></span>
<span class="line"><span style="color:#9ECBFF;">Jun 23 09:37:56 pg_node1 patroni: 2021-06-23 09:37:56,584 INFO: promoted self to leader because i had the session lock</span></span>
<span class="line"><span style="color:#9ECBFF;">Jun 23 09:37:56 pg_node1 patroni: 2021-06-23 09:37:56,586 INFO: Lock owner: pg1; I am pg1</span></span>
<span class="line"><span style="color:#9ECBFF;">Jun 23 09:37:56 pg_node1 patroni: server promoting</span></span>
<span class="line"><span style="color:#9ECBFF;">Jun 23 09:37:56 pg_node1 patroni: 2021-06-23 09:37:56.593 CST [4461] LOG:  received promote request</span></span>
<span class="line"><span style="color:#9ECBFF;">Jun 23 09:37:56 pg_node1 patroni: 2021-06-23 09:37:56.593 CST [4461] LOG:  redo is not required</span></span>
<span class="line"><span style="color:#9ECBFF;">Jun 23 09:37:56 pg_node1 patroni: 2021-06-23 09:37:56,593 INFO: cleared rewind state after becoming the leader</span></span>
<span class="line"><span style="color:#9ECBFF;">Jun 23 09:37:56 pg_node1 patroni: 2021-06-23 09:37:56.599 CST [4461] LOG:  selected new timeline ID: 6</span></span>
<span class="line"><span style="color:#9ECBFF;">Jun 23 09:37:56 pg_node1 patroni: this is patroni callback on_role_change master twpg</span></span>
<span class="line"><span style="color:#9ECBFF;">Jun 23 09:37:56 pg_node1 patroni: 2021-06-23 09:37:56,618 INFO: updated leader lock during promote</span></span>
<span class="line"><span style="color:#9ECBFF;">Jun 23 09:37:56 pg_node1 systemd: Started Session c32 of user root.</span></span>
<span class="line"><span style="color:#9ECBFF;">Jun 23 09:37:56 pg_node1 systemd: Started Session c33 of user root.</span></span>
<span class="line"><span style="color:#9ECBFF;">Jun 23 09:37:56 pg_node1 patroni: 2021-06-23 09:37:56.880 CST [4461] LOG:  archive recovery complete</span></span>
<span class="line"><span style="color:#9ECBFF;">Jun 23 09:37:56 pg_node1 patroni: 2021-06-23 09:37:56.911 CST [4459] LOG:  database system is ready to accept connections</span></span>
<span class="line"><span style="color:#9ECBFF;">Jun 23 09:37:57 pg_node1 patroni: 2021-06-23 09:37:57,638 INFO: Lock owner: pg1; I am pg1</span></span>
<span class="line"><span style="color:#9ECBFF;">Jun 23 09:37:57 pg_node1 patroni: 2021-06-23 09:37:57,724 INFO: no action.  i am the leader with the lock</span></span>
<span class="line"></span>
<span class="line"><span style="color:#9ECBFF;">#模拟PostgreSQL数据库出现问题</span></span>
<span class="line"><span style="color:#9ECBFF;">#停止备库服务</span></span>
<span class="line"><span style="color:#9ECBFF;">[postgres@pg_node2 ~]$ pg_ctl stop -D /opt/PostgreSQL/13/data</span></span>
<span class="line"><span style="color:#9ECBFF;">waiting for server to shut down.... done</span></span>
<span class="line"><span style="color:#9ECBFF;">server stopped</span></span>
<span class="line"><span style="color:#9ECBFF;">[postgres@pg_node2 ~]$ ps -ef|grep postgres</span></span>
<span class="line"><span style="color:#9ECBFF;">postgres 26277 26180  0 09:51 pts/0    00:00:00 grep --color=auto postgres</span></span>
<span class="line"><span style="color:#9ECBFF;">[postgres@pg_node2 ~]$ ps -ef|grep postgres</span></span>
<span class="line"><span style="color:#9ECBFF;">postgres 26284     1  2 09:51 ?        00:00:00 /opt/PostgreSQL/13/bin/postgres -D /opt/PostgreSQL/13/data --config-file=/opt/PostgreSQL/13/data/postgresql.conf --listen_addresses=0.0.0.0 --max_worker_processes=8 --max_prepared_transactions=0 --wal_level=replica --track_commit_timestamp=off --max_locks_per_transaction=64 --port=5432 --max_replication_slots=10 --max_connections=100 --hot_standby=on --cluster_name=twpg --wal_log_hints=on --max_wal_senders=10</span></span>
<span class="line"><span style="color:#9ECBFF;">postgres 26286 26284  0 09:51 ?        00:00:00 postgres: twpg: startup recovering 000000060000000000000005</span></span>
<span class="line"><span style="color:#9ECBFF;">postgres 26287 26284  0 09:51 ?        00:00:00 postgres: twpg: checkpointer </span></span>
<span class="line"><span style="color:#9ECBFF;">postgres 26288 26284  0 09:51 ?        00:00:00 postgres: twpg: background writer </span></span>
<span class="line"><span style="color:#9ECBFF;">postgres 26289 26284  0 09:51 ?        00:00:00 postgres: twpg: stats collector </span></span>
<span class="line"><span style="color:#9ECBFF;">postgres 26290 26284  0 09:51 ?        00:00:00 postgres: twpg: walreceiver </span></span>
<span class="line"><span style="color:#9ECBFF;">postgres 26293 26180  0 09:51 pts/0    00:00:00 grep --color=auto postgres</span></span>
<span class="line"><span style="color:#9ECBFF;">#查看下刚刚停止PG服务后的patroni日志，patroni检测到PG服务关闭，会尝试把PG服务启动</span></span>
<span class="line"><span style="color:#9ECBFF;">Jun 23 09:51:29 pg_node2 patroni: 2021-06-23 09:51:29,043 INFO: does not have lock</span></span>
<span class="line"><span style="color:#9ECBFF;">Jun 23 09:51:29 pg_node2 patroni: 2021-06-23 09:51:29,045 INFO: no action.  i am a secondary and i am following a leader</span></span>
<span class="line"><span style="color:#9ECBFF;">Jun 23 09:51:37 pg_node2 patroni: 2021-06-23 09:51:37.498 CST [26228] LOG:  received fast shutdown request</span></span>
<span class="line"><span style="color:#9ECBFF;">Jun 23 09:51:37 pg_node2 patroni: 2021-06-23 09:51:37.505 CST [26228] LOG:  aborting any active transactions</span></span>
<span class="line"><span style="color:#9ECBFF;">Jun 23 09:51:37 pg_node2 patroni: 2021-06-23 09:51:37.505 CST [26234] FATAL:  terminating walreceiver process due to administrator command</span></span>
<span class="line"><span style="color:#9ECBFF;">Jun 23 09:51:37 pg_node2 patroni: 2021-06-23 09:51:37.505 CST [26241] FATAL:  terminating connection due to administrator command</span></span>
<span class="line"><span style="color:#9ECBFF;">Jun 23 09:51:37 pg_node2 patroni: 2021-06-23 09:51:37.507 CST [26231] LOG:  shutting down</span></span>
<span class="line"><span style="color:#9ECBFF;">Jun 23 09:51:37 pg_node2 patroni: 2021-06-23 09:51:37.522 CST [26228] LOG:  database system is shut down</span></span>
<span class="line"><span style="color:#9ECBFF;">Jun 23 09:51:39 pg_node2 patroni: 2021-06-23 09:51:39,042 WARNING: Postgresql is not running.</span></span>
<span class="line"><span style="color:#9ECBFF;">Jun 23 09:51:39 pg_node2 patroni: 2021-06-23 09:51:39,042 INFO: Lock owner: pg1; I am pg2</span></span>
<span class="line"><span style="color:#9ECBFF;">Jun 23 09:51:39 pg_node2 patroni: 2021-06-23 09:51:39,053 INFO: pg_controldata:</span></span>
<span class="line"><span style="color:#9ECBFF;">Jun 23 09:51:39 pg_node2 patroni: Database system identifier: 6976142033405049133</span></span>
<span class="line"><span style="color:#9ECBFF;">Jun 23 09:51:39 pg_node2 patroni: pg_control last modified: Wed Jun 23 09:51:37 2021</span></span>
<span class="line"><span style="color:#9ECBFF;">Jun 23 09:51:39 pg_node2 patroni: Blocks per segment of large relation: 131072</span></span>
<span class="line"><span style="color:#9ECBFF;">Jun 23 09:51:39 pg_node2 patroni: Size of a large-object chunk: 2048</span></span>
<span class="line"><span style="color:#9ECBFF;">Jun 23 09:51:39 pg_node2 patroni: WAL block size: 8192</span></span>
<span class="line"><span style="color:#9ECBFF;">Jun 23 09:51:39 pg_node2 patroni: Latest checkpoint&#39;s</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">oldestActiveXID:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">488</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:51:39</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node2</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Latest</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">checkpoint&#39;s TimeLineID: 6</span></span>
<span class="line"><span style="color:#9ECBFF;">Jun 23 09:51:39 pg_node2 patroni: Bytes per WAL segment: 16777216</span></span>
<span class="line"><span style="color:#9ECBFF;">Jun 23 09:51:39 pg_node2 patroni: Fake LSN counter for unlogged rels: 0/3E8</span></span>
<span class="line"><span style="color:#9ECBFF;">Jun 23 09:51:39 pg_node2 patroni: max_connections setting: 100</span></span>
<span class="line"><span style="color:#9ECBFF;">Jun 23 09:51:39 pg_node2 patroni: Latest checkpoint location: 0/50006A0</span></span>
<span class="line"><span style="color:#9ECBFF;">Jun 23 09:51:39 pg_node2 patroni: Float8 argument passing: by value</span></span>
<span class="line"><span style="color:#9ECBFF;">Jun 23 09:51:39 pg_node2 patroni: Minimum recovery ending location: 0/5000750</span></span>
<span class="line"><span style="color:#9ECBFF;">Jun 23 09:51:39 pg_node2 patroni: track_commit_timestamp setting: off</span></span>
<span class="line"><span style="color:#9ECBFF;">Jun 23 09:51:39 pg_node2 patroni: Latest checkpoint&#39;s</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">newestCommitTsXid:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:51:39</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node2</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Latest</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">checkpoint&#39;s NextMultiXactId: 1</span></span>
<span class="line"><span style="color:#9ECBFF;">Jun 23 09:51:39 pg_node2 patroni: Maximum size of a TOAST chunk: 1996</span></span>
<span class="line"><span style="color:#9ECBFF;">Jun 23 09:51:39 pg_node2 patroni: Maximum data alignment: 8</span></span>
<span class="line"><span style="color:#9ECBFF;">Jun 23 09:51:39 pg_node2 patroni: Date/time type storage: 64-bit integers</span></span>
<span class="line"><span style="color:#9ECBFF;">Jun 23 09:51:39 pg_node2 patroni: Database block size: 8192</span></span>
<span class="line"><span style="color:#9ECBFF;">Jun 23 09:51:39 pg_node2 patroni: Data page checksum version: 1</span></span>
<span class="line"><span style="color:#9ECBFF;">Jun 23 09:51:39 pg_node2 patroni: Time of latest checkpoint: Wed Jun 23 09:37:57 2021</span></span>
<span class="line"><span style="color:#9ECBFF;">Jun 23 09:51:39 pg_node2 patroni: wal_log_hints setting: on</span></span>
<span class="line"><span style="color:#9ECBFF;">Jun 23 09:51:39 pg_node2 patroni: Latest checkpoint&#39;s</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">full_page_writes:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">on</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:51:39</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node2</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">End-of-backup</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">record</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">required:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">no</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:51:39</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node2</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">max_prepared_xacts</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">setting:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:51:39</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node2</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Latest</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">checkpoint&#39;s NextMultiOffset: 0</span></span>
<span class="line"><span style="color:#9ECBFF;">Jun 23 09:51:39 pg_node2 patroni: Backup start location: 0/0</span></span>
<span class="line"><span style="color:#9ECBFF;">Jun 23 09:51:39 pg_node2 patroni: Latest checkpoint&#39;s</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">oldestMultiXid:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">1</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:51:39</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node2</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Mock</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">authentication</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">nonce:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">020</span><span style="color:#9ECBFF;">ac2d0808d3cf471a8d90e23263e8a317b31c5f7e494fc3fba551683e5c39b</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:51:39</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node2</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Latest</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">checkpoint&#39;s NextOID: 16385</span></span>
<span class="line"><span style="color:#9ECBFF;">Jun 23 09:51:39 pg_node2 patroni: Maximum columns in an index: 32</span></span>
<span class="line"><span style="color:#9ECBFF;">Jun 23 09:51:39 pg_node2 patroni: Latest checkpoint&#39;s</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">oldestXID:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">479</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:51:39</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node2</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Catalog</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">version</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">number:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">202007201</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:51:39</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node2</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">max_worker_processes</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">setting:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">8</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:51:39</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node2</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Maximum</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">length</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">of</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">identifiers:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">64</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:51:39</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node2</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Min</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">recovery</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">ending</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">loc&#39;s timeline: 6</span></span>
<span class="line"><span style="color:#9ECBFF;">Jun 23 09:51:39 pg_node2 patroni: max_locks_per_xact setting: 64</span></span>
<span class="line"><span style="color:#9ECBFF;">Jun 23 09:51:39 pg_node2 patroni: max_wal_senders setting: 10</span></span>
<span class="line"><span style="color:#9ECBFF;">Jun 23 09:51:39 pg_node2 patroni: Latest checkpoint&#39;s</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">NextXID:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0</span><span style="color:#9ECBFF;">:488</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:51:39</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node2</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Latest</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">checkpoint&#39;s REDO location: 0/5000668</span></span>
<span class="line"><span style="color:#9ECBFF;">Jun 23 09:51:39 pg_node2 patroni: Backup end location: 0/0</span></span>
<span class="line"><span style="color:#9ECBFF;">Jun 23 09:51:39 pg_node2 patroni: Database cluster state: shut down in recovery</span></span>
<span class="line"><span style="color:#9ECBFF;">Jun 23 09:51:39 pg_node2 patroni: pg_control version number: 1300</span></span>
<span class="line"><span style="color:#9ECBFF;">Jun 23 09:51:39 pg_node2 patroni: wal_level setting: replica</span></span>
<span class="line"><span style="color:#9ECBFF;">Jun 23 09:51:39 pg_node2 patroni: Latest checkpoint&#39;s</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">REDO</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">WAL</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">file:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">000000060000000000000005</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:51:39</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node2</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Latest</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">checkpoint&#39;s oldestCommitTsXid: 0</span></span>
<span class="line"><span style="color:#9ECBFF;">Jun 23 09:51:39 pg_node2 patroni: Latest checkpoint&#39;s</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">oldestXID&#39;s DB: 1</span></span>
<span class="line"><span style="color:#9ECBFF;">Jun 23 09:51:39 pg_node2 patroni: Latest checkpoint&#39;s</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">oldestMulti&#39;s DB: 1</span></span>
<span class="line"><span style="color:#9ECBFF;">Jun 23 09:51:39 pg_node2 patroni: Latest checkpoint&#39;s</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">PrevTimeLineID:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">6</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:51:39</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node2</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2021</span><span style="color:#9ECBFF;">-06-23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:51:39,055</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">INFO:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Lock</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">owner:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg1</span><span style="color:#E1E4E8;">; </span><span style="color:#B392F0;">I</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">am</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg2</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:51:39</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node2</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2021</span><span style="color:#9ECBFF;">-06-23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:51:39,081</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">INFO:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Local</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">timeline=</span><span style="color:#79B8FF;">6</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">lsn=</span><span style="color:#79B8FF;">0</span><span style="color:#9ECBFF;">/5000750</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:51:39</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node2</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2021</span><span style="color:#9ECBFF;">-06-23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:51:39,088</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">INFO:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">master_timeline=</span><span style="color:#79B8FF;">6</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:51:39</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node2</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2021</span><span style="color:#9ECBFF;">-06-23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:51:39,089</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">INFO:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Lock</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">owner:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg1</span><span style="color:#E1E4E8;">; </span><span style="color:#B392F0;">I</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">am</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg2</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:51:39</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node2</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2021</span><span style="color:#9ECBFF;">-06-23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:51:39,105</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">INFO:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">starting</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">as</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">a</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">secondary</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:51:39</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node2</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2021</span><span style="color:#9ECBFF;">-06-23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:51:39,107</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">INFO:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">closed</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">connection</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">to</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">the</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">postgresql</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">cluster</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:51:39</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node2</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2021</span><span style="color:#9ECBFF;">-06-23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:51:39,130</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">INFO:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">postmaster</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pid=</span><span style="color:#79B8FF;">26284</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:51:39</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node2</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">localhost:5432</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">-</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">no</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">response</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:51:39</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node2</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2021</span><span style="color:#9ECBFF;">-06-23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:51:39.172</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">CST</span><span style="color:#E1E4E8;"> [26284] LOG:  starting PostgreSQL 13.3 on x86_64-pc-linux-gnu, compiled by gcc (</span><span style="color:#B392F0;">GCC</span><span style="color:#E1E4E8;">) 4.8.5 20150623 (</span><span style="color:#B392F0;">Red</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Hat</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">4.8</span><span style="color:#9ECBFF;">.5-44</span><span style="color:#E1E4E8;">), 64-bit</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:51:39</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node2</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2021</span><span style="color:#9ECBFF;">-06-23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:51:39.172</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">CST</span><span style="color:#E1E4E8;"> [26284] LOG:  listening on IPv4 address </span><span style="color:#9ECBFF;">&quot;0.0.0.0&quot;</span><span style="color:#E1E4E8;">, port 5432</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:51:39</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node2</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2021</span><span style="color:#9ECBFF;">-06-23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:51:39.186</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">CST</span><span style="color:#E1E4E8;"> [26284] LOG:  listening on Unix socket </span><span style="color:#9ECBFF;">&quot;/tmp/.s.PGSQL.5432&quot;</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:51:39</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node2</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2021</span><span style="color:#9ECBFF;">-06-23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:51:39.203</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">CST</span><span style="color:#E1E4E8;"> [26286] LOG:  database system was shut down </span><span style="color:#F97583;">in</span><span style="color:#E1E4E8;"> recovery at 2021-06-23 09:51:37 CST</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:51:39</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node2</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2021</span><span style="color:#9ECBFF;">-06-23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:51:39.203</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">CST</span><span style="color:#E1E4E8;"> [26286] LOG:  entering standby mode</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:51:39</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node2</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2021</span><span style="color:#9ECBFF;">-06-23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:51:39.212</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">CST</span><span style="color:#E1E4E8;"> [26286] LOG:  redo starts at 0/5000668</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:51:39</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node2</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2021</span><span style="color:#9ECBFF;">-06-23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:51:39.212</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">CST</span><span style="color:#E1E4E8;"> [26286] LOG:  consistent recovery state reached at 0/5000750</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:51:39</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node2</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2021</span><span style="color:#9ECBFF;">-06-23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:51:39.212</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">CST</span><span style="color:#E1E4E8;"> [26286] LOG:  invalid record length at 0/5000750: wanted 24, got 0</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:51:39</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node2</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2021</span><span style="color:#9ECBFF;">-06-23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:51:39.213</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">CST</span><span style="color:#E1E4E8;"> [26284] LOG:  database system is ready to accept read only connections</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:51:39</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node2</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2021</span><span style="color:#9ECBFF;">-06-23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:51:39.229</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">CST</span><span style="color:#E1E4E8;"> [26290] LOG:  started streaming WAL from primary at 0/5000000 on timeline 6</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:51:40</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node2</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">localhost:5432</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">-</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">accepting</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">connections</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:51:40</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node2</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">localhost:5432</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">-</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">accepting</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">connections</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:51:40</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node2</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">this</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">is</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">callback</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">on_start</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">replica</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">twpg</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:51:40</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node2</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2021</span><span style="color:#9ECBFF;">-06-23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:51:40,229</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">INFO:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Lock</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">owner:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg1</span><span style="color:#E1E4E8;">; </span><span style="color:#B392F0;">I</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">am</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg2</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:51:40</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node2</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2021</span><span style="color:#9ECBFF;">-06-23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:51:40,229</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">INFO:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">does</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">not</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">have</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">lock</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:51:40</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node2</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2021</span><span style="color:#9ECBFF;">-06-23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:51:40,229</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">INFO:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">establishing</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">a</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">new</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">connection</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">to</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">the</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">postgres</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">cluster</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:51:40</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node2</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2021</span><span style="color:#9ECBFF;">-06-23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:51:40,261</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">INFO:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">no</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">action.</span><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">i</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">am</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">a</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">secondary</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">and</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">i</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">am</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">following</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">a</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">leader</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:51:50</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node2</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2021</span><span style="color:#9ECBFF;">-06-23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:51:50,228</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">INFO:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Lock</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">owner:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg1</span><span style="color:#E1E4E8;">; </span><span style="color:#B392F0;">I</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">am</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg2</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:51:50</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node2</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2021</span><span style="color:#9ECBFF;">-06-23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:51:50,228</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">INFO:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">does</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">not</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">have</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">lock</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:51:50</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node2</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2021</span><span style="color:#9ECBFF;">-06-23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:51:50,238</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">INFO:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">no</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">action.</span><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">i</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">am</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">a</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">secondary</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">and</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">i</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">am</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">following</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">a</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">leader</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#模拟patroni出现问题</span></span>
<span class="line"><span style="color:#6A737D;">#停止PG主机所在节点的patroni服务</span></span>
<span class="line"><span style="color:#E1E4E8;">[root@pg_node1 </span><span style="color:#F97583;">~</span><span style="color:#E1E4E8;">]# patronictl -c /etc/patroni/patroni.yml list</span></span>
<span class="line"><span style="color:#B392F0;">+</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Cluster:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">twpg</span><span style="color:#E1E4E8;"> (6976142033405049133) ---+---------+----+-----------+</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Member</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Host</span><span style="color:#E1E4E8;">                </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Role</span><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">State</span><span style="color:#E1E4E8;">   </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">TL</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Lag</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">in</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">MB</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#B392F0;">+--------+---------------------+---------+---------+----+-----------+</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">pg1</span><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">192.168.210.15:5432</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Leader</span><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">running</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">6</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">           </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">pg2</span><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">192.168.210.81:5432</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Replica</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">running</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">6</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">       </span><span style="color:#B392F0;">0.0</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">pg3</span><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">192.168.210.33:5432</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Replica</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">running</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">6</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">       </span><span style="color:#B392F0;">0.0</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#B392F0;">+--------+---------------------+---------+---------+----+-----------+</span></span>
<span class="line"><span style="color:#E1E4E8;">[root@pg_node1 </span><span style="color:#F97583;">~</span><span style="color:#E1E4E8;">]# ip -o -4 a</span></span>
<span class="line"><span style="color:#B392F0;">1:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">lo</span><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">inet</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">127.0</span><span style="color:#9ECBFF;">.0.1/8</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">scope</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">host</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">lo</span><span style="color:#79B8FF;">\\ </span><span style="color:#E1E4E8;">      </span><span style="color:#9ECBFF;">valid_lft</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">forever</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">preferred_lft</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">forever</span></span>
<span class="line"><span style="color:#B392F0;">2:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">eth0</span><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">inet</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">192.168</span><span style="color:#9ECBFF;">.210.15/24</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">brd</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">192.168</span><span style="color:#9ECBFF;">.210.255</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">scope</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">global</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">noprefixroute</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">dynamic</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">eth0</span><span style="color:#79B8FF;">\\ </span><span style="color:#E1E4E8;">      </span><span style="color:#9ECBFF;">valid_lft</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">63429</span><span style="color:#9ECBFF;">sec</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">preferred_lft</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">63429</span><span style="color:#9ECBFF;">sec</span></span>
<span class="line"><span style="color:#B392F0;">2:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">eth0</span><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">inet</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">192.168</span><span style="color:#9ECBFF;">.210.66/24</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">scope</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">global</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">secondary</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">eth0</span><span style="color:#79B8FF;">\\ </span><span style="color:#E1E4E8;">      </span><span style="color:#9ECBFF;">valid_lft</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">forever</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">preferred_lft</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">forever</span></span>
<span class="line"><span style="color:#E1E4E8;">[root@pg_node1 </span><span style="color:#F97583;">~</span><span style="color:#E1E4E8;">]# systemctl stop patroni</span></span>
<span class="line"><span style="color:#E1E4E8;">[root@pg_node1 </span><span style="color:#F97583;">~</span><span style="color:#E1E4E8;">]# ip -o -4 a</span></span>
<span class="line"><span style="color:#B392F0;">1:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">lo</span><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">inet</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">127.0</span><span style="color:#9ECBFF;">.0.1/8</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">scope</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">host</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">lo</span><span style="color:#79B8FF;">\\ </span><span style="color:#E1E4E8;">      </span><span style="color:#9ECBFF;">valid_lft</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">forever</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">preferred_lft</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">forever</span></span>
<span class="line"><span style="color:#B392F0;">2:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">eth0</span><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">inet</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">192.168</span><span style="color:#9ECBFF;">.210.15/24</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">brd</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">192.168</span><span style="color:#9ECBFF;">.210.255</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">scope</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">global</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">noprefixroute</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">dynamic</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">eth0</span><span style="color:#79B8FF;">\\ </span><span style="color:#E1E4E8;">      </span><span style="color:#9ECBFF;">valid_lft</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">63357</span><span style="color:#9ECBFF;">sec</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">preferred_lft</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">63357</span><span style="color:#9ECBFF;">sec</span></span>
<span class="line"><span style="color:#E1E4E8;">[root@pg_node2 </span><span style="color:#F97583;">~</span><span style="color:#E1E4E8;">]# patronictl -c /etc/patroni/patroni.yml list</span></span>
<span class="line"><span style="color:#B392F0;">+</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Cluster:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">twpg</span><span style="color:#E1E4E8;"> (6976142033405049133) ---+---------+----+-----------+</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Member</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Host</span><span style="color:#E1E4E8;">                </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Role</span><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">State</span><span style="color:#E1E4E8;">   </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">TL</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Lag</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">in</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">MB</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#B392F0;">+--------+---------------------+---------+---------+----+-----------+</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">pg1</span><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">192.168.210.15:5432</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Leader</span><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">running</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">6</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">           </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">pg2</span><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">192.168.210.81:5432</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Replica</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">running</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">6</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">       </span><span style="color:#B392F0;">0.0</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">pg3</span><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">192.168.210.33:5432</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Replica</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">running</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">6</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">       </span><span style="color:#B392F0;">0.0</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#B392F0;">+--------+---------------------+---------+---------+----+-----------+</span></span>
<span class="line"><span style="color:#E1E4E8;">[root@pg_node2 </span><span style="color:#F97583;">~</span><span style="color:#E1E4E8;">]# patronictl -c /etc/patroni/patroni.yml list</span></span>
<span class="line"><span style="color:#B392F0;">+</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Cluster:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">twpg</span><span style="color:#E1E4E8;"> (6976142033405049133) ---+---------+----+-----------+</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Member</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Host</span><span style="color:#E1E4E8;">                </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Role</span><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">State</span><span style="color:#E1E4E8;">   </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">TL</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Lag</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">in</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">MB</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#B392F0;">+--------+---------------------+---------+---------+----+-----------+</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">pg1</span><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">192.168.210.15:5432</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Replica</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">stopped</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">   </span><span style="color:#B392F0;">unknown</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">pg2</span><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">192.168.210.81:5432</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Replica</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">running</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">7</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">       </span><span style="color:#B392F0;">0.0</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">pg3</span><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">192.168.210.33:5432</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Leader</span><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">running</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">7</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">           </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#B392F0;">+--------+---------------------+---------+---------+----+-----------+</span></span>
<span class="line"><span style="color:#E1E4E8;">[root@pg_node2 </span><span style="color:#F97583;">~</span><span style="color:#E1E4E8;">]# patronictl -c /etc/patroni/patroni.yml list</span></span>
<span class="line"><span style="color:#B392F0;">+</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Cluster:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">twpg</span><span style="color:#E1E4E8;"> (6976142033405049133) ---+---------+----+-----------+</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Member</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Host</span><span style="color:#E1E4E8;">                </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Role</span><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">State</span><span style="color:#E1E4E8;">   </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">TL</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Lag</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">in</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">MB</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#B392F0;">+--------+---------------------+---------+---------+----+-----------+</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">pg2</span><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">192.168.210.81:5432</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Replica</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">running</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">7</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">       </span><span style="color:#B392F0;">0.0</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">pg3</span><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">192.168.210.33:5432</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Leader</span><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">running</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">7</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">           </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#B392F0;">+--------+---------------------+---------+---------+----+-----------+</span></span>
<span class="line"><span style="color:#E1E4E8;">[root@pg_node3 </span><span style="color:#F97583;">~</span><span style="color:#E1E4E8;">]# patronictl -c /etc/patroni/patroni.yml list</span></span>
<span class="line"><span style="color:#B392F0;">+</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Cluster:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">twpg</span><span style="color:#E1E4E8;"> (6976142033405049133) ---+---------+----+-----------+</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Member</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Host</span><span style="color:#E1E4E8;">                </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Role</span><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">State</span><span style="color:#E1E4E8;">   </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">TL</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Lag</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">in</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">MB</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#B392F0;">+--------+---------------------+---------+---------+----+-----------+</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">pg1</span><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">192.168.210.15:5432</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Leader</span><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">running</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">6</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">           </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">pg2</span><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">192.168.210.81:5432</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Replica</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">running</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">6</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">       </span><span style="color:#B392F0;">0.0</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">pg3</span><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">192.168.210.33:5432</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Replica</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">running</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">6</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">       </span><span style="color:#B392F0;">0.0</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#B392F0;">+--------+---------------------+---------+---------+----+-----------+</span></span>
<span class="line"><span style="color:#E1E4E8;">[root@pg_node3 </span><span style="color:#F97583;">~</span><span style="color:#E1E4E8;">]# patronictl -c /etc/patroni/patroni.yml list</span></span>
<span class="line"><span style="color:#B392F0;">+</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Cluster:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">twpg</span><span style="color:#E1E4E8;"> (6976142033405049133) ---+---------+----+-----------+</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Member</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Host</span><span style="color:#E1E4E8;">                </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Role</span><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">State</span><span style="color:#E1E4E8;">   </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">TL</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Lag</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">in</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">MB</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#B392F0;">+--------+---------------------+---------+---------+----+-----------+</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">pg2</span><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">192.168.210.81:5432</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Replica</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">running</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">7</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">       </span><span style="color:#B392F0;">0.0</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">pg3</span><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">192.168.210.33:5432</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Leader</span><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">running</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">7</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">           </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#B392F0;">+--------+---------------------+---------+---------+----+-----------+</span></span>
<span class="line"><span style="color:#E1E4E8;">[root@pg_node3 </span><span style="color:#F97583;">~</span><span style="color:#E1E4E8;">]# ip -o -4 a</span></span>
<span class="line"><span style="color:#B392F0;">1:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">lo</span><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">inet</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">127.0</span><span style="color:#9ECBFF;">.0.1/8</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">scope</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">host</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">lo</span><span style="color:#79B8FF;">\\ </span><span style="color:#E1E4E8;">      </span><span style="color:#9ECBFF;">valid_lft</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">forever</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">preferred_lft</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">forever</span></span>
<span class="line"><span style="color:#B392F0;">2:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">eth0</span><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">inet</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">192.168</span><span style="color:#9ECBFF;">.210.33/24</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">brd</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">192.168</span><span style="color:#9ECBFF;">.210.255</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">scope</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">global</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">noprefixroute</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">dynamic</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">eth0</span><span style="color:#79B8FF;">\\ </span><span style="color:#E1E4E8;">      </span><span style="color:#9ECBFF;">valid_lft</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">69980</span><span style="color:#9ECBFF;">sec</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">preferred_lft</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">69980</span><span style="color:#9ECBFF;">sec</span></span>
<span class="line"><span style="color:#B392F0;">2:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">eth0</span><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">inet</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">192.168</span><span style="color:#9ECBFF;">.210.66/24</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">scope</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">global</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">secondary</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">eth0</span><span style="color:#79B8FF;">\\ </span><span style="color:#E1E4E8;">      </span><span style="color:#9ECBFF;">valid_lft</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">forever</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">preferred_lft</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">forever</span></span>
<span class="line"><span style="color:#6A737D;">#节点3日志信息，数据库提升为主库</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:59:07</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node3</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2021</span><span style="color:#9ECBFF;">-06-23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:59:07,841</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">INFO:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Lock</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">owner:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg1</span><span style="color:#E1E4E8;">; </span><span style="color:#B392F0;">I</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">am</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg3</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:59:07</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node3</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2021</span><span style="color:#9ECBFF;">-06-23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:59:07,841</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">INFO:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">does</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">not</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">have</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">lock</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:59:07</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node3</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2021</span><span style="color:#9ECBFF;">-06-23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:59:07,849</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">INFO:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">no</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">action.</span><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">i</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">am</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">a</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">secondary</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">and</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">i</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">am</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">following</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">a</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">leader</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:59:12</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node3</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2021</span><span style="color:#9ECBFF;">-06-23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:59:12.171</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">CST</span><span style="color:#E1E4E8;"> [25279] LOG:  replication terminated by primary server</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:59:12</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node3</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2021</span><span style="color:#9ECBFF;">-06-23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:59:12.171</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">CST</span><span style="color:#E1E4E8;"> [25279] DETAIL:  End of WAL reached on timeline 6 at 0/50007C8.</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:59:12</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node3</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2021</span><span style="color:#9ECBFF;">-06-23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:59:12.171</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">CST</span><span style="color:#E1E4E8;"> [25279] FATAL:  could not send end-of-streaming message to primary: no COPY </span><span style="color:#F97583;">in</span><span style="color:#E1E4E8;"> progress</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:59:12</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node3</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2021</span><span style="color:#9ECBFF;">-06-23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:59:12.172</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">CST</span><span style="color:#E1E4E8;"> [32443] LOG:  invalid record length at 0/50007C8: wanted 24, got 0</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:59:12</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node3</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2021</span><span style="color:#9ECBFF;">-06-23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:59:12.179</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">CST</span><span style="color:#E1E4E8;"> [26335] FATAL:  could not connect to the primary server: could not connect to server: Connection refused</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:59:12</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node3</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Is</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">the</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">server</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">running</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">on</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">host</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;192.168.210.15&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">and</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">accepting</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:59:12</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node3</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">TCP/IP</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">connections</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">on</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">port</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5432</span><span style="color:#9ECBFF;">?</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:59:13</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node3</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2021</span><span style="color:#9ECBFF;">-06-23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:59:13,151</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">WARNING:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Request</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">failed</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">to</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg1:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">GET</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">http://192.168.210.15:8008/patroni</span><span style="color:#E1E4E8;"> (HTTPConnectionPool(host=u</span><span style="color:#9ECBFF;">&#39;192.168.210.15&#39;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">port=</span><span style="color:#79B8FF;">8008</span><span style="color:#E1E4E8;">): Max retries exceeded with url: /patroni (</span><span style="color:#B392F0;">Caused</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">by</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">ProtocolError</span><span style="color:#E1E4E8;">(</span><span style="color:#B392F0;">&#39;Connection aborted.&#39;</span><span style="color:#B392F0;">,</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">error</span><span style="color:#E1E4E8;">(</span><span style="color:#B392F0;">104,</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;Connection reset by peer&#39;</span><span style="color:#E1E4E8;">))))</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:59:13</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node3</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2021</span><span style="color:#9ECBFF;">-06-23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:59:13,153</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">INFO:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Got</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">response</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">from</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg2</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">http://192.168.210.81:8008/patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">{&quot;database_system_identifier&quot;:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;6976142033405049133&quot;,</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;postmaster_start_time&quot;:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;2021-06-23 09:51:39.194 CST&quot;,</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;timeline&quot;:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">6</span><span style="color:#9ECBFF;">,</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;cluster_unlocked&quot;:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">false</span><span style="color:#9ECBFF;">,</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;patroni&quot;:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">{&quot;scope&quot;:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;twpg&quot;,</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;version&quot;:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;2.0.2&quot;},</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;state&quot;:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;running&quot;,</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;role&quot;:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;replica&quot;,</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;xlog&quot;:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">{&quot;received_location&quot;:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">83888072</span><span style="color:#9ECBFF;">,</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;replayed_timestamp&quot;:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">null,</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;paused&quot;:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">false</span><span style="color:#9ECBFF;">,</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;replayed_location&quot;:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">83888072</span><span style="color:#9ECBFF;">},</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;server_version&quot;:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">130003</span><span style="color:#9ECBFF;">}</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:59:13</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node3</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2021</span><span style="color:#9ECBFF;">-06-23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:59:13,247</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">INFO:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Software</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Watchdog</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">activated</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">with</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">25</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">second</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">timeout,</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">timing</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">slack</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">15</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">seconds</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:59:13</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node3</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2021</span><span style="color:#9ECBFF;">-06-23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:59:13,264</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">INFO:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">promoted</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">self</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">to</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">leader</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">by</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">acquiring</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">session</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">lock</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:59:13</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node3</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">server</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">promoting</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:59:13</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node3</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2021</span><span style="color:#9ECBFF;">-06-23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:59:13,273</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">INFO:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Lock</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">owner:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg3</span><span style="color:#E1E4E8;">; </span><span style="color:#B392F0;">I</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">am</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg3</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:59:13</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node3</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2021</span><span style="color:#9ECBFF;">-06-23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:59:13.276</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">CST</span><span style="color:#E1E4E8;"> [32443] LOG:  received promote request</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:59:13</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node3</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2021</span><span style="color:#9ECBFF;">-06-23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:59:13.276</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">CST</span><span style="color:#E1E4E8;"> [32443] LOG:  redo </span><span style="color:#F97583;">done</span><span style="color:#E1E4E8;"> at 0/5000750</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:59:13</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node3</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2021</span><span style="color:#9ECBFF;">-06-23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:59:13,277</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">INFO:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">cleared</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">rewind</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">state</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">after</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">becoming</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">the</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">leader</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:59:13</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node3</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2021</span><span style="color:#9ECBFF;">-06-23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:59:13.289</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">CST</span><span style="color:#E1E4E8;"> [32443] LOG:  selected new timeline ID: 7</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:59:13</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node3</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">this</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">is</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">callback</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">on_role_change</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">master</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">twpg</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:59:13</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node3</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2021</span><span style="color:#9ECBFF;">-06-23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:59:13,298</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">INFO:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">updated</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">leader</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">lock</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">during</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">promote</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:59:13</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node3</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">systemd:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Started</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Session</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">c7</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">of</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">user</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">root.</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:59:13</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node3</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">systemd:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Started</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Session</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">c8</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">of</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">user</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">root.</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:59:13</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node3</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2021</span><span style="color:#9ECBFF;">-06-23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:59:13.585</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">CST</span><span style="color:#E1E4E8;"> [32443] LOG:  archive recovery complete</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:59:13</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node3</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2021</span><span style="color:#9ECBFF;">-06-23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:59:13.650</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">CST</span><span style="color:#E1E4E8;"> [32441] LOG:  database system is ready to accept connections</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:59:14</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node3</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2021</span><span style="color:#9ECBFF;">-06-23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:59:14,318</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">INFO:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Lock</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">owner:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg3</span><span style="color:#E1E4E8;">; </span><span style="color:#B392F0;">I</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">am</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg3</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:59:14</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node3</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2021</span><span style="color:#9ECBFF;">-06-23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:59:14,435</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">INFO:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">no</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">action.</span><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">i</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">am</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">the</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">leader</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">with</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">the</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">lock</span></span>
<span class="line"><span style="color:#6A737D;">#</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:59:10</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node2</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2021</span><span style="color:#9ECBFF;">-06-23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:59:10,228</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">INFO:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Lock</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">owner:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg1</span><span style="color:#E1E4E8;">; </span><span style="color:#B392F0;">I</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">am</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg2</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:59:10</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node2</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2021</span><span style="color:#9ECBFF;">-06-23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:59:10,228</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">INFO:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">does</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">not</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">have</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">lock</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:59:10</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node2</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2021</span><span style="color:#9ECBFF;">-06-23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:59:10,237</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">INFO:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">no</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">action.</span><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">i</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">am</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">a</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">secondary</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">and</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">i</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">am</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">following</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">a</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">leader</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:59:12</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node2</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2021</span><span style="color:#9ECBFF;">-06-23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:59:12.170</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">CST</span><span style="color:#E1E4E8;"> [26290] LOG:  replication terminated by primary server</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:59:12</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node2</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2021</span><span style="color:#9ECBFF;">-06-23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:59:12.170</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">CST</span><span style="color:#E1E4E8;"> [26290] DETAIL:  End of WAL reached on timeline 6 at 0/50007C8.</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:59:12</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node2</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2021</span><span style="color:#9ECBFF;">-06-23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:59:12.170</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">CST</span><span style="color:#E1E4E8;"> [26290] FATAL:  could not send end-of-streaming message to primary: no COPY </span><span style="color:#F97583;">in</span><span style="color:#E1E4E8;"> progress</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:59:12</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node2</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2021</span><span style="color:#9ECBFF;">-06-23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:59:12.170</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">CST</span><span style="color:#E1E4E8;"> [26286] LOG:  invalid record length at 0/50007C8: wanted 24, got 0</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:59:12</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node2</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2021</span><span style="color:#9ECBFF;">-06-23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:59:12.177</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">CST</span><span style="color:#E1E4E8;"> [26671] FATAL:  could not connect to the primary server: could not connect to server: Connection refused</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:59:12</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node2</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Is</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">the</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">server</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">running</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">on</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">host</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;192.168.210.15&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">and</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">accepting</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:59:12</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node2</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">TCP/IP</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">connections</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">on</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">port</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5432</span><span style="color:#9ECBFF;">?</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:59:13</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node2</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2021</span><span style="color:#9ECBFF;">-06-23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:59:13,174</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">WARNING:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Request</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">failed</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">to</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg1:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">GET</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">http://192.168.210.15:8008/patroni</span><span style="color:#E1E4E8;"> (HTTPConnectionPool(host=u</span><span style="color:#9ECBFF;">&#39;192.168.210.15&#39;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">port=</span><span style="color:#79B8FF;">8008</span><span style="color:#E1E4E8;">): Max retries exceeded with url: /patroni (</span><span style="color:#B392F0;">Caused</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">by</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">NewConnectionError</span><span style="color:#E1E4E8;">(</span><span style="color:#B392F0;">&#39;&lt;urllib3.connection.HTTPConnection object at 0x7f1b110fb9d0&gt;: Failed to establish a new connection: [Errno 111] Connection refused&#39;</span><span style="color:#B392F0;">,</span><span style="color:#E1E4E8;">)))</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:59:13</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node2</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2021</span><span style="color:#9ECBFF;">-06-23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:59:13,188</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">INFO:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Got</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">response</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">from</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg3</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">http://192.168.210.33:8008/patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">{&quot;database_system_identifier&quot;:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;6976142033405049133&quot;,</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;postmaster_start_time&quot;:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;2021-06-21 15:43:32.837 CST&quot;,</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;timeline&quot;:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">6</span><span style="color:#9ECBFF;">,</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;cluster_unlocked&quot;:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">true</span><span style="color:#9ECBFF;">,</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;patroni&quot;:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">{&quot;scope&quot;:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;twpg&quot;,</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;version&quot;:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;2.0.2&quot;},</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;state&quot;:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;running&quot;,</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;role&quot;:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;replica&quot;,</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;xlog&quot;:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">{&quot;received_location&quot;:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">83888072</span><span style="color:#9ECBFF;">,</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;replayed_timestamp&quot;:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">null,</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;paused&quot;:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">false</span><span style="color:#9ECBFF;">,</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;replayed_location&quot;:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">83888072</span><span style="color:#9ECBFF;">},</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;server_version&quot;:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">130003</span><span style="color:#9ECBFF;">}</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:59:13</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node2</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2021</span><span style="color:#9ECBFF;">-06-23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:59:13,277</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">INFO:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Could</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">not</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">take</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">out</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">TTL</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">lock</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:59:13</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node2</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">server</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">signaled</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:59:13</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node2</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2021</span><span style="color:#9ECBFF;">-06-23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:59:13.291</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">CST</span><span style="color:#E1E4E8;"> [26284] LOG:  received SIGHUP, reloading configuration files</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:59:13</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node2</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2021</span><span style="color:#9ECBFF;">-06-23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:59:13.292</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">CST</span><span style="color:#E1E4E8;"> [26284] LOG:  parameter </span><span style="color:#9ECBFF;">&quot;primary_conninfo&quot;</span><span style="color:#E1E4E8;"> changed to </span><span style="color:#9ECBFF;">&quot;user=repuser passfile=/home/postgres/pgpass host=192.168.210.33 port=5432 sslmode=prefer application_name=pg2 gssencmode=prefer channel_binding=prefer&quot;</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:59:13</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node2</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2021</span><span style="color:#9ECBFF;">-06-23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:59:13.296</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">CST</span><span style="color:#E1E4E8;"> [26682] FATAL:  could not connect to the primary server: could not connect to server: Connection refused</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:59:13</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node2</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Is</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">the</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">server</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">running</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">on</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">host</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;192.168.210.15&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">and</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">accepting</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:59:13</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node2</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">TCP/IP</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">connections</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">on</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">port</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5432</span><span style="color:#9ECBFF;">?</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:59:13</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node2</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2021</span><span style="color:#9ECBFF;">-06-23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:59:13,330</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">INFO:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">following</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">new</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">leader</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">after</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">trying</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">and</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">failing</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">to</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">obtain</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">lock</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:59:13</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node2</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2021</span><span style="color:#9ECBFF;">-06-23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:59:13,333</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">INFO:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Lock</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">owner:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg3</span><span style="color:#E1E4E8;">; </span><span style="color:#B392F0;">I</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">am</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg2</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:59:13</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node2</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2021</span><span style="color:#9ECBFF;">-06-23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:59:13,333</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">INFO:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">does</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">not</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">have</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">lock</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:59:13</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node2</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2021</span><span style="color:#9ECBFF;">-06-23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:59:13,342</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">INFO:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Local</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">timeline=</span><span style="color:#79B8FF;">6</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">lsn=</span><span style="color:#79B8FF;">0</span><span style="color:#9ECBFF;">/50007C8</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:59:13</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node2</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2021</span><span style="color:#9ECBFF;">-06-23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:59:13,349</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">INFO:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">master_timeline=</span><span style="color:#79B8FF;">6</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:59:13</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node2</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2021</span><span style="color:#9ECBFF;">-06-23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:59:13,354</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">INFO:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">no</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">action.</span><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">i</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">am</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">a</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">secondary</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">and</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">i</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">am</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">following</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">a</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">leader</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:59:14</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node2</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2021</span><span style="color:#9ECBFF;">-06-23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:59:14,373</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">INFO:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Lock</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">owner:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg3</span><span style="color:#E1E4E8;">; </span><span style="color:#B392F0;">I</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">am</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg2</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:59:14</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node2</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2021</span><span style="color:#9ECBFF;">-06-23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:59:14,373</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">INFO:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">does</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">not</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">have</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">lock</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:59:14</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node2</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2021</span><span style="color:#9ECBFF;">-06-23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:59:14,375</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">INFO:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">no</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">action.</span><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">i</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">am</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">a</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">secondary</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">and</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">i</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">am</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">following</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">a</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">leader</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:59:14</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node2</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2021</span><span style="color:#9ECBFF;">-06-23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:59:14,491</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">INFO:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Lock</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">owner:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg3</span><span style="color:#E1E4E8;">; </span><span style="color:#B392F0;">I</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">am</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg2</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:59:14</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node2</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2021</span><span style="color:#9ECBFF;">-06-23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:59:14,492</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">INFO:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">does</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">not</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">have</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">lock</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:59:14</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node2</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2021</span><span style="color:#9ECBFF;">-06-23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:59:14,500</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">INFO:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">no</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">action.</span><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">i</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">am</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">a</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">secondary</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">and</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">i</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">am</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">following</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">a</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">leader</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:59:18</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node2</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2021</span><span style="color:#9ECBFF;">-06-23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:59:18.306</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">CST</span><span style="color:#E1E4E8;"> [26690] LOG:  fetching timeline history file </span><span style="color:#F97583;">for</span><span style="color:#E1E4E8;"> timeline 7 from primary server</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:59:18</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node2</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2021</span><span style="color:#9ECBFF;">-06-23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:59:18.320</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">CST</span><span style="color:#E1E4E8;"> [26690] LOG:  started streaming WAL from primary at 0/5000000 on timeline 6</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:59:18</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node2</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2021</span><span style="color:#9ECBFF;">-06-23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:59:18.320</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">CST</span><span style="color:#E1E4E8;"> [26690] LOG:  replication terminated by primary server</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:59:18</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node2</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2021</span><span style="color:#9ECBFF;">-06-23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:59:18.320</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">CST</span><span style="color:#E1E4E8;"> [26690] DETAIL:  End of WAL reached on timeline 6 at 0/50007C8.</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:59:18</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node2</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2021</span><span style="color:#9ECBFF;">-06-23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:59:18.321</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">CST</span><span style="color:#E1E4E8;"> [26286] LOG:  new target timeline is 7</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:59:18</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node2</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2021</span><span style="color:#9ECBFF;">-06-23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:59:18.322</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">CST</span><span style="color:#E1E4E8;"> [26690] LOG:  restarted WAL streaming at 0/5000000 on timeline 7</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:59:24</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node2</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2021</span><span style="color:#9ECBFF;">-06-23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:59:24,492</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">INFO:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Lock</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">owner:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg3</span><span style="color:#E1E4E8;">; </span><span style="color:#B392F0;">I</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">am</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg2</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:59:24</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node2</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2021</span><span style="color:#9ECBFF;">-06-23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:59:24,492</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">INFO:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">does</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">not</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">have</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">lock</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:59:24</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node2</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2021</span><span style="color:#9ECBFF;">-06-23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#9ECBFF;">:59:24,513</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">INFO:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">no</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">action.</span><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">i</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">am</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">a</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">secondary</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">and</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">i</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">am</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">following</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">a</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">leader</span></span>
<span class="line"><span style="color:#6A737D;">#从以上信息可以看到，当主库所在的patroni服务不可用时，会发生故障转移（pg3选举为了主库，VIP进行漂移）</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#模拟主库所在的patroni进程无响应</span></span>
<span class="line"><span style="color:#6A737D;">#kill掉patroni进程，会导致服务器reboot</span></span>
<span class="line"><span style="color:#E1E4E8;">[root@pg_node2 </span><span style="color:#F97583;">~</span><span style="color:#E1E4E8;">]# patronictl -c /etc/patroni/patroni.yml list</span></span>
<span class="line"><span style="color:#B392F0;">+</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Cluster:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">twpg</span><span style="color:#E1E4E8;"> (6976142033405049133) ---+---------+----+-----------+</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Member</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Host</span><span style="color:#E1E4E8;">                </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Role</span><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">State</span><span style="color:#E1E4E8;">   </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">TL</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Lag</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">in</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">MB</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#B392F0;">+--------+---------------------+---------+---------+----+-----------+</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">pg1</span><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">192.168.210.15:5432</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Replica</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">running</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">10</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">       </span><span style="color:#B392F0;">0.0</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">pg2</span><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">192.168.210.81:5432</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Leader</span><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">running</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">10</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">           </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">pg3</span><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">192.168.210.33:5432</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Replica</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">running</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">10</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">       </span><span style="color:#B392F0;">0.0</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#B392F0;">+--------+---------------------+---------+---------+----+-----------+</span></span>
<span class="line"><span style="color:#79B8FF;">kill</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-9</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">\`</span><span style="color:#B392F0;">pgrep</span><span style="color:#9ECBFF;"> patroni\`</span></span>
<span class="line"><span style="color:#E1E4E8;">[root@pg_node2 </span><span style="color:#F97583;">~</span><span style="color:#E1E4E8;">]# uptime</span></span>
<span class="line"><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">14:26:01</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">up</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">min,</span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">user,</span><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">load</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">average:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">1.35</span><span style="color:#9ECBFF;">,</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0.41</span><span style="color:#9ECBFF;">,</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0.14</span></span>
<span class="line"><span style="color:#E1E4E8;">[root@pg_node2 </span><span style="color:#F97583;">~</span><span style="color:#E1E4E8;">]# patronictl -c /etc/patroni/patroni.yml list</span></span>
<span class="line"><span style="color:#B392F0;">+</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Cluster:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">twpg</span><span style="color:#E1E4E8;"> (6976142033405049133) ---+---------+----+-----------+</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Member</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Host</span><span style="color:#E1E4E8;">                </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Role</span><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">State</span><span style="color:#E1E4E8;">   </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">TL</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Lag</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">in</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">MB</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#B392F0;">+--------+---------------------+---------+---------+----+-----------+</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">pg1</span><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">192.168.210.15:5432</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Replica</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">running</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">10</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">       </span><span style="color:#B392F0;">0.0</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">pg2</span><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">192.168.210.81:5432</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Replica</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">running</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">10</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">       </span><span style="color:#B392F0;">0.0</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">pg3</span><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">192.168.210.33:5432</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Leader</span><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">running</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">10</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">           </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#B392F0;">+--------+---------------------+---------+---------+----+-----------+</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#模拟主机不可用（主库所在主机）</span></span>
<span class="line"><span style="color:#6A737D;">#立刻关机：poweroff</span></span>
<span class="line"><span style="color:#E1E4E8;">[root@pg_node3 </span><span style="color:#F97583;">~</span><span style="color:#E1E4E8;">]# uptime</span></span>
<span class="line"><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">14:38:38</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">up</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">4</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">days,</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">22</span><span style="color:#9ECBFF;">:08,</span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">3</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">users,</span><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">load</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">average:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0.03</span><span style="color:#9ECBFF;">,</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0.09</span><span style="color:#9ECBFF;">,</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0.07</span></span>
<span class="line"><span style="color:#E1E4E8;">[root@pg_node3 </span><span style="color:#F97583;">~</span><span style="color:#E1E4E8;">]# patronictl -c /etc/patroni/patroni.yml list</span></span>
<span class="line"><span style="color:#B392F0;">+</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Cluster:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">twpg</span><span style="color:#E1E4E8;"> (6976142033405049133) ---+---------+----+-----------+</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Member</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Host</span><span style="color:#E1E4E8;">                </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Role</span><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">State</span><span style="color:#E1E4E8;">   </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">TL</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Lag</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">in</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">MB</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#B392F0;">+--------+---------------------+---------+---------+----+-----------+</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">pg1</span><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">192.168.210.15:5432</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Replica</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">running</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">10</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">       </span><span style="color:#B392F0;">0.0</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">pg2</span><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">192.168.210.81:5432</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Replica</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">running</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">10</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">       </span><span style="color:#B392F0;">0.0</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">pg3</span><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">192.168.210.33:5432</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Leader</span><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">running</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">10</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">           </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#B392F0;">+--------+---------------------+---------+---------+----+-----------+</span></span>
<span class="line"><span style="color:#E1E4E8;">[root@pg_node3 </span><span style="color:#F97583;">~</span><span style="color:#E1E4E8;">]# poweroff</span></span>
<span class="line"><span style="color:#E1E4E8;">[root@pg_node2 </span><span style="color:#F97583;">~</span><span style="color:#E1E4E8;">]# patronictl -c /etc/patroni/patroni.yml list</span></span>
<span class="line"><span style="color:#B392F0;">+</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Cluster:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">twpg</span><span style="color:#E1E4E8;"> (6976142033405049133) ---+---------+----+-----------+</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Member</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Host</span><span style="color:#E1E4E8;">                </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Role</span><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">State</span><span style="color:#E1E4E8;">   </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">TL</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Lag</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">in</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">MB</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#B392F0;">+--------+---------------------+---------+---------+----+-----------+</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">pg1</span><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">192.168.210.15:5432</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Leader</span><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">running</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">11</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">           </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">pg2</span><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">192.168.210.81:5432</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Replica</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">running</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">11</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">       </span><span style="color:#B392F0;">0.0</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">pg3</span><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">192.168.210.33:5432</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Replica</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">stopped</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">   </span><span style="color:#B392F0;">unknown</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#B392F0;">+--------+---------------------+---------+---------+----+-----------+</span></span>
<span class="line"><span style="color:#E1E4E8;">[root@pg_node2 </span><span style="color:#F97583;">~</span><span style="color:#E1E4E8;">]# patronictl -c /etc/patroni/patroni.yml list</span></span>
<span class="line"><span style="color:#B392F0;">2021-06-23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">14</span><span style="color:#9ECBFF;">:42:14,614</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">-</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">ERROR</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">-</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Request</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">to</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">server</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">http://192.168.210.33:2379</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">failed:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">MaxRetryError</span><span style="color:#E1E4E8;">(</span><span style="color:#B392F0;">&quot;HTTPConnectionPool(host=u&#39;192.168.210.33&#39;, port=2379): Max retries exceeded with url: /v3/kv/range (Caused by ConnectTimeoutError(&lt;urllib3.connection.HTTPConnection object at 0x7feec6e0d9d0&gt;, u&#39;Connection to 192.168.210.33 timed out. (connect timeout=1.25)&#39;))&quot;</span><span style="color:#B392F0;">,</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#B392F0;">+</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Cluster:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">twpg</span><span style="color:#E1E4E8;"> (6976142033405049133) ---+---------+----+-----------+</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Member</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Host</span><span style="color:#E1E4E8;">                </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Role</span><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">State</span><span style="color:#E1E4E8;">   </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">TL</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Lag</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">in</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">MB</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#B392F0;">+--------+---------------------+---------+---------+----+-----------+</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">pg1</span><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">192.168.210.15:5432</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Leader</span><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">running</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">11</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">           </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">pg2</span><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">192.168.210.81:5432</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Replica</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">running</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">11</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">       </span><span style="color:#B392F0;">0.0</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">pg3</span><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">192.168.210.33:5432</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Replica</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">stopped</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">   </span><span style="color:#B392F0;">unknown</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#B392F0;">+--------+---------------------+---------+---------+----+-----------+</span></span>
<span class="line"><span style="color:#E1E4E8;">[root@pg_node2 </span><span style="color:#F97583;">~</span><span style="color:#E1E4E8;">]# patronictl -c /etc/patroni/patroni.yml list</span></span>
<span class="line"><span style="color:#B392F0;">+</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Cluster:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">twpg</span><span style="color:#E1E4E8;"> (6976142033405049133) ---+---------+----+-----------+</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Member</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Host</span><span style="color:#E1E4E8;">                </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Role</span><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">State</span><span style="color:#E1E4E8;">   </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">TL</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Lag</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">in</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">MB</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#B392F0;">+--------+---------------------+---------+---------+----+-----------+</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">pg1</span><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">192.168.210.15:5432</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Leader</span><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">running</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">11</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">           </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">pg2</span><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">192.168.210.81:5432</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Replica</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">running</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">11</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">       </span><span style="color:#B392F0;">0.0</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#B392F0;">+--------+---------------------+---------+---------+----+-----------+</span></span>
<span class="line"><span style="color:#6A737D;">#再次启动pg3节点</span></span>
<span class="line"><span style="color:#E1E4E8;">[root@pg_node3 </span><span style="color:#F97583;">~</span><span style="color:#E1E4E8;">]# uptime</span></span>
<span class="line"><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">14:46:14</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">up</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">min,</span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">user,</span><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">load</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">average:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0.71</span><span style="color:#9ECBFF;">,</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0.16</span><span style="color:#9ECBFF;">,</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0.05</span></span>
<span class="line"><span style="color:#E1E4E8;">[root@pg_node3 </span><span style="color:#F97583;">~</span><span style="color:#E1E4E8;">]# patronictl -c /etc/patroni/patroni.yml list</span></span>
<span class="line"><span style="color:#B392F0;">+</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Cluster:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">twpg</span><span style="color:#E1E4E8;"> (6976142033405049133) ---+---------+----+-----------+</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Member</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Host</span><span style="color:#E1E4E8;">                </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Role</span><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">State</span><span style="color:#E1E4E8;">   </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">TL</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Lag</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">in</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">MB</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#B392F0;">+--------+---------------------+---------+---------+----+-----------+</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">pg1</span><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">192.168.210.15:5432</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Leader</span><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">running</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">11</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">           </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">pg2</span><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">192.168.210.81:5432</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Replica</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">running</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">11</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">       </span><span style="color:#B392F0;">0.0</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">pg3</span><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">192.168.210.33:5432</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Replica</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">running</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">10</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">       </span><span style="color:#B392F0;">0.0</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#B392F0;">+--------+---------------------+---------+---------+----+-----------+</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#手工switchover</span></span>
<span class="line"><span style="color:#E1E4E8;">[root@pg_node1 </span><span style="color:#F97583;">~</span><span style="color:#E1E4E8;">]# patronictl switchover</span></span>
<span class="line"><span style="color:#B392F0;">Master</span><span style="color:#E1E4E8;"> [pg1]: </span></span>
<span class="line"><span style="color:#B392F0;">Candidate</span><span style="color:#E1E4E8;"> [</span><span style="color:#9ECBFF;">&#39;pg2&#39;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&#39;pg3&#39;]</span><span style="color:#E1E4E8;"> []: ^CAborted</span><span style="color:#F97583;">!</span></span>
<span class="line"><span style="color:#E1E4E8;">[root@pg_node1 </span><span style="color:#F97583;">~</span><span style="color:#E1E4E8;">]# patronictl switchover</span></span>
<span class="line"><span style="color:#B392F0;">Master</span><span style="color:#E1E4E8;"> [pg1]: </span></span>
<span class="line"><span style="color:#B392F0;">Candidate</span><span style="color:#E1E4E8;"> [</span><span style="color:#9ECBFF;">&#39;pg2&#39;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&#39;pg3&#39;]</span><span style="color:#E1E4E8;"> []: pg2</span></span>
<span class="line"><span style="color:#B392F0;">When</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">should</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">the</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">switchover</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">take</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">place</span><span style="color:#E1E4E8;"> (e.g. </span><span style="color:#79B8FF;">2021</span><span style="color:#9ECBFF;">-06-23T16:12</span><span style="color:#E1E4E8;"> )  [now]: </span></span>
<span class="line"><span style="color:#B392F0;">Current</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">cluster</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">topology</span></span>
<span class="line"><span style="color:#B392F0;">+</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Cluster:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">twpg</span><span style="color:#E1E4E8;"> (6976142033405049133) ---+---------+----+-----------+</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Member</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Host</span><span style="color:#E1E4E8;">                </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Role</span><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">State</span><span style="color:#E1E4E8;">   </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">TL</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Lag</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">in</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">MB</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#B392F0;">+--------+---------------------+---------+---------+----+-----------+</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">pg1</span><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">192.168.210.15:5432</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Leader</span><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">running</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">11</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">           </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">pg2</span><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">192.168.210.81:5432</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Replica</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">running</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">11</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">       </span><span style="color:#B392F0;">0.0</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">pg3</span><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">192.168.210.33:5432</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Replica</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">running</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">11</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">       </span><span style="color:#B392F0;">0.0</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#B392F0;">+--------+---------------------+---------+---------+----+-----------+</span></span>
<span class="line"><span style="color:#B392F0;">Are</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">you</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">sure</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">you</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">want</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">to</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">switchover</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">cluster</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">twpg,</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">demoting</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">current</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">master</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg1?</span><span style="color:#E1E4E8;"> [y/N]: y  </span></span>
<span class="line"><span style="color:#B392F0;">2021-06-23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">15</span><span style="color:#9ECBFF;">:13:26.97922</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Successfully</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">switched</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">over</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">to</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;pg2&quot;</span></span>
<span class="line"><span style="color:#B392F0;">+</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Cluster:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">twpg</span><span style="color:#E1E4E8;"> (6976142033405049133) ---+---------+----+-----------+</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Member</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Host</span><span style="color:#E1E4E8;">                </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Role</span><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">State</span><span style="color:#E1E4E8;">   </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">TL</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Lag</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">in</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">MB</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#B392F0;">+--------+---------------------+---------+---------+----+-----------+</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">pg1</span><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">192.168.210.15:5432</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Replica</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">stopped</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">   </span><span style="color:#B392F0;">unknown</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">pg2</span><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">192.168.210.81:5432</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Leader</span><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">running</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">11</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">           </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">pg3</span><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">192.168.210.33:5432</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Replica</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">running</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">11</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">       </span><span style="color:#B392F0;">0.0</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#B392F0;">+--------+---------------------+---------+---------+----+-----------+</span></span>
<span class="line"><span style="color:#E1E4E8;">[root@pg_node1 </span><span style="color:#F97583;">~</span><span style="color:#E1E4E8;">]# patronictl list</span></span>
<span class="line"><span style="color:#B392F0;">+</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Cluster:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">twpg</span><span style="color:#E1E4E8;"> (6976142033405049133) ---+---------+----+-----------+</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Member</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Host</span><span style="color:#E1E4E8;">                </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Role</span><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">State</span><span style="color:#E1E4E8;">   </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">TL</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Lag</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">in</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">MB</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#B392F0;">+--------+---------------------+---------+---------+----+-----------+</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">pg1</span><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">192.168.210.15:5432</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Replica</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">stopped</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">   </span><span style="color:#B392F0;">unknown</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">pg2</span><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">192.168.210.81:5432</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Leader</span><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">running</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">12</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">           </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">pg3</span><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">192.168.210.33:5432</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Replica</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">running</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">11</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">       </span><span style="color:#B392F0;">0.0</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#B392F0;">+--------+---------------------+---------+---------+----+-----------+</span></span>
<span class="line"><span style="color:#E1E4E8;">[root@pg_node1 </span><span style="color:#F97583;">~</span><span style="color:#E1E4E8;">]# patronictl list</span></span>
<span class="line"><span style="color:#B392F0;">+</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Cluster:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">twpg</span><span style="color:#E1E4E8;"> (6976142033405049133) ---+---------+----+-----------+</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Member</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Host</span><span style="color:#E1E4E8;">                </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Role</span><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">State</span><span style="color:#E1E4E8;">   </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">TL</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Lag</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">in</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">MB</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#B392F0;">+--------+---------------------+---------+---------+----+-----------+</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">pg1</span><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">192.168.210.15:5432</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Replica</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">running</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">12</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">       </span><span style="color:#B392F0;">0.0</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">pg2</span><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">192.168.210.81:5432</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Leader</span><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">running</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">12</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">           </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">pg3</span><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">192.168.210.33:5432</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Replica</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">running</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">12</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">       </span><span style="color:#B392F0;">0.0</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#B392F0;">+--------+---------------------+---------+---------+----+-----------+</span></span>
<span class="line"><span style="color:#6A737D;">#日志信息如下：</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">15</span><span style="color:#9ECBFF;">:13:16</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2021</span><span style="color:#9ECBFF;">-06-23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">15</span><span style="color:#9ECBFF;">:13:16,311</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">INFO:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Lock</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">owner:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg1</span><span style="color:#E1E4E8;">; </span><span style="color:#B392F0;">I</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">am</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg1</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">15</span><span style="color:#9ECBFF;">:13:16</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2021</span><span style="color:#9ECBFF;">-06-23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">15</span><span style="color:#9ECBFF;">:13:16,316</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">INFO:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">no</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">action.</span><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">i</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">am</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">the</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">leader</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">with</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">the</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">lock</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">15</span><span style="color:#9ECBFF;">:13:24</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2021</span><span style="color:#9ECBFF;">-06-23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">15</span><span style="color:#9ECBFF;">:13:24,854</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">INFO:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">received</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">switchover</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">request</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">with</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">leader=pg1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">candidate=pg2</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">scheduled_at=None</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">15</span><span style="color:#9ECBFF;">:13:24</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2021</span><span style="color:#9ECBFF;">-06-23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">15</span><span style="color:#9ECBFF;">:13:24,879</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">INFO:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Got</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">response</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">from</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg2</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">http://192.168.210.81:8008/patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">{&quot;database_system_identifier&quot;:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;6976142033405049133&quot;,</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;postmaster_start_time&quot;:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;2021-06-23 14:25:40.252 CST&quot;,</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;timeline&quot;:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">11</span><span style="color:#9ECBFF;">,</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;cluster_unlocked&quot;:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">false</span><span style="color:#9ECBFF;">,</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;patroni&quot;:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">{&quot;scope&quot;:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;twpg&quot;,</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;version&quot;:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;2.0.2&quot;},</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;state&quot;:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;running&quot;,</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;role&quot;:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;replica&quot;,</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;xlog&quot;:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">{&quot;received_location&quot;:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">84186784</span><span style="color:#9ECBFF;">,</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;replayed_timestamp&quot;:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;2021-06-23 14:25:40.045 CST&quot;,</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;paused&quot;:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">false</span><span style="color:#9ECBFF;">,</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;replayed_location&quot;:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">84186784</span><span style="color:#9ECBFF;">},</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;server_version&quot;:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">130003</span><span style="color:#9ECBFF;">}</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">15</span><span style="color:#9ECBFF;">:13:25</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2021</span><span style="color:#9ECBFF;">-06-23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">15</span><span style="color:#9ECBFF;">:13:25,011</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">INFO:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Lock</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">owner:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg1</span><span style="color:#E1E4E8;">; </span><span style="color:#B392F0;">I</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">am</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg1</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">15</span><span style="color:#9ECBFF;">:13:25</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2021</span><span style="color:#9ECBFF;">-06-23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">15</span><span style="color:#9ECBFF;">:13:25,031</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">INFO:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Got</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">response</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">from</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg2</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">http://192.168.210.81:8008/patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">{&quot;database_system_identifier&quot;:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;6976142033405049133&quot;,</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;postmaster_start_time&quot;:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;2021-06-23 14:25:40.252 CST&quot;,</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;timeline&quot;:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">11</span><span style="color:#9ECBFF;">,</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;cluster_unlocked&quot;:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">false</span><span style="color:#9ECBFF;">,</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;patroni&quot;:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">{&quot;scope&quot;:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;twpg&quot;,</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;version&quot;:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;2.0.2&quot;},</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;state&quot;:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;running&quot;,</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;role&quot;:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;replica&quot;,</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;xlog&quot;:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">{&quot;received_location&quot;:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">84186784</span><span style="color:#9ECBFF;">,</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;replayed_timestamp&quot;:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;2021-06-23 14:25:40.045 CST&quot;,</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;paused&quot;:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">false</span><span style="color:#9ECBFF;">,</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;replayed_location&quot;:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">84186784</span><span style="color:#9ECBFF;">},</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;server_version&quot;:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">130003</span><span style="color:#9ECBFF;">}</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">15</span><span style="color:#9ECBFF;">:13:25</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2021</span><span style="color:#9ECBFF;">-06-23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">15</span><span style="color:#9ECBFF;">:13:25,134</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">INFO:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">manual</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">failover:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">demoting</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">myself</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">15</span><span style="color:#9ECBFF;">:13:25</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2021</span><span style="color:#9ECBFF;">-06-23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">15</span><span style="color:#9ECBFF;">:13:25.222</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">CST</span><span style="color:#E1E4E8;"> [4256] LOG:  received fast shutdown request</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">15</span><span style="color:#9ECBFF;">:13:25</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2021</span><span style="color:#9ECBFF;">-06-23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">15</span><span style="color:#9ECBFF;">:13:25.234</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">CST</span><span style="color:#E1E4E8;"> [4256] LOG:  aborting any active transactions</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">15</span><span style="color:#9ECBFF;">:13:25</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2021</span><span style="color:#9ECBFF;">-06-23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">15</span><span style="color:#9ECBFF;">:13:25.234</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">CST</span><span style="color:#E1E4E8;"> [4270] FATAL:  terminating connection due to administrator command</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">15</span><span style="color:#9ECBFF;">:13:25</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2021</span><span style="color:#9ECBFF;">-06-23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">15</span><span style="color:#9ECBFF;">:13:25.235</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">CST</span><span style="color:#E1E4E8;"> [4256] LOG:  background worker </span><span style="color:#9ECBFF;">&quot;logical replication launcher&quot;</span><span style="color:#E1E4E8;"> (</span><span style="color:#B392F0;">PID</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">4522</span><span style="color:#E1E4E8;">) exited with exit code 1</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">15</span><span style="color:#9ECBFF;">:13:25</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2021</span><span style="color:#9ECBFF;">-06-23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">15</span><span style="color:#9ECBFF;">:13:25.237</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">CST</span><span style="color:#E1E4E8;"> [4259] LOG:  shutting down</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">15</span><span style="color:#9ECBFF;">:13:25</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2021</span><span style="color:#9ECBFF;">-06-23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">15</span><span style="color:#9ECBFF;">:13:25.306</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">CST</span><span style="color:#E1E4E8;"> [4256] LOG:  database system is shut down</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">15</span><span style="color:#9ECBFF;">:13:26</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">this</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">is</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">callback</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">on_stop</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">master</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">twpg</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">15</span><span style="color:#9ECBFF;">:13:26</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">systemd:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Started</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Session</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">c5</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">of</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">user</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">root.</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">15</span><span style="color:#9ECBFF;">:13:26</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2021</span><span style="color:#9ECBFF;">-06-23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">15</span><span style="color:#9ECBFF;">:13:26,275</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">INFO:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Leader</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">key</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">released</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">15</span><span style="color:#9ECBFF;">:13:26</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2021</span><span style="color:#9ECBFF;">-06-23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">15</span><span style="color:#9ECBFF;">:13:26,277</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">INFO:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Lock</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">owner:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">None</span><span style="color:#E1E4E8;">; </span><span style="color:#B392F0;">I</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">am</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg1</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">15</span><span style="color:#9ECBFF;">:13:26</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2021</span><span style="color:#9ECBFF;">-06-23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">15</span><span style="color:#9ECBFF;">:13:26,277</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">INFO:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">not</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">healthy</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">enough</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">for</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">leader</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">race</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">15</span><span style="color:#9ECBFF;">:13:26</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2021</span><span style="color:#9ECBFF;">-06-23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">15</span><span style="color:#9ECBFF;">:13:26,277</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">INFO:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">manual</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">failover:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">demote</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">in</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">progress</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">15</span><span style="color:#9ECBFF;">:13:26</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2021</span><span style="color:#9ECBFF;">-06-23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">15</span><span style="color:#9ECBFF;">:13:26,278</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">INFO:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Lock</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">owner:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">None</span><span style="color:#E1E4E8;">; </span><span style="color:#B392F0;">I</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">am</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg1</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">15</span><span style="color:#9ECBFF;">:13:26</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2021</span><span style="color:#9ECBFF;">-06-23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">15</span><span style="color:#9ECBFF;">:13:26,279</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">INFO:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">not</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">healthy</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">enough</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">for</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">leader</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">race</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">15</span><span style="color:#9ECBFF;">:13:26</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2021</span><span style="color:#9ECBFF;">-06-23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">15</span><span style="color:#9ECBFF;">:13:26,279</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">INFO:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">manual</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">failover:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">demote</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">in</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">progress</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">15</span><span style="color:#9ECBFF;">:13:26</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2021</span><span style="color:#9ECBFF;">-06-23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">15</span><span style="color:#9ECBFF;">:13:26,296</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">INFO:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Lock</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">owner:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg2</span><span style="color:#E1E4E8;">; </span><span style="color:#B392F0;">I</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">am</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg1</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">15</span><span style="color:#9ECBFF;">:13:26</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2021</span><span style="color:#9ECBFF;">-06-23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">15</span><span style="color:#9ECBFF;">:13:26,297</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">INFO:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">manual</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">failover:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">demote</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">in</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">progress</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">15</span><span style="color:#9ECBFF;">:13:27</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2021</span><span style="color:#9ECBFF;">-06-23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">15</span><span style="color:#9ECBFF;">:13:27,416</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">INFO:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Lock</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">owner:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg2</span><span style="color:#E1E4E8;">; </span><span style="color:#B392F0;">I</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">am</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg1</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">15</span><span style="color:#9ECBFF;">:13:27</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2021</span><span style="color:#9ECBFF;">-06-23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">15</span><span style="color:#9ECBFF;">:13:27,417</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">INFO:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">manual</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">failover:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">demote</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">in</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">progress</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">15</span><span style="color:#9ECBFF;">:13:27</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2021</span><span style="color:#9ECBFF;">-06-23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">15</span><span style="color:#9ECBFF;">:13:27,532</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">INFO:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Lock</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">owner:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg2</span><span style="color:#E1E4E8;">; </span><span style="color:#B392F0;">I</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">am</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg1</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">15</span><span style="color:#9ECBFF;">:13:27</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2021</span><span style="color:#9ECBFF;">-06-23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">15</span><span style="color:#9ECBFF;">:13:27,532</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">INFO:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">manual</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">failover:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">demote</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">in</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">progress</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">15</span><span style="color:#9ECBFF;">:13:28</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2021</span><span style="color:#9ECBFF;">-06-23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">15</span><span style="color:#9ECBFF;">:13:28,292</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">INFO:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Local</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">timeline=</span><span style="color:#79B8FF;">11</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">lsn=</span><span style="color:#79B8FF;">0</span><span style="color:#9ECBFF;">/5049750</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">15</span><span style="color:#9ECBFF;">:13:28</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2021</span><span style="color:#9ECBFF;">-06-23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">15</span><span style="color:#9ECBFF;">:13:28,300</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">INFO:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">master_timeline=</span><span style="color:#79B8FF;">12</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">15</span><span style="color:#9ECBFF;">:13:28</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2021</span><span style="color:#9ECBFF;">-06-23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">15</span><span style="color:#9ECBFF;">:13:28,315</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">INFO:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">master:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">history=</span><span style="color:#79B8FF;">8#0110</span><span style="color:#9ECBFF;">/5014B48#011no</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">recovery</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">target</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">specified</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">15</span><span style="color:#9ECBFF;">:13:28</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">9#0110</span><span style="color:#9ECBFF;">/502CCE8#011no</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">recovery</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">target</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">specified</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">15</span><span style="color:#9ECBFF;">:13:28</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">10#0110</span><span style="color:#9ECBFF;">/5048A98#011no</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">recovery</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">target</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">specified</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">15</span><span style="color:#9ECBFF;">:13:28</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">11#0110</span><span style="color:#9ECBFF;">/50497C8#011no</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">recovery</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">target</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">specified</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">15</span><span style="color:#9ECBFF;">:13:28</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2021</span><span style="color:#9ECBFF;">-06-23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">15</span><span style="color:#9ECBFF;">:13:28,317</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">INFO:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">closed</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">connection</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">to</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">the</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">postgresql</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">cluster</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">15</span><span style="color:#9ECBFF;">:13:28</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2021</span><span style="color:#9ECBFF;">-06-23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">15</span><span style="color:#9ECBFF;">:13:28,348</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">INFO:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">postmaster</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pid=</span><span style="color:#79B8FF;">4739</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">15</span><span style="color:#9ECBFF;">:13:28</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">localhost:5432</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">-</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">no</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">response</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">15</span><span style="color:#9ECBFF;">:13:28</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2021</span><span style="color:#9ECBFF;">-06-23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">15</span><span style="color:#9ECBFF;">:13:28.386</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">CST</span><span style="color:#E1E4E8;"> [4739] LOG:  starting PostgreSQL 13.3 on x86_64-pc-linux-gnu, compiled by gcc (</span><span style="color:#B392F0;">GCC</span><span style="color:#E1E4E8;">) 4.8.5 20150623 (</span><span style="color:#B392F0;">Red</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Hat</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">4.8</span><span style="color:#9ECBFF;">.5-44</span><span style="color:#E1E4E8;">), 64-bit</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">15</span><span style="color:#9ECBFF;">:13:28</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2021</span><span style="color:#9ECBFF;">-06-23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">15</span><span style="color:#9ECBFF;">:13:28.386</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">CST</span><span style="color:#E1E4E8;"> [4739] LOG:  listening on IPv4 address </span><span style="color:#9ECBFF;">&quot;0.0.0.0&quot;</span><span style="color:#E1E4E8;">, port 5432</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">15</span><span style="color:#9ECBFF;">:13:28</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2021</span><span style="color:#9ECBFF;">-06-23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">15</span><span style="color:#9ECBFF;">:13:28.401</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">CST</span><span style="color:#E1E4E8;"> [4739] LOG:  listening on Unix socket </span><span style="color:#9ECBFF;">&quot;/tmp/.s.PGSQL.5432&quot;</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">15</span><span style="color:#9ECBFF;">:13:28</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2021</span><span style="color:#9ECBFF;">-06-23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">15</span><span style="color:#9ECBFF;">:13:28.417</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">CST</span><span style="color:#E1E4E8;"> [4741] LOG:  database system was shut down at 2021-06-23 15:13:25 CST</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">15</span><span style="color:#9ECBFF;">:13:28</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2021</span><span style="color:#9ECBFF;">-06-23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">15</span><span style="color:#9ECBFF;">:13:28.418</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">CST</span><span style="color:#E1E4E8;"> [4741] LOG:  entering standby mode</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">15</span><span style="color:#9ECBFF;">:13:28</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2021</span><span style="color:#9ECBFF;">-06-23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">15</span><span style="color:#9ECBFF;">:13:28.428</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">CST</span><span style="color:#E1E4E8;"> [4741] LOG:  consistent recovery state reached at 0/50497C8</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">15</span><span style="color:#9ECBFF;">:13:28</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2021</span><span style="color:#9ECBFF;">-06-23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">15</span><span style="color:#9ECBFF;">:13:28.428</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">CST</span><span style="color:#E1E4E8;"> [4741] LOG:  invalid record length at 0/50497C8: wanted 24, got 0</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">15</span><span style="color:#9ECBFF;">:13:28</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2021</span><span style="color:#9ECBFF;">-06-23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">15</span><span style="color:#9ECBFF;">:13:28.429</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">CST</span><span style="color:#E1E4E8;"> [4739] LOG:  database system is ready to accept read only connections</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">15</span><span style="color:#9ECBFF;">:13:28</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2021</span><span style="color:#9ECBFF;">-06-23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">15</span><span style="color:#9ECBFF;">:13:28.447</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">CST</span><span style="color:#E1E4E8;"> [4745] LOG:  fetching timeline history file </span><span style="color:#F97583;">for</span><span style="color:#E1E4E8;"> timeline 12 from primary server</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">15</span><span style="color:#9ECBFF;">:13:28</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2021</span><span style="color:#9ECBFF;">-06-23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">15</span><span style="color:#9ECBFF;">:13:28.460</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">CST</span><span style="color:#E1E4E8;"> [4745] LOG:  started streaming WAL from primary at 0/5000000 on timeline 11</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">15</span><span style="color:#9ECBFF;">:13:28</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2021</span><span style="color:#9ECBFF;">-06-23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">15</span><span style="color:#9ECBFF;">:13:28.463</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">CST</span><span style="color:#E1E4E8;"> [4745] LOG:  replication terminated by primary server</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">15</span><span style="color:#9ECBFF;">:13:28</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2021</span><span style="color:#9ECBFF;">-06-23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">15</span><span style="color:#9ECBFF;">:13:28.463</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">CST</span><span style="color:#E1E4E8;"> [4745] DETAIL:  End of WAL reached on timeline 11 at 0/50497C8.</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">15</span><span style="color:#9ECBFF;">:13:28</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2021</span><span style="color:#9ECBFF;">-06-23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">15</span><span style="color:#9ECBFF;">:13:28.463</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">CST</span><span style="color:#E1E4E8;"> [4741] LOG:  new target timeline is 12</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">15</span><span style="color:#9ECBFF;">:13:28</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2021</span><span style="color:#9ECBFF;">-06-23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">15</span><span style="color:#9ECBFF;">:13:28.464</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">CST</span><span style="color:#E1E4E8;"> [4745] LOG:  restarted WAL streaming at 0/5000000 on timeline 12</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">15</span><span style="color:#9ECBFF;">:13:28</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2021</span><span style="color:#9ECBFF;">-06-23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">15</span><span style="color:#9ECBFF;">:13:28.703</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">CST</span><span style="color:#E1E4E8;"> [4741] LOG:  redo starts at 0/50497C8</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">15</span><span style="color:#9ECBFF;">:13:29</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">localhost:5432</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">-</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">accepting</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">connections</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">15</span><span style="color:#9ECBFF;">:13:29</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">localhost:5432</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">-</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">accepting</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">connections</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">15</span><span style="color:#9ECBFF;">:13:29</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">this</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">is</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">callback</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">on_role_change</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">replica</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">twpg</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">15</span><span style="color:#9ECBFF;">:13:29</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">systemd:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Started</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Session</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">c6</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">of</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">user</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">root.</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">15</span><span style="color:#9ECBFF;">:13:37</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2021</span><span style="color:#9ECBFF;">-06-23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">15</span><span style="color:#9ECBFF;">:13:37,534</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">INFO:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Lock</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">owner:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg2</span><span style="color:#E1E4E8;">; </span><span style="color:#B392F0;">I</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">am</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg1</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">15</span><span style="color:#9ECBFF;">:13:37</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2021</span><span style="color:#9ECBFF;">-06-23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">15</span><span style="color:#9ECBFF;">:13:37,534</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">INFO:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">does</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">not</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">have</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">lock</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">15</span><span style="color:#9ECBFF;">:13:37</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2021</span><span style="color:#9ECBFF;">-06-23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">15</span><span style="color:#9ECBFF;">:13:37,535</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">INFO:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">establishing</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">a</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">new</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">connection</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">to</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">the</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">postgres</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">cluster</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">15</span><span style="color:#9ECBFF;">:13:37</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2021</span><span style="color:#9ECBFF;">-06-23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">15</span><span style="color:#9ECBFF;">:13:37,579</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">INFO:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">no</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">action.</span><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">i</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">am</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">a</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">secondary</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">and</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">i</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">am</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">following</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">a</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">leader</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#手工failover</span></span>
<span class="line"><span style="color:#E1E4E8;">[root@pg_node1 </span><span style="color:#F97583;">~</span><span style="color:#E1E4E8;">]# patronictl failover</span></span>
<span class="line"><span style="color:#B392F0;">Candidate</span><span style="color:#E1E4E8;"> [</span><span style="color:#9ECBFF;">&#39;pg1&#39;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&#39;pg3&#39;]</span><span style="color:#E1E4E8;"> []: pg1</span></span>
<span class="line"><span style="color:#B392F0;">Current</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">cluster</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">topology</span></span>
<span class="line"><span style="color:#B392F0;">+</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Cluster:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">twpg</span><span style="color:#E1E4E8;"> (6976142033405049133) ---+---------+----+-----------+</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Member</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Host</span><span style="color:#E1E4E8;">                </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Role</span><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">State</span><span style="color:#E1E4E8;">   </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">TL</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Lag</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">in</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">MB</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#B392F0;">+--------+---------------------+---------+---------+----+-----------+</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">pg1</span><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">192.168.210.15:5432</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Replica</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">running</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">12</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">       </span><span style="color:#B392F0;">0.0</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">pg2</span><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">192.168.210.81:5432</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Leader</span><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">running</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">12</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">           </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">pg3</span><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">192.168.210.33:5432</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Replica</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">running</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">12</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">       </span><span style="color:#B392F0;">0.0</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#B392F0;">+--------+---------------------+---------+---------+----+-----------+</span></span>
<span class="line"><span style="color:#B392F0;">Are</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">you</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">sure</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">you</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">want</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">to</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">failover</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">cluster</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">twpg,</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">demoting</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">current</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">master</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg2?</span><span style="color:#E1E4E8;"> [y/N]: y</span></span>
<span class="line"><span style="color:#B392F0;">2021-06-23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">15</span><span style="color:#9ECBFF;">:17:33.25244</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Successfully</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">failed</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">over</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">to</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;pg1&quot;</span></span>
<span class="line"><span style="color:#B392F0;">+</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Cluster:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">twpg</span><span style="color:#E1E4E8;"> (6976142033405049133) ---+---------+----+-----------+</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Member</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Host</span><span style="color:#E1E4E8;">                </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Role</span><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">State</span><span style="color:#E1E4E8;">   </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">TL</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Lag</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">in</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">MB</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#B392F0;">+--------+---------------------+---------+---------+----+-----------+</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">pg1</span><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">192.168.210.15:5432</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Leader</span><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">running</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">12</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">           </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">pg2</span><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">192.168.210.81:5432</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Replica</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">stopped</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">   </span><span style="color:#B392F0;">unknown</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">pg3</span><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">192.168.210.33:5432</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Replica</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">running</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">12</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">       </span><span style="color:#B392F0;">0.0</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#B392F0;">+--------+---------------------+---------+---------+----+-----------+</span></span>
<span class="line"><span style="color:#E1E4E8;">[root@pg_node1 </span><span style="color:#F97583;">~</span><span style="color:#E1E4E8;">]# patronictl list</span></span>
<span class="line"><span style="color:#B392F0;">+</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Cluster:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">twpg</span><span style="color:#E1E4E8;"> (6976142033405049133) ---+---------+----+-----------+</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Member</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Host</span><span style="color:#E1E4E8;">                </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Role</span><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">State</span><span style="color:#E1E4E8;">   </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">TL</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Lag</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">in</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">MB</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#B392F0;">+--------+---------------------+---------+---------+----+-----------+</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">pg1</span><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">192.168.210.15:5432</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Leader</span><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">running</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">13</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">           </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">pg2</span><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">192.168.210.81:5432</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Replica</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">stopped</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">   </span><span style="color:#B392F0;">unknown</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">pg3</span><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">192.168.210.33:5432</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Replica</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">running</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">13</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">       </span><span style="color:#B392F0;">0.0</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#B392F0;">+--------+---------------------+---------+---------+----+-----------+</span></span>
<span class="line"><span style="color:#E1E4E8;">[root@pg_node1 </span><span style="color:#F97583;">~</span><span style="color:#E1E4E8;">]# patronictl list</span></span>
<span class="line"><span style="color:#B392F0;">+</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Cluster:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">twpg</span><span style="color:#E1E4E8;"> (6976142033405049133) ---+---------+----+-----------+</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Member</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Host</span><span style="color:#E1E4E8;">                </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Role</span><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">State</span><span style="color:#E1E4E8;">   </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">TL</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Lag</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">in</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">MB</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#B392F0;">+--------+---------------------+---------+---------+----+-----------+</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">pg1</span><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">192.168.210.15:5432</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Leader</span><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">running</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">13</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">           </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">pg2</span><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">192.168.210.81:5432</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Replica</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">running</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">13</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">       </span><span style="color:#B392F0;">0.0</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">pg3</span><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">192.168.210.33:5432</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Replica</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">running</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">13</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">       </span><span style="color:#B392F0;">0.0</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#B392F0;">+--------+---------------------+---------+---------+----+-----------+</span></span>
<span class="line"><span style="color:#6A737D;">#日志信息如下：</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">15</span><span style="color:#9ECBFF;">:17:27</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2021</span><span style="color:#9ECBFF;">-06-23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">15</span><span style="color:#9ECBFF;">:17:27,609</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">INFO:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Lock</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">owner:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg2</span><span style="color:#E1E4E8;">; </span><span style="color:#B392F0;">I</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">am</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg1</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">15</span><span style="color:#9ECBFF;">:17:27</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2021</span><span style="color:#9ECBFF;">-06-23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">15</span><span style="color:#9ECBFF;">:17:27,609</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">INFO:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">does</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">not</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">have</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">lock</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">15</span><span style="color:#9ECBFF;">:17:27</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2021</span><span style="color:#9ECBFF;">-06-23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">15</span><span style="color:#9ECBFF;">:17:27,612</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">INFO:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">no</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">action.</span><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">i</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">am</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">a</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">secondary</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">and</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">i</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">am</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">following</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">a</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">leader</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">15</span><span style="color:#9ECBFF;">:17:31</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2021</span><span style="color:#9ECBFF;">-06-23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">15</span><span style="color:#9ECBFF;">:17:31.544</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">CST</span><span style="color:#E1E4E8;"> [4745] LOG:  replication terminated by primary server</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">15</span><span style="color:#9ECBFF;">:17:31</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2021</span><span style="color:#9ECBFF;">-06-23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">15</span><span style="color:#9ECBFF;">:17:31.544</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">CST</span><span style="color:#E1E4E8;"> [4745] DETAIL:  End of WAL reached on timeline 12 at 0/504A428.</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">15</span><span style="color:#9ECBFF;">:17:31</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2021</span><span style="color:#9ECBFF;">-06-23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">15</span><span style="color:#9ECBFF;">:17:31.544</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">CST</span><span style="color:#E1E4E8;"> [4745] FATAL:  could not send end-of-streaming message to primary: no COPY </span><span style="color:#F97583;">in</span><span style="color:#E1E4E8;"> progress</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">15</span><span style="color:#9ECBFF;">:17:31</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2021</span><span style="color:#9ECBFF;">-06-23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">15</span><span style="color:#9ECBFF;">:17:31.545</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">CST</span><span style="color:#E1E4E8;"> [4741] LOG:  invalid record length at 0/504A428: wanted 24, got 0</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">15</span><span style="color:#9ECBFF;">:17:31</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2021</span><span style="color:#9ECBFF;">-06-23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">15</span><span style="color:#9ECBFF;">:17:31.550</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">CST</span><span style="color:#E1E4E8;"> [4810] FATAL:  could not connect to the primary server: could not connect to server: Connection refused</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">15</span><span style="color:#9ECBFF;">:17:31</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Is</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">the</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">server</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">running</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">on</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">host</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;192.168.210.81&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">and</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">accepting</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">15</span><span style="color:#9ECBFF;">:17:31</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">TCP/IP</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">connections</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">on</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">port</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5432</span><span style="color:#9ECBFF;">?</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">15</span><span style="color:#9ECBFF;">:17:32</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2021</span><span style="color:#9ECBFF;">-06-23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">15</span><span style="color:#9ECBFF;">:17:32,556</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">INFO:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Cleaning</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">up</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">failover</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">key</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">after</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">acquiring</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">leader</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">lock...</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">15</span><span style="color:#9ECBFF;">:17:32</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2021</span><span style="color:#9ECBFF;">-06-23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">15</span><span style="color:#9ECBFF;">:17:32,565</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">INFO:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Software</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Watchdog</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">activated</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">with</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">25</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">second</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">timeout,</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">timing</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">slack</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">15</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">seconds</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;">#激活看门狗</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">15</span><span style="color:#9ECBFF;">:17:32</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2021</span><span style="color:#9ECBFF;">-06-23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">15</span><span style="color:#9ECBFF;">:17:32,577</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">INFO:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">promoted</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">self</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">to</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">leader</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">by</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">acquiring</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">session</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">lock</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">15</span><span style="color:#9ECBFF;">:17:32</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">server</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">promoting</span><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;">#数据库提升</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">15</span><span style="color:#9ECBFF;">:17:32</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2021</span><span style="color:#9ECBFF;">-06-23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">15</span><span style="color:#9ECBFF;">:17:32,579</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">INFO:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Lock</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">owner:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg1</span><span style="color:#E1E4E8;">; </span><span style="color:#B392F0;">I</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">am</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg1</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">15</span><span style="color:#9ECBFF;">:17:32</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2021</span><span style="color:#9ECBFF;">-06-23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">15</span><span style="color:#9ECBFF;">:17:32.589</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">CST</span><span style="color:#E1E4E8;"> [4741] LOG:  received promote request</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">15</span><span style="color:#9ECBFF;">:17:32</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2021</span><span style="color:#9ECBFF;">-06-23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">15</span><span style="color:#9ECBFF;">:17:32.589</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">CST</span><span style="color:#E1E4E8;"> [4741] LOG:  redo </span><span style="color:#F97583;">done</span><span style="color:#E1E4E8;"> at 0/504A3B0</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">15</span><span style="color:#9ECBFF;">:17:32</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2021</span><span style="color:#9ECBFF;">-06-23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">15</span><span style="color:#9ECBFF;">:17:32,593</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">INFO:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">cleared</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">rewind</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">state</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">after</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">becoming</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">the</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">leader</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">15</span><span style="color:#9ECBFF;">:17:32</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2021</span><span style="color:#9ECBFF;">-06-23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">15</span><span style="color:#9ECBFF;">:17:32.594</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">CST</span><span style="color:#E1E4E8;"> [4741] LOG:  selected new timeline ID: 13</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">15</span><span style="color:#9ECBFF;">:17:32</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">this</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">is</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">callback</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">on_role_change</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">master</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">twpg</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;">#回调VIP漂移脚本</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">15</span><span style="color:#9ECBFF;">:17:32</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2021</span><span style="color:#9ECBFF;">-06-23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">15</span><span style="color:#9ECBFF;">:17:32,611</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">INFO:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">updated</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">leader</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">lock</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">during</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">promote</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">15</span><span style="color:#9ECBFF;">:17:32</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">systemd:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Started</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Session</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">c7</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">of</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">user</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">root.</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">15</span><span style="color:#9ECBFF;">:17:32</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">systemd:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Started</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Session</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">c8</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">of</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">user</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">root.</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">15</span><span style="color:#9ECBFF;">:17:32</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2021</span><span style="color:#9ECBFF;">-06-23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">15</span><span style="color:#9ECBFF;">:17:32.837</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">CST</span><span style="color:#E1E4E8;"> [4741] LOG:  archive recovery complete</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">15</span><span style="color:#9ECBFF;">:17:32</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2021</span><span style="color:#9ECBFF;">-06-23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">15</span><span style="color:#9ECBFF;">:17:32.869</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">CST</span><span style="color:#E1E4E8;"> [4739] LOG:  database system is ready to accept connections</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">15</span><span style="color:#9ECBFF;">:17:33</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2021</span><span style="color:#9ECBFF;">-06-23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">15</span><span style="color:#9ECBFF;">:17:33,631</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">INFO:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Lock</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">owner:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg1</span><span style="color:#E1E4E8;">; </span><span style="color:#B392F0;">I</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">am</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg1</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">15</span><span style="color:#9ECBFF;">:17:33</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2021</span><span style="color:#9ECBFF;">-06-23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">15</span><span style="color:#9ECBFF;">:17:33,772</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">INFO:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">no</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">action.</span><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">i</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">am</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">the</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">leader</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">with</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">the</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">lock</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#查看集群参数</span></span>
<span class="line"><span style="color:#E1E4E8;">[root@pg_node1 </span><span style="color:#F97583;">~</span><span style="color:#E1E4E8;">]# patronictl show-config</span></span>
<span class="line"><span style="color:#B392F0;">loop_wait:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">10</span></span>
<span class="line"><span style="color:#B392F0;">master_start_timeout:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">300</span></span>
<span class="line"><span style="color:#B392F0;">maximum_lag_on_failover:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">1048576</span></span>
<span class="line"><span style="color:#B392F0;">postgresql:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">parameters:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">hot_standby:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;on&#39;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">listen_addresses:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0.0</span><span style="color:#9ECBFF;">.0.0</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">max_replication_slots:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">10</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">max_wal_senders:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">10</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">port:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5432</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">wal_keep_segments:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">256</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">wal_level:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">replica</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">wal_log_hints:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;on&#39;</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">use_pg_rewind:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">true</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">use_slots:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">true</span></span>
<span class="line"><span style="color:#B392F0;">retry_timeout:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">10</span></span>
<span class="line"><span style="color:#B392F0;">synchronous_mode:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">false</span></span>
<span class="line"><span style="color:#B392F0;">ttl:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">30</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#修改PG参数</span></span>
<span class="line"><span style="color:#6A737D;">#例如修改shared_buffers: 1GB</span></span>
<span class="line"><span style="color:#E1E4E8;">[root@pg_node1 </span><span style="color:#F97583;">~</span><span style="color:#E1E4E8;">]# patronictl edit-config twpg</span></span>
<span class="line"><span style="color:#B392F0;">---</span><span style="color:#E1E4E8;"> </span></span>
<span class="line"><span style="color:#B392F0;">+++</span><span style="color:#E1E4E8;"> </span></span>
<span class="line"><span style="color:#B392F0;">@@</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-4,6</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">+4,7</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">@@</span></span>
<span class="line"><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">postgresql:</span></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#B392F0;">parameters:</span></span>
<span class="line"><span style="color:#E1E4E8;">     </span><span style="color:#B392F0;">hot_standby:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;on&#39;</span></span>
<span class="line"><span style="color:#B392F0;">+</span><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">shared_buffers:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;1GB&#39;</span></span>
<span class="line"><span style="color:#E1E4E8;">     </span><span style="color:#B392F0;">listen_addresses:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0.0</span><span style="color:#9ECBFF;">.0.0</span></span>
<span class="line"><span style="color:#E1E4E8;">     </span><span style="color:#B392F0;">max_replication_slots:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">10</span></span>
<span class="line"><span style="color:#E1E4E8;">     </span><span style="color:#B392F0;">max_wal_senders:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">10</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">Apply</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">these</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">changes?</span><span style="color:#E1E4E8;"> [y/N]: y</span></span>
<span class="line"><span style="color:#B392F0;">Configuration</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">changed</span></span>
<span class="line"><span style="color:#E1E4E8;">[root@pg_node1 </span><span style="color:#F97583;">~</span><span style="color:#E1E4E8;">]# patronictl restart twpg</span></span>
<span class="line"><span style="color:#B392F0;">+</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Cluster:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">twpg</span><span style="color:#E1E4E8;"> (6976142033405049133) ---+---------+----+-----------+-----------------+</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Member</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Host</span><span style="color:#E1E4E8;">                </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Role</span><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">State</span><span style="color:#E1E4E8;">   </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">TL</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Lag</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">in</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">MB</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Pending</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">restart</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#B392F0;">+--------+---------------------+---------+---------+----+-----------+-----------------+</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">pg1</span><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">192.168.210.15:5432</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Leader</span><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">running</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">13</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">           </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">*</span><span style="color:#E1E4E8;">               </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">pg2</span><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">192.168.210.81:5432</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Replica</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">running</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">13</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">       </span><span style="color:#B392F0;">0.0</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">*</span><span style="color:#E1E4E8;">               </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">pg3</span><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">192.168.210.33:5432</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Replica</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">running</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">13</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">       </span><span style="color:#B392F0;">0.0</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">*</span><span style="color:#E1E4E8;">               </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#B392F0;">+--------+---------------------+---------+---------+----+-----------+-----------------+</span></span>
<span class="line"><span style="color:#B392F0;">When</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">should</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">the</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">restart</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">take</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">place</span><span style="color:#E1E4E8;"> (e.g. </span><span style="color:#79B8FF;">2021</span><span style="color:#9ECBFF;">-06-23T16:45</span><span style="color:#E1E4E8;">)  [now]: </span></span>
<span class="line"><span style="color:#B392F0;">Are</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">you</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">sure</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">you</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">want</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">to</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">restart</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">members</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg2,</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg3,</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg1?</span><span style="color:#E1E4E8;"> [y/N]: y</span></span>
<span class="line"><span style="color:#B392F0;">Restart</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">if</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">the</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">PostgreSQL</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">version</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">is</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">less</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">than</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">provided</span><span style="color:#E1E4E8;"> (e.g. </span><span style="color:#79B8FF;">9.5</span><span style="color:#9ECBFF;">.2</span><span style="color:#E1E4E8;">)  []: </span></span>
<span class="line"><span style="color:#B392F0;">Success:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">restart</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">on</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">member</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg2</span></span>
<span class="line"><span style="color:#B392F0;">Success:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">restart</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">on</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">member</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg3</span></span>
<span class="line"><span style="color:#B392F0;">Success:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">restart</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">on</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">member</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg1</span></span>
<span class="line"><span style="color:#E1E4E8;">[root@pg_node2 </span><span style="color:#F97583;">~</span><span style="color:#E1E4E8;">]# psql -U twsm -d postgres -c </span><span style="color:#9ECBFF;">&#39;show shared_buffers;&#39;</span></span>
<span class="line"><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">shared_buffers</span><span style="color:#E1E4E8;"> </span></span>
<span class="line"><span style="color:#B392F0;">----------------</span></span>
<span class="line"><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">1GB</span></span>
<span class="line"><span style="color:#E1E4E8;">(</span><span style="color:#B392F0;">1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">row</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#或者通过REST API修改，例如：max_connections修改为1000</span></span>
<span class="line"><span style="color:#B392F0;">curl</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-s</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-XPATCH</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-d</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;{&quot;postgresql&quot;:{&quot;parameters&quot;:{&quot;max_connections&quot;:&quot;1000&quot;}}}&#39;</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">http://localhost:8008/config</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">jq</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">.</span></span>
<span class="line"><span style="color:#6A737D;">#如果想reset或是删除</span></span>
<span class="line"><span style="color:#B392F0;">curl</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-s</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-XPATCH</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-d</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;{&quot;postgresql&quot;:{&quot;parameters&quot;:{&quot;max_connections&quot;:null}}}&#39;</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">http://localhost:8008/config</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">jq</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">.</span></span>
<span class="line"><span style="color:#6A737D;">#修改max_connections需要重启（Pending restart）</span></span>
<span class="line"><span style="color:#E1E4E8;">[root@pg_node1 </span><span style="color:#F97583;">~</span><span style="color:#E1E4E8;">]# patronictl list</span></span>
<span class="line"><span style="color:#B392F0;">+</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Cluster:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">twpg</span><span style="color:#E1E4E8;"> (6976142033405049133) ---+---------+----+-----------+-----------------+</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Member</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Host</span><span style="color:#E1E4E8;">                </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Role</span><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">State</span><span style="color:#E1E4E8;">   </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">TL</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Lag</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">in</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">MB</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Pending</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">restart</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#B392F0;">+--------+---------------------+---------+---------+----+-----------+-----------------+</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">pg1</span><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">192.168.210.15:5432</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Replica</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">running</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">14</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">       </span><span style="color:#B392F0;">0.0</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">*</span><span style="color:#E1E4E8;">               </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">pg2</span><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">192.168.210.81:5432</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Replica</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">running</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">14</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">       </span><span style="color:#B392F0;">0.0</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">*</span><span style="color:#E1E4E8;">               </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">pg3</span><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">192.168.210.33:5432</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Leader</span><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">running</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">14</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">           </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">*</span><span style="color:#E1E4E8;">               </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#B392F0;">+--------+---------------------+---------+---------+----+-----------+-----------------+</span></span>
<span class="line"><span style="color:#6A737D;">#如果想无条件地完全重写现有的动态配置</span></span>
<span class="line"><span style="color:#B392F0;">curl</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-s</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-XPUT</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-d</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;{&quot;maximum_lag_on_failover&quot;:1048576,&quot;retry_timeout&quot;:10,&quot;postgresql&quot;:{&quot;use_slots&quot;:true,&quot;use_pg_rewind&quot;:true,&quot;parameters&quot;:{&quot;hot_standby&quot;:&quot;on&quot;,&quot;wal_log_hints&quot;:&quot;on&quot;,&quot;wal_level&quot;:&quot;hot_standby&quot;,&quot;unix_socket_directories&quot;:&quot;.&quot;,&quot;max_wal_senders&quot;:5}},&quot;loop_wait&quot;:3,&quot;ttl&quot;:20}&#39;</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">http://localhost:8008/config</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">jq</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#查看历史failovers/switchovers</span></span>
<span class="line"><span style="color:#E1E4E8;">[root@pg_node1 </span><span style="color:#F97583;">~</span><span style="color:#E1E4E8;">]# patronictl history</span></span>
<span class="line"><span style="color:#B392F0;">+----+----------+------------------------------+----------------------------------+</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">TL</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">      </span><span style="color:#B392F0;">LSN</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Reason</span><span style="color:#E1E4E8;">                       </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Timestamp</span><span style="color:#E1E4E8;">                        </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#B392F0;">+----+----------+------------------------------+----------------------------------+</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">1</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">25210568</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">no</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">recovery</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">target</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">specified</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">2021-06-21T15:24:42.878129+08:00</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">2</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">25211144</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">no</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">recovery</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">target</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">specified</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">2021-06-21T15:33:23.462860+08:00</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">3</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">83886408</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">no</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">recovery</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">target</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">specified</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">2021-06-23T09:28:25.304246+08:00</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">4</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">83886920</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">no</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">recovery</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">target</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">specified</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">2021-06-23T09:35:14.536083+08:00</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">5</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">83887496</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">no</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">recovery</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">target</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">specified</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">2021-06-23T09:37:56.880226+08:00</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">6</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">83888072</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">no</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">recovery</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">target</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">specified</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">2021-06-23T09:59:13.584445+08:00</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">7</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">83888704</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">no</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">recovery</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">target</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">specified</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">2021-06-23T12:39:14.897591+08:00</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">8</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">83970888</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">no</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">recovery</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">target</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">specified</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">2021-06-23T13:55:26.207367+08:00</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">9</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">84069608</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">no</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">recovery</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">target</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">specified</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">2021-06-23T14:24:48.030224+08:00</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">10</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">84183704</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">no</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">recovery</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">target</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">specified</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">2021-06-23T14:41:45.263156+08:00</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">11</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">84187080</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">no</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">recovery</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">target</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">specified</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">2021-06-23T15:13:26.627326+08:00</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">12</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">84190248</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">no</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">recovery</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">target</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">specified</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">2021-06-23T15:17:32.836962+08:00</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#B392F0;">+----+----------+------------------------------+----------------------------------+</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#集群进入维护模式，防止自动故障转移</span></span>
<span class="line"><span style="color:#B392F0;">+----+----------+------------------------------+----------------------------------+</span></span>
<span class="line"><span style="color:#E1E4E8;">[root@pg_node1 </span><span style="color:#F97583;">~</span><span style="color:#E1E4E8;">]# patronictl pause</span></span>
<span class="line"><span style="color:#B392F0;">Success:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">cluster</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">management</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">is</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">paused</span></span>
<span class="line"><span style="color:#E1E4E8;">[root@pg_node1 </span><span style="color:#F97583;">~</span><span style="color:#E1E4E8;">]# patronictl list</span></span>
<span class="line"><span style="color:#B392F0;">+</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Cluster:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">twpg</span><span style="color:#E1E4E8;"> (6976142033405049133) ---+---------+----+-----------+</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Member</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Host</span><span style="color:#E1E4E8;">                </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Role</span><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">State</span><span style="color:#E1E4E8;">   </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">TL</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Lag</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">in</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">MB</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#B392F0;">+--------+---------------------+---------+---------+----+-----------+</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">pg1</span><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">192.168.210.15:5432</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Leader</span><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">running</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">13</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">           </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">pg2</span><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">192.168.210.81:5432</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Replica</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">running</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">13</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">       </span><span style="color:#B392F0;">0.0</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">pg3</span><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">192.168.210.33:5432</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Replica</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">running</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">13</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">       </span><span style="color:#B392F0;">0.0</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#B392F0;">+--------+---------------------+---------+---------+----+-----------+</span></span>
<span class="line"><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Maintenance</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">mode:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">on</span></span>
<span class="line"><span style="color:#6A737D;">#日志信息：</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">16</span><span style="color:#9ECBFF;">:00:02</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2021</span><span style="color:#9ECBFF;">-06-23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">16</span><span style="color:#9ECBFF;">:00:02,006</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">INFO:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Lock</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">owner:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg1</span><span style="color:#E1E4E8;">; </span><span style="color:#B392F0;">I</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">am</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg1</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">16</span><span style="color:#9ECBFF;">:00:02</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2021</span><span style="color:#9ECBFF;">-06-23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">16</span><span style="color:#9ECBFF;">:00:02,018</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">INFO:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">PAUSE:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">no</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">action.</span><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">i</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">am</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">the</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">leader</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">with</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">the</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">lock</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">16</span><span style="color:#9ECBFF;">:00:02</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2021</span><span style="color:#9ECBFF;">-06-23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">16</span><span style="color:#9ECBFF;">:00:02,028</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">INFO:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">No</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">PostgreSQL</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">configuration</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">items</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">changed,</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">nothing</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">to</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">reload.</span></span>
<span class="line"><span style="color:#6A737D;">#维护结束，恢复自动故障转移</span></span>
<span class="line"><span style="color:#E1E4E8;">[root@pg_node1 </span><span style="color:#F97583;">~</span><span style="color:#E1E4E8;">]# patronictl resume</span></span>
<span class="line"><span style="color:#B392F0;">Success:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">cluster</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">management</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">is</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">resumed</span></span>
<span class="line"><span style="color:#E1E4E8;">[root@pg_node1 </span><span style="color:#F97583;">~</span><span style="color:#E1E4E8;">]# patronictl list</span></span>
<span class="line"><span style="color:#B392F0;">+</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Cluster:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">twpg</span><span style="color:#E1E4E8;"> (6976142033405049133) ---+---------+----+-----------+</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Member</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Host</span><span style="color:#E1E4E8;">                </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Role</span><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">State</span><span style="color:#E1E4E8;">   </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">TL</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Lag</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">in</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">MB</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#B392F0;">+--------+---------------------+---------+---------+----+-----------+</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">pg1</span><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">192.168.210.15:5432</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Leader</span><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">running</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">13</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">           </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">pg2</span><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">192.168.210.81:5432</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Replica</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">running</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">13</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">       </span><span style="color:#B392F0;">0.0</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">pg3</span><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">192.168.210.33:5432</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Replica</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">running</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">13</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">       </span><span style="color:#B392F0;">0.0</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#B392F0;">+--------+---------------------+---------+---------+----+-----------+</span></span>
<span class="line"><span style="color:#6A737D;">#日志信息：</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">16</span><span style="color:#9ECBFF;">:02:32</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2021</span><span style="color:#9ECBFF;">-06-23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">16</span><span style="color:#9ECBFF;">:02:32,006</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">INFO:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Lock</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">owner:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg1</span><span style="color:#E1E4E8;">; </span><span style="color:#B392F0;">I</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">am</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg1</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">16</span><span style="color:#9ECBFF;">:02:32</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2021</span><span style="color:#9ECBFF;">-06-23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">16</span><span style="color:#9ECBFF;">:02:32,012</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">INFO:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">PAUSE:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">no</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">action.</span><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">i</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">am</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">the</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">leader</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">with</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">the</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">lock</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">16</span><span style="color:#9ECBFF;">:02:39</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2021</span><span style="color:#9ECBFF;">-06-23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">16</span><span style="color:#9ECBFF;">:02:39,565</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">INFO:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Lock</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">owner:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg1</span><span style="color:#E1E4E8;">; </span><span style="color:#B392F0;">I</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">am</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg1</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">16</span><span style="color:#9ECBFF;">:02:39</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2021</span><span style="color:#9ECBFF;">-06-23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">16</span><span style="color:#9ECBFF;">:02:39,572</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">INFO:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Software</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Watchdog</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">activated</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">with</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">25</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">second</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">timeout,</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">timing</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">slack</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">15</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">seconds</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">16</span><span style="color:#9ECBFF;">:02:39</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2021</span><span style="color:#9ECBFF;">-06-23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">16</span><span style="color:#9ECBFF;">:02:39,581</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">INFO:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">no</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">action.</span><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">i</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">am</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">the</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">leader</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">with</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">the</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">lock</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">16</span><span style="color:#9ECBFF;">:02:39</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2021</span><span style="color:#9ECBFF;">-06-23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">16</span><span style="color:#9ECBFF;">:02:39,588</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">INFO:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">No</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">PostgreSQL</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">configuration</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">items</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">changed,</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">nothing</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">to</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">reload.</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">16</span><span style="color:#9ECBFF;">:02:49</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2021</span><span style="color:#9ECBFF;">-06-23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">16</span><span style="color:#9ECBFF;">:02:49,552</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">INFO:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Lock</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">owner:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg1</span><span style="color:#E1E4E8;">; </span><span style="color:#B392F0;">I</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">am</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg1</span></span>
<span class="line"><span style="color:#B392F0;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">16</span><span style="color:#9ECBFF;">:02:49</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_node1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patroni:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2021</span><span style="color:#9ECBFF;">-06-23</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">16</span><span style="color:#9ECBFF;">:02:49,558</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">INFO:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">no</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">action.</span><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">i</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">am</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">the</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">leader</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">with</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">the</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">lock</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">#模拟etcd节点出现问题，停掉etcd的LEADER节点</span></span>
<span class="line"><span style="color:#24292E;">[root@pg_node1 </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# etcdctl endpoint status --endpoints=</span><span style="color:#032F62;">&#39;192.168.210.15:2379,192.168.210.81:2379,192.168.210.33:2379&#39;</span><span style="color:#24292E;"> -w table</span></span>
<span class="line"><span style="color:#6F42C1;">+---------------------+------------------+---------+---------+-----------+------------+-----------+------------+--------------------+--------+</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;">      </span><span style="color:#6F42C1;">ENDPOINT</span><span style="color:#24292E;">       </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">        </span><span style="color:#6F42C1;">ID</span><span style="color:#24292E;">        </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">VERSION</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">DB</span><span style="color:#24292E;"> </span><span style="color:#032F62;">SIZE</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">IS</span><span style="color:#24292E;"> </span><span style="color:#032F62;">LEADER</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">IS</span><span style="color:#24292E;"> </span><span style="color:#032F62;">LEARNER</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">RAFT</span><span style="color:#24292E;"> </span><span style="color:#032F62;">TERM</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">RAFT</span><span style="color:#24292E;"> </span><span style="color:#032F62;">INDEX</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">RAFT</span><span style="color:#24292E;"> </span><span style="color:#032F62;">APPLIED</span><span style="color:#24292E;"> </span><span style="color:#032F62;">INDEX</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">ERRORS</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#6F42C1;">+---------------------+------------------+---------+---------+-----------+------------+-----------+------------+--------------------+--------+</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">192.168.210.15:2379</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">2baa1a77ec379977</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">   </span><span style="color:#6F42C1;">3.5.0</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">  </span><span style="color:#6F42C1;">1.0</span><span style="color:#24292E;"> </span><span style="color:#032F62;">MB</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">     </span><span style="color:#005CC5;">false</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">      </span><span style="color:#005CC5;">false</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">        </span><span style="color:#6F42C1;">15</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">       </span><span style="color:#6F42C1;">4866</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">               </span><span style="color:#6F42C1;">4866</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">        </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">192.168.210.81:2379</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">  </span><span style="color:#6F42C1;">ff5595d67d21105</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">   </span><span style="color:#6F42C1;">3.5.0</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">  </span><span style="color:#6F42C1;">1.0</span><span style="color:#24292E;"> </span><span style="color:#032F62;">MB</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">      </span><span style="color:#005CC5;">true</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">      </span><span style="color:#005CC5;">false</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">        </span><span style="color:#6F42C1;">15</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">       </span><span style="color:#6F42C1;">4866</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">               </span><span style="color:#6F42C1;">4866</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">        </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">192.168.210.33:2379</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">b5d9c4826815356e</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">   </span><span style="color:#6F42C1;">3.5.0</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">  </span><span style="color:#6F42C1;">1.0</span><span style="color:#24292E;"> </span><span style="color:#032F62;">MB</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">     </span><span style="color:#005CC5;">false</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">      </span><span style="color:#005CC5;">false</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">        </span><span style="color:#6F42C1;">15</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">       </span><span style="color:#6F42C1;">4866</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">               </span><span style="color:#6F42C1;">4866</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">        </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#6F42C1;">+---------------------+------------------+---------+---------+-----------+------------+-----------+------------+--------------------+--------+</span></span>
<span class="line"><span style="color:#24292E;">[root@pg_node2 </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# systemctl stop etcd</span></span>
<span class="line"><span style="color:#24292E;">[root@pg_node2 </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# etcdctl endpoint status --endpoints=</span><span style="color:#032F62;">&#39;192.168.210.15:2379,192.168.210.81:2379,192.168.210.33:2379&#39;</span><span style="color:#24292E;"> -w table</span></span>
<span class="line"><span style="color:#24292E;">{</span><span style="color:#6F42C1;">&quot;level&quot;</span><span style="color:#005CC5;">:</span><span style="color:#6F42C1;">&quot;warn&quot;</span><span style="color:#6F42C1;">,</span><span style="color:#6F42C1;">&quot;ts&quot;</span><span style="color:#005CC5;">:</span><span style="color:#6F42C1;">&quot;2021-06-23T09:20:00.826+0800&quot;</span><span style="color:#6F42C1;">,</span><span style="color:#6F42C1;">&quot;logger&quot;</span><span style="color:#005CC5;">:</span><span style="color:#6F42C1;">&quot;etcd-client&quot;</span><span style="color:#6F42C1;">,</span><span style="color:#6F42C1;">&quot;caller&quot;</span><span style="color:#005CC5;">:</span><span style="color:#6F42C1;">&quot;v3/retry_interceptor.go:62&quot;</span><span style="color:#6F42C1;">,</span><span style="color:#6F42C1;">&quot;msg&quot;</span><span style="color:#005CC5;">:</span><span style="color:#6F42C1;">&quot;retrying of unary invoker failed&quot;</span><span style="color:#6F42C1;">,</span><span style="color:#6F42C1;">&quot;target&quot;</span><span style="color:#005CC5;">:</span><span style="color:#6F42C1;">&quot;etcd-endpoints://0xc0003fea80/#initially=[192.168.210.15:2379;192.168.210.81:2379;192.168.210.33:2379]&quot;</span><span style="color:#6F42C1;">,</span><span style="color:#6F42C1;">&quot;attempt&quot;</span><span style="color:#6F42C1;">:0,</span><span style="color:#6F42C1;">&quot;error&quot;</span><span style="color:#005CC5;">:</span><span style="color:#6F42C1;">&quot;rpc error: code = DeadlineExceeded desc = latest balancer error: last connection error: connection error: desc = </span><span style="color:#005CC5;">\\&quot;</span><span style="color:#6F42C1;">transport: Error while dialing dial tcp 192.168.210.81:2379: connect: connection refused</span><span style="color:#005CC5;">\\&quot;</span><span style="color:#6F42C1;">&quot;</span><span style="color:#6F42C1;">}</span></span>
<span class="line"><span style="color:#6F42C1;">Failed</span><span style="color:#24292E;"> </span><span style="color:#032F62;">to</span><span style="color:#24292E;"> </span><span style="color:#032F62;">get</span><span style="color:#24292E;"> </span><span style="color:#032F62;">the</span><span style="color:#24292E;"> </span><span style="color:#032F62;">status</span><span style="color:#24292E;"> </span><span style="color:#032F62;">of</span><span style="color:#24292E;"> </span><span style="color:#032F62;">endpoint</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">192.168</span><span style="color:#032F62;">.210.81:2379</span><span style="color:#24292E;"> (context </span><span style="color:#032F62;">deadline</span><span style="color:#24292E;"> </span><span style="color:#032F62;">exceeded</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#6F42C1;">+---------------------+------------------+---------+---------+-----------+------------+-----------+------------+--------------------+--------+</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;">      </span><span style="color:#6F42C1;">ENDPOINT</span><span style="color:#24292E;">       </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">        </span><span style="color:#6F42C1;">ID</span><span style="color:#24292E;">        </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">VERSION</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">DB</span><span style="color:#24292E;"> </span><span style="color:#032F62;">SIZE</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">IS</span><span style="color:#24292E;"> </span><span style="color:#032F62;">LEADER</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">IS</span><span style="color:#24292E;"> </span><span style="color:#032F62;">LEARNER</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">RAFT</span><span style="color:#24292E;"> </span><span style="color:#032F62;">TERM</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">RAFT</span><span style="color:#24292E;"> </span><span style="color:#032F62;">INDEX</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">RAFT</span><span style="color:#24292E;"> </span><span style="color:#032F62;">APPLIED</span><span style="color:#24292E;"> </span><span style="color:#032F62;">INDEX</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">ERRORS</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#6F42C1;">+---------------------+------------------+---------+---------+-----------+------------+-----------+------------+--------------------+--------+</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">192.168.210.15:2379</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">2baa1a77ec379977</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">   </span><span style="color:#6F42C1;">3.5.0</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">  </span><span style="color:#6F42C1;">1.0</span><span style="color:#24292E;"> </span><span style="color:#032F62;">MB</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">     </span><span style="color:#005CC5;">false</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">      </span><span style="color:#005CC5;">false</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">        </span><span style="color:#6F42C1;">16</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">       </span><span style="color:#6F42C1;">4867</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">               </span><span style="color:#6F42C1;">4867</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">        </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">192.168.210.33:2379</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">b5d9c4826815356e</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">   </span><span style="color:#6F42C1;">3.5.0</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">  </span><span style="color:#6F42C1;">1.0</span><span style="color:#24292E;"> </span><span style="color:#032F62;">MB</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">      </span><span style="color:#005CC5;">true</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">      </span><span style="color:#005CC5;">false</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">        </span><span style="color:#6F42C1;">16</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">       </span><span style="color:#6F42C1;">4867</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">               </span><span style="color:#6F42C1;">4867</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">        </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#6F42C1;">+---------------------+------------------+---------+---------+-----------+------------+-----------+------------+--------------------+--------+</span></span>
<span class="line"><span style="color:#24292E;">[root@pg_node1 </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# etcdctl endpoint status --endpoints=</span><span style="color:#032F62;">&#39;192.168.210.15:2379,192.168.210.81:2379,192.168.210.33:2379&#39;</span><span style="color:#24292E;"> -w table</span></span>
<span class="line"><span style="color:#24292E;">{</span><span style="color:#6F42C1;">&quot;level&quot;</span><span style="color:#005CC5;">:</span><span style="color:#6F42C1;">&quot;warn&quot;</span><span style="color:#6F42C1;">,</span><span style="color:#6F42C1;">&quot;ts&quot;</span><span style="color:#005CC5;">:</span><span style="color:#6F42C1;">&quot;2021-06-23T09:16:37.350+0800&quot;</span><span style="color:#6F42C1;">,</span><span style="color:#6F42C1;">&quot;logger&quot;</span><span style="color:#005CC5;">:</span><span style="color:#6F42C1;">&quot;etcd-client&quot;</span><span style="color:#6F42C1;">,</span><span style="color:#6F42C1;">&quot;caller&quot;</span><span style="color:#005CC5;">:</span><span style="color:#6F42C1;">&quot;v3/retry_interceptor.go:62&quot;</span><span style="color:#6F42C1;">,</span><span style="color:#6F42C1;">&quot;msg&quot;</span><span style="color:#005CC5;">:</span><span style="color:#6F42C1;">&quot;retrying of unary invoker failed&quot;</span><span style="color:#6F42C1;">,</span><span style="color:#6F42C1;">&quot;target&quot;</span><span style="color:#005CC5;">:</span><span style="color:#6F42C1;">&quot;etcd-endpoints://0xc00037c700/#initially=[192.168.210.15:2379;192.168.210.81:2379;192.168.210.33:2379]&quot;</span><span style="color:#6F42C1;">,</span><span style="color:#6F42C1;">&quot;attempt&quot;</span><span style="color:#6F42C1;">:0,</span><span style="color:#6F42C1;">&quot;error&quot;</span><span style="color:#005CC5;">:</span><span style="color:#6F42C1;">&quot;rpc error: code = DeadlineExceeded desc = latest balancer error: last connection error: connection error: desc = </span><span style="color:#005CC5;">\\&quot;</span><span style="color:#6F42C1;">transport: Error while dialing dial tcp 192.168.210.81:2379: connect: connection refused</span><span style="color:#005CC5;">\\&quot;</span><span style="color:#6F42C1;">&quot;</span><span style="color:#6F42C1;">}</span></span>
<span class="line"><span style="color:#6F42C1;">Failed</span><span style="color:#24292E;"> </span><span style="color:#032F62;">to</span><span style="color:#24292E;"> </span><span style="color:#032F62;">get</span><span style="color:#24292E;"> </span><span style="color:#032F62;">the</span><span style="color:#24292E;"> </span><span style="color:#032F62;">status</span><span style="color:#24292E;"> </span><span style="color:#032F62;">of</span><span style="color:#24292E;"> </span><span style="color:#032F62;">endpoint</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">192.168</span><span style="color:#032F62;">.210.81:2379</span><span style="color:#24292E;"> (context </span><span style="color:#032F62;">deadline</span><span style="color:#24292E;"> </span><span style="color:#032F62;">exceeded</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#6F42C1;">+---------------------+------------------+---------+---------+-----------+------------+-----------+------------+--------------------+--------+</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;">      </span><span style="color:#6F42C1;">ENDPOINT</span><span style="color:#24292E;">       </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">        </span><span style="color:#6F42C1;">ID</span><span style="color:#24292E;">        </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">VERSION</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">DB</span><span style="color:#24292E;"> </span><span style="color:#032F62;">SIZE</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">IS</span><span style="color:#24292E;"> </span><span style="color:#032F62;">LEADER</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">IS</span><span style="color:#24292E;"> </span><span style="color:#032F62;">LEARNER</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">RAFT</span><span style="color:#24292E;"> </span><span style="color:#032F62;">TERM</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">RAFT</span><span style="color:#24292E;"> </span><span style="color:#032F62;">INDEX</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">RAFT</span><span style="color:#24292E;"> </span><span style="color:#032F62;">APPLIED</span><span style="color:#24292E;"> </span><span style="color:#032F62;">INDEX</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">ERRORS</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#6F42C1;">+---------------------+------------------+---------+---------+-----------+------------+-----------+------------+--------------------+--------+</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">192.168.210.15:2379</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">2baa1a77ec379977</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">   </span><span style="color:#6F42C1;">3.5.0</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">  </span><span style="color:#6F42C1;">1.0</span><span style="color:#24292E;"> </span><span style="color:#032F62;">MB</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">     </span><span style="color:#005CC5;">false</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">      </span><span style="color:#005CC5;">false</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">        </span><span style="color:#6F42C1;">16</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">       </span><span style="color:#6F42C1;">4867</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">               </span><span style="color:#6F42C1;">4867</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">        </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">192.168.210.33:2379</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">b5d9c4826815356e</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">   </span><span style="color:#6F42C1;">3.5.0</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">  </span><span style="color:#6F42C1;">1.0</span><span style="color:#24292E;"> </span><span style="color:#032F62;">MB</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">      </span><span style="color:#005CC5;">true</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">      </span><span style="color:#005CC5;">false</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">        </span><span style="color:#6F42C1;">16</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">       </span><span style="color:#6F42C1;">4867</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">               </span><span style="color:#6F42C1;">4867</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">        </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#6F42C1;">+---------------------+------------------+---------+---------+-----------+------------+-----------+------------+--------------------+--------+</span></span>
<span class="line"><span style="color:#24292E;">[root@pg_node3 </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# etcdctl endpoint status --endpoints=</span><span style="color:#032F62;">&#39;192.168.210.15:2379,192.168.210.81:2379,192.168.210.33:2379&#39;</span><span style="color:#24292E;"> -w table</span></span>
<span class="line"><span style="color:#24292E;">{</span><span style="color:#6F42C1;">&quot;level&quot;</span><span style="color:#005CC5;">:</span><span style="color:#6F42C1;">&quot;warn&quot;</span><span style="color:#6F42C1;">,</span><span style="color:#6F42C1;">&quot;ts&quot;</span><span style="color:#005CC5;">:</span><span style="color:#6F42C1;">&quot;2021-06-23T09:20:39.338+0800&quot;</span><span style="color:#6F42C1;">,</span><span style="color:#6F42C1;">&quot;logger&quot;</span><span style="color:#005CC5;">:</span><span style="color:#6F42C1;">&quot;etcd-client&quot;</span><span style="color:#6F42C1;">,</span><span style="color:#6F42C1;">&quot;caller&quot;</span><span style="color:#005CC5;">:</span><span style="color:#6F42C1;">&quot;v3/retry_interceptor.go:62&quot;</span><span style="color:#6F42C1;">,</span><span style="color:#6F42C1;">&quot;msg&quot;</span><span style="color:#005CC5;">:</span><span style="color:#6F42C1;">&quot;retrying of unary invoker failed&quot;</span><span style="color:#6F42C1;">,</span><span style="color:#6F42C1;">&quot;target&quot;</span><span style="color:#005CC5;">:</span><span style="color:#6F42C1;">&quot;etcd-endpoints://0xc00013a380/#initially=[192.168.210.15:2379;192.168.210.81:2379;192.168.210.33:2379]&quot;</span><span style="color:#6F42C1;">,</span><span style="color:#6F42C1;">&quot;attempt&quot;</span><span style="color:#6F42C1;">:0,</span><span style="color:#6F42C1;">&quot;error&quot;</span><span style="color:#005CC5;">:</span><span style="color:#6F42C1;">&quot;rpc error: code = DeadlineExceeded desc = latest balancer error: last connection error: connection error: desc = </span><span style="color:#005CC5;">\\&quot;</span><span style="color:#6F42C1;">transport: Error while dialing dial tcp 192.168.210.81:2379: connect: connection refused</span><span style="color:#005CC5;">\\&quot;</span><span style="color:#6F42C1;">&quot;</span><span style="color:#6F42C1;">}</span></span>
<span class="line"><span style="color:#6F42C1;">Failed</span><span style="color:#24292E;"> </span><span style="color:#032F62;">to</span><span style="color:#24292E;"> </span><span style="color:#032F62;">get</span><span style="color:#24292E;"> </span><span style="color:#032F62;">the</span><span style="color:#24292E;"> </span><span style="color:#032F62;">status</span><span style="color:#24292E;"> </span><span style="color:#032F62;">of</span><span style="color:#24292E;"> </span><span style="color:#032F62;">endpoint</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">192.168</span><span style="color:#032F62;">.210.81:2379</span><span style="color:#24292E;"> (context </span><span style="color:#032F62;">deadline</span><span style="color:#24292E;"> </span><span style="color:#032F62;">exceeded</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#6F42C1;">+---------------------+------------------+---------+---------+-----------+------------+-----------+------------+--------------------+--------+</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;">      </span><span style="color:#6F42C1;">ENDPOINT</span><span style="color:#24292E;">       </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">        </span><span style="color:#6F42C1;">ID</span><span style="color:#24292E;">        </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">VERSION</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">DB</span><span style="color:#24292E;"> </span><span style="color:#032F62;">SIZE</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">IS</span><span style="color:#24292E;"> </span><span style="color:#032F62;">LEADER</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">IS</span><span style="color:#24292E;"> </span><span style="color:#032F62;">LEARNER</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">RAFT</span><span style="color:#24292E;"> </span><span style="color:#032F62;">TERM</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">RAFT</span><span style="color:#24292E;"> </span><span style="color:#032F62;">INDEX</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">RAFT</span><span style="color:#24292E;"> </span><span style="color:#032F62;">APPLIED</span><span style="color:#24292E;"> </span><span style="color:#032F62;">INDEX</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">ERRORS</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#6F42C1;">+---------------------+------------------+---------+---------+-----------+------------+-----------+------------+--------------------+--------+</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">192.168.210.15:2379</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">2baa1a77ec379977</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">   </span><span style="color:#6F42C1;">3.5.0</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">  </span><span style="color:#6F42C1;">1.0</span><span style="color:#24292E;"> </span><span style="color:#032F62;">MB</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">     </span><span style="color:#005CC5;">false</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">      </span><span style="color:#005CC5;">false</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">        </span><span style="color:#6F42C1;">16</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">       </span><span style="color:#6F42C1;">4867</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">               </span><span style="color:#6F42C1;">4867</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">        </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">192.168.210.33:2379</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">b5d9c4826815356e</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">   </span><span style="color:#6F42C1;">3.5.0</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">  </span><span style="color:#6F42C1;">1.0</span><span style="color:#24292E;"> </span><span style="color:#032F62;">MB</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">      </span><span style="color:#005CC5;">true</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">      </span><span style="color:#005CC5;">false</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">        </span><span style="color:#6F42C1;">16</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">       </span><span style="color:#6F42C1;">4867</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">               </span><span style="color:#6F42C1;">4867</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">        </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#6F42C1;">+---------------------+------------------+---------+---------+-----------+------------+-----------+------------+--------------------+--------+</span></span>
<span class="line"><span style="color:#6A737D;">#从以上信息可以看到，etcd已重新选举了LEADER，pg_node2节点已拒绝连接</span></span>
<span class="line"><span style="color:#6A737D;">#下面再次启动pg_node2节点的etcd，节点加入集群</span></span>
<span class="line"><span style="color:#24292E;">[root@pg_node2 </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# systemctl start etcd</span></span>
<span class="line"><span style="color:#24292E;">[root@pg_node2 </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# etcdctl endpoint status --endpoints=</span><span style="color:#032F62;">&#39;192.168.210.15:2379,192.168.210.81:2379,192.168.210.33:2379&#39;</span><span style="color:#24292E;"> -w table</span></span>
<span class="line"><span style="color:#6F42C1;">+---------------------+------------------+---------+---------+-----------+------------+-----------+------------+--------------------+--------+</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;">      </span><span style="color:#6F42C1;">ENDPOINT</span><span style="color:#24292E;">       </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">        </span><span style="color:#6F42C1;">ID</span><span style="color:#24292E;">        </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">VERSION</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">DB</span><span style="color:#24292E;"> </span><span style="color:#032F62;">SIZE</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">IS</span><span style="color:#24292E;"> </span><span style="color:#032F62;">LEADER</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">IS</span><span style="color:#24292E;"> </span><span style="color:#032F62;">LEARNER</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">RAFT</span><span style="color:#24292E;"> </span><span style="color:#032F62;">TERM</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">RAFT</span><span style="color:#24292E;"> </span><span style="color:#032F62;">INDEX</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">RAFT</span><span style="color:#24292E;"> </span><span style="color:#032F62;">APPLIED</span><span style="color:#24292E;"> </span><span style="color:#032F62;">INDEX</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">ERRORS</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#6F42C1;">+---------------------+------------------+---------+---------+-----------+------------+-----------+------------+--------------------+--------+</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">192.168.210.15:2379</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">2baa1a77ec379977</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">   </span><span style="color:#6F42C1;">3.5.0</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">  </span><span style="color:#6F42C1;">1.0</span><span style="color:#24292E;"> </span><span style="color:#032F62;">MB</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">     </span><span style="color:#005CC5;">false</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">      </span><span style="color:#005CC5;">false</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">        </span><span style="color:#6F42C1;">16</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">       </span><span style="color:#6F42C1;">4868</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">               </span><span style="color:#6F42C1;">4868</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">        </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">192.168.210.81:2379</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">  </span><span style="color:#6F42C1;">ff5595d67d21105</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">   </span><span style="color:#6F42C1;">3.5.0</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">  </span><span style="color:#6F42C1;">1.0</span><span style="color:#24292E;"> </span><span style="color:#032F62;">MB</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">     </span><span style="color:#005CC5;">false</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">      </span><span style="color:#005CC5;">false</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">        </span><span style="color:#6F42C1;">16</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">       </span><span style="color:#6F42C1;">4868</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">               </span><span style="color:#6F42C1;">4868</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">        </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">192.168.210.33:2379</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">b5d9c4826815356e</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">   </span><span style="color:#6F42C1;">3.5.0</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">  </span><span style="color:#6F42C1;">1.0</span><span style="color:#24292E;"> </span><span style="color:#032F62;">MB</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">      </span><span style="color:#005CC5;">true</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">      </span><span style="color:#005CC5;">false</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">        </span><span style="color:#6F42C1;">16</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">       </span><span style="color:#6F42C1;">4868</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">               </span><span style="color:#6F42C1;">4868</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">        </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#6F42C1;">+---------------------+------------------+---------+---------+-----------+------------+-----------+------------+--------------------+--------+</span></span>
<span class="line"><span style="color:#24292E;">[root@pg_node1 </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# etcdctl endpoint status --endpoints=</span><span style="color:#032F62;">&#39;192.168.210.15:2379,192.168.210.81:2379,192.168.210.33:2379&#39;</span><span style="color:#24292E;"> -w table</span></span>
<span class="line"><span style="color:#6F42C1;">+---------------------+------------------+---------+---------+-----------+------------+-----------+------------+--------------------+--------+</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;">      </span><span style="color:#6F42C1;">ENDPOINT</span><span style="color:#24292E;">       </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">        </span><span style="color:#6F42C1;">ID</span><span style="color:#24292E;">        </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">VERSION</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">DB</span><span style="color:#24292E;"> </span><span style="color:#032F62;">SIZE</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">IS</span><span style="color:#24292E;"> </span><span style="color:#032F62;">LEADER</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">IS</span><span style="color:#24292E;"> </span><span style="color:#032F62;">LEARNER</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">RAFT</span><span style="color:#24292E;"> </span><span style="color:#032F62;">TERM</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">RAFT</span><span style="color:#24292E;"> </span><span style="color:#032F62;">INDEX</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">RAFT</span><span style="color:#24292E;"> </span><span style="color:#032F62;">APPLIED</span><span style="color:#24292E;"> </span><span style="color:#032F62;">INDEX</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">ERRORS</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#6F42C1;">+---------------------+------------------+---------+---------+-----------+------------+-----------+------------+--------------------+--------+</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">192.168.210.15:2379</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">2baa1a77ec379977</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">   </span><span style="color:#6F42C1;">3.5.0</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">  </span><span style="color:#6F42C1;">1.0</span><span style="color:#24292E;"> </span><span style="color:#032F62;">MB</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">     </span><span style="color:#005CC5;">false</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">      </span><span style="color:#005CC5;">false</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">        </span><span style="color:#6F42C1;">16</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">       </span><span style="color:#6F42C1;">4868</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">               </span><span style="color:#6F42C1;">4868</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">        </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">192.168.210.81:2379</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">  </span><span style="color:#6F42C1;">ff5595d67d21105</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">   </span><span style="color:#6F42C1;">3.5.0</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">  </span><span style="color:#6F42C1;">1.0</span><span style="color:#24292E;"> </span><span style="color:#032F62;">MB</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">     </span><span style="color:#005CC5;">false</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">      </span><span style="color:#005CC5;">false</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">        </span><span style="color:#6F42C1;">16</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">       </span><span style="color:#6F42C1;">4868</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">               </span><span style="color:#6F42C1;">4868</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">        </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">192.168.210.33:2379</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">b5d9c4826815356e</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">   </span><span style="color:#6F42C1;">3.5.0</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">  </span><span style="color:#6F42C1;">1.0</span><span style="color:#24292E;"> </span><span style="color:#032F62;">MB</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">      </span><span style="color:#005CC5;">true</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">      </span><span style="color:#005CC5;">false</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">        </span><span style="color:#6F42C1;">16</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">       </span><span style="color:#6F42C1;">4868</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">               </span><span style="color:#6F42C1;">4868</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">        </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#6F42C1;">+---------------------+------------------+---------+---------+-----------+------------+-----------+------------+--------------------+--------+</span></span>
<span class="line"><span style="color:#24292E;">[root@pg_node3 </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# etcdctl endpoint status --endpoints=</span><span style="color:#032F62;">&#39;192.168.210.15:2379,192.168.210.81:2379,192.168.210.33:2379&#39;</span><span style="color:#24292E;"> -w table</span></span>
<span class="line"><span style="color:#6F42C1;">+---------------------+------------------+---------+---------+-----------+------------+-----------+------------+--------------------+--------+</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;">      </span><span style="color:#6F42C1;">ENDPOINT</span><span style="color:#24292E;">       </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">        </span><span style="color:#6F42C1;">ID</span><span style="color:#24292E;">        </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">VERSION</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">DB</span><span style="color:#24292E;"> </span><span style="color:#032F62;">SIZE</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">IS</span><span style="color:#24292E;"> </span><span style="color:#032F62;">LEADER</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">IS</span><span style="color:#24292E;"> </span><span style="color:#032F62;">LEARNER</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">RAFT</span><span style="color:#24292E;"> </span><span style="color:#032F62;">TERM</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">RAFT</span><span style="color:#24292E;"> </span><span style="color:#032F62;">INDEX</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">RAFT</span><span style="color:#24292E;"> </span><span style="color:#032F62;">APPLIED</span><span style="color:#24292E;"> </span><span style="color:#032F62;">INDEX</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">ERRORS</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#6F42C1;">+---------------------+------------------+---------+---------+-----------+------------+-----------+------------+--------------------+--------+</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">192.168.210.15:2379</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">2baa1a77ec379977</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">   </span><span style="color:#6F42C1;">3.5.0</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">  </span><span style="color:#6F42C1;">1.0</span><span style="color:#24292E;"> </span><span style="color:#032F62;">MB</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">     </span><span style="color:#005CC5;">false</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">      </span><span style="color:#005CC5;">false</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">        </span><span style="color:#6F42C1;">16</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">       </span><span style="color:#6F42C1;">4868</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">               </span><span style="color:#6F42C1;">4868</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">        </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">192.168.210.81:2379</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">  </span><span style="color:#6F42C1;">ff5595d67d21105</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">   </span><span style="color:#6F42C1;">3.5.0</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">  </span><span style="color:#6F42C1;">1.0</span><span style="color:#24292E;"> </span><span style="color:#032F62;">MB</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">     </span><span style="color:#005CC5;">false</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">      </span><span style="color:#005CC5;">false</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">        </span><span style="color:#6F42C1;">16</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">       </span><span style="color:#6F42C1;">4868</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">               </span><span style="color:#6F42C1;">4868</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">        </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">192.168.210.33:2379</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">b5d9c4826815356e</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">   </span><span style="color:#6F42C1;">3.5.0</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">  </span><span style="color:#6F42C1;">1.0</span><span style="color:#24292E;"> </span><span style="color:#032F62;">MB</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">      </span><span style="color:#005CC5;">true</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">      </span><span style="color:#005CC5;">false</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">        </span><span style="color:#6F42C1;">16</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">       </span><span style="color:#6F42C1;">4868</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">               </span><span style="color:#6F42C1;">4868</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">        </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#6F42C1;">+---------------------+------------------+---------+---------+-----------+------------+-----------+------------+--------------------+--------+</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#模拟etcd节点出现问题，停掉任意2个etcd节点</span></span>
<span class="line"><span style="color:#24292E;">[root@pg_node2 </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# systemctl stop etcd</span></span>
<span class="line"><span style="color:#24292E;">[root@pg_node2 </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# etcdctl endpoint status --endpoints=</span><span style="color:#032F62;">&#39;192.168.210.15:2379,192.168.210.81:2379,192.168.210.33:2379&#39;</span><span style="color:#24292E;"> -w table</span></span>
<span class="line"><span style="color:#24292E;">{</span><span style="color:#6F42C1;">&quot;level&quot;</span><span style="color:#005CC5;">:</span><span style="color:#6F42C1;">&quot;warn&quot;</span><span style="color:#6F42C1;">,</span><span style="color:#6F42C1;">&quot;ts&quot;</span><span style="color:#005CC5;">:</span><span style="color:#6F42C1;">&quot;2021-06-23T09:20:00.826+0800&quot;</span><span style="color:#6F42C1;">,</span><span style="color:#6F42C1;">&quot;logger&quot;</span><span style="color:#005CC5;">:</span><span style="color:#6F42C1;">&quot;etcd-client&quot;</span><span style="color:#6F42C1;">,</span><span style="color:#6F42C1;">&quot;caller&quot;</span><span style="color:#005CC5;">:</span><span style="color:#6F42C1;">&quot;v3/retry_interceptor.go:62&quot;</span><span style="color:#6F42C1;">,</span><span style="color:#6F42C1;">&quot;msg&quot;</span><span style="color:#005CC5;">:</span><span style="color:#6F42C1;">&quot;retrying of unary invoker failed&quot;</span><span style="color:#6F42C1;">,</span><span style="color:#6F42C1;">&quot;target&quot;</span><span style="color:#005CC5;">:</span><span style="color:#6F42C1;">&quot;etcd-endpoints://0xc0003fea80/#initially=[192.168.210.15:2379;192.168.210.81:2379;192.168.210.33:2379]&quot;</span><span style="color:#6F42C1;">,</span><span style="color:#6F42C1;">&quot;attempt&quot;</span><span style="color:#6F42C1;">:0,</span><span style="color:#6F42C1;">&quot;error&quot;</span><span style="color:#005CC5;">:</span><span style="color:#6F42C1;">&quot;rpc error: code = DeadlineExceeded desc = latest balancer error: last connection error: connection error: desc = </span><span style="color:#005CC5;">\\&quot;</span><span style="color:#6F42C1;">transport: Error while dialing dial tcp 192.168.210.81:2379: connect: connection refused</span><span style="color:#005CC5;">\\&quot;</span><span style="color:#6F42C1;">&quot;</span><span style="color:#6F42C1;">}</span></span>
<span class="line"><span style="color:#6F42C1;">Failed</span><span style="color:#24292E;"> </span><span style="color:#032F62;">to</span><span style="color:#24292E;"> </span><span style="color:#032F62;">get</span><span style="color:#24292E;"> </span><span style="color:#032F62;">the</span><span style="color:#24292E;"> </span><span style="color:#032F62;">status</span><span style="color:#24292E;"> </span><span style="color:#032F62;">of</span><span style="color:#24292E;"> </span><span style="color:#032F62;">endpoint</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">192.168</span><span style="color:#032F62;">.210.81:2379</span><span style="color:#24292E;"> (context </span><span style="color:#032F62;">deadline</span><span style="color:#24292E;"> </span><span style="color:#032F62;">exceeded</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#6F42C1;">+---------------------+------------------+---------+---------+-----------+------------+-----------+------------+--------------------+--------+</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;">      </span><span style="color:#6F42C1;">ENDPOINT</span><span style="color:#24292E;">       </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">        </span><span style="color:#6F42C1;">ID</span><span style="color:#24292E;">        </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">VERSION</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">DB</span><span style="color:#24292E;"> </span><span style="color:#032F62;">SIZE</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">IS</span><span style="color:#24292E;"> </span><span style="color:#032F62;">LEADER</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">IS</span><span style="color:#24292E;"> </span><span style="color:#032F62;">LEARNER</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">RAFT</span><span style="color:#24292E;"> </span><span style="color:#032F62;">TERM</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">RAFT</span><span style="color:#24292E;"> </span><span style="color:#032F62;">INDEX</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">RAFT</span><span style="color:#24292E;"> </span><span style="color:#032F62;">APPLIED</span><span style="color:#24292E;"> </span><span style="color:#032F62;">INDEX</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">ERRORS</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#6F42C1;">+---------------------+------------------+---------+---------+-----------+------------+-----------+------------+--------------------+--------+</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">192.168.210.15:2379</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">2baa1a77ec379977</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">   </span><span style="color:#6F42C1;">3.5.0</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">  </span><span style="color:#6F42C1;">1.0</span><span style="color:#24292E;"> </span><span style="color:#032F62;">MB</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">     </span><span style="color:#005CC5;">false</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">      </span><span style="color:#005CC5;">false</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">        </span><span style="color:#6F42C1;">16</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">       </span><span style="color:#6F42C1;">4867</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">               </span><span style="color:#6F42C1;">4867</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">        </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">192.168.210.33:2379</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">b5d9c4826815356e</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">   </span><span style="color:#6F42C1;">3.5.0</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">  </span><span style="color:#6F42C1;">1.0</span><span style="color:#24292E;"> </span><span style="color:#032F62;">MB</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">      </span><span style="color:#005CC5;">true</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">      </span><span style="color:#005CC5;">false</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">        </span><span style="color:#6F42C1;">16</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">       </span><span style="color:#6F42C1;">4867</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">               </span><span style="color:#6F42C1;">4867</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">        </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#6F42C1;">+---------------------+------------------+---------+---------+-----------+------------+-----------+------------+--------------------+--------+</span></span>
<span class="line"><span style="color:#24292E;">[root@pg_node3 </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# systemctl stop etcd</span></span>
<span class="line"><span style="color:#24292E;">[root@pg_node3 </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# etcdctl endpoint status --endpoints=</span><span style="color:#032F62;">&#39;192.168.210.15:2379,192.168.210.81:2379,192.168.210.33:2379&#39;</span><span style="color:#24292E;"> -w table</span></span>
<span class="line"><span style="color:#24292E;">{</span><span style="color:#6F42C1;">&quot;level&quot;</span><span style="color:#005CC5;">:</span><span style="color:#6F42C1;">&quot;warn&quot;</span><span style="color:#6F42C1;">,</span><span style="color:#6F42C1;">&quot;ts&quot;</span><span style="color:#005CC5;">:</span><span style="color:#6F42C1;">&quot;2021-06-23T09:27:22.438+0800&quot;</span><span style="color:#6F42C1;">,</span><span style="color:#6F42C1;">&quot;logger&quot;</span><span style="color:#005CC5;">:</span><span style="color:#6F42C1;">&quot;etcd-client&quot;</span><span style="color:#6F42C1;">,</span><span style="color:#6F42C1;">&quot;caller&quot;</span><span style="color:#005CC5;">:</span><span style="color:#6F42C1;">&quot;v3/retry_interceptor.go:62&quot;</span><span style="color:#6F42C1;">,</span><span style="color:#6F42C1;">&quot;msg&quot;</span><span style="color:#005CC5;">:</span><span style="color:#6F42C1;">&quot;retrying of unary invoker failed&quot;</span><span style="color:#6F42C1;">,</span><span style="color:#6F42C1;">&quot;target&quot;</span><span style="color:#005CC5;">:</span><span style="color:#6F42C1;">&quot;etcd-endpoints://0xc000150000/#initially=[192.168.210.15:2379;192.168.210.81:2379;192.168.210.33:2379]&quot;</span><span style="color:#6F42C1;">,</span><span style="color:#6F42C1;">&quot;attempt&quot;</span><span style="color:#6F42C1;">:0,</span><span style="color:#6F42C1;">&quot;error&quot;</span><span style="color:#005CC5;">:</span><span style="color:#6F42C1;">&quot;rpc error: code = DeadlineExceeded desc = latest balancer error: last connection error: connection error: desc = </span><span style="color:#005CC5;">\\&quot;</span><span style="color:#6F42C1;">transport: Error while dialing dial tcp 192.168.210.81:2379: connect: connection refused</span><span style="color:#005CC5;">\\&quot;</span><span style="color:#6F42C1;">&quot;</span><span style="color:#6F42C1;">}</span></span>
<span class="line"><span style="color:#6F42C1;">Failed</span><span style="color:#24292E;"> </span><span style="color:#032F62;">to</span><span style="color:#24292E;"> </span><span style="color:#032F62;">get</span><span style="color:#24292E;"> </span><span style="color:#032F62;">the</span><span style="color:#24292E;"> </span><span style="color:#032F62;">status</span><span style="color:#24292E;"> </span><span style="color:#032F62;">of</span><span style="color:#24292E;"> </span><span style="color:#032F62;">endpoint</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">192.168</span><span style="color:#032F62;">.210.81:2379</span><span style="color:#24292E;"> (context </span><span style="color:#032F62;">deadline</span><span style="color:#24292E;"> </span><span style="color:#032F62;">exceeded</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">{</span><span style="color:#6F42C1;">&quot;level&quot;</span><span style="color:#005CC5;">:</span><span style="color:#6F42C1;">&quot;warn&quot;</span><span style="color:#6F42C1;">,</span><span style="color:#6F42C1;">&quot;ts&quot;</span><span style="color:#005CC5;">:</span><span style="color:#6F42C1;">&quot;2021-06-23T09:27:27.439+0800&quot;</span><span style="color:#6F42C1;">,</span><span style="color:#6F42C1;">&quot;logger&quot;</span><span style="color:#005CC5;">:</span><span style="color:#6F42C1;">&quot;etcd-client&quot;</span><span style="color:#6F42C1;">,</span><span style="color:#6F42C1;">&quot;caller&quot;</span><span style="color:#005CC5;">:</span><span style="color:#6F42C1;">&quot;v3/retry_interceptor.go:62&quot;</span><span style="color:#6F42C1;">,</span><span style="color:#6F42C1;">&quot;msg&quot;</span><span style="color:#005CC5;">:</span><span style="color:#6F42C1;">&quot;retrying of unary invoker failed&quot;</span><span style="color:#6F42C1;">,</span><span style="color:#6F42C1;">&quot;target&quot;</span><span style="color:#005CC5;">:</span><span style="color:#6F42C1;">&quot;etcd-endpoints://0xc000150000/#initially=[192.168.210.15:2379;192.168.210.81:2379;192.168.210.33:2379]&quot;</span><span style="color:#6F42C1;">,</span><span style="color:#6F42C1;">&quot;attempt&quot;</span><span style="color:#6F42C1;">:0,</span><span style="color:#6F42C1;">&quot;error&quot;</span><span style="color:#005CC5;">:</span><span style="color:#6F42C1;">&quot;rpc error: code = DeadlineExceeded desc = latest balancer error: last connection error: connection error: desc = </span><span style="color:#005CC5;">\\&quot;</span><span style="color:#6F42C1;">transport: Error while dialing dial tcp 192.168.210.33:2379: connect: connection refused</span><span style="color:#005CC5;">\\&quot;</span><span style="color:#6F42C1;">&quot;</span><span style="color:#6F42C1;">}</span></span>
<span class="line"><span style="color:#6F42C1;">Failed</span><span style="color:#24292E;"> </span><span style="color:#032F62;">to</span><span style="color:#24292E;"> </span><span style="color:#032F62;">get</span><span style="color:#24292E;"> </span><span style="color:#032F62;">the</span><span style="color:#24292E;"> </span><span style="color:#032F62;">status</span><span style="color:#24292E;"> </span><span style="color:#032F62;">of</span><span style="color:#24292E;"> </span><span style="color:#032F62;">endpoint</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">192.168</span><span style="color:#032F62;">.210.33:2379</span><span style="color:#24292E;"> (context </span><span style="color:#032F62;">deadline</span><span style="color:#24292E;"> </span><span style="color:#032F62;">exceeded</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#6F42C1;">+---------------------+------------------+---------+---------+-----------+------------+-----------+------------+--------------------+-----------------------+</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;">      </span><span style="color:#6F42C1;">ENDPOINT</span><span style="color:#24292E;">       </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">        </span><span style="color:#6F42C1;">ID</span><span style="color:#24292E;">        </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">VERSION</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">DB</span><span style="color:#24292E;"> </span><span style="color:#032F62;">SIZE</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">IS</span><span style="color:#24292E;"> </span><span style="color:#032F62;">LEADER</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">IS</span><span style="color:#24292E;"> </span><span style="color:#032F62;">LEARNER</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">RAFT</span><span style="color:#24292E;"> </span><span style="color:#032F62;">TERM</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">RAFT</span><span style="color:#24292E;"> </span><span style="color:#032F62;">INDEX</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">RAFT</span><span style="color:#24292E;"> </span><span style="color:#032F62;">APPLIED</span><span style="color:#24292E;"> </span><span style="color:#032F62;">INDEX</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">        </span><span style="color:#6F42C1;">ERRORS</span><span style="color:#24292E;">         </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#6F42C1;">+---------------------+------------------+---------+---------+-----------+------------+-----------+------------+--------------------+-----------------------+</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">192.168.210.15:2379</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">2baa1a77ec379977</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">   </span><span style="color:#6F42C1;">3.5.0</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">  </span><span style="color:#6F42C1;">1.0</span><span style="color:#24292E;"> </span><span style="color:#032F62;">MB</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">     </span><span style="color:#005CC5;">false</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">      </span><span style="color:#005CC5;">false</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">        </span><span style="color:#6F42C1;">17</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">       </span><span style="color:#6F42C1;">4869</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">               </span><span style="color:#6F42C1;">4869</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">etcdserver:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">no</span><span style="color:#24292E;"> </span><span style="color:#032F62;">leader</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#6F42C1;">+---------------------+------------------+---------+---------+-----------+------------+-----------+------------+--------------------+-----------------------+</span></span>
<span class="line"><span style="color:#6A737D;">#从以上信息可以看到，停止3个中任意两个节点，etcd集群不再可用</span></span>
<span class="line"><span style="color:#6A737D;">#启动后集群恢复正常，健壮性非常强</span></span>
<span class="line"><span style="color:#24292E;">[root@pg_node3 </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# systemctl start etcd</span></span>
<span class="line"><span style="color:#24292E;">[root@pg_node3 </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# etcdctl endpoint status --endpoints=</span><span style="color:#032F62;">&#39;192.168.210.15:2379,192.168.210.81:2379,192.168.210.33:2379&#39;</span><span style="color:#24292E;"> -w table</span></span>
<span class="line"><span style="color:#24292E;">{</span><span style="color:#6F42C1;">&quot;level&quot;</span><span style="color:#005CC5;">:</span><span style="color:#6F42C1;">&quot;warn&quot;</span><span style="color:#6F42C1;">,</span><span style="color:#6F42C1;">&quot;ts&quot;</span><span style="color:#005CC5;">:</span><span style="color:#6F42C1;">&quot;2021-06-23T09:28:31.642+0800&quot;</span><span style="color:#6F42C1;">,</span><span style="color:#6F42C1;">&quot;logger&quot;</span><span style="color:#005CC5;">:</span><span style="color:#6F42C1;">&quot;etcd-client&quot;</span><span style="color:#6F42C1;">,</span><span style="color:#6F42C1;">&quot;caller&quot;</span><span style="color:#005CC5;">:</span><span style="color:#6F42C1;">&quot;v3/retry_interceptor.go:62&quot;</span><span style="color:#6F42C1;">,</span><span style="color:#6F42C1;">&quot;msg&quot;</span><span style="color:#005CC5;">:</span><span style="color:#6F42C1;">&quot;retrying of unary invoker failed&quot;</span><span style="color:#6F42C1;">,</span><span style="color:#6F42C1;">&quot;target&quot;</span><span style="color:#005CC5;">:</span><span style="color:#6F42C1;">&quot;etcd-endpoints://0xc000150a80/#initially=[192.168.210.15:2379;192.168.210.81:2379;192.168.210.33:2379]&quot;</span><span style="color:#6F42C1;">,</span><span style="color:#6F42C1;">&quot;attempt&quot;</span><span style="color:#6F42C1;">:0,</span><span style="color:#6F42C1;">&quot;error&quot;</span><span style="color:#005CC5;">:</span><span style="color:#6F42C1;">&quot;rpc error: code = DeadlineExceeded desc = latest balancer error: last connection error: connection error: desc = </span><span style="color:#005CC5;">\\&quot;</span><span style="color:#6F42C1;">transport: Error while dialing dial tcp 192.168.210.81:2379: connect: connection refused</span><span style="color:#005CC5;">\\&quot;</span><span style="color:#6F42C1;">&quot;</span><span style="color:#6F42C1;">}</span></span>
<span class="line"><span style="color:#6F42C1;">Failed</span><span style="color:#24292E;"> </span><span style="color:#032F62;">to</span><span style="color:#24292E;"> </span><span style="color:#032F62;">get</span><span style="color:#24292E;"> </span><span style="color:#032F62;">the</span><span style="color:#24292E;"> </span><span style="color:#032F62;">status</span><span style="color:#24292E;"> </span><span style="color:#032F62;">of</span><span style="color:#24292E;"> </span><span style="color:#032F62;">endpoint</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">192.168</span><span style="color:#032F62;">.210.81:2379</span><span style="color:#24292E;"> (context </span><span style="color:#032F62;">deadline</span><span style="color:#24292E;"> </span><span style="color:#032F62;">exceeded</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#6F42C1;">+---------------------+------------------+---------+---------+-----------+------------+-----------+------------+--------------------+--------+</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;">      </span><span style="color:#6F42C1;">ENDPOINT</span><span style="color:#24292E;">       </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">        </span><span style="color:#6F42C1;">ID</span><span style="color:#24292E;">        </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">VERSION</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">DB</span><span style="color:#24292E;"> </span><span style="color:#032F62;">SIZE</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">IS</span><span style="color:#24292E;"> </span><span style="color:#032F62;">LEADER</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">IS</span><span style="color:#24292E;"> </span><span style="color:#032F62;">LEARNER</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">RAFT</span><span style="color:#24292E;"> </span><span style="color:#032F62;">TERM</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">RAFT</span><span style="color:#24292E;"> </span><span style="color:#032F62;">INDEX</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">RAFT</span><span style="color:#24292E;"> </span><span style="color:#032F62;">APPLIED</span><span style="color:#24292E;"> </span><span style="color:#032F62;">INDEX</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">ERRORS</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#6F42C1;">+---------------------+------------------+---------+---------+-----------+------------+-----------+------------+--------------------+--------+</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">192.168.210.15:2379</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">2baa1a77ec379977</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">   </span><span style="color:#6F42C1;">3.5.0</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">  </span><span style="color:#6F42C1;">1.0</span><span style="color:#24292E;"> </span><span style="color:#032F62;">MB</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">      </span><span style="color:#005CC5;">true</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">      </span><span style="color:#005CC5;">false</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">        </span><span style="color:#6F42C1;">18</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">       </span><span style="color:#6F42C1;">4883</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">               </span><span style="color:#6F42C1;">4883</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">        </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">192.168.210.33:2379</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">b5d9c4826815356e</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">   </span><span style="color:#6F42C1;">3.5.0</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">  </span><span style="color:#6F42C1;">1.0</span><span style="color:#24292E;"> </span><span style="color:#032F62;">MB</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">     </span><span style="color:#005CC5;">false</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">      </span><span style="color:#005CC5;">false</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">        </span><span style="color:#6F42C1;">18</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">       </span><span style="color:#6F42C1;">4883</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">               </span><span style="color:#6F42C1;">4883</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">        </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#6F42C1;">+---------------------+------------------+---------+---------+-----------+------------+-----------+------------+--------------------+--------+</span></span>
<span class="line"><span style="color:#24292E;">[root@pg_node2 </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# systemctl start etcd</span></span>
<span class="line"><span style="color:#24292E;">[root@pg_node2 </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# etcdctl endpoint status --endpoints=</span><span style="color:#032F62;">&#39;192.168.210.15:2379,192.168.210.81:2379,192.168.210.33:2379&#39;</span><span style="color:#24292E;"> -w table</span></span>
<span class="line"><span style="color:#6F42C1;">+---------------------+------------------+---------+---------+-----------+------------+-----------+------------+--------------------+--------+</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;">      </span><span style="color:#6F42C1;">ENDPOINT</span><span style="color:#24292E;">       </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">        </span><span style="color:#6F42C1;">ID</span><span style="color:#24292E;">        </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">VERSION</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">DB</span><span style="color:#24292E;"> </span><span style="color:#032F62;">SIZE</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">IS</span><span style="color:#24292E;"> </span><span style="color:#032F62;">LEADER</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">IS</span><span style="color:#24292E;"> </span><span style="color:#032F62;">LEARNER</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">RAFT</span><span style="color:#24292E;"> </span><span style="color:#032F62;">TERM</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">RAFT</span><span style="color:#24292E;"> </span><span style="color:#032F62;">INDEX</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">RAFT</span><span style="color:#24292E;"> </span><span style="color:#032F62;">APPLIED</span><span style="color:#24292E;"> </span><span style="color:#032F62;">INDEX</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">ERRORS</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#6F42C1;">+---------------------+------------------+---------+---------+-----------+------------+-----------+------------+--------------------+--------+</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">192.168.210.15:2379</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">2baa1a77ec379977</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">   </span><span style="color:#6F42C1;">3.5.0</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">  </span><span style="color:#6F42C1;">1.0</span><span style="color:#24292E;"> </span><span style="color:#032F62;">MB</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">      </span><span style="color:#005CC5;">true</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">      </span><span style="color:#005CC5;">false</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">        </span><span style="color:#6F42C1;">18</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">       </span><span style="color:#6F42C1;">4888</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">               </span><span style="color:#6F42C1;">4888</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">        </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">192.168.210.81:2379</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">  </span><span style="color:#6F42C1;">ff5595d67d21105</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">   </span><span style="color:#6F42C1;">3.5.0</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">  </span><span style="color:#6F42C1;">1.0</span><span style="color:#24292E;"> </span><span style="color:#032F62;">MB</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">     </span><span style="color:#005CC5;">false</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">      </span><span style="color:#005CC5;">false</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">        </span><span style="color:#6F42C1;">18</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">       </span><span style="color:#6F42C1;">4888</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">               </span><span style="color:#6F42C1;">4888</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">        </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">192.168.210.33:2379</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">b5d9c4826815356e</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">   </span><span style="color:#6F42C1;">3.5.0</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">  </span><span style="color:#6F42C1;">1.0</span><span style="color:#24292E;"> </span><span style="color:#032F62;">MB</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">     </span><span style="color:#005CC5;">false</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">      </span><span style="color:#005CC5;">false</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">        </span><span style="color:#6F42C1;">18</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">       </span><span style="color:#6F42C1;">4888</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">               </span><span style="color:#6F42C1;">4888</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">        </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#6F42C1;">+---------------------+------------------+---------+---------+-----------+------------+-----------+------------+--------------------+--------+</span></span>
<span class="line"><span style="color:#24292E;">[root@pg_node1 </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# etcdctl endpoint status --endpoints=</span><span style="color:#032F62;">&#39;192.168.210.15:2379,192.168.210.81:2379,192.168.210.33:2379&#39;</span><span style="color:#24292E;"> -w table</span></span>
<span class="line"><span style="color:#6F42C1;">+---------------------+------------------+---------+---------+-----------+------------+-----------+------------+--------------------+--------+</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;">      </span><span style="color:#6F42C1;">ENDPOINT</span><span style="color:#24292E;">       </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">        </span><span style="color:#6F42C1;">ID</span><span style="color:#24292E;">        </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">VERSION</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">DB</span><span style="color:#24292E;"> </span><span style="color:#032F62;">SIZE</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">IS</span><span style="color:#24292E;"> </span><span style="color:#032F62;">LEADER</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">IS</span><span style="color:#24292E;"> </span><span style="color:#032F62;">LEARNER</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">RAFT</span><span style="color:#24292E;"> </span><span style="color:#032F62;">TERM</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">RAFT</span><span style="color:#24292E;"> </span><span style="color:#032F62;">INDEX</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">RAFT</span><span style="color:#24292E;"> </span><span style="color:#032F62;">APPLIED</span><span style="color:#24292E;"> </span><span style="color:#032F62;">INDEX</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">ERRORS</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#6F42C1;">+---------------------+------------------+---------+---------+-----------+------------+-----------+------------+--------------------+--------+</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">192.168.210.15:2379</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">2baa1a77ec379977</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">   </span><span style="color:#6F42C1;">3.5.0</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">  </span><span style="color:#6F42C1;">1.0</span><span style="color:#24292E;"> </span><span style="color:#032F62;">MB</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">      </span><span style="color:#005CC5;">true</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">      </span><span style="color:#005CC5;">false</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">        </span><span style="color:#6F42C1;">19</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">       </span><span style="color:#6F42C1;">4905</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">               </span><span style="color:#6F42C1;">4905</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">        </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">192.168.210.81:2379</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">  </span><span style="color:#6F42C1;">ff5595d67d21105</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">   </span><span style="color:#6F42C1;">3.5.0</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">  </span><span style="color:#6F42C1;">1.0</span><span style="color:#24292E;"> </span><span style="color:#032F62;">MB</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">     </span><span style="color:#005CC5;">false</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">      </span><span style="color:#005CC5;">false</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">        </span><span style="color:#6F42C1;">19</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">       </span><span style="color:#6F42C1;">4905</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">               </span><span style="color:#6F42C1;">4905</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">        </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">192.168.210.33:2379</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">b5d9c4826815356e</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">   </span><span style="color:#6F42C1;">3.5.0</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">  </span><span style="color:#6F42C1;">1.0</span><span style="color:#24292E;"> </span><span style="color:#032F62;">MB</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">     </span><span style="color:#005CC5;">false</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">      </span><span style="color:#005CC5;">false</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">        </span><span style="color:#6F42C1;">19</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">       </span><span style="color:#6F42C1;">4905</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">               </span><span style="color:#6F42C1;">4905</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">        </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#6F42C1;">+---------------------+------------------+---------+---------+-----------+------------+-----------+------------+--------------------+--------+</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#模拟PostgreSQL数据库出现问题</span></span>
<span class="line"><span style="color:#6A737D;">#停止主库服务</span></span>
<span class="line"><span style="color:#24292E;">[postgres@pg_node1 </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]$ pg_ctl stop -D /opt/PostgreSQL/13/data</span></span>
<span class="line"><span style="color:#6F42C1;">waiting</span><span style="color:#24292E;"> </span><span style="color:#032F62;">for</span><span style="color:#24292E;"> </span><span style="color:#032F62;">server</span><span style="color:#24292E;"> </span><span style="color:#032F62;">to</span><span style="color:#24292E;"> </span><span style="color:#032F62;">shut</span><span style="color:#24292E;"> </span><span style="color:#032F62;">down....</span><span style="color:#24292E;"> </span><span style="color:#032F62;">done</span></span>
<span class="line"><span style="color:#6F42C1;">server</span><span style="color:#24292E;"> </span><span style="color:#032F62;">stopped</span></span>
<span class="line"><span style="color:#24292E;">[postgres@pg_node1 </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]$ ps -ef</span><span style="color:#D73A49;">|</span><span style="color:#6F42C1;">grep</span><span style="color:#24292E;"> </span><span style="color:#032F62;">postgres</span></span>
<span class="line"><span style="color:#6F42C1;">postgres</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">4447</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">4367</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">0</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:37</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pts/0</span><span style="color:#24292E;">    </span><span style="color:#005CC5;">00</span><span style="color:#032F62;">:00:00</span><span style="color:#24292E;"> </span><span style="color:#032F62;">grep</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--color=auto</span><span style="color:#24292E;"> </span><span style="color:#032F62;">postgres</span></span>
<span class="line"><span style="color:#24292E;">[postgres@pg_node1 </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]$ ps -ef</span><span style="color:#D73A49;">|</span><span style="color:#6F42C1;">grep</span><span style="color:#24292E;"> </span><span style="color:#032F62;">postgres</span></span>
<span class="line"><span style="color:#6F42C1;">postgres</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">4451</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">4367</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">0</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:37</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pts/0</span><span style="color:#24292E;">    </span><span style="color:#005CC5;">00</span><span style="color:#032F62;">:00:00</span><span style="color:#24292E;"> </span><span style="color:#032F62;">grep</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--color=auto</span><span style="color:#24292E;"> </span><span style="color:#032F62;">postgres</span></span>
<span class="line"><span style="color:#24292E;">[postgres@pg_node1 </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]$ ps -ef</span><span style="color:#D73A49;">|</span><span style="color:#6F42C1;">grep</span><span style="color:#24292E;"> </span><span style="color:#032F62;">postgres</span></span>
<span class="line"><span style="color:#6F42C1;">postgres</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">4453</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">4367</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">0</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:37</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pts/0</span><span style="color:#24292E;">    </span><span style="color:#005CC5;">00</span><span style="color:#032F62;">:00:00</span><span style="color:#24292E;"> </span><span style="color:#032F62;">grep</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--color=auto</span><span style="color:#24292E;"> </span><span style="color:#032F62;">postgres</span></span>
<span class="line"><span style="color:#24292E;">[postgres@pg_node1 </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]$ ps -ef</span><span style="color:#D73A49;">|</span><span style="color:#6F42C1;">grep</span><span style="color:#24292E;"> </span><span style="color:#032F62;">postgres</span></span>
<span class="line"><span style="color:#6F42C1;">postgres</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">4459</span><span style="color:#24292E;">     </span><span style="color:#005CC5;">1</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">1</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:37</span><span style="color:#24292E;"> </span><span style="color:#032F62;">?</span><span style="color:#24292E;">        </span><span style="color:#005CC5;">00</span><span style="color:#032F62;">:00:00</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/opt/PostgreSQL/13/bin/postgres</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-D</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/opt/PostgreSQL/13/data</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--config-file=/opt/PostgreSQL/13/data/postgresql.conf</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--listen_addresses=0.0.0.0</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--max_worker_processes=8</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--max_prepared_transactions=0</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--wal_level=replica</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--track_commit_timestamp=off</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--max_locks_per_transaction=64</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--port=5432</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--max_replication_slots=10</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--max_connections=100</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--hot_standby=on</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--cluster_name=twpg</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--wal_log_hints=on</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--max_wal_senders=10</span></span>
<span class="line"><span style="color:#6F42C1;">postgres</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">4462</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">4459</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">0</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:37</span><span style="color:#24292E;"> </span><span style="color:#032F62;">?</span><span style="color:#24292E;">        </span><span style="color:#005CC5;">00</span><span style="color:#032F62;">:00:00</span><span style="color:#24292E;"> </span><span style="color:#032F62;">postgres:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">twpg:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">checkpointer</span><span style="color:#24292E;"> </span></span>
<span class="line"><span style="color:#6F42C1;">postgres</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">4463</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">4459</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">0</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:37</span><span style="color:#24292E;"> </span><span style="color:#032F62;">?</span><span style="color:#24292E;">        </span><span style="color:#005CC5;">00</span><span style="color:#032F62;">:00:00</span><span style="color:#24292E;"> </span><span style="color:#032F62;">postgres:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">twpg:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">background</span><span style="color:#24292E;"> </span><span style="color:#032F62;">writer</span><span style="color:#24292E;"> </span></span>
<span class="line"><span style="color:#6F42C1;">postgres</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">4464</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">4459</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">0</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:37</span><span style="color:#24292E;"> </span><span style="color:#032F62;">?</span><span style="color:#24292E;">        </span><span style="color:#005CC5;">00</span><span style="color:#032F62;">:00:00</span><span style="color:#24292E;"> </span><span style="color:#032F62;">postgres:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">twpg:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">stats</span><span style="color:#24292E;"> </span><span style="color:#032F62;">collector</span><span style="color:#24292E;"> </span></span>
<span class="line"><span style="color:#6F42C1;">postgres</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">4472</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">4459</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">0</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:37</span><span style="color:#24292E;"> </span><span style="color:#032F62;">?</span><span style="color:#24292E;">        </span><span style="color:#005CC5;">00</span><span style="color:#032F62;">:00:00</span><span style="color:#24292E;"> </span><span style="color:#032F62;">postgres:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">twpg:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">twsm</span><span style="color:#24292E;"> </span><span style="color:#032F62;">postgres</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">127.0</span><span style="color:#032F62;">.0.1</span><span style="color:#24292E;">(</span><span style="color:#6F42C1;">40298</span><span style="color:#24292E;">) </span><span style="color:#032F62;">idle</span></span>
<span class="line"><span style="color:#6F42C1;">postgres</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">4487</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">4459</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">0</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:37</span><span style="color:#24292E;"> </span><span style="color:#032F62;">?</span><span style="color:#24292E;">        </span><span style="color:#005CC5;">00</span><span style="color:#032F62;">:00:00</span><span style="color:#24292E;"> </span><span style="color:#032F62;">postgres:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">twpg:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">walwriter</span><span style="color:#24292E;"> </span></span>
<span class="line"><span style="color:#6F42C1;">postgres</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">4488</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">4459</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">0</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:37</span><span style="color:#24292E;"> </span><span style="color:#032F62;">?</span><span style="color:#24292E;">        </span><span style="color:#005CC5;">00</span><span style="color:#032F62;">:00:00</span><span style="color:#24292E;"> </span><span style="color:#032F62;">postgres:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">twpg:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">autovacuum</span><span style="color:#24292E;"> </span><span style="color:#032F62;">launcher</span><span style="color:#24292E;"> </span></span>
<span class="line"><span style="color:#6F42C1;">postgres</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">4489</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">4459</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">0</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:37</span><span style="color:#24292E;"> </span><span style="color:#032F62;">?</span><span style="color:#24292E;">        </span><span style="color:#005CC5;">00</span><span style="color:#032F62;">:00:00</span><span style="color:#24292E;"> </span><span style="color:#032F62;">postgres:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">twpg:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">logical</span><span style="color:#24292E;"> </span><span style="color:#032F62;">replication</span><span style="color:#24292E;"> </span><span style="color:#032F62;">launcher</span><span style="color:#24292E;"> </span></span>
<span class="line"><span style="color:#6F42C1;">postgres</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">4490</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">4459</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">0</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:37</span><span style="color:#24292E;"> </span><span style="color:#032F62;">?</span><span style="color:#24292E;">        </span><span style="color:#005CC5;">00</span><span style="color:#032F62;">:00:00</span><span style="color:#24292E;"> </span><span style="color:#032F62;">postgres:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">twpg:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">walsender</span><span style="color:#24292E;"> </span><span style="color:#032F62;">repuser</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">192.168</span><span style="color:#032F62;">.210.33</span><span style="color:#24292E;">(</span><span style="color:#6F42C1;">52430</span><span style="color:#24292E;">) </span><span style="color:#032F62;">streaming</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0</span><span style="color:#032F62;">/5000668</span></span>
<span class="line"><span style="color:#6F42C1;">postgres</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">4491</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">4459</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">0</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:37</span><span style="color:#24292E;"> </span><span style="color:#032F62;">?</span><span style="color:#24292E;">        </span><span style="color:#005CC5;">00</span><span style="color:#032F62;">:00:00</span><span style="color:#24292E;"> </span><span style="color:#032F62;">postgres:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">twpg:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">walsender</span><span style="color:#24292E;"> </span><span style="color:#032F62;">repuser</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">192.168</span><span style="color:#032F62;">.210.81</span><span style="color:#24292E;">(</span><span style="color:#6F42C1;">62184</span><span style="color:#24292E;">) </span><span style="color:#032F62;">streaming</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0</span><span style="color:#032F62;">/5000668</span></span>
<span class="line"><span style="color:#6A737D;">#PostgreSQL服务被patroni自动拉起，未发生故障转移</span></span>
<span class="line"><span style="color:#24292E;">[root@pg_node1 log]# patronictl -c /etc/patroni/patroni.yml list</span></span>
<span class="line"><span style="color:#6F42C1;">+</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Cluster:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">twpg</span><span style="color:#24292E;"> (6976142033405049133) ---+---------+----+-----------+</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Member</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Host</span><span style="color:#24292E;">                </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Role</span><span style="color:#24292E;">    </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">State</span><span style="color:#24292E;">   </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">TL</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Lag</span><span style="color:#24292E;"> </span><span style="color:#032F62;">in</span><span style="color:#24292E;"> </span><span style="color:#032F62;">MB</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#6F42C1;">+--------+---------------------+---------+---------+----+-----------+</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">pg1</span><span style="color:#24292E;">    </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">192.168.210.15:5432</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Leader</span><span style="color:#24292E;">  </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">running</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">  </span><span style="color:#6F42C1;">6</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">           </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">pg2</span><span style="color:#24292E;">    </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">192.168.210.81:5432</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Replica</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">running</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">  </span><span style="color:#6F42C1;">6</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">       </span><span style="color:#6F42C1;">0.0</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">pg3</span><span style="color:#24292E;">    </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">192.168.210.33:5432</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Replica</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">running</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">  </span><span style="color:#6F42C1;">6</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">       </span><span style="color:#6F42C1;">0.0</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#6F42C1;">+--------+---------------------+---------+---------+----+-----------+</span></span>
<span class="line"><span style="color:#6A737D;">#查看下刚刚停止PG服务后的patroni日志，patroni检测到PG服务关闭，会尝试把PG服务启动</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:37:45</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2021</span><span style="color:#032F62;">-06-23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:37:45,395</span><span style="color:#24292E;"> </span><span style="color:#032F62;">INFO:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">no</span><span style="color:#24292E;"> </span><span style="color:#032F62;">action.</span><span style="color:#24292E;">  </span><span style="color:#032F62;">i</span><span style="color:#24292E;"> </span><span style="color:#032F62;">am</span><span style="color:#24292E;"> </span><span style="color:#032F62;">the</span><span style="color:#24292E;"> </span><span style="color:#032F62;">leader</span><span style="color:#24292E;"> </span><span style="color:#032F62;">with</span><span style="color:#24292E;"> </span><span style="color:#032F62;">the</span><span style="color:#24292E;"> </span><span style="color:#032F62;">lock</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:37:47</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2021</span><span style="color:#032F62;">-06-23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:37:47.040</span><span style="color:#24292E;"> </span><span style="color:#032F62;">CST</span><span style="color:#24292E;"> [4012] LOG:  received fast shutdown request</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:37:47</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2021</span><span style="color:#032F62;">-06-23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:37:47.047</span><span style="color:#24292E;"> </span><span style="color:#032F62;">CST</span><span style="color:#24292E;"> [4012] LOG:  aborting any active transactions</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:37:47</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2021</span><span style="color:#032F62;">-06-23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:37:47.047</span><span style="color:#24292E;"> </span><span style="color:#032F62;">CST</span><span style="color:#24292E;"> [4056] FATAL:  terminating connection due to administrator command</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:37:47</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2021</span><span style="color:#032F62;">-06-23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:37:47.048</span><span style="color:#24292E;"> </span><span style="color:#032F62;">CST</span><span style="color:#24292E;"> [4012] LOG:  background worker </span><span style="color:#032F62;">&quot;logical replication launcher&quot;</span><span style="color:#24292E;"> (</span><span style="color:#6F42C1;">PID</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">4258</span><span style="color:#24292E;">) exited with exit code 1</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:37:47</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2021</span><span style="color:#032F62;">-06-23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:37:47.049</span><span style="color:#24292E;"> </span><span style="color:#032F62;">CST</span><span style="color:#24292E;"> [4015] LOG:  shutting down</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:37:47</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2021</span><span style="color:#032F62;">-06-23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:37:47.122</span><span style="color:#24292E;"> </span><span style="color:#032F62;">CST</span><span style="color:#24292E;"> [4012] LOG:  database system is shut down</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:37:55</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2021</span><span style="color:#032F62;">-06-23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:37:55,389</span><span style="color:#24292E;"> </span><span style="color:#032F62;">WARNING:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Postgresql</span><span style="color:#24292E;"> </span><span style="color:#032F62;">is</span><span style="color:#24292E;"> </span><span style="color:#032F62;">not</span><span style="color:#24292E;"> </span><span style="color:#032F62;">running.</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:37:55</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2021</span><span style="color:#032F62;">-06-23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:37:55,390</span><span style="color:#24292E;"> </span><span style="color:#032F62;">INFO:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Lock</span><span style="color:#24292E;"> </span><span style="color:#032F62;">owner:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg1</span><span style="color:#24292E;">; </span><span style="color:#6F42C1;">I</span><span style="color:#24292E;"> </span><span style="color:#032F62;">am</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg1</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:37:55</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2021</span><span style="color:#032F62;">-06-23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:37:55,404</span><span style="color:#24292E;"> </span><span style="color:#032F62;">INFO:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_controldata:</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:37:55</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Database</span><span style="color:#24292E;"> </span><span style="color:#032F62;">system</span><span style="color:#24292E;"> </span><span style="color:#032F62;">identifier:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">6976142033405049133</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:37:55</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_control</span><span style="color:#24292E;"> </span><span style="color:#032F62;">last</span><span style="color:#24292E;"> </span><span style="color:#032F62;">modified:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Wed</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:37:47</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2021</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:37:55</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Blocks</span><span style="color:#24292E;"> </span><span style="color:#032F62;">per</span><span style="color:#24292E;"> </span><span style="color:#032F62;">segment</span><span style="color:#24292E;"> </span><span style="color:#032F62;">of</span><span style="color:#24292E;"> </span><span style="color:#032F62;">large</span><span style="color:#24292E;"> </span><span style="color:#032F62;">relation:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">131072</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:37:55</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Size</span><span style="color:#24292E;"> </span><span style="color:#032F62;">of</span><span style="color:#24292E;"> </span><span style="color:#032F62;">a</span><span style="color:#24292E;"> </span><span style="color:#032F62;">large-object</span><span style="color:#24292E;"> </span><span style="color:#032F62;">chunk:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2048</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:37:55</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">WAL</span><span style="color:#24292E;"> </span><span style="color:#032F62;">block</span><span style="color:#24292E;"> </span><span style="color:#032F62;">size:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">8192</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:37:55</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Latest</span><span style="color:#24292E;"> </span><span style="color:#032F62;">checkpoint&#39;s oldestActiveXID: 0</span></span>
<span class="line"><span style="color:#032F62;">Jun 23 09:37:55 pg_node1 patroni: Latest checkpoint&#39;s</span><span style="color:#24292E;"> </span><span style="color:#032F62;">TimeLineID:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:37:55</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Bytes</span><span style="color:#24292E;"> </span><span style="color:#032F62;">per</span><span style="color:#24292E;"> </span><span style="color:#032F62;">WAL</span><span style="color:#24292E;"> </span><span style="color:#032F62;">segment:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">16777216</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:37:55</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Fake</span><span style="color:#24292E;"> </span><span style="color:#032F62;">LSN</span><span style="color:#24292E;"> </span><span style="color:#032F62;">counter</span><span style="color:#24292E;"> </span><span style="color:#032F62;">for</span><span style="color:#24292E;"> </span><span style="color:#032F62;">unlogged</span><span style="color:#24292E;"> </span><span style="color:#032F62;">rels:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0</span><span style="color:#032F62;">/3E8</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:37:55</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">max_connections</span><span style="color:#24292E;"> </span><span style="color:#032F62;">setting:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">100</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:37:55</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Latest</span><span style="color:#24292E;"> </span><span style="color:#032F62;">checkpoint</span><span style="color:#24292E;"> </span><span style="color:#032F62;">location:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0</span><span style="color:#032F62;">/5000510</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:37:55</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Float8</span><span style="color:#24292E;"> </span><span style="color:#032F62;">argument</span><span style="color:#24292E;"> </span><span style="color:#032F62;">passing:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">by</span><span style="color:#24292E;"> </span><span style="color:#032F62;">value</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:37:55</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Minimum</span><span style="color:#24292E;"> </span><span style="color:#032F62;">recovery</span><span style="color:#24292E;"> </span><span style="color:#032F62;">ending</span><span style="color:#24292E;"> </span><span style="color:#032F62;">location:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0</span><span style="color:#032F62;">/0</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:37:55</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">track_commit_timestamp</span><span style="color:#24292E;"> </span><span style="color:#032F62;">setting:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">off</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:37:55</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Latest</span><span style="color:#24292E;"> </span><span style="color:#032F62;">checkpoint&#39;s newestCommitTsXid: 0</span></span>
<span class="line"><span style="color:#032F62;">Jun 23 09:37:55 pg_node1 patroni: Latest checkpoint&#39;s</span><span style="color:#24292E;"> </span><span style="color:#032F62;">NextMultiXactId:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:37:55</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Maximum</span><span style="color:#24292E;"> </span><span style="color:#032F62;">size</span><span style="color:#24292E;"> </span><span style="color:#032F62;">of</span><span style="color:#24292E;"> </span><span style="color:#032F62;">a</span><span style="color:#24292E;"> </span><span style="color:#032F62;">TOAST</span><span style="color:#24292E;"> </span><span style="color:#032F62;">chunk:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1996</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:37:55</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Maximum</span><span style="color:#24292E;"> </span><span style="color:#032F62;">data</span><span style="color:#24292E;"> </span><span style="color:#032F62;">alignment:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">8</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:37:55</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Date/time</span><span style="color:#24292E;"> </span><span style="color:#032F62;">type</span><span style="color:#24292E;"> </span><span style="color:#032F62;">storage:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">64</span><span style="color:#032F62;">-bit</span><span style="color:#24292E;"> </span><span style="color:#032F62;">integers</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:37:55</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Database</span><span style="color:#24292E;"> </span><span style="color:#032F62;">block</span><span style="color:#24292E;"> </span><span style="color:#032F62;">size:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">8192</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:37:55</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Data</span><span style="color:#24292E;"> </span><span style="color:#032F62;">page</span><span style="color:#24292E;"> </span><span style="color:#032F62;">checksum</span><span style="color:#24292E;"> </span><span style="color:#032F62;">version:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:37:55</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Time</span><span style="color:#24292E;"> </span><span style="color:#032F62;">of</span><span style="color:#24292E;"> </span><span style="color:#032F62;">latest</span><span style="color:#24292E;"> </span><span style="color:#032F62;">checkpoint:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Wed</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:37:47</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2021</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:37:55</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">wal_log_hints</span><span style="color:#24292E;"> </span><span style="color:#032F62;">setting:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">on</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:37:55</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Latest</span><span style="color:#24292E;"> </span><span style="color:#032F62;">checkpoint&#39;s full_page_writes: on</span></span>
<span class="line"><span style="color:#032F62;">Jun 23 09:37:55 pg_node1 patroni: End-of-backup record required: no</span></span>
<span class="line"><span style="color:#032F62;">Jun 23 09:37:55 pg_node1 patroni: max_prepared_xacts setting: 0</span></span>
<span class="line"><span style="color:#032F62;">Jun 23 09:37:55 pg_node1 patroni: Latest checkpoint&#39;s</span><span style="color:#24292E;"> </span><span style="color:#032F62;">NextMultiOffset:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:37:55</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Backup</span><span style="color:#24292E;"> </span><span style="color:#032F62;">start</span><span style="color:#24292E;"> </span><span style="color:#032F62;">location:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0</span><span style="color:#032F62;">/0</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:37:55</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Latest</span><span style="color:#24292E;"> </span><span style="color:#032F62;">checkpoint&#39;s oldestMultiXid: 1</span></span>
<span class="line"><span style="color:#032F62;">Jun 23 09:37:55 pg_node1 patroni: Mock authentication nonce: 020ac2d0808d3cf471a8d90e23263e8a317b31c5f7e494fc3fba551683e5c39b</span></span>
<span class="line"><span style="color:#032F62;">Jun 23 09:37:55 pg_node1 patroni: Latest checkpoint&#39;s</span><span style="color:#24292E;"> </span><span style="color:#032F62;">NextOID:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">16385</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:37:55</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Maximum</span><span style="color:#24292E;"> </span><span style="color:#032F62;">columns</span><span style="color:#24292E;"> </span><span style="color:#032F62;">in</span><span style="color:#24292E;"> </span><span style="color:#032F62;">an</span><span style="color:#24292E;"> </span><span style="color:#032F62;">index:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">32</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:37:55</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Latest</span><span style="color:#24292E;"> </span><span style="color:#032F62;">checkpoint&#39;s oldestXID: 479</span></span>
<span class="line"><span style="color:#032F62;">Jun 23 09:37:55 pg_node1 patroni: Catalog version number: 202007201</span></span>
<span class="line"><span style="color:#032F62;">Jun 23 09:37:55 pg_node1 patroni: max_worker_processes setting: 8</span></span>
<span class="line"><span style="color:#032F62;">Jun 23 09:37:55 pg_node1 patroni: Maximum length of identifiers: 64</span></span>
<span class="line"><span style="color:#032F62;">Jun 23 09:37:55 pg_node1 patroni: Min recovery ending loc&#39;s</span><span style="color:#24292E;"> </span><span style="color:#032F62;">timeline:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:37:55</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">max_locks_per_xact</span><span style="color:#24292E;"> </span><span style="color:#032F62;">setting:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">64</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:37:55</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">max_wal_senders</span><span style="color:#24292E;"> </span><span style="color:#032F62;">setting:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">10</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:37:55</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Latest</span><span style="color:#24292E;"> </span><span style="color:#032F62;">checkpoint&#39;s NextXID: 0:488</span></span>
<span class="line"><span style="color:#032F62;">Jun 23 09:37:55 pg_node1 patroni: Latest checkpoint&#39;s</span><span style="color:#24292E;"> </span><span style="color:#032F62;">REDO</span><span style="color:#24292E;"> </span><span style="color:#032F62;">location:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0</span><span style="color:#032F62;">/5000510</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:37:55</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Backup</span><span style="color:#24292E;"> </span><span style="color:#032F62;">end</span><span style="color:#24292E;"> </span><span style="color:#032F62;">location:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0</span><span style="color:#032F62;">/0</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:37:55</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Database</span><span style="color:#24292E;"> </span><span style="color:#032F62;">cluster</span><span style="color:#24292E;"> </span><span style="color:#032F62;">state:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">shut</span><span style="color:#24292E;"> </span><span style="color:#032F62;">down</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:37:55</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_control</span><span style="color:#24292E;"> </span><span style="color:#032F62;">version</span><span style="color:#24292E;"> </span><span style="color:#032F62;">number:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1300</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:37:55</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">wal_level</span><span style="color:#24292E;"> </span><span style="color:#032F62;">setting:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">replica</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:37:55</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Latest</span><span style="color:#24292E;"> </span><span style="color:#032F62;">checkpoint&#39;s REDO WAL file: 000000050000000000000005</span></span>
<span class="line"><span style="color:#032F62;">Jun 23 09:37:55 pg_node1 patroni: Latest checkpoint&#39;s</span><span style="color:#24292E;"> </span><span style="color:#032F62;">oldestCommitTsXid:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:37:55</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Latest</span><span style="color:#24292E;"> </span><span style="color:#032F62;">checkpoint&#39;s oldestXID&#39;s</span><span style="color:#24292E;"> </span><span style="color:#032F62;">DB:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:37:55</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Latest</span><span style="color:#24292E;"> </span><span style="color:#032F62;">checkpoint&#39;s oldestMulti&#39;s</span><span style="color:#24292E;"> </span><span style="color:#032F62;">DB:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:37:55</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Latest</span><span style="color:#24292E;"> </span><span style="color:#032F62;">checkpoint&#39;s PrevTimeLineID: 5</span></span>
<span class="line"><span style="color:#032F62;">Jun 23 09:37:55 pg_node1 patroni: 2021-06-23 09:37:55,406 INFO: Lock owner: pg1; I am pg1</span></span>
<span class="line"><span style="color:#032F62;">Jun 23 09:37:55 pg_node1 patroni: 2021-06-23 09:37:55,406 INFO: Lock owner: pg1; I am pg1</span></span>
<span class="line"><span style="color:#032F62;">Jun 23 09:37:55 pg_node1 patroni: 2021-06-23 09:37:55,418 INFO: starting as readonly because i had the session lock</span></span>
<span class="line"><span style="color:#032F62;">Jun 23 09:37:55 pg_node1 patroni: 2021-06-23 09:37:55,420 INFO: closed patroni connection to the postgresql cluster</span></span>
<span class="line"><span style="color:#032F62;">Jun 23 09:37:55 pg_node1 patroni: 2021-06-23 09:37:55,452 INFO: postmaster pid=4459</span></span>
<span class="line"><span style="color:#032F62;">Jun 23 09:37:55 pg_node1 patroni: localhost:5432 - no response</span></span>
<span class="line"><span style="color:#032F62;">Jun 23 09:37:55 pg_node1 patroni: 2021-06-23 09:37:55.485 CST [4459] LOG:  starting PostgreSQL 13.3 on x86_64-pc-linux-gnu, compiled by gcc (GCC) 4.8.5 20150623 (Red Hat 4.8.5-44), 64-bit</span></span>
<span class="line"><span style="color:#032F62;">Jun 23 09:37:55 pg_node1 patroni: 2021-06-23 09:37:55.485 CST [4459] LOG:  listening on IPv4 address &quot;0.0.0.0&quot;, port 5432</span></span>
<span class="line"><span style="color:#032F62;">Jun 23 09:37:55 pg_node1 patroni: 2021-06-23 09:37:55.508 CST [4459] LOG:  listening on Unix socket &quot;/tmp/.s.PGSQL.5432&quot;</span></span>
<span class="line"><span style="color:#032F62;">Jun 23 09:37:55 pg_node1 patroni: 2021-06-23 09:37:55.524 CST [4461] LOG:  database system was shut down at 2021-06-23 09:37:47 CST</span></span>
<span class="line"><span style="color:#032F62;">Jun 23 09:37:55 pg_node1 patroni: 2021-06-23 09:37:55.525 CST [4461] WARNING:  specified neither primary_conninfo nor restore_command</span></span>
<span class="line"><span style="color:#032F62;">Jun 23 09:37:55 pg_node1 patroni: 2021-06-23 09:37:55.525 CST [4461] HINT:  The database server will regularly poll the pg_wal subdirectory to check for files placed there.</span></span>
<span class="line"><span style="color:#032F62;">Jun 23 09:37:55 pg_node1 patroni: 2021-06-23 09:37:55.525 CST [4461] LOG:  entering standby mode</span></span>
<span class="line"><span style="color:#032F62;">Jun 23 09:37:55 pg_node1 patroni: 2021-06-23 09:37:55.533 CST [4461] LOG:  consistent recovery state reached at 0/5000588</span></span>
<span class="line"><span style="color:#032F62;">Jun 23 09:37:55 pg_node1 patroni: 2021-06-23 09:37:55.534 CST [4461] LOG:  invalid record length at 0/5000588: wanted 24, got 0</span></span>
<span class="line"><span style="color:#032F62;">Jun 23 09:37:55 pg_node1 patroni: 2021-06-23 09:37:55.535 CST [4459] LOG:  database system is ready to accept read only connections</span></span>
<span class="line"><span style="color:#032F62;">Jun 23 09:37:56 pg_node1 patroni: localhost:5432 - accepting connections</span></span>
<span class="line"><span style="color:#032F62;">Jun 23 09:37:56 pg_node1 patroni: localhost:5432 - accepting connections</span></span>
<span class="line"><span style="color:#032F62;">Jun 23 09:37:56 pg_node1 patroni: this is patroni callback on_role_change replica twpg</span></span>
<span class="line"><span style="color:#032F62;">Jun 23 09:37:56 pg_node1 patroni: 2021-06-23 09:37:56,544 INFO: Lock owner: pg1; I am pg1</span></span>
<span class="line"><span style="color:#032F62;">Jun 23 09:37:56 pg_node1 patroni: 2021-06-23 09:37:56,545 INFO: establishing a new patroni connection to the postgres cluster</span></span>
<span class="line"><span style="color:#032F62;">Jun 23 09:37:56 pg_node1 systemd: Started Session c31 of user root.</span></span>
<span class="line"><span style="color:#032F62;">Jun 23 09:37:56 pg_node1 patroni: 2021-06-23 09:37:56,570 INFO: Software Watchdog activated with 25 second timeout, timing slack 15 seconds</span></span>
<span class="line"><span style="color:#032F62;">Jun 23 09:37:56 pg_node1 patroni: 2021-06-23 09:37:56,584 INFO: promoted self to leader because i had the session lock</span></span>
<span class="line"><span style="color:#032F62;">Jun 23 09:37:56 pg_node1 patroni: 2021-06-23 09:37:56,586 INFO: Lock owner: pg1; I am pg1</span></span>
<span class="line"><span style="color:#032F62;">Jun 23 09:37:56 pg_node1 patroni: server promoting</span></span>
<span class="line"><span style="color:#032F62;">Jun 23 09:37:56 pg_node1 patroni: 2021-06-23 09:37:56.593 CST [4461] LOG:  received promote request</span></span>
<span class="line"><span style="color:#032F62;">Jun 23 09:37:56 pg_node1 patroni: 2021-06-23 09:37:56.593 CST [4461] LOG:  redo is not required</span></span>
<span class="line"><span style="color:#032F62;">Jun 23 09:37:56 pg_node1 patroni: 2021-06-23 09:37:56,593 INFO: cleared rewind state after becoming the leader</span></span>
<span class="line"><span style="color:#032F62;">Jun 23 09:37:56 pg_node1 patroni: 2021-06-23 09:37:56.599 CST [4461] LOG:  selected new timeline ID: 6</span></span>
<span class="line"><span style="color:#032F62;">Jun 23 09:37:56 pg_node1 patroni: this is patroni callback on_role_change master twpg</span></span>
<span class="line"><span style="color:#032F62;">Jun 23 09:37:56 pg_node1 patroni: 2021-06-23 09:37:56,618 INFO: updated leader lock during promote</span></span>
<span class="line"><span style="color:#032F62;">Jun 23 09:37:56 pg_node1 systemd: Started Session c32 of user root.</span></span>
<span class="line"><span style="color:#032F62;">Jun 23 09:37:56 pg_node1 systemd: Started Session c33 of user root.</span></span>
<span class="line"><span style="color:#032F62;">Jun 23 09:37:56 pg_node1 patroni: 2021-06-23 09:37:56.880 CST [4461] LOG:  archive recovery complete</span></span>
<span class="line"><span style="color:#032F62;">Jun 23 09:37:56 pg_node1 patroni: 2021-06-23 09:37:56.911 CST [4459] LOG:  database system is ready to accept connections</span></span>
<span class="line"><span style="color:#032F62;">Jun 23 09:37:57 pg_node1 patroni: 2021-06-23 09:37:57,638 INFO: Lock owner: pg1; I am pg1</span></span>
<span class="line"><span style="color:#032F62;">Jun 23 09:37:57 pg_node1 patroni: 2021-06-23 09:37:57,724 INFO: no action.  i am the leader with the lock</span></span>
<span class="line"></span>
<span class="line"><span style="color:#032F62;">#模拟PostgreSQL数据库出现问题</span></span>
<span class="line"><span style="color:#032F62;">#停止备库服务</span></span>
<span class="line"><span style="color:#032F62;">[postgres@pg_node2 ~]$ pg_ctl stop -D /opt/PostgreSQL/13/data</span></span>
<span class="line"><span style="color:#032F62;">waiting for server to shut down.... done</span></span>
<span class="line"><span style="color:#032F62;">server stopped</span></span>
<span class="line"><span style="color:#032F62;">[postgres@pg_node2 ~]$ ps -ef|grep postgres</span></span>
<span class="line"><span style="color:#032F62;">postgres 26277 26180  0 09:51 pts/0    00:00:00 grep --color=auto postgres</span></span>
<span class="line"><span style="color:#032F62;">[postgres@pg_node2 ~]$ ps -ef|grep postgres</span></span>
<span class="line"><span style="color:#032F62;">postgres 26284     1  2 09:51 ?        00:00:00 /opt/PostgreSQL/13/bin/postgres -D /opt/PostgreSQL/13/data --config-file=/opt/PostgreSQL/13/data/postgresql.conf --listen_addresses=0.0.0.0 --max_worker_processes=8 --max_prepared_transactions=0 --wal_level=replica --track_commit_timestamp=off --max_locks_per_transaction=64 --port=5432 --max_replication_slots=10 --max_connections=100 --hot_standby=on --cluster_name=twpg --wal_log_hints=on --max_wal_senders=10</span></span>
<span class="line"><span style="color:#032F62;">postgres 26286 26284  0 09:51 ?        00:00:00 postgres: twpg: startup recovering 000000060000000000000005</span></span>
<span class="line"><span style="color:#032F62;">postgres 26287 26284  0 09:51 ?        00:00:00 postgres: twpg: checkpointer </span></span>
<span class="line"><span style="color:#032F62;">postgres 26288 26284  0 09:51 ?        00:00:00 postgres: twpg: background writer </span></span>
<span class="line"><span style="color:#032F62;">postgres 26289 26284  0 09:51 ?        00:00:00 postgres: twpg: stats collector </span></span>
<span class="line"><span style="color:#032F62;">postgres 26290 26284  0 09:51 ?        00:00:00 postgres: twpg: walreceiver </span></span>
<span class="line"><span style="color:#032F62;">postgres 26293 26180  0 09:51 pts/0    00:00:00 grep --color=auto postgres</span></span>
<span class="line"><span style="color:#032F62;">#查看下刚刚停止PG服务后的patroni日志，patroni检测到PG服务关闭，会尝试把PG服务启动</span></span>
<span class="line"><span style="color:#032F62;">Jun 23 09:51:29 pg_node2 patroni: 2021-06-23 09:51:29,043 INFO: does not have lock</span></span>
<span class="line"><span style="color:#032F62;">Jun 23 09:51:29 pg_node2 patroni: 2021-06-23 09:51:29,045 INFO: no action.  i am a secondary and i am following a leader</span></span>
<span class="line"><span style="color:#032F62;">Jun 23 09:51:37 pg_node2 patroni: 2021-06-23 09:51:37.498 CST [26228] LOG:  received fast shutdown request</span></span>
<span class="line"><span style="color:#032F62;">Jun 23 09:51:37 pg_node2 patroni: 2021-06-23 09:51:37.505 CST [26228] LOG:  aborting any active transactions</span></span>
<span class="line"><span style="color:#032F62;">Jun 23 09:51:37 pg_node2 patroni: 2021-06-23 09:51:37.505 CST [26234] FATAL:  terminating walreceiver process due to administrator command</span></span>
<span class="line"><span style="color:#032F62;">Jun 23 09:51:37 pg_node2 patroni: 2021-06-23 09:51:37.505 CST [26241] FATAL:  terminating connection due to administrator command</span></span>
<span class="line"><span style="color:#032F62;">Jun 23 09:51:37 pg_node2 patroni: 2021-06-23 09:51:37.507 CST [26231] LOG:  shutting down</span></span>
<span class="line"><span style="color:#032F62;">Jun 23 09:51:37 pg_node2 patroni: 2021-06-23 09:51:37.522 CST [26228] LOG:  database system is shut down</span></span>
<span class="line"><span style="color:#032F62;">Jun 23 09:51:39 pg_node2 patroni: 2021-06-23 09:51:39,042 WARNING: Postgresql is not running.</span></span>
<span class="line"><span style="color:#032F62;">Jun 23 09:51:39 pg_node2 patroni: 2021-06-23 09:51:39,042 INFO: Lock owner: pg1; I am pg2</span></span>
<span class="line"><span style="color:#032F62;">Jun 23 09:51:39 pg_node2 patroni: 2021-06-23 09:51:39,053 INFO: pg_controldata:</span></span>
<span class="line"><span style="color:#032F62;">Jun 23 09:51:39 pg_node2 patroni: Database system identifier: 6976142033405049133</span></span>
<span class="line"><span style="color:#032F62;">Jun 23 09:51:39 pg_node2 patroni: pg_control last modified: Wed Jun 23 09:51:37 2021</span></span>
<span class="line"><span style="color:#032F62;">Jun 23 09:51:39 pg_node2 patroni: Blocks per segment of large relation: 131072</span></span>
<span class="line"><span style="color:#032F62;">Jun 23 09:51:39 pg_node2 patroni: Size of a large-object chunk: 2048</span></span>
<span class="line"><span style="color:#032F62;">Jun 23 09:51:39 pg_node2 patroni: WAL block size: 8192</span></span>
<span class="line"><span style="color:#032F62;">Jun 23 09:51:39 pg_node2 patroni: Latest checkpoint&#39;s</span><span style="color:#24292E;"> </span><span style="color:#032F62;">oldestActiveXID:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">488</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:51:39</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node2</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Latest</span><span style="color:#24292E;"> </span><span style="color:#032F62;">checkpoint&#39;s TimeLineID: 6</span></span>
<span class="line"><span style="color:#032F62;">Jun 23 09:51:39 pg_node2 patroni: Bytes per WAL segment: 16777216</span></span>
<span class="line"><span style="color:#032F62;">Jun 23 09:51:39 pg_node2 patroni: Fake LSN counter for unlogged rels: 0/3E8</span></span>
<span class="line"><span style="color:#032F62;">Jun 23 09:51:39 pg_node2 patroni: max_connections setting: 100</span></span>
<span class="line"><span style="color:#032F62;">Jun 23 09:51:39 pg_node2 patroni: Latest checkpoint location: 0/50006A0</span></span>
<span class="line"><span style="color:#032F62;">Jun 23 09:51:39 pg_node2 patroni: Float8 argument passing: by value</span></span>
<span class="line"><span style="color:#032F62;">Jun 23 09:51:39 pg_node2 patroni: Minimum recovery ending location: 0/5000750</span></span>
<span class="line"><span style="color:#032F62;">Jun 23 09:51:39 pg_node2 patroni: track_commit_timestamp setting: off</span></span>
<span class="line"><span style="color:#032F62;">Jun 23 09:51:39 pg_node2 patroni: Latest checkpoint&#39;s</span><span style="color:#24292E;"> </span><span style="color:#032F62;">newestCommitTsXid:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:51:39</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node2</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Latest</span><span style="color:#24292E;"> </span><span style="color:#032F62;">checkpoint&#39;s NextMultiXactId: 1</span></span>
<span class="line"><span style="color:#032F62;">Jun 23 09:51:39 pg_node2 patroni: Maximum size of a TOAST chunk: 1996</span></span>
<span class="line"><span style="color:#032F62;">Jun 23 09:51:39 pg_node2 patroni: Maximum data alignment: 8</span></span>
<span class="line"><span style="color:#032F62;">Jun 23 09:51:39 pg_node2 patroni: Date/time type storage: 64-bit integers</span></span>
<span class="line"><span style="color:#032F62;">Jun 23 09:51:39 pg_node2 patroni: Database block size: 8192</span></span>
<span class="line"><span style="color:#032F62;">Jun 23 09:51:39 pg_node2 patroni: Data page checksum version: 1</span></span>
<span class="line"><span style="color:#032F62;">Jun 23 09:51:39 pg_node2 patroni: Time of latest checkpoint: Wed Jun 23 09:37:57 2021</span></span>
<span class="line"><span style="color:#032F62;">Jun 23 09:51:39 pg_node2 patroni: wal_log_hints setting: on</span></span>
<span class="line"><span style="color:#032F62;">Jun 23 09:51:39 pg_node2 patroni: Latest checkpoint&#39;s</span><span style="color:#24292E;"> </span><span style="color:#032F62;">full_page_writes:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">on</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:51:39</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node2</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">End-of-backup</span><span style="color:#24292E;"> </span><span style="color:#032F62;">record</span><span style="color:#24292E;"> </span><span style="color:#032F62;">required:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">no</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:51:39</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node2</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">max_prepared_xacts</span><span style="color:#24292E;"> </span><span style="color:#032F62;">setting:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:51:39</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node2</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Latest</span><span style="color:#24292E;"> </span><span style="color:#032F62;">checkpoint&#39;s NextMultiOffset: 0</span></span>
<span class="line"><span style="color:#032F62;">Jun 23 09:51:39 pg_node2 patroni: Backup start location: 0/0</span></span>
<span class="line"><span style="color:#032F62;">Jun 23 09:51:39 pg_node2 patroni: Latest checkpoint&#39;s</span><span style="color:#24292E;"> </span><span style="color:#032F62;">oldestMultiXid:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:51:39</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node2</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Mock</span><span style="color:#24292E;"> </span><span style="color:#032F62;">authentication</span><span style="color:#24292E;"> </span><span style="color:#032F62;">nonce:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">020</span><span style="color:#032F62;">ac2d0808d3cf471a8d90e23263e8a317b31c5f7e494fc3fba551683e5c39b</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:51:39</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node2</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Latest</span><span style="color:#24292E;"> </span><span style="color:#032F62;">checkpoint&#39;s NextOID: 16385</span></span>
<span class="line"><span style="color:#032F62;">Jun 23 09:51:39 pg_node2 patroni: Maximum columns in an index: 32</span></span>
<span class="line"><span style="color:#032F62;">Jun 23 09:51:39 pg_node2 patroni: Latest checkpoint&#39;s</span><span style="color:#24292E;"> </span><span style="color:#032F62;">oldestXID:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">479</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:51:39</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node2</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Catalog</span><span style="color:#24292E;"> </span><span style="color:#032F62;">version</span><span style="color:#24292E;"> </span><span style="color:#032F62;">number:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">202007201</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:51:39</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node2</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">max_worker_processes</span><span style="color:#24292E;"> </span><span style="color:#032F62;">setting:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">8</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:51:39</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node2</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Maximum</span><span style="color:#24292E;"> </span><span style="color:#032F62;">length</span><span style="color:#24292E;"> </span><span style="color:#032F62;">of</span><span style="color:#24292E;"> </span><span style="color:#032F62;">identifiers:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">64</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:51:39</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node2</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Min</span><span style="color:#24292E;"> </span><span style="color:#032F62;">recovery</span><span style="color:#24292E;"> </span><span style="color:#032F62;">ending</span><span style="color:#24292E;"> </span><span style="color:#032F62;">loc&#39;s timeline: 6</span></span>
<span class="line"><span style="color:#032F62;">Jun 23 09:51:39 pg_node2 patroni: max_locks_per_xact setting: 64</span></span>
<span class="line"><span style="color:#032F62;">Jun 23 09:51:39 pg_node2 patroni: max_wal_senders setting: 10</span></span>
<span class="line"><span style="color:#032F62;">Jun 23 09:51:39 pg_node2 patroni: Latest checkpoint&#39;s</span><span style="color:#24292E;"> </span><span style="color:#032F62;">NextXID:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0</span><span style="color:#032F62;">:488</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:51:39</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node2</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Latest</span><span style="color:#24292E;"> </span><span style="color:#032F62;">checkpoint&#39;s REDO location: 0/5000668</span></span>
<span class="line"><span style="color:#032F62;">Jun 23 09:51:39 pg_node2 patroni: Backup end location: 0/0</span></span>
<span class="line"><span style="color:#032F62;">Jun 23 09:51:39 pg_node2 patroni: Database cluster state: shut down in recovery</span></span>
<span class="line"><span style="color:#032F62;">Jun 23 09:51:39 pg_node2 patroni: pg_control version number: 1300</span></span>
<span class="line"><span style="color:#032F62;">Jun 23 09:51:39 pg_node2 patroni: wal_level setting: replica</span></span>
<span class="line"><span style="color:#032F62;">Jun 23 09:51:39 pg_node2 patroni: Latest checkpoint&#39;s</span><span style="color:#24292E;"> </span><span style="color:#032F62;">REDO</span><span style="color:#24292E;"> </span><span style="color:#032F62;">WAL</span><span style="color:#24292E;"> </span><span style="color:#032F62;">file:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">000000060000000000000005</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:51:39</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node2</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Latest</span><span style="color:#24292E;"> </span><span style="color:#032F62;">checkpoint&#39;s oldestCommitTsXid: 0</span></span>
<span class="line"><span style="color:#032F62;">Jun 23 09:51:39 pg_node2 patroni: Latest checkpoint&#39;s</span><span style="color:#24292E;"> </span><span style="color:#032F62;">oldestXID&#39;s DB: 1</span></span>
<span class="line"><span style="color:#032F62;">Jun 23 09:51:39 pg_node2 patroni: Latest checkpoint&#39;s</span><span style="color:#24292E;"> </span><span style="color:#032F62;">oldestMulti&#39;s DB: 1</span></span>
<span class="line"><span style="color:#032F62;">Jun 23 09:51:39 pg_node2 patroni: Latest checkpoint&#39;s</span><span style="color:#24292E;"> </span><span style="color:#032F62;">PrevTimeLineID:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">6</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:51:39</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node2</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2021</span><span style="color:#032F62;">-06-23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:51:39,055</span><span style="color:#24292E;"> </span><span style="color:#032F62;">INFO:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Lock</span><span style="color:#24292E;"> </span><span style="color:#032F62;">owner:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg1</span><span style="color:#24292E;">; </span><span style="color:#6F42C1;">I</span><span style="color:#24292E;"> </span><span style="color:#032F62;">am</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg2</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:51:39</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node2</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2021</span><span style="color:#032F62;">-06-23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:51:39,081</span><span style="color:#24292E;"> </span><span style="color:#032F62;">INFO:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Local</span><span style="color:#24292E;"> </span><span style="color:#032F62;">timeline=</span><span style="color:#005CC5;">6</span><span style="color:#24292E;"> </span><span style="color:#032F62;">lsn=</span><span style="color:#005CC5;">0</span><span style="color:#032F62;">/5000750</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:51:39</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node2</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2021</span><span style="color:#032F62;">-06-23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:51:39,088</span><span style="color:#24292E;"> </span><span style="color:#032F62;">INFO:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">master_timeline=</span><span style="color:#005CC5;">6</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:51:39</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node2</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2021</span><span style="color:#032F62;">-06-23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:51:39,089</span><span style="color:#24292E;"> </span><span style="color:#032F62;">INFO:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Lock</span><span style="color:#24292E;"> </span><span style="color:#032F62;">owner:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg1</span><span style="color:#24292E;">; </span><span style="color:#6F42C1;">I</span><span style="color:#24292E;"> </span><span style="color:#032F62;">am</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg2</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:51:39</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node2</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2021</span><span style="color:#032F62;">-06-23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:51:39,105</span><span style="color:#24292E;"> </span><span style="color:#032F62;">INFO:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">starting</span><span style="color:#24292E;"> </span><span style="color:#032F62;">as</span><span style="color:#24292E;"> </span><span style="color:#032F62;">a</span><span style="color:#24292E;"> </span><span style="color:#032F62;">secondary</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:51:39</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node2</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2021</span><span style="color:#032F62;">-06-23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:51:39,107</span><span style="color:#24292E;"> </span><span style="color:#032F62;">INFO:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">closed</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni</span><span style="color:#24292E;"> </span><span style="color:#032F62;">connection</span><span style="color:#24292E;"> </span><span style="color:#032F62;">to</span><span style="color:#24292E;"> </span><span style="color:#032F62;">the</span><span style="color:#24292E;"> </span><span style="color:#032F62;">postgresql</span><span style="color:#24292E;"> </span><span style="color:#032F62;">cluster</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:51:39</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node2</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2021</span><span style="color:#032F62;">-06-23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:51:39,130</span><span style="color:#24292E;"> </span><span style="color:#032F62;">INFO:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">postmaster</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pid=</span><span style="color:#005CC5;">26284</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:51:39</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node2</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">localhost:5432</span><span style="color:#24292E;"> </span><span style="color:#032F62;">-</span><span style="color:#24292E;"> </span><span style="color:#032F62;">no</span><span style="color:#24292E;"> </span><span style="color:#032F62;">response</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:51:39</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node2</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2021</span><span style="color:#032F62;">-06-23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:51:39.172</span><span style="color:#24292E;"> </span><span style="color:#032F62;">CST</span><span style="color:#24292E;"> [26284] LOG:  starting PostgreSQL 13.3 on x86_64-pc-linux-gnu, compiled by gcc (</span><span style="color:#6F42C1;">GCC</span><span style="color:#24292E;">) 4.8.5 20150623 (</span><span style="color:#6F42C1;">Red</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Hat</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">4.8</span><span style="color:#032F62;">.5-44</span><span style="color:#24292E;">), 64-bit</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:51:39</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node2</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2021</span><span style="color:#032F62;">-06-23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:51:39.172</span><span style="color:#24292E;"> </span><span style="color:#032F62;">CST</span><span style="color:#24292E;"> [26284] LOG:  listening on IPv4 address </span><span style="color:#032F62;">&quot;0.0.0.0&quot;</span><span style="color:#24292E;">, port 5432</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:51:39</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node2</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2021</span><span style="color:#032F62;">-06-23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:51:39.186</span><span style="color:#24292E;"> </span><span style="color:#032F62;">CST</span><span style="color:#24292E;"> [26284] LOG:  listening on Unix socket </span><span style="color:#032F62;">&quot;/tmp/.s.PGSQL.5432&quot;</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:51:39</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node2</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2021</span><span style="color:#032F62;">-06-23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:51:39.203</span><span style="color:#24292E;"> </span><span style="color:#032F62;">CST</span><span style="color:#24292E;"> [26286] LOG:  database system was shut down </span><span style="color:#D73A49;">in</span><span style="color:#24292E;"> recovery at 2021-06-23 09:51:37 CST</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:51:39</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node2</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2021</span><span style="color:#032F62;">-06-23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:51:39.203</span><span style="color:#24292E;"> </span><span style="color:#032F62;">CST</span><span style="color:#24292E;"> [26286] LOG:  entering standby mode</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:51:39</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node2</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2021</span><span style="color:#032F62;">-06-23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:51:39.212</span><span style="color:#24292E;"> </span><span style="color:#032F62;">CST</span><span style="color:#24292E;"> [26286] LOG:  redo starts at 0/5000668</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:51:39</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node2</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2021</span><span style="color:#032F62;">-06-23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:51:39.212</span><span style="color:#24292E;"> </span><span style="color:#032F62;">CST</span><span style="color:#24292E;"> [26286] LOG:  consistent recovery state reached at 0/5000750</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:51:39</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node2</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2021</span><span style="color:#032F62;">-06-23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:51:39.212</span><span style="color:#24292E;"> </span><span style="color:#032F62;">CST</span><span style="color:#24292E;"> [26286] LOG:  invalid record length at 0/5000750: wanted 24, got 0</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:51:39</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node2</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2021</span><span style="color:#032F62;">-06-23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:51:39.213</span><span style="color:#24292E;"> </span><span style="color:#032F62;">CST</span><span style="color:#24292E;"> [26284] LOG:  database system is ready to accept read only connections</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:51:39</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node2</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2021</span><span style="color:#032F62;">-06-23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:51:39.229</span><span style="color:#24292E;"> </span><span style="color:#032F62;">CST</span><span style="color:#24292E;"> [26290] LOG:  started streaming WAL from primary at 0/5000000 on timeline 6</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:51:40</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node2</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">localhost:5432</span><span style="color:#24292E;"> </span><span style="color:#032F62;">-</span><span style="color:#24292E;"> </span><span style="color:#032F62;">accepting</span><span style="color:#24292E;"> </span><span style="color:#032F62;">connections</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:51:40</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node2</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">localhost:5432</span><span style="color:#24292E;"> </span><span style="color:#032F62;">-</span><span style="color:#24292E;"> </span><span style="color:#032F62;">accepting</span><span style="color:#24292E;"> </span><span style="color:#032F62;">connections</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:51:40</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node2</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">this</span><span style="color:#24292E;"> </span><span style="color:#032F62;">is</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni</span><span style="color:#24292E;"> </span><span style="color:#032F62;">callback</span><span style="color:#24292E;"> </span><span style="color:#032F62;">on_start</span><span style="color:#24292E;"> </span><span style="color:#032F62;">replica</span><span style="color:#24292E;"> </span><span style="color:#032F62;">twpg</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:51:40</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node2</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2021</span><span style="color:#032F62;">-06-23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:51:40,229</span><span style="color:#24292E;"> </span><span style="color:#032F62;">INFO:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Lock</span><span style="color:#24292E;"> </span><span style="color:#032F62;">owner:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg1</span><span style="color:#24292E;">; </span><span style="color:#6F42C1;">I</span><span style="color:#24292E;"> </span><span style="color:#032F62;">am</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg2</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:51:40</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node2</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2021</span><span style="color:#032F62;">-06-23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:51:40,229</span><span style="color:#24292E;"> </span><span style="color:#032F62;">INFO:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">does</span><span style="color:#24292E;"> </span><span style="color:#032F62;">not</span><span style="color:#24292E;"> </span><span style="color:#032F62;">have</span><span style="color:#24292E;"> </span><span style="color:#032F62;">lock</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:51:40</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node2</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2021</span><span style="color:#032F62;">-06-23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:51:40,229</span><span style="color:#24292E;"> </span><span style="color:#032F62;">INFO:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">establishing</span><span style="color:#24292E;"> </span><span style="color:#032F62;">a</span><span style="color:#24292E;"> </span><span style="color:#032F62;">new</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni</span><span style="color:#24292E;"> </span><span style="color:#032F62;">connection</span><span style="color:#24292E;"> </span><span style="color:#032F62;">to</span><span style="color:#24292E;"> </span><span style="color:#032F62;">the</span><span style="color:#24292E;"> </span><span style="color:#032F62;">postgres</span><span style="color:#24292E;"> </span><span style="color:#032F62;">cluster</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:51:40</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node2</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2021</span><span style="color:#032F62;">-06-23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:51:40,261</span><span style="color:#24292E;"> </span><span style="color:#032F62;">INFO:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">no</span><span style="color:#24292E;"> </span><span style="color:#032F62;">action.</span><span style="color:#24292E;">  </span><span style="color:#032F62;">i</span><span style="color:#24292E;"> </span><span style="color:#032F62;">am</span><span style="color:#24292E;"> </span><span style="color:#032F62;">a</span><span style="color:#24292E;"> </span><span style="color:#032F62;">secondary</span><span style="color:#24292E;"> </span><span style="color:#032F62;">and</span><span style="color:#24292E;"> </span><span style="color:#032F62;">i</span><span style="color:#24292E;"> </span><span style="color:#032F62;">am</span><span style="color:#24292E;"> </span><span style="color:#032F62;">following</span><span style="color:#24292E;"> </span><span style="color:#032F62;">a</span><span style="color:#24292E;"> </span><span style="color:#032F62;">leader</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:51:50</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node2</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2021</span><span style="color:#032F62;">-06-23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:51:50,228</span><span style="color:#24292E;"> </span><span style="color:#032F62;">INFO:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Lock</span><span style="color:#24292E;"> </span><span style="color:#032F62;">owner:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg1</span><span style="color:#24292E;">; </span><span style="color:#6F42C1;">I</span><span style="color:#24292E;"> </span><span style="color:#032F62;">am</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg2</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:51:50</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node2</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2021</span><span style="color:#032F62;">-06-23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:51:50,228</span><span style="color:#24292E;"> </span><span style="color:#032F62;">INFO:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">does</span><span style="color:#24292E;"> </span><span style="color:#032F62;">not</span><span style="color:#24292E;"> </span><span style="color:#032F62;">have</span><span style="color:#24292E;"> </span><span style="color:#032F62;">lock</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:51:50</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node2</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2021</span><span style="color:#032F62;">-06-23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:51:50,238</span><span style="color:#24292E;"> </span><span style="color:#032F62;">INFO:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">no</span><span style="color:#24292E;"> </span><span style="color:#032F62;">action.</span><span style="color:#24292E;">  </span><span style="color:#032F62;">i</span><span style="color:#24292E;"> </span><span style="color:#032F62;">am</span><span style="color:#24292E;"> </span><span style="color:#032F62;">a</span><span style="color:#24292E;"> </span><span style="color:#032F62;">secondary</span><span style="color:#24292E;"> </span><span style="color:#032F62;">and</span><span style="color:#24292E;"> </span><span style="color:#032F62;">i</span><span style="color:#24292E;"> </span><span style="color:#032F62;">am</span><span style="color:#24292E;"> </span><span style="color:#032F62;">following</span><span style="color:#24292E;"> </span><span style="color:#032F62;">a</span><span style="color:#24292E;"> </span><span style="color:#032F62;">leader</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#模拟patroni出现问题</span></span>
<span class="line"><span style="color:#6A737D;">#停止PG主机所在节点的patroni服务</span></span>
<span class="line"><span style="color:#24292E;">[root@pg_node1 </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# patronictl -c /etc/patroni/patroni.yml list</span></span>
<span class="line"><span style="color:#6F42C1;">+</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Cluster:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">twpg</span><span style="color:#24292E;"> (6976142033405049133) ---+---------+----+-----------+</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Member</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Host</span><span style="color:#24292E;">                </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Role</span><span style="color:#24292E;">    </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">State</span><span style="color:#24292E;">   </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">TL</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Lag</span><span style="color:#24292E;"> </span><span style="color:#032F62;">in</span><span style="color:#24292E;"> </span><span style="color:#032F62;">MB</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#6F42C1;">+--------+---------------------+---------+---------+----+-----------+</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">pg1</span><span style="color:#24292E;">    </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">192.168.210.15:5432</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Leader</span><span style="color:#24292E;">  </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">running</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">  </span><span style="color:#6F42C1;">6</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">           </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">pg2</span><span style="color:#24292E;">    </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">192.168.210.81:5432</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Replica</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">running</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">  </span><span style="color:#6F42C1;">6</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">       </span><span style="color:#6F42C1;">0.0</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">pg3</span><span style="color:#24292E;">    </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">192.168.210.33:5432</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Replica</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">running</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">  </span><span style="color:#6F42C1;">6</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">       </span><span style="color:#6F42C1;">0.0</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#6F42C1;">+--------+---------------------+---------+---------+----+-----------+</span></span>
<span class="line"><span style="color:#24292E;">[root@pg_node1 </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# ip -o -4 a</span></span>
<span class="line"><span style="color:#6F42C1;">1:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">lo</span><span style="color:#24292E;">    </span><span style="color:#032F62;">inet</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">127.0</span><span style="color:#032F62;">.0.1/8</span><span style="color:#24292E;"> </span><span style="color:#032F62;">scope</span><span style="color:#24292E;"> </span><span style="color:#032F62;">host</span><span style="color:#24292E;"> </span><span style="color:#032F62;">lo</span><span style="color:#005CC5;">\\ </span><span style="color:#24292E;">      </span><span style="color:#032F62;">valid_lft</span><span style="color:#24292E;"> </span><span style="color:#032F62;">forever</span><span style="color:#24292E;"> </span><span style="color:#032F62;">preferred_lft</span><span style="color:#24292E;"> </span><span style="color:#032F62;">forever</span></span>
<span class="line"><span style="color:#6F42C1;">2:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">eth0</span><span style="color:#24292E;">    </span><span style="color:#032F62;">inet</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">192.168</span><span style="color:#032F62;">.210.15/24</span><span style="color:#24292E;"> </span><span style="color:#032F62;">brd</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">192.168</span><span style="color:#032F62;">.210.255</span><span style="color:#24292E;"> </span><span style="color:#032F62;">scope</span><span style="color:#24292E;"> </span><span style="color:#032F62;">global</span><span style="color:#24292E;"> </span><span style="color:#032F62;">noprefixroute</span><span style="color:#24292E;"> </span><span style="color:#032F62;">dynamic</span><span style="color:#24292E;"> </span><span style="color:#032F62;">eth0</span><span style="color:#005CC5;">\\ </span><span style="color:#24292E;">      </span><span style="color:#032F62;">valid_lft</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">63429</span><span style="color:#032F62;">sec</span><span style="color:#24292E;"> </span><span style="color:#032F62;">preferred_lft</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">63429</span><span style="color:#032F62;">sec</span></span>
<span class="line"><span style="color:#6F42C1;">2:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">eth0</span><span style="color:#24292E;">    </span><span style="color:#032F62;">inet</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">192.168</span><span style="color:#032F62;">.210.66/24</span><span style="color:#24292E;"> </span><span style="color:#032F62;">scope</span><span style="color:#24292E;"> </span><span style="color:#032F62;">global</span><span style="color:#24292E;"> </span><span style="color:#032F62;">secondary</span><span style="color:#24292E;"> </span><span style="color:#032F62;">eth0</span><span style="color:#005CC5;">\\ </span><span style="color:#24292E;">      </span><span style="color:#032F62;">valid_lft</span><span style="color:#24292E;"> </span><span style="color:#032F62;">forever</span><span style="color:#24292E;"> </span><span style="color:#032F62;">preferred_lft</span><span style="color:#24292E;"> </span><span style="color:#032F62;">forever</span></span>
<span class="line"><span style="color:#24292E;">[root@pg_node1 </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# systemctl stop patroni</span></span>
<span class="line"><span style="color:#24292E;">[root@pg_node1 </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# ip -o -4 a</span></span>
<span class="line"><span style="color:#6F42C1;">1:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">lo</span><span style="color:#24292E;">    </span><span style="color:#032F62;">inet</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">127.0</span><span style="color:#032F62;">.0.1/8</span><span style="color:#24292E;"> </span><span style="color:#032F62;">scope</span><span style="color:#24292E;"> </span><span style="color:#032F62;">host</span><span style="color:#24292E;"> </span><span style="color:#032F62;">lo</span><span style="color:#005CC5;">\\ </span><span style="color:#24292E;">      </span><span style="color:#032F62;">valid_lft</span><span style="color:#24292E;"> </span><span style="color:#032F62;">forever</span><span style="color:#24292E;"> </span><span style="color:#032F62;">preferred_lft</span><span style="color:#24292E;"> </span><span style="color:#032F62;">forever</span></span>
<span class="line"><span style="color:#6F42C1;">2:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">eth0</span><span style="color:#24292E;">    </span><span style="color:#032F62;">inet</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">192.168</span><span style="color:#032F62;">.210.15/24</span><span style="color:#24292E;"> </span><span style="color:#032F62;">brd</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">192.168</span><span style="color:#032F62;">.210.255</span><span style="color:#24292E;"> </span><span style="color:#032F62;">scope</span><span style="color:#24292E;"> </span><span style="color:#032F62;">global</span><span style="color:#24292E;"> </span><span style="color:#032F62;">noprefixroute</span><span style="color:#24292E;"> </span><span style="color:#032F62;">dynamic</span><span style="color:#24292E;"> </span><span style="color:#032F62;">eth0</span><span style="color:#005CC5;">\\ </span><span style="color:#24292E;">      </span><span style="color:#032F62;">valid_lft</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">63357</span><span style="color:#032F62;">sec</span><span style="color:#24292E;"> </span><span style="color:#032F62;">preferred_lft</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">63357</span><span style="color:#032F62;">sec</span></span>
<span class="line"><span style="color:#24292E;">[root@pg_node2 </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# patronictl -c /etc/patroni/patroni.yml list</span></span>
<span class="line"><span style="color:#6F42C1;">+</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Cluster:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">twpg</span><span style="color:#24292E;"> (6976142033405049133) ---+---------+----+-----------+</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Member</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Host</span><span style="color:#24292E;">                </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Role</span><span style="color:#24292E;">    </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">State</span><span style="color:#24292E;">   </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">TL</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Lag</span><span style="color:#24292E;"> </span><span style="color:#032F62;">in</span><span style="color:#24292E;"> </span><span style="color:#032F62;">MB</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#6F42C1;">+--------+---------------------+---------+---------+----+-----------+</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">pg1</span><span style="color:#24292E;">    </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">192.168.210.15:5432</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Leader</span><span style="color:#24292E;">  </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">running</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">  </span><span style="color:#6F42C1;">6</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">           </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">pg2</span><span style="color:#24292E;">    </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">192.168.210.81:5432</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Replica</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">running</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">  </span><span style="color:#6F42C1;">6</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">       </span><span style="color:#6F42C1;">0.0</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">pg3</span><span style="color:#24292E;">    </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">192.168.210.33:5432</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Replica</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">running</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">  </span><span style="color:#6F42C1;">6</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">       </span><span style="color:#6F42C1;">0.0</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#6F42C1;">+--------+---------------------+---------+---------+----+-----------+</span></span>
<span class="line"><span style="color:#24292E;">[root@pg_node2 </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# patronictl -c /etc/patroni/patroni.yml list</span></span>
<span class="line"><span style="color:#6F42C1;">+</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Cluster:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">twpg</span><span style="color:#24292E;"> (6976142033405049133) ---+---------+----+-----------+</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Member</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Host</span><span style="color:#24292E;">                </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Role</span><span style="color:#24292E;">    </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">State</span><span style="color:#24292E;">   </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">TL</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Lag</span><span style="color:#24292E;"> </span><span style="color:#032F62;">in</span><span style="color:#24292E;"> </span><span style="color:#032F62;">MB</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#6F42C1;">+--------+---------------------+---------+---------+----+-----------+</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">pg1</span><span style="color:#24292E;">    </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">192.168.210.15:5432</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Replica</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">stopped</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">    </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">   </span><span style="color:#6F42C1;">unknown</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">pg2</span><span style="color:#24292E;">    </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">192.168.210.81:5432</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Replica</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">running</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">  </span><span style="color:#6F42C1;">7</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">       </span><span style="color:#6F42C1;">0.0</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">pg3</span><span style="color:#24292E;">    </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">192.168.210.33:5432</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Leader</span><span style="color:#24292E;">  </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">running</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">  </span><span style="color:#6F42C1;">7</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">           </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#6F42C1;">+--------+---------------------+---------+---------+----+-----------+</span></span>
<span class="line"><span style="color:#24292E;">[root@pg_node2 </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# patronictl -c /etc/patroni/patroni.yml list</span></span>
<span class="line"><span style="color:#6F42C1;">+</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Cluster:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">twpg</span><span style="color:#24292E;"> (6976142033405049133) ---+---------+----+-----------+</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Member</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Host</span><span style="color:#24292E;">                </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Role</span><span style="color:#24292E;">    </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">State</span><span style="color:#24292E;">   </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">TL</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Lag</span><span style="color:#24292E;"> </span><span style="color:#032F62;">in</span><span style="color:#24292E;"> </span><span style="color:#032F62;">MB</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#6F42C1;">+--------+---------------------+---------+---------+----+-----------+</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">pg2</span><span style="color:#24292E;">    </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">192.168.210.81:5432</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Replica</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">running</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">  </span><span style="color:#6F42C1;">7</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">       </span><span style="color:#6F42C1;">0.0</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">pg3</span><span style="color:#24292E;">    </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">192.168.210.33:5432</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Leader</span><span style="color:#24292E;">  </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">running</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">  </span><span style="color:#6F42C1;">7</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">           </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#6F42C1;">+--------+---------------------+---------+---------+----+-----------+</span></span>
<span class="line"><span style="color:#24292E;">[root@pg_node3 </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# patronictl -c /etc/patroni/patroni.yml list</span></span>
<span class="line"><span style="color:#6F42C1;">+</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Cluster:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">twpg</span><span style="color:#24292E;"> (6976142033405049133) ---+---------+----+-----------+</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Member</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Host</span><span style="color:#24292E;">                </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Role</span><span style="color:#24292E;">    </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">State</span><span style="color:#24292E;">   </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">TL</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Lag</span><span style="color:#24292E;"> </span><span style="color:#032F62;">in</span><span style="color:#24292E;"> </span><span style="color:#032F62;">MB</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#6F42C1;">+--------+---------------------+---------+---------+----+-----------+</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">pg1</span><span style="color:#24292E;">    </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">192.168.210.15:5432</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Leader</span><span style="color:#24292E;">  </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">running</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">  </span><span style="color:#6F42C1;">6</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">           </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">pg2</span><span style="color:#24292E;">    </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">192.168.210.81:5432</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Replica</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">running</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">  </span><span style="color:#6F42C1;">6</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">       </span><span style="color:#6F42C1;">0.0</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">pg3</span><span style="color:#24292E;">    </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">192.168.210.33:5432</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Replica</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">running</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">  </span><span style="color:#6F42C1;">6</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">       </span><span style="color:#6F42C1;">0.0</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#6F42C1;">+--------+---------------------+---------+---------+----+-----------+</span></span>
<span class="line"><span style="color:#24292E;">[root@pg_node3 </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# patronictl -c /etc/patroni/patroni.yml list</span></span>
<span class="line"><span style="color:#6F42C1;">+</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Cluster:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">twpg</span><span style="color:#24292E;"> (6976142033405049133) ---+---------+----+-----------+</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Member</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Host</span><span style="color:#24292E;">                </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Role</span><span style="color:#24292E;">    </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">State</span><span style="color:#24292E;">   </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">TL</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Lag</span><span style="color:#24292E;"> </span><span style="color:#032F62;">in</span><span style="color:#24292E;"> </span><span style="color:#032F62;">MB</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#6F42C1;">+--------+---------------------+---------+---------+----+-----------+</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">pg2</span><span style="color:#24292E;">    </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">192.168.210.81:5432</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Replica</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">running</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">  </span><span style="color:#6F42C1;">7</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">       </span><span style="color:#6F42C1;">0.0</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">pg3</span><span style="color:#24292E;">    </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">192.168.210.33:5432</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Leader</span><span style="color:#24292E;">  </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">running</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">  </span><span style="color:#6F42C1;">7</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">           </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#6F42C1;">+--------+---------------------+---------+---------+----+-----------+</span></span>
<span class="line"><span style="color:#24292E;">[root@pg_node3 </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# ip -o -4 a</span></span>
<span class="line"><span style="color:#6F42C1;">1:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">lo</span><span style="color:#24292E;">    </span><span style="color:#032F62;">inet</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">127.0</span><span style="color:#032F62;">.0.1/8</span><span style="color:#24292E;"> </span><span style="color:#032F62;">scope</span><span style="color:#24292E;"> </span><span style="color:#032F62;">host</span><span style="color:#24292E;"> </span><span style="color:#032F62;">lo</span><span style="color:#005CC5;">\\ </span><span style="color:#24292E;">      </span><span style="color:#032F62;">valid_lft</span><span style="color:#24292E;"> </span><span style="color:#032F62;">forever</span><span style="color:#24292E;"> </span><span style="color:#032F62;">preferred_lft</span><span style="color:#24292E;"> </span><span style="color:#032F62;">forever</span></span>
<span class="line"><span style="color:#6F42C1;">2:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">eth0</span><span style="color:#24292E;">    </span><span style="color:#032F62;">inet</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">192.168</span><span style="color:#032F62;">.210.33/24</span><span style="color:#24292E;"> </span><span style="color:#032F62;">brd</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">192.168</span><span style="color:#032F62;">.210.255</span><span style="color:#24292E;"> </span><span style="color:#032F62;">scope</span><span style="color:#24292E;"> </span><span style="color:#032F62;">global</span><span style="color:#24292E;"> </span><span style="color:#032F62;">noprefixroute</span><span style="color:#24292E;"> </span><span style="color:#032F62;">dynamic</span><span style="color:#24292E;"> </span><span style="color:#032F62;">eth0</span><span style="color:#005CC5;">\\ </span><span style="color:#24292E;">      </span><span style="color:#032F62;">valid_lft</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">69980</span><span style="color:#032F62;">sec</span><span style="color:#24292E;"> </span><span style="color:#032F62;">preferred_lft</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">69980</span><span style="color:#032F62;">sec</span></span>
<span class="line"><span style="color:#6F42C1;">2:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">eth0</span><span style="color:#24292E;">    </span><span style="color:#032F62;">inet</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">192.168</span><span style="color:#032F62;">.210.66/24</span><span style="color:#24292E;"> </span><span style="color:#032F62;">scope</span><span style="color:#24292E;"> </span><span style="color:#032F62;">global</span><span style="color:#24292E;"> </span><span style="color:#032F62;">secondary</span><span style="color:#24292E;"> </span><span style="color:#032F62;">eth0</span><span style="color:#005CC5;">\\ </span><span style="color:#24292E;">      </span><span style="color:#032F62;">valid_lft</span><span style="color:#24292E;"> </span><span style="color:#032F62;">forever</span><span style="color:#24292E;"> </span><span style="color:#032F62;">preferred_lft</span><span style="color:#24292E;"> </span><span style="color:#032F62;">forever</span></span>
<span class="line"><span style="color:#6A737D;">#节点3日志信息，数据库提升为主库</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:59:07</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node3</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2021</span><span style="color:#032F62;">-06-23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:59:07,841</span><span style="color:#24292E;"> </span><span style="color:#032F62;">INFO:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Lock</span><span style="color:#24292E;"> </span><span style="color:#032F62;">owner:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg1</span><span style="color:#24292E;">; </span><span style="color:#6F42C1;">I</span><span style="color:#24292E;"> </span><span style="color:#032F62;">am</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg3</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:59:07</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node3</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2021</span><span style="color:#032F62;">-06-23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:59:07,841</span><span style="color:#24292E;"> </span><span style="color:#032F62;">INFO:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">does</span><span style="color:#24292E;"> </span><span style="color:#032F62;">not</span><span style="color:#24292E;"> </span><span style="color:#032F62;">have</span><span style="color:#24292E;"> </span><span style="color:#032F62;">lock</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:59:07</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node3</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2021</span><span style="color:#032F62;">-06-23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:59:07,849</span><span style="color:#24292E;"> </span><span style="color:#032F62;">INFO:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">no</span><span style="color:#24292E;"> </span><span style="color:#032F62;">action.</span><span style="color:#24292E;">  </span><span style="color:#032F62;">i</span><span style="color:#24292E;"> </span><span style="color:#032F62;">am</span><span style="color:#24292E;"> </span><span style="color:#032F62;">a</span><span style="color:#24292E;"> </span><span style="color:#032F62;">secondary</span><span style="color:#24292E;"> </span><span style="color:#032F62;">and</span><span style="color:#24292E;"> </span><span style="color:#032F62;">i</span><span style="color:#24292E;"> </span><span style="color:#032F62;">am</span><span style="color:#24292E;"> </span><span style="color:#032F62;">following</span><span style="color:#24292E;"> </span><span style="color:#032F62;">a</span><span style="color:#24292E;"> </span><span style="color:#032F62;">leader</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:59:12</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node3</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2021</span><span style="color:#032F62;">-06-23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:59:12.171</span><span style="color:#24292E;"> </span><span style="color:#032F62;">CST</span><span style="color:#24292E;"> [25279] LOG:  replication terminated by primary server</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:59:12</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node3</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2021</span><span style="color:#032F62;">-06-23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:59:12.171</span><span style="color:#24292E;"> </span><span style="color:#032F62;">CST</span><span style="color:#24292E;"> [25279] DETAIL:  End of WAL reached on timeline 6 at 0/50007C8.</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:59:12</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node3</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2021</span><span style="color:#032F62;">-06-23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:59:12.171</span><span style="color:#24292E;"> </span><span style="color:#032F62;">CST</span><span style="color:#24292E;"> [25279] FATAL:  could not send end-of-streaming message to primary: no COPY </span><span style="color:#D73A49;">in</span><span style="color:#24292E;"> progress</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:59:12</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node3</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2021</span><span style="color:#032F62;">-06-23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:59:12.172</span><span style="color:#24292E;"> </span><span style="color:#032F62;">CST</span><span style="color:#24292E;"> [32443] LOG:  invalid record length at 0/50007C8: wanted 24, got 0</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:59:12</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node3</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2021</span><span style="color:#032F62;">-06-23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:59:12.179</span><span style="color:#24292E;"> </span><span style="color:#032F62;">CST</span><span style="color:#24292E;"> [26335] FATAL:  could not connect to the primary server: could not connect to server: Connection refused</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:59:12</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node3</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Is</span><span style="color:#24292E;"> </span><span style="color:#032F62;">the</span><span style="color:#24292E;"> </span><span style="color:#032F62;">server</span><span style="color:#24292E;"> </span><span style="color:#032F62;">running</span><span style="color:#24292E;"> </span><span style="color:#032F62;">on</span><span style="color:#24292E;"> </span><span style="color:#032F62;">host</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;192.168.210.15&quot;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">and</span><span style="color:#24292E;"> </span><span style="color:#032F62;">accepting</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:59:12</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node3</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">TCP/IP</span><span style="color:#24292E;"> </span><span style="color:#032F62;">connections</span><span style="color:#24292E;"> </span><span style="color:#032F62;">on</span><span style="color:#24292E;"> </span><span style="color:#032F62;">port</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5432</span><span style="color:#032F62;">?</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:59:13</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node3</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2021</span><span style="color:#032F62;">-06-23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:59:13,151</span><span style="color:#24292E;"> </span><span style="color:#032F62;">WARNING:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Request</span><span style="color:#24292E;"> </span><span style="color:#032F62;">failed</span><span style="color:#24292E;"> </span><span style="color:#032F62;">to</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg1:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">GET</span><span style="color:#24292E;"> </span><span style="color:#032F62;">http://192.168.210.15:8008/patroni</span><span style="color:#24292E;"> (HTTPConnectionPool(host=u</span><span style="color:#032F62;">&#39;192.168.210.15&#39;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">port=</span><span style="color:#005CC5;">8008</span><span style="color:#24292E;">): Max retries exceeded with url: /patroni (</span><span style="color:#6F42C1;">Caused</span><span style="color:#24292E;"> </span><span style="color:#032F62;">by</span><span style="color:#24292E;"> </span><span style="color:#032F62;">ProtocolError</span><span style="color:#24292E;">(</span><span style="color:#6F42C1;">&#39;Connection aborted.&#39;</span><span style="color:#6F42C1;">,</span><span style="color:#24292E;"> </span><span style="color:#032F62;">error</span><span style="color:#24292E;">(</span><span style="color:#6F42C1;">104,</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;Connection reset by peer&#39;</span><span style="color:#24292E;">))))</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:59:13</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node3</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2021</span><span style="color:#032F62;">-06-23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:59:13,153</span><span style="color:#24292E;"> </span><span style="color:#032F62;">INFO:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Got</span><span style="color:#24292E;"> </span><span style="color:#032F62;">response</span><span style="color:#24292E;"> </span><span style="color:#032F62;">from</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg2</span><span style="color:#24292E;"> </span><span style="color:#032F62;">http://192.168.210.81:8008/patroni:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">{&quot;database_system_identifier&quot;:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;6976142033405049133&quot;,</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;postmaster_start_time&quot;:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;2021-06-23 09:51:39.194 CST&quot;,</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;timeline&quot;:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">6</span><span style="color:#032F62;">,</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;cluster_unlocked&quot;:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">false</span><span style="color:#032F62;">,</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;patroni&quot;:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">{&quot;scope&quot;:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;twpg&quot;,</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;version&quot;:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;2.0.2&quot;},</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;state&quot;:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;running&quot;,</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;role&quot;:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;replica&quot;,</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;xlog&quot;:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">{&quot;received_location&quot;:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">83888072</span><span style="color:#032F62;">,</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;replayed_timestamp&quot;:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">null,</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;paused&quot;:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">false</span><span style="color:#032F62;">,</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;replayed_location&quot;:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">83888072</span><span style="color:#032F62;">},</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;server_version&quot;:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">130003</span><span style="color:#032F62;">}</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:59:13</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node3</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2021</span><span style="color:#032F62;">-06-23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:59:13,247</span><span style="color:#24292E;"> </span><span style="color:#032F62;">INFO:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Software</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Watchdog</span><span style="color:#24292E;"> </span><span style="color:#032F62;">activated</span><span style="color:#24292E;"> </span><span style="color:#032F62;">with</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">25</span><span style="color:#24292E;"> </span><span style="color:#032F62;">second</span><span style="color:#24292E;"> </span><span style="color:#032F62;">timeout,</span><span style="color:#24292E;"> </span><span style="color:#032F62;">timing</span><span style="color:#24292E;"> </span><span style="color:#032F62;">slack</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">15</span><span style="color:#24292E;"> </span><span style="color:#032F62;">seconds</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:59:13</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node3</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2021</span><span style="color:#032F62;">-06-23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:59:13,264</span><span style="color:#24292E;"> </span><span style="color:#032F62;">INFO:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">promoted</span><span style="color:#24292E;"> </span><span style="color:#032F62;">self</span><span style="color:#24292E;"> </span><span style="color:#032F62;">to</span><span style="color:#24292E;"> </span><span style="color:#032F62;">leader</span><span style="color:#24292E;"> </span><span style="color:#032F62;">by</span><span style="color:#24292E;"> </span><span style="color:#032F62;">acquiring</span><span style="color:#24292E;"> </span><span style="color:#032F62;">session</span><span style="color:#24292E;"> </span><span style="color:#032F62;">lock</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:59:13</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node3</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">server</span><span style="color:#24292E;"> </span><span style="color:#032F62;">promoting</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:59:13</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node3</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2021</span><span style="color:#032F62;">-06-23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:59:13,273</span><span style="color:#24292E;"> </span><span style="color:#032F62;">INFO:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Lock</span><span style="color:#24292E;"> </span><span style="color:#032F62;">owner:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg3</span><span style="color:#24292E;">; </span><span style="color:#6F42C1;">I</span><span style="color:#24292E;"> </span><span style="color:#032F62;">am</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg3</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:59:13</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node3</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2021</span><span style="color:#032F62;">-06-23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:59:13.276</span><span style="color:#24292E;"> </span><span style="color:#032F62;">CST</span><span style="color:#24292E;"> [32443] LOG:  received promote request</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:59:13</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node3</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2021</span><span style="color:#032F62;">-06-23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:59:13.276</span><span style="color:#24292E;"> </span><span style="color:#032F62;">CST</span><span style="color:#24292E;"> [32443] LOG:  redo </span><span style="color:#D73A49;">done</span><span style="color:#24292E;"> at 0/5000750</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:59:13</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node3</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2021</span><span style="color:#032F62;">-06-23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:59:13,277</span><span style="color:#24292E;"> </span><span style="color:#032F62;">INFO:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">cleared</span><span style="color:#24292E;"> </span><span style="color:#032F62;">rewind</span><span style="color:#24292E;"> </span><span style="color:#032F62;">state</span><span style="color:#24292E;"> </span><span style="color:#032F62;">after</span><span style="color:#24292E;"> </span><span style="color:#032F62;">becoming</span><span style="color:#24292E;"> </span><span style="color:#032F62;">the</span><span style="color:#24292E;"> </span><span style="color:#032F62;">leader</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:59:13</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node3</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2021</span><span style="color:#032F62;">-06-23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:59:13.289</span><span style="color:#24292E;"> </span><span style="color:#032F62;">CST</span><span style="color:#24292E;"> [32443] LOG:  selected new timeline ID: 7</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:59:13</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node3</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">this</span><span style="color:#24292E;"> </span><span style="color:#032F62;">is</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni</span><span style="color:#24292E;"> </span><span style="color:#032F62;">callback</span><span style="color:#24292E;"> </span><span style="color:#032F62;">on_role_change</span><span style="color:#24292E;"> </span><span style="color:#032F62;">master</span><span style="color:#24292E;"> </span><span style="color:#032F62;">twpg</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:59:13</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node3</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2021</span><span style="color:#032F62;">-06-23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:59:13,298</span><span style="color:#24292E;"> </span><span style="color:#032F62;">INFO:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">updated</span><span style="color:#24292E;"> </span><span style="color:#032F62;">leader</span><span style="color:#24292E;"> </span><span style="color:#032F62;">lock</span><span style="color:#24292E;"> </span><span style="color:#032F62;">during</span><span style="color:#24292E;"> </span><span style="color:#032F62;">promote</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:59:13</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node3</span><span style="color:#24292E;"> </span><span style="color:#032F62;">systemd:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Started</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Session</span><span style="color:#24292E;"> </span><span style="color:#032F62;">c7</span><span style="color:#24292E;"> </span><span style="color:#032F62;">of</span><span style="color:#24292E;"> </span><span style="color:#032F62;">user</span><span style="color:#24292E;"> </span><span style="color:#032F62;">root.</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:59:13</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node3</span><span style="color:#24292E;"> </span><span style="color:#032F62;">systemd:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Started</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Session</span><span style="color:#24292E;"> </span><span style="color:#032F62;">c8</span><span style="color:#24292E;"> </span><span style="color:#032F62;">of</span><span style="color:#24292E;"> </span><span style="color:#032F62;">user</span><span style="color:#24292E;"> </span><span style="color:#032F62;">root.</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:59:13</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node3</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2021</span><span style="color:#032F62;">-06-23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:59:13.585</span><span style="color:#24292E;"> </span><span style="color:#032F62;">CST</span><span style="color:#24292E;"> [32443] LOG:  archive recovery complete</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:59:13</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node3</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2021</span><span style="color:#032F62;">-06-23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:59:13.650</span><span style="color:#24292E;"> </span><span style="color:#032F62;">CST</span><span style="color:#24292E;"> [32441] LOG:  database system is ready to accept connections</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:59:14</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node3</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2021</span><span style="color:#032F62;">-06-23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:59:14,318</span><span style="color:#24292E;"> </span><span style="color:#032F62;">INFO:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Lock</span><span style="color:#24292E;"> </span><span style="color:#032F62;">owner:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg3</span><span style="color:#24292E;">; </span><span style="color:#6F42C1;">I</span><span style="color:#24292E;"> </span><span style="color:#032F62;">am</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg3</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:59:14</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node3</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2021</span><span style="color:#032F62;">-06-23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:59:14,435</span><span style="color:#24292E;"> </span><span style="color:#032F62;">INFO:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">no</span><span style="color:#24292E;"> </span><span style="color:#032F62;">action.</span><span style="color:#24292E;">  </span><span style="color:#032F62;">i</span><span style="color:#24292E;"> </span><span style="color:#032F62;">am</span><span style="color:#24292E;"> </span><span style="color:#032F62;">the</span><span style="color:#24292E;"> </span><span style="color:#032F62;">leader</span><span style="color:#24292E;"> </span><span style="color:#032F62;">with</span><span style="color:#24292E;"> </span><span style="color:#032F62;">the</span><span style="color:#24292E;"> </span><span style="color:#032F62;">lock</span></span>
<span class="line"><span style="color:#6A737D;">#</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:59:10</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node2</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2021</span><span style="color:#032F62;">-06-23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:59:10,228</span><span style="color:#24292E;"> </span><span style="color:#032F62;">INFO:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Lock</span><span style="color:#24292E;"> </span><span style="color:#032F62;">owner:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg1</span><span style="color:#24292E;">; </span><span style="color:#6F42C1;">I</span><span style="color:#24292E;"> </span><span style="color:#032F62;">am</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg2</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:59:10</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node2</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2021</span><span style="color:#032F62;">-06-23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:59:10,228</span><span style="color:#24292E;"> </span><span style="color:#032F62;">INFO:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">does</span><span style="color:#24292E;"> </span><span style="color:#032F62;">not</span><span style="color:#24292E;"> </span><span style="color:#032F62;">have</span><span style="color:#24292E;"> </span><span style="color:#032F62;">lock</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:59:10</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node2</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2021</span><span style="color:#032F62;">-06-23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:59:10,237</span><span style="color:#24292E;"> </span><span style="color:#032F62;">INFO:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">no</span><span style="color:#24292E;"> </span><span style="color:#032F62;">action.</span><span style="color:#24292E;">  </span><span style="color:#032F62;">i</span><span style="color:#24292E;"> </span><span style="color:#032F62;">am</span><span style="color:#24292E;"> </span><span style="color:#032F62;">a</span><span style="color:#24292E;"> </span><span style="color:#032F62;">secondary</span><span style="color:#24292E;"> </span><span style="color:#032F62;">and</span><span style="color:#24292E;"> </span><span style="color:#032F62;">i</span><span style="color:#24292E;"> </span><span style="color:#032F62;">am</span><span style="color:#24292E;"> </span><span style="color:#032F62;">following</span><span style="color:#24292E;"> </span><span style="color:#032F62;">a</span><span style="color:#24292E;"> </span><span style="color:#032F62;">leader</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:59:12</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node2</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2021</span><span style="color:#032F62;">-06-23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:59:12.170</span><span style="color:#24292E;"> </span><span style="color:#032F62;">CST</span><span style="color:#24292E;"> [26290] LOG:  replication terminated by primary server</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:59:12</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node2</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2021</span><span style="color:#032F62;">-06-23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:59:12.170</span><span style="color:#24292E;"> </span><span style="color:#032F62;">CST</span><span style="color:#24292E;"> [26290] DETAIL:  End of WAL reached on timeline 6 at 0/50007C8.</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:59:12</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node2</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2021</span><span style="color:#032F62;">-06-23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:59:12.170</span><span style="color:#24292E;"> </span><span style="color:#032F62;">CST</span><span style="color:#24292E;"> [26290] FATAL:  could not send end-of-streaming message to primary: no COPY </span><span style="color:#D73A49;">in</span><span style="color:#24292E;"> progress</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:59:12</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node2</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2021</span><span style="color:#032F62;">-06-23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:59:12.170</span><span style="color:#24292E;"> </span><span style="color:#032F62;">CST</span><span style="color:#24292E;"> [26286] LOG:  invalid record length at 0/50007C8: wanted 24, got 0</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:59:12</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node2</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2021</span><span style="color:#032F62;">-06-23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:59:12.177</span><span style="color:#24292E;"> </span><span style="color:#032F62;">CST</span><span style="color:#24292E;"> [26671] FATAL:  could not connect to the primary server: could not connect to server: Connection refused</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:59:12</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node2</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Is</span><span style="color:#24292E;"> </span><span style="color:#032F62;">the</span><span style="color:#24292E;"> </span><span style="color:#032F62;">server</span><span style="color:#24292E;"> </span><span style="color:#032F62;">running</span><span style="color:#24292E;"> </span><span style="color:#032F62;">on</span><span style="color:#24292E;"> </span><span style="color:#032F62;">host</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;192.168.210.15&quot;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">and</span><span style="color:#24292E;"> </span><span style="color:#032F62;">accepting</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:59:12</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node2</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">TCP/IP</span><span style="color:#24292E;"> </span><span style="color:#032F62;">connections</span><span style="color:#24292E;"> </span><span style="color:#032F62;">on</span><span style="color:#24292E;"> </span><span style="color:#032F62;">port</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5432</span><span style="color:#032F62;">?</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:59:13</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node2</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2021</span><span style="color:#032F62;">-06-23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:59:13,174</span><span style="color:#24292E;"> </span><span style="color:#032F62;">WARNING:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Request</span><span style="color:#24292E;"> </span><span style="color:#032F62;">failed</span><span style="color:#24292E;"> </span><span style="color:#032F62;">to</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg1:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">GET</span><span style="color:#24292E;"> </span><span style="color:#032F62;">http://192.168.210.15:8008/patroni</span><span style="color:#24292E;"> (HTTPConnectionPool(host=u</span><span style="color:#032F62;">&#39;192.168.210.15&#39;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">port=</span><span style="color:#005CC5;">8008</span><span style="color:#24292E;">): Max retries exceeded with url: /patroni (</span><span style="color:#6F42C1;">Caused</span><span style="color:#24292E;"> </span><span style="color:#032F62;">by</span><span style="color:#24292E;"> </span><span style="color:#032F62;">NewConnectionError</span><span style="color:#24292E;">(</span><span style="color:#6F42C1;">&#39;&lt;urllib3.connection.HTTPConnection object at 0x7f1b110fb9d0&gt;: Failed to establish a new connection: [Errno 111] Connection refused&#39;</span><span style="color:#6F42C1;">,</span><span style="color:#24292E;">)))</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:59:13</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node2</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2021</span><span style="color:#032F62;">-06-23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:59:13,188</span><span style="color:#24292E;"> </span><span style="color:#032F62;">INFO:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Got</span><span style="color:#24292E;"> </span><span style="color:#032F62;">response</span><span style="color:#24292E;"> </span><span style="color:#032F62;">from</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg3</span><span style="color:#24292E;"> </span><span style="color:#032F62;">http://192.168.210.33:8008/patroni:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">{&quot;database_system_identifier&quot;:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;6976142033405049133&quot;,</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;postmaster_start_time&quot;:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;2021-06-21 15:43:32.837 CST&quot;,</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;timeline&quot;:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">6</span><span style="color:#032F62;">,</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;cluster_unlocked&quot;:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">true</span><span style="color:#032F62;">,</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;patroni&quot;:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">{&quot;scope&quot;:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;twpg&quot;,</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;version&quot;:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;2.0.2&quot;},</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;state&quot;:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;running&quot;,</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;role&quot;:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;replica&quot;,</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;xlog&quot;:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">{&quot;received_location&quot;:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">83888072</span><span style="color:#032F62;">,</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;replayed_timestamp&quot;:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">null,</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;paused&quot;:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">false</span><span style="color:#032F62;">,</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;replayed_location&quot;:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">83888072</span><span style="color:#032F62;">},</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;server_version&quot;:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">130003</span><span style="color:#032F62;">}</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:59:13</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node2</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2021</span><span style="color:#032F62;">-06-23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:59:13,277</span><span style="color:#24292E;"> </span><span style="color:#032F62;">INFO:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Could</span><span style="color:#24292E;"> </span><span style="color:#032F62;">not</span><span style="color:#24292E;"> </span><span style="color:#032F62;">take</span><span style="color:#24292E;"> </span><span style="color:#032F62;">out</span><span style="color:#24292E;"> </span><span style="color:#032F62;">TTL</span><span style="color:#24292E;"> </span><span style="color:#032F62;">lock</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:59:13</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node2</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">server</span><span style="color:#24292E;"> </span><span style="color:#032F62;">signaled</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:59:13</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node2</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2021</span><span style="color:#032F62;">-06-23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:59:13.291</span><span style="color:#24292E;"> </span><span style="color:#032F62;">CST</span><span style="color:#24292E;"> [26284] LOG:  received SIGHUP, reloading configuration files</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:59:13</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node2</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2021</span><span style="color:#032F62;">-06-23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:59:13.292</span><span style="color:#24292E;"> </span><span style="color:#032F62;">CST</span><span style="color:#24292E;"> [26284] LOG:  parameter </span><span style="color:#032F62;">&quot;primary_conninfo&quot;</span><span style="color:#24292E;"> changed to </span><span style="color:#032F62;">&quot;user=repuser passfile=/home/postgres/pgpass host=192.168.210.33 port=5432 sslmode=prefer application_name=pg2 gssencmode=prefer channel_binding=prefer&quot;</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:59:13</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node2</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2021</span><span style="color:#032F62;">-06-23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:59:13.296</span><span style="color:#24292E;"> </span><span style="color:#032F62;">CST</span><span style="color:#24292E;"> [26682] FATAL:  could not connect to the primary server: could not connect to server: Connection refused</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:59:13</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node2</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Is</span><span style="color:#24292E;"> </span><span style="color:#032F62;">the</span><span style="color:#24292E;"> </span><span style="color:#032F62;">server</span><span style="color:#24292E;"> </span><span style="color:#032F62;">running</span><span style="color:#24292E;"> </span><span style="color:#032F62;">on</span><span style="color:#24292E;"> </span><span style="color:#032F62;">host</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;192.168.210.15&quot;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">and</span><span style="color:#24292E;"> </span><span style="color:#032F62;">accepting</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:59:13</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node2</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">TCP/IP</span><span style="color:#24292E;"> </span><span style="color:#032F62;">connections</span><span style="color:#24292E;"> </span><span style="color:#032F62;">on</span><span style="color:#24292E;"> </span><span style="color:#032F62;">port</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5432</span><span style="color:#032F62;">?</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:59:13</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node2</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2021</span><span style="color:#032F62;">-06-23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:59:13,330</span><span style="color:#24292E;"> </span><span style="color:#032F62;">INFO:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">following</span><span style="color:#24292E;"> </span><span style="color:#032F62;">new</span><span style="color:#24292E;"> </span><span style="color:#032F62;">leader</span><span style="color:#24292E;"> </span><span style="color:#032F62;">after</span><span style="color:#24292E;"> </span><span style="color:#032F62;">trying</span><span style="color:#24292E;"> </span><span style="color:#032F62;">and</span><span style="color:#24292E;"> </span><span style="color:#032F62;">failing</span><span style="color:#24292E;"> </span><span style="color:#032F62;">to</span><span style="color:#24292E;"> </span><span style="color:#032F62;">obtain</span><span style="color:#24292E;"> </span><span style="color:#032F62;">lock</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:59:13</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node2</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2021</span><span style="color:#032F62;">-06-23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:59:13,333</span><span style="color:#24292E;"> </span><span style="color:#032F62;">INFO:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Lock</span><span style="color:#24292E;"> </span><span style="color:#032F62;">owner:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg3</span><span style="color:#24292E;">; </span><span style="color:#6F42C1;">I</span><span style="color:#24292E;"> </span><span style="color:#032F62;">am</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg2</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:59:13</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node2</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2021</span><span style="color:#032F62;">-06-23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:59:13,333</span><span style="color:#24292E;"> </span><span style="color:#032F62;">INFO:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">does</span><span style="color:#24292E;"> </span><span style="color:#032F62;">not</span><span style="color:#24292E;"> </span><span style="color:#032F62;">have</span><span style="color:#24292E;"> </span><span style="color:#032F62;">lock</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:59:13</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node2</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2021</span><span style="color:#032F62;">-06-23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:59:13,342</span><span style="color:#24292E;"> </span><span style="color:#032F62;">INFO:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Local</span><span style="color:#24292E;"> </span><span style="color:#032F62;">timeline=</span><span style="color:#005CC5;">6</span><span style="color:#24292E;"> </span><span style="color:#032F62;">lsn=</span><span style="color:#005CC5;">0</span><span style="color:#032F62;">/50007C8</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:59:13</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node2</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2021</span><span style="color:#032F62;">-06-23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:59:13,349</span><span style="color:#24292E;"> </span><span style="color:#032F62;">INFO:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">master_timeline=</span><span style="color:#005CC5;">6</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:59:13</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node2</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2021</span><span style="color:#032F62;">-06-23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:59:13,354</span><span style="color:#24292E;"> </span><span style="color:#032F62;">INFO:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">no</span><span style="color:#24292E;"> </span><span style="color:#032F62;">action.</span><span style="color:#24292E;">  </span><span style="color:#032F62;">i</span><span style="color:#24292E;"> </span><span style="color:#032F62;">am</span><span style="color:#24292E;"> </span><span style="color:#032F62;">a</span><span style="color:#24292E;"> </span><span style="color:#032F62;">secondary</span><span style="color:#24292E;"> </span><span style="color:#032F62;">and</span><span style="color:#24292E;"> </span><span style="color:#032F62;">i</span><span style="color:#24292E;"> </span><span style="color:#032F62;">am</span><span style="color:#24292E;"> </span><span style="color:#032F62;">following</span><span style="color:#24292E;"> </span><span style="color:#032F62;">a</span><span style="color:#24292E;"> </span><span style="color:#032F62;">leader</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:59:14</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node2</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2021</span><span style="color:#032F62;">-06-23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:59:14,373</span><span style="color:#24292E;"> </span><span style="color:#032F62;">INFO:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Lock</span><span style="color:#24292E;"> </span><span style="color:#032F62;">owner:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg3</span><span style="color:#24292E;">; </span><span style="color:#6F42C1;">I</span><span style="color:#24292E;"> </span><span style="color:#032F62;">am</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg2</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:59:14</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node2</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2021</span><span style="color:#032F62;">-06-23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:59:14,373</span><span style="color:#24292E;"> </span><span style="color:#032F62;">INFO:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">does</span><span style="color:#24292E;"> </span><span style="color:#032F62;">not</span><span style="color:#24292E;"> </span><span style="color:#032F62;">have</span><span style="color:#24292E;"> </span><span style="color:#032F62;">lock</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:59:14</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node2</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2021</span><span style="color:#032F62;">-06-23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:59:14,375</span><span style="color:#24292E;"> </span><span style="color:#032F62;">INFO:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">no</span><span style="color:#24292E;"> </span><span style="color:#032F62;">action.</span><span style="color:#24292E;">  </span><span style="color:#032F62;">i</span><span style="color:#24292E;"> </span><span style="color:#032F62;">am</span><span style="color:#24292E;"> </span><span style="color:#032F62;">a</span><span style="color:#24292E;"> </span><span style="color:#032F62;">secondary</span><span style="color:#24292E;"> </span><span style="color:#032F62;">and</span><span style="color:#24292E;"> </span><span style="color:#032F62;">i</span><span style="color:#24292E;"> </span><span style="color:#032F62;">am</span><span style="color:#24292E;"> </span><span style="color:#032F62;">following</span><span style="color:#24292E;"> </span><span style="color:#032F62;">a</span><span style="color:#24292E;"> </span><span style="color:#032F62;">leader</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:59:14</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node2</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2021</span><span style="color:#032F62;">-06-23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:59:14,491</span><span style="color:#24292E;"> </span><span style="color:#032F62;">INFO:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Lock</span><span style="color:#24292E;"> </span><span style="color:#032F62;">owner:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg3</span><span style="color:#24292E;">; </span><span style="color:#6F42C1;">I</span><span style="color:#24292E;"> </span><span style="color:#032F62;">am</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg2</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:59:14</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node2</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2021</span><span style="color:#032F62;">-06-23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:59:14,492</span><span style="color:#24292E;"> </span><span style="color:#032F62;">INFO:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">does</span><span style="color:#24292E;"> </span><span style="color:#032F62;">not</span><span style="color:#24292E;"> </span><span style="color:#032F62;">have</span><span style="color:#24292E;"> </span><span style="color:#032F62;">lock</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:59:14</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node2</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2021</span><span style="color:#032F62;">-06-23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:59:14,500</span><span style="color:#24292E;"> </span><span style="color:#032F62;">INFO:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">no</span><span style="color:#24292E;"> </span><span style="color:#032F62;">action.</span><span style="color:#24292E;">  </span><span style="color:#032F62;">i</span><span style="color:#24292E;"> </span><span style="color:#032F62;">am</span><span style="color:#24292E;"> </span><span style="color:#032F62;">a</span><span style="color:#24292E;"> </span><span style="color:#032F62;">secondary</span><span style="color:#24292E;"> </span><span style="color:#032F62;">and</span><span style="color:#24292E;"> </span><span style="color:#032F62;">i</span><span style="color:#24292E;"> </span><span style="color:#032F62;">am</span><span style="color:#24292E;"> </span><span style="color:#032F62;">following</span><span style="color:#24292E;"> </span><span style="color:#032F62;">a</span><span style="color:#24292E;"> </span><span style="color:#032F62;">leader</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:59:18</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node2</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2021</span><span style="color:#032F62;">-06-23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:59:18.306</span><span style="color:#24292E;"> </span><span style="color:#032F62;">CST</span><span style="color:#24292E;"> [26690] LOG:  fetching timeline history file </span><span style="color:#D73A49;">for</span><span style="color:#24292E;"> timeline 7 from primary server</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:59:18</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node2</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2021</span><span style="color:#032F62;">-06-23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:59:18.320</span><span style="color:#24292E;"> </span><span style="color:#032F62;">CST</span><span style="color:#24292E;"> [26690] LOG:  started streaming WAL from primary at 0/5000000 on timeline 6</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:59:18</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node2</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2021</span><span style="color:#032F62;">-06-23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:59:18.320</span><span style="color:#24292E;"> </span><span style="color:#032F62;">CST</span><span style="color:#24292E;"> [26690] LOG:  replication terminated by primary server</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:59:18</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node2</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2021</span><span style="color:#032F62;">-06-23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:59:18.320</span><span style="color:#24292E;"> </span><span style="color:#032F62;">CST</span><span style="color:#24292E;"> [26690] DETAIL:  End of WAL reached on timeline 6 at 0/50007C8.</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:59:18</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node2</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2021</span><span style="color:#032F62;">-06-23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:59:18.321</span><span style="color:#24292E;"> </span><span style="color:#032F62;">CST</span><span style="color:#24292E;"> [26286] LOG:  new target timeline is 7</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:59:18</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node2</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2021</span><span style="color:#032F62;">-06-23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:59:18.322</span><span style="color:#24292E;"> </span><span style="color:#032F62;">CST</span><span style="color:#24292E;"> [26690] LOG:  restarted WAL streaming at 0/5000000 on timeline 7</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:59:24</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node2</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2021</span><span style="color:#032F62;">-06-23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:59:24,492</span><span style="color:#24292E;"> </span><span style="color:#032F62;">INFO:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Lock</span><span style="color:#24292E;"> </span><span style="color:#032F62;">owner:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg3</span><span style="color:#24292E;">; </span><span style="color:#6F42C1;">I</span><span style="color:#24292E;"> </span><span style="color:#032F62;">am</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg2</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:59:24</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node2</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2021</span><span style="color:#032F62;">-06-23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:59:24,492</span><span style="color:#24292E;"> </span><span style="color:#032F62;">INFO:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">does</span><span style="color:#24292E;"> </span><span style="color:#032F62;">not</span><span style="color:#24292E;"> </span><span style="color:#032F62;">have</span><span style="color:#24292E;"> </span><span style="color:#032F62;">lock</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:59:24</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node2</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2021</span><span style="color:#032F62;">-06-23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#032F62;">:59:24,513</span><span style="color:#24292E;"> </span><span style="color:#032F62;">INFO:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">no</span><span style="color:#24292E;"> </span><span style="color:#032F62;">action.</span><span style="color:#24292E;">  </span><span style="color:#032F62;">i</span><span style="color:#24292E;"> </span><span style="color:#032F62;">am</span><span style="color:#24292E;"> </span><span style="color:#032F62;">a</span><span style="color:#24292E;"> </span><span style="color:#032F62;">secondary</span><span style="color:#24292E;"> </span><span style="color:#032F62;">and</span><span style="color:#24292E;"> </span><span style="color:#032F62;">i</span><span style="color:#24292E;"> </span><span style="color:#032F62;">am</span><span style="color:#24292E;"> </span><span style="color:#032F62;">following</span><span style="color:#24292E;"> </span><span style="color:#032F62;">a</span><span style="color:#24292E;"> </span><span style="color:#032F62;">leader</span></span>
<span class="line"><span style="color:#6A737D;">#从以上信息可以看到，当主库所在的patroni服务不可用时，会发生故障转移（pg3选举为了主库，VIP进行漂移）</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#模拟主库所在的patroni进程无响应</span></span>
<span class="line"><span style="color:#6A737D;">#kill掉patroni进程，会导致服务器reboot</span></span>
<span class="line"><span style="color:#24292E;">[root@pg_node2 </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# patronictl -c /etc/patroni/patroni.yml list</span></span>
<span class="line"><span style="color:#6F42C1;">+</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Cluster:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">twpg</span><span style="color:#24292E;"> (6976142033405049133) ---+---------+----+-----------+</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Member</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Host</span><span style="color:#24292E;">                </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Role</span><span style="color:#24292E;">    </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">State</span><span style="color:#24292E;">   </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">TL</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Lag</span><span style="color:#24292E;"> </span><span style="color:#032F62;">in</span><span style="color:#24292E;"> </span><span style="color:#032F62;">MB</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#6F42C1;">+--------+---------------------+---------+---------+----+-----------+</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">pg1</span><span style="color:#24292E;">    </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">192.168.210.15:5432</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Replica</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">running</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">10</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">       </span><span style="color:#6F42C1;">0.0</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">pg2</span><span style="color:#24292E;">    </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">192.168.210.81:5432</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Leader</span><span style="color:#24292E;">  </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">running</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">10</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">           </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">pg3</span><span style="color:#24292E;">    </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">192.168.210.33:5432</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Replica</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">running</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">10</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">       </span><span style="color:#6F42C1;">0.0</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#6F42C1;">+--------+---------------------+---------+---------+----+-----------+</span></span>
<span class="line"><span style="color:#005CC5;">kill</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-9</span><span style="color:#24292E;"> </span><span style="color:#032F62;">\`</span><span style="color:#6F42C1;">pgrep</span><span style="color:#032F62;"> patroni\`</span></span>
<span class="line"><span style="color:#24292E;">[root@pg_node2 </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# uptime</span></span>
<span class="line"><span style="color:#24292E;"> </span><span style="color:#6F42C1;">14:26:01</span><span style="color:#24292E;"> </span><span style="color:#032F62;">up</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">min,</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">user,</span><span style="color:#24292E;">  </span><span style="color:#032F62;">load</span><span style="color:#24292E;"> </span><span style="color:#032F62;">average:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1.35</span><span style="color:#032F62;">,</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0.41</span><span style="color:#032F62;">,</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0.14</span></span>
<span class="line"><span style="color:#24292E;">[root@pg_node2 </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# patronictl -c /etc/patroni/patroni.yml list</span></span>
<span class="line"><span style="color:#6F42C1;">+</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Cluster:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">twpg</span><span style="color:#24292E;"> (6976142033405049133) ---+---------+----+-----------+</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Member</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Host</span><span style="color:#24292E;">                </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Role</span><span style="color:#24292E;">    </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">State</span><span style="color:#24292E;">   </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">TL</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Lag</span><span style="color:#24292E;"> </span><span style="color:#032F62;">in</span><span style="color:#24292E;"> </span><span style="color:#032F62;">MB</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#6F42C1;">+--------+---------------------+---------+---------+----+-----------+</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">pg1</span><span style="color:#24292E;">    </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">192.168.210.15:5432</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Replica</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">running</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">10</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">       </span><span style="color:#6F42C1;">0.0</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">pg2</span><span style="color:#24292E;">    </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">192.168.210.81:5432</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Replica</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">running</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">10</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">       </span><span style="color:#6F42C1;">0.0</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">pg3</span><span style="color:#24292E;">    </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">192.168.210.33:5432</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Leader</span><span style="color:#24292E;">  </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">running</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">10</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">           </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#6F42C1;">+--------+---------------------+---------+---------+----+-----------+</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#模拟主机不可用（主库所在主机）</span></span>
<span class="line"><span style="color:#6A737D;">#立刻关机：poweroff</span></span>
<span class="line"><span style="color:#24292E;">[root@pg_node3 </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# uptime</span></span>
<span class="line"><span style="color:#24292E;"> </span><span style="color:#6F42C1;">14:38:38</span><span style="color:#24292E;"> </span><span style="color:#032F62;">up</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">4</span><span style="color:#24292E;"> </span><span style="color:#032F62;">days,</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">22</span><span style="color:#032F62;">:08,</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">3</span><span style="color:#24292E;"> </span><span style="color:#032F62;">users,</span><span style="color:#24292E;">  </span><span style="color:#032F62;">load</span><span style="color:#24292E;"> </span><span style="color:#032F62;">average:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0.03</span><span style="color:#032F62;">,</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0.09</span><span style="color:#032F62;">,</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0.07</span></span>
<span class="line"><span style="color:#24292E;">[root@pg_node3 </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# patronictl -c /etc/patroni/patroni.yml list</span></span>
<span class="line"><span style="color:#6F42C1;">+</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Cluster:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">twpg</span><span style="color:#24292E;"> (6976142033405049133) ---+---------+----+-----------+</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Member</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Host</span><span style="color:#24292E;">                </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Role</span><span style="color:#24292E;">    </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">State</span><span style="color:#24292E;">   </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">TL</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Lag</span><span style="color:#24292E;"> </span><span style="color:#032F62;">in</span><span style="color:#24292E;"> </span><span style="color:#032F62;">MB</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#6F42C1;">+--------+---------------------+---------+---------+----+-----------+</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">pg1</span><span style="color:#24292E;">    </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">192.168.210.15:5432</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Replica</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">running</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">10</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">       </span><span style="color:#6F42C1;">0.0</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">pg2</span><span style="color:#24292E;">    </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">192.168.210.81:5432</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Replica</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">running</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">10</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">       </span><span style="color:#6F42C1;">0.0</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">pg3</span><span style="color:#24292E;">    </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">192.168.210.33:5432</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Leader</span><span style="color:#24292E;">  </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">running</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">10</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">           </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#6F42C1;">+--------+---------------------+---------+---------+----+-----------+</span></span>
<span class="line"><span style="color:#24292E;">[root@pg_node3 </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# poweroff</span></span>
<span class="line"><span style="color:#24292E;">[root@pg_node2 </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# patronictl -c /etc/patroni/patroni.yml list</span></span>
<span class="line"><span style="color:#6F42C1;">+</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Cluster:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">twpg</span><span style="color:#24292E;"> (6976142033405049133) ---+---------+----+-----------+</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Member</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Host</span><span style="color:#24292E;">                </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Role</span><span style="color:#24292E;">    </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">State</span><span style="color:#24292E;">   </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">TL</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Lag</span><span style="color:#24292E;"> </span><span style="color:#032F62;">in</span><span style="color:#24292E;"> </span><span style="color:#032F62;">MB</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#6F42C1;">+--------+---------------------+---------+---------+----+-----------+</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">pg1</span><span style="color:#24292E;">    </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">192.168.210.15:5432</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Leader</span><span style="color:#24292E;">  </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">running</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">11</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">           </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">pg2</span><span style="color:#24292E;">    </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">192.168.210.81:5432</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Replica</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">running</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">11</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">       </span><span style="color:#6F42C1;">0.0</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">pg3</span><span style="color:#24292E;">    </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">192.168.210.33:5432</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Replica</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">stopped</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">    </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">   </span><span style="color:#6F42C1;">unknown</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#6F42C1;">+--------+---------------------+---------+---------+----+-----------+</span></span>
<span class="line"><span style="color:#24292E;">[root@pg_node2 </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# patronictl -c /etc/patroni/patroni.yml list</span></span>
<span class="line"><span style="color:#6F42C1;">2021-06-23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">14</span><span style="color:#032F62;">:42:14,614</span><span style="color:#24292E;"> </span><span style="color:#032F62;">-</span><span style="color:#24292E;"> </span><span style="color:#032F62;">ERROR</span><span style="color:#24292E;"> </span><span style="color:#032F62;">-</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Request</span><span style="color:#24292E;"> </span><span style="color:#032F62;">to</span><span style="color:#24292E;"> </span><span style="color:#032F62;">server</span><span style="color:#24292E;"> </span><span style="color:#032F62;">http://192.168.210.33:2379</span><span style="color:#24292E;"> </span><span style="color:#032F62;">failed:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">MaxRetryError</span><span style="color:#24292E;">(</span><span style="color:#6F42C1;">&quot;HTTPConnectionPool(host=u&#39;192.168.210.33&#39;, port=2379): Max retries exceeded with url: /v3/kv/range (Caused by ConnectTimeoutError(&lt;urllib3.connection.HTTPConnection object at 0x7feec6e0d9d0&gt;, u&#39;Connection to 192.168.210.33 timed out. (connect timeout=1.25)&#39;))&quot;</span><span style="color:#6F42C1;">,</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#6F42C1;">+</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Cluster:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">twpg</span><span style="color:#24292E;"> (6976142033405049133) ---+---------+----+-----------+</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Member</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Host</span><span style="color:#24292E;">                </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Role</span><span style="color:#24292E;">    </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">State</span><span style="color:#24292E;">   </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">TL</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Lag</span><span style="color:#24292E;"> </span><span style="color:#032F62;">in</span><span style="color:#24292E;"> </span><span style="color:#032F62;">MB</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#6F42C1;">+--------+---------------------+---------+---------+----+-----------+</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">pg1</span><span style="color:#24292E;">    </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">192.168.210.15:5432</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Leader</span><span style="color:#24292E;">  </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">running</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">11</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">           </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">pg2</span><span style="color:#24292E;">    </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">192.168.210.81:5432</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Replica</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">running</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">11</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">       </span><span style="color:#6F42C1;">0.0</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">pg3</span><span style="color:#24292E;">    </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">192.168.210.33:5432</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Replica</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">stopped</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">    </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">   </span><span style="color:#6F42C1;">unknown</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#6F42C1;">+--------+---------------------+---------+---------+----+-----------+</span></span>
<span class="line"><span style="color:#24292E;">[root@pg_node2 </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# patronictl -c /etc/patroni/patroni.yml list</span></span>
<span class="line"><span style="color:#6F42C1;">+</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Cluster:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">twpg</span><span style="color:#24292E;"> (6976142033405049133) ---+---------+----+-----------+</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Member</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Host</span><span style="color:#24292E;">                </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Role</span><span style="color:#24292E;">    </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">State</span><span style="color:#24292E;">   </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">TL</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Lag</span><span style="color:#24292E;"> </span><span style="color:#032F62;">in</span><span style="color:#24292E;"> </span><span style="color:#032F62;">MB</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#6F42C1;">+--------+---------------------+---------+---------+----+-----------+</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">pg1</span><span style="color:#24292E;">    </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">192.168.210.15:5432</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Leader</span><span style="color:#24292E;">  </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">running</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">11</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">           </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">pg2</span><span style="color:#24292E;">    </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">192.168.210.81:5432</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Replica</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">running</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">11</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">       </span><span style="color:#6F42C1;">0.0</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#6F42C1;">+--------+---------------------+---------+---------+----+-----------+</span></span>
<span class="line"><span style="color:#6A737D;">#再次启动pg3节点</span></span>
<span class="line"><span style="color:#24292E;">[root@pg_node3 </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# uptime</span></span>
<span class="line"><span style="color:#24292E;"> </span><span style="color:#6F42C1;">14:46:14</span><span style="color:#24292E;"> </span><span style="color:#032F62;">up</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0</span><span style="color:#24292E;"> </span><span style="color:#032F62;">min,</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">user,</span><span style="color:#24292E;">  </span><span style="color:#032F62;">load</span><span style="color:#24292E;"> </span><span style="color:#032F62;">average:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0.71</span><span style="color:#032F62;">,</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0.16</span><span style="color:#032F62;">,</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0.05</span></span>
<span class="line"><span style="color:#24292E;">[root@pg_node3 </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# patronictl -c /etc/patroni/patroni.yml list</span></span>
<span class="line"><span style="color:#6F42C1;">+</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Cluster:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">twpg</span><span style="color:#24292E;"> (6976142033405049133) ---+---------+----+-----------+</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Member</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Host</span><span style="color:#24292E;">                </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Role</span><span style="color:#24292E;">    </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">State</span><span style="color:#24292E;">   </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">TL</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Lag</span><span style="color:#24292E;"> </span><span style="color:#032F62;">in</span><span style="color:#24292E;"> </span><span style="color:#032F62;">MB</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#6F42C1;">+--------+---------------------+---------+---------+----+-----------+</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">pg1</span><span style="color:#24292E;">    </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">192.168.210.15:5432</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Leader</span><span style="color:#24292E;">  </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">running</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">11</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">           </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">pg2</span><span style="color:#24292E;">    </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">192.168.210.81:5432</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Replica</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">running</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">11</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">       </span><span style="color:#6F42C1;">0.0</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">pg3</span><span style="color:#24292E;">    </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">192.168.210.33:5432</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Replica</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">running</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">10</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">       </span><span style="color:#6F42C1;">0.0</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#6F42C1;">+--------+---------------------+---------+---------+----+-----------+</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#手工switchover</span></span>
<span class="line"><span style="color:#24292E;">[root@pg_node1 </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# patronictl switchover</span></span>
<span class="line"><span style="color:#6F42C1;">Master</span><span style="color:#24292E;"> [pg1]: </span></span>
<span class="line"><span style="color:#6F42C1;">Candidate</span><span style="color:#24292E;"> [</span><span style="color:#032F62;">&#39;pg2&#39;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&#39;pg3&#39;]</span><span style="color:#24292E;"> []: ^CAborted</span><span style="color:#D73A49;">!</span></span>
<span class="line"><span style="color:#24292E;">[root@pg_node1 </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# patronictl switchover</span></span>
<span class="line"><span style="color:#6F42C1;">Master</span><span style="color:#24292E;"> [pg1]: </span></span>
<span class="line"><span style="color:#6F42C1;">Candidate</span><span style="color:#24292E;"> [</span><span style="color:#032F62;">&#39;pg2&#39;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&#39;pg3&#39;]</span><span style="color:#24292E;"> []: pg2</span></span>
<span class="line"><span style="color:#6F42C1;">When</span><span style="color:#24292E;"> </span><span style="color:#032F62;">should</span><span style="color:#24292E;"> </span><span style="color:#032F62;">the</span><span style="color:#24292E;"> </span><span style="color:#032F62;">switchover</span><span style="color:#24292E;"> </span><span style="color:#032F62;">take</span><span style="color:#24292E;"> </span><span style="color:#032F62;">place</span><span style="color:#24292E;"> (e.g. </span><span style="color:#005CC5;">2021</span><span style="color:#032F62;">-06-23T16:12</span><span style="color:#24292E;"> )  [now]: </span></span>
<span class="line"><span style="color:#6F42C1;">Current</span><span style="color:#24292E;"> </span><span style="color:#032F62;">cluster</span><span style="color:#24292E;"> </span><span style="color:#032F62;">topology</span></span>
<span class="line"><span style="color:#6F42C1;">+</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Cluster:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">twpg</span><span style="color:#24292E;"> (6976142033405049133) ---+---------+----+-----------+</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Member</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Host</span><span style="color:#24292E;">                </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Role</span><span style="color:#24292E;">    </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">State</span><span style="color:#24292E;">   </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">TL</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Lag</span><span style="color:#24292E;"> </span><span style="color:#032F62;">in</span><span style="color:#24292E;"> </span><span style="color:#032F62;">MB</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#6F42C1;">+--------+---------------------+---------+---------+----+-----------+</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">pg1</span><span style="color:#24292E;">    </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">192.168.210.15:5432</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Leader</span><span style="color:#24292E;">  </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">running</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">11</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">           </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">pg2</span><span style="color:#24292E;">    </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">192.168.210.81:5432</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Replica</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">running</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">11</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">       </span><span style="color:#6F42C1;">0.0</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">pg3</span><span style="color:#24292E;">    </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">192.168.210.33:5432</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Replica</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">running</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">11</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">       </span><span style="color:#6F42C1;">0.0</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#6F42C1;">+--------+---------------------+---------+---------+----+-----------+</span></span>
<span class="line"><span style="color:#6F42C1;">Are</span><span style="color:#24292E;"> </span><span style="color:#032F62;">you</span><span style="color:#24292E;"> </span><span style="color:#032F62;">sure</span><span style="color:#24292E;"> </span><span style="color:#032F62;">you</span><span style="color:#24292E;"> </span><span style="color:#032F62;">want</span><span style="color:#24292E;"> </span><span style="color:#032F62;">to</span><span style="color:#24292E;"> </span><span style="color:#032F62;">switchover</span><span style="color:#24292E;"> </span><span style="color:#032F62;">cluster</span><span style="color:#24292E;"> </span><span style="color:#032F62;">twpg,</span><span style="color:#24292E;"> </span><span style="color:#032F62;">demoting</span><span style="color:#24292E;"> </span><span style="color:#032F62;">current</span><span style="color:#24292E;"> </span><span style="color:#032F62;">master</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg1?</span><span style="color:#24292E;"> [y/N]: y  </span></span>
<span class="line"><span style="color:#6F42C1;">2021-06-23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">15</span><span style="color:#032F62;">:13:26.97922</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Successfully</span><span style="color:#24292E;"> </span><span style="color:#032F62;">switched</span><span style="color:#24292E;"> </span><span style="color:#032F62;">over</span><span style="color:#24292E;"> </span><span style="color:#032F62;">to</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;pg2&quot;</span></span>
<span class="line"><span style="color:#6F42C1;">+</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Cluster:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">twpg</span><span style="color:#24292E;"> (6976142033405049133) ---+---------+----+-----------+</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Member</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Host</span><span style="color:#24292E;">                </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Role</span><span style="color:#24292E;">    </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">State</span><span style="color:#24292E;">   </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">TL</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Lag</span><span style="color:#24292E;"> </span><span style="color:#032F62;">in</span><span style="color:#24292E;"> </span><span style="color:#032F62;">MB</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#6F42C1;">+--------+---------------------+---------+---------+----+-----------+</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">pg1</span><span style="color:#24292E;">    </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">192.168.210.15:5432</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Replica</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">stopped</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">    </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">   </span><span style="color:#6F42C1;">unknown</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">pg2</span><span style="color:#24292E;">    </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">192.168.210.81:5432</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Leader</span><span style="color:#24292E;">  </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">running</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">11</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">           </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">pg3</span><span style="color:#24292E;">    </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">192.168.210.33:5432</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Replica</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">running</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">11</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">       </span><span style="color:#6F42C1;">0.0</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#6F42C1;">+--------+---------------------+---------+---------+----+-----------+</span></span>
<span class="line"><span style="color:#24292E;">[root@pg_node1 </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# patronictl list</span></span>
<span class="line"><span style="color:#6F42C1;">+</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Cluster:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">twpg</span><span style="color:#24292E;"> (6976142033405049133) ---+---------+----+-----------+</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Member</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Host</span><span style="color:#24292E;">                </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Role</span><span style="color:#24292E;">    </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">State</span><span style="color:#24292E;">   </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">TL</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Lag</span><span style="color:#24292E;"> </span><span style="color:#032F62;">in</span><span style="color:#24292E;"> </span><span style="color:#032F62;">MB</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#6F42C1;">+--------+---------------------+---------+---------+----+-----------+</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">pg1</span><span style="color:#24292E;">    </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">192.168.210.15:5432</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Replica</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">stopped</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">    </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">   </span><span style="color:#6F42C1;">unknown</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">pg2</span><span style="color:#24292E;">    </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">192.168.210.81:5432</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Leader</span><span style="color:#24292E;">  </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">running</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">12</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">           </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">pg3</span><span style="color:#24292E;">    </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">192.168.210.33:5432</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Replica</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">running</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">11</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">       </span><span style="color:#6F42C1;">0.0</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#6F42C1;">+--------+---------------------+---------+---------+----+-----------+</span></span>
<span class="line"><span style="color:#24292E;">[root@pg_node1 </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# patronictl list</span></span>
<span class="line"><span style="color:#6F42C1;">+</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Cluster:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">twpg</span><span style="color:#24292E;"> (6976142033405049133) ---+---------+----+-----------+</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Member</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Host</span><span style="color:#24292E;">                </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Role</span><span style="color:#24292E;">    </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">State</span><span style="color:#24292E;">   </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">TL</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Lag</span><span style="color:#24292E;"> </span><span style="color:#032F62;">in</span><span style="color:#24292E;"> </span><span style="color:#032F62;">MB</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#6F42C1;">+--------+---------------------+---------+---------+----+-----------+</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">pg1</span><span style="color:#24292E;">    </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">192.168.210.15:5432</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Replica</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">running</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">12</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">       </span><span style="color:#6F42C1;">0.0</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">pg2</span><span style="color:#24292E;">    </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">192.168.210.81:5432</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Leader</span><span style="color:#24292E;">  </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">running</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">12</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">           </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">pg3</span><span style="color:#24292E;">    </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">192.168.210.33:5432</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Replica</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">running</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">12</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">       </span><span style="color:#6F42C1;">0.0</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#6F42C1;">+--------+---------------------+---------+---------+----+-----------+</span></span>
<span class="line"><span style="color:#6A737D;">#日志信息如下：</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">15</span><span style="color:#032F62;">:13:16</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2021</span><span style="color:#032F62;">-06-23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">15</span><span style="color:#032F62;">:13:16,311</span><span style="color:#24292E;"> </span><span style="color:#032F62;">INFO:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Lock</span><span style="color:#24292E;"> </span><span style="color:#032F62;">owner:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg1</span><span style="color:#24292E;">; </span><span style="color:#6F42C1;">I</span><span style="color:#24292E;"> </span><span style="color:#032F62;">am</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg1</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">15</span><span style="color:#032F62;">:13:16</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2021</span><span style="color:#032F62;">-06-23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">15</span><span style="color:#032F62;">:13:16,316</span><span style="color:#24292E;"> </span><span style="color:#032F62;">INFO:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">no</span><span style="color:#24292E;"> </span><span style="color:#032F62;">action.</span><span style="color:#24292E;">  </span><span style="color:#032F62;">i</span><span style="color:#24292E;"> </span><span style="color:#032F62;">am</span><span style="color:#24292E;"> </span><span style="color:#032F62;">the</span><span style="color:#24292E;"> </span><span style="color:#032F62;">leader</span><span style="color:#24292E;"> </span><span style="color:#032F62;">with</span><span style="color:#24292E;"> </span><span style="color:#032F62;">the</span><span style="color:#24292E;"> </span><span style="color:#032F62;">lock</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">15</span><span style="color:#032F62;">:13:24</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2021</span><span style="color:#032F62;">-06-23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">15</span><span style="color:#032F62;">:13:24,854</span><span style="color:#24292E;"> </span><span style="color:#032F62;">INFO:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">received</span><span style="color:#24292E;"> </span><span style="color:#032F62;">switchover</span><span style="color:#24292E;"> </span><span style="color:#032F62;">request</span><span style="color:#24292E;"> </span><span style="color:#032F62;">with</span><span style="color:#24292E;"> </span><span style="color:#032F62;">leader=pg1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">candidate=pg2</span><span style="color:#24292E;"> </span><span style="color:#032F62;">scheduled_at=None</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">15</span><span style="color:#032F62;">:13:24</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2021</span><span style="color:#032F62;">-06-23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">15</span><span style="color:#032F62;">:13:24,879</span><span style="color:#24292E;"> </span><span style="color:#032F62;">INFO:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Got</span><span style="color:#24292E;"> </span><span style="color:#032F62;">response</span><span style="color:#24292E;"> </span><span style="color:#032F62;">from</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg2</span><span style="color:#24292E;"> </span><span style="color:#032F62;">http://192.168.210.81:8008/patroni:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">{&quot;database_system_identifier&quot;:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;6976142033405049133&quot;,</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;postmaster_start_time&quot;:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;2021-06-23 14:25:40.252 CST&quot;,</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;timeline&quot;:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">11</span><span style="color:#032F62;">,</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;cluster_unlocked&quot;:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">false</span><span style="color:#032F62;">,</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;patroni&quot;:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">{&quot;scope&quot;:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;twpg&quot;,</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;version&quot;:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;2.0.2&quot;},</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;state&quot;:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;running&quot;,</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;role&quot;:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;replica&quot;,</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;xlog&quot;:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">{&quot;received_location&quot;:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">84186784</span><span style="color:#032F62;">,</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;replayed_timestamp&quot;:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;2021-06-23 14:25:40.045 CST&quot;,</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;paused&quot;:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">false</span><span style="color:#032F62;">,</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;replayed_location&quot;:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">84186784</span><span style="color:#032F62;">},</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;server_version&quot;:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">130003</span><span style="color:#032F62;">}</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">15</span><span style="color:#032F62;">:13:25</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2021</span><span style="color:#032F62;">-06-23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">15</span><span style="color:#032F62;">:13:25,011</span><span style="color:#24292E;"> </span><span style="color:#032F62;">INFO:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Lock</span><span style="color:#24292E;"> </span><span style="color:#032F62;">owner:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg1</span><span style="color:#24292E;">; </span><span style="color:#6F42C1;">I</span><span style="color:#24292E;"> </span><span style="color:#032F62;">am</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg1</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">15</span><span style="color:#032F62;">:13:25</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2021</span><span style="color:#032F62;">-06-23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">15</span><span style="color:#032F62;">:13:25,031</span><span style="color:#24292E;"> </span><span style="color:#032F62;">INFO:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Got</span><span style="color:#24292E;"> </span><span style="color:#032F62;">response</span><span style="color:#24292E;"> </span><span style="color:#032F62;">from</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg2</span><span style="color:#24292E;"> </span><span style="color:#032F62;">http://192.168.210.81:8008/patroni:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">{&quot;database_system_identifier&quot;:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;6976142033405049133&quot;,</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;postmaster_start_time&quot;:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;2021-06-23 14:25:40.252 CST&quot;,</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;timeline&quot;:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">11</span><span style="color:#032F62;">,</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;cluster_unlocked&quot;:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">false</span><span style="color:#032F62;">,</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;patroni&quot;:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">{&quot;scope&quot;:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;twpg&quot;,</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;version&quot;:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;2.0.2&quot;},</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;state&quot;:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;running&quot;,</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;role&quot;:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;replica&quot;,</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;xlog&quot;:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">{&quot;received_location&quot;:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">84186784</span><span style="color:#032F62;">,</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;replayed_timestamp&quot;:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;2021-06-23 14:25:40.045 CST&quot;,</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;paused&quot;:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">false</span><span style="color:#032F62;">,</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;replayed_location&quot;:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">84186784</span><span style="color:#032F62;">},</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;server_version&quot;:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">130003</span><span style="color:#032F62;">}</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">15</span><span style="color:#032F62;">:13:25</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2021</span><span style="color:#032F62;">-06-23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">15</span><span style="color:#032F62;">:13:25,134</span><span style="color:#24292E;"> </span><span style="color:#032F62;">INFO:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">manual</span><span style="color:#24292E;"> </span><span style="color:#032F62;">failover:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">demoting</span><span style="color:#24292E;"> </span><span style="color:#032F62;">myself</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">15</span><span style="color:#032F62;">:13:25</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2021</span><span style="color:#032F62;">-06-23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">15</span><span style="color:#032F62;">:13:25.222</span><span style="color:#24292E;"> </span><span style="color:#032F62;">CST</span><span style="color:#24292E;"> [4256] LOG:  received fast shutdown request</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">15</span><span style="color:#032F62;">:13:25</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2021</span><span style="color:#032F62;">-06-23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">15</span><span style="color:#032F62;">:13:25.234</span><span style="color:#24292E;"> </span><span style="color:#032F62;">CST</span><span style="color:#24292E;"> [4256] LOG:  aborting any active transactions</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">15</span><span style="color:#032F62;">:13:25</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2021</span><span style="color:#032F62;">-06-23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">15</span><span style="color:#032F62;">:13:25.234</span><span style="color:#24292E;"> </span><span style="color:#032F62;">CST</span><span style="color:#24292E;"> [4270] FATAL:  terminating connection due to administrator command</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">15</span><span style="color:#032F62;">:13:25</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2021</span><span style="color:#032F62;">-06-23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">15</span><span style="color:#032F62;">:13:25.235</span><span style="color:#24292E;"> </span><span style="color:#032F62;">CST</span><span style="color:#24292E;"> [4256] LOG:  background worker </span><span style="color:#032F62;">&quot;logical replication launcher&quot;</span><span style="color:#24292E;"> (</span><span style="color:#6F42C1;">PID</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">4522</span><span style="color:#24292E;">) exited with exit code 1</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">15</span><span style="color:#032F62;">:13:25</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2021</span><span style="color:#032F62;">-06-23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">15</span><span style="color:#032F62;">:13:25.237</span><span style="color:#24292E;"> </span><span style="color:#032F62;">CST</span><span style="color:#24292E;"> [4259] LOG:  shutting down</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">15</span><span style="color:#032F62;">:13:25</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2021</span><span style="color:#032F62;">-06-23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">15</span><span style="color:#032F62;">:13:25.306</span><span style="color:#24292E;"> </span><span style="color:#032F62;">CST</span><span style="color:#24292E;"> [4256] LOG:  database system is shut down</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">15</span><span style="color:#032F62;">:13:26</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">this</span><span style="color:#24292E;"> </span><span style="color:#032F62;">is</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni</span><span style="color:#24292E;"> </span><span style="color:#032F62;">callback</span><span style="color:#24292E;"> </span><span style="color:#032F62;">on_stop</span><span style="color:#24292E;"> </span><span style="color:#032F62;">master</span><span style="color:#24292E;"> </span><span style="color:#032F62;">twpg</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">15</span><span style="color:#032F62;">:13:26</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">systemd:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Started</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Session</span><span style="color:#24292E;"> </span><span style="color:#032F62;">c5</span><span style="color:#24292E;"> </span><span style="color:#032F62;">of</span><span style="color:#24292E;"> </span><span style="color:#032F62;">user</span><span style="color:#24292E;"> </span><span style="color:#032F62;">root.</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">15</span><span style="color:#032F62;">:13:26</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2021</span><span style="color:#032F62;">-06-23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">15</span><span style="color:#032F62;">:13:26,275</span><span style="color:#24292E;"> </span><span style="color:#032F62;">INFO:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Leader</span><span style="color:#24292E;"> </span><span style="color:#032F62;">key</span><span style="color:#24292E;"> </span><span style="color:#032F62;">released</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">15</span><span style="color:#032F62;">:13:26</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2021</span><span style="color:#032F62;">-06-23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">15</span><span style="color:#032F62;">:13:26,277</span><span style="color:#24292E;"> </span><span style="color:#032F62;">INFO:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Lock</span><span style="color:#24292E;"> </span><span style="color:#032F62;">owner:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">None</span><span style="color:#24292E;">; </span><span style="color:#6F42C1;">I</span><span style="color:#24292E;"> </span><span style="color:#032F62;">am</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg1</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">15</span><span style="color:#032F62;">:13:26</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2021</span><span style="color:#032F62;">-06-23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">15</span><span style="color:#032F62;">:13:26,277</span><span style="color:#24292E;"> </span><span style="color:#032F62;">INFO:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">not</span><span style="color:#24292E;"> </span><span style="color:#032F62;">healthy</span><span style="color:#24292E;"> </span><span style="color:#032F62;">enough</span><span style="color:#24292E;"> </span><span style="color:#032F62;">for</span><span style="color:#24292E;"> </span><span style="color:#032F62;">leader</span><span style="color:#24292E;"> </span><span style="color:#032F62;">race</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">15</span><span style="color:#032F62;">:13:26</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2021</span><span style="color:#032F62;">-06-23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">15</span><span style="color:#032F62;">:13:26,277</span><span style="color:#24292E;"> </span><span style="color:#032F62;">INFO:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">manual</span><span style="color:#24292E;"> </span><span style="color:#032F62;">failover:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">demote</span><span style="color:#24292E;"> </span><span style="color:#032F62;">in</span><span style="color:#24292E;"> </span><span style="color:#032F62;">progress</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">15</span><span style="color:#032F62;">:13:26</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2021</span><span style="color:#032F62;">-06-23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">15</span><span style="color:#032F62;">:13:26,278</span><span style="color:#24292E;"> </span><span style="color:#032F62;">INFO:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Lock</span><span style="color:#24292E;"> </span><span style="color:#032F62;">owner:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">None</span><span style="color:#24292E;">; </span><span style="color:#6F42C1;">I</span><span style="color:#24292E;"> </span><span style="color:#032F62;">am</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg1</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">15</span><span style="color:#032F62;">:13:26</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2021</span><span style="color:#032F62;">-06-23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">15</span><span style="color:#032F62;">:13:26,279</span><span style="color:#24292E;"> </span><span style="color:#032F62;">INFO:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">not</span><span style="color:#24292E;"> </span><span style="color:#032F62;">healthy</span><span style="color:#24292E;"> </span><span style="color:#032F62;">enough</span><span style="color:#24292E;"> </span><span style="color:#032F62;">for</span><span style="color:#24292E;"> </span><span style="color:#032F62;">leader</span><span style="color:#24292E;"> </span><span style="color:#032F62;">race</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">15</span><span style="color:#032F62;">:13:26</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2021</span><span style="color:#032F62;">-06-23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">15</span><span style="color:#032F62;">:13:26,279</span><span style="color:#24292E;"> </span><span style="color:#032F62;">INFO:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">manual</span><span style="color:#24292E;"> </span><span style="color:#032F62;">failover:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">demote</span><span style="color:#24292E;"> </span><span style="color:#032F62;">in</span><span style="color:#24292E;"> </span><span style="color:#032F62;">progress</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">15</span><span style="color:#032F62;">:13:26</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2021</span><span style="color:#032F62;">-06-23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">15</span><span style="color:#032F62;">:13:26,296</span><span style="color:#24292E;"> </span><span style="color:#032F62;">INFO:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Lock</span><span style="color:#24292E;"> </span><span style="color:#032F62;">owner:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg2</span><span style="color:#24292E;">; </span><span style="color:#6F42C1;">I</span><span style="color:#24292E;"> </span><span style="color:#032F62;">am</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg1</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">15</span><span style="color:#032F62;">:13:26</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2021</span><span style="color:#032F62;">-06-23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">15</span><span style="color:#032F62;">:13:26,297</span><span style="color:#24292E;"> </span><span style="color:#032F62;">INFO:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">manual</span><span style="color:#24292E;"> </span><span style="color:#032F62;">failover:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">demote</span><span style="color:#24292E;"> </span><span style="color:#032F62;">in</span><span style="color:#24292E;"> </span><span style="color:#032F62;">progress</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">15</span><span style="color:#032F62;">:13:27</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2021</span><span style="color:#032F62;">-06-23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">15</span><span style="color:#032F62;">:13:27,416</span><span style="color:#24292E;"> </span><span style="color:#032F62;">INFO:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Lock</span><span style="color:#24292E;"> </span><span style="color:#032F62;">owner:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg2</span><span style="color:#24292E;">; </span><span style="color:#6F42C1;">I</span><span style="color:#24292E;"> </span><span style="color:#032F62;">am</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg1</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">15</span><span style="color:#032F62;">:13:27</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2021</span><span style="color:#032F62;">-06-23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">15</span><span style="color:#032F62;">:13:27,417</span><span style="color:#24292E;"> </span><span style="color:#032F62;">INFO:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">manual</span><span style="color:#24292E;"> </span><span style="color:#032F62;">failover:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">demote</span><span style="color:#24292E;"> </span><span style="color:#032F62;">in</span><span style="color:#24292E;"> </span><span style="color:#032F62;">progress</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">15</span><span style="color:#032F62;">:13:27</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2021</span><span style="color:#032F62;">-06-23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">15</span><span style="color:#032F62;">:13:27,532</span><span style="color:#24292E;"> </span><span style="color:#032F62;">INFO:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Lock</span><span style="color:#24292E;"> </span><span style="color:#032F62;">owner:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg2</span><span style="color:#24292E;">; </span><span style="color:#6F42C1;">I</span><span style="color:#24292E;"> </span><span style="color:#032F62;">am</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg1</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">15</span><span style="color:#032F62;">:13:27</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2021</span><span style="color:#032F62;">-06-23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">15</span><span style="color:#032F62;">:13:27,532</span><span style="color:#24292E;"> </span><span style="color:#032F62;">INFO:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">manual</span><span style="color:#24292E;"> </span><span style="color:#032F62;">failover:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">demote</span><span style="color:#24292E;"> </span><span style="color:#032F62;">in</span><span style="color:#24292E;"> </span><span style="color:#032F62;">progress</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">15</span><span style="color:#032F62;">:13:28</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2021</span><span style="color:#032F62;">-06-23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">15</span><span style="color:#032F62;">:13:28,292</span><span style="color:#24292E;"> </span><span style="color:#032F62;">INFO:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Local</span><span style="color:#24292E;"> </span><span style="color:#032F62;">timeline=</span><span style="color:#005CC5;">11</span><span style="color:#24292E;"> </span><span style="color:#032F62;">lsn=</span><span style="color:#005CC5;">0</span><span style="color:#032F62;">/5049750</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">15</span><span style="color:#032F62;">:13:28</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2021</span><span style="color:#032F62;">-06-23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">15</span><span style="color:#032F62;">:13:28,300</span><span style="color:#24292E;"> </span><span style="color:#032F62;">INFO:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">master_timeline=</span><span style="color:#005CC5;">12</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">15</span><span style="color:#032F62;">:13:28</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2021</span><span style="color:#032F62;">-06-23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">15</span><span style="color:#032F62;">:13:28,315</span><span style="color:#24292E;"> </span><span style="color:#032F62;">INFO:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">master:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">history=</span><span style="color:#005CC5;">8#0110</span><span style="color:#032F62;">/5014B48#011no</span><span style="color:#24292E;"> </span><span style="color:#032F62;">recovery</span><span style="color:#24292E;"> </span><span style="color:#032F62;">target</span><span style="color:#24292E;"> </span><span style="color:#032F62;">specified</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">15</span><span style="color:#032F62;">:13:28</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">9#0110</span><span style="color:#032F62;">/502CCE8#011no</span><span style="color:#24292E;"> </span><span style="color:#032F62;">recovery</span><span style="color:#24292E;"> </span><span style="color:#032F62;">target</span><span style="color:#24292E;"> </span><span style="color:#032F62;">specified</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">15</span><span style="color:#032F62;">:13:28</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">10#0110</span><span style="color:#032F62;">/5048A98#011no</span><span style="color:#24292E;"> </span><span style="color:#032F62;">recovery</span><span style="color:#24292E;"> </span><span style="color:#032F62;">target</span><span style="color:#24292E;"> </span><span style="color:#032F62;">specified</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">15</span><span style="color:#032F62;">:13:28</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">11#0110</span><span style="color:#032F62;">/50497C8#011no</span><span style="color:#24292E;"> </span><span style="color:#032F62;">recovery</span><span style="color:#24292E;"> </span><span style="color:#032F62;">target</span><span style="color:#24292E;"> </span><span style="color:#032F62;">specified</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">15</span><span style="color:#032F62;">:13:28</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2021</span><span style="color:#032F62;">-06-23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">15</span><span style="color:#032F62;">:13:28,317</span><span style="color:#24292E;"> </span><span style="color:#032F62;">INFO:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">closed</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni</span><span style="color:#24292E;"> </span><span style="color:#032F62;">connection</span><span style="color:#24292E;"> </span><span style="color:#032F62;">to</span><span style="color:#24292E;"> </span><span style="color:#032F62;">the</span><span style="color:#24292E;"> </span><span style="color:#032F62;">postgresql</span><span style="color:#24292E;"> </span><span style="color:#032F62;">cluster</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">15</span><span style="color:#032F62;">:13:28</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2021</span><span style="color:#032F62;">-06-23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">15</span><span style="color:#032F62;">:13:28,348</span><span style="color:#24292E;"> </span><span style="color:#032F62;">INFO:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">postmaster</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pid=</span><span style="color:#005CC5;">4739</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">15</span><span style="color:#032F62;">:13:28</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">localhost:5432</span><span style="color:#24292E;"> </span><span style="color:#032F62;">-</span><span style="color:#24292E;"> </span><span style="color:#032F62;">no</span><span style="color:#24292E;"> </span><span style="color:#032F62;">response</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">15</span><span style="color:#032F62;">:13:28</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2021</span><span style="color:#032F62;">-06-23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">15</span><span style="color:#032F62;">:13:28.386</span><span style="color:#24292E;"> </span><span style="color:#032F62;">CST</span><span style="color:#24292E;"> [4739] LOG:  starting PostgreSQL 13.3 on x86_64-pc-linux-gnu, compiled by gcc (</span><span style="color:#6F42C1;">GCC</span><span style="color:#24292E;">) 4.8.5 20150623 (</span><span style="color:#6F42C1;">Red</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Hat</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">4.8</span><span style="color:#032F62;">.5-44</span><span style="color:#24292E;">), 64-bit</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">15</span><span style="color:#032F62;">:13:28</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2021</span><span style="color:#032F62;">-06-23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">15</span><span style="color:#032F62;">:13:28.386</span><span style="color:#24292E;"> </span><span style="color:#032F62;">CST</span><span style="color:#24292E;"> [4739] LOG:  listening on IPv4 address </span><span style="color:#032F62;">&quot;0.0.0.0&quot;</span><span style="color:#24292E;">, port 5432</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">15</span><span style="color:#032F62;">:13:28</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2021</span><span style="color:#032F62;">-06-23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">15</span><span style="color:#032F62;">:13:28.401</span><span style="color:#24292E;"> </span><span style="color:#032F62;">CST</span><span style="color:#24292E;"> [4739] LOG:  listening on Unix socket </span><span style="color:#032F62;">&quot;/tmp/.s.PGSQL.5432&quot;</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">15</span><span style="color:#032F62;">:13:28</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2021</span><span style="color:#032F62;">-06-23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">15</span><span style="color:#032F62;">:13:28.417</span><span style="color:#24292E;"> </span><span style="color:#032F62;">CST</span><span style="color:#24292E;"> [4741] LOG:  database system was shut down at 2021-06-23 15:13:25 CST</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">15</span><span style="color:#032F62;">:13:28</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2021</span><span style="color:#032F62;">-06-23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">15</span><span style="color:#032F62;">:13:28.418</span><span style="color:#24292E;"> </span><span style="color:#032F62;">CST</span><span style="color:#24292E;"> [4741] LOG:  entering standby mode</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">15</span><span style="color:#032F62;">:13:28</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2021</span><span style="color:#032F62;">-06-23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">15</span><span style="color:#032F62;">:13:28.428</span><span style="color:#24292E;"> </span><span style="color:#032F62;">CST</span><span style="color:#24292E;"> [4741] LOG:  consistent recovery state reached at 0/50497C8</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">15</span><span style="color:#032F62;">:13:28</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2021</span><span style="color:#032F62;">-06-23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">15</span><span style="color:#032F62;">:13:28.428</span><span style="color:#24292E;"> </span><span style="color:#032F62;">CST</span><span style="color:#24292E;"> [4741] LOG:  invalid record length at 0/50497C8: wanted 24, got 0</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">15</span><span style="color:#032F62;">:13:28</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2021</span><span style="color:#032F62;">-06-23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">15</span><span style="color:#032F62;">:13:28.429</span><span style="color:#24292E;"> </span><span style="color:#032F62;">CST</span><span style="color:#24292E;"> [4739] LOG:  database system is ready to accept read only connections</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">15</span><span style="color:#032F62;">:13:28</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2021</span><span style="color:#032F62;">-06-23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">15</span><span style="color:#032F62;">:13:28.447</span><span style="color:#24292E;"> </span><span style="color:#032F62;">CST</span><span style="color:#24292E;"> [4745] LOG:  fetching timeline history file </span><span style="color:#D73A49;">for</span><span style="color:#24292E;"> timeline 12 from primary server</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">15</span><span style="color:#032F62;">:13:28</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2021</span><span style="color:#032F62;">-06-23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">15</span><span style="color:#032F62;">:13:28.460</span><span style="color:#24292E;"> </span><span style="color:#032F62;">CST</span><span style="color:#24292E;"> [4745] LOG:  started streaming WAL from primary at 0/5000000 on timeline 11</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">15</span><span style="color:#032F62;">:13:28</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2021</span><span style="color:#032F62;">-06-23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">15</span><span style="color:#032F62;">:13:28.463</span><span style="color:#24292E;"> </span><span style="color:#032F62;">CST</span><span style="color:#24292E;"> [4745] LOG:  replication terminated by primary server</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">15</span><span style="color:#032F62;">:13:28</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2021</span><span style="color:#032F62;">-06-23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">15</span><span style="color:#032F62;">:13:28.463</span><span style="color:#24292E;"> </span><span style="color:#032F62;">CST</span><span style="color:#24292E;"> [4745] DETAIL:  End of WAL reached on timeline 11 at 0/50497C8.</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">15</span><span style="color:#032F62;">:13:28</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2021</span><span style="color:#032F62;">-06-23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">15</span><span style="color:#032F62;">:13:28.463</span><span style="color:#24292E;"> </span><span style="color:#032F62;">CST</span><span style="color:#24292E;"> [4741] LOG:  new target timeline is 12</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">15</span><span style="color:#032F62;">:13:28</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2021</span><span style="color:#032F62;">-06-23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">15</span><span style="color:#032F62;">:13:28.464</span><span style="color:#24292E;"> </span><span style="color:#032F62;">CST</span><span style="color:#24292E;"> [4745] LOG:  restarted WAL streaming at 0/5000000 on timeline 12</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">15</span><span style="color:#032F62;">:13:28</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2021</span><span style="color:#032F62;">-06-23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">15</span><span style="color:#032F62;">:13:28.703</span><span style="color:#24292E;"> </span><span style="color:#032F62;">CST</span><span style="color:#24292E;"> [4741] LOG:  redo starts at 0/50497C8</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">15</span><span style="color:#032F62;">:13:29</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">localhost:5432</span><span style="color:#24292E;"> </span><span style="color:#032F62;">-</span><span style="color:#24292E;"> </span><span style="color:#032F62;">accepting</span><span style="color:#24292E;"> </span><span style="color:#032F62;">connections</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">15</span><span style="color:#032F62;">:13:29</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">localhost:5432</span><span style="color:#24292E;"> </span><span style="color:#032F62;">-</span><span style="color:#24292E;"> </span><span style="color:#032F62;">accepting</span><span style="color:#24292E;"> </span><span style="color:#032F62;">connections</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">15</span><span style="color:#032F62;">:13:29</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">this</span><span style="color:#24292E;"> </span><span style="color:#032F62;">is</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni</span><span style="color:#24292E;"> </span><span style="color:#032F62;">callback</span><span style="color:#24292E;"> </span><span style="color:#032F62;">on_role_change</span><span style="color:#24292E;"> </span><span style="color:#032F62;">replica</span><span style="color:#24292E;"> </span><span style="color:#032F62;">twpg</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">15</span><span style="color:#032F62;">:13:29</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">systemd:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Started</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Session</span><span style="color:#24292E;"> </span><span style="color:#032F62;">c6</span><span style="color:#24292E;"> </span><span style="color:#032F62;">of</span><span style="color:#24292E;"> </span><span style="color:#032F62;">user</span><span style="color:#24292E;"> </span><span style="color:#032F62;">root.</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">15</span><span style="color:#032F62;">:13:37</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2021</span><span style="color:#032F62;">-06-23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">15</span><span style="color:#032F62;">:13:37,534</span><span style="color:#24292E;"> </span><span style="color:#032F62;">INFO:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Lock</span><span style="color:#24292E;"> </span><span style="color:#032F62;">owner:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg2</span><span style="color:#24292E;">; </span><span style="color:#6F42C1;">I</span><span style="color:#24292E;"> </span><span style="color:#032F62;">am</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg1</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">15</span><span style="color:#032F62;">:13:37</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2021</span><span style="color:#032F62;">-06-23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">15</span><span style="color:#032F62;">:13:37,534</span><span style="color:#24292E;"> </span><span style="color:#032F62;">INFO:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">does</span><span style="color:#24292E;"> </span><span style="color:#032F62;">not</span><span style="color:#24292E;"> </span><span style="color:#032F62;">have</span><span style="color:#24292E;"> </span><span style="color:#032F62;">lock</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">15</span><span style="color:#032F62;">:13:37</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2021</span><span style="color:#032F62;">-06-23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">15</span><span style="color:#032F62;">:13:37,535</span><span style="color:#24292E;"> </span><span style="color:#032F62;">INFO:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">establishing</span><span style="color:#24292E;"> </span><span style="color:#032F62;">a</span><span style="color:#24292E;"> </span><span style="color:#032F62;">new</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni</span><span style="color:#24292E;"> </span><span style="color:#032F62;">connection</span><span style="color:#24292E;"> </span><span style="color:#032F62;">to</span><span style="color:#24292E;"> </span><span style="color:#032F62;">the</span><span style="color:#24292E;"> </span><span style="color:#032F62;">postgres</span><span style="color:#24292E;"> </span><span style="color:#032F62;">cluster</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">15</span><span style="color:#032F62;">:13:37</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2021</span><span style="color:#032F62;">-06-23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">15</span><span style="color:#032F62;">:13:37,579</span><span style="color:#24292E;"> </span><span style="color:#032F62;">INFO:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">no</span><span style="color:#24292E;"> </span><span style="color:#032F62;">action.</span><span style="color:#24292E;">  </span><span style="color:#032F62;">i</span><span style="color:#24292E;"> </span><span style="color:#032F62;">am</span><span style="color:#24292E;"> </span><span style="color:#032F62;">a</span><span style="color:#24292E;"> </span><span style="color:#032F62;">secondary</span><span style="color:#24292E;"> </span><span style="color:#032F62;">and</span><span style="color:#24292E;"> </span><span style="color:#032F62;">i</span><span style="color:#24292E;"> </span><span style="color:#032F62;">am</span><span style="color:#24292E;"> </span><span style="color:#032F62;">following</span><span style="color:#24292E;"> </span><span style="color:#032F62;">a</span><span style="color:#24292E;"> </span><span style="color:#032F62;">leader</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#手工failover</span></span>
<span class="line"><span style="color:#24292E;">[root@pg_node1 </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# patronictl failover</span></span>
<span class="line"><span style="color:#6F42C1;">Candidate</span><span style="color:#24292E;"> [</span><span style="color:#032F62;">&#39;pg1&#39;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&#39;pg3&#39;]</span><span style="color:#24292E;"> []: pg1</span></span>
<span class="line"><span style="color:#6F42C1;">Current</span><span style="color:#24292E;"> </span><span style="color:#032F62;">cluster</span><span style="color:#24292E;"> </span><span style="color:#032F62;">topology</span></span>
<span class="line"><span style="color:#6F42C1;">+</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Cluster:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">twpg</span><span style="color:#24292E;"> (6976142033405049133) ---+---------+----+-----------+</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Member</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Host</span><span style="color:#24292E;">                </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Role</span><span style="color:#24292E;">    </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">State</span><span style="color:#24292E;">   </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">TL</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Lag</span><span style="color:#24292E;"> </span><span style="color:#032F62;">in</span><span style="color:#24292E;"> </span><span style="color:#032F62;">MB</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#6F42C1;">+--------+---------------------+---------+---------+----+-----------+</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">pg1</span><span style="color:#24292E;">    </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">192.168.210.15:5432</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Replica</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">running</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">12</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">       </span><span style="color:#6F42C1;">0.0</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">pg2</span><span style="color:#24292E;">    </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">192.168.210.81:5432</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Leader</span><span style="color:#24292E;">  </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">running</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">12</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">           </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">pg3</span><span style="color:#24292E;">    </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">192.168.210.33:5432</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Replica</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">running</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">12</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">       </span><span style="color:#6F42C1;">0.0</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#6F42C1;">+--------+---------------------+---------+---------+----+-----------+</span></span>
<span class="line"><span style="color:#6F42C1;">Are</span><span style="color:#24292E;"> </span><span style="color:#032F62;">you</span><span style="color:#24292E;"> </span><span style="color:#032F62;">sure</span><span style="color:#24292E;"> </span><span style="color:#032F62;">you</span><span style="color:#24292E;"> </span><span style="color:#032F62;">want</span><span style="color:#24292E;"> </span><span style="color:#032F62;">to</span><span style="color:#24292E;"> </span><span style="color:#032F62;">failover</span><span style="color:#24292E;"> </span><span style="color:#032F62;">cluster</span><span style="color:#24292E;"> </span><span style="color:#032F62;">twpg,</span><span style="color:#24292E;"> </span><span style="color:#032F62;">demoting</span><span style="color:#24292E;"> </span><span style="color:#032F62;">current</span><span style="color:#24292E;"> </span><span style="color:#032F62;">master</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg2?</span><span style="color:#24292E;"> [y/N]: y</span></span>
<span class="line"><span style="color:#6F42C1;">2021-06-23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">15</span><span style="color:#032F62;">:17:33.25244</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Successfully</span><span style="color:#24292E;"> </span><span style="color:#032F62;">failed</span><span style="color:#24292E;"> </span><span style="color:#032F62;">over</span><span style="color:#24292E;"> </span><span style="color:#032F62;">to</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;pg1&quot;</span></span>
<span class="line"><span style="color:#6F42C1;">+</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Cluster:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">twpg</span><span style="color:#24292E;"> (6976142033405049133) ---+---------+----+-----------+</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Member</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Host</span><span style="color:#24292E;">                </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Role</span><span style="color:#24292E;">    </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">State</span><span style="color:#24292E;">   </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">TL</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Lag</span><span style="color:#24292E;"> </span><span style="color:#032F62;">in</span><span style="color:#24292E;"> </span><span style="color:#032F62;">MB</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#6F42C1;">+--------+---------------------+---------+---------+----+-----------+</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">pg1</span><span style="color:#24292E;">    </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">192.168.210.15:5432</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Leader</span><span style="color:#24292E;">  </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">running</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">12</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">           </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">pg2</span><span style="color:#24292E;">    </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">192.168.210.81:5432</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Replica</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">stopped</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">    </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">   </span><span style="color:#6F42C1;">unknown</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">pg3</span><span style="color:#24292E;">    </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">192.168.210.33:5432</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Replica</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">running</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">12</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">       </span><span style="color:#6F42C1;">0.0</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#6F42C1;">+--------+---------------------+---------+---------+----+-----------+</span></span>
<span class="line"><span style="color:#24292E;">[root@pg_node1 </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# patronictl list</span></span>
<span class="line"><span style="color:#6F42C1;">+</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Cluster:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">twpg</span><span style="color:#24292E;"> (6976142033405049133) ---+---------+----+-----------+</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Member</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Host</span><span style="color:#24292E;">                </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Role</span><span style="color:#24292E;">    </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">State</span><span style="color:#24292E;">   </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">TL</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Lag</span><span style="color:#24292E;"> </span><span style="color:#032F62;">in</span><span style="color:#24292E;"> </span><span style="color:#032F62;">MB</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#6F42C1;">+--------+---------------------+---------+---------+----+-----------+</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">pg1</span><span style="color:#24292E;">    </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">192.168.210.15:5432</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Leader</span><span style="color:#24292E;">  </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">running</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">13</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">           </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">pg2</span><span style="color:#24292E;">    </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">192.168.210.81:5432</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Replica</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">stopped</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">    </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">   </span><span style="color:#6F42C1;">unknown</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">pg3</span><span style="color:#24292E;">    </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">192.168.210.33:5432</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Replica</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">running</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">13</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">       </span><span style="color:#6F42C1;">0.0</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#6F42C1;">+--------+---------------------+---------+---------+----+-----------+</span></span>
<span class="line"><span style="color:#24292E;">[root@pg_node1 </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# patronictl list</span></span>
<span class="line"><span style="color:#6F42C1;">+</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Cluster:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">twpg</span><span style="color:#24292E;"> (6976142033405049133) ---+---------+----+-----------+</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Member</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Host</span><span style="color:#24292E;">                </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Role</span><span style="color:#24292E;">    </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">State</span><span style="color:#24292E;">   </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">TL</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Lag</span><span style="color:#24292E;"> </span><span style="color:#032F62;">in</span><span style="color:#24292E;"> </span><span style="color:#032F62;">MB</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#6F42C1;">+--------+---------------------+---------+---------+----+-----------+</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">pg1</span><span style="color:#24292E;">    </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">192.168.210.15:5432</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Leader</span><span style="color:#24292E;">  </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">running</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">13</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">           </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">pg2</span><span style="color:#24292E;">    </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">192.168.210.81:5432</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Replica</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">running</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">13</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">       </span><span style="color:#6F42C1;">0.0</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">pg3</span><span style="color:#24292E;">    </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">192.168.210.33:5432</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Replica</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">running</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">13</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">       </span><span style="color:#6F42C1;">0.0</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#6F42C1;">+--------+---------------------+---------+---------+----+-----------+</span></span>
<span class="line"><span style="color:#6A737D;">#日志信息如下：</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">15</span><span style="color:#032F62;">:17:27</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2021</span><span style="color:#032F62;">-06-23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">15</span><span style="color:#032F62;">:17:27,609</span><span style="color:#24292E;"> </span><span style="color:#032F62;">INFO:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Lock</span><span style="color:#24292E;"> </span><span style="color:#032F62;">owner:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg2</span><span style="color:#24292E;">; </span><span style="color:#6F42C1;">I</span><span style="color:#24292E;"> </span><span style="color:#032F62;">am</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg1</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">15</span><span style="color:#032F62;">:17:27</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2021</span><span style="color:#032F62;">-06-23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">15</span><span style="color:#032F62;">:17:27,609</span><span style="color:#24292E;"> </span><span style="color:#032F62;">INFO:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">does</span><span style="color:#24292E;"> </span><span style="color:#032F62;">not</span><span style="color:#24292E;"> </span><span style="color:#032F62;">have</span><span style="color:#24292E;"> </span><span style="color:#032F62;">lock</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">15</span><span style="color:#032F62;">:17:27</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2021</span><span style="color:#032F62;">-06-23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">15</span><span style="color:#032F62;">:17:27,612</span><span style="color:#24292E;"> </span><span style="color:#032F62;">INFO:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">no</span><span style="color:#24292E;"> </span><span style="color:#032F62;">action.</span><span style="color:#24292E;">  </span><span style="color:#032F62;">i</span><span style="color:#24292E;"> </span><span style="color:#032F62;">am</span><span style="color:#24292E;"> </span><span style="color:#032F62;">a</span><span style="color:#24292E;"> </span><span style="color:#032F62;">secondary</span><span style="color:#24292E;"> </span><span style="color:#032F62;">and</span><span style="color:#24292E;"> </span><span style="color:#032F62;">i</span><span style="color:#24292E;"> </span><span style="color:#032F62;">am</span><span style="color:#24292E;"> </span><span style="color:#032F62;">following</span><span style="color:#24292E;"> </span><span style="color:#032F62;">a</span><span style="color:#24292E;"> </span><span style="color:#032F62;">leader</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">15</span><span style="color:#032F62;">:17:31</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2021</span><span style="color:#032F62;">-06-23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">15</span><span style="color:#032F62;">:17:31.544</span><span style="color:#24292E;"> </span><span style="color:#032F62;">CST</span><span style="color:#24292E;"> [4745] LOG:  replication terminated by primary server</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">15</span><span style="color:#032F62;">:17:31</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2021</span><span style="color:#032F62;">-06-23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">15</span><span style="color:#032F62;">:17:31.544</span><span style="color:#24292E;"> </span><span style="color:#032F62;">CST</span><span style="color:#24292E;"> [4745] DETAIL:  End of WAL reached on timeline 12 at 0/504A428.</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">15</span><span style="color:#032F62;">:17:31</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2021</span><span style="color:#032F62;">-06-23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">15</span><span style="color:#032F62;">:17:31.544</span><span style="color:#24292E;"> </span><span style="color:#032F62;">CST</span><span style="color:#24292E;"> [4745] FATAL:  could not send end-of-streaming message to primary: no COPY </span><span style="color:#D73A49;">in</span><span style="color:#24292E;"> progress</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">15</span><span style="color:#032F62;">:17:31</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2021</span><span style="color:#032F62;">-06-23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">15</span><span style="color:#032F62;">:17:31.545</span><span style="color:#24292E;"> </span><span style="color:#032F62;">CST</span><span style="color:#24292E;"> [4741] LOG:  invalid record length at 0/504A428: wanted 24, got 0</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">15</span><span style="color:#032F62;">:17:31</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2021</span><span style="color:#032F62;">-06-23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">15</span><span style="color:#032F62;">:17:31.550</span><span style="color:#24292E;"> </span><span style="color:#032F62;">CST</span><span style="color:#24292E;"> [4810] FATAL:  could not connect to the primary server: could not connect to server: Connection refused</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">15</span><span style="color:#032F62;">:17:31</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Is</span><span style="color:#24292E;"> </span><span style="color:#032F62;">the</span><span style="color:#24292E;"> </span><span style="color:#032F62;">server</span><span style="color:#24292E;"> </span><span style="color:#032F62;">running</span><span style="color:#24292E;"> </span><span style="color:#032F62;">on</span><span style="color:#24292E;"> </span><span style="color:#032F62;">host</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;192.168.210.81&quot;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">and</span><span style="color:#24292E;"> </span><span style="color:#032F62;">accepting</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">15</span><span style="color:#032F62;">:17:31</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">TCP/IP</span><span style="color:#24292E;"> </span><span style="color:#032F62;">connections</span><span style="color:#24292E;"> </span><span style="color:#032F62;">on</span><span style="color:#24292E;"> </span><span style="color:#032F62;">port</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5432</span><span style="color:#032F62;">?</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">15</span><span style="color:#032F62;">:17:32</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2021</span><span style="color:#032F62;">-06-23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">15</span><span style="color:#032F62;">:17:32,556</span><span style="color:#24292E;"> </span><span style="color:#032F62;">INFO:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Cleaning</span><span style="color:#24292E;"> </span><span style="color:#032F62;">up</span><span style="color:#24292E;"> </span><span style="color:#032F62;">failover</span><span style="color:#24292E;"> </span><span style="color:#032F62;">key</span><span style="color:#24292E;"> </span><span style="color:#032F62;">after</span><span style="color:#24292E;"> </span><span style="color:#032F62;">acquiring</span><span style="color:#24292E;"> </span><span style="color:#032F62;">leader</span><span style="color:#24292E;"> </span><span style="color:#032F62;">lock...</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">15</span><span style="color:#032F62;">:17:32</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2021</span><span style="color:#032F62;">-06-23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">15</span><span style="color:#032F62;">:17:32,565</span><span style="color:#24292E;"> </span><span style="color:#032F62;">INFO:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Software</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Watchdog</span><span style="color:#24292E;"> </span><span style="color:#032F62;">activated</span><span style="color:#24292E;"> </span><span style="color:#032F62;">with</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">25</span><span style="color:#24292E;"> </span><span style="color:#032F62;">second</span><span style="color:#24292E;"> </span><span style="color:#032F62;">timeout,</span><span style="color:#24292E;"> </span><span style="color:#032F62;">timing</span><span style="color:#24292E;"> </span><span style="color:#032F62;">slack</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">15</span><span style="color:#24292E;"> </span><span style="color:#032F62;">seconds</span><span style="color:#24292E;"> </span><span style="color:#6A737D;">#激活看门狗</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">15</span><span style="color:#032F62;">:17:32</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2021</span><span style="color:#032F62;">-06-23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">15</span><span style="color:#032F62;">:17:32,577</span><span style="color:#24292E;"> </span><span style="color:#032F62;">INFO:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">promoted</span><span style="color:#24292E;"> </span><span style="color:#032F62;">self</span><span style="color:#24292E;"> </span><span style="color:#032F62;">to</span><span style="color:#24292E;"> </span><span style="color:#032F62;">leader</span><span style="color:#24292E;"> </span><span style="color:#032F62;">by</span><span style="color:#24292E;"> </span><span style="color:#032F62;">acquiring</span><span style="color:#24292E;"> </span><span style="color:#032F62;">session</span><span style="color:#24292E;"> </span><span style="color:#032F62;">lock</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">15</span><span style="color:#032F62;">:17:32</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">server</span><span style="color:#24292E;"> </span><span style="color:#032F62;">promoting</span><span style="color:#24292E;">  </span><span style="color:#6A737D;">#数据库提升</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">15</span><span style="color:#032F62;">:17:32</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2021</span><span style="color:#032F62;">-06-23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">15</span><span style="color:#032F62;">:17:32,579</span><span style="color:#24292E;"> </span><span style="color:#032F62;">INFO:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Lock</span><span style="color:#24292E;"> </span><span style="color:#032F62;">owner:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg1</span><span style="color:#24292E;">; </span><span style="color:#6F42C1;">I</span><span style="color:#24292E;"> </span><span style="color:#032F62;">am</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg1</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">15</span><span style="color:#032F62;">:17:32</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2021</span><span style="color:#032F62;">-06-23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">15</span><span style="color:#032F62;">:17:32.589</span><span style="color:#24292E;"> </span><span style="color:#032F62;">CST</span><span style="color:#24292E;"> [4741] LOG:  received promote request</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">15</span><span style="color:#032F62;">:17:32</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2021</span><span style="color:#032F62;">-06-23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">15</span><span style="color:#032F62;">:17:32.589</span><span style="color:#24292E;"> </span><span style="color:#032F62;">CST</span><span style="color:#24292E;"> [4741] LOG:  redo </span><span style="color:#D73A49;">done</span><span style="color:#24292E;"> at 0/504A3B0</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">15</span><span style="color:#032F62;">:17:32</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2021</span><span style="color:#032F62;">-06-23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">15</span><span style="color:#032F62;">:17:32,593</span><span style="color:#24292E;"> </span><span style="color:#032F62;">INFO:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">cleared</span><span style="color:#24292E;"> </span><span style="color:#032F62;">rewind</span><span style="color:#24292E;"> </span><span style="color:#032F62;">state</span><span style="color:#24292E;"> </span><span style="color:#032F62;">after</span><span style="color:#24292E;"> </span><span style="color:#032F62;">becoming</span><span style="color:#24292E;"> </span><span style="color:#032F62;">the</span><span style="color:#24292E;"> </span><span style="color:#032F62;">leader</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">15</span><span style="color:#032F62;">:17:32</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2021</span><span style="color:#032F62;">-06-23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">15</span><span style="color:#032F62;">:17:32.594</span><span style="color:#24292E;"> </span><span style="color:#032F62;">CST</span><span style="color:#24292E;"> [4741] LOG:  selected new timeline ID: 13</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">15</span><span style="color:#032F62;">:17:32</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">this</span><span style="color:#24292E;"> </span><span style="color:#032F62;">is</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni</span><span style="color:#24292E;"> </span><span style="color:#032F62;">callback</span><span style="color:#24292E;"> </span><span style="color:#032F62;">on_role_change</span><span style="color:#24292E;"> </span><span style="color:#032F62;">master</span><span style="color:#24292E;"> </span><span style="color:#032F62;">twpg</span><span style="color:#24292E;"> </span><span style="color:#6A737D;">#回调VIP漂移脚本</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">15</span><span style="color:#032F62;">:17:32</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2021</span><span style="color:#032F62;">-06-23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">15</span><span style="color:#032F62;">:17:32,611</span><span style="color:#24292E;"> </span><span style="color:#032F62;">INFO:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">updated</span><span style="color:#24292E;"> </span><span style="color:#032F62;">leader</span><span style="color:#24292E;"> </span><span style="color:#032F62;">lock</span><span style="color:#24292E;"> </span><span style="color:#032F62;">during</span><span style="color:#24292E;"> </span><span style="color:#032F62;">promote</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">15</span><span style="color:#032F62;">:17:32</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">systemd:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Started</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Session</span><span style="color:#24292E;"> </span><span style="color:#032F62;">c7</span><span style="color:#24292E;"> </span><span style="color:#032F62;">of</span><span style="color:#24292E;"> </span><span style="color:#032F62;">user</span><span style="color:#24292E;"> </span><span style="color:#032F62;">root.</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">15</span><span style="color:#032F62;">:17:32</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">systemd:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Started</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Session</span><span style="color:#24292E;"> </span><span style="color:#032F62;">c8</span><span style="color:#24292E;"> </span><span style="color:#032F62;">of</span><span style="color:#24292E;"> </span><span style="color:#032F62;">user</span><span style="color:#24292E;"> </span><span style="color:#032F62;">root.</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">15</span><span style="color:#032F62;">:17:32</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2021</span><span style="color:#032F62;">-06-23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">15</span><span style="color:#032F62;">:17:32.837</span><span style="color:#24292E;"> </span><span style="color:#032F62;">CST</span><span style="color:#24292E;"> [4741] LOG:  archive recovery complete</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">15</span><span style="color:#032F62;">:17:32</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2021</span><span style="color:#032F62;">-06-23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">15</span><span style="color:#032F62;">:17:32.869</span><span style="color:#24292E;"> </span><span style="color:#032F62;">CST</span><span style="color:#24292E;"> [4739] LOG:  database system is ready to accept connections</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">15</span><span style="color:#032F62;">:17:33</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2021</span><span style="color:#032F62;">-06-23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">15</span><span style="color:#032F62;">:17:33,631</span><span style="color:#24292E;"> </span><span style="color:#032F62;">INFO:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Lock</span><span style="color:#24292E;"> </span><span style="color:#032F62;">owner:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg1</span><span style="color:#24292E;">; </span><span style="color:#6F42C1;">I</span><span style="color:#24292E;"> </span><span style="color:#032F62;">am</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg1</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">15</span><span style="color:#032F62;">:17:33</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2021</span><span style="color:#032F62;">-06-23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">15</span><span style="color:#032F62;">:17:33,772</span><span style="color:#24292E;"> </span><span style="color:#032F62;">INFO:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">no</span><span style="color:#24292E;"> </span><span style="color:#032F62;">action.</span><span style="color:#24292E;">  </span><span style="color:#032F62;">i</span><span style="color:#24292E;"> </span><span style="color:#032F62;">am</span><span style="color:#24292E;"> </span><span style="color:#032F62;">the</span><span style="color:#24292E;"> </span><span style="color:#032F62;">leader</span><span style="color:#24292E;"> </span><span style="color:#032F62;">with</span><span style="color:#24292E;"> </span><span style="color:#032F62;">the</span><span style="color:#24292E;"> </span><span style="color:#032F62;">lock</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#查看集群参数</span></span>
<span class="line"><span style="color:#24292E;">[root@pg_node1 </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# patronictl show-config</span></span>
<span class="line"><span style="color:#6F42C1;">loop_wait:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">10</span></span>
<span class="line"><span style="color:#6F42C1;">master_start_timeout:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">300</span></span>
<span class="line"><span style="color:#6F42C1;">maximum_lag_on_failover:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1048576</span></span>
<span class="line"><span style="color:#6F42C1;">postgresql:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">parameters:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">hot_standby:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;on&#39;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">listen_addresses:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0.0</span><span style="color:#032F62;">.0.0</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">max_replication_slots:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">10</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">max_wal_senders:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">10</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">port:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5432</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">wal_keep_segments:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">256</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">wal_level:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">replica</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">wal_log_hints:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;on&#39;</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">use_pg_rewind:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">true</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">use_slots:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">true</span></span>
<span class="line"><span style="color:#6F42C1;">retry_timeout:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">10</span></span>
<span class="line"><span style="color:#6F42C1;">synchronous_mode:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">false</span></span>
<span class="line"><span style="color:#6F42C1;">ttl:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">30</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#修改PG参数</span></span>
<span class="line"><span style="color:#6A737D;">#例如修改shared_buffers: 1GB</span></span>
<span class="line"><span style="color:#24292E;">[root@pg_node1 </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# patronictl edit-config twpg</span></span>
<span class="line"><span style="color:#6F42C1;">---</span><span style="color:#24292E;"> </span></span>
<span class="line"><span style="color:#6F42C1;">+++</span><span style="color:#24292E;"> </span></span>
<span class="line"><span style="color:#6F42C1;">@@</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-4,6</span><span style="color:#24292E;"> </span><span style="color:#032F62;">+4,7</span><span style="color:#24292E;"> </span><span style="color:#032F62;">@@</span></span>
<span class="line"><span style="color:#24292E;"> </span><span style="color:#6F42C1;">postgresql:</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#6F42C1;">parameters:</span></span>
<span class="line"><span style="color:#24292E;">     </span><span style="color:#6F42C1;">hot_standby:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;on&#39;</span></span>
<span class="line"><span style="color:#6F42C1;">+</span><span style="color:#24292E;">    </span><span style="color:#032F62;">shared_buffers:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;1GB&#39;</span></span>
<span class="line"><span style="color:#24292E;">     </span><span style="color:#6F42C1;">listen_addresses:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0.0</span><span style="color:#032F62;">.0.0</span></span>
<span class="line"><span style="color:#24292E;">     </span><span style="color:#6F42C1;">max_replication_slots:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">10</span></span>
<span class="line"><span style="color:#24292E;">     </span><span style="color:#6F42C1;">max_wal_senders:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">10</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">Apply</span><span style="color:#24292E;"> </span><span style="color:#032F62;">these</span><span style="color:#24292E;"> </span><span style="color:#032F62;">changes?</span><span style="color:#24292E;"> [y/N]: y</span></span>
<span class="line"><span style="color:#6F42C1;">Configuration</span><span style="color:#24292E;"> </span><span style="color:#032F62;">changed</span></span>
<span class="line"><span style="color:#24292E;">[root@pg_node1 </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# patronictl restart twpg</span></span>
<span class="line"><span style="color:#6F42C1;">+</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Cluster:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">twpg</span><span style="color:#24292E;"> (6976142033405049133) ---+---------+----+-----------+-----------------+</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Member</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Host</span><span style="color:#24292E;">                </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Role</span><span style="color:#24292E;">    </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">State</span><span style="color:#24292E;">   </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">TL</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Lag</span><span style="color:#24292E;"> </span><span style="color:#032F62;">in</span><span style="color:#24292E;"> </span><span style="color:#032F62;">MB</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Pending</span><span style="color:#24292E;"> </span><span style="color:#032F62;">restart</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#6F42C1;">+--------+---------------------+---------+---------+----+-----------+-----------------+</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">pg1</span><span style="color:#24292E;">    </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">192.168.210.15:5432</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Leader</span><span style="color:#24292E;">  </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">running</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">13</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">           </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">*</span><span style="color:#24292E;">               </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">pg2</span><span style="color:#24292E;">    </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">192.168.210.81:5432</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Replica</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">running</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">13</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">       </span><span style="color:#6F42C1;">0.0</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">*</span><span style="color:#24292E;">               </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">pg3</span><span style="color:#24292E;">    </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">192.168.210.33:5432</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Replica</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">running</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">13</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">       </span><span style="color:#6F42C1;">0.0</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">*</span><span style="color:#24292E;">               </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#6F42C1;">+--------+---------------------+---------+---------+----+-----------+-----------------+</span></span>
<span class="line"><span style="color:#6F42C1;">When</span><span style="color:#24292E;"> </span><span style="color:#032F62;">should</span><span style="color:#24292E;"> </span><span style="color:#032F62;">the</span><span style="color:#24292E;"> </span><span style="color:#032F62;">restart</span><span style="color:#24292E;"> </span><span style="color:#032F62;">take</span><span style="color:#24292E;"> </span><span style="color:#032F62;">place</span><span style="color:#24292E;"> (e.g. </span><span style="color:#005CC5;">2021</span><span style="color:#032F62;">-06-23T16:45</span><span style="color:#24292E;">)  [now]: </span></span>
<span class="line"><span style="color:#6F42C1;">Are</span><span style="color:#24292E;"> </span><span style="color:#032F62;">you</span><span style="color:#24292E;"> </span><span style="color:#032F62;">sure</span><span style="color:#24292E;"> </span><span style="color:#032F62;">you</span><span style="color:#24292E;"> </span><span style="color:#032F62;">want</span><span style="color:#24292E;"> </span><span style="color:#032F62;">to</span><span style="color:#24292E;"> </span><span style="color:#032F62;">restart</span><span style="color:#24292E;"> </span><span style="color:#032F62;">members</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg2,</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg3,</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg1?</span><span style="color:#24292E;"> [y/N]: y</span></span>
<span class="line"><span style="color:#6F42C1;">Restart</span><span style="color:#24292E;"> </span><span style="color:#032F62;">if</span><span style="color:#24292E;"> </span><span style="color:#032F62;">the</span><span style="color:#24292E;"> </span><span style="color:#032F62;">PostgreSQL</span><span style="color:#24292E;"> </span><span style="color:#032F62;">version</span><span style="color:#24292E;"> </span><span style="color:#032F62;">is</span><span style="color:#24292E;"> </span><span style="color:#032F62;">less</span><span style="color:#24292E;"> </span><span style="color:#032F62;">than</span><span style="color:#24292E;"> </span><span style="color:#032F62;">provided</span><span style="color:#24292E;"> (e.g. </span><span style="color:#005CC5;">9.5</span><span style="color:#032F62;">.2</span><span style="color:#24292E;">)  []: </span></span>
<span class="line"><span style="color:#6F42C1;">Success:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">restart</span><span style="color:#24292E;"> </span><span style="color:#032F62;">on</span><span style="color:#24292E;"> </span><span style="color:#032F62;">member</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg2</span></span>
<span class="line"><span style="color:#6F42C1;">Success:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">restart</span><span style="color:#24292E;"> </span><span style="color:#032F62;">on</span><span style="color:#24292E;"> </span><span style="color:#032F62;">member</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg3</span></span>
<span class="line"><span style="color:#6F42C1;">Success:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">restart</span><span style="color:#24292E;"> </span><span style="color:#032F62;">on</span><span style="color:#24292E;"> </span><span style="color:#032F62;">member</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg1</span></span>
<span class="line"><span style="color:#24292E;">[root@pg_node2 </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# psql -U twsm -d postgres -c </span><span style="color:#032F62;">&#39;show shared_buffers;&#39;</span></span>
<span class="line"><span style="color:#24292E;"> </span><span style="color:#6F42C1;">shared_buffers</span><span style="color:#24292E;"> </span></span>
<span class="line"><span style="color:#6F42C1;">----------------</span></span>
<span class="line"><span style="color:#24292E;"> </span><span style="color:#6F42C1;">1GB</span></span>
<span class="line"><span style="color:#24292E;">(</span><span style="color:#6F42C1;">1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">row</span><span style="color:#24292E;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#或者通过REST API修改，例如：max_connections修改为1000</span></span>
<span class="line"><span style="color:#6F42C1;">curl</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-s</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-XPATCH</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-d</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;{&quot;postgresql&quot;:{&quot;parameters&quot;:{&quot;max_connections&quot;:&quot;1000&quot;}}}&#39;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">http://localhost:8008/config</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">jq</span><span style="color:#24292E;"> </span><span style="color:#032F62;">.</span></span>
<span class="line"><span style="color:#6A737D;">#如果想reset或是删除</span></span>
<span class="line"><span style="color:#6F42C1;">curl</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-s</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-XPATCH</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-d</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;{&quot;postgresql&quot;:{&quot;parameters&quot;:{&quot;max_connections&quot;:null}}}&#39;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">http://localhost:8008/config</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">jq</span><span style="color:#24292E;"> </span><span style="color:#032F62;">.</span></span>
<span class="line"><span style="color:#6A737D;">#修改max_connections需要重启（Pending restart）</span></span>
<span class="line"><span style="color:#24292E;">[root@pg_node1 </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# patronictl list</span></span>
<span class="line"><span style="color:#6F42C1;">+</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Cluster:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">twpg</span><span style="color:#24292E;"> (6976142033405049133) ---+---------+----+-----------+-----------------+</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Member</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Host</span><span style="color:#24292E;">                </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Role</span><span style="color:#24292E;">    </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">State</span><span style="color:#24292E;">   </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">TL</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Lag</span><span style="color:#24292E;"> </span><span style="color:#032F62;">in</span><span style="color:#24292E;"> </span><span style="color:#032F62;">MB</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Pending</span><span style="color:#24292E;"> </span><span style="color:#032F62;">restart</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#6F42C1;">+--------+---------------------+---------+---------+----+-----------+-----------------+</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">pg1</span><span style="color:#24292E;">    </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">192.168.210.15:5432</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Replica</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">running</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">14</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">       </span><span style="color:#6F42C1;">0.0</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">*</span><span style="color:#24292E;">               </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">pg2</span><span style="color:#24292E;">    </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">192.168.210.81:5432</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Replica</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">running</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">14</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">       </span><span style="color:#6F42C1;">0.0</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">*</span><span style="color:#24292E;">               </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">pg3</span><span style="color:#24292E;">    </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">192.168.210.33:5432</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Leader</span><span style="color:#24292E;">  </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">running</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">14</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">           </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">*</span><span style="color:#24292E;">               </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#6F42C1;">+--------+---------------------+---------+---------+----+-----------+-----------------+</span></span>
<span class="line"><span style="color:#6A737D;">#如果想无条件地完全重写现有的动态配置</span></span>
<span class="line"><span style="color:#6F42C1;">curl</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-s</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-XPUT</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-d</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;{&quot;maximum_lag_on_failover&quot;:1048576,&quot;retry_timeout&quot;:10,&quot;postgresql&quot;:{&quot;use_slots&quot;:true,&quot;use_pg_rewind&quot;:true,&quot;parameters&quot;:{&quot;hot_standby&quot;:&quot;on&quot;,&quot;wal_log_hints&quot;:&quot;on&quot;,&quot;wal_level&quot;:&quot;hot_standby&quot;,&quot;unix_socket_directories&quot;:&quot;.&quot;,&quot;max_wal_senders&quot;:5}},&quot;loop_wait&quot;:3,&quot;ttl&quot;:20}&#39;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">http://localhost:8008/config</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">jq</span><span style="color:#24292E;"> </span><span style="color:#032F62;">.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#查看历史failovers/switchovers</span></span>
<span class="line"><span style="color:#24292E;">[root@pg_node1 </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# patronictl history</span></span>
<span class="line"><span style="color:#6F42C1;">+----+----------+------------------------------+----------------------------------+</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">TL</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">      </span><span style="color:#6F42C1;">LSN</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Reason</span><span style="color:#24292E;">                       </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Timestamp</span><span style="color:#24292E;">                        </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#6F42C1;">+----+----------+------------------------------+----------------------------------+</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;">  </span><span style="color:#6F42C1;">1</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">25210568</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">no</span><span style="color:#24292E;"> </span><span style="color:#032F62;">recovery</span><span style="color:#24292E;"> </span><span style="color:#032F62;">target</span><span style="color:#24292E;"> </span><span style="color:#032F62;">specified</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">2021-06-21T15:24:42.878129+08:00</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;">  </span><span style="color:#6F42C1;">2</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">25211144</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">no</span><span style="color:#24292E;"> </span><span style="color:#032F62;">recovery</span><span style="color:#24292E;"> </span><span style="color:#032F62;">target</span><span style="color:#24292E;"> </span><span style="color:#032F62;">specified</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">2021-06-21T15:33:23.462860+08:00</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;">  </span><span style="color:#6F42C1;">3</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">83886408</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">no</span><span style="color:#24292E;"> </span><span style="color:#032F62;">recovery</span><span style="color:#24292E;"> </span><span style="color:#032F62;">target</span><span style="color:#24292E;"> </span><span style="color:#032F62;">specified</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">2021-06-23T09:28:25.304246+08:00</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;">  </span><span style="color:#6F42C1;">4</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">83886920</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">no</span><span style="color:#24292E;"> </span><span style="color:#032F62;">recovery</span><span style="color:#24292E;"> </span><span style="color:#032F62;">target</span><span style="color:#24292E;"> </span><span style="color:#032F62;">specified</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">2021-06-23T09:35:14.536083+08:00</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;">  </span><span style="color:#6F42C1;">5</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">83887496</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">no</span><span style="color:#24292E;"> </span><span style="color:#032F62;">recovery</span><span style="color:#24292E;"> </span><span style="color:#032F62;">target</span><span style="color:#24292E;"> </span><span style="color:#032F62;">specified</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">2021-06-23T09:37:56.880226+08:00</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;">  </span><span style="color:#6F42C1;">6</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">83888072</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">no</span><span style="color:#24292E;"> </span><span style="color:#032F62;">recovery</span><span style="color:#24292E;"> </span><span style="color:#032F62;">target</span><span style="color:#24292E;"> </span><span style="color:#032F62;">specified</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">2021-06-23T09:59:13.584445+08:00</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;">  </span><span style="color:#6F42C1;">7</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">83888704</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">no</span><span style="color:#24292E;"> </span><span style="color:#032F62;">recovery</span><span style="color:#24292E;"> </span><span style="color:#032F62;">target</span><span style="color:#24292E;"> </span><span style="color:#032F62;">specified</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">2021-06-23T12:39:14.897591+08:00</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;">  </span><span style="color:#6F42C1;">8</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">83970888</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">no</span><span style="color:#24292E;"> </span><span style="color:#032F62;">recovery</span><span style="color:#24292E;"> </span><span style="color:#032F62;">target</span><span style="color:#24292E;"> </span><span style="color:#032F62;">specified</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">2021-06-23T13:55:26.207367+08:00</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;">  </span><span style="color:#6F42C1;">9</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">84069608</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">no</span><span style="color:#24292E;"> </span><span style="color:#032F62;">recovery</span><span style="color:#24292E;"> </span><span style="color:#032F62;">target</span><span style="color:#24292E;"> </span><span style="color:#032F62;">specified</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">2021-06-23T14:24:48.030224+08:00</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">10</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">84183704</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">no</span><span style="color:#24292E;"> </span><span style="color:#032F62;">recovery</span><span style="color:#24292E;"> </span><span style="color:#032F62;">target</span><span style="color:#24292E;"> </span><span style="color:#032F62;">specified</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">2021-06-23T14:41:45.263156+08:00</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">11</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">84187080</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">no</span><span style="color:#24292E;"> </span><span style="color:#032F62;">recovery</span><span style="color:#24292E;"> </span><span style="color:#032F62;">target</span><span style="color:#24292E;"> </span><span style="color:#032F62;">specified</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">2021-06-23T15:13:26.627326+08:00</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">12</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">84190248</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">no</span><span style="color:#24292E;"> </span><span style="color:#032F62;">recovery</span><span style="color:#24292E;"> </span><span style="color:#032F62;">target</span><span style="color:#24292E;"> </span><span style="color:#032F62;">specified</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">2021-06-23T15:17:32.836962+08:00</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#6F42C1;">+----+----------+------------------------------+----------------------------------+</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#集群进入维护模式，防止自动故障转移</span></span>
<span class="line"><span style="color:#6F42C1;">+----+----------+------------------------------+----------------------------------+</span></span>
<span class="line"><span style="color:#24292E;">[root@pg_node1 </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# patronictl pause</span></span>
<span class="line"><span style="color:#6F42C1;">Success:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">cluster</span><span style="color:#24292E;"> </span><span style="color:#032F62;">management</span><span style="color:#24292E;"> </span><span style="color:#032F62;">is</span><span style="color:#24292E;"> </span><span style="color:#032F62;">paused</span></span>
<span class="line"><span style="color:#24292E;">[root@pg_node1 </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# patronictl list</span></span>
<span class="line"><span style="color:#6F42C1;">+</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Cluster:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">twpg</span><span style="color:#24292E;"> (6976142033405049133) ---+---------+----+-----------+</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Member</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Host</span><span style="color:#24292E;">                </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Role</span><span style="color:#24292E;">    </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">State</span><span style="color:#24292E;">   </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">TL</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Lag</span><span style="color:#24292E;"> </span><span style="color:#032F62;">in</span><span style="color:#24292E;"> </span><span style="color:#032F62;">MB</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#6F42C1;">+--------+---------------------+---------+---------+----+-----------+</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">pg1</span><span style="color:#24292E;">    </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">192.168.210.15:5432</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Leader</span><span style="color:#24292E;">  </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">running</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">13</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">           </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">pg2</span><span style="color:#24292E;">    </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">192.168.210.81:5432</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Replica</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">running</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">13</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">       </span><span style="color:#6F42C1;">0.0</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">pg3</span><span style="color:#24292E;">    </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">192.168.210.33:5432</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Replica</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">running</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">13</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">       </span><span style="color:#6F42C1;">0.0</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#6F42C1;">+--------+---------------------+---------+---------+----+-----------+</span></span>
<span class="line"><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Maintenance</span><span style="color:#24292E;"> </span><span style="color:#032F62;">mode:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">on</span></span>
<span class="line"><span style="color:#6A737D;">#日志信息：</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">16</span><span style="color:#032F62;">:00:02</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2021</span><span style="color:#032F62;">-06-23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">16</span><span style="color:#032F62;">:00:02,006</span><span style="color:#24292E;"> </span><span style="color:#032F62;">INFO:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Lock</span><span style="color:#24292E;"> </span><span style="color:#032F62;">owner:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg1</span><span style="color:#24292E;">; </span><span style="color:#6F42C1;">I</span><span style="color:#24292E;"> </span><span style="color:#032F62;">am</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg1</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">16</span><span style="color:#032F62;">:00:02</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2021</span><span style="color:#032F62;">-06-23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">16</span><span style="color:#032F62;">:00:02,018</span><span style="color:#24292E;"> </span><span style="color:#032F62;">INFO:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">PAUSE:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">no</span><span style="color:#24292E;"> </span><span style="color:#032F62;">action.</span><span style="color:#24292E;">  </span><span style="color:#032F62;">i</span><span style="color:#24292E;"> </span><span style="color:#032F62;">am</span><span style="color:#24292E;"> </span><span style="color:#032F62;">the</span><span style="color:#24292E;"> </span><span style="color:#032F62;">leader</span><span style="color:#24292E;"> </span><span style="color:#032F62;">with</span><span style="color:#24292E;"> </span><span style="color:#032F62;">the</span><span style="color:#24292E;"> </span><span style="color:#032F62;">lock</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">16</span><span style="color:#032F62;">:00:02</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2021</span><span style="color:#032F62;">-06-23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">16</span><span style="color:#032F62;">:00:02,028</span><span style="color:#24292E;"> </span><span style="color:#032F62;">INFO:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">No</span><span style="color:#24292E;"> </span><span style="color:#032F62;">PostgreSQL</span><span style="color:#24292E;"> </span><span style="color:#032F62;">configuration</span><span style="color:#24292E;"> </span><span style="color:#032F62;">items</span><span style="color:#24292E;"> </span><span style="color:#032F62;">changed,</span><span style="color:#24292E;"> </span><span style="color:#032F62;">nothing</span><span style="color:#24292E;"> </span><span style="color:#032F62;">to</span><span style="color:#24292E;"> </span><span style="color:#032F62;">reload.</span></span>
<span class="line"><span style="color:#6A737D;">#维护结束，恢复自动故障转移</span></span>
<span class="line"><span style="color:#24292E;">[root@pg_node1 </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# patronictl resume</span></span>
<span class="line"><span style="color:#6F42C1;">Success:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">cluster</span><span style="color:#24292E;"> </span><span style="color:#032F62;">management</span><span style="color:#24292E;"> </span><span style="color:#032F62;">is</span><span style="color:#24292E;"> </span><span style="color:#032F62;">resumed</span></span>
<span class="line"><span style="color:#24292E;">[root@pg_node1 </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# patronictl list</span></span>
<span class="line"><span style="color:#6F42C1;">+</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Cluster:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">twpg</span><span style="color:#24292E;"> (6976142033405049133) ---+---------+----+-----------+</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Member</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Host</span><span style="color:#24292E;">                </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Role</span><span style="color:#24292E;">    </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">State</span><span style="color:#24292E;">   </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">TL</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Lag</span><span style="color:#24292E;"> </span><span style="color:#032F62;">in</span><span style="color:#24292E;"> </span><span style="color:#032F62;">MB</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#6F42C1;">+--------+---------------------+---------+---------+----+-----------+</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">pg1</span><span style="color:#24292E;">    </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">192.168.210.15:5432</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Leader</span><span style="color:#24292E;">  </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">running</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">13</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">           </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">pg2</span><span style="color:#24292E;">    </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">192.168.210.81:5432</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Replica</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">running</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">13</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">       </span><span style="color:#6F42C1;">0.0</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">pg3</span><span style="color:#24292E;">    </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">192.168.210.33:5432</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Replica</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">running</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">13</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">       </span><span style="color:#6F42C1;">0.0</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#6F42C1;">+--------+---------------------+---------+---------+----+-----------+</span></span>
<span class="line"><span style="color:#6A737D;">#日志信息：</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">16</span><span style="color:#032F62;">:02:32</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2021</span><span style="color:#032F62;">-06-23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">16</span><span style="color:#032F62;">:02:32,006</span><span style="color:#24292E;"> </span><span style="color:#032F62;">INFO:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Lock</span><span style="color:#24292E;"> </span><span style="color:#032F62;">owner:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg1</span><span style="color:#24292E;">; </span><span style="color:#6F42C1;">I</span><span style="color:#24292E;"> </span><span style="color:#032F62;">am</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg1</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">16</span><span style="color:#032F62;">:02:32</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2021</span><span style="color:#032F62;">-06-23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">16</span><span style="color:#032F62;">:02:32,012</span><span style="color:#24292E;"> </span><span style="color:#032F62;">INFO:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">PAUSE:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">no</span><span style="color:#24292E;"> </span><span style="color:#032F62;">action.</span><span style="color:#24292E;">  </span><span style="color:#032F62;">i</span><span style="color:#24292E;"> </span><span style="color:#032F62;">am</span><span style="color:#24292E;"> </span><span style="color:#032F62;">the</span><span style="color:#24292E;"> </span><span style="color:#032F62;">leader</span><span style="color:#24292E;"> </span><span style="color:#032F62;">with</span><span style="color:#24292E;"> </span><span style="color:#032F62;">the</span><span style="color:#24292E;"> </span><span style="color:#032F62;">lock</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">16</span><span style="color:#032F62;">:02:39</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2021</span><span style="color:#032F62;">-06-23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">16</span><span style="color:#032F62;">:02:39,565</span><span style="color:#24292E;"> </span><span style="color:#032F62;">INFO:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Lock</span><span style="color:#24292E;"> </span><span style="color:#032F62;">owner:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg1</span><span style="color:#24292E;">; </span><span style="color:#6F42C1;">I</span><span style="color:#24292E;"> </span><span style="color:#032F62;">am</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg1</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">16</span><span style="color:#032F62;">:02:39</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2021</span><span style="color:#032F62;">-06-23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">16</span><span style="color:#032F62;">:02:39,572</span><span style="color:#24292E;"> </span><span style="color:#032F62;">INFO:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Software</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Watchdog</span><span style="color:#24292E;"> </span><span style="color:#032F62;">activated</span><span style="color:#24292E;"> </span><span style="color:#032F62;">with</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">25</span><span style="color:#24292E;"> </span><span style="color:#032F62;">second</span><span style="color:#24292E;"> </span><span style="color:#032F62;">timeout,</span><span style="color:#24292E;"> </span><span style="color:#032F62;">timing</span><span style="color:#24292E;"> </span><span style="color:#032F62;">slack</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">15</span><span style="color:#24292E;"> </span><span style="color:#032F62;">seconds</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">16</span><span style="color:#032F62;">:02:39</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2021</span><span style="color:#032F62;">-06-23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">16</span><span style="color:#032F62;">:02:39,581</span><span style="color:#24292E;"> </span><span style="color:#032F62;">INFO:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">no</span><span style="color:#24292E;"> </span><span style="color:#032F62;">action.</span><span style="color:#24292E;">  </span><span style="color:#032F62;">i</span><span style="color:#24292E;"> </span><span style="color:#032F62;">am</span><span style="color:#24292E;"> </span><span style="color:#032F62;">the</span><span style="color:#24292E;"> </span><span style="color:#032F62;">leader</span><span style="color:#24292E;"> </span><span style="color:#032F62;">with</span><span style="color:#24292E;"> </span><span style="color:#032F62;">the</span><span style="color:#24292E;"> </span><span style="color:#032F62;">lock</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">16</span><span style="color:#032F62;">:02:39</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2021</span><span style="color:#032F62;">-06-23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">16</span><span style="color:#032F62;">:02:39,588</span><span style="color:#24292E;"> </span><span style="color:#032F62;">INFO:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">No</span><span style="color:#24292E;"> </span><span style="color:#032F62;">PostgreSQL</span><span style="color:#24292E;"> </span><span style="color:#032F62;">configuration</span><span style="color:#24292E;"> </span><span style="color:#032F62;">items</span><span style="color:#24292E;"> </span><span style="color:#032F62;">changed,</span><span style="color:#24292E;"> </span><span style="color:#032F62;">nothing</span><span style="color:#24292E;"> </span><span style="color:#032F62;">to</span><span style="color:#24292E;"> </span><span style="color:#032F62;">reload.</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">16</span><span style="color:#032F62;">:02:49</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2021</span><span style="color:#032F62;">-06-23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">16</span><span style="color:#032F62;">:02:49,552</span><span style="color:#24292E;"> </span><span style="color:#032F62;">INFO:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Lock</span><span style="color:#24292E;"> </span><span style="color:#032F62;">owner:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg1</span><span style="color:#24292E;">; </span><span style="color:#6F42C1;">I</span><span style="color:#24292E;"> </span><span style="color:#032F62;">am</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg1</span></span>
<span class="line"><span style="color:#6F42C1;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">16</span><span style="color:#032F62;">:02:49</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_node1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patroni:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2021</span><span style="color:#032F62;">-06-23</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">16</span><span style="color:#032F62;">:02:49,558</span><span style="color:#24292E;"> </span><span style="color:#032F62;">INFO:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">no</span><span style="color:#24292E;"> </span><span style="color:#032F62;">action.</span><span style="color:#24292E;">  </span><span style="color:#032F62;">i</span><span style="color:#24292E;"> </span><span style="color:#032F62;">am</span><span style="color:#24292E;"> </span><span style="color:#032F62;">the</span><span style="color:#24292E;"> </span><span style="color:#032F62;">leader</span><span style="color:#24292E;"> </span><span style="color:#032F62;">with</span><span style="color:#24292E;"> </span><span style="color:#032F62;">the</span><span style="color:#24292E;"> </span><span style="color:#032F62;">lock</span></span></code></pre></div><h1 id="七、patroni的维护模式" tabindex="-1">七、<strong>Patroni的维护模式</strong> <a class="header-anchor" href="#七、patroni的维护模式" aria-label="Permalink to &quot;七、**Patroni的维护模式**&quot;">​</a></h1><p>在某一些情况下，我们需要退出集群管理，但是我们仍然想要保留Patroni与DCS的状态和通信，所以我们需要把Patroni与正在运行的集群进行“分离”，从而实现像Pacemaker一样的维护模式</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">[ptgres@master patroni_data]$ patronictl -c pg_ydtf01.yml --help</span></span>
<span class="line"><span style="color:#e1e4e8;">Usage: patronictl [OPTIONS] COMMAND [ARGS]...</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">Options:</span></span>
<span class="line"><span style="color:#e1e4e8;">  -c, --config-file TEXT  Configuration file</span></span>
<span class="line"><span style="color:#e1e4e8;">  -d, --dcs TEXT          Use this DCS</span></span>
<span class="line"><span style="color:#e1e4e8;">  -k, --insecure          Allow connections to SSL sites without certs</span></span>
<span class="line"><span style="color:#e1e4e8;">  --help                  Show this message and exit.</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">Commands:</span></span>
<span class="line"><span style="color:#e1e4e8;">  configure    Create configuration file</span></span>
<span class="line"><span style="color:#e1e4e8;">  dsn          Generate a dsn for the provided member, defaults to a dsn...</span></span>
<span class="line"><span style="color:#e1e4e8;">  edit-config  Edit cluster configuration</span></span>
<span class="line"><span style="color:#e1e4e8;">  failover     Failover to a replica</span></span>
<span class="line"><span style="color:#e1e4e8;">  flush        Discard scheduled events</span></span>
<span class="line"><span style="color:#e1e4e8;">  history      Show the history of failovers/switchovers</span></span>
<span class="line"><span style="color:#e1e4e8;">  list         List the Patroni members for a given Patroni</span></span>
<span class="line"><span style="color:#e1e4e8;">  pause        Disable auto failover</span></span>
<span class="line"><span style="color:#e1e4e8;">  query        Query a Patroni PostgreSQL member</span></span>
<span class="line"><span style="color:#e1e4e8;">  reinit       Reinitialize cluster member</span></span>
<span class="line"><span style="color:#e1e4e8;">  reload       Reload cluster member configuration</span></span>
<span class="line"><span style="color:#e1e4e8;">  remove       Remove cluster from DCS</span></span>
<span class="line"><span style="color:#e1e4e8;">  restart      Restart cluster member</span></span>
<span class="line"><span style="color:#e1e4e8;">  resume       Resume auto failover</span></span>
<span class="line"><span style="color:#e1e4e8;">  scaffold     Create a structure for the cluster in DCS</span></span>
<span class="line"><span style="color:#e1e4e8;">  show-config  Show cluster configuration</span></span>
<span class="line"><span style="color:#e1e4e8;">  switchover   Switchover to a replica</span></span>
<span class="line"><span style="color:#e1e4e8;">  topology     Prints ASCII topology for given cluster</span></span>
<span class="line"><span style="color:#e1e4e8;">  version      Output version of patronictl command or a running Patroni...</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">[ptgres@master patroni_data]$ patronictl -c pg_ydtf01.yml --help</span></span>
<span class="line"><span style="color:#24292e;">Usage: patronictl [OPTIONS] COMMAND [ARGS]...</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">Options:</span></span>
<span class="line"><span style="color:#24292e;">  -c, --config-file TEXT  Configuration file</span></span>
<span class="line"><span style="color:#24292e;">  -d, --dcs TEXT          Use this DCS</span></span>
<span class="line"><span style="color:#24292e;">  -k, --insecure          Allow connections to SSL sites without certs</span></span>
<span class="line"><span style="color:#24292e;">  --help                  Show this message and exit.</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">Commands:</span></span>
<span class="line"><span style="color:#24292e;">  configure    Create configuration file</span></span>
<span class="line"><span style="color:#24292e;">  dsn          Generate a dsn for the provided member, defaults to a dsn...</span></span>
<span class="line"><span style="color:#24292e;">  edit-config  Edit cluster configuration</span></span>
<span class="line"><span style="color:#24292e;">  failover     Failover to a replica</span></span>
<span class="line"><span style="color:#24292e;">  flush        Discard scheduled events</span></span>
<span class="line"><span style="color:#24292e;">  history      Show the history of failovers/switchovers</span></span>
<span class="line"><span style="color:#24292e;">  list         List the Patroni members for a given Patroni</span></span>
<span class="line"><span style="color:#24292e;">  pause        Disable auto failover</span></span>
<span class="line"><span style="color:#24292e;">  query        Query a Patroni PostgreSQL member</span></span>
<span class="line"><span style="color:#24292e;">  reinit       Reinitialize cluster member</span></span>
<span class="line"><span style="color:#24292e;">  reload       Reload cluster member configuration</span></span>
<span class="line"><span style="color:#24292e;">  remove       Remove cluster from DCS</span></span>
<span class="line"><span style="color:#24292e;">  restart      Restart cluster member</span></span>
<span class="line"><span style="color:#24292e;">  resume       Resume auto failover</span></span>
<span class="line"><span style="color:#24292e;">  scaffold     Create a structure for the cluster in DCS</span></span>
<span class="line"><span style="color:#24292e;">  show-config  Show cluster configuration</span></span>
<span class="line"><span style="color:#24292e;">  switchover   Switchover to a replica</span></span>
<span class="line"><span style="color:#24292e;">  topology     Prints ASCII topology for given cluster</span></span>
<span class="line"><span style="color:#24292e;">  version      Output version of patronictl command or a running Patroni...</span></span></code></pre></div><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">[ptgres@master patroni_data]$ patronictl -c pg_ydtf01.yml pause</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">[ptgres@master patroni_data]$ patronictl -c pg_ydtf01.yml list</span></span>
<span class="line"><span style="color:#e1e4e8;">+ Cluster: pg_ydtf (6982843055379144189) --+---------+----+-----------+-----------------+</span></span>
<span class="line"><span style="color:#e1e4e8;">| Member  | Host                 | Role    | State   | TL | Lag in MB | Pending restart |</span></span>
<span class="line"><span style="color:#e1e4e8;">+---------+----------------------+---------+---------+----+-----------+-----------------+</span></span>
<span class="line"><span style="color:#e1e4e8;">| master  | 192.168.122.251:5532 | Replica | running |  2 |         0 | *               |</span></span>
<span class="line"><span style="color:#e1e4e8;">| slave   | 192.168.122.249:5532 | Replica | running |  2 |         0 | *               |</span></span>
<span class="line"><span style="color:#e1e4e8;">| slave01 | 192.168.122.14:5532  | Leader  | running |  2 |           | *               |</span></span>
<span class="line"><span style="color:#e1e4e8;">+---------+----------------------+---------+---------+----+-----------+-----------------+</span></span>
<span class="line"><span style="color:#e1e4e8;"> Maintenance mode: on</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">[ptgres@master patroni_data]$ patronictl -c pg_ydtf01.yml pause</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">[ptgres@master patroni_data]$ patronictl -c pg_ydtf01.yml list</span></span>
<span class="line"><span style="color:#24292e;">+ Cluster: pg_ydtf (6982843055379144189) --+---------+----+-----------+-----------------+</span></span>
<span class="line"><span style="color:#24292e;">| Member  | Host                 | Role    | State   | TL | Lag in MB | Pending restart |</span></span>
<span class="line"><span style="color:#24292e;">+---------+----------------------+---------+---------+----+-----------+-----------------+</span></span>
<span class="line"><span style="color:#24292e;">| master  | 192.168.122.251:5532 | Replica | running |  2 |         0 | *               |</span></span>
<span class="line"><span style="color:#24292e;">| slave   | 192.168.122.249:5532 | Replica | running |  2 |         0 | *               |</span></span>
<span class="line"><span style="color:#24292e;">| slave01 | 192.168.122.14:5532  | Leader  | running |  2 |           | *               |</span></span>
<span class="line"><span style="color:#24292e;">+---------+----------------------+---------+---------+----+-----------+-----------------+</span></span>
<span class="line"><span style="color:#24292e;"> Maintenance mode: on</span></span></code></pre></div><p>多出Maintenance mode: on</p><ul><li>查看patroni进程</li></ul><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">[ptgres@master patroni_data]$ ps uax|grep patroni</span></span>
<span class="line"><span style="color:#e1e4e8;">ptgres     15386  0.1  1.0 555728 40540 pts/0    Sl+  05:02   0:02 /usr/bin/python3.6 /usr/local/bin/patroni pg_ydtf01.ym</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">#kill patroni进程</span></span>
<span class="line"><span style="color:#e1e4e8;">[ptgres@master patroni_data]$ kill 15386</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">#查看</span></span>
<span class="line"><span style="color:#e1e4e8;">[ptgres@master patroni_data]$ patronictl -c pg_ydtf01.yml list</span></span>
<span class="line"><span style="color:#e1e4e8;">+ Cluster: pg_ydtf (6982843055379144189) --+---------+----+-----------+-----------------+</span></span>
<span class="line"><span style="color:#e1e4e8;">| Member  | Host                 | Role    | State   | TL | Lag in MB | Pending restart |</span></span>
<span class="line"><span style="color:#e1e4e8;">+---------+----------------------+---------+---------+----+-----------+-----------------+</span></span>
<span class="line"><span style="color:#e1e4e8;">| slave   | 192.168.122.249:5532 | Replica | running |  2 |         0 | *               |</span></span>
<span class="line"><span style="color:#e1e4e8;">| slave01 | 192.168.122.14:5532  | Leader  | running |  2 |           | *               |</span></span>
<span class="line"><span style="color:#e1e4e8;">+---------+----------------------+---------+---------+----+-----------+-----------------+</span></span>
<span class="line"><span style="color:#e1e4e8;"> Maintenance mode: on</span></span>
<span class="line"><span style="color:#e1e4e8;"> </span></span>
<span class="line"><span style="color:#e1e4e8;"> </span></span>
<span class="line"><span style="color:#e1e4e8;">#此时postgresql进程还存在，没发生自动故障转移，登录leader节点的postgresql数据库，可以正常执行操作，没发生切换，这时可以操作数据库</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">[ptgres@master patroni_data]$ psql -h 127.0.0.1 -p 5532 -U postgres </span></span>
<span class="line"><span style="color:#e1e4e8;">Password for user postgres: </span></span>
<span class="line"><span style="color:#e1e4e8;">psql (12.2)</span></span>
<span class="line"><span style="color:#e1e4e8;">Type &quot;help&quot; for help.</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">postgres=# select pg_is_in_recovery();</span></span>
<span class="line"><span style="color:#e1e4e8;"> pg_is_in_recovery </span></span>
<span class="line"><span style="color:#e1e4e8;">-------------------</span></span>
<span class="line"><span style="color:#e1e4e8;"> t</span></span>
<span class="line"><span style="color:#e1e4e8;">(1 row)</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">此时我们就可以对Patroni进行升级等一系列维护操作，不会影响集群的使用</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">#恢复patroni</span></span>
<span class="line"><span style="color:#e1e4e8;">#启动patroni</span></span>
<span class="line"><span style="color:#e1e4e8;">[ptgres@master patroni_data]$ patronictl -c pg_ydtf01.yml resume</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">[ptgres@master patroni_data]$ ps uax|grep patroni</span></span>
<span class="line"><span style="color:#24292e;">ptgres     15386  0.1  1.0 555728 40540 pts/0    Sl+  05:02   0:02 /usr/bin/python3.6 /usr/local/bin/patroni pg_ydtf01.ym</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">#kill patroni进程</span></span>
<span class="line"><span style="color:#24292e;">[ptgres@master patroni_data]$ kill 15386</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">#查看</span></span>
<span class="line"><span style="color:#24292e;">[ptgres@master patroni_data]$ patronictl -c pg_ydtf01.yml list</span></span>
<span class="line"><span style="color:#24292e;">+ Cluster: pg_ydtf (6982843055379144189) --+---------+----+-----------+-----------------+</span></span>
<span class="line"><span style="color:#24292e;">| Member  | Host                 | Role    | State   | TL | Lag in MB | Pending restart |</span></span>
<span class="line"><span style="color:#24292e;">+---------+----------------------+---------+---------+----+-----------+-----------------+</span></span>
<span class="line"><span style="color:#24292e;">| slave   | 192.168.122.249:5532 | Replica | running |  2 |         0 | *               |</span></span>
<span class="line"><span style="color:#24292e;">| slave01 | 192.168.122.14:5532  | Leader  | running |  2 |           | *               |</span></span>
<span class="line"><span style="color:#24292e;">+---------+----------------------+---------+---------+----+-----------+-----------------+</span></span>
<span class="line"><span style="color:#24292e;"> Maintenance mode: on</span></span>
<span class="line"><span style="color:#24292e;"> </span></span>
<span class="line"><span style="color:#24292e;"> </span></span>
<span class="line"><span style="color:#24292e;">#此时postgresql进程还存在，没发生自动故障转移，登录leader节点的postgresql数据库，可以正常执行操作，没发生切换，这时可以操作数据库</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">[ptgres@master patroni_data]$ psql -h 127.0.0.1 -p 5532 -U postgres </span></span>
<span class="line"><span style="color:#24292e;">Password for user postgres: </span></span>
<span class="line"><span style="color:#24292e;">psql (12.2)</span></span>
<span class="line"><span style="color:#24292e;">Type &quot;help&quot; for help.</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">postgres=# select pg_is_in_recovery();</span></span>
<span class="line"><span style="color:#24292e;"> pg_is_in_recovery </span></span>
<span class="line"><span style="color:#24292e;">-------------------</span></span>
<span class="line"><span style="color:#24292e;"> t</span></span>
<span class="line"><span style="color:#24292e;">(1 row)</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">此时我们就可以对Patroni进行升级等一系列维护操作，不会影响集群的使用</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">#恢复patroni</span></span>
<span class="line"><span style="color:#24292e;">#启动patroni</span></span>
<span class="line"><span style="color:#24292e;">[ptgres@master patroni_data]$ patronictl -c pg_ydtf01.yml resume</span></span></code></pre></div><h1 id="八、watchdog" tabindex="-1">八、watchdog <a class="header-anchor" href="#八、watchdog" aria-label="Permalink to &quot;八、watchdog&quot;">​</a></h1><p>watchdog，用于监视机器的基本运行状况的守护程序，如果检测到系统hang死或者进程hang死，就会触发系统重新启动（或者是执行自定义脚本）</p><p>一般分为硬件看门狗和软件看门狗，硬件看门狗需要在BIOS里面设置，而软件看门狗只需要安装watchdog包，稍微配置一下就行</p><p>[root@master ~]# yum install -y watchdog</p><p>修改watchdog配置文件，指定设备</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">vi /etc/watchdog.conf</span></span>
<span class="line"><span style="color:#e1e4e8;">watchdog-device = /dev/watchdog</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">vi /etc/watchdog.conf</span></span>
<span class="line"><span style="color:#24292e;">watchdog-device = /dev/watchdog</span></span></code></pre></div><p>让内核加载softdog</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">[root@master ~]# modprobe softdog</span></span>
<span class="line"><span style="color:#e1e4e8;">[root@master ~]# ll /dev/watc*</span></span>
<span class="line"><span style="color:#e1e4e8;">crw------- 1 root root  10, 130 Jul  9 06:08 /dev/watchdog</span></span>
<span class="line"><span style="color:#e1e4e8;">crw------- 1 root root 248,   0 Jul  9 06:08 /dev/watchdog0</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">#查看日志以启动</span></span>
<span class="line"><span style="color:#e1e4e8;">[root@master ~]# dmesg | tail -1</span></span>
<span class="line"><span style="color:#e1e4e8;">[ 7963.590120] softdog: initialized. soft_noboot=0 soft_margin=60 sec soft_panic=0 (nowayout=0)</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">[root@master ~]# ps -ef | grep watchdog</span></span>
<span class="line"><span style="color:#e1e4e8;">root          12       2  0 03:55 ?        00:00:00 [watchdog/0]</span></span>
<span class="line"><span style="color:#e1e4e8;">root          15       2  0 03:55 ?        00:00:00 [watchdog/1]</span></span>
<span class="line"><span style="color:#e1e4e8;">root          36       2  0 03:55 ?        00:00:00 [watchdogd]</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;"># 修改/dev/watchdog设备权限</span></span>
<span class="line"><span style="color:#e1e4e8;">chmod 666 /dev/watchdog</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;"># 启动watchdog服务</span></span>
<span class="line"><span style="color:#e1e4e8;">systemctl start watchdog</span></span>
<span class="line"><span style="color:#e1e4e8;">systemctl enable watchdog</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">[root@master ~]# modprobe softdog</span></span>
<span class="line"><span style="color:#24292e;">[root@master ~]# ll /dev/watc*</span></span>
<span class="line"><span style="color:#24292e;">crw------- 1 root root  10, 130 Jul  9 06:08 /dev/watchdog</span></span>
<span class="line"><span style="color:#24292e;">crw------- 1 root root 248,   0 Jul  9 06:08 /dev/watchdog0</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">#查看日志以启动</span></span>
<span class="line"><span style="color:#24292e;">[root@master ~]# dmesg | tail -1</span></span>
<span class="line"><span style="color:#24292e;">[ 7963.590120] softdog: initialized. soft_noboot=0 soft_margin=60 sec soft_panic=0 (nowayout=0)</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">[root@master ~]# ps -ef | grep watchdog</span></span>
<span class="line"><span style="color:#24292e;">root          12       2  0 03:55 ?        00:00:00 [watchdog/0]</span></span>
<span class="line"><span style="color:#24292e;">root          15       2  0 03:55 ?        00:00:00 [watchdog/1]</span></span>
<span class="line"><span style="color:#24292e;">root          36       2  0 03:55 ?        00:00:00 [watchdogd]</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;"># 修改/dev/watchdog设备权限</span></span>
<span class="line"><span style="color:#24292e;">chmod 666 /dev/watchdog</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;"># 启动watchdog服务</span></span>
<span class="line"><span style="color:#24292e;">systemctl start watchdog</span></span>
<span class="line"><span style="color:#24292e;">systemctl enable watchdog</span></span></code></pre></div><h1 id="九、高可用方案" tabindex="-1">九、高可用方案 <a class="header-anchor" href="#九、高可用方案" aria-label="Permalink to &quot;九、高可用方案&quot;">​</a></h1><h2 id="_9-1callback" tabindex="-1">9.1<strong>callback</strong> <a class="header-anchor" href="#_9-1callback" aria-label="Permalink to &quot;9.1**callback**&quot;">​</a></h2><p>既是psql 地址又是patroni地址</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;"># node1</span></span>
<span class="line"><span style="color:#6A737D;"># 配置文件路径在前面systemd服务中已经定义</span></span>
<span class="line"><span style="color:#6A737D;"># 文件格式是yaml文本，不支持使用tab制表位，会提示语法错误</span></span>
<span class="line"><span style="color:#B392F0;">$</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">vi</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/etc/patroni/patroni.yml</span></span>
<span class="line"><span style="color:#B392F0;">scope:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pgsql</span></span>
<span class="line"><span style="color:#B392F0;">namespace:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/service/</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># Etcd中键值位置</span></span>
<span class="line"><span style="color:#B392F0;">name:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg1</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># patroni名称，每个节点不一样</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span></span>
<span class="line"><span style="color:#B392F0;">restapi:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">listen:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0.0</span><span style="color:#9ECBFF;">.0.0:8008</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># 保持默认，监听所有的8008端口</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">connect_address:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">10.37</span><span style="color:#9ECBFF;">.129.3:8008</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># 本地连接通信</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span></span>
<span class="line"><span style="color:#B392F0;">etcd3:</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># 这里建议使用etcdv3，默认是etcdv2，默认写入到etcd中的键值都是不可见的(仅patroni如此)</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">hosts:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">10.37</span><span style="color:#9ECBFF;">.129.3:2379,10.37.129.4:2379,10.37.129.5:2379</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># Etcd地址,如果这里使用单节点的etcd，需要将hosts关键字替换为host</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span></span>
<span class="line"><span style="color:#B392F0;">bootstrap:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">dcs:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">ttl:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">30</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">loop_wait:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">10</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">retry_timeout:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">10</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">maximum_lag_on_failover:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">1048576</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># 如果延迟超过1048576，不允许failover</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">master_start_timeout:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">300</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">synchronous_mode:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">false</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># 异步复制</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">postgresql:</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># 以下是pgsql服务的特性即参数配置，不详述</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#B392F0;">use_pg_rewind:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">true</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#B392F0;">use_slots:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">true</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#B392F0;">parameters:</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#B392F0;">listen_addresses:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;0.0.0.0&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#B392F0;">port:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5432</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#B392F0;">wal_level:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">replica</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#B392F0;">hot_standby:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;on&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#B392F0;">wal_keep_segments:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">100</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#B392F0;">max_wal_senders:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">10</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#B392F0;">max_replication_slots:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">10</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#B392F0;">wal_log_hints:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;on&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#B392F0;">archive_mode:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;on&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#B392F0;">archive_timeout:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">1800</span><span style="color:#9ECBFF;">s</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#B392F0;">archive_command:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">mkdir</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-p</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">../wal_archive</span><span style="color:#E1E4E8;"> &amp;&amp; </span><span style="color:#79B8FF;">test</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">!</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-f</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">../wal_archive/%f</span><span style="color:#E1E4E8;"> &amp;&amp; </span><span style="color:#B392F0;">cp</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">%p</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">../wal_archive/%f</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#B392F0;">recovery_conf:</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#B392F0;">restore_command:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">cp</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">../wal_archive/%f</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">%p</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">initdb:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">-</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">encoding:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">UTF8</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">-</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">locale:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">C</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">-</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">lc-ctype:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">zh_CN.UTF-8</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">-</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">data-checksums</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">pg_hba:</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># 定义流复制用户和远程连接身份鉴别设置</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">-</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">host</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">replication</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">postgres</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">10.37</span><span style="color:#9ECBFF;">.129.0/24</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">md5</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">-</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">host</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">all</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">all</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0.0</span><span style="color:#9ECBFF;">.0.0/0</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">md5</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span></span>
<span class="line"><span style="color:#B392F0;">postgresql:</span><span style="color:#E1E4E8;"> </span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">listen:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0.0</span><span style="color:#9ECBFF;">.0.0:5432</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">connect_address:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">10.37</span><span style="color:#9ECBFF;">.129.3:5432</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># 连接pgsql服务的配置,这里不能使用127.0.0.1,pg_basebackup需要远程连接主库进行在线复制</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">data_dir:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/var/lib/pgsql/12/data</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># $PGDATA</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">bin_dir:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/usr/pgsql-12/bin</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># $PGHOME/bin</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">authentication:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">replication:</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#B392F0;">username:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">postgres</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#B392F0;">password:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;123456&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">superuser:</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#B392F0;">username:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">postgres</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#B392F0;">password:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;123456&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">rewind:</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#B392F0;">username:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">postgres</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#B392F0;">password:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;123456&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">basebackup:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">max-rate:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">100</span><span style="color:#9ECBFF;">M</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">checkpoint:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">fast</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">callbacks:</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># 本次配置没有使用haproxy+keepalived实现VIP切换和负载均衡，因为callbacks方式更快速，对系统资源消耗更小，操作更简单，脚本后面提供</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">on_start:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/bin/bash</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/etc/patroni/patroni_callback.sh</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># patroni服务启动时候的触发的操作</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">on_stop:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/bin/bash</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/etc/patroni/patroni_callback.sh</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># patroni服务停止时候触发的操作</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">on_role_change:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/bin/bash</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/etc/patroni/patroni_callback.sh</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># patroni服务角色切换时触发的操作</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span></span>
<span class="line"><span style="color:#B392F0;">watchdog:</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># 使用linux自带的软件watchdog监控patroni的服务持续性</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">mode:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">automatic</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># Allowed values: off, automatic, required</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">device:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/dev/watchdog</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># watchdog设备，/dev/watchdog和/dev/watchdog0等同，可能存在兼容性区别</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">safety_margin:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span></span>
<span class="line"><span style="color:#B392F0;">tags:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">nofailover:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">false</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># 是否执行自动切换</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">noloadbalance:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">false</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># 是否开启负载均衡</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">clonefrom:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">false</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">nosync:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">false</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;"># node1</span></span>
<span class="line"><span style="color:#6A737D;"># 配置文件路径在前面systemd服务中已经定义</span></span>
<span class="line"><span style="color:#6A737D;"># 文件格式是yaml文本，不支持使用tab制表位，会提示语法错误</span></span>
<span class="line"><span style="color:#6F42C1;">$</span><span style="color:#24292E;"> </span><span style="color:#032F62;">vi</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/etc/patroni/patroni.yml</span></span>
<span class="line"><span style="color:#6F42C1;">scope:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pgsql</span></span>
<span class="line"><span style="color:#6F42C1;">namespace:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/service/</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># Etcd中键值位置</span></span>
<span class="line"><span style="color:#6F42C1;">name:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg1</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># patroni名称，每个节点不一样</span></span>
<span class="line"><span style="color:#24292E;">  </span></span>
<span class="line"><span style="color:#6F42C1;">restapi:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">listen:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0.0</span><span style="color:#032F62;">.0.0:8008</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 保持默认，监听所有的8008端口</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">connect_address:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">10.37</span><span style="color:#032F62;">.129.3:8008</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 本地连接通信</span></span>
<span class="line"><span style="color:#24292E;">  </span></span>
<span class="line"><span style="color:#6F42C1;">etcd3:</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 这里建议使用etcdv3，默认是etcdv2，默认写入到etcd中的键值都是不可见的(仅patroni如此)</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">hosts:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">10.37</span><span style="color:#032F62;">.129.3:2379,10.37.129.4:2379,10.37.129.5:2379</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># Etcd地址,如果这里使用单节点的etcd，需要将hosts关键字替换为host</span></span>
<span class="line"><span style="color:#24292E;">  </span></span>
<span class="line"><span style="color:#6F42C1;">bootstrap:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">dcs:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">ttl:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">30</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">loop_wait:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">10</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">retry_timeout:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">10</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">maximum_lag_on_failover:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1048576</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 如果延迟超过1048576，不允许failover</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">master_start_timeout:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">300</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">synchronous_mode:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">false</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 异步复制</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">postgresql:</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 以下是pgsql服务的特性即参数配置，不详述</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#6F42C1;">use_pg_rewind:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">true</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#6F42C1;">use_slots:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">true</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#6F42C1;">parameters:</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6F42C1;">listen_addresses:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;0.0.0.0&quot;</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6F42C1;">port:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5432</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6F42C1;">wal_level:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">replica</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6F42C1;">hot_standby:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;on&quot;</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6F42C1;">wal_keep_segments:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">100</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6F42C1;">max_wal_senders:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">10</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6F42C1;">max_replication_slots:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">10</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6F42C1;">wal_log_hints:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;on&quot;</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6F42C1;">archive_mode:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;on&quot;</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6F42C1;">archive_timeout:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1800</span><span style="color:#032F62;">s</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6F42C1;">archive_command:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">mkdir</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-p</span><span style="color:#24292E;"> </span><span style="color:#032F62;">../wal_archive</span><span style="color:#24292E;"> &amp;&amp; </span><span style="color:#005CC5;">test</span><span style="color:#24292E;"> </span><span style="color:#032F62;">!</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-f</span><span style="color:#24292E;"> </span><span style="color:#032F62;">../wal_archive/%f</span><span style="color:#24292E;"> &amp;&amp; </span><span style="color:#6F42C1;">cp</span><span style="color:#24292E;"> </span><span style="color:#032F62;">%p</span><span style="color:#24292E;"> </span><span style="color:#032F62;">../wal_archive/%f</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#6F42C1;">recovery_conf:</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6F42C1;">restore_command:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">cp</span><span style="color:#24292E;"> </span><span style="color:#032F62;">../wal_archive/%f</span><span style="color:#24292E;"> </span><span style="color:#032F62;">%p</span></span>
<span class="line"><span style="color:#24292E;">  </span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">initdb:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">-</span><span style="color:#24292E;"> </span><span style="color:#032F62;">encoding:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">UTF8</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">-</span><span style="color:#24292E;"> </span><span style="color:#032F62;">locale:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">C</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">-</span><span style="color:#24292E;"> </span><span style="color:#032F62;">lc-ctype:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">zh_CN.UTF-8</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">-</span><span style="color:#24292E;"> </span><span style="color:#032F62;">data-checksums</span></span>
<span class="line"><span style="color:#24292E;">  </span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">pg_hba:</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 定义流复制用户和远程连接身份鉴别设置</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">-</span><span style="color:#24292E;"> </span><span style="color:#032F62;">host</span><span style="color:#24292E;"> </span><span style="color:#032F62;">replication</span><span style="color:#24292E;"> </span><span style="color:#032F62;">postgres</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">10.37</span><span style="color:#032F62;">.129.0/24</span><span style="color:#24292E;"> </span><span style="color:#032F62;">md5</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">-</span><span style="color:#24292E;"> </span><span style="color:#032F62;">host</span><span style="color:#24292E;"> </span><span style="color:#032F62;">all</span><span style="color:#24292E;"> </span><span style="color:#032F62;">all</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0.0</span><span style="color:#032F62;">.0.0/0</span><span style="color:#24292E;"> </span><span style="color:#032F62;">md5</span></span>
<span class="line"><span style="color:#24292E;">  </span></span>
<span class="line"><span style="color:#6F42C1;">postgresql:</span><span style="color:#24292E;"> </span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">listen:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0.0</span><span style="color:#032F62;">.0.0:5432</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">connect_address:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">10.37</span><span style="color:#032F62;">.129.3:5432</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 连接pgsql服务的配置,这里不能使用127.0.0.1,pg_basebackup需要远程连接主库进行在线复制</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">data_dir:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/var/lib/pgsql/12/data</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># $PGDATA</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">bin_dir:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/usr/pgsql-12/bin</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># $PGHOME/bin</span></span>
<span class="line"><span style="color:#24292E;">  </span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">authentication:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">replication:</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#6F42C1;">username:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">postgres</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#6F42C1;">password:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;123456&quot;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">superuser:</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#6F42C1;">username:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">postgres</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#6F42C1;">password:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;123456&quot;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">rewind:</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#6F42C1;">username:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">postgres</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#6F42C1;">password:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;123456&quot;</span></span>
<span class="line"><span style="color:#24292E;">  </span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">basebackup:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">max-rate:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">100</span><span style="color:#032F62;">M</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">checkpoint:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">fast</span></span>
<span class="line"><span style="color:#24292E;">  </span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">callbacks:</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 本次配置没有使用haproxy+keepalived实现VIP切换和负载均衡，因为callbacks方式更快速，对系统资源消耗更小，操作更简单，脚本后面提供</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">on_start:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/bin/bash</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/etc/patroni/patroni_callback.sh</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># patroni服务启动时候的触发的操作</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">on_stop:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/bin/bash</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/etc/patroni/patroni_callback.sh</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># patroni服务停止时候触发的操作</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">on_role_change:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/bin/bash</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/etc/patroni/patroni_callback.sh</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># patroni服务角色切换时触发的操作</span></span>
<span class="line"><span style="color:#24292E;">  </span></span>
<span class="line"><span style="color:#6F42C1;">watchdog:</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 使用linux自带的软件watchdog监控patroni的服务持续性</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">mode:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">automatic</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># Allowed values: off, automatic, required</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">device:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/dev/watchdog</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># watchdog设备，/dev/watchdog和/dev/watchdog0等同，可能存在兼容性区别</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">safety_margin:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5</span></span>
<span class="line"><span style="color:#24292E;">  </span></span>
<span class="line"><span style="color:#6F42C1;">tags:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">nofailover:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">false</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 是否执行自动切换</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">noloadbalance:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">false</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 是否开启负载均衡</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">clonefrom:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">false</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">nosync:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">false</span></span></code></pre></div><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;"># node2</span></span>
<span class="line"><span style="color:#e1e4e8;"># 修改</span></span>
<span class="line"><span style="color:#e1e4e8;">name: pg2</span></span>
<span class="line"><span style="color:#e1e4e8;">restapi:</span></span>
<span class="line"><span style="color:#e1e4e8;"> \`\`listen: 0.0.0.0:8008</span></span>
<span class="line"><span style="color:#e1e4e8;"> \`\`connect_address: 10.37.129.4:8008</span></span>
<span class="line"><span style="color:#e1e4e8;">postgresql: </span></span>
<span class="line"><span style="color:#e1e4e8;"> \`\`listen: 0.0.0.0:5432</span></span>
<span class="line"><span style="color:#e1e4e8;"> \`\`connect_address: 10.37.129.4:5432</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;"># node2</span></span>
<span class="line"><span style="color:#24292e;"># 修改</span></span>
<span class="line"><span style="color:#24292e;">name: pg2</span></span>
<span class="line"><span style="color:#24292e;">restapi:</span></span>
<span class="line"><span style="color:#24292e;"> \`\`listen: 0.0.0.0:8008</span></span>
<span class="line"><span style="color:#24292e;"> \`\`connect_address: 10.37.129.4:8008</span></span>
<span class="line"><span style="color:#24292e;">postgresql: </span></span>
<span class="line"><span style="color:#24292e;"> \`\`listen: 0.0.0.0:5432</span></span>
<span class="line"><span style="color:#24292e;"> \`\`connect_address: 10.37.129.4:5432</span></span></code></pre></div><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;"># node3</span></span>
<span class="line"><span style="color:#e1e4e8;"># 修改</span></span>
<span class="line"><span style="color:#e1e4e8;">name: pg3</span></span>
<span class="line"><span style="color:#e1e4e8;">restapi:</span></span>
<span class="line"><span style="color:#e1e4e8;"> \`\`listen: 0.0.0.0:8008</span></span>
<span class="line"><span style="color:#e1e4e8;"> \`\`connect_address: 10.37.129.5:8008</span></span>
<span class="line"><span style="color:#e1e4e8;"> </span></span>
<span class="line"><span style="color:#e1e4e8;">postgresql: </span></span>
<span class="line"><span style="color:#e1e4e8;"> \`\`listen: 0.0.0.0:5432</span></span>
<span class="line"><span style="color:#e1e4e8;"> \`\`connect_address: 10.37.129.5:5432</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;"># node3</span></span>
<span class="line"><span style="color:#24292e;"># 修改</span></span>
<span class="line"><span style="color:#24292e;">name: pg3</span></span>
<span class="line"><span style="color:#24292e;">restapi:</span></span>
<span class="line"><span style="color:#24292e;"> \`\`listen: 0.0.0.0:8008</span></span>
<span class="line"><span style="color:#24292e;"> \`\`connect_address: 10.37.129.5:8008</span></span>
<span class="line"><span style="color:#24292e;"> </span></span>
<span class="line"><span style="color:#24292e;">postgresql: </span></span>
<span class="line"><span style="color:#24292e;"> \`\`listen: 0.0.0.0:5432</span></span>
<span class="line"><span style="color:#24292e;"> \`\`connect_address: 10.37.129.5:5432</span></span></code></pre></div><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;"># 脚本的开头传入了三个变量，但是在patroni.yml文件中我们并没有传入任何的变量，实际测试过程中发现由patroni服务默认传入三个变量</span></span>
<span class="line"><span style="color:#e1e4e8;">$1 - action, patroni触发的动作,stop/start/on_role_change/restart/reload</span></span>
<span class="line"><span style="color:#e1e4e8;">$2 - role, 当前节点的角色，master/{slave|replica}</span></span>
<span class="line"><span style="color:#e1e4e8;">$3 - scope, 作用范围，pgsql服务</span></span>
<span class="line"><span style="color:#e1e4e8;"># 脚本来自于其他博客，由于逻辑很简单，直接引用了</span></span>
<span class="line"><span style="color:#e1e4e8;"># 当节点角色为主，使用ip addr命令绑定VIP地址</span></span>
<span class="line"><span style="color:#e1e4e8;"># 当节点角色为备，使用ip addr命令解绑VIP地址</span></span>
<span class="line"><span style="color:#e1e4e8;">$ vi /etc/patroni/patroni_callback.sh</span></span>
<span class="line"><span style="color:#e1e4e8;">#!/bin/bash</span></span>
<span class="line"><span style="color:#e1e4e8;">  </span></span>
<span class="line"><span style="color:#e1e4e8;">readonly action=$1</span></span>
<span class="line"><span style="color:#e1e4e8;">readonly role=$2</span></span>
<span class="line"><span style="color:#e1e4e8;">readonly scope=$3</span></span>
<span class="line"><span style="color:#e1e4e8;">  </span></span>
<span class="line"><span style="color:#e1e4e8;">function usage() {</span></span>
<span class="line"><span style="color:#e1e4e8;">    echo &quot;Usage: $0 &lt;on_start|on_stop|on_role_change&gt; &lt;role&gt; &lt;scope&gt;&quot;</span></span>
<span class="line"><span style="color:#e1e4e8;">    exit 1</span></span>
<span class="line"><span style="color:#e1e4e8;">}</span></span>
<span class="line"><span style="color:#e1e4e8;">  </span></span>
<span class="line"><span style="color:#e1e4e8;">echo &quot;this is patroni callback $action $role $scope&quot;</span></span>
<span class="line"><span style="color:#e1e4e8;">  </span></span>
<span class="line"><span style="color:#e1e4e8;">case $cb_name in</span></span>
<span class="line"><span style="color:#e1e4e8;">    on_stop)</span></span>
<span class="line"><span style="color:#e1e4e8;">        sudo ip addr del 10.37.129.6/24 dev eth1 label eth1:1</span></span>
<span class="line"><span style="color:#e1e4e8;">        ;;</span></span>
<span class="line"><span style="color:#e1e4e8;">    on_start)</span></span>
<span class="line"><span style="color:#e1e4e8;">        ;;</span></span>
<span class="line"><span style="color:#e1e4e8;">    on_role_change)</span></span>
<span class="line"><span style="color:#e1e4e8;">        if [[ $role == &#39;master&#39; ]]; then</span></span>
<span class="line"><span style="color:#e1e4e8;">            # 绑定VIP</span></span>
<span class="line"><span style="color:#e1e4e8;">            sudo ip addr add 10.37.129.6/24 brd 10.37.129.255 dev eth1 label eth1:1</span></span>
<span class="line"><span style="color:#e1e4e8;">            # 监测VIP冲突,并屏蔽冲突的IP</span></span>
<span class="line"><span style="color:#e1e4e8;">            sudo arping -q -A -c 1 -I eth1 10.37.129.6</span></span>
<span class="line"><span style="color:#e1e4e8;">        else</span></span>
<span class="line"><span style="color:#e1e4e8;">            sudo ip addr del 10.37.129.6/24 dev eth1 label eth1:1</span></span>
<span class="line"><span style="color:#e1e4e8;">        fi</span></span>
<span class="line"><span style="color:#e1e4e8;">        ;;</span></span>
<span class="line"><span style="color:#e1e4e8;">    *)</span></span>
<span class="line"><span style="color:#e1e4e8;">        usage</span></span>
<span class="line"><span style="color:#e1e4e8;">        ;;</span></span>
<span class="line"><span style="color:#e1e4e8;">esac</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;"># 脚本的开头传入了三个变量，但是在patroni.yml文件中我们并没有传入任何的变量，实际测试过程中发现由patroni服务默认传入三个变量</span></span>
<span class="line"><span style="color:#24292e;">$1 - action, patroni触发的动作,stop/start/on_role_change/restart/reload</span></span>
<span class="line"><span style="color:#24292e;">$2 - role, 当前节点的角色，master/{slave|replica}</span></span>
<span class="line"><span style="color:#24292e;">$3 - scope, 作用范围，pgsql服务</span></span>
<span class="line"><span style="color:#24292e;"># 脚本来自于其他博客，由于逻辑很简单，直接引用了</span></span>
<span class="line"><span style="color:#24292e;"># 当节点角色为主，使用ip addr命令绑定VIP地址</span></span>
<span class="line"><span style="color:#24292e;"># 当节点角色为备，使用ip addr命令解绑VIP地址</span></span>
<span class="line"><span style="color:#24292e;">$ vi /etc/patroni/patroni_callback.sh</span></span>
<span class="line"><span style="color:#24292e;">#!/bin/bash</span></span>
<span class="line"><span style="color:#24292e;">  </span></span>
<span class="line"><span style="color:#24292e;">readonly action=$1</span></span>
<span class="line"><span style="color:#24292e;">readonly role=$2</span></span>
<span class="line"><span style="color:#24292e;">readonly scope=$3</span></span>
<span class="line"><span style="color:#24292e;">  </span></span>
<span class="line"><span style="color:#24292e;">function usage() {</span></span>
<span class="line"><span style="color:#24292e;">    echo &quot;Usage: $0 &lt;on_start|on_stop|on_role_change&gt; &lt;role&gt; &lt;scope&gt;&quot;</span></span>
<span class="line"><span style="color:#24292e;">    exit 1</span></span>
<span class="line"><span style="color:#24292e;">}</span></span>
<span class="line"><span style="color:#24292e;">  </span></span>
<span class="line"><span style="color:#24292e;">echo &quot;this is patroni callback $action $role $scope&quot;</span></span>
<span class="line"><span style="color:#24292e;">  </span></span>
<span class="line"><span style="color:#24292e;">case $cb_name in</span></span>
<span class="line"><span style="color:#24292e;">    on_stop)</span></span>
<span class="line"><span style="color:#24292e;">        sudo ip addr del 10.37.129.6/24 dev eth1 label eth1:1</span></span>
<span class="line"><span style="color:#24292e;">        ;;</span></span>
<span class="line"><span style="color:#24292e;">    on_start)</span></span>
<span class="line"><span style="color:#24292e;">        ;;</span></span>
<span class="line"><span style="color:#24292e;">    on_role_change)</span></span>
<span class="line"><span style="color:#24292e;">        if [[ $role == &#39;master&#39; ]]; then</span></span>
<span class="line"><span style="color:#24292e;">            # 绑定VIP</span></span>
<span class="line"><span style="color:#24292e;">            sudo ip addr add 10.37.129.6/24 brd 10.37.129.255 dev eth1 label eth1:1</span></span>
<span class="line"><span style="color:#24292e;">            # 监测VIP冲突,并屏蔽冲突的IP</span></span>
<span class="line"><span style="color:#24292e;">            sudo arping -q -A -c 1 -I eth1 10.37.129.6</span></span>
<span class="line"><span style="color:#24292e;">        else</span></span>
<span class="line"><span style="color:#24292e;">            sudo ip addr del 10.37.129.6/24 dev eth1 label eth1:1</span></span>
<span class="line"><span style="color:#24292e;">        fi</span></span>
<span class="line"><span style="color:#24292e;">        ;;</span></span>
<span class="line"><span style="color:#24292e;">    *)</span></span>
<span class="line"><span style="color:#24292e;">        usage</span></span>
<span class="line"><span style="color:#24292e;">        ;;</span></span>
<span class="line"><span style="color:#24292e;">esac</span></span></code></pre></div><ul><li>手动触发故障</li></ul><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">$ systemctl stop patroni</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">$ systemctl stop patroni</span></span></code></pre></div><p>这个脚本的作用就是，当本地postgresql变为 master 时，就绑定vip，变为slave时，就删除vip</p><h2 id="_9-2-haproxy-keepalived" tabindex="-1">9.2 haproxy+keepalived <a class="header-anchor" href="#_9-2-haproxy-keepalived" aria-label="Permalink to &quot;9.2 haproxy+keepalived&quot;">​</a></h2><table><thead><tr><th>节点名</th><th>IP</th><th>操作系统</th><th>安装软件</th><th>备注</th></tr></thead><tbody><tr><td>pg_node1</td><td>192.168.122.251</td><td>CentOS 7.6</td><td>haproxy 1.5.18/keepalived 1.3.5</td><td>VIP：192.168.122.8249，keepalived主节点</td></tr><tr><td>pg_node2</td><td>192.168.122.249</td><td>CentOS 7.6</td><td>haproxy 1.5.18/keepalived 1.3.5</td><td>keepalived备节点</td></tr></tbody></table><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">#注释掉所有patroni节点配置文件中的回调脚本 vi /etc/patroni/patroni.yml #  callbacks:  #    on_start: /bin/bash /etc/patroni/patroni_callback.sh # patroni服务启动时候的触发的操作 #    on_stop: /bin/bash /etc/patroni/patroni_callback.sh # patroni服务停止时候触发的操作 #    on_role_change: /bin/bash /etc/patroni/patroni_callback.sh # patroni服务角色切换时触发的操作 systemctl restart patroni</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">#注释掉所有patroni节点配置文件中的回调脚本 vi /etc/patroni/patroni.yml #  callbacks:  #    on_start: /bin/bash /etc/patroni/patroni_callback.sh # patroni服务启动时候的触发的操作 #    on_stop: /bin/bash /etc/patroni/patroni_callback.sh # patroni服务停止时候触发的操作 #    on_role_change: /bin/bash /etc/patroni/patroni_callback.sh # patroni服务角色切换时触发的操作 systemctl restart patroni</span></span></code></pre></div><h3 id="配置haproxy和keepalived" tabindex="-1">配置haproxy和keepalived： <a class="header-anchor" href="#配置haproxy和keepalived" aria-label="Permalink to &quot;配置haproxy和keepalived：&quot;">​</a></h3><p>#pg_node1和pg_node2添加haproxy配置</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">mv /etc/haproxy/haproxy.cfg /etc/haproxy/haproxy.cfg.bak</span></span>
<span class="line"><span style="color:#e1e4e8;">cat &gt;&gt; /etc/haproxy/haproxy.cfg &lt;&lt;EOF</span></span>
<span class="line"><span style="color:#e1e4e8;">#全局定义</span></span>
<span class="line"><span style="color:#e1e4e8;">global</span></span>
<span class="line"><span style="color:#e1e4e8;">    #log语法：log [max_level_1]</span></span>
<span class="line"><span style="color:#e1e4e8;">    #全局的日志配置，使用log关键字，指定使用127.0.0.1上的syslog服务中的local0日志设备，</span></span>
<span class="line"><span style="color:#e1e4e8;">    #记录日志等级为info的日志</span></span>
<span class="line"><span style="color:#e1e4e8;">    #log         127.0.0.1 local0 info</span></span>
<span class="line"><span style="color:#e1e4e8;">    #log         127.0.0.1 local1 notice</span></span>
<span class="line"><span style="color:#e1e4e8;">    log         127.0.0.1 local2</span></span>
<span class="line"><span style="color:#e1e4e8;">    chroot      /var/lib/haproxy</span></span>
<span class="line"><span style="color:#e1e4e8;">    pidfile     /var/run/haproxy.pid</span></span>
<span class="line"><span style="color:#e1e4e8;">     </span></span>
<span class="line"><span style="color:#e1e4e8;">    #定义每个haproxy进程的最大连接数 ，由于每个连接包括一个客户端和一个服务器端，</span></span>
<span class="line"><span style="color:#e1e4e8;">    #所以单个进程的TCP会话最大数目将是该值的两倍。</span></span>
<span class="line"><span style="color:#e1e4e8;">    maxconn     3000</span></span>
<span class="line"><span style="color:#e1e4e8;">     </span></span>
<span class="line"><span style="color:#e1e4e8;">    #用户，组</span></span>
<span class="line"><span style="color:#e1e4e8;">    user        haproxy</span></span>
<span class="line"><span style="color:#e1e4e8;">    group       haproxy</span></span>
<span class="line"><span style="color:#e1e4e8;">     </span></span>
<span class="line"><span style="color:#e1e4e8;">    #以守护进程的方式运行</span></span>
<span class="line"><span style="color:#e1e4e8;">    daemon</span></span>
<span class="line"><span style="color:#e1e4e8;"> </span></span>
<span class="line"><span style="color:#e1e4e8;">    #turn on stats unix socket</span></span>
<span class="line"><span style="color:#e1e4e8;">    stats socket /var/lib/haproxy/stats</span></span>
<span class="line"><span style="color:#e1e4e8;"> </span></span>
<span class="line"><span style="color:#e1e4e8;">#默认部分的定义</span></span>
<span class="line"><span style="color:#e1e4e8;">defaults    </span></span>
<span class="line"><span style="color:#e1e4e8;">    #mode语法：mode {http|tcp|health} 。http是七层模式，tcp是四层模式，health是健康检测，返回OK</span></span>
<span class="line"><span style="color:#e1e4e8;">    mode tcp   </span></span>
<span class="line"><span style="color:#e1e4e8;">    #使用127.0.0.1上的syslog服务的local3设备记录错误信息</span></span>
<span class="line"><span style="color:#e1e4e8;">    log 127.0.0.1 local3 err</span></span>
<span class="line"><span style="color:#e1e4e8;"> </span></span>
<span class="line"><span style="color:#e1e4e8;">    #if you set mode to http,then you nust change tcplog into httplog</span></span>
<span class="line"><span style="color:#e1e4e8;">    option     tcplog</span></span>
<span class="line"><span style="color:#e1e4e8;">     </span></span>
<span class="line"><span style="color:#e1e4e8;">    #启用该项，日志中将不会记录空连接。所谓空连接就是在上游的负载均衡器或者监控系统为了</span></span>
<span class="line"><span style="color:#e1e4e8;">    #探测该服务是否存活可用时，需要定期的连接或者获取某一固定的组件或页面，或者探测扫描</span></span>
<span class="line"><span style="color:#e1e4e8;">    #端口是否在监听或开放等动作被称为空连接；官方文档中标注，如果该服务上游没有其他的负</span></span>
<span class="line"><span style="color:#e1e4e8;">    #载均衡器的话，建议不要使用该参数，因为互联网上的恶意扫描或其他动作就不会被记录下来</span></span>
<span class="line"><span style="color:#e1e4e8;">    option     dontlognull</span></span>
<span class="line"><span style="color:#e1e4e8;">     </span></span>
<span class="line"><span style="color:#e1e4e8;">    #定义连接后端服务器的失败重连次数，连接失败次数超过此值后将会将对应后端服务器标记为不可用      </span></span>
<span class="line"><span style="color:#e1e4e8;">    retries    3</span></span>
<span class="line"><span style="color:#e1e4e8;">     </span></span>
<span class="line"><span style="color:#e1e4e8;">    #当使用了cookie时，haproxy将会将其请求的后端服务器的serverID插入到cookie中，以保证</span></span>
<span class="line"><span style="color:#e1e4e8;">    #会话的SESSION持久性；而此时，如果后端的服务器宕掉了，但是客户端的cookie是不会刷新的</span></span>
<span class="line"><span style="color:#e1e4e8;">    #，如果设置此参数，将会将客户的请求强制定向到另外一个后端server上，以保证服务的正常</span></span>
<span class="line"><span style="color:#e1e4e8;">    option redispatch</span></span>
<span class="line"><span style="color:#e1e4e8;"> </span></span>
<span class="line"><span style="color:#e1e4e8;">    #等待最大时长  When a server&#39;s maxconn is reached, connections are left pending in a queue  which may be server-specific or global to the backend.</span></span>
<span class="line"><span style="color:#e1e4e8;">    timeout queue           1m</span></span>
<span class="line"><span style="color:#e1e4e8;">     </span></span>
<span class="line"><span style="color:#e1e4e8;">    #设置成功连接到一台服务器的最长等待时间，默认单位是毫秒</span></span>
<span class="line"><span style="color:#e1e4e8;">    timeout connect         10s</span></span>
<span class="line"><span style="color:#e1e4e8;">     </span></span>
<span class="line"><span style="color:#e1e4e8;">    #客户端非活动状态的超时时长   The inactivity timeout applies when the client is expected to acknowledge or  send data.</span></span>
<span class="line"><span style="color:#e1e4e8;">    timeout client          1m</span></span>
<span class="line"><span style="color:#e1e4e8;">     </span></span>
<span class="line"><span style="color:#e1e4e8;">    #Set the maximum inactivity time on the server side.The inactivity timeout applies when the server is expected to acknowledge or  send data.</span></span>
<span class="line"><span style="color:#e1e4e8;">    timeout server          1m</span></span>
<span class="line"><span style="color:#e1e4e8;">    timeout check           5s</span></span>
<span class="line"><span style="color:#e1e4e8;">    maxconn                 3000</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">#配置haproxy web监控，查看统计信息</span></span>
<span class="line"><span style="color:#e1e4e8;">listen status</span></span>
<span class="line"><span style="color:#e1e4e8;">    bind *:1080</span></span>
<span class="line"><span style="color:#e1e4e8;">    mode http</span></span>
<span class="line"><span style="color:#e1e4e8;">    log global</span></span>
<span class="line"><span style="color:#e1e4e8;">     </span></span>
<span class="line"><span style="color:#e1e4e8;">    stats enable</span></span>
<span class="line"><span style="color:#e1e4e8;">    #stats是haproxy的一个统计页面的套接字，该参数设置统计页面的刷新间隔为30s</span></span>
<span class="line"><span style="color:#e1e4e8;">    stats refresh 30s</span></span>
<span class="line"><span style="color:#e1e4e8;">    stats uri /</span></span>
<span class="line"><span style="color:#e1e4e8;">    #设置统计页面认证时的提示内容</span></span>
<span class="line"><span style="color:#e1e4e8;">    stats realm Private lands</span></span>
<span class="line"><span style="color:#e1e4e8;">    #设置统计页面认证的用户和密码，如果要设置多个，另起一行写入即可</span></span>
<span class="line"><span style="color:#e1e4e8;">    stats auth admin:Admin2021</span></span>
<span class="line"><span style="color:#e1e4e8;">    #隐藏统计页面上的haproxy版本信息</span></span>
<span class="line"><span style="color:#e1e4e8;">    #stats hide-version</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">listen master</span></span>
<span class="line"><span style="color:#e1e4e8;">    bind *:5000</span></span>
<span class="line"><span style="color:#e1e4e8;">        mode tcp</span></span>
<span class="line"><span style="color:#e1e4e8;">        option tcplog</span></span>
<span class="line"><span style="color:#e1e4e8;">        balance roundrobin</span></span>
<span class="line"><span style="color:#e1e4e8;">    option httpchk OPTIONS /master</span></span>
<span class="line"><span style="color:#e1e4e8;">    http-check expect status 200</span></span>
<span class="line"><span style="color:#e1e4e8;">    default-server inter 3s fall 3 rise 2 on-marked-down shutdown-sessions</span></span>
<span class="line"><span style="color:#e1e4e8;">        server pg_node1 192.168.210.15:5432 maxconn 1000 check port 8008</span></span>
<span class="line"><span style="color:#e1e4e8;">        server pg_node2 192.168.210.81:5432 maxconn 1000 check port 8008</span></span>
<span class="line"><span style="color:#e1e4e8;">        server pg_node3 192.168.210.33:5432 maxconn 1000 check port 8008</span></span>
<span class="line"><span style="color:#e1e4e8;">listen replicas</span></span>
<span class="line"><span style="color:#e1e4e8;">    bind *:5001</span></span>
<span class="line"><span style="color:#e1e4e8;">        mode tcp</span></span>
<span class="line"><span style="color:#e1e4e8;">        option tcplog</span></span>
<span class="line"><span style="color:#e1e4e8;">        balance roundrobin</span></span>
<span class="line"><span style="color:#e1e4e8;">    option httpchk OPTIONS /replica</span></span>
<span class="line"><span style="color:#e1e4e8;">    http-check expect status 200</span></span>
<span class="line"><span style="color:#e1e4e8;">    default-server inter 3s fall 3 rise 2 on-marked-down shutdown-sessions</span></span>
<span class="line"><span style="color:#e1e4e8;">        server pg_node1 192.168.210.15:5432 maxconn 1000 check port 8008</span></span>
<span class="line"><span style="color:#e1e4e8;">        server pg_node2 192.168.210.81:5432 maxconn 1000 check port 8008</span></span>
<span class="line"><span style="color:#e1e4e8;">        server pg_node3 192.168.210.33:5432 maxconn 1000 check port 8008</span></span>
<span class="line"><span style="color:#e1e4e8;">EOF</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">#keepalived主节点配置</span></span>
<span class="line"><span style="color:#e1e4e8;">[root@pg_node1 keepalived] mv /etc/keepalived/keepalived.conf /etc/keepalived/keepalived.conf.bak</span></span>
<span class="line"><span style="color:#e1e4e8;">[root@pg_node1 keepalived] cat &gt;&gt; /etc/keepalived/keepalived.conf &lt;&lt;EOF</span></span>
<span class="line"><span style="color:#e1e4e8;">global_defs {</span></span>
<span class="line"><span style="color:#e1e4e8;">    router_id twkp  #虚拟路由名称</span></span>
<span class="line"><span style="color:#e1e4e8;">    script_user root</span></span>
<span class="line"><span style="color:#e1e4e8;">    enable_script_security</span></span>
<span class="line"><span style="color:#e1e4e8;">}</span></span>
<span class="line"><span style="color:#e1e4e8;"> </span></span>
<span class="line"><span style="color:#e1e4e8;">#HAProxy健康检查配置</span></span>
<span class="line"><span style="color:#e1e4e8;">vrrp_script chk_haproxy {</span></span>
<span class="line"><span style="color:#e1e4e8;">    script &quot;/usr/bin/killall -0 haproxy&quot;  #使用killall -0检查haproxy实例是否存在，性能高于ps命令</span></span>
<span class="line"><span style="color:#e1e4e8;">    interval 2   #脚本运行周期</span></span>
<span class="line"><span style="color:#e1e4e8;">    weight 2     #每次检查的加权权重值</span></span>
<span class="line"><span style="color:#e1e4e8;">}</span></span>
<span class="line"><span style="color:#e1e4e8;"> </span></span>
<span class="line"><span style="color:#e1e4e8;">#虚拟路由配置</span></span>
<span class="line"><span style="color:#e1e4e8;">vrrp_instance VI_1 {</span></span>
<span class="line"><span style="color:#e1e4e8;">    state MASTER           #本机实例状态，MASTER/BACKUP，备机配置文件中请写BACKUP</span></span>
<span class="line"><span style="color:#e1e4e8;">    interface eth0         #本机网卡名称，使用ifconfig命令查看</span></span>
<span class="line"><span style="color:#e1e4e8;">    virtual_router_id 88   #虚拟路由编号，主备机保持一致</span></span>
<span class="line"><span style="color:#e1e4e8;">    priority 100           #本机初始权重，备机请填写小于主机的值（例如100）</span></span>
<span class="line"><span style="color:#e1e4e8;">    advert_int 5           #争抢虚地址的周期，秒</span></span>
<span class="line"><span style="color:#e1e4e8;">    virtual_ipaddress {</span></span>
<span class="line"><span style="color:#e1e4e8;">        192.168.210.88     #虚地址IP，主备机保持一致</span></span>
<span class="line"><span style="color:#e1e4e8;">    }</span></span>
<span class="line"><span style="color:#e1e4e8;">    track_script {</span></span>
<span class="line"><span style="color:#e1e4e8;">        chk_haproxy        #对应的健康检查配置</span></span>
<span class="line"><span style="color:#e1e4e8;">    }</span></span>
<span class="line"><span style="color:#e1e4e8;">}</span></span>
<span class="line"><span style="color:#e1e4e8;">EOF</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">#keepalived备节点配置</span></span>
<span class="line"><span style="color:#e1e4e8;">[root@pg_node2 keepalived] mv /etc/keepalived/keepalived.conf /etc/keepalived/keepalived.conf.bak</span></span>
<span class="line"><span style="color:#e1e4e8;">[root@pg_node2 keepalived] cat &gt;&gt; /etc/keepalived/keepalived.conf &lt;&lt;EOF</span></span>
<span class="line"><span style="color:#e1e4e8;">global_defs {</span></span>
<span class="line"><span style="color:#e1e4e8;">    router_id twkp  #虚拟路由名称</span></span>
<span class="line"><span style="color:#e1e4e8;">    script_user root</span></span>
<span class="line"><span style="color:#e1e4e8;">    enable_script_security</span></span>
<span class="line"><span style="color:#e1e4e8;">}</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">#HAProxy健康检查配置</span></span>
<span class="line"><span style="color:#e1e4e8;">vrrp_script chk_haproxy {</span></span>
<span class="line"><span style="color:#e1e4e8;">    script &quot;/usr/bin/killall -0 haproxy&quot;  #使用killall -0检查haproxy实例是否存在，性能高于ps命令</span></span>
<span class="line"><span style="color:#e1e4e8;">    interval 2   #脚本运行周期</span></span>
<span class="line"><span style="color:#e1e4e8;">    weight 2     #每次检查的加权权重值</span></span>
<span class="line"><span style="color:#e1e4e8;">}</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">#虚拟路由配置</span></span>
<span class="line"><span style="color:#e1e4e8;">vrrp_instance VI_1 {</span></span>
<span class="line"><span style="color:#e1e4e8;">    state BACKUP           #本机实例状态，MASTER/BACKUP，备机配置文件中请写BACKUP</span></span>
<span class="line"><span style="color:#e1e4e8;">    interface eth0         #本机网卡名称，使用ifconfig命令查看</span></span>
<span class="line"><span style="color:#e1e4e8;">    virtual_router_id 88   #虚拟路由编号，主备机保持一致</span></span>
<span class="line"><span style="color:#e1e4e8;">    priority 99            #本机初始权重，备机请填写小于主机的值（例如100）</span></span>
<span class="line"><span style="color:#e1e4e8;">    advert_int 5           #争抢虚地址的周期，秒</span></span>
<span class="line"><span style="color:#e1e4e8;">    virtual_ipaddress {</span></span>
<span class="line"><span style="color:#e1e4e8;">        192.168.210.88     #虚地址IP，主备机保持一致</span></span>
<span class="line"><span style="color:#e1e4e8;">    }</span></span>
<span class="line"><span style="color:#e1e4e8;">    track_script {</span></span>
<span class="line"><span style="color:#e1e4e8;">        chk_haproxy        #对应的健康检查配置</span></span>
<span class="line"><span style="color:#e1e4e8;">    }</span></span>
<span class="line"><span style="color:#e1e4e8;">}</span></span>
<span class="line"><span style="color:#e1e4e8;">EOF</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">mv /etc/haproxy/haproxy.cfg /etc/haproxy/haproxy.cfg.bak</span></span>
<span class="line"><span style="color:#24292e;">cat &gt;&gt; /etc/haproxy/haproxy.cfg &lt;&lt;EOF</span></span>
<span class="line"><span style="color:#24292e;">#全局定义</span></span>
<span class="line"><span style="color:#24292e;">global</span></span>
<span class="line"><span style="color:#24292e;">    #log语法：log [max_level_1]</span></span>
<span class="line"><span style="color:#24292e;">    #全局的日志配置，使用log关键字，指定使用127.0.0.1上的syslog服务中的local0日志设备，</span></span>
<span class="line"><span style="color:#24292e;">    #记录日志等级为info的日志</span></span>
<span class="line"><span style="color:#24292e;">    #log         127.0.0.1 local0 info</span></span>
<span class="line"><span style="color:#24292e;">    #log         127.0.0.1 local1 notice</span></span>
<span class="line"><span style="color:#24292e;">    log         127.0.0.1 local2</span></span>
<span class="line"><span style="color:#24292e;">    chroot      /var/lib/haproxy</span></span>
<span class="line"><span style="color:#24292e;">    pidfile     /var/run/haproxy.pid</span></span>
<span class="line"><span style="color:#24292e;">     </span></span>
<span class="line"><span style="color:#24292e;">    #定义每个haproxy进程的最大连接数 ，由于每个连接包括一个客户端和一个服务器端，</span></span>
<span class="line"><span style="color:#24292e;">    #所以单个进程的TCP会话最大数目将是该值的两倍。</span></span>
<span class="line"><span style="color:#24292e;">    maxconn     3000</span></span>
<span class="line"><span style="color:#24292e;">     </span></span>
<span class="line"><span style="color:#24292e;">    #用户，组</span></span>
<span class="line"><span style="color:#24292e;">    user        haproxy</span></span>
<span class="line"><span style="color:#24292e;">    group       haproxy</span></span>
<span class="line"><span style="color:#24292e;">     </span></span>
<span class="line"><span style="color:#24292e;">    #以守护进程的方式运行</span></span>
<span class="line"><span style="color:#24292e;">    daemon</span></span>
<span class="line"><span style="color:#24292e;"> </span></span>
<span class="line"><span style="color:#24292e;">    #turn on stats unix socket</span></span>
<span class="line"><span style="color:#24292e;">    stats socket /var/lib/haproxy/stats</span></span>
<span class="line"><span style="color:#24292e;"> </span></span>
<span class="line"><span style="color:#24292e;">#默认部分的定义</span></span>
<span class="line"><span style="color:#24292e;">defaults    </span></span>
<span class="line"><span style="color:#24292e;">    #mode语法：mode {http|tcp|health} 。http是七层模式，tcp是四层模式，health是健康检测，返回OK</span></span>
<span class="line"><span style="color:#24292e;">    mode tcp   </span></span>
<span class="line"><span style="color:#24292e;">    #使用127.0.0.1上的syslog服务的local3设备记录错误信息</span></span>
<span class="line"><span style="color:#24292e;">    log 127.0.0.1 local3 err</span></span>
<span class="line"><span style="color:#24292e;"> </span></span>
<span class="line"><span style="color:#24292e;">    #if you set mode to http,then you nust change tcplog into httplog</span></span>
<span class="line"><span style="color:#24292e;">    option     tcplog</span></span>
<span class="line"><span style="color:#24292e;">     </span></span>
<span class="line"><span style="color:#24292e;">    #启用该项，日志中将不会记录空连接。所谓空连接就是在上游的负载均衡器或者监控系统为了</span></span>
<span class="line"><span style="color:#24292e;">    #探测该服务是否存活可用时，需要定期的连接或者获取某一固定的组件或页面，或者探测扫描</span></span>
<span class="line"><span style="color:#24292e;">    #端口是否在监听或开放等动作被称为空连接；官方文档中标注，如果该服务上游没有其他的负</span></span>
<span class="line"><span style="color:#24292e;">    #载均衡器的话，建议不要使用该参数，因为互联网上的恶意扫描或其他动作就不会被记录下来</span></span>
<span class="line"><span style="color:#24292e;">    option     dontlognull</span></span>
<span class="line"><span style="color:#24292e;">     </span></span>
<span class="line"><span style="color:#24292e;">    #定义连接后端服务器的失败重连次数，连接失败次数超过此值后将会将对应后端服务器标记为不可用      </span></span>
<span class="line"><span style="color:#24292e;">    retries    3</span></span>
<span class="line"><span style="color:#24292e;">     </span></span>
<span class="line"><span style="color:#24292e;">    #当使用了cookie时，haproxy将会将其请求的后端服务器的serverID插入到cookie中，以保证</span></span>
<span class="line"><span style="color:#24292e;">    #会话的SESSION持久性；而此时，如果后端的服务器宕掉了，但是客户端的cookie是不会刷新的</span></span>
<span class="line"><span style="color:#24292e;">    #，如果设置此参数，将会将客户的请求强制定向到另外一个后端server上，以保证服务的正常</span></span>
<span class="line"><span style="color:#24292e;">    option redispatch</span></span>
<span class="line"><span style="color:#24292e;"> </span></span>
<span class="line"><span style="color:#24292e;">    #等待最大时长  When a server&#39;s maxconn is reached, connections are left pending in a queue  which may be server-specific or global to the backend.</span></span>
<span class="line"><span style="color:#24292e;">    timeout queue           1m</span></span>
<span class="line"><span style="color:#24292e;">     </span></span>
<span class="line"><span style="color:#24292e;">    #设置成功连接到一台服务器的最长等待时间，默认单位是毫秒</span></span>
<span class="line"><span style="color:#24292e;">    timeout connect         10s</span></span>
<span class="line"><span style="color:#24292e;">     </span></span>
<span class="line"><span style="color:#24292e;">    #客户端非活动状态的超时时长   The inactivity timeout applies when the client is expected to acknowledge or  send data.</span></span>
<span class="line"><span style="color:#24292e;">    timeout client          1m</span></span>
<span class="line"><span style="color:#24292e;">     </span></span>
<span class="line"><span style="color:#24292e;">    #Set the maximum inactivity time on the server side.The inactivity timeout applies when the server is expected to acknowledge or  send data.</span></span>
<span class="line"><span style="color:#24292e;">    timeout server          1m</span></span>
<span class="line"><span style="color:#24292e;">    timeout check           5s</span></span>
<span class="line"><span style="color:#24292e;">    maxconn                 3000</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">#配置haproxy web监控，查看统计信息</span></span>
<span class="line"><span style="color:#24292e;">listen status</span></span>
<span class="line"><span style="color:#24292e;">    bind *:1080</span></span>
<span class="line"><span style="color:#24292e;">    mode http</span></span>
<span class="line"><span style="color:#24292e;">    log global</span></span>
<span class="line"><span style="color:#24292e;">     </span></span>
<span class="line"><span style="color:#24292e;">    stats enable</span></span>
<span class="line"><span style="color:#24292e;">    #stats是haproxy的一个统计页面的套接字，该参数设置统计页面的刷新间隔为30s</span></span>
<span class="line"><span style="color:#24292e;">    stats refresh 30s</span></span>
<span class="line"><span style="color:#24292e;">    stats uri /</span></span>
<span class="line"><span style="color:#24292e;">    #设置统计页面认证时的提示内容</span></span>
<span class="line"><span style="color:#24292e;">    stats realm Private lands</span></span>
<span class="line"><span style="color:#24292e;">    #设置统计页面认证的用户和密码，如果要设置多个，另起一行写入即可</span></span>
<span class="line"><span style="color:#24292e;">    stats auth admin:Admin2021</span></span>
<span class="line"><span style="color:#24292e;">    #隐藏统计页面上的haproxy版本信息</span></span>
<span class="line"><span style="color:#24292e;">    #stats hide-version</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">listen master</span></span>
<span class="line"><span style="color:#24292e;">    bind *:5000</span></span>
<span class="line"><span style="color:#24292e;">        mode tcp</span></span>
<span class="line"><span style="color:#24292e;">        option tcplog</span></span>
<span class="line"><span style="color:#24292e;">        balance roundrobin</span></span>
<span class="line"><span style="color:#24292e;">    option httpchk OPTIONS /master</span></span>
<span class="line"><span style="color:#24292e;">    http-check expect status 200</span></span>
<span class="line"><span style="color:#24292e;">    default-server inter 3s fall 3 rise 2 on-marked-down shutdown-sessions</span></span>
<span class="line"><span style="color:#24292e;">        server pg_node1 192.168.210.15:5432 maxconn 1000 check port 8008</span></span>
<span class="line"><span style="color:#24292e;">        server pg_node2 192.168.210.81:5432 maxconn 1000 check port 8008</span></span>
<span class="line"><span style="color:#24292e;">        server pg_node3 192.168.210.33:5432 maxconn 1000 check port 8008</span></span>
<span class="line"><span style="color:#24292e;">listen replicas</span></span>
<span class="line"><span style="color:#24292e;">    bind *:5001</span></span>
<span class="line"><span style="color:#24292e;">        mode tcp</span></span>
<span class="line"><span style="color:#24292e;">        option tcplog</span></span>
<span class="line"><span style="color:#24292e;">        balance roundrobin</span></span>
<span class="line"><span style="color:#24292e;">    option httpchk OPTIONS /replica</span></span>
<span class="line"><span style="color:#24292e;">    http-check expect status 200</span></span>
<span class="line"><span style="color:#24292e;">    default-server inter 3s fall 3 rise 2 on-marked-down shutdown-sessions</span></span>
<span class="line"><span style="color:#24292e;">        server pg_node1 192.168.210.15:5432 maxconn 1000 check port 8008</span></span>
<span class="line"><span style="color:#24292e;">        server pg_node2 192.168.210.81:5432 maxconn 1000 check port 8008</span></span>
<span class="line"><span style="color:#24292e;">        server pg_node3 192.168.210.33:5432 maxconn 1000 check port 8008</span></span>
<span class="line"><span style="color:#24292e;">EOF</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">#keepalived主节点配置</span></span>
<span class="line"><span style="color:#24292e;">[root@pg_node1 keepalived] mv /etc/keepalived/keepalived.conf /etc/keepalived/keepalived.conf.bak</span></span>
<span class="line"><span style="color:#24292e;">[root@pg_node1 keepalived] cat &gt;&gt; /etc/keepalived/keepalived.conf &lt;&lt;EOF</span></span>
<span class="line"><span style="color:#24292e;">global_defs {</span></span>
<span class="line"><span style="color:#24292e;">    router_id twkp  #虚拟路由名称</span></span>
<span class="line"><span style="color:#24292e;">    script_user root</span></span>
<span class="line"><span style="color:#24292e;">    enable_script_security</span></span>
<span class="line"><span style="color:#24292e;">}</span></span>
<span class="line"><span style="color:#24292e;"> </span></span>
<span class="line"><span style="color:#24292e;">#HAProxy健康检查配置</span></span>
<span class="line"><span style="color:#24292e;">vrrp_script chk_haproxy {</span></span>
<span class="line"><span style="color:#24292e;">    script &quot;/usr/bin/killall -0 haproxy&quot;  #使用killall -0检查haproxy实例是否存在，性能高于ps命令</span></span>
<span class="line"><span style="color:#24292e;">    interval 2   #脚本运行周期</span></span>
<span class="line"><span style="color:#24292e;">    weight 2     #每次检查的加权权重值</span></span>
<span class="line"><span style="color:#24292e;">}</span></span>
<span class="line"><span style="color:#24292e;"> </span></span>
<span class="line"><span style="color:#24292e;">#虚拟路由配置</span></span>
<span class="line"><span style="color:#24292e;">vrrp_instance VI_1 {</span></span>
<span class="line"><span style="color:#24292e;">    state MASTER           #本机实例状态，MASTER/BACKUP，备机配置文件中请写BACKUP</span></span>
<span class="line"><span style="color:#24292e;">    interface eth0         #本机网卡名称，使用ifconfig命令查看</span></span>
<span class="line"><span style="color:#24292e;">    virtual_router_id 88   #虚拟路由编号，主备机保持一致</span></span>
<span class="line"><span style="color:#24292e;">    priority 100           #本机初始权重，备机请填写小于主机的值（例如100）</span></span>
<span class="line"><span style="color:#24292e;">    advert_int 5           #争抢虚地址的周期，秒</span></span>
<span class="line"><span style="color:#24292e;">    virtual_ipaddress {</span></span>
<span class="line"><span style="color:#24292e;">        192.168.210.88     #虚地址IP，主备机保持一致</span></span>
<span class="line"><span style="color:#24292e;">    }</span></span>
<span class="line"><span style="color:#24292e;">    track_script {</span></span>
<span class="line"><span style="color:#24292e;">        chk_haproxy        #对应的健康检查配置</span></span>
<span class="line"><span style="color:#24292e;">    }</span></span>
<span class="line"><span style="color:#24292e;">}</span></span>
<span class="line"><span style="color:#24292e;">EOF</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">#keepalived备节点配置</span></span>
<span class="line"><span style="color:#24292e;">[root@pg_node2 keepalived] mv /etc/keepalived/keepalived.conf /etc/keepalived/keepalived.conf.bak</span></span>
<span class="line"><span style="color:#24292e;">[root@pg_node2 keepalived] cat &gt;&gt; /etc/keepalived/keepalived.conf &lt;&lt;EOF</span></span>
<span class="line"><span style="color:#24292e;">global_defs {</span></span>
<span class="line"><span style="color:#24292e;">    router_id twkp  #虚拟路由名称</span></span>
<span class="line"><span style="color:#24292e;">    script_user root</span></span>
<span class="line"><span style="color:#24292e;">    enable_script_security</span></span>
<span class="line"><span style="color:#24292e;">}</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">#HAProxy健康检查配置</span></span>
<span class="line"><span style="color:#24292e;">vrrp_script chk_haproxy {</span></span>
<span class="line"><span style="color:#24292e;">    script &quot;/usr/bin/killall -0 haproxy&quot;  #使用killall -0检查haproxy实例是否存在，性能高于ps命令</span></span>
<span class="line"><span style="color:#24292e;">    interval 2   #脚本运行周期</span></span>
<span class="line"><span style="color:#24292e;">    weight 2     #每次检查的加权权重值</span></span>
<span class="line"><span style="color:#24292e;">}</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">#虚拟路由配置</span></span>
<span class="line"><span style="color:#24292e;">vrrp_instance VI_1 {</span></span>
<span class="line"><span style="color:#24292e;">    state BACKUP           #本机实例状态，MASTER/BACKUP，备机配置文件中请写BACKUP</span></span>
<span class="line"><span style="color:#24292e;">    interface eth0         #本机网卡名称，使用ifconfig命令查看</span></span>
<span class="line"><span style="color:#24292e;">    virtual_router_id 88   #虚拟路由编号，主备机保持一致</span></span>
<span class="line"><span style="color:#24292e;">    priority 99            #本机初始权重，备机请填写小于主机的值（例如100）</span></span>
<span class="line"><span style="color:#24292e;">    advert_int 5           #争抢虚地址的周期，秒</span></span>
<span class="line"><span style="color:#24292e;">    virtual_ipaddress {</span></span>
<span class="line"><span style="color:#24292e;">        192.168.210.88     #虚地址IP，主备机保持一致</span></span>
<span class="line"><span style="color:#24292e;">    }</span></span>
<span class="line"><span style="color:#24292e;">    track_script {</span></span>
<span class="line"><span style="color:#24292e;">        chk_haproxy        #对应的健康检查配置</span></span>
<span class="line"><span style="color:#24292e;">    }</span></span>
<span class="line"><span style="color:#24292e;">}</span></span>
<span class="line"><span style="color:#24292e;">EOF</span></span></code></pre></div><h3 id="在主备节点依次启动haproxy和keepalived" tabindex="-1">在主备节点依次启动haproxy和keepalived <a class="header-anchor" href="#在主备节点依次启动haproxy和keepalived" aria-label="Permalink to &quot;在主备节点依次启动haproxy和keepalived&quot;">​</a></h3><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">systemctl start haproxy</span></span>
<span class="line"><span style="color:#e1e4e8;">systemctl enable haproxy</span></span>
<span class="line"><span style="color:#e1e4e8;">systemctl start keepalived</span></span>
<span class="line"><span style="color:#e1e4e8;">systemctl enable keepalived</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">systemctl start haproxy</span></span>
<span class="line"><span style="color:#24292e;">systemctl enable haproxy</span></span>
<span class="line"><span style="color:#24292e;">systemctl start keepalived</span></span>
<span class="line"><span style="color:#24292e;">systemctl enable keepalived</span></span></code></pre></div><h3 id="运行状态检查" tabindex="-1">运行状态检查： <a class="header-anchor" href="#运行状态检查" aria-label="Permalink to &quot;运行状态检查：&quot;">​</a></h3><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">systemctl status haproxy</span></span>
<span class="line"><span style="color:#e1e4e8;">systemctl status keepalived</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">[root@pg_node1 patroni]# patronictl list</span></span>
<span class="line"><span style="color:#e1e4e8;">+ Cluster: twpg (6976142033405049133) ---+---------+----+-----------+-----------------+</span></span>
<span class="line"><span style="color:#e1e4e8;">| Member | Host                | Role    | State   | TL | Lag in MB | Pending restart |</span></span>
<span class="line"><span style="color:#e1e4e8;">+--------+---------------------+---------+---------+----+-----------+-----------------+</span></span>
<span class="line"><span style="color:#e1e4e8;">| pg1    | 192.168.210.15:5532 | Leader  | running | 18 |           | *               |</span></span>
<span class="line"><span style="color:#e1e4e8;">| pg2    | 192.168.210.81:5532 | Replica | running | 18 |       0.0 | *               |</span></span>
<span class="line"><span style="color:#e1e4e8;">| pg3    | 192.168.210.33:5532 | Replica | running | 18 |       0.0 | *               |</span></span>
<span class="line"><span style="color:#e1e4e8;">+--------+---------------------+---------+---------+----+-----------+-----------------+</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">#通过haproxy的5001端口访问PG，会轮询连接2个备库</span></span>
<span class="line"><span style="color:#e1e4e8;">#访问pg_node1上的haproxy</span></span>
<span class="line"><span style="color:#e1e4e8;">[root@pg_node1 patroni]# psql &quot;host=192.168.210.15 port=5001 user=postgres dbname=postgres password=Test@123456&quot; -c &#39;select inet_server_addr(),pg_is_in_recovery()&#39;</span></span>
<span class="line"><span style="color:#e1e4e8;"> inet_server_addr | pg_is_in_recovery </span></span>
<span class="line"><span style="color:#e1e4e8;">------------------+-------------------</span></span>
<span class="line"><span style="color:#e1e4e8;"> 192.168.210.81   | t</span></span>
<span class="line"><span style="color:#e1e4e8;">(1 row)</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">[root@pg_node1 patroni]# psql &quot;host=192.168.210.15 port=5001 user=postgres dbname=postgres password=Test@123456&quot; -c &#39;select inet_server_addr(),pg_is_in_recovery()&#39;</span></span>
<span class="line"><span style="color:#e1e4e8;"> inet_server_addr | pg_is_in_recovery </span></span>
<span class="line"><span style="color:#e1e4e8;">------------------+-------------------</span></span>
<span class="line"><span style="color:#e1e4e8;"> 192.168.210.33   | t</span></span>
<span class="line"><span style="color:#e1e4e8;">(1 row)</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">#访问pg_node2上的haproxy</span></span>
<span class="line"><span style="color:#e1e4e8;">[root@pg_node1 patroni]# psql &quot;host=192.168.210.81 port=5001 user=postgres dbname=postgres password=Test@123456&quot; -c &#39;select inet_server_addr(),pg_is_in_recovery()&#39;</span></span>
<span class="line"><span style="color:#e1e4e8;"> inet_server_addr | pg_is_in_recovery </span></span>
<span class="line"><span style="color:#e1e4e8;">------------------+-------------------</span></span>
<span class="line"><span style="color:#e1e4e8;"> 192.168.210.81   | t</span></span>
<span class="line"><span style="color:#e1e4e8;">(1 row)</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">[root@pg_node1 patroni]# psql &quot;host=192.168.210.81 port=5001 user=postgres dbname=postgres password=Test@123456&quot; -c &#39;select inet_server_addr(),pg_is_in_recovery()&#39;</span></span>
<span class="line"><span style="color:#e1e4e8;"> inet_server_addr | pg_is_in_recovery </span></span>
<span class="line"><span style="color:#e1e4e8;">------------------+-------------------</span></span>
<span class="line"><span style="color:#e1e4e8;"> 192.168.210.33   | t</span></span>
<span class="line"><span style="color:#e1e4e8;">(1 row)</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">#通过haproxy的5000端口访问PG主库</span></span>
<span class="line"><span style="color:#e1e4e8;">[root@pg_node1 patroni]# psql &quot;host=192.168.210.15 port=5000 user=postgres dbname=postgres password=Test@123456&quot; -c &#39;select inet_server_addr(),pg_is_in_recovery()&#39;</span></span>
<span class="line"><span style="color:#e1e4e8;"> inet_server_addr | pg_is_in_recovery </span></span>
<span class="line"><span style="color:#e1e4e8;">------------------+-------------------</span></span>
<span class="line"><span style="color:#e1e4e8;"> 192.168.210.15   | f</span></span>
<span class="line"><span style="color:#e1e4e8;">(1 row)</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">[root@pg_node1 patroni]# psql &quot;host=192.168.210.81 port=5000 user=postgres dbname=postgres password=Test@123456&quot; -c &#39;select inet_server_addr(),pg_is_in_recovery()&#39;</span></span>
<span class="line"><span style="color:#e1e4e8;"> inet_server_addr | pg_is_in_recovery </span></span>
<span class="line"><span style="color:#e1e4e8;">------------------+-------------------</span></span>
<span class="line"><span style="color:#e1e4e8;"> 192.168.210.15   | f</span></span>
<span class="line"><span style="color:#e1e4e8;">(1 row)</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">#通过haproxy的VIP:5001端口访问PG，会轮询连接2个备库</span></span>
<span class="line"><span style="color:#e1e4e8;">[root@pg_node1 patroni]# psql &quot;host=192.168.210.88 port=5001 user=postgres dbname=postgres password=Test@123456&quot; -c &#39;select inet_server_addr(),pg_is_in_recovery()&#39;</span></span>
<span class="line"><span style="color:#e1e4e8;"> inet_server_addr | pg_is_in_recovery </span></span>
<span class="line"><span style="color:#e1e4e8;">------------------+-------------------</span></span>
<span class="line"><span style="color:#e1e4e8;"> 192.168.210.81   | t</span></span>
<span class="line"><span style="color:#e1e4e8;">(1 row)</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">[root@pg_node1 patroni]# psql &quot;host=192.168.210.88 port=5001 user=postgres dbname=postgres password=Test@123456&quot; -c &#39;select inet_server_addr(),pg_is_in_recovery()&#39;</span></span>
<span class="line"><span style="color:#e1e4e8;"> inet_server_addr | pg_is_in_recovery </span></span>
<span class="line"><span style="color:#e1e4e8;">------------------+-------------------</span></span>
<span class="line"><span style="color:#e1e4e8;"> 192.168.210.33   | t</span></span>
<span class="line"><span style="color:#e1e4e8;">(1 row)</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">#通过haproxy的VIP:5000端口访问PG主库</span></span>
<span class="line"><span style="color:#e1e4e8;">[root@pg_node1 patroni]# psql &quot;host=192.168.210.88 port=5000 user=postgres dbname=postgres password=Test@123456&quot; -c &#39;select inet_server_addr(),pg_is_in_recovery()&#39;</span></span>
<span class="line"><span style="color:#e1e4e8;"> inet_server_addr | pg_is_in_recovery </span></span>
<span class="line"><span style="color:#e1e4e8;">------------------+-------------------</span></span>
<span class="line"><span style="color:#e1e4e8;"> 192.168.210.15   | f</span></span>
<span class="line"><span style="color:#e1e4e8;">(1 row)</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">systemctl status haproxy</span></span>
<span class="line"><span style="color:#24292e;">systemctl status keepalived</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">[root@pg_node1 patroni]# patronictl list</span></span>
<span class="line"><span style="color:#24292e;">+ Cluster: twpg (6976142033405049133) ---+---------+----+-----------+-----------------+</span></span>
<span class="line"><span style="color:#24292e;">| Member | Host                | Role    | State   | TL | Lag in MB | Pending restart |</span></span>
<span class="line"><span style="color:#24292e;">+--------+---------------------+---------+---------+----+-----------+-----------------+</span></span>
<span class="line"><span style="color:#24292e;">| pg1    | 192.168.210.15:5532 | Leader  | running | 18 |           | *               |</span></span>
<span class="line"><span style="color:#24292e;">| pg2    | 192.168.210.81:5532 | Replica | running | 18 |       0.0 | *               |</span></span>
<span class="line"><span style="color:#24292e;">| pg3    | 192.168.210.33:5532 | Replica | running | 18 |       0.0 | *               |</span></span>
<span class="line"><span style="color:#24292e;">+--------+---------------------+---------+---------+----+-----------+-----------------+</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">#通过haproxy的5001端口访问PG，会轮询连接2个备库</span></span>
<span class="line"><span style="color:#24292e;">#访问pg_node1上的haproxy</span></span>
<span class="line"><span style="color:#24292e;">[root@pg_node1 patroni]# psql &quot;host=192.168.210.15 port=5001 user=postgres dbname=postgres password=Test@123456&quot; -c &#39;select inet_server_addr(),pg_is_in_recovery()&#39;</span></span>
<span class="line"><span style="color:#24292e;"> inet_server_addr | pg_is_in_recovery </span></span>
<span class="line"><span style="color:#24292e;">------------------+-------------------</span></span>
<span class="line"><span style="color:#24292e;"> 192.168.210.81   | t</span></span>
<span class="line"><span style="color:#24292e;">(1 row)</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">[root@pg_node1 patroni]# psql &quot;host=192.168.210.15 port=5001 user=postgres dbname=postgres password=Test@123456&quot; -c &#39;select inet_server_addr(),pg_is_in_recovery()&#39;</span></span>
<span class="line"><span style="color:#24292e;"> inet_server_addr | pg_is_in_recovery </span></span>
<span class="line"><span style="color:#24292e;">------------------+-------------------</span></span>
<span class="line"><span style="color:#24292e;"> 192.168.210.33   | t</span></span>
<span class="line"><span style="color:#24292e;">(1 row)</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">#访问pg_node2上的haproxy</span></span>
<span class="line"><span style="color:#24292e;">[root@pg_node1 patroni]# psql &quot;host=192.168.210.81 port=5001 user=postgres dbname=postgres password=Test@123456&quot; -c &#39;select inet_server_addr(),pg_is_in_recovery()&#39;</span></span>
<span class="line"><span style="color:#24292e;"> inet_server_addr | pg_is_in_recovery </span></span>
<span class="line"><span style="color:#24292e;">------------------+-------------------</span></span>
<span class="line"><span style="color:#24292e;"> 192.168.210.81   | t</span></span>
<span class="line"><span style="color:#24292e;">(1 row)</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">[root@pg_node1 patroni]# psql &quot;host=192.168.210.81 port=5001 user=postgres dbname=postgres password=Test@123456&quot; -c &#39;select inet_server_addr(),pg_is_in_recovery()&#39;</span></span>
<span class="line"><span style="color:#24292e;"> inet_server_addr | pg_is_in_recovery </span></span>
<span class="line"><span style="color:#24292e;">------------------+-------------------</span></span>
<span class="line"><span style="color:#24292e;"> 192.168.210.33   | t</span></span>
<span class="line"><span style="color:#24292e;">(1 row)</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">#通过haproxy的5000端口访问PG主库</span></span>
<span class="line"><span style="color:#24292e;">[root@pg_node1 patroni]# psql &quot;host=192.168.210.15 port=5000 user=postgres dbname=postgres password=Test@123456&quot; -c &#39;select inet_server_addr(),pg_is_in_recovery()&#39;</span></span>
<span class="line"><span style="color:#24292e;"> inet_server_addr | pg_is_in_recovery </span></span>
<span class="line"><span style="color:#24292e;">------------------+-------------------</span></span>
<span class="line"><span style="color:#24292e;"> 192.168.210.15   | f</span></span>
<span class="line"><span style="color:#24292e;">(1 row)</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">[root@pg_node1 patroni]# psql &quot;host=192.168.210.81 port=5000 user=postgres dbname=postgres password=Test@123456&quot; -c &#39;select inet_server_addr(),pg_is_in_recovery()&#39;</span></span>
<span class="line"><span style="color:#24292e;"> inet_server_addr | pg_is_in_recovery </span></span>
<span class="line"><span style="color:#24292e;">------------------+-------------------</span></span>
<span class="line"><span style="color:#24292e;"> 192.168.210.15   | f</span></span>
<span class="line"><span style="color:#24292e;">(1 row)</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">#通过haproxy的VIP:5001端口访问PG，会轮询连接2个备库</span></span>
<span class="line"><span style="color:#24292e;">[root@pg_node1 patroni]# psql &quot;host=192.168.210.88 port=5001 user=postgres dbname=postgres password=Test@123456&quot; -c &#39;select inet_server_addr(),pg_is_in_recovery()&#39;</span></span>
<span class="line"><span style="color:#24292e;"> inet_server_addr | pg_is_in_recovery </span></span>
<span class="line"><span style="color:#24292e;">------------------+-------------------</span></span>
<span class="line"><span style="color:#24292e;"> 192.168.210.81   | t</span></span>
<span class="line"><span style="color:#24292e;">(1 row)</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">[root@pg_node1 patroni]# psql &quot;host=192.168.210.88 port=5001 user=postgres dbname=postgres password=Test@123456&quot; -c &#39;select inet_server_addr(),pg_is_in_recovery()&#39;</span></span>
<span class="line"><span style="color:#24292e;"> inet_server_addr | pg_is_in_recovery </span></span>
<span class="line"><span style="color:#24292e;">------------------+-------------------</span></span>
<span class="line"><span style="color:#24292e;"> 192.168.210.33   | t</span></span>
<span class="line"><span style="color:#24292e;">(1 row)</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">#通过haproxy的VIP:5000端口访问PG主库</span></span>
<span class="line"><span style="color:#24292e;">[root@pg_node1 patroni]# psql &quot;host=192.168.210.88 port=5000 user=postgres dbname=postgres password=Test@123456&quot; -c &#39;select inet_server_addr(),pg_is_in_recovery()&#39;</span></span>
<span class="line"><span style="color:#24292e;"> inet_server_addr | pg_is_in_recovery </span></span>
<span class="line"><span style="color:#24292e;">------------------+-------------------</span></span>
<span class="line"><span style="color:#24292e;"> 192.168.210.15   | f</span></span>
<span class="line"><span style="color:#24292e;">(1 row)</span></span></code></pre></div><p>可以通过它的web接口<a href="http://192.168.210.88:1808/%E6%9F%A5%E7%9C%8B%E7%BB%9F%E8%AE%A1%E6%95%B0%E6%8D%AE" target="_blank" rel="noreferrer">http://192.168.210.88:1808/查看统计数据</a></p><h3 id="模拟pg-node1上的haproxy挂掉" tabindex="-1">模拟pg_node1上的haproxy挂掉 <a class="header-anchor" href="#模拟pg-node1上的haproxy挂掉" aria-label="Permalink to &quot;模拟pg_node1上的haproxy挂掉&quot;">​</a></h3><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">[root@pg_node1 patroni]# ip -o -4 a</span></span>
<span class="line"><span style="color:#e1e4e8;">1: lo    inet 127.0.0.1/8 scope host lo\\       valid_lft forever preferred_lft forever</span></span>
<span class="line"><span style="color:#e1e4e8;">2: eth0    inet 192.168.210.15/24 brd 192.168.210.255 scope global noprefixroute dynamic eth0\\       valid_lft 78520sec preferred_lft 78520sec</span></span>
<span class="line"><span style="color:#e1e4e8;">2: eth0    inet 192.168.210.88/24 scope global secondary eth0\\       valid_lft forever preferred_lft forever</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">#pg_node1节点kill掉haproxy，检查VIP是否漂移到了pg_node2</span></span>
<span class="line"><span style="color:#e1e4e8;">[root@pg_node1 patroni]# ps -ef | grep haproxy | grep -v grep</span></span>
<span class="line"><span style="color:#e1e4e8;">root     13631     1  0 Jun25 ?        00:00:00 /usr/sbin/haproxy-systemd-wrapper -f /etc/haproxy/haproxy.cfg -p /run/haproxy.pid</span></span>
<span class="line"><span style="color:#e1e4e8;">haproxy  13632 13631  0 Jun25 ?        00:00:00 /usr/sbin/haproxy -f /etc/haproxy/haproxy.cfg -p /run/haproxy.pid -Ds</span></span>
<span class="line"><span style="color:#e1e4e8;">haproxy  13633 13632  0 Jun25 ?        00:00:47 /usr/sbin/haproxy -f /etc/haproxy/haproxy.cfg -p /run/haproxy.pid -Ds</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">[root@pg_node1 patroni]# killall haproxy</span></span>
<span class="line"><span style="color:#e1e4e8;">[root@pg_node1 patroni]# ps -ef | grep haproxy | grep -v grep</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">#VIP绑定到了pg_node2</span></span>
<span class="line"><span style="color:#e1e4e8;">[root@pg_node2 ~]# ip -o -4 a</span></span>
<span class="line"><span style="color:#e1e4e8;">1: lo    inet 127.0.0.1/8 scope host lo\\       valid_lft forever preferred_lft forever</span></span>
<span class="line"><span style="color:#e1e4e8;">2: eth0    inet 192.168.210.81/24 brd 192.168.210.255 scope global noprefixroute dynamic eth0\\       valid_lft 69130sec preferred_lft 69130sec</span></span>
<span class="line"><span style="color:#e1e4e8;">2: eth0    inet 192.168.210.88/32 scope global eth0\\       valid_lft forever preferred_lft forever</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">[root@pg_node1 patroni]# ip -o -4 a</span></span>
<span class="line"><span style="color:#24292e;">1: lo    inet 127.0.0.1/8 scope host lo\\       valid_lft forever preferred_lft forever</span></span>
<span class="line"><span style="color:#24292e;">2: eth0    inet 192.168.210.15/24 brd 192.168.210.255 scope global noprefixroute dynamic eth0\\       valid_lft 78520sec preferred_lft 78520sec</span></span>
<span class="line"><span style="color:#24292e;">2: eth0    inet 192.168.210.88/24 scope global secondary eth0\\       valid_lft forever preferred_lft forever</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">#pg_node1节点kill掉haproxy，检查VIP是否漂移到了pg_node2</span></span>
<span class="line"><span style="color:#24292e;">[root@pg_node1 patroni]# ps -ef | grep haproxy | grep -v grep</span></span>
<span class="line"><span style="color:#24292e;">root     13631     1  0 Jun25 ?        00:00:00 /usr/sbin/haproxy-systemd-wrapper -f /etc/haproxy/haproxy.cfg -p /run/haproxy.pid</span></span>
<span class="line"><span style="color:#24292e;">haproxy  13632 13631  0 Jun25 ?        00:00:00 /usr/sbin/haproxy -f /etc/haproxy/haproxy.cfg -p /run/haproxy.pid -Ds</span></span>
<span class="line"><span style="color:#24292e;">haproxy  13633 13632  0 Jun25 ?        00:00:47 /usr/sbin/haproxy -f /etc/haproxy/haproxy.cfg -p /run/haproxy.pid -Ds</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">[root@pg_node1 patroni]# killall haproxy</span></span>
<span class="line"><span style="color:#24292e;">[root@pg_node1 patroni]# ps -ef | grep haproxy | grep -v grep</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">#VIP绑定到了pg_node2</span></span>
<span class="line"><span style="color:#24292e;">[root@pg_node2 ~]# ip -o -4 a</span></span>
<span class="line"><span style="color:#24292e;">1: lo    inet 127.0.0.1/8 scope host lo\\       valid_lft forever preferred_lft forever</span></span>
<span class="line"><span style="color:#24292e;">2: eth0    inet 192.168.210.81/24 brd 192.168.210.255 scope global noprefixroute dynamic eth0\\       valid_lft 69130sec preferred_lft 69130sec</span></span>
<span class="line"><span style="color:#24292e;">2: eth0    inet 192.168.210.88/32 scope global eth0\\       valid_lft forever preferred_lft forever</span></span></code></pre></div><h1 id="八、客户端访问配置" tabindex="-1">八、客户端访问配置 <a class="header-anchor" href="#八、客户端访问配置" aria-label="Permalink to &quot;八、客户端访问配置&quot;">​</a></h1><h1 id="九、故障场景及处理方式" tabindex="-1">九、故障场景及处理方式 <a class="header-anchor" href="#九、故障场景及处理方式" aria-label="Permalink to &quot;九、故障场景及处理方式&quot;">​</a></h1><table><thead><tr><th>故障位置</th><th>故障场景</th><th>patroni动作</th></tr></thead><tbody><tr><td>备库</td><td>PG备库停止</td><td>拉起PG备库服务</td></tr><tr><td>备库</td><td>正常停止备库patroni</td><td>停止PG备库</td></tr><tr><td>备库</td><td>备库patroni异常停止</td><td>无动作</td></tr><tr><td>备库</td><td>备库无法连接ETCD</td><td>无动作</td></tr><tr><td>备库</td><td>非leader角色但PG处于生产模式</td><td>重启PG并切换到恢复模式作为备库</td></tr><tr><td>备库</td><td>备库主机重启</td><td>patroni启动拉起PG备库</td></tr><tr><td>主库</td><td>PG主库停止</td><td>启动PG，如果启动时间超过master_start_timeout，进行主备切换</td></tr><tr><td>主库</td><td>正常停止主库patroni</td><td>关闭主库，从备库中选举新主库</td></tr><tr><td>主库</td><td>主库patroni异常停止</td><td>看门狗重启主机，启动后如果拿到Leader锁，主备不切换，否则选举新主，切换主备</td></tr><tr><td>主库</td><td>主库无法连接ETCD</td><td>主库降级为备库，触发故障转移</td></tr><tr><td>-</td><td>ETCD故障</td><td>主库降级，集群中全部备库</td></tr><tr><td>-</td><td>同步模式下，无可用同步备库</td><td>临时切换为异步模式，在恢复同步模式之前自动故障转移不可用</td></tr></tbody></table><p><a href="https://scalegrid.io/blog/managing-high-availability-in-postgresql-part-3/" target="_blank" rel="noreferrer">https://scalegrid.io/blog/managing-high-availability-in-postgresql-part-3/</a></p><h1 id="十、策略" tabindex="-1">十、策略 <a class="header-anchor" href="#十、策略" aria-label="Permalink to &quot;十、策略&quot;">​</a></h1><h2 id="主从同步策略" tabindex="-1">主从同步策略 <a class="header-anchor" href="#主从同步策略" aria-label="Permalink to &quot;主从同步策略&quot;">​</a></h2><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">#数据库主从之间同步类型</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">Synchronous</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">state</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">of</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">this</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">standby</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">server.</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Possible</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">values</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">are:</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">async:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">This</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">standby</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">server</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">is</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">asynchronous.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">potential:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">This</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">standby</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">server</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">is</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">now</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">asynchronous,</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">but</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">can</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">potentially</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">become</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">synchronous</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">if</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">one</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">of</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">current</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">synchronous</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">ones</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">fails.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">sync:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">This</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">standby</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">server</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">is</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">synchronous.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">quorum:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">This</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">standby</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">server</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">is</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">considered</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">as</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">a</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">candidate</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">for</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">quorum</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">standbys.</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">#数据库主从之间同步类型</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">Synchronous</span><span style="color:#24292E;"> </span><span style="color:#032F62;">state</span><span style="color:#24292E;"> </span><span style="color:#032F62;">of</span><span style="color:#24292E;"> </span><span style="color:#032F62;">this</span><span style="color:#24292E;"> </span><span style="color:#032F62;">standby</span><span style="color:#24292E;"> </span><span style="color:#032F62;">server.</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Possible</span><span style="color:#24292E;"> </span><span style="color:#032F62;">values</span><span style="color:#24292E;"> </span><span style="color:#032F62;">are:</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">async:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">This</span><span style="color:#24292E;"> </span><span style="color:#032F62;">standby</span><span style="color:#24292E;"> </span><span style="color:#032F62;">server</span><span style="color:#24292E;"> </span><span style="color:#032F62;">is</span><span style="color:#24292E;"> </span><span style="color:#032F62;">asynchronous.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">potential:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">This</span><span style="color:#24292E;"> </span><span style="color:#032F62;">standby</span><span style="color:#24292E;"> </span><span style="color:#032F62;">server</span><span style="color:#24292E;"> </span><span style="color:#032F62;">is</span><span style="color:#24292E;"> </span><span style="color:#032F62;">now</span><span style="color:#24292E;"> </span><span style="color:#032F62;">asynchronous,</span><span style="color:#24292E;"> </span><span style="color:#032F62;">but</span><span style="color:#24292E;"> </span><span style="color:#032F62;">can</span><span style="color:#24292E;"> </span><span style="color:#032F62;">potentially</span><span style="color:#24292E;"> </span><span style="color:#032F62;">become</span><span style="color:#24292E;"> </span><span style="color:#032F62;">synchronous</span><span style="color:#24292E;"> </span><span style="color:#032F62;">if</span><span style="color:#24292E;"> </span><span style="color:#032F62;">one</span><span style="color:#24292E;"> </span><span style="color:#032F62;">of</span><span style="color:#24292E;"> </span><span style="color:#032F62;">current</span><span style="color:#24292E;"> </span><span style="color:#032F62;">synchronous</span><span style="color:#24292E;"> </span><span style="color:#032F62;">ones</span><span style="color:#24292E;"> </span><span style="color:#032F62;">fails.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">sync:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">This</span><span style="color:#24292E;"> </span><span style="color:#032F62;">standby</span><span style="color:#24292E;"> </span><span style="color:#032F62;">server</span><span style="color:#24292E;"> </span><span style="color:#032F62;">is</span><span style="color:#24292E;"> </span><span style="color:#032F62;">synchronous.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">quorum:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">This</span><span style="color:#24292E;"> </span><span style="color:#032F62;">standby</span><span style="color:#24292E;"> </span><span style="color:#032F62;">server</span><span style="color:#24292E;"> </span><span style="color:#032F62;">is</span><span style="color:#24292E;"> </span><span style="color:#032F62;">considered</span><span style="color:#24292E;"> </span><span style="color:#032F62;">as</span><span style="color:#24292E;"> </span><span style="color:#032F62;">a</span><span style="color:#24292E;"> </span><span style="color:#032F62;">candidate</span><span style="color:#24292E;"> </span><span style="color:#032F62;">for</span><span style="color:#24292E;"> </span><span style="color:#032F62;">quorum</span><span style="color:#24292E;"> </span><span style="color:#032F62;">standbys.</span></span></code></pre></div><p>数据库级同步配置</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">synchronous_standby_names: &#39;*&#39;</span></span>
<span class="line"><span style="color:#e1e4e8;">synchronous_commit = on</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">synchronous_standby_names: &#39;*&#39;</span></span>
<span class="line"><span style="color:#24292e;">synchronous_commit = on</span></span></code></pre></div><p>patroni同步管理</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">patronictl edit-config -s &#39;synchronous_mode=true&#39;加入节点复制数据限流</span></span>
<span class="line"><span style="color:#e1e4e8;">patronictl edit-config -s &#39;synchronous_mode_strict:true&#39;</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">参数说明:</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">synchronous_mode = true , </span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">为同步模式，只有一个从节点为sync。在failover时sync节点才有资格选为新主。</span></span>
<span class="line"><span style="color:#e1e4e8;">与原来的pg同步不同，原pg服务当所有的从节点不可用是写操作会被堵塞。</span></span>
<span class="line"><span style="color:#e1e4e8;">由patroni 管理的pg 设置为synchronous_mode = true ，当同步从库不可用时主库发生降级。不会影响业务写操作。</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">synchronous_mode_strict:true</span></span>
<span class="line"><span style="color:#e1e4e8;">如果不想发生主库降级，设置此参数。数据安全性会更高。建议一主多从</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">patronictl edit-config -s &#39;synchronous_mode=true&#39;加入节点复制数据限流</span></span>
<span class="line"><span style="color:#24292e;">patronictl edit-config -s &#39;synchronous_mode_strict:true&#39;</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">参数说明:</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">synchronous_mode = true , </span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">为同步模式，只有一个从节点为sync。在failover时sync节点才有资格选为新主。</span></span>
<span class="line"><span style="color:#24292e;">与原来的pg同步不同，原pg服务当所有的从节点不可用是写操作会被堵塞。</span></span>
<span class="line"><span style="color:#24292e;">由patroni 管理的pg 设置为synchronous_mode = true ，当同步从库不可用时主库发生降级。不会影响业务写操作。</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">synchronous_mode_strict:true</span></span>
<span class="line"><span style="color:#24292e;">如果不想发生主库降级，设置此参数。数据安全性会更高。建议一主多从</span></span></code></pre></div><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">patronictl edit-config -s &#39;synchronous_mode=true&#39;</span></span>
<span class="line"><span style="color:#e1e4e8;">patronictl -c /etc/patroni.yml list</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">patronictl edit-config -s &#39;synchronous_mode=true&#39;</span></span>
<span class="line"><span style="color:#24292e;">patronictl -c /etc/patroni.yml list</span></span></code></pre></div><h2 id="异地多机房策略" tabindex="-1">异地多机房策略 <a class="header-anchor" href="#异地多机房策略" aria-label="Permalink to &quot;异地多机房策略&quot;">​</a></h2><p>A. 当异地节点为一个节点。</p><ul><li>备用机房节点在failover时不能选做主</li><li>备用机房节点主从复制采用异步方式</li></ul><p>实现方法： 在yml 中的tag配置如下</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">tags: </span></span>
<span class="line"><span style="color:#e1e4e8;">  nofailover: true # failover 时不能选为主节点</span></span>
<span class="line"><span style="color:#e1e4e8;">  nosync: true # 异步</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">tags: </span></span>
<span class="line"><span style="color:#24292e;">  nofailover: true # failover 时不能选为主节点</span></span>
<span class="line"><span style="color:#24292e;">  nosync: true # 异步</span></span></code></pre></div><p>B. 当异地节点为多个节点时</p><p>1 机房间带宽</p><p>2 机房间网络延迟</p><p>更合理的结构拓扑应该采用数据库级联复制模式</p><p>Standby cluster</p><h2 id="访问认证" tabindex="-1">访问认证 <a class="header-anchor" href="#访问认证" aria-label="Permalink to &quot;访问认证&quot;">​</a></h2><p>DSC 作为集群的配置管理中心，虽然不存储业务数据</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">etcd3：</span></span>
<span class="line"><span style="color:#e1e4e8;">  username: &#39;user&#39;</span></span>
<span class="line"><span style="color:#e1e4e8;">  password: &#39;pwd&#39;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">etcd3：</span></span>
<span class="line"><span style="color:#24292e;">  username: &#39;user&#39;</span></span>
<span class="line"><span style="color:#24292e;">  password: &#39;pwd&#39;</span></span></code></pre></div><ul><li>API 访问认证</li></ul><p>用于patroni可通过API 访问来进行管理，将端口暴露出来不加防护无疑是将管理权拱手相让</p><h2 id="watch-dog" tabindex="-1">watch-dog <a class="header-anchor" href="#watch-dog" aria-label="Permalink to &quot;watch-dog&quot;">​</a></h2><p>基本原理： 当patroni启动后会不停的向watch-dog发送心跳。当watch dog超过一定时间间隔没有收到心跳则认为patroni进程发生意外，watch dog重新系统</p><p>基本配置：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">安装watchdog</span></span>
<span class="line"><span style="color:#e1e4e8;">yum install watchdog -y</span></span>
<span class="line"><span style="color:#e1e4e8;">systemctl start watchdog</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">安装watchdog</span></span>
<span class="line"><span style="color:#24292e;">yum install watchdog -y</span></span>
<span class="line"><span style="color:#24292e;">systemctl start watchdog</span></span></code></pre></div><p>patroni.service</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">ExecStartPre=-/usr/bin/sudo /sbin/modprobe softdog</span></span>
<span class="line"><span style="color:#e1e4e8;">ExecStartPre=-/usr/bin/sudo /bin/chown postgres /dev/watchdog</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">ExecStartPre=-/usr/bin/sudo /sbin/modprobe softdog</span></span>
<span class="line"><span style="color:#24292e;">ExecStartPre=-/usr/bin/sudo /bin/chown postgres /dev/watchdog</span></span></code></pre></div><p>patroni.yml</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">watchdog:</span></span>
<span class="line"><span style="color:#e1e4e8;">  mode: automatic # Allowed values: off, automatic, required</span></span>
<span class="line"><span style="color:#e1e4e8;">  device: /dev/watchdog</span></span>
<span class="line"><span style="color:#e1e4e8;">  safety_margin: 5</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">watchdog:</span></span>
<span class="line"><span style="color:#24292e;">  mode: automatic # Allowed values: off, automatic, required</span></span>
<span class="line"><span style="color:#24292e;">  device: /dev/watchdog</span></span>
<span class="line"><span style="color:#24292e;">  safety_margin: 5</span></span></code></pre></div><h2 id="fencing" tabindex="-1">fencing <a class="header-anchor" href="#fencing" aria-label="Permalink to &quot;fencing&quot;">​</a></h2><p>避免双主问题</p><p>patroni 在主节点网络与dcs不通信发生故障时会降级为只读。但可能存在一个心跳周期的双主。</p><p>更严格的方式是采用pg的同步模式，当主节点发现无任何可用的从库时写操作被hang住。</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">patronictl edit-config -s &#39;synchronous_mode=true&#39;</span></span>
<span class="line"><span style="color:#e1e4e8;">patronictl edit-config -s &#39;synchronous_mode_strict:true&#39;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">patronictl edit-config -s &#39;synchronous_mode=true&#39;</span></span>
<span class="line"><span style="color:#24292e;">patronictl edit-config -s &#39;synchronous_mode_strict:true&#39;</span></span></code></pre></div><p>当集群是一主多从，比如一主4从。可能发生2节点之间互通， 另外3节点之间互通的情况。</p><p>pg 实现请自行结合 pg ‘quorum’ 参数进行考量。具体结合业务数据安全等级要求。</p><p>patroni</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">synchronous_node_count = 1 # default 1</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">synchronous_node_count = 1 # default 1</span></span></code></pre></div><h2 id="dcs失效处理" tabindex="-1">dcs失效处理 <a class="header-anchor" href="#dcs失效处理" aria-label="Permalink to &quot;dcs失效处理&quot;">​</a></h2><p>首先当DCS失效后集群的反应：</p><p>集群变为只读模式，原来集群中的所有pg服务都变为只读。主节点pg也被降级为只读。</p><p>发生上述现在主要是patroni的failover机制。</p><ul><li>主动方式，dcs失效后对现有集群不造成影响。同时也失去了failover能力。</li></ul><p>思路 failover 关闭或延长生效</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">方法一 ： 关闭集群的failover</span></span>
<span class="line"><span style="color:#e1e4e8;"> patronictl -c /etc/patroni.yml pause</span></span>
<span class="line"><span style="color:#e1e4e8;">方法二 ： </span></span>
<span class="line"><span style="color:#e1e4e8;">retry_timeout: timeout for DCS and PostgreSQL operation retries (in seconds). DCS or network issues shorter than this will not cause Patroni to demote the leader. Default value: 10</span></span>
<span class="line"><span style="color:#e1e4e8;">将这个参数的值设置大一些，比如一天</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">方法一 ： 关闭集群的failover</span></span>
<span class="line"><span style="color:#24292e;"> patronictl -c /etc/patroni.yml pause</span></span>
<span class="line"><span style="color:#24292e;">方法二 ： </span></span>
<span class="line"><span style="color:#24292e;">retry_timeout: timeout for DCS and PostgreSQL operation retries (in seconds). DCS or network issues shorter than this will not cause Patroni to demote the leader. Default value: 10</span></span>
<span class="line"><span style="color:#24292e;">将这个参数的值设置大一些，比如一天</span></span></code></pre></div><ul><li>被动方式，DSC已经失效并且短时间内不能修复。已对现有生产造成影响的紧急处理方式。</li></ul><p>思路 pg 脱离patroi 的管理，采用自身流复制</p><h1 id="十一、原理" tabindex="-1">十一、原理 <a class="header-anchor" href="#十一、原理" aria-label="Permalink to &quot;十一、原理&quot;">​</a></h1><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">[ptgres@master patroni]$ etcdctl get / --prefix --keys-only</span></span>
<span class="line"><span style="color:#e1e4e8;">/service/batman/config</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">/service/batman/history</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">/service/batman/initialize</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">/service/batman/leader</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">/service/batman/members/pg12_master</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">/service/batman/members/pg12_slave</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">/service/batman/members/pg12_slave01</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">/service/batman/optime/leader</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">/service/batman/status</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">[ptgres@master patroni]$ etcdctl get / --prefix --keys-only</span></span>
<span class="line"><span style="color:#24292e;">/service/batman/config</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">/service/batman/history</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">/service/batman/initialize</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">/service/batman/leader</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">/service/batman/members/pg12_master</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">/service/batman/members/pg12_slave</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">/service/batman/members/pg12_slave01</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">/service/batman/optime/leader</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">/service/batman/status</span></span></code></pre></div><ul><li>正常时</li></ul><p><img src="`+F+'" alt=""></p><p>在这个图中，我们的数据库是一主两从的流复制架构，节点A是主节点，B和C是从节点。节点A会定期向etcd发送请求以更新领导者密钥，默认情况是10s更新一次（这是由参数loop_wait控制），更新的时候带了一个TTL，前面说过代表着生存时间<strong>TTL &gt; = loop_wait + retry_timeout * 2</strong></p><p>这个机制是这样的，patroni进程每隔10秒(loop_wait)都会更新Leader key还有TTL，如果Leader节点异常导致patroni进程无法及时更新Leader key，则会重新进行2次尝试（retry_timeout）。如果尝试了仍然无效。这个时候时间超过了TTL（生存时间）。领导者密钥就会过期，然后触发新的选举</p><ul><li>master 宕机或patroni进程挂掉</li></ul><p><img src="'+i+`" alt=""></p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">[ptgres@master patroni]$ etcdctl get /service/batman/config</span></span>
<span class="line"><span style="color:#e1e4e8;">/service/batman/config</span></span>
<span class="line"><span style="color:#e1e4e8;">{&quot;ttl&quot;:30,&quot;loop_wait&quot;:10,&quot;retry_timeout&quot;:10,&quot;maximum_lag_on_failover&quot;:1048576,&quot;master_start_timeout&quot;:300,&quot;synchronous_mode&quot;:false,&quot;postgresql&quot;:{&quot;use_pg_rewind&quot;:true,&quot;parameters&quot;:null}}</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">ttl</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">[ptgres@master patroni]$ etcdctl get /service/batman/config</span></span>
<span class="line"><span style="color:#24292e;">/service/batman/config</span></span>
<span class="line"><span style="color:#24292e;">{&quot;ttl&quot;:30,&quot;loop_wait&quot;:10,&quot;retry_timeout&quot;:10,&quot;maximum_lag_on_failover&quot;:1048576,&quot;master_start_timeout&quot;:300,&quot;synchronous_mode&quot;:false,&quot;postgresql&quot;:{&quot;use_pg_rewind&quot;:true,&quot;parameters&quot;:null}}</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">ttl</span></span></code></pre></div><p>之后master 为空</p><p><img src="`+C+'" alt=""></p><p>发生新的选举很简单，节点b和节点c此时会收到通知，当前已经没有领导者了，我们必须举行新的选举</p><p><img src="'+B+'" alt=""></p><p>Patroni之间也通过rest api互相访问。他们首先会和曾经的领导者通信，会发现访问超时，然后他们通过rest api访问Patroni进程知道自己的wal_position位置。假设节点b和节点c现在都处于相同的wal_position，都等于100，那么他们会同时访问etcd，发送创建密钥的请求，然后开始领导争夺战</p><p><img src="'+d+'" alt=""></p><p>两个节点到etcd之间，Node C率先创建了密钥。Node C上面就执行promote，成为了新的主库，Node B将成为新的从库。它会选择从Node C来进行复制。然后Node C就成为了leader</p><p><a href="https://postgres.fun/20200529182600.html" target="_blank" rel="noreferrer">https://postgres.fun/20200529182600.html</a></p><p><a href="http://blog.itpub.net/30496307/viewspace-2764349/" target="_blank" rel="noreferrer">http://blog.itpub.net/30496307/viewspace-2764349/</a></p><p>参考： <a href="https://patroni.readthedocs.io/en/latest/README.html" target="_blank" rel="noreferrer">https://patroni.readthedocs.io/en/latest/README.html</a><a href="https://github.com/zalando/patroni/blob/master/docs/SETTINGS.rst" target="_blank" rel="noreferrer">https://github.com/zalando/patroni/blob/master/docs/SETTINGS.rst</a><a href="https://mp.weixin.qq.com/s/edvWkTb-WF7YyVAFz5GCfw" target="_blank" rel="noreferrer">https://mp.weixin.qq.com/s/edvWkTb-WF7YyVAFz5GCfw</a></p>',270);function _(h,m,A,D,q,v){const s=a("center");return p(),l("div",null,[o(s,null,{default:e(()=>[c("Patroni + Etcd 实现高可用之一: 安装部署")]),_:1}),g])}const w=n(u,[["render",_]]);export{b as __pageData,w as default};
