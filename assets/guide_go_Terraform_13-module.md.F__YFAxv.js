import{_ as s,o as a,c as n,R as l}from"./chunks/framework.zUbWieqp.js";const d=JSON.parse('{"title":"1. 模块的定义","description":"","frontmatter":{},"headers":[],"relativePath":"guide/go/Terraform/13-module.md","filePath":"guide/go/Terraform/13-module.md","lastUpdated":1754397935000}'),p={name:"guide/go/Terraform/13-module.md"},o=l(`<h1 id="_1-模块的定义" tabindex="-1">1. <a href="https://developer.hashicorp.com/terraform/language/values/variables" target="_blank" rel="noreferrer">模块的定义</a> <a class="header-anchor" href="#_1-模块的定义" aria-label="Permalink to &quot;1. [模块的定义](https://developer.hashicorp.com/terraform/language/values/variables)&quot;">​</a></h1><h2 id="_1-1-什么是module" tabindex="-1">1.1 什么是module？ <a class="header-anchor" href="#_1-1-什么是module" aria-label="Permalink to &quot;1.1 什么是module？&quot;">​</a></h2><p>module（模块）是一个在Terraform项目中包含一组代码的<strong>逻辑分组的文件夹</strong>。模块可以调用其他模块，并通过将一个模块的<strong>输出值（output.tf）<strong>传递到另一个模块的</strong>输入值（variable.tf）<strong>来实现模块资源</strong>数据的相互调</strong>用以提升代码的<strong>复用性</strong>。</p><p>Terraform模块是编写高质量Terraform代码，提升代码<strong>复用性</strong>的重要手段。可以说，一个成熟的<strong>生产环境</strong>应该是由数个<strong>可信成熟</strong>的模块组装而成的。</p><p>主要由 3 个文件组成：</p><ul><li><p>main.tf – 定义要创建的资源</p></li><li><p>variables.tf – 定义 main.tf 文件所需的输入变量</p></li><li><p>output.tf – 定义创建的基础设施的输出列表，供其他使用者使用</p></li></ul><h2 id="_1-2-module-工作原理" tabindex="-1">1.2 Module 工作原理 <a class="header-anchor" href="#_1-2-module-工作原理" aria-label="Permalink to &quot;1.2 Module 工作原理&quot;">​</a></h2><ul><li>远程模块：存储到根模块下的.terraform目录中（修改后，必须get/init）</li><li>本地模块：将通过软连接的方式引用本地的源目录（修改后，无需操作）</li></ul><h2 id="_1-3-module-模块优点" tabindex="-1">1.3 Module 模块优点 <a class="header-anchor" href="#_1-3-module-模块优点" aria-label="Permalink to &quot;1.3 Module 模块优点&quot;">​</a></h2><ul><li>解决代码重复问题；</li><li>加强代码可读性，代码整洁性；</li><li>资源标准化；</li><li>减少人为错误发生频率；</li></ul><h2 id="_1-4-定义模块" tabindex="-1">1.4 定义模块 <a class="header-anchor" href="#_1-4-定义模块" aria-label="Permalink to &quot;1.4 定义模块&quot;">​</a></h2><h5 id="module-语法" tabindex="-1"><code>Module</code> 语法 <a class="header-anchor" href="#module-语法" aria-label="Permalink to &quot;\`Module\` 语法&quot;">​</a></h5><ul><li>name：模块的名称，在terraform中可以使用模块名称进行引用</li><li>source：模块代码的路径，本地或者远程的仓库</li><li>version：版本信息；</li></ul><p>把不同云产品放在不同的文件夹下，并在根目录下使用关键词module，就可以理解为定义了一个模块。</p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#9ECBFF;">vim /root/modules/vpc/main.tf</span></span>
<span class="line"></span>
<span class="line"><span style="color:#9ECBFF;">resource &quot;vpc&quot; {</span></span>
<span class="line"><span style="color:#B392F0;">...</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#032F62;">vim /root/modules/vpc/main.tf</span></span>
<span class="line"></span>
<span class="line"><span style="color:#032F62;">resource &quot;vpc&quot; {</span></span>
<span class="line"><span style="color:#6F42C1;">...</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre></div><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#9ECBFF;">vim /root/main.tf</span></span>
<span class="line"></span>
<span class="line"><span style="color:#9ECBFF;">module &quot;vpc&quot; {</span></span>
<span class="line"><span style="color:#B392F0;">...</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#032F62;">vim /root/main.tf</span></span>
<span class="line"></span>
<span class="line"><span style="color:#032F62;">module &quot;vpc&quot; {</span></span>
<span class="line"><span style="color:#6F42C1;">...</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre></div><h2 id="_1-5-引用模块" tabindex="-1">1.5 引用模块 <a class="header-anchor" href="#_1-5-引用模块" aria-label="Permalink to &quot;1.5 引用模块&quot;">​</a></h2><p>引用方式： <code>module.MODULE_NAME.OUTPUT_NAME</code></p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#9ECBFF;">module &quot;vpc&quot; {</span></span>
<span class="line"><span style="color:#E1E4E8;">	</span><span style="color:#9ECBFF;">source = &quot;./modules/vpc&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#9ECBFF;">module &quot;security_groups&quot; {</span></span>
<span class="line"><span style="color:#E1E4E8;">	</span><span style="color:#9ECBFF;">source = &quot;./modules/security_groups&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">	</span><span style="color:#9ECBFF;">vpc_id = module.vpc.vpc_id</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#9ECBFF;">module &quot;ecs&quot; {</span></span>
<span class="line"><span style="color:#E1E4E8;">	</span><span style="color:#9ECBFF;">source = &quot;./modules/ecs&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">	</span><span style="color:#9ECBFF;">security_groups = module.security_groups.security_groups_id</span></span>
<span class="line"><span style="color:#E1E4E8;">	</span><span style="color:#9ECBFF;">vswitch_id = module.vpc.vswitch_id</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#032F62;">module &quot;vpc&quot; {</span></span>
<span class="line"><span style="color:#24292E;">	</span><span style="color:#032F62;">source = &quot;./modules/vpc&quot;</span></span>
<span class="line"><span style="color:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#032F62;">module &quot;security_groups&quot; {</span></span>
<span class="line"><span style="color:#24292E;">	</span><span style="color:#032F62;">source = &quot;./modules/security_groups&quot;</span></span>
<span class="line"><span style="color:#24292E;">	</span><span style="color:#032F62;">vpc_id = module.vpc.vpc_id</span></span>
<span class="line"><span style="color:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#032F62;">module &quot;ecs&quot; {</span></span>
<span class="line"><span style="color:#24292E;">	</span><span style="color:#032F62;">source = &quot;./modules/ecs&quot;</span></span>
<span class="line"><span style="color:#24292E;">	</span><span style="color:#032F62;">security_groups = module.security_groups.security_groups_id</span></span>
<span class="line"><span style="color:#24292E;">	</span><span style="color:#032F62;">vswitch_id = module.vpc.vswitch_id</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre></div><div class="danger custom-block"><p class="custom-block-title">❌ 注意</p><p>每当在代码中<strong>新增、删除或者修改</strong>一个module块之后，都要执行<strong>terraform init</strong>。</p></div><h1 id="_2-案例" tabindex="-1">2. 案例 <a class="header-anchor" href="#_2-案例" aria-label="Permalink to &quot;2. 案例&quot;">​</a></h1><h2 id="_2-1-单云" tabindex="-1">2.1 单云 <a class="header-anchor" href="#_2-1-单云" aria-label="Permalink to &quot;2.1 单云&quot;">​</a></h2><p><img src="https://nnaigos.oss-cn-hangzhou.aliyuncs.com/imgs/20250719221842450.png" alt="image-20250718175602350"></p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">$</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">tree</span><span style="color:#E1E4E8;"> </span></span>
<span class="line"><span style="color:#79B8FF;">.</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#B392F0;">--</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">main.tf</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#B392F0;">--</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">modules</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">   </span><span style="color:#F97583;">|</span><span style="color:#B392F0;">--</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">ecs</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">   </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">   </span><span style="color:#F97583;">|</span><span style="color:#B392F0;">--</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">main.tf</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">   </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">   </span><span style="color:#F97583;">|</span><span style="color:#B392F0;">--</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">outputs.tf</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">   </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">   </span><span style="color:#F97583;">|</span><span style="color:#B392F0;">--</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">variables.tf</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">   </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">   </span><span style="color:#B392F0;">--</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">versions.tf</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">   </span><span style="color:#F97583;">|</span><span style="color:#B392F0;">--</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">nsg</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">   </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">   </span><span style="color:#F97583;">|</span><span style="color:#B392F0;">--</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">main.tf</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">   </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">   </span><span style="color:#F97583;">|</span><span style="color:#B392F0;">--</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">outputs.tf</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">   </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">   </span><span style="color:#F97583;">|</span><span style="color:#B392F0;">--</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">variables.tf</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">   </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">   </span><span style="color:#B392F0;">--</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">versions.tf</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">   </span><span style="color:#B392F0;">--</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">vpc</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">       </span><span style="color:#F97583;">|</span><span style="color:#B392F0;">--</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">main.tf</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">       </span><span style="color:#F97583;">|</span><span style="color:#B392F0;">--</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">outputs.tf</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">       </span><span style="color:#F97583;">|</span><span style="color:#B392F0;">--</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">variables.tf</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">       </span><span style="color:#B392F0;">--</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">versions.tf</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#B392F0;">--</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">output.tf</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#B392F0;">--</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">provider.tf</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#B392F0;">--</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">terraform.tfstate</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#B392F0;">--</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">terraform.tfstate.backup</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#B392F0;">--</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">terraform.tfvars</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#B392F0;">--</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">variables.tf</span></span>
<span class="line"><span style="color:#B392F0;">--</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">version.tf</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">$</span><span style="color:#24292E;"> </span><span style="color:#032F62;">tree</span><span style="color:#24292E;"> </span></span>
<span class="line"><span style="color:#005CC5;">.</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#6F42C1;">--</span><span style="color:#24292E;"> </span><span style="color:#032F62;">main.tf</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#6F42C1;">--</span><span style="color:#24292E;"> </span><span style="color:#032F62;">modules</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;">   </span><span style="color:#D73A49;">|</span><span style="color:#6F42C1;">--</span><span style="color:#24292E;"> </span><span style="color:#032F62;">ecs</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;">   </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">   </span><span style="color:#D73A49;">|</span><span style="color:#6F42C1;">--</span><span style="color:#24292E;"> </span><span style="color:#032F62;">main.tf</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;">   </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">   </span><span style="color:#D73A49;">|</span><span style="color:#6F42C1;">--</span><span style="color:#24292E;"> </span><span style="color:#032F62;">outputs.tf</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;">   </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">   </span><span style="color:#D73A49;">|</span><span style="color:#6F42C1;">--</span><span style="color:#24292E;"> </span><span style="color:#032F62;">variables.tf</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;">   </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">   </span><span style="color:#6F42C1;">--</span><span style="color:#24292E;"> </span><span style="color:#032F62;">versions.tf</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;">   </span><span style="color:#D73A49;">|</span><span style="color:#6F42C1;">--</span><span style="color:#24292E;"> </span><span style="color:#032F62;">nsg</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;">   </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">   </span><span style="color:#D73A49;">|</span><span style="color:#6F42C1;">--</span><span style="color:#24292E;"> </span><span style="color:#032F62;">main.tf</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;">   </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">   </span><span style="color:#D73A49;">|</span><span style="color:#6F42C1;">--</span><span style="color:#24292E;"> </span><span style="color:#032F62;">outputs.tf</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;">   </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">   </span><span style="color:#D73A49;">|</span><span style="color:#6F42C1;">--</span><span style="color:#24292E;"> </span><span style="color:#032F62;">variables.tf</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;">   </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">   </span><span style="color:#6F42C1;">--</span><span style="color:#24292E;"> </span><span style="color:#032F62;">versions.tf</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;">   </span><span style="color:#6F42C1;">--</span><span style="color:#24292E;"> </span><span style="color:#032F62;">vpc</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;">       </span><span style="color:#D73A49;">|</span><span style="color:#6F42C1;">--</span><span style="color:#24292E;"> </span><span style="color:#032F62;">main.tf</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;">       </span><span style="color:#D73A49;">|</span><span style="color:#6F42C1;">--</span><span style="color:#24292E;"> </span><span style="color:#032F62;">outputs.tf</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;">       </span><span style="color:#D73A49;">|</span><span style="color:#6F42C1;">--</span><span style="color:#24292E;"> </span><span style="color:#032F62;">variables.tf</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;">       </span><span style="color:#6F42C1;">--</span><span style="color:#24292E;"> </span><span style="color:#032F62;">versions.tf</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#6F42C1;">--</span><span style="color:#24292E;"> </span><span style="color:#032F62;">output.tf</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#6F42C1;">--</span><span style="color:#24292E;"> </span><span style="color:#032F62;">provider.tf</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#6F42C1;">--</span><span style="color:#24292E;"> </span><span style="color:#032F62;">terraform.tfstate</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#6F42C1;">--</span><span style="color:#24292E;"> </span><span style="color:#032F62;">terraform.tfstate.backup</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#6F42C1;">--</span><span style="color:#24292E;"> </span><span style="color:#032F62;">terraform.tfvars</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#6F42C1;">--</span><span style="color:#24292E;"> </span><span style="color:#032F62;">variables.tf</span></span>
<span class="line"><span style="color:#6F42C1;">--</span><span style="color:#24292E;"> </span><span style="color:#032F62;">version.tf</span></span></code></pre></div><h2 id="_2-2-多云" tabindex="-1">2.2 多云 <a class="header-anchor" href="#_2-2-多云" aria-label="Permalink to &quot;2.2 多云&quot;">​</a></h2>`,25),e=[o];function t(c,r,y,i,E,F){return a(),n("div",null,e)}const m=s(p,[["render",t]]);export{d as __pageData,m as default};
