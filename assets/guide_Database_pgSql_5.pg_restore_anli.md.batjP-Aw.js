import{_ as t,o,c as e,R as s}from"./chunks/framework.zUbWieqp.js";const b=JSON.parse('{"title":"","description":"","frontmatter":{},"headers":[],"relativePath":"guide/Database/pgSql/5.pg_restore_anli.md","filePath":"guide/Database/pgSql/5.pg_restore_anli.md","lastUpdated":1703063387000}'),a={name:"guide/Database/pgSql/5.pg_restore_anli.md"},u=s(`<p>通过pg_restore 导入到测试库时，中途异常中断，造成测试库宕机，而且之后数据无法启动</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">2010-09-17 17:28:03.943 CST,&quot;mydb&quot;,&quot;mydb&quot;,23936,&quot;192.168.1.25:58855&quot;,4c9334a3.5d80,1,&quot;/opt/pgsql/bin/postgres&quot;,2010-09-17 17:28:03 CST,,0,FATAL,57P03,&quot;the database system is in recovery mode&quot;,,,,,,,,  2010-09-17 17:28:03.944 CST,&quot;mydb&quot;,&quot;mydb&quot;,23937,&quot;192.168.1.25:58856&quot;,4c9334a3.5d81,1,&quot;/opt/pgsql/bin/postgres&quot;,2010-09-17 17:28:03 CST,,0,FATAL,57P03,&quot;the database system is in recovery mode&quot;,,,,,,,,  2010-09-17 17:28:03.954 CST,&quot;mydb&quot;,&quot;mydb&quot;,23938,&quot;192.168.1.25:58857&quot;,4c9334a3.5d82,1,&quot;/opt/pgsql/bin/postgres&quot;,2010-09-17 17:28:03 CST,,0,FATAL,57P03,&quot;the database system is in recovery mode&quot;,,,,,,,,  2010-09-17 17:28:03.955 CST,&quot;mydb&quot;,&quot;mydb&quot;,23939,&quot;192.168.1.25:58858&quot;,4c9334a3.5d83,1,&quot;/opt/pgsql/bin/postgres&quot;,2010-09-17 17:28:03 CST,,0,FATAL,57P03,&quot;the database system is in recovery mode&quot;,,,,,,,,  2010-09-17 17:28:03.956 CST,&quot;mydb&quot;,&quot;mydb&quot;,23940,&quot;192.168.1.25:58859&quot;,4c9334a3.5d84,1,&quot;/opt/pgsql/bin/postgres&quot;,2010-09-17 17:28:03 CST,,0,FATAL,57P03,&quot;the database system is in recovery mode&quot;,,,,,,,,  2010-09-17 17:28:04.032 CST,,,32240,,4c932f7d.7df0,9,,2010-09-17 17:06:05 CST,,0,FATAL,53100,&quot;could not write to file &quot;&quot;pg_xlog/xlogtemp.32240&quot;&quot;: No space left on device&quot;,,,,,,,,  2010-09-17 17:28:04.098 CST,,,946,,4c9321d4.3b2,5,,2010-09-17 16:07:48 CST,,0,LOG,00000,&quot;startup process (PID 32240) exited with exit code 1&quot;,,,,,,,,  2010-09-17 17:28:04.098 CST,,,946,,4c9321d4.3b2,6,,2010-09-17 16:07:48 CST,,0,LOG,00000,&quot;aborting startup due to startup process failure&quot;,,,,,,,,</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">2010-09-17 17:28:03.943 CST,&quot;mydb&quot;,&quot;mydb&quot;,23936,&quot;192.168.1.25:58855&quot;,4c9334a3.5d80,1,&quot;/opt/pgsql/bin/postgres&quot;,2010-09-17 17:28:03 CST,,0,FATAL,57P03,&quot;the database system is in recovery mode&quot;,,,,,,,,  2010-09-17 17:28:03.944 CST,&quot;mydb&quot;,&quot;mydb&quot;,23937,&quot;192.168.1.25:58856&quot;,4c9334a3.5d81,1,&quot;/opt/pgsql/bin/postgres&quot;,2010-09-17 17:28:03 CST,,0,FATAL,57P03,&quot;the database system is in recovery mode&quot;,,,,,,,,  2010-09-17 17:28:03.954 CST,&quot;mydb&quot;,&quot;mydb&quot;,23938,&quot;192.168.1.25:58857&quot;,4c9334a3.5d82,1,&quot;/opt/pgsql/bin/postgres&quot;,2010-09-17 17:28:03 CST,,0,FATAL,57P03,&quot;the database system is in recovery mode&quot;,,,,,,,,  2010-09-17 17:28:03.955 CST,&quot;mydb&quot;,&quot;mydb&quot;,23939,&quot;192.168.1.25:58858&quot;,4c9334a3.5d83,1,&quot;/opt/pgsql/bin/postgres&quot;,2010-09-17 17:28:03 CST,,0,FATAL,57P03,&quot;the database system is in recovery mode&quot;,,,,,,,,  2010-09-17 17:28:03.956 CST,&quot;mydb&quot;,&quot;mydb&quot;,23940,&quot;192.168.1.25:58859&quot;,4c9334a3.5d84,1,&quot;/opt/pgsql/bin/postgres&quot;,2010-09-17 17:28:03 CST,,0,FATAL,57P03,&quot;the database system is in recovery mode&quot;,,,,,,,,  2010-09-17 17:28:04.032 CST,,,32240,,4c932f7d.7df0,9,,2010-09-17 17:06:05 CST,,0,FATAL,53100,&quot;could not write to file &quot;&quot;pg_xlog/xlogtemp.32240&quot;&quot;: No space left on device&quot;,,,,,,,,  2010-09-17 17:28:04.098 CST,,,946,,4c9321d4.3b2,5,,2010-09-17 16:07:48 CST,,0,LOG,00000,&quot;startup process (PID 32240) exited with exit code 1&quot;,,,,,,,,  2010-09-17 17:28:04.098 CST,,,946,,4c9321d4.3b2,6,,2010-09-17 16:07:48 CST,,0,LOG,00000,&quot;aborting startup due to startup process failure&quot;,,,,,,,,</span></span></code></pre></div><p>pg_controldata 查看PG SERVER 详细信息</p><p>重要的信息：<code>Latest checkpoint&#39;s NextXID: 0/64282, Latest checkpoint&#39;s NextXID</code> 是指最近一次安全的checkpoints的下一个事务ID，我们可以将数据库恢复到这一时刻</p><p>通过pg_resetxlog 将数据库恢复到事务 64282 时刻</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">[postgres@PG1 bin]$ pg_resetxlog -x 64282 $PGDATA  </span></span>
<span class="line"><span style="color:#e1e4e8;">Transaction log reset</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">[postgres@PG1 bin]$ pg_resetxlog -x 64282 $PGDATA  </span></span>
<span class="line"><span style="color:#24292e;">Transaction log reset</span></span></code></pre></div><p>之前的 pg_restore 中途异常是因为脚本中加了 -j 参数，同时跑多个 pg_restore 线程， 造成 pg_restore 子线程连接丢失，pg_restore 脚本中去掉 -j 参数时，数据库顺利导入</p>`,7),p=[u];function q(d,r,c,i,n,l){return o(),e("div",null,p)}const T=t(a,[["render",q]]);export{b as __pageData,T as default};
