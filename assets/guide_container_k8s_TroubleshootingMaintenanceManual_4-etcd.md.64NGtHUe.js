import{_ as s,o as a,c as n,R as l}from"./chunks/framework.zUbWieqp.js";const d=JSON.parse('{"title":"1. 容器磁盘写满引发的后果","description":"","frontmatter":{},"headers":[],"relativePath":"guide/container/k8s/TroubleshootingMaintenanceManual/4-etcd.md","filePath":"guide/container/k8s/TroubleshootingMaintenanceManual/4-etcd.md","lastUpdated":1723447064000}'),p={name:"guide/container/k8s/TroubleshootingMaintenanceManual/4-etcd.md"},o=l(`<p>文档,<a href="https://etcd.io/docs/v3.4/op-guide/maintenance/" target="_blank" rel="noreferrer">https://etcd.io/docs/v3.4/op-guide/maintenance/</a></p><h1 id="_1-容器磁盘写满引发的后果" tabindex="-1">1. 容器磁盘写满引发的后果 <a class="header-anchor" href="#_1-容器磁盘写满引发的后果" aria-label="Permalink to &quot;1. 容器磁盘写满引发的后果&quot;">​</a></h1><ul><li>Pod 不能删除 (一直 Terminating)</li><li>Pod 不能被创建 (一直 ContainerCreating)</li></ul><h2 id="_1-1-磁盘写满分两种情况" tabindex="-1">1.1 磁盘写满分两种情况 <a class="header-anchor" href="#_1-1-磁盘写满分两种情况" aria-label="Permalink to &quot;1.1 磁盘写满分两种情况&quot;">​</a></h2><h3 id="磁盘空间全部使用完" tabindex="-1">磁盘空间全部使用完 <a class="header-anchor" href="#磁盘空间全部使用完" aria-label="Permalink to &quot;磁盘空间全部使用完&quot;">​</a></h3><h3 id="磁盘-inode-全部使用完" tabindex="-1">磁盘 Inode 全部使用完 <a class="header-anchor" href="#磁盘-inode-全部使用完" aria-label="Permalink to &quot;磁盘 Inode 全部使用完&quot;">​</a></h3><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">df -i</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">df -i</span></span></code></pre></div><p>解决方式:</p><p>1.标记 Node 为不可调度</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">$</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">drain</span><span style="color:#E1E4E8;"> \${node-name}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">$</span><span style="color:#24292E;"> </span><span style="color:#032F62;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">drain</span><span style="color:#24292E;"> \${node-name}</span></span></code></pre></div><p>2.查找那个容器输出日志占用最大</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">for</span><span style="color:#E1E4E8;"> name </span><span style="color:#F97583;">in</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">$(</span><span style="color:#B392F0;">docker</span><span style="color:#9ECBFF;"> ps </span><span style="color:#79B8FF;">-a</span><span style="color:#9ECBFF;">  </span><span style="color:#F97583;">|</span><span style="color:#9ECBFF;"> </span><span style="color:#B392F0;">awk</span><span style="color:#9ECBFF;"> &#39;{print $1}&#39; </span><span style="color:#F97583;">|</span><span style="color:#9ECBFF;"> </span><span style="color:#B392F0;">grep</span><span style="color:#9ECBFF;"> </span><span style="color:#79B8FF;">-v</span><span style="color:#9ECBFF;"> CONTAINER)</span><span style="color:#E1E4E8;">; </span><span style="color:#F97583;">do</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">docker</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">inspect</span><span style="color:#E1E4E8;"> $name </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">grep</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">LogPath</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">awk</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;{print $NF}&#39;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">tr</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-d</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;&quot;,&#39;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#B392F0;">xargs</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">du</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-sh</span><span style="color:#E1E4E8;">;</span><span style="color:#F97583;">done</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#清空日志</span></span>
<span class="line"><span style="color:#79B8FF;">echo</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">xxx.log</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">for</span><span style="color:#24292E;"> name </span><span style="color:#D73A49;">in</span><span style="color:#24292E;"> </span><span style="color:#032F62;">$(</span><span style="color:#6F42C1;">docker</span><span style="color:#032F62;"> ps </span><span style="color:#005CC5;">-a</span><span style="color:#032F62;">  </span><span style="color:#D73A49;">|</span><span style="color:#032F62;"> </span><span style="color:#6F42C1;">awk</span><span style="color:#032F62;"> &#39;{print $1}&#39; </span><span style="color:#D73A49;">|</span><span style="color:#032F62;"> </span><span style="color:#6F42C1;">grep</span><span style="color:#032F62;"> </span><span style="color:#005CC5;">-v</span><span style="color:#032F62;"> CONTAINER)</span><span style="color:#24292E;">; </span><span style="color:#D73A49;">do</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">docker</span><span style="color:#24292E;"> </span><span style="color:#032F62;">inspect</span><span style="color:#24292E;"> $name </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">grep</span><span style="color:#24292E;"> </span><span style="color:#032F62;">LogPath</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">awk</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;{print $NF}&#39;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">tr</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-d</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;&quot;,&#39;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#6F42C1;">xargs</span><span style="color:#24292E;"> </span><span style="color:#032F62;">du</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-sh</span><span style="color:#24292E;">;</span><span style="color:#D73A49;">done</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#清空日志</span></span>
<span class="line"><span style="color:#005CC5;">echo</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">xxx.log</span></span></code></pre></div><blockquote><p>如果磁盘还是没有释放，可以通过 <code>lsof | grep -i delete</code> 查找已删除的文件进程，找到后直接 <code>kill</code> 掉</p></blockquote><p>3.取消不可调度的标记</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">$ kubectl uncordon \${node-name}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">$ kubectl uncordon \${node-name}</span></span></code></pre></div><p>4.定时清理脚本</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">#!/usr/bin/env bash</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">for</span><span style="color:#E1E4E8;"> images_id </span><span style="color:#F97583;">in</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">\`</span><span style="color:#B392F0;">docker</span><span style="color:#9ECBFF;"> images </span><span style="color:#F97583;">|</span><span style="color:#9ECBFF;"> </span><span style="color:#B392F0;">grep</span><span style="color:#9ECBFF;"> &#39;harbor.example.com&#39; </span><span style="color:#F97583;">|</span><span style="color:#9ECBFF;"> </span><span style="color:#B392F0;">awk</span><span style="color:#9ECBFF;"> &#39;{print $3}&#39;\`</span></span>
<span class="line"><span style="color:#F97583;">do</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">docker</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">rmi</span><span style="color:#E1E4E8;"> $images_id</span></span>
<span class="line"><span style="color:#F97583;">done</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 清理 &lt;none&gt; images</span></span>
<span class="line"><span style="color:#F97583;">for</span><span style="color:#E1E4E8;"> images_id_1 </span><span style="color:#F97583;">in</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">\`</span><span style="color:#B392F0;">docker</span><span style="color:#9ECBFF;"> images  </span><span style="color:#F97583;">|</span><span style="color:#9ECBFF;"> </span><span style="color:#B392F0;">awk</span><span style="color:#9ECBFF;"> &#39;$2 ~ &quot;&lt;none&gt;&quot;{print $3}&#39;\`</span></span>
<span class="line"><span style="color:#F97583;">do</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">docker</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">rmi</span><span style="color:#E1E4E8;"> $images_id_1</span></span>
<span class="line"><span style="color:#F97583;">done</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">#!/usr/bin/env bash</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">for</span><span style="color:#24292E;"> images_id </span><span style="color:#D73A49;">in</span><span style="color:#24292E;"> </span><span style="color:#032F62;">\`</span><span style="color:#6F42C1;">docker</span><span style="color:#032F62;"> images </span><span style="color:#D73A49;">|</span><span style="color:#032F62;"> </span><span style="color:#6F42C1;">grep</span><span style="color:#032F62;"> &#39;harbor.example.com&#39; </span><span style="color:#D73A49;">|</span><span style="color:#032F62;"> </span><span style="color:#6F42C1;">awk</span><span style="color:#032F62;"> &#39;{print $3}&#39;\`</span></span>
<span class="line"><span style="color:#D73A49;">do</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">docker</span><span style="color:#24292E;"> </span><span style="color:#032F62;">rmi</span><span style="color:#24292E;"> $images_id</span></span>
<span class="line"><span style="color:#D73A49;">done</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 清理 &lt;none&gt; images</span></span>
<span class="line"><span style="color:#D73A49;">for</span><span style="color:#24292E;"> images_id_1 </span><span style="color:#D73A49;">in</span><span style="color:#24292E;"> </span><span style="color:#032F62;">\`</span><span style="color:#6F42C1;">docker</span><span style="color:#032F62;"> images  </span><span style="color:#D73A49;">|</span><span style="color:#032F62;"> </span><span style="color:#6F42C1;">awk</span><span style="color:#032F62;"> &#39;$2 ~ &quot;&lt;none&gt;&quot;{print $3}&#39;\`</span></span>
<span class="line"><span style="color:#D73A49;">do</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">docker</span><span style="color:#24292E;"> </span><span style="color:#032F62;">rmi</span><span style="color:#24292E;"> $images_id_1</span></span>
<span class="line"><span style="color:#D73A49;">done</span></span></code></pre></div><h2 id="_1-2-查看pod占用磁盘情况" tabindex="-1">1.2 查看Pod占用磁盘情况 <a class="header-anchor" href="#_1-2-查看pod占用磁盘情况" aria-label="Permalink to &quot;1.2 查看Pod占用磁盘情况&quot;">​</a></h2><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">#1.首先在节点上查看dokcer目录使用的空间,得到是docker占用的磁盘。</span></span>
<span class="line"><span style="color:#B392F0;">du</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-sh</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--max-depth</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/var/lib/docker/</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#2.在节点上运行以下命令,可以看到images和container占用信息。</span></span>
<span class="line"><span style="color:#B392F0;">docker</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">system</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">df</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#3.查看每个image、container详细大小</span></span>
<span class="line"><span style="color:#B392F0;">docker</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">system</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">df</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-v</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#4.节点上查看磁盘使用情况,并安装从大到小排序,可以看到各个容器的占用磁盘空间。</span></span>
<span class="line"><span style="color:#B392F0;">docker</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">ps</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-a</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--format</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;table {{.Size}}\\t{{.Names}}&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">sort</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-hr</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">#1.首先在节点上查看dokcer目录使用的空间,得到是docker占用的磁盘。</span></span>
<span class="line"><span style="color:#6F42C1;">du</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-sh</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--max-depth</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/var/lib/docker/</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#2.在节点上运行以下命令,可以看到images和container占用信息。</span></span>
<span class="line"><span style="color:#6F42C1;">docker</span><span style="color:#24292E;"> </span><span style="color:#032F62;">system</span><span style="color:#24292E;"> </span><span style="color:#032F62;">df</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#3.查看每个image、container详细大小</span></span>
<span class="line"><span style="color:#6F42C1;">docker</span><span style="color:#24292E;"> </span><span style="color:#032F62;">system</span><span style="color:#24292E;"> </span><span style="color:#032F62;">df</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-v</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#4.节点上查看磁盘使用情况,并安装从大到小排序,可以看到各个容器的占用磁盘空间。</span></span>
<span class="line"><span style="color:#6F42C1;">docker</span><span style="color:#24292E;"> </span><span style="color:#032F62;">ps</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-a</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--format</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;table {{.Size}}\\t{{.Names}}&quot;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">sort</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-hr</span></span></code></pre></div><h3 id="常用命令" tabindex="-1">常用命令 <a class="header-anchor" href="#常用命令" aria-label="Permalink to &quot;常用命令&quot;">​</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">#1.获取镜像，ID，端口号，状态</span></span>
<span class="line"><span style="color:#B392F0;">docker</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">ps</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-a</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--format</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;table {{.Image}}\\t{{.ID}}\\t{{.Ports}}\\t{{.Status}}&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">sort</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-hr</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#2.列出正在运行的容器</span></span>
<span class="line"><span style="color:#B392F0;">docker</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">ps</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-a</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-f</span><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">&quot;status=running&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#3.列出退出的容器</span></span>
<span class="line"><span style="color:#B392F0;">docker</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">ps</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-a</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-f</span><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">&quot;status=exited&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#4.查看容器磁盘信息</span></span>
<span class="line"><span style="color:#B392F0;">docker</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">ps</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-a</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--format</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;table {{.Size}}\\t{{.Names}}&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">sort</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-hr</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#5.获取容器的IP</span></span>
<span class="line"><span style="color:#B392F0;">docker</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">inspect</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--format=</span><span style="color:#9ECBFF;">&#39;{{range .NetworkSettings.Networks}}{{.IPAddress}}{{end}}&#39;</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">$(</span><span style="color:#B392F0;">docker</span><span style="color:#9ECBFF;"> ps </span><span style="color:#79B8FF;">-q</span><span style="color:#9ECBFF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#6.获取容器的mac地址</span></span>
<span class="line"><span style="color:#B392F0;">docker</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">inspect</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--format=</span><span style="color:#9ECBFF;">&#39;{{range .NetworkSettings.Networks}}{{.MacAddress}}{{end}}&#39;</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">$(</span><span style="color:#B392F0;">docker</span><span style="color:#9ECBFF;"> ps </span><span style="color:#79B8FF;">-a</span><span style="color:#9ECBFF;"> </span><span style="color:#79B8FF;">-q</span><span style="color:#9ECBFF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#7.获取容器name</span></span>
<span class="line"><span style="color:#B392F0;">docker</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">inspect</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--format=</span><span style="color:#9ECBFF;">&#39;{{.Name}}&#39;</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">$(</span><span style="color:#B392F0;">docker</span><span style="color:#9ECBFF;"> ps </span><span style="color:#79B8FF;">-aq</span><span style="color:#9ECBFF;">)</span></span>
<span class="line"><span style="color:#B392F0;">docker</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">inspect</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--format=</span><span style="color:#9ECBFF;">&#39;{{.Name}}&#39;</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">$(</span><span style="color:#B392F0;">docker</span><span style="color:#9ECBFF;"> ps </span><span style="color:#79B8FF;">-aq</span><span style="color:#9ECBFF;">)</span><span style="color:#F97583;">|</span><span style="color:#B392F0;">cut</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-d</span><span style="color:#9ECBFF;">&quot;/&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-f2</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#8.获取容器的Hostname</span></span>
<span class="line"><span style="color:#B392F0;">docker</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">inspect</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--format</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;{{ .Config.Hostname }}&#39;</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">$(</span><span style="color:#B392F0;">docker</span><span style="color:#9ECBFF;"> ps </span><span style="color:#79B8FF;">-q</span><span style="color:#9ECBFF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#9.获取hostname,ip</span></span>
<span class="line"><span style="color:#B392F0;">docker</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">inspect</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--format</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;Hostname:{{ .Config.Hostname }}  Name:{{.Name}} IP:{{range .NetworkSettings.Networks}}{{.IPAddress}}{{end}}&#39;</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">$(</span><span style="color:#B392F0;">docker</span><span style="color:#9ECBFF;"> ps </span><span style="color:#79B8FF;">-q</span><span style="color:#9ECBFF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#10.获取容器的log path</span></span>
<span class="line"><span style="color:#B392F0;">docker</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">inspect</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--format=</span><span style="color:#9ECBFF;">&#39;{{.LogPath}}&#39;</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">\`</span><span style="color:#B392F0;">docker</span><span style="color:#9ECBFF;"> ps </span><span style="color:#79B8FF;">-a</span><span style="color:#9ECBFF;"> </span><span style="color:#79B8FF;">-q</span><span style="color:#9ECBFF;">\`</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#11.获取容器的镜像</span></span>
<span class="line"><span style="color:#B392F0;">docker</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">inspect</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--format=</span><span style="color:#9ECBFF;">&#39;{{.Config.Image}}&#39;</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">\`</span><span style="color:#B392F0;">docker</span><span style="color:#9ECBFF;"> ps </span><span style="color:#79B8FF;">-a</span><span style="color:#9ECBFF;"> </span><span style="color:#79B8FF;">-q</span><span style="color:#9ECBFF;">\`</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">#1.获取镜像，ID，端口号，状态</span></span>
<span class="line"><span style="color:#6F42C1;">docker</span><span style="color:#24292E;"> </span><span style="color:#032F62;">ps</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-a</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--format</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;table {{.Image}}\\t{{.ID}}\\t{{.Ports}}\\t{{.Status}}&quot;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">sort</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-hr</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#2.列出正在运行的容器</span></span>
<span class="line"><span style="color:#6F42C1;">docker</span><span style="color:#24292E;"> </span><span style="color:#032F62;">ps</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-a</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-f</span><span style="color:#24292E;">  </span><span style="color:#032F62;">&quot;status=running&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#3.列出退出的容器</span></span>
<span class="line"><span style="color:#6F42C1;">docker</span><span style="color:#24292E;"> </span><span style="color:#032F62;">ps</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-a</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-f</span><span style="color:#24292E;">  </span><span style="color:#032F62;">&quot;status=exited&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#4.查看容器磁盘信息</span></span>
<span class="line"><span style="color:#6F42C1;">docker</span><span style="color:#24292E;"> </span><span style="color:#032F62;">ps</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-a</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--format</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;table {{.Size}}\\t{{.Names}}&quot;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">sort</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-hr</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#5.获取容器的IP</span></span>
<span class="line"><span style="color:#6F42C1;">docker</span><span style="color:#24292E;"> </span><span style="color:#032F62;">inspect</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--format=</span><span style="color:#032F62;">&#39;{{range .NetworkSettings.Networks}}{{.IPAddress}}{{end}}&#39;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">$(</span><span style="color:#6F42C1;">docker</span><span style="color:#032F62;"> ps </span><span style="color:#005CC5;">-q</span><span style="color:#032F62;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#6.获取容器的mac地址</span></span>
<span class="line"><span style="color:#6F42C1;">docker</span><span style="color:#24292E;"> </span><span style="color:#032F62;">inspect</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--format=</span><span style="color:#032F62;">&#39;{{range .NetworkSettings.Networks}}{{.MacAddress}}{{end}}&#39;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">$(</span><span style="color:#6F42C1;">docker</span><span style="color:#032F62;"> ps </span><span style="color:#005CC5;">-a</span><span style="color:#032F62;"> </span><span style="color:#005CC5;">-q</span><span style="color:#032F62;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#7.获取容器name</span></span>
<span class="line"><span style="color:#6F42C1;">docker</span><span style="color:#24292E;"> </span><span style="color:#032F62;">inspect</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--format=</span><span style="color:#032F62;">&#39;{{.Name}}&#39;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">$(</span><span style="color:#6F42C1;">docker</span><span style="color:#032F62;"> ps </span><span style="color:#005CC5;">-aq</span><span style="color:#032F62;">)</span></span>
<span class="line"><span style="color:#6F42C1;">docker</span><span style="color:#24292E;"> </span><span style="color:#032F62;">inspect</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--format=</span><span style="color:#032F62;">&#39;{{.Name}}&#39;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">$(</span><span style="color:#6F42C1;">docker</span><span style="color:#032F62;"> ps </span><span style="color:#005CC5;">-aq</span><span style="color:#032F62;">)</span><span style="color:#D73A49;">|</span><span style="color:#6F42C1;">cut</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-d</span><span style="color:#032F62;">&quot;/&quot;</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-f2</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#8.获取容器的Hostname</span></span>
<span class="line"><span style="color:#6F42C1;">docker</span><span style="color:#24292E;"> </span><span style="color:#032F62;">inspect</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--format</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;{{ .Config.Hostname }}&#39;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">$(</span><span style="color:#6F42C1;">docker</span><span style="color:#032F62;"> ps </span><span style="color:#005CC5;">-q</span><span style="color:#032F62;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#9.获取hostname,ip</span></span>
<span class="line"><span style="color:#6F42C1;">docker</span><span style="color:#24292E;"> </span><span style="color:#032F62;">inspect</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--format</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;Hostname:{{ .Config.Hostname }}  Name:{{.Name}} IP:{{range .NetworkSettings.Networks}}{{.IPAddress}}{{end}}&#39;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">$(</span><span style="color:#6F42C1;">docker</span><span style="color:#032F62;"> ps </span><span style="color:#005CC5;">-q</span><span style="color:#032F62;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#10.获取容器的log path</span></span>
<span class="line"><span style="color:#6F42C1;">docker</span><span style="color:#24292E;"> </span><span style="color:#032F62;">inspect</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--format=</span><span style="color:#032F62;">&#39;{{.LogPath}}&#39;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">\`</span><span style="color:#6F42C1;">docker</span><span style="color:#032F62;"> ps </span><span style="color:#005CC5;">-a</span><span style="color:#032F62;"> </span><span style="color:#005CC5;">-q</span><span style="color:#032F62;">\`</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#11.获取容器的镜像</span></span>
<span class="line"><span style="color:#6F42C1;">docker</span><span style="color:#24292E;"> </span><span style="color:#032F62;">inspect</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--format=</span><span style="color:#032F62;">&#39;{{.Config.Image}}&#39;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">\`</span><span style="color:#6F42C1;">docker</span><span style="color:#032F62;"> ps </span><span style="color:#005CC5;">-a</span><span style="color:#032F62;"> </span><span style="color:#005CC5;">-q</span><span style="color:#032F62;">\`</span></span></code></pre></div><h1 id="_2-etcd磁盘写满" tabindex="-1">2. etcd磁盘写满 <a class="header-anchor" href="#_2-etcd磁盘写满" aria-label="Permalink to &quot;2. etcd磁盘写满&quot;">​</a></h1><h2 id="_2-1-在容器中操作" tabindex="-1">2.1 在容器中操作 <a class="header-anchor" href="#_2-1-在容器中操作" aria-label="Permalink to &quot;2.1 在容器中操作&quot;">​</a></h2><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;"># etcdctl endpoint status --write-out=table</span></span>
<span class="line"><span style="color:#B392F0;">+----------------+------------------+---------+---------+-----------+------------+-----------+------------+--------------------+--------------------------------+</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">ENDPOINT</span><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">        </span><span style="color:#B392F0;">ID</span><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">VERSION</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">DB</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">SIZE</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">IS</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">LEADER</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">IS</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">LEARNER</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">RAFT</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">TERM</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">RAFT</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">INDEX</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">RAFT</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">APPLIED</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">INDEX</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">             </span><span style="color:#B392F0;">ERRORS</span><span style="color:#E1E4E8;">             </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#B392F0;">+----------------+------------------+---------+---------+-----------+------------+-----------+------------+--------------------+--------------------------------+</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">127.0.0.1:2379</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">5a62a94db08693c1</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">3.4.14</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">2.1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">GB</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">     </span><span style="color:#79B8FF;">false</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">      </span><span style="color:#79B8FF;">false</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">        </span><span style="color:#B392F0;">55</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">6115946</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">            </span><span style="color:#B392F0;">6115946</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">   </span><span style="color:#B392F0;">memberID:9834606138033252550</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">                </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">                  </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">         </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">         </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">           </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">            </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">           </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">            </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">                    </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">                 </span><span style="color:#B392F0;">alarm:NOSPACE</span><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#B392F0;">+----------------+------------------+---------+---------+-----------+------------+-----------+------------+--------------------+--------------------------------+</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># etcdctl alarm list</span></span>
<span class="line"><span style="color:#B392F0;">memberID:9834606138033252550</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">alarm:NOSPACE</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#获取etcd数据历史版本号</span></span>
<span class="line"><span style="color:#B392F0;">etcdctl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">endpoint</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">status</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--write-out=</span><span style="color:#9ECBFF;">&quot;json&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">egrep</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-o</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;&quot;revision&quot;:[0-9]*&#39;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">egrep</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-o</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;[0-9].*&#39;</span></span>
<span class="line"><span style="color:#B392F0;">6115560</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#压缩旧版本</span></span>
<span class="line"><span style="color:#6A737D;"># etcdctl compact 6115560</span></span>
<span class="line"><span style="color:#B392F0;">compacted</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">revision</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">6115560</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#整理磁盘碎片</span></span>
<span class="line"><span style="color:#6A737D;"># etcdctl defrag</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#查看etcd db大小</span></span>
<span class="line"><span style="color:#6A737D;"># etcdctl endpoint status --write-out=table</span></span>
<span class="line"><span style="color:#B392F0;">+----------------+------------------+---------+---------+-----------+------------+-----------+------------+--------------------+--------------------------------+</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">ENDPOINT</span><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">        </span><span style="color:#B392F0;">ID</span><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">VERSION</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">DB</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">SIZE</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">IS</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">LEADER</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">IS</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">LEARNER</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">RAFT</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">TERM</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">RAFT</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">INDEX</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">RAFT</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">APPLIED</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">INDEX</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">             </span><span style="color:#B392F0;">ERRORS</span><span style="color:#E1E4E8;">             </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#B392F0;">+----------------+------------------+---------+---------+-----------+------------+-----------+------------+--------------------+--------------------------------+</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">127.0.0.1:2379</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">5a62a94db08693c1</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">3.4.14</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">4.1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">MB</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">     </span><span style="color:#79B8FF;">false</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">      </span><span style="color:#79B8FF;">false</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">        </span><span style="color:#B392F0;">55</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">6116017</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">            </span><span style="color:#B392F0;">6116017</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">   </span><span style="color:#B392F0;">memberID:9834606138033252550</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">                </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">                  </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">         </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">         </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">           </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">            </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">           </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">            </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">                    </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">                 </span><span style="color:#B392F0;">alarm:NOSPACE</span><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#B392F0;">+----------------+------------------+---------+---------+-----------+------------+-----------+------------+--------------------+--------------------------------+</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#解除告警</span></span>
<span class="line"><span style="color:#6A737D;"># etcdctl alarm disarm</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;"># etcdctl endpoint status --write-out=table</span></span>
<span class="line"><span style="color:#6F42C1;">+----------------+------------------+---------+---------+-----------+------------+-----------+------------+--------------------+--------------------------------+</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;">    </span><span style="color:#6F42C1;">ENDPOINT</span><span style="color:#24292E;">    </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">        </span><span style="color:#6F42C1;">ID</span><span style="color:#24292E;">        </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">VERSION</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">DB</span><span style="color:#24292E;"> </span><span style="color:#032F62;">SIZE</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">IS</span><span style="color:#24292E;"> </span><span style="color:#032F62;">LEADER</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">IS</span><span style="color:#24292E;"> </span><span style="color:#032F62;">LEARNER</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">RAFT</span><span style="color:#24292E;"> </span><span style="color:#032F62;">TERM</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">RAFT</span><span style="color:#24292E;"> </span><span style="color:#032F62;">INDEX</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">RAFT</span><span style="color:#24292E;"> </span><span style="color:#032F62;">APPLIED</span><span style="color:#24292E;"> </span><span style="color:#032F62;">INDEX</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">             </span><span style="color:#6F42C1;">ERRORS</span><span style="color:#24292E;">             </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#6F42C1;">+----------------+------------------+---------+---------+-----------+------------+-----------+------------+--------------------+--------------------------------+</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">127.0.0.1:2379</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">5a62a94db08693c1</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">  </span><span style="color:#6F42C1;">3.4.14</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">  </span><span style="color:#6F42C1;">2.1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">GB</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">     </span><span style="color:#005CC5;">false</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">      </span><span style="color:#005CC5;">false</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">        </span><span style="color:#6F42C1;">55</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">    </span><span style="color:#6F42C1;">6115946</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">            </span><span style="color:#6F42C1;">6115946</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">   </span><span style="color:#6F42C1;">memberID:9834606138033252550</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;">                </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">                  </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">         </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">         </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">           </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">            </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">           </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">            </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">                    </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">                 </span><span style="color:#6F42C1;">alarm:NOSPACE</span><span style="color:#24292E;">  </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#6F42C1;">+----------------+------------------+---------+---------+-----------+------------+-----------+------------+--------------------+--------------------------------+</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># etcdctl alarm list</span></span>
<span class="line"><span style="color:#6F42C1;">memberID:9834606138033252550</span><span style="color:#24292E;"> </span><span style="color:#032F62;">alarm:NOSPACE</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#获取etcd数据历史版本号</span></span>
<span class="line"><span style="color:#6F42C1;">etcdctl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">endpoint</span><span style="color:#24292E;"> </span><span style="color:#032F62;">status</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--write-out=</span><span style="color:#032F62;">&quot;json&quot;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">egrep</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-o</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;&quot;revision&quot;:[0-9]*&#39;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">egrep</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-o</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;[0-9].*&#39;</span></span>
<span class="line"><span style="color:#6F42C1;">6115560</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#压缩旧版本</span></span>
<span class="line"><span style="color:#6A737D;"># etcdctl compact 6115560</span></span>
<span class="line"><span style="color:#6F42C1;">compacted</span><span style="color:#24292E;"> </span><span style="color:#032F62;">revision</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">6115560</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#整理磁盘碎片</span></span>
<span class="line"><span style="color:#6A737D;"># etcdctl defrag</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#查看etcd db大小</span></span>
<span class="line"><span style="color:#6A737D;"># etcdctl endpoint status --write-out=table</span></span>
<span class="line"><span style="color:#6F42C1;">+----------------+------------------+---------+---------+-----------+------------+-----------+------------+--------------------+--------------------------------+</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;">    </span><span style="color:#6F42C1;">ENDPOINT</span><span style="color:#24292E;">    </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">        </span><span style="color:#6F42C1;">ID</span><span style="color:#24292E;">        </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">VERSION</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">DB</span><span style="color:#24292E;"> </span><span style="color:#032F62;">SIZE</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">IS</span><span style="color:#24292E;"> </span><span style="color:#032F62;">LEADER</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">IS</span><span style="color:#24292E;"> </span><span style="color:#032F62;">LEARNER</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">RAFT</span><span style="color:#24292E;"> </span><span style="color:#032F62;">TERM</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">RAFT</span><span style="color:#24292E;"> </span><span style="color:#032F62;">INDEX</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">RAFT</span><span style="color:#24292E;"> </span><span style="color:#032F62;">APPLIED</span><span style="color:#24292E;"> </span><span style="color:#032F62;">INDEX</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">             </span><span style="color:#6F42C1;">ERRORS</span><span style="color:#24292E;">             </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#6F42C1;">+----------------+------------------+---------+---------+-----------+------------+-----------+------------+--------------------+--------------------------------+</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">127.0.0.1:2379</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">5a62a94db08693c1</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">  </span><span style="color:#6F42C1;">3.4.14</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">  </span><span style="color:#6F42C1;">4.1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">MB</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">     </span><span style="color:#005CC5;">false</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">      </span><span style="color:#005CC5;">false</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">        </span><span style="color:#6F42C1;">55</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">    </span><span style="color:#6F42C1;">6116017</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">            </span><span style="color:#6F42C1;">6116017</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">   </span><span style="color:#6F42C1;">memberID:9834606138033252550</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#D73A49;">|</span><span style="color:#24292E;">                </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">                  </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">         </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">         </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">           </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">            </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">           </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">            </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">                    </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">                 </span><span style="color:#6F42C1;">alarm:NOSPACE</span><span style="color:#24292E;">  </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#6F42C1;">+----------------+------------------+---------+---------+-----------+------------+-----------+------------+--------------------+--------------------------------+</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#解除告警</span></span>
<span class="line"><span style="color:#6A737D;"># etcdctl alarm disarm</span></span></code></pre></div><h2 id="_2-2-外部访问etcd" tabindex="-1">2.2 外部访问etcd <a class="header-anchor" href="#_2-2-外部访问etcd" aria-label="Permalink to &quot;2.2 外部访问etcd&quot;">​</a></h2><h3 id="_2-2-1-安装" tabindex="-1">2.2.1 安装 <a class="header-anchor" href="#_2-2-1-安装" aria-label="Permalink to &quot;2.2.1 安装&quot;">​</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">ETCD_VER</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">v3.5.14</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># choose either URL</span></span>
<span class="line"><span style="color:#E1E4E8;">GOOGLE_URL</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">https://storage.googleapis.com/etcd</span></span>
<span class="line"><span style="color:#E1E4E8;">GITHUB_URL</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">https://github.com/etcd-io/etcd/releases/download</span></span>
<span class="line"><span style="color:#E1E4E8;">DOWNLOAD_URL</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">\${GOOGLE_URL}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">rm</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-f</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/tmp/etcd-</span><span style="color:#E1E4E8;">\${ETCD_VER}</span><span style="color:#9ECBFF;">-linux-amd64.tar.gz</span></span>
<span class="line"><span style="color:#B392F0;">rm</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-rf</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/tmp/etcd-download-test</span><span style="color:#E1E4E8;"> &amp;&amp; </span><span style="color:#B392F0;">mkdir</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-p</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/tmp/etcd-download-test</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">curl</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-L</span><span style="color:#E1E4E8;"> \${DOWNLOAD_URL}</span><span style="color:#9ECBFF;">/</span><span style="color:#E1E4E8;">\${ETCD_VER}</span><span style="color:#9ECBFF;">/etcd-</span><span style="color:#E1E4E8;">\${ETCD_VER}</span><span style="color:#9ECBFF;">-linux-amd64.tar.gz</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-o</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/tmp/etcd-</span><span style="color:#E1E4E8;">\${ETCD_VER}</span><span style="color:#9ECBFF;">-linux-amd64.tar.gz</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">tar</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">xzvf</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/tmp/etcd-</span><span style="color:#E1E4E8;">\${ETCD_VER}</span><span style="color:#9ECBFF;">-linux-amd64.tar.gz</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-C</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/tmp/etcd-download-test</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--strip-components=1</span></span>
<span class="line"><span style="color:#B392F0;">rm</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-f</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/tmp/etcd-</span><span style="color:#E1E4E8;">\${ETCD_VER}</span><span style="color:#9ECBFF;">-linux-amd64.tar.gz</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">/tmp/etcd-download-test/etcd</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--version</span></span>
<span class="line"><span style="color:#B392F0;">/tmp/etcd-download-test/etcdctl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">version</span></span>
<span class="line"><span style="color:#B392F0;">/tmp/etcd-download-test/etcdutl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">version</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">ETCD_VER</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">v3.5.14</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># choose either URL</span></span>
<span class="line"><span style="color:#24292E;">GOOGLE_URL</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">https://storage.googleapis.com/etcd</span></span>
<span class="line"><span style="color:#24292E;">GITHUB_URL</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">https://github.com/etcd-io/etcd/releases/download</span></span>
<span class="line"><span style="color:#24292E;">DOWNLOAD_URL</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">\${GOOGLE_URL}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">rm</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-f</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/tmp/etcd-</span><span style="color:#24292E;">\${ETCD_VER}</span><span style="color:#032F62;">-linux-amd64.tar.gz</span></span>
<span class="line"><span style="color:#6F42C1;">rm</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-rf</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/tmp/etcd-download-test</span><span style="color:#24292E;"> &amp;&amp; </span><span style="color:#6F42C1;">mkdir</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-p</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/tmp/etcd-download-test</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">curl</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-L</span><span style="color:#24292E;"> \${DOWNLOAD_URL}</span><span style="color:#032F62;">/</span><span style="color:#24292E;">\${ETCD_VER}</span><span style="color:#032F62;">/etcd-</span><span style="color:#24292E;">\${ETCD_VER}</span><span style="color:#032F62;">-linux-amd64.tar.gz</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-o</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/tmp/etcd-</span><span style="color:#24292E;">\${ETCD_VER}</span><span style="color:#032F62;">-linux-amd64.tar.gz</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">tar</span><span style="color:#24292E;"> </span><span style="color:#032F62;">xzvf</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/tmp/etcd-</span><span style="color:#24292E;">\${ETCD_VER}</span><span style="color:#032F62;">-linux-amd64.tar.gz</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-C</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/tmp/etcd-download-test</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--strip-components=1</span></span>
<span class="line"><span style="color:#6F42C1;">rm</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-f</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/tmp/etcd-</span><span style="color:#24292E;">\${ETCD_VER}</span><span style="color:#032F62;">-linux-amd64.tar.gz</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">/tmp/etcd-download-test/etcd</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--version</span></span>
<span class="line"><span style="color:#6F42C1;">/tmp/etcd-download-test/etcdctl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">version</span></span>
<span class="line"><span style="color:#6F42C1;">/tmp/etcd-download-test/etcdutl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">version</span></span></code></pre></div><h2 id="_2-3-解决方式" tabindex="-1">2.3 解决方式 <a class="header-anchor" href="#_2-3-解决方式" aria-label="Permalink to &quot;2.3 解决方式&quot;">​</a></h2><h3 id="增加容量" tabindex="-1">增加容量 <a class="header-anchor" href="#增加容量" aria-label="Permalink to &quot;增加容量&quot;">​</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">--auto-compaction-mode</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">revision</span><span style="color:#E1E4E8;"> --auto-compaction-retention</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">1000</span><span style="color:#E1E4E8;"> --quota-backend-bytes</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">8589934592</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">auto-compaction-mode</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">revision</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">按版本号压缩</span></span>
<span class="line"><span style="color:#E1E4E8;">auto-compaction-retention</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">1000</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">保留近1000个revision，每5分钟自动压缩</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">”latest</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">revision”</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">-</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">1000</span></span>
<span class="line"><span style="color:#B392F0;">quota-backend-bytes</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">设置etcd最大容量为8G</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">--auto-compaction-mode</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">revision</span><span style="color:#24292E;"> --auto-compaction-retention</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">1000</span><span style="color:#24292E;"> --quota-backend-bytes</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">8589934592</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">auto-compaction-mode</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">revision</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">按版本号压缩</span></span>
<span class="line"><span style="color:#24292E;">auto-compaction-retention</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">1000</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">保留近1000个revision，每5分钟自动压缩</span><span style="color:#24292E;"> </span><span style="color:#032F62;">”latest</span><span style="color:#24292E;"> </span><span style="color:#032F62;">revision”</span><span style="color:#24292E;"> </span><span style="color:#032F62;">-</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1000</span></span>
<span class="line"><span style="color:#6F42C1;">quota-backend-bytes</span><span style="color:#24292E;"> </span><span style="color:#032F62;">设置etcd最大容量为8G</span></span></code></pre></div><h3 id="清理老数据" tabindex="-1">清理老数据 <a class="header-anchor" href="#清理老数据" aria-label="Permalink to &quot;清理老数据&quot;">​</a></h3><ul><li>设置环境变量</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">ETCD_CA_CERT</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&quot;/etc/kubernetes/pki/etcd/ca.crt&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">ETCD_CERT</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&quot;/etc/kubernetes/pki/etcd/server.crt&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">ETCD_KEY</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&quot;/etc/kubernetes/pki/etcd/server.key&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">HOST_1</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">https://xxx.xxx.xxx.xxx:2379</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">ETCD_CA_CERT</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&quot;/etc/kubernetes/pki/etcd/ca.crt&quot;</span></span>
<span class="line"><span style="color:#24292E;">ETCD_CERT</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&quot;/etc/kubernetes/pki/etcd/server.crt&quot;</span></span>
<span class="line"><span style="color:#24292E;">ETCD_KEY</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&quot;/etc/kubernetes/pki/etcd/server.key&quot;</span></span>
<span class="line"><span style="color:#24292E;">HOST_1</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">https://xxx.xxx.xxx.xxx:2379</span></span></code></pre></div><ul><li>获取当前etcd数据的修订版本(revision)</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">rev</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">$(</span><span style="color:#E1E4E8;">ETCDCTL_API</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">3</span><span style="color:#9ECBFF;"> </span><span style="color:#B392F0;">etcdctl</span><span style="color:#9ECBFF;">  </span><span style="color:#79B8FF;">--cacert=</span><span style="color:#9ECBFF;">&quot;\${</span><span style="color:#E1E4E8;">ETCD_CA_CERT</span><span style="color:#9ECBFF;">}&quot; </span><span style="color:#79B8FF;">--cert=</span><span style="color:#9ECBFF;">&quot;\${</span><span style="color:#E1E4E8;">ETCD_CERT</span><span style="color:#9ECBFF;">}&quot; </span><span style="color:#79B8FF;">--key=</span><span style="color:#9ECBFF;">&quot;\${</span><span style="color:#E1E4E8;">ETCD_KEY</span><span style="color:#9ECBFF;">}&quot; </span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#9ECBFF;">  </span><span style="color:#79B8FF;">--endpoints=</span><span style="color:#9ECBFF;">&quot;\${</span><span style="color:#E1E4E8;">HOST_1</span><span style="color:#9ECBFF;">}&quot; endpoint status </span><span style="color:#79B8FF;">--write-out=</span><span style="color:#9ECBFF;">&quot;json&quot; </span><span style="color:#F97583;">|</span><span style="color:#9ECBFF;"> </span><span style="color:#B392F0;">egrep</span><span style="color:#9ECBFF;"> </span><span style="color:#79B8FF;">-o</span><span style="color:#9ECBFF;"> &#39;&quot;revision&quot;:[0-9]*&#39; </span><span style="color:#F97583;">|</span><span style="color:#9ECBFF;"> </span><span style="color:#B392F0;">egrep</span><span style="color:#9ECBFF;"> </span><span style="color:#79B8FF;">-o</span><span style="color:#9ECBFF;"> &#39;[0-9].*&#39;)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#79B8FF;">echo</span><span style="color:#E1E4E8;"> $rev</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">rev</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">$(</span><span style="color:#24292E;">ETCDCTL_API</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">3</span><span style="color:#032F62;"> </span><span style="color:#6F42C1;">etcdctl</span><span style="color:#032F62;">  </span><span style="color:#005CC5;">--cacert=</span><span style="color:#032F62;">&quot;\${</span><span style="color:#24292E;">ETCD_CA_CERT</span><span style="color:#032F62;">}&quot; </span><span style="color:#005CC5;">--cert=</span><span style="color:#032F62;">&quot;\${</span><span style="color:#24292E;">ETCD_CERT</span><span style="color:#032F62;">}&quot; </span><span style="color:#005CC5;">--key=</span><span style="color:#032F62;">&quot;\${</span><span style="color:#24292E;">ETCD_KEY</span><span style="color:#032F62;">}&quot; </span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#032F62;">  </span><span style="color:#005CC5;">--endpoints=</span><span style="color:#032F62;">&quot;\${</span><span style="color:#24292E;">HOST_1</span><span style="color:#032F62;">}&quot; endpoint status </span><span style="color:#005CC5;">--write-out=</span><span style="color:#032F62;">&quot;json&quot; </span><span style="color:#D73A49;">|</span><span style="color:#032F62;"> </span><span style="color:#6F42C1;">egrep</span><span style="color:#032F62;"> </span><span style="color:#005CC5;">-o</span><span style="color:#032F62;"> &#39;&quot;revision&quot;:[0-9]*&#39; </span><span style="color:#D73A49;">|</span><span style="color:#032F62;"> </span><span style="color:#6F42C1;">egrep</span><span style="color:#032F62;"> </span><span style="color:#005CC5;">-o</span><span style="color:#032F62;"> &#39;[0-9].*&#39;)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#005CC5;">echo</span><span style="color:#24292E;"> $rev</span></span></code></pre></div><ul><li>整合压缩旧版本数据</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">ETCDCTL_API</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">3</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">etcdctl</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--cacert=</span><span style="color:#9ECBFF;">&quot;\${</span><span style="color:#E1E4E8;">ETCD_CA_CERT</span><span style="color:#9ECBFF;">}&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--cert=</span><span style="color:#9ECBFF;">&quot;\${</span><span style="color:#E1E4E8;">ETCD_CERT</span><span style="color:#9ECBFF;">}&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--key=</span><span style="color:#9ECBFF;">&quot;\${</span><span style="color:#E1E4E8;">ETCD_KEY</span><span style="color:#9ECBFF;">}&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">--endpoints=</span><span style="color:#9ECBFF;">&quot;\${</span><span style="color:#E1E4E8;">HOST_1</span><span style="color:#9ECBFF;">}&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">compact</span><span style="color:#E1E4E8;"> $rev</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">ETCDCTL_API</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">3</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">etcdctl</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--cacert=</span><span style="color:#032F62;">&quot;\${</span><span style="color:#24292E;">ETCD_CA_CERT</span><span style="color:#032F62;">}&quot;</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--cert=</span><span style="color:#032F62;">&quot;\${</span><span style="color:#24292E;">ETCD_CERT</span><span style="color:#032F62;">}&quot;</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--key=</span><span style="color:#032F62;">&quot;\${</span><span style="color:#24292E;">ETCD_KEY</span><span style="color:#032F62;">}&quot;</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#005CC5;">--endpoints=</span><span style="color:#032F62;">&quot;\${</span><span style="color:#24292E;">HOST_1</span><span style="color:#032F62;">}&quot;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">compact</span><span style="color:#24292E;"> $rev</span></span></code></pre></div><ul><li>执行碎片整理</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">ETCDCTL_API</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">3</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">etcdctl</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--cacert=</span><span style="color:#9ECBFF;">&quot;\${</span><span style="color:#E1E4E8;">ETCD_CA_CERT</span><span style="color:#9ECBFF;">}&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--cert=</span><span style="color:#9ECBFF;">&quot;\${</span><span style="color:#E1E4E8;">ETCD_CERT</span><span style="color:#9ECBFF;">}&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--key=</span><span style="color:#9ECBFF;">&quot;\${</span><span style="color:#E1E4E8;">ETCD_KEY</span><span style="color:#9ECBFF;">}&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">--endpoints=</span><span style="color:#9ECBFF;">&quot;\${</span><span style="color:#E1E4E8;">HOST_1</span><span style="color:#9ECBFF;">}&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">defrag</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">ETCDCTL_API</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">3</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">etcdctl</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--cacert=</span><span style="color:#032F62;">&quot;\${</span><span style="color:#24292E;">ETCD_CA_CERT</span><span style="color:#032F62;">}&quot;</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--cert=</span><span style="color:#032F62;">&quot;\${</span><span style="color:#24292E;">ETCD_CERT</span><span style="color:#032F62;">}&quot;</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--key=</span><span style="color:#032F62;">&quot;\${</span><span style="color:#24292E;">ETCD_KEY</span><span style="color:#032F62;">}&quot;</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#005CC5;">--endpoints=</span><span style="color:#032F62;">&quot;\${</span><span style="color:#24292E;">HOST_1</span><span style="color:#032F62;">}&quot;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">defrag</span></span></code></pre></div><ul><li><h4 id="解除告警" tabindex="-1">解除告警 <a class="header-anchor" href="#解除告警" aria-label="Permalink to &quot;解除告警&quot;">​</a></h4></li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">ETCDCTL_API</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">3</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">etcdctl</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--cacert=</span><span style="color:#9ECBFF;">&quot;\${</span><span style="color:#E1E4E8;">ETCD_CA_CERT</span><span style="color:#9ECBFF;">}&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--cert=</span><span style="color:#9ECBFF;">&quot;\${</span><span style="color:#E1E4E8;">ETCD_CERT</span><span style="color:#9ECBFF;">}&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--key=</span><span style="color:#9ECBFF;">&quot;\${</span><span style="color:#E1E4E8;">ETCD_KEY</span><span style="color:#9ECBFF;">}&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">--endpoints=</span><span style="color:#9ECBFF;">&quot;\${</span><span style="color:#E1E4E8;">HOST_1</span><span style="color:#9ECBFF;">}&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">alarm</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">disarm</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">ETCDCTL_API</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">3</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">etcdctl</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--cacert=</span><span style="color:#032F62;">&quot;\${</span><span style="color:#24292E;">ETCD_CA_CERT</span><span style="color:#032F62;">}&quot;</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--cert=</span><span style="color:#032F62;">&quot;\${</span><span style="color:#24292E;">ETCD_CERT</span><span style="color:#032F62;">}&quot;</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--key=</span><span style="color:#032F62;">&quot;\${</span><span style="color:#24292E;">ETCD_KEY</span><span style="color:#032F62;">}&quot;</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#005CC5;">--endpoints=</span><span style="color:#032F62;">&quot;\${</span><span style="color:#24292E;">HOST_1</span><span style="color:#032F62;">}&quot;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">alarm</span><span style="color:#24292E;"> </span><span style="color:#032F62;">disarm</span></span></code></pre></div><ul><li>验证</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">ETCDCTL_API</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">3</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">etcdctl</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--cacert=</span><span style="color:#9ECBFF;">&quot;\${</span><span style="color:#E1E4E8;">ETCD_CA_CERT</span><span style="color:#9ECBFF;">}&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--cert=</span><span style="color:#9ECBFF;">&quot;\${</span><span style="color:#E1E4E8;">ETCD_CERT</span><span style="color:#9ECBFF;">}&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--key=</span><span style="color:#9ECBFF;">&quot;\${</span><span style="color:#E1E4E8;">ETCD_KEY</span><span style="color:#9ECBFF;">}&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">--endpoints=</span><span style="color:#9ECBFF;">&quot;\${</span><span style="color:#E1E4E8;">HOST_1</span><span style="color:#9ECBFF;">}&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">put</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">helltext</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">123</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">ETCDCTL_API</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">3</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">etcdctl</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--cacert=</span><span style="color:#032F62;">&quot;\${</span><span style="color:#24292E;">ETCD_CA_CERT</span><span style="color:#032F62;">}&quot;</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--cert=</span><span style="color:#032F62;">&quot;\${</span><span style="color:#24292E;">ETCD_CERT</span><span style="color:#032F62;">}&quot;</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--key=</span><span style="color:#032F62;">&quot;\${</span><span style="color:#24292E;">ETCD_KEY</span><span style="color:#032F62;">}&quot;</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#005CC5;">--endpoints=</span><span style="color:#032F62;">&quot;\${</span><span style="color:#24292E;">HOST_1</span><span style="color:#032F62;">}&quot;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">put</span><span style="color:#24292E;"> </span><span style="color:#032F62;">helltext</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">123</span></span></code></pre></div><blockquote><p>auto compact只会压缩key space，不会释放物理存储空间。所以需要定期的执行defrag</p></blockquote><p><a href="https://www.kubernetes.org.cn/7569.html" target="_blank" rel="noreferrer">https://www.kubernetes.org.cn/7569.html</a></p><p><a href="https://blog.51cto.com/u_15966109/6082624" target="_blank" rel="noreferrer">https://blog.51cto.com/u_15966109/6082624</a></p>`,46),e=[o];function t(c,r,y,E,F,i){return a(),n("div",null,e)}const B=s(p,[["render",t]]);export{d as __pageData,B as default};
