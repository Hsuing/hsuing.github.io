import{_ as s,o as a,c as n,R as l}from"./chunks/framework.zUbWieqp.js";const b=JSON.parse('{"title":"1.第一步","description":"","frontmatter":{},"headers":[],"relativePath":"guide/Database/SqlServer/16-维护计划.md","filePath":"guide/Database/SqlServer/16-维护计划.md","lastUpdated":1729160572000}'),p={name:"guide/Database/SqlServer/16-维护计划.md"},o=l(`<h1 id="_1-第一步" tabindex="-1">1.第一步 <a class="header-anchor" href="#_1-第一步" aria-label="Permalink to &quot;1.第一步&quot;">​</a></h1><p>第一步：登录数据库—&gt;管理—&gt;维护计划—&gt;维护计划向导</p><p><img src="https://nnaigos.oss-cn-hangzhou.aliyuncs.com/imgs/202410171008126.png" alt="img"></p><h1 id="_2-第二步" tabindex="-1">2.第二步 <a class="header-anchor" href="#_2-第二步" aria-label="Permalink to &quot;2.第二步&quot;">​</a></h1><p>第二步：输入维护计划“名称”及“说明”，点击“更改”按钮</p><p><img src="https://nnaigos.oss-cn-hangzhou.aliyuncs.com/imgs/202410171009583.png" alt="img"></p><h1 id="_3-第三步" tabindex="-1">3.第三步 <a class="header-anchor" href="#_3-第三步" aria-label="Permalink to &quot;3.第三步&quot;">​</a></h1><p>第三步：在“新建作业计划”界面进行相关的设置</p><p>计划类型：重复执行;</p><p>​ 频率执行：每周、每天、每月（这里我选择每天进行备份）</p><p>​ 每天频率：时间自行选择;（这里我选择每天备份一次）</p><p>​ 持续时间：开始时间默认当前时间（<strong>这里建议改成凌晨或者数据开销相对较小的时间段</strong>），结束时间可以不填;</p><p>以上设置完成后点击“确定”</p><p><img src="https://nnaigos.oss-cn-hangzhou.aliyuncs.com/imgs/202410171010684.png" alt="img"></p><h1 id="_4-第四步" tabindex="-1">4.第四步 <a class="header-anchor" href="#_4-第四步" aria-label="Permalink to &quot;4.第四步&quot;">​</a></h1><p>第四步：点击下一步，“选择维护任务”，这里我选择“备份数据库完整”及“清楚维护任务”，定期清除备份的数据，避免磁盘空间被备份数据占满，造成数据宕机。</p><p><img src="https://nnaigos.oss-cn-hangzhou.aliyuncs.com/imgs/202410171010461.png" alt="img"></p><h1 id="_5-第五步" tabindex="-1">5.第五步 <a class="header-anchor" href="#_5-第五步" aria-label="Permalink to &quot;5.第五步&quot;">​</a></h1><p>第五步：“选择维护任务顺序”，这里是先备份后删除</p><p><img src="https://nnaigos.oss-cn-hangzhou.aliyuncs.com/imgs/202410171011436.png" alt="img"></p><h1 id="_6-第六步" tabindex="-1">6.第六步 <a class="header-anchor" href="#_6-第六步" aria-label="Permalink to &quot;6.第六步&quot;">​</a></h1><p>第六步：选择要备份的数据库，可以根据需要备份的数据库进行选择，可以选择备份到哪个位置。，最好放在磁盘空间比较充足的盘符，扩展名默认bak就可以</p><p><img src="https://nnaigos.oss-cn-hangzhou.aliyuncs.com/imgs/202410171012558.png" alt="img"></p><h1 id="_7-第七步" tabindex="-1">7.第七步 <a class="header-anchor" href="#_7-第七步" aria-label="Permalink to &quot;7.第七步&quot;">​</a></h1><p>第七步：设置“定义清除维护任务”，选择备份时所设置的文件夹，文件扩展名bak，文件保留时间，根据自己的需求选择，备份保留时间</p><p><img src="https://nnaigos.oss-cn-hangzhou.aliyuncs.com/imgs/202410171013428.png" alt="img"></p><h1 id="_8-第八步" tabindex="-1">8.第八步 <a class="header-anchor" href="#_8-第八步" aria-label="Permalink to &quot;8.第八步&quot;">​</a></h1><p>第八步：选择报告选项的保存地址，自己根据需要选择，<code>这里最好别用汉字</code></p><p><img src="https://nnaigos.oss-cn-hangzhou.aliyuncs.com/imgs/202410171013469.png" alt="img"></p><h1 id="_9-第九步" tabindex="-1">9.第九步 <a class="header-anchor" href="#_9-第九步" aria-label="Permalink to &quot;9.第九步&quot;">​</a></h1><p>第九步：点击“完成”设置，此处可以看到前面的设置情况</p><p><img src="https://nnaigos.oss-cn-hangzhou.aliyuncs.com/imgs/202410171014434.png" alt="img"></p><h1 id="_10-第十步" tabindex="-1">10.第十步 <a class="header-anchor" href="#_10-第十步" aria-label="Permalink to &quot;10.第十步&quot;">​</a></h1><p>第十步：设置成功</p><p><img src="https://nnaigos.oss-cn-hangzhou.aliyuncs.com/imgs/202410171014834.png" alt="img"></p><h1 id="_11-第十一步" tabindex="-1">11.第十一步 <a class="header-anchor" href="#_11-第十一步" aria-label="Permalink to &quot;11.第十一步&quot;">​</a></h1><p>第十一步：设置完成后，可以看到“维护计划”内和“作业”内会生成一个作业计划</p><p><img src="https://nnaigos.oss-cn-hangzhou.aliyuncs.com/imgs/202410171015187.png" alt="img"></p><h1 id="_12-第十二步" tabindex="-1">12.第十二步 <a class="header-anchor" href="#_12-第十二步" aria-label="Permalink to &quot;12.第十二步&quot;">​</a></h1><p>第十二步：维护计划右键“修改”可查看计划任务，右键可以再次设置相关参数</p><p><img src="https://nnaigos.oss-cn-hangzhou.aliyuncs.com/imgs/202410171016394.png" alt="img"></p><h1 id="_13-验证" tabindex="-1">13.验证 <a class="header-anchor" href="#_13-验证" aria-label="Permalink to &quot;13.验证&quot;">​</a></h1><p>第十三步：作业右键“作业开始步骤”可直接执行此作业，验证作业是否生效</p><p><img src="https://nnaigos.oss-cn-hangzhou.aliyuncs.com/imgs/202410171016300.png" alt="img"></p><h1 id="sql-server-维护计划无法手动删除的解决办法" tabindex="-1">SQL server 维护计划无法手动删除的解决办法 <a class="header-anchor" href="#sql-server-维护计划无法手动删除的解决办法" aria-label="Permalink to &quot;SQL server 维护计划无法手动删除的解决办法&quot;">​</a></h1><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">SQL</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">server</span><span style="color:#E1E4E8;"> 因为需要定时备份数据库，一般情况下大家都会选择在管理的维护计划中创建维护计划，因各种原因创建的维护计划不合适或者不用需要删除时，有时候会提示无法删除，各种提示报错。</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">以下是无法手动删除时，通过sql语句删除的步骤。</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">复制一下内容到 SQLServer的 </span><span style="color:#9ECBFF;">&quot;新建查询&quot;</span><span style="color:#E1E4E8;">中</span><span style="color:#6A737D;">---</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">--【1】删除【管理】中的维护计划</span></span>
<span class="line"><span style="color:#F97583;">use</span><span style="color:#E1E4E8;"> msdb</span></span>
<span class="line"><span style="color:#F97583;">go</span></span>
<span class="line"><span style="color:#F97583;">select</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> sysmaintplan_plans</span></span>
<span class="line"><span style="color:#F97583;">Delete</span><span style="color:#E1E4E8;"> sysmaintplan_plans </span><span style="color:#F97583;">where</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">Name=</span><span style="color:#9ECBFF;">&#39;维护计划&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">--【2】删除【SQLserver代理】中的作业</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">USE</span><span style="color:#E1E4E8;"> [msdb]</span></span>
<span class="line"><span style="color:#F97583;">Declare</span><span style="color:#E1E4E8;"> @job_name </span><span style="color:#F97583;">varchar</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">100</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#6A737D;">--SET @job_name = N&#39;jobName&#39;</span></span>
<span class="line"><span style="color:#F97583;">SET</span><span style="color:#E1E4E8;"> @job_name</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">N&#39;数据库备份.Subplan_1&#39;</span></span>
<span class="line"><span style="color:#6A737D;">--注：jobName为维护计划对应的jobName</span></span>
<span class="line"><span style="color:#E1E4E8;"> </span></span>
<span class="line"><span style="color:#6A737D;">--删除在计划里面的日志</span></span>
<span class="line"><span style="color:#F97583;">DELETE</span><span style="color:#E1E4E8;"> sysmaintplan_log</span></span>
<span class="line"><span style="color:#F97583;">FROM</span><span style="color:#E1E4E8;"> sysmaintplan_subplans </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> subplans</span></span>
<span class="line"><span style="color:#F97583;">INNER JOIN</span><span style="color:#E1E4E8;"> sysjobs_view </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> syjobs </span><span style="color:#F97583;">on</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">subplans</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">job_id</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">syjobs</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">job_id</span></span>
<span class="line"><span style="color:#F97583;">INNER JOIN</span><span style="color:#E1E4E8;"> sysmaintplan_log </span><span style="color:#F97583;">on</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">subplans</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">subplan_id</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">sysmaintplan_log</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">subplan_id</span></span>
<span class="line"><span style="color:#F97583;">WHERE</span><span style="color:#E1E4E8;"> (</span><span style="color:#79B8FF;">syjobs</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">name</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> @job_name)</span></span>
<span class="line"><span style="color:#E1E4E8;"> </span></span>
<span class="line"><span style="color:#6A737D;">--删除代理的作业</span></span>
<span class="line"><span style="color:#F97583;">DELETE</span><span style="color:#E1E4E8;"> sysjobschedules</span></span>
<span class="line"><span style="color:#F97583;">FROM</span><span style="color:#E1E4E8;"> sysjobs_view v</span></span>
<span class="line"><span style="color:#F97583;">INNER JOIN</span><span style="color:#E1E4E8;"> sysjobschedules o </span><span style="color:#F97583;">on</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">v</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">job_id</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">o</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">job_id</span></span>
<span class="line"><span style="color:#F97583;">WHERE</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">v</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">name</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">@job_name</span></span>
<span class="line"><span style="color:#E1E4E8;"> </span></span>
<span class="line"><span style="color:#6A737D;">--删除子计划</span></span>
<span class="line"><span style="color:#F97583;">DELETE</span><span style="color:#E1E4E8;"> sysmaintplan_subplans</span></span>
<span class="line"><span style="color:#F97583;">FROM</span><span style="color:#E1E4E8;"> sysmaintplan_subplans </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> subplans</span></span>
<span class="line"><span style="color:#F97583;">INNER JOIN</span><span style="color:#E1E4E8;"> sysjobs_view </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> syjobs </span><span style="color:#F97583;">ON</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">subplans</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">job_id</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">syjobs</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">job_id</span></span>
<span class="line"><span style="color:#F97583;">WHERE</span><span style="color:#E1E4E8;"> (</span><span style="color:#79B8FF;">syjobs</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">name</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> @job_name)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">--删除作业</span></span>
<span class="line"><span style="color:#F97583;">DELETE</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">FROM</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">msdb</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">dbo</span><span style="color:#E1E4E8;">.sysjobs_view </span><span style="color:#F97583;">WHERE</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">name</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> @job_name</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">SQL</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">server</span><span style="color:#24292E;"> 因为需要定时备份数据库，一般情况下大家都会选择在管理的维护计划中创建维护计划，因各种原因创建的维护计划不合适或者不用需要删除时，有时候会提示无法删除，各种提示报错。</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">以下是无法手动删除时，通过sql语句删除的步骤。</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">复制一下内容到 SQLServer的 </span><span style="color:#032F62;">&quot;新建查询&quot;</span><span style="color:#24292E;">中</span><span style="color:#6A737D;">---</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">--【1】删除【管理】中的维护计划</span></span>
<span class="line"><span style="color:#D73A49;">use</span><span style="color:#24292E;"> msdb</span></span>
<span class="line"><span style="color:#D73A49;">go</span></span>
<span class="line"><span style="color:#D73A49;">select</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">*</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">from</span><span style="color:#24292E;"> sysmaintplan_plans</span></span>
<span class="line"><span style="color:#D73A49;">Delete</span><span style="color:#24292E;"> sysmaintplan_plans </span><span style="color:#D73A49;">where</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">Name=</span><span style="color:#032F62;">&#39;维护计划&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">--【2】删除【SQLserver代理】中的作业</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">USE</span><span style="color:#24292E;"> [msdb]</span></span>
<span class="line"><span style="color:#D73A49;">Declare</span><span style="color:#24292E;"> @job_name </span><span style="color:#D73A49;">varchar</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">100</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#6A737D;">--SET @job_name = N&#39;jobName&#39;</span></span>
<span class="line"><span style="color:#D73A49;">SET</span><span style="color:#24292E;"> @job_name</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">N&#39;数据库备份.Subplan_1&#39;</span></span>
<span class="line"><span style="color:#6A737D;">--注：jobName为维护计划对应的jobName</span></span>
<span class="line"><span style="color:#24292E;"> </span></span>
<span class="line"><span style="color:#6A737D;">--删除在计划里面的日志</span></span>
<span class="line"><span style="color:#D73A49;">DELETE</span><span style="color:#24292E;"> sysmaintplan_log</span></span>
<span class="line"><span style="color:#D73A49;">FROM</span><span style="color:#24292E;"> sysmaintplan_subplans </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> subplans</span></span>
<span class="line"><span style="color:#D73A49;">INNER JOIN</span><span style="color:#24292E;"> sysjobs_view </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> syjobs </span><span style="color:#D73A49;">on</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">subplans</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">job_id</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">syjobs</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">job_id</span></span>
<span class="line"><span style="color:#D73A49;">INNER JOIN</span><span style="color:#24292E;"> sysmaintplan_log </span><span style="color:#D73A49;">on</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">subplans</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">subplan_id</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">sysmaintplan_log</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">subplan_id</span></span>
<span class="line"><span style="color:#D73A49;">WHERE</span><span style="color:#24292E;"> (</span><span style="color:#005CC5;">syjobs</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">name</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> @job_name)</span></span>
<span class="line"><span style="color:#24292E;"> </span></span>
<span class="line"><span style="color:#6A737D;">--删除代理的作业</span></span>
<span class="line"><span style="color:#D73A49;">DELETE</span><span style="color:#24292E;"> sysjobschedules</span></span>
<span class="line"><span style="color:#D73A49;">FROM</span><span style="color:#24292E;"> sysjobs_view v</span></span>
<span class="line"><span style="color:#D73A49;">INNER JOIN</span><span style="color:#24292E;"> sysjobschedules o </span><span style="color:#D73A49;">on</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">v</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">job_id</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">o</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">job_id</span></span>
<span class="line"><span style="color:#D73A49;">WHERE</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">v</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">name</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">@job_name</span></span>
<span class="line"><span style="color:#24292E;"> </span></span>
<span class="line"><span style="color:#6A737D;">--删除子计划</span></span>
<span class="line"><span style="color:#D73A49;">DELETE</span><span style="color:#24292E;"> sysmaintplan_subplans</span></span>
<span class="line"><span style="color:#D73A49;">FROM</span><span style="color:#24292E;"> sysmaintplan_subplans </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> subplans</span></span>
<span class="line"><span style="color:#D73A49;">INNER JOIN</span><span style="color:#24292E;"> sysjobs_view </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> syjobs </span><span style="color:#D73A49;">ON</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">subplans</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">job_id</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">syjobs</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">job_id</span></span>
<span class="line"><span style="color:#D73A49;">WHERE</span><span style="color:#24292E;"> (</span><span style="color:#005CC5;">syjobs</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">name</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> @job_name)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">--删除作业</span></span>
<span class="line"><span style="color:#D73A49;">DELETE</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">FROM</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">msdb</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">dbo</span><span style="color:#24292E;">.sysjobs_view </span><span style="color:#D73A49;">WHERE</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">name</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> @job_name</span></span></code></pre></div>`,46),e=[o];function c(t,r,y,E,i,h){return a(),n("div",null,e)}const F=s(p,[["render",c]]);export{b as __pageData,F as default};
