import{_ as s,o as n,c as a,R as l}from"./chunks/framework.zUbWieqp.js";const u=JSON.parse('{"title":"","description":"","frontmatter":{},"headers":[],"relativePath":"guide/container/containerd/1-install.md","filePath":"guide/container/containerd/1-install.md","lastUpdated":1730819630000}'),p={name:"guide/container/containerd/1-install.md"},o=l(`<p><code>基于centos7.x</code></p><h2 id="_1-下载地址" tabindex="-1">1.下载地址 <a class="header-anchor" href="#_1-下载地址" aria-label="Permalink to &quot;1.下载地址&quot;">​</a></h2><ul><li><a href="https://containerd.io/downloads" target="_blank" rel="noreferrer">https://containerd.io/downloads</a></li><li><a href="https://github.com/containerd/containerd" target="_blank" rel="noreferrer">https://github.com/containerd/containerd</a></li></ul><h3 id="libseccomp-2-5-1" tabindex="-1">libseccomp-2.5.1 <a class="header-anchor" href="#libseccomp-2-5-1" aria-label="Permalink to &quot;libseccomp-2.5.1&quot;">​</a></h3><ul><li><a href="https://pkgs.org/download/libseccomp" target="_blank" rel="noreferrer">https://pkgs.org/download/libseccomp</a></li><li><a href="https://rpmfind.net/linux/rpm2html/search.php?query=libseccomp&amp;submit=Search+" target="_blank" rel="noreferrer">https://rpmfind.net/linux/rpm2html/search.php?query=libseccomp&amp;submit=Search+</a>...</li></ul><h2 id="_2-安装libseccomp" tabindex="-1">2.安装libseccomp <a class="header-anchor" href="#_2-安装libseccomp" aria-label="Permalink to &quot;2.安装libseccomp&quot;">​</a></h2><blockquote><p>注释：</p><p>在containerd前，需要优先升级libseccomp。</p><p>在CentOS 7中yum下载libseccomp的版本是2.3的，版本不满足最新 Containerd 的需求，需要下载2.4以上的</p></blockquote><h3 id="_2-1卸载" tabindex="-1">2.1卸载 <a class="header-anchor" href="#_2-1卸载" aria-label="Permalink to &quot;2.1卸载&quot;">​</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">[root@ecs-65685 </span><span style="color:#F97583;">~</span><span style="color:#E1E4E8;">]# rpm -qa </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">grep</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">libseccomp</span></span>
<span class="line"><span style="color:#B392F0;">libseccomp-2.3.1-4.el7.x86_64</span></span>
<span class="line"><span style="color:#E1E4E8;">[root@ecs-65685 </span><span style="color:#F97583;">~</span><span style="color:#E1E4E8;">]# </span></span>
<span class="line"><span style="color:#E1E4E8;">[root@ecs-65685 </span><span style="color:#F97583;">~</span><span style="color:#E1E4E8;">]# rpm -e libseccomp-2.3.1-4.el7.x86_64 --nodeps</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">[root@ecs-65685 </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# rpm -qa </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">grep</span><span style="color:#24292E;"> </span><span style="color:#032F62;">libseccomp</span></span>
<span class="line"><span style="color:#6F42C1;">libseccomp-2.3.1-4.el7.x86_64</span></span>
<span class="line"><span style="color:#24292E;">[root@ecs-65685 </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# </span></span>
<span class="line"><span style="color:#24292E;">[root@ecs-65685 </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# rpm -e libseccomp-2.3.1-4.el7.x86_64 --nodeps</span></span></code></pre></div><h3 id="_2-2下载" tabindex="-1">2.2下载 <a class="header-anchor" href="#_2-2下载" aria-label="Permalink to &quot;2.2下载&quot;">​</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">wget</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">http://rpmfind.net/linux/centos/8-stream/BaseOS/x86_64/os/Packages/libseccomp-2.5.1-1.el8.x86_64.rpm</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">root@k8s-master01</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">sbin]#</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">rpm</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-ivh</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">libseccomp-2.5.1-1.el8.x86_64.rpm</span><span style="color:#E1E4E8;"> </span></span>
<span class="line"><span style="color:#B392F0;">警告：libseccomp-2.5.1-1.el8.x86_64.rpm:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">头V3</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">RSA/SHA256</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Signature,</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">密钥</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">ID</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">8483</span><span style="color:#9ECBFF;">c65d:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">NOKEY</span></span>
<span class="line"><span style="color:#B392F0;">准备中...</span><span style="color:#E1E4E8;">                          </span><span style="color:#6A737D;">################################# [100%]</span></span>
<span class="line"><span style="color:#B392F0;">正在升级/安装...</span></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#B392F0;">1:libseccomp-2.5.1-1.el8</span><span style="color:#E1E4E8;">           </span><span style="color:#6A737D;">################################# [100%]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#查看新版本</span></span>
<span class="line"><span style="color:#E1E4E8;">[root@k8s-master01 sbin]# rpm -qa </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">grep</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">libseccomp</span></span>
<span class="line"><span style="color:#B392F0;">libseccomp-2.5.1-1.el8.x86_64</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#验证runc</span></span>
<span class="line"><span style="color:#E1E4E8;">[root@k8s-master01 sbin]# ./runc -version</span></span>
<span class="line"><span style="color:#B392F0;">runc</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">version</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">1.1</span><span style="color:#9ECBFF;">.9</span></span>
<span class="line"><span style="color:#B392F0;">commit:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">v1.1.9-0-gccaecfcb</span></span>
<span class="line"><span style="color:#B392F0;">spec:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">1.0</span><span style="color:#9ECBFF;">.2-dev</span></span>
<span class="line"><span style="color:#B392F0;">go:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">go1.20.8</span></span>
<span class="line"><span style="color:#B392F0;">libseccomp:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2.5</span><span style="color:#9ECBFF;">.1</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">wget</span><span style="color:#24292E;"> </span><span style="color:#032F62;">http://rpmfind.net/linux/centos/8-stream/BaseOS/x86_64/os/Packages/libseccomp-2.5.1-1.el8.x86_64.rpm</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">root@k8s-master01</span><span style="color:#24292E;"> </span><span style="color:#032F62;">sbin]#</span><span style="color:#24292E;"> </span><span style="color:#032F62;">rpm</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-ivh</span><span style="color:#24292E;"> </span><span style="color:#032F62;">libseccomp-2.5.1-1.el8.x86_64.rpm</span><span style="color:#24292E;"> </span></span>
<span class="line"><span style="color:#6F42C1;">警告：libseccomp-2.5.1-1.el8.x86_64.rpm:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">头V3</span><span style="color:#24292E;"> </span><span style="color:#032F62;">RSA/SHA256</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Signature,</span><span style="color:#24292E;"> </span><span style="color:#032F62;">密钥</span><span style="color:#24292E;"> </span><span style="color:#032F62;">ID</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">8483</span><span style="color:#032F62;">c65d:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">NOKEY</span></span>
<span class="line"><span style="color:#6F42C1;">准备中...</span><span style="color:#24292E;">                          </span><span style="color:#6A737D;">################################# [100%]</span></span>
<span class="line"><span style="color:#6F42C1;">正在升级/安装...</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#6F42C1;">1:libseccomp-2.5.1-1.el8</span><span style="color:#24292E;">           </span><span style="color:#6A737D;">################################# [100%]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#查看新版本</span></span>
<span class="line"><span style="color:#24292E;">[root@k8s-master01 sbin]# rpm -qa </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">grep</span><span style="color:#24292E;"> </span><span style="color:#032F62;">libseccomp</span></span>
<span class="line"><span style="color:#6F42C1;">libseccomp-2.5.1-1.el8.x86_64</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#验证runc</span></span>
<span class="line"><span style="color:#24292E;">[root@k8s-master01 sbin]# ./runc -version</span></span>
<span class="line"><span style="color:#6F42C1;">runc</span><span style="color:#24292E;"> </span><span style="color:#032F62;">version</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1.1</span><span style="color:#032F62;">.9</span></span>
<span class="line"><span style="color:#6F42C1;">commit:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">v1.1.9-0-gccaecfcb</span></span>
<span class="line"><span style="color:#6F42C1;">spec:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1.0</span><span style="color:#032F62;">.2-dev</span></span>
<span class="line"><span style="color:#6F42C1;">go:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">go1.20.8</span></span>
<span class="line"><span style="color:#6F42C1;">libseccomp:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2.5</span><span style="color:#032F62;">.1</span></span></code></pre></div><p><code>CentOS 8.2 默认2.5.1，可以不用更新</code></p><p><code>注意：使用场景在 Kubernetes 1.24+版本中的Containerd会用到</code></p><h3 id="_2-3不升级libseccomp" tabindex="-1">2.3不升级libseccomp <a class="header-anchor" href="#_2-3不升级libseccomp" aria-label="Permalink to &quot;2.3不升级libseccomp&quot;">​</a></h3><p><code>由于二进制包中提供的runC默认需要系统中安装seccomp支持，需要单独安装，且不同版本runC对seccomp版本要求一致，所以建议单独下载runC 二进制包进行安装，里面包含了seccomp模块支持</code></p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">wget</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">https://github.com/opencontainers/runc/releases/download/v1.1.9/runc.amd64</span></span>
<span class="line"><span style="color:#E1E4E8;">[root@k8s-master01 tmp]#mv runc.amd64 runc &amp;&amp; </span><span style="color:#B392F0;">chmod</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">+x</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">runc</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">[root@k8s-master01 tmp]# ./runc  -version</span></span>
<span class="line"><span style="color:#B392F0;">runc</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">version</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">1.1</span><span style="color:#9ECBFF;">.9</span></span>
<span class="line"><span style="color:#B392F0;">commit:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">v1.1.9-0-gccaecfcb</span></span>
<span class="line"><span style="color:#B392F0;">spec:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">1.0</span><span style="color:#9ECBFF;">.2-dev</span></span>
<span class="line"><span style="color:#B392F0;">go:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">go1.20.3</span></span>
<span class="line"><span style="color:#B392F0;">libseccomp:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2.5</span><span style="color:#9ECBFF;">.4</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">wget</span><span style="color:#24292E;"> </span><span style="color:#032F62;">https://github.com/opencontainers/runc/releases/download/v1.1.9/runc.amd64</span></span>
<span class="line"><span style="color:#24292E;">[root@k8s-master01 tmp]#mv runc.amd64 runc &amp;&amp; </span><span style="color:#6F42C1;">chmod</span><span style="color:#24292E;"> </span><span style="color:#032F62;">+x</span><span style="color:#24292E;"> </span><span style="color:#032F62;">runc</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">[root@k8s-master01 tmp]# ./runc  -version</span></span>
<span class="line"><span style="color:#6F42C1;">runc</span><span style="color:#24292E;"> </span><span style="color:#032F62;">version</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1.1</span><span style="color:#032F62;">.9</span></span>
<span class="line"><span style="color:#6F42C1;">commit:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">v1.1.9-0-gccaecfcb</span></span>
<span class="line"><span style="color:#6F42C1;">spec:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1.0</span><span style="color:#032F62;">.2-dev</span></span>
<span class="line"><span style="color:#6F42C1;">go:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">go1.20.3</span></span>
<span class="line"><span style="color:#6F42C1;">libseccomp:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2.5</span><span style="color:#032F62;">.4</span></span></code></pre></div><h2 id="_3-安装containerd" tabindex="-1">3. 安装Containerd <a class="header-anchor" href="#_3-安装containerd" aria-label="Permalink to &quot;3. 安装Containerd&quot;">​</a></h2><p><a href="https://github.com/containerd/containerd/blob/main/docs/getting-started.md" target="_blank" rel="noreferrer">https://github.com/containerd/containerd/blob/main/docs/getting-started.md</a></p><h3 id="_3-1-下载" tabindex="-1">3.1 下载 <a class="header-anchor" href="#_3-1-下载" aria-label="Permalink to &quot;3.1 下载&quot;">​</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">wget</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">https://github.com/containerd/containerd/releases/download/v1.7.7/cri-containerd-cni-1.7.7-linux-amd64.tar.gz</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">wget</span><span style="color:#24292E;"> </span><span style="color:#032F62;">https://github.com/containerd/containerd/releases/download/v1.7.7/cri-containerd-cni-1.7.7-linux-amd64.tar.gz</span></span></code></pre></div><h3 id="_3-2-二进制安装" tabindex="-1">3.2 二进制安装 <a class="header-anchor" href="#_3-2-二进制安装" aria-label="Permalink to &quot;3.2 二进制安装&quot;">​</a></h3><p>Containerd有两种安装包：</p><ul><li>第一种是<code>containerd-xxx</code>,这种包用于单机测试没问题，不包含runC，需要提前安装。</li><li>第二种是<code>cri-containerd-cni-xxxx</code>，包含runc和k8s里的所需要的相关文件。k8s集群里需要用到此包。虽然包含runC，但是依赖系统中的seccomp（安全计算模式，是一种限制<a href="https://cloud.tencent.com/product/tke?from_column=20065&amp;from=20065" target="_blank" rel="noreferrer">容器</a>调用系统资源的模式。），<code>推荐这个模式安装</code></li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">#解压</span></span>
<span class="line"><span style="color:#E1E4E8;">[root@other test]#  tar zxvf cri-containerd-cni-1.7.7-linux-amd64.tar.gz -C /</span></span>
<span class="line"><span style="color:#E1E4E8;">[root@other test]# tree -L 3 etc opt usr/</span></span>
<span class="line"><span style="color:#B392F0;">etc</span></span>
<span class="line"><span style="color:#B392F0;">├──</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">cni</span></span>
<span class="line"><span style="color:#B392F0;">│  </span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">└──</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">net.d</span></span>
<span class="line"><span style="color:#B392F0;">│  </span><span style="color:#E1E4E8;">     </span><span style="color:#9ECBFF;">└──</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">10</span><span style="color:#9ECBFF;">-containerd-net.conflist</span></span>
<span class="line"><span style="color:#B392F0;">├──</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">crictl.yaml</span></span>
<span class="line"><span style="color:#B392F0;">└──</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">systemd</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">└──</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">system</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#B392F0;">└──</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">containerd.service</span></span>
<span class="line"><span style="color:#B392F0;">opt</span></span>
<span class="line"><span style="color:#B392F0;">├──</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">cni</span></span>
<span class="line"><span style="color:#B392F0;">│  </span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">└──</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">bin</span></span>
<span class="line"><span style="color:#B392F0;">│  </span><span style="color:#E1E4E8;">     </span><span style="color:#9ECBFF;">├──</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">bandwidth</span></span>
<span class="line"><span style="color:#B392F0;">│  </span><span style="color:#E1E4E8;">     </span><span style="color:#9ECBFF;">├──</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">bridge</span></span>
<span class="line"><span style="color:#B392F0;">│  </span><span style="color:#E1E4E8;">     </span><span style="color:#9ECBFF;">├──</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">dhcp</span></span>
<span class="line"><span style="color:#B392F0;">│  </span><span style="color:#E1E4E8;">     </span><span style="color:#9ECBFF;">├──</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">dummy</span></span>
<span class="line"><span style="color:#B392F0;">│  </span><span style="color:#E1E4E8;">     </span><span style="color:#9ECBFF;">├──</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">firewall</span></span>
<span class="line"><span style="color:#B392F0;">│  </span><span style="color:#E1E4E8;">     </span><span style="color:#9ECBFF;">├──</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">host-device</span></span>
<span class="line"><span style="color:#B392F0;">│  </span><span style="color:#E1E4E8;">     </span><span style="color:#9ECBFF;">├──</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">host-local</span></span>
<span class="line"><span style="color:#B392F0;">│  </span><span style="color:#E1E4E8;">     </span><span style="color:#9ECBFF;">├──</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">ipvlan</span></span>
<span class="line"><span style="color:#B392F0;">│  </span><span style="color:#E1E4E8;">     </span><span style="color:#9ECBFF;">├──</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">loopback</span></span>
<span class="line"><span style="color:#B392F0;">│  </span><span style="color:#E1E4E8;">     </span><span style="color:#9ECBFF;">├──</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">macvlan</span></span>
<span class="line"><span style="color:#B392F0;">│  </span><span style="color:#E1E4E8;">     </span><span style="color:#9ECBFF;">├──</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">portmap</span></span>
<span class="line"><span style="color:#B392F0;">│  </span><span style="color:#E1E4E8;">     </span><span style="color:#9ECBFF;">├──</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">ptp</span></span>
<span class="line"><span style="color:#B392F0;">│  </span><span style="color:#E1E4E8;">     </span><span style="color:#9ECBFF;">├──</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">sbr</span></span>
<span class="line"><span style="color:#B392F0;">│  </span><span style="color:#E1E4E8;">     </span><span style="color:#9ECBFF;">├──</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">static</span></span>
<span class="line"><span style="color:#B392F0;">│  </span><span style="color:#E1E4E8;">     </span><span style="color:#9ECBFF;">├──</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">tuning</span></span>
<span class="line"><span style="color:#B392F0;">│  </span><span style="color:#E1E4E8;">     </span><span style="color:#9ECBFF;">├──</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">vlan</span></span>
<span class="line"><span style="color:#B392F0;">│  </span><span style="color:#E1E4E8;">     </span><span style="color:#9ECBFF;">└──</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">vrf</span></span>
<span class="line"><span style="color:#B392F0;">└──</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">containerd</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">└──</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">cluster</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#B392F0;">├──</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">gce</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#B392F0;">└──</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">version</span></span>
<span class="line"><span style="color:#B392F0;">usr/</span></span>
<span class="line"><span style="color:#B392F0;">└──</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">local</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">├──</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">bin</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">│  </span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">├──</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">containerd</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">│  </span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">├──</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">containerd-shim</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">│  </span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">├──</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">containerd-shim-runc-v1</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">│  </span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">├──</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">containerd-shim-runc-v2</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">│  </span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">├──</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">containerd-stress</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">│  </span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">├──</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">crictl</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">│  </span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">├──</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">critest</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">│  </span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">├──</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">ctd-decoder</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">│  </span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">└──</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">ctr</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">└──</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">sbin</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#B392F0;">└──</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">runc</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#把上面的复制到相关路径</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">#解压</span></span>
<span class="line"><span style="color:#24292E;">[root@other test]#  tar zxvf cri-containerd-cni-1.7.7-linux-amd64.tar.gz -C /</span></span>
<span class="line"><span style="color:#24292E;">[root@other test]# tree -L 3 etc opt usr/</span></span>
<span class="line"><span style="color:#6F42C1;">etc</span></span>
<span class="line"><span style="color:#6F42C1;">├──</span><span style="color:#24292E;"> </span><span style="color:#032F62;">cni</span></span>
<span class="line"><span style="color:#6F42C1;">│  </span><span style="color:#24292E;"> </span><span style="color:#032F62;">└──</span><span style="color:#24292E;"> </span><span style="color:#032F62;">net.d</span></span>
<span class="line"><span style="color:#6F42C1;">│  </span><span style="color:#24292E;">     </span><span style="color:#032F62;">└──</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">10</span><span style="color:#032F62;">-containerd-net.conflist</span></span>
<span class="line"><span style="color:#6F42C1;">├──</span><span style="color:#24292E;"> </span><span style="color:#032F62;">crictl.yaml</span></span>
<span class="line"><span style="color:#6F42C1;">└──</span><span style="color:#24292E;"> </span><span style="color:#032F62;">systemd</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">└──</span><span style="color:#24292E;"> </span><span style="color:#032F62;">system</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6F42C1;">└──</span><span style="color:#24292E;"> </span><span style="color:#032F62;">containerd.service</span></span>
<span class="line"><span style="color:#6F42C1;">opt</span></span>
<span class="line"><span style="color:#6F42C1;">├──</span><span style="color:#24292E;"> </span><span style="color:#032F62;">cni</span></span>
<span class="line"><span style="color:#6F42C1;">│  </span><span style="color:#24292E;"> </span><span style="color:#032F62;">└──</span><span style="color:#24292E;"> </span><span style="color:#032F62;">bin</span></span>
<span class="line"><span style="color:#6F42C1;">│  </span><span style="color:#24292E;">     </span><span style="color:#032F62;">├──</span><span style="color:#24292E;"> </span><span style="color:#032F62;">bandwidth</span></span>
<span class="line"><span style="color:#6F42C1;">│  </span><span style="color:#24292E;">     </span><span style="color:#032F62;">├──</span><span style="color:#24292E;"> </span><span style="color:#032F62;">bridge</span></span>
<span class="line"><span style="color:#6F42C1;">│  </span><span style="color:#24292E;">     </span><span style="color:#032F62;">├──</span><span style="color:#24292E;"> </span><span style="color:#032F62;">dhcp</span></span>
<span class="line"><span style="color:#6F42C1;">│  </span><span style="color:#24292E;">     </span><span style="color:#032F62;">├──</span><span style="color:#24292E;"> </span><span style="color:#032F62;">dummy</span></span>
<span class="line"><span style="color:#6F42C1;">│  </span><span style="color:#24292E;">     </span><span style="color:#032F62;">├──</span><span style="color:#24292E;"> </span><span style="color:#032F62;">firewall</span></span>
<span class="line"><span style="color:#6F42C1;">│  </span><span style="color:#24292E;">     </span><span style="color:#032F62;">├──</span><span style="color:#24292E;"> </span><span style="color:#032F62;">host-device</span></span>
<span class="line"><span style="color:#6F42C1;">│  </span><span style="color:#24292E;">     </span><span style="color:#032F62;">├──</span><span style="color:#24292E;"> </span><span style="color:#032F62;">host-local</span></span>
<span class="line"><span style="color:#6F42C1;">│  </span><span style="color:#24292E;">     </span><span style="color:#032F62;">├──</span><span style="color:#24292E;"> </span><span style="color:#032F62;">ipvlan</span></span>
<span class="line"><span style="color:#6F42C1;">│  </span><span style="color:#24292E;">     </span><span style="color:#032F62;">├──</span><span style="color:#24292E;"> </span><span style="color:#032F62;">loopback</span></span>
<span class="line"><span style="color:#6F42C1;">│  </span><span style="color:#24292E;">     </span><span style="color:#032F62;">├──</span><span style="color:#24292E;"> </span><span style="color:#032F62;">macvlan</span></span>
<span class="line"><span style="color:#6F42C1;">│  </span><span style="color:#24292E;">     </span><span style="color:#032F62;">├──</span><span style="color:#24292E;"> </span><span style="color:#032F62;">portmap</span></span>
<span class="line"><span style="color:#6F42C1;">│  </span><span style="color:#24292E;">     </span><span style="color:#032F62;">├──</span><span style="color:#24292E;"> </span><span style="color:#032F62;">ptp</span></span>
<span class="line"><span style="color:#6F42C1;">│  </span><span style="color:#24292E;">     </span><span style="color:#032F62;">├──</span><span style="color:#24292E;"> </span><span style="color:#032F62;">sbr</span></span>
<span class="line"><span style="color:#6F42C1;">│  </span><span style="color:#24292E;">     </span><span style="color:#032F62;">├──</span><span style="color:#24292E;"> </span><span style="color:#032F62;">static</span></span>
<span class="line"><span style="color:#6F42C1;">│  </span><span style="color:#24292E;">     </span><span style="color:#032F62;">├──</span><span style="color:#24292E;"> </span><span style="color:#032F62;">tuning</span></span>
<span class="line"><span style="color:#6F42C1;">│  </span><span style="color:#24292E;">     </span><span style="color:#032F62;">├──</span><span style="color:#24292E;"> </span><span style="color:#032F62;">vlan</span></span>
<span class="line"><span style="color:#6F42C1;">│  </span><span style="color:#24292E;">     </span><span style="color:#032F62;">└──</span><span style="color:#24292E;"> </span><span style="color:#032F62;">vrf</span></span>
<span class="line"><span style="color:#6F42C1;">└──</span><span style="color:#24292E;"> </span><span style="color:#032F62;">containerd</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">└──</span><span style="color:#24292E;"> </span><span style="color:#032F62;">cluster</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6F42C1;">├──</span><span style="color:#24292E;"> </span><span style="color:#032F62;">gce</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6F42C1;">└──</span><span style="color:#24292E;"> </span><span style="color:#032F62;">version</span></span>
<span class="line"><span style="color:#6F42C1;">usr/</span></span>
<span class="line"><span style="color:#6F42C1;">└──</span><span style="color:#24292E;"> </span><span style="color:#032F62;">local</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">├──</span><span style="color:#24292E;"> </span><span style="color:#032F62;">bin</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">│  </span><span style="color:#24292E;"> </span><span style="color:#032F62;">├──</span><span style="color:#24292E;"> </span><span style="color:#032F62;">containerd</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">│  </span><span style="color:#24292E;"> </span><span style="color:#032F62;">├──</span><span style="color:#24292E;"> </span><span style="color:#032F62;">containerd-shim</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">│  </span><span style="color:#24292E;"> </span><span style="color:#032F62;">├──</span><span style="color:#24292E;"> </span><span style="color:#032F62;">containerd-shim-runc-v1</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">│  </span><span style="color:#24292E;"> </span><span style="color:#032F62;">├──</span><span style="color:#24292E;"> </span><span style="color:#032F62;">containerd-shim-runc-v2</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">│  </span><span style="color:#24292E;"> </span><span style="color:#032F62;">├──</span><span style="color:#24292E;"> </span><span style="color:#032F62;">containerd-stress</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">│  </span><span style="color:#24292E;"> </span><span style="color:#032F62;">├──</span><span style="color:#24292E;"> </span><span style="color:#032F62;">crictl</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">│  </span><span style="color:#24292E;"> </span><span style="color:#032F62;">├──</span><span style="color:#24292E;"> </span><span style="color:#032F62;">critest</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">│  </span><span style="color:#24292E;"> </span><span style="color:#032F62;">├──</span><span style="color:#24292E;"> </span><span style="color:#032F62;">ctd-decoder</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">│  </span><span style="color:#24292E;"> </span><span style="color:#032F62;">└──</span><span style="color:#24292E;"> </span><span style="color:#032F62;">ctr</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">└──</span><span style="color:#24292E;"> </span><span style="color:#032F62;">sbin</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6F42C1;">└──</span><span style="color:#24292E;"> </span><span style="color:#032F62;">runc</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#把上面的复制到相关路径</span></span></code></pre></div><ul><li>配置文件</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark has-diff vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">[root@other sbin]# mkdir /etc/containerd</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#生成默认配置</span></span>
<span class="line"><span style="color:#B392F0;">containerd</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">config</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">default</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/etc/containerd/config.toml</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#修改，单机或者k8s都适用的配置</span></span>
<span class="line"><span style="color:#B392F0;">root</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;/var/lib/containerd&quot;</span></span>
<span class="line"><span style="color:#B392F0;">state</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;/run/containerd&quot;</span></span>
<span class="line"><span style="color:#B392F0;">oom_score</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-999</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">[grpc]</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">address</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;/run/containerd/containerd.sock&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">uid</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">gid</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">max_recv_message_size</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">16777216</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">max_send_message_size</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">16777216</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">tcp_address</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">tcp_tls_cert</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">tcp_tls_key</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">[debug]</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">address</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">uid</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">gid</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">level</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">[metrics]</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">address</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">grpc_histogram</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">false</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">[cgroup]</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">path</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">[plugins]</span></span>
<span class="line"><span style="color:#E1E4E8;">  [plugins.cgroups]</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">no_prometheus</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">false</span></span>
<span class="line"><span style="color:#E1E4E8;">  [plugins.cri]</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">stream_server_address</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;127.0.0.1&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">stream_server_port</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;0&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">enable_selinux</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">false</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">sandbox_image</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;registry.aliyuncs.com/google_containers/pause:3.7&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;">#配置了沙箱镜像</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">stats_collect_period</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">10</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">systemd_cgroup</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">true</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">enable_tls_streaming</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">false</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">max_container_log_line_size</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">16384</span></span>
<span class="line"><span style="color:#E1E4E8;">    [plugins.cri.containerd]</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#B392F0;">snapshotter</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;overlayfs&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#B392F0;">no_pivot</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">false</span></span>
<span class="line"><span style="color:#E1E4E8;">      [plugins.cri.containerd.runtimes.runc.options]</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#B392F0;">BinaryName</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#B392F0;">CriuImagePath</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#B392F0;">CriuPath</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#B392F0;">CriuWorkPath</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#B392F0;">IoGid</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#B392F0;">IoUid</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#B392F0;">NoNewKeyring</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">false</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#B392F0;">NoPivotRoot</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">false</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#B392F0;">Root</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#B392F0;">ShimCgroup</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#B392F0;">SystemdCgroup</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">true</span></span>
<span class="line"><span style="color:#E1E4E8;">      [plugins.cri.containerd.default_runtime]</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#B392F0;">runtime_type</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;io.containerd.runtime.v1.linux&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#B392F0;">runtime_engine</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#B392F0;">runtime_root</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">      [plugins.cri.containerd.untrusted_workload_runtime]</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#B392F0;">runtime_type</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#B392F0;">runtime_engine</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#B392F0;">runtime_root</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">    [plugins.cri.cni]</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#B392F0;">bin_dir</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;/opt/kube/bin&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#B392F0;">conf_dir</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;/etc/cni/net.d&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#B392F0;">conf_template</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;/etc/cni/net.d/10-default.conf&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">    [plugins.cri.registry]</span></span>
<span class="line"><span style="color:#E1E4E8;">      [plugins.cri.registry.mirrors]</span></span>
<span class="line"><span style="color:#E1E4E8;">        [plugins.cri.registry.mirrors.</span><span style="color:#9ECBFF;">&quot;docker.io&quot;</span><span style="color:#E1E4E8;">]</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#B392F0;">endpoint</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">=</span><span style="color:#E1E4E8;"> [</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#B392F0;">&quot;https://docker.mirrors.ustc.edu.cn&quot;</span><span style="color:#B392F0;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#B392F0;">&quot;http://hub-mirror.c.163.com&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">          ]</span></span>
<span class="line"><span style="color:#E1E4E8;">        [plugins.cri.registry.mirrors.</span><span style="color:#9ECBFF;">&quot;gcr.io&quot;</span><span style="color:#E1E4E8;">]</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#B392F0;">endpoint</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">=</span><span style="color:#E1E4E8;"> [</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#B392F0;">&quot;https://gcr.mirrors.ustc.edu.cn&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">          ]</span></span>
<span class="line"><span style="color:#E1E4E8;">        [plugins.cri.registry.mirrors.</span><span style="color:#9ECBFF;">&quot;k8s.gcr.io&quot;</span><span style="color:#E1E4E8;">]</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#B392F0;">endpoint</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">=</span><span style="color:#E1E4E8;"> [</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#B392F0;">&quot;https://gcr.mirrors.ustc.edu.cn/google-containers/&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">          ]</span></span>
<span class="line"><span style="color:#E1E4E8;">        [plugins.cri.registry.mirrors.</span><span style="color:#9ECBFF;">&quot;quay.io&quot;</span><span style="color:#E1E4E8;">]</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#B392F0;">endpoint</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">=</span><span style="color:#E1E4E8;"> [</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#B392F0;">&quot;https://quay.mirrors.ustc.edu.cn&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">          ]</span></span>
<span class="line"><span style="color:#E1E4E8;">    [plugins.cri.x509_key_pair_streaming]</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#B392F0;">tls_cert_file</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#B392F0;">tls_key_file</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">  [plugins.diff-service]</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">default</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">=</span><span style="color:#E1E4E8;"> [</span><span style="color:#9ECBFF;">&quot;walking&quot;</span><span style="color:#E1E4E8;">]</span></span>
<span class="line"><span style="color:#E1E4E8;">  [plugins.linux]</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">shim</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;containerd-shim&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">runtime</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;runc&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">runtime_root</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">no_shim</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">false</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">shim_debug</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">false</span></span>
<span class="line"><span style="color:#E1E4E8;">  [plugins.opt]</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">path</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;/opt/containerd&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">  [plugins.restart]</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">interval</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;10s&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">  [plugins.scheduler]</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">pause_threshold</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0.02</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">deletion_threshold</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">mutation_threshold</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">100</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">schedule_delay</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;0s&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">startup_delay</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;100ms&quot;</span></span></code></pre><pre class="shiki github-light has-diff vp-code-light"><code><span class="line"><span style="color:#24292E;">[root@other sbin]# mkdir /etc/containerd</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#生成默认配置</span></span>
<span class="line"><span style="color:#6F42C1;">containerd</span><span style="color:#24292E;"> </span><span style="color:#032F62;">config</span><span style="color:#24292E;"> </span><span style="color:#032F62;">default</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/etc/containerd/config.toml</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#修改，单机或者k8s都适用的配置</span></span>
<span class="line"><span style="color:#6F42C1;">root</span><span style="color:#24292E;"> </span><span style="color:#032F62;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;/var/lib/containerd&quot;</span></span>
<span class="line"><span style="color:#6F42C1;">state</span><span style="color:#24292E;"> </span><span style="color:#032F62;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;/run/containerd&quot;</span></span>
<span class="line"><span style="color:#6F42C1;">oom_score</span><span style="color:#24292E;"> </span><span style="color:#032F62;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-999</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">[grpc]</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">address</span><span style="color:#24292E;"> </span><span style="color:#032F62;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;/run/containerd/containerd.sock&quot;</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">uid</span><span style="color:#24292E;"> </span><span style="color:#032F62;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">gid</span><span style="color:#24292E;"> </span><span style="color:#032F62;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">max_recv_message_size</span><span style="color:#24292E;"> </span><span style="color:#032F62;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">16777216</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">max_send_message_size</span><span style="color:#24292E;"> </span><span style="color:#032F62;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">16777216</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">tcp_address</span><span style="color:#24292E;"> </span><span style="color:#032F62;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;&quot;</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">tcp_tls_cert</span><span style="color:#24292E;"> </span><span style="color:#032F62;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;&quot;</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">tcp_tls_key</span><span style="color:#24292E;"> </span><span style="color:#032F62;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">[debug]</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">address</span><span style="color:#24292E;"> </span><span style="color:#032F62;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;&quot;</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">uid</span><span style="color:#24292E;"> </span><span style="color:#032F62;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">gid</span><span style="color:#24292E;"> </span><span style="color:#032F62;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">level</span><span style="color:#24292E;"> </span><span style="color:#032F62;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">[metrics]</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">address</span><span style="color:#24292E;"> </span><span style="color:#032F62;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;&quot;</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">grpc_histogram</span><span style="color:#24292E;"> </span><span style="color:#032F62;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">false</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">[cgroup]</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">path</span><span style="color:#24292E;"> </span><span style="color:#032F62;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">[plugins]</span></span>
<span class="line"><span style="color:#24292E;">  [plugins.cgroups]</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">no_prometheus</span><span style="color:#24292E;"> </span><span style="color:#032F62;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">false</span></span>
<span class="line"><span style="color:#24292E;">  [plugins.cri]</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">stream_server_address</span><span style="color:#24292E;"> </span><span style="color:#032F62;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;127.0.0.1&quot;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">stream_server_port</span><span style="color:#24292E;"> </span><span style="color:#032F62;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;0&quot;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">enable_selinux</span><span style="color:#24292E;"> </span><span style="color:#032F62;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">false</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">sandbox_image</span><span style="color:#24292E;"> </span><span style="color:#032F62;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;registry.aliyuncs.com/google_containers/pause:3.7&quot;</span><span style="color:#24292E;"> </span><span style="color:#6A737D;">#配置了沙箱镜像</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">stats_collect_period</span><span style="color:#24292E;"> </span><span style="color:#032F62;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">10</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">systemd_cgroup</span><span style="color:#24292E;"> </span><span style="color:#032F62;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">true</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">enable_tls_streaming</span><span style="color:#24292E;"> </span><span style="color:#032F62;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">false</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">max_container_log_line_size</span><span style="color:#24292E;"> </span><span style="color:#032F62;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">16384</span></span>
<span class="line"><span style="color:#24292E;">    [plugins.cri.containerd]</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#6F42C1;">snapshotter</span><span style="color:#24292E;"> </span><span style="color:#032F62;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;overlayfs&quot;</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#6F42C1;">no_pivot</span><span style="color:#24292E;"> </span><span style="color:#032F62;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">false</span></span>
<span class="line"><span style="color:#24292E;">      [plugins.cri.containerd.runtimes.runc.options]</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6F42C1;">BinaryName</span><span style="color:#24292E;"> </span><span style="color:#032F62;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;&quot;</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6F42C1;">CriuImagePath</span><span style="color:#24292E;"> </span><span style="color:#032F62;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;&quot;</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6F42C1;">CriuPath</span><span style="color:#24292E;"> </span><span style="color:#032F62;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;&quot;</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6F42C1;">CriuWorkPath</span><span style="color:#24292E;"> </span><span style="color:#032F62;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;&quot;</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6F42C1;">IoGid</span><span style="color:#24292E;"> </span><span style="color:#032F62;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6F42C1;">IoUid</span><span style="color:#24292E;"> </span><span style="color:#032F62;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6F42C1;">NoNewKeyring</span><span style="color:#24292E;"> </span><span style="color:#032F62;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">false</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6F42C1;">NoPivotRoot</span><span style="color:#24292E;"> </span><span style="color:#032F62;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">false</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6F42C1;">Root</span><span style="color:#24292E;"> </span><span style="color:#032F62;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;&quot;</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6F42C1;">ShimCgroup</span><span style="color:#24292E;"> </span><span style="color:#032F62;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;&quot;</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6F42C1;">SystemdCgroup</span><span style="color:#24292E;"> </span><span style="color:#032F62;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">true</span></span>
<span class="line"><span style="color:#24292E;">      [plugins.cri.containerd.default_runtime]</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6F42C1;">runtime_type</span><span style="color:#24292E;"> </span><span style="color:#032F62;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;io.containerd.runtime.v1.linux&quot;</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6F42C1;">runtime_engine</span><span style="color:#24292E;"> </span><span style="color:#032F62;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;&quot;</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6F42C1;">runtime_root</span><span style="color:#24292E;"> </span><span style="color:#032F62;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;&quot;</span></span>
<span class="line"><span style="color:#24292E;">      [plugins.cri.containerd.untrusted_workload_runtime]</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6F42C1;">runtime_type</span><span style="color:#24292E;"> </span><span style="color:#032F62;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;&quot;</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6F42C1;">runtime_engine</span><span style="color:#24292E;"> </span><span style="color:#032F62;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;&quot;</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6F42C1;">runtime_root</span><span style="color:#24292E;"> </span><span style="color:#032F62;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;&quot;</span></span>
<span class="line"><span style="color:#24292E;">    [plugins.cri.cni]</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#6F42C1;">bin_dir</span><span style="color:#24292E;"> </span><span style="color:#032F62;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;/opt/kube/bin&quot;</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#6F42C1;">conf_dir</span><span style="color:#24292E;"> </span><span style="color:#032F62;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;/etc/cni/net.d&quot;</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#6F42C1;">conf_template</span><span style="color:#24292E;"> </span><span style="color:#032F62;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;/etc/cni/net.d/10-default.conf&quot;</span></span>
<span class="line"><span style="color:#24292E;">    [plugins.cri.registry]</span></span>
<span class="line"><span style="color:#24292E;">      [plugins.cri.registry.mirrors]</span></span>
<span class="line"><span style="color:#24292E;">        [plugins.cri.registry.mirrors.</span><span style="color:#032F62;">&quot;docker.io&quot;</span><span style="color:#24292E;">]</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#6F42C1;">endpoint</span><span style="color:#24292E;"> </span><span style="color:#032F62;">=</span><span style="color:#24292E;"> [</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#6F42C1;">&quot;https://docker.mirrors.ustc.edu.cn&quot;</span><span style="color:#6F42C1;">,</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#6F42C1;">&quot;http://hub-mirror.c.163.com&quot;</span></span>
<span class="line"><span style="color:#24292E;">          ]</span></span>
<span class="line"><span style="color:#24292E;">        [plugins.cri.registry.mirrors.</span><span style="color:#032F62;">&quot;gcr.io&quot;</span><span style="color:#24292E;">]</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#6F42C1;">endpoint</span><span style="color:#24292E;"> </span><span style="color:#032F62;">=</span><span style="color:#24292E;"> [</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#6F42C1;">&quot;https://gcr.mirrors.ustc.edu.cn&quot;</span></span>
<span class="line"><span style="color:#24292E;">          ]</span></span>
<span class="line"><span style="color:#24292E;">        [plugins.cri.registry.mirrors.</span><span style="color:#032F62;">&quot;k8s.gcr.io&quot;</span><span style="color:#24292E;">]</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#6F42C1;">endpoint</span><span style="color:#24292E;"> </span><span style="color:#032F62;">=</span><span style="color:#24292E;"> [</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#6F42C1;">&quot;https://gcr.mirrors.ustc.edu.cn/google-containers/&quot;</span></span>
<span class="line"><span style="color:#24292E;">          ]</span></span>
<span class="line"><span style="color:#24292E;">        [plugins.cri.registry.mirrors.</span><span style="color:#032F62;">&quot;quay.io&quot;</span><span style="color:#24292E;">]</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#6F42C1;">endpoint</span><span style="color:#24292E;"> </span><span style="color:#032F62;">=</span><span style="color:#24292E;"> [</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#6F42C1;">&quot;https://quay.mirrors.ustc.edu.cn&quot;</span></span>
<span class="line"><span style="color:#24292E;">          ]</span></span>
<span class="line"><span style="color:#24292E;">    [plugins.cri.x509_key_pair_streaming]</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#6F42C1;">tls_cert_file</span><span style="color:#24292E;"> </span><span style="color:#032F62;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;&quot;</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#6F42C1;">tls_key_file</span><span style="color:#24292E;"> </span><span style="color:#032F62;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;&quot;</span></span>
<span class="line"><span style="color:#24292E;">  [plugins.diff-service]</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">default</span><span style="color:#24292E;"> </span><span style="color:#032F62;">=</span><span style="color:#24292E;"> [</span><span style="color:#032F62;">&quot;walking&quot;</span><span style="color:#24292E;">]</span></span>
<span class="line"><span style="color:#24292E;">  [plugins.linux]</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">shim</span><span style="color:#24292E;"> </span><span style="color:#032F62;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;containerd-shim&quot;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">runtime</span><span style="color:#24292E;"> </span><span style="color:#032F62;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;runc&quot;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">runtime_root</span><span style="color:#24292E;"> </span><span style="color:#032F62;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;&quot;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">no_shim</span><span style="color:#24292E;"> </span><span style="color:#032F62;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">false</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">shim_debug</span><span style="color:#24292E;"> </span><span style="color:#032F62;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">false</span></span>
<span class="line"><span style="color:#24292E;">  [plugins.opt]</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">path</span><span style="color:#24292E;"> </span><span style="color:#032F62;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;/opt/containerd&quot;</span></span>
<span class="line"><span style="color:#24292E;">  [plugins.restart]</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">interval</span><span style="color:#24292E;"> </span><span style="color:#032F62;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;10s&quot;</span></span>
<span class="line"><span style="color:#24292E;">  [plugins.scheduler]</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">pause_threshold</span><span style="color:#24292E;"> </span><span style="color:#032F62;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0.02</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">deletion_threshold</span><span style="color:#24292E;"> </span><span style="color:#032F62;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">mutation_threshold</span><span style="color:#24292E;"> </span><span style="color:#032F62;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">100</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">schedule_delay</span><span style="color:#24292E;"> </span><span style="color:#032F62;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;0s&quot;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">startup_delay</span><span style="color:#24292E;"> </span><span style="color:#032F62;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;100ms&quot;</span></span></code></pre></div><div class="danger custom-block"><p class="custom-block-title">❌ 注意</p><p>这个配置文件是给<code>crictl</code>和<code>kubelet</code>使用，<code>ctr</code>是不可以用这个配置文件的，ctr 不使用 CRI，因此它不读取plugins.&quot;io.containerd.grpc.v1.cri&quot;配置</p></div><ul><li>配置systemd</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">cat</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/etc/systemd/system/containerd.service</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">&lt;&lt;</span><span style="color:#9ECBFF;">EOF</span></span>
<span class="line"><span style="color:#9ECBFF;">[Unit]</span></span>
<span class="line"><span style="color:#9ECBFF;">Description=containerd container runtime</span></span>
<span class="line"><span style="color:#9ECBFF;">Documentation=https://containerd.io</span></span>
<span class="line"><span style="color:#9ECBFF;">After=network.target local-fs.target</span></span>
<span class="line"></span>
<span class="line"><span style="color:#9ECBFF;">[Service]</span></span>
<span class="line"><span style="color:#9ECBFF;">ExecStartPre=-/sbin/modprobe overlay</span></span>
<span class="line"><span style="color:#9ECBFF;">ExecStart=/usr/local/bin/containerd</span></span>
<span class="line"></span>
<span class="line"><span style="color:#9ECBFF;">Type=notify</span></span>
<span class="line"><span style="color:#9ECBFF;">Delegate=yes</span></span>
<span class="line"><span style="color:#9ECBFF;">KillMode=process</span></span>
<span class="line"><span style="color:#9ECBFF;">Restart=always</span></span>
<span class="line"><span style="color:#9ECBFF;">RestartSec=5</span></span>
<span class="line"><span style="color:#9ECBFF;"># Having non-zero Limit*s causes performance problems due to accounting overhead</span></span>
<span class="line"><span style="color:#9ECBFF;"># in the kernel. We recommend using cgroups to do container-local accounting.</span></span>
<span class="line"><span style="color:#9ECBFF;">LimitNPROC=infinity</span></span>
<span class="line"><span style="color:#9ECBFF;">LimitCORE=infinity</span></span>
<span class="line"><span style="color:#9ECBFF;">LimitNOFILE=1048576</span></span>
<span class="line"><span style="color:#9ECBFF;"># Comment TasksMax if your systemd version does not supports it.</span></span>
<span class="line"><span style="color:#9ECBFF;"># Only systemd 226 and above support this version.</span></span>
<span class="line"><span style="color:#9ECBFF;">TasksMax=infinity</span></span>
<span class="line"><span style="color:#9ECBFF;">OOMScoreAdjust=-999</span></span>
<span class="line"></span>
<span class="line"><span style="color:#9ECBFF;">[Install]</span></span>
<span class="line"><span style="color:#9ECBFF;">WantedBy=multi-user.target</span></span>
<span class="line"><span style="color:#9ECBFF;">EOF</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">cat</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/etc/systemd/system/containerd.service</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&lt;&lt;</span><span style="color:#032F62;">EOF</span></span>
<span class="line"><span style="color:#032F62;">[Unit]</span></span>
<span class="line"><span style="color:#032F62;">Description=containerd container runtime</span></span>
<span class="line"><span style="color:#032F62;">Documentation=https://containerd.io</span></span>
<span class="line"><span style="color:#032F62;">After=network.target local-fs.target</span></span>
<span class="line"></span>
<span class="line"><span style="color:#032F62;">[Service]</span></span>
<span class="line"><span style="color:#032F62;">ExecStartPre=-/sbin/modprobe overlay</span></span>
<span class="line"><span style="color:#032F62;">ExecStart=/usr/local/bin/containerd</span></span>
<span class="line"></span>
<span class="line"><span style="color:#032F62;">Type=notify</span></span>
<span class="line"><span style="color:#032F62;">Delegate=yes</span></span>
<span class="line"><span style="color:#032F62;">KillMode=process</span></span>
<span class="line"><span style="color:#032F62;">Restart=always</span></span>
<span class="line"><span style="color:#032F62;">RestartSec=5</span></span>
<span class="line"><span style="color:#032F62;"># Having non-zero Limit*s causes performance problems due to accounting overhead</span></span>
<span class="line"><span style="color:#032F62;"># in the kernel. We recommend using cgroups to do container-local accounting.</span></span>
<span class="line"><span style="color:#032F62;">LimitNPROC=infinity</span></span>
<span class="line"><span style="color:#032F62;">LimitCORE=infinity</span></span>
<span class="line"><span style="color:#032F62;">LimitNOFILE=1048576</span></span>
<span class="line"><span style="color:#032F62;"># Comment TasksMax if your systemd version does not supports it.</span></span>
<span class="line"><span style="color:#032F62;"># Only systemd 226 and above support this version.</span></span>
<span class="line"><span style="color:#032F62;">TasksMax=infinity</span></span>
<span class="line"><span style="color:#032F62;">OOMScoreAdjust=-999</span></span>
<span class="line"></span>
<span class="line"><span style="color:#032F62;">[Install]</span></span>
<span class="line"><span style="color:#032F62;">WantedBy=multi-user.target</span></span>
<span class="line"><span style="color:#032F62;">EOF</span></span></code></pre></div><ul><li>启动</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">#重新加载配置</span></span>
<span class="line"><span style="color:#B392F0;">systemctl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">daemon-reload</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#启动</span></span>
<span class="line"><span style="color:#B392F0;">systemctl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">enable</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--now</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">containerd.service</span><span style="color:#E1E4E8;"> ; </span><span style="color:#B392F0;">systemctl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">status</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">containerd.service</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">[root@other containerd]# systemctl status containerd</span></span>
<span class="line"><span style="color:#B392F0;">●</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">containerd.service</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">-</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">containerd</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">container</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">runtime</span></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#B392F0;">Loaded:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">loaded</span><span style="color:#E1E4E8;"> (/etc/systemd/system/containerd.service; </span><span style="color:#B392F0;">enabled</span><span style="color:#E1E4E8;">; </span><span style="color:#B392F0;">vendor</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">preset:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">disabled</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#B392F0;">Active:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">active</span><span style="color:#E1E4E8;"> (running) since 四 2023-10-26 10:59:58 CST; </span><span style="color:#B392F0;">6s</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">ago</span></span>
<span class="line"><span style="color:#E1E4E8;">     </span><span style="color:#B392F0;">Docs:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">https://containerd.io</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">Process:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">1767</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">ExecStartPre=/sbin/modprobe</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">overlay</span><span style="color:#E1E4E8;"> (code=exited, </span><span style="color:#9ECBFF;">status=</span><span style="color:#79B8FF;">0</span><span style="color:#9ECBFF;">/SUCCESS</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Main</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">PID:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">1779</span><span style="color:#E1E4E8;"> (containerd)</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">Tasks:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">8</span></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#B392F0;">Memory:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">15.9</span><span style="color:#9ECBFF;">M</span></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#B392F0;">CGroup:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/system.slice/containerd.service</span></span>
<span class="line"><span style="color:#E1E4E8;">           </span><span style="color:#B392F0;">└─1779</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/usr/local/bin/containerd</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">#重新加载配置</span></span>
<span class="line"><span style="color:#6F42C1;">systemctl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">daemon-reload</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#启动</span></span>
<span class="line"><span style="color:#6F42C1;">systemctl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">enable</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--now</span><span style="color:#24292E;"> </span><span style="color:#032F62;">containerd.service</span><span style="color:#24292E;"> ; </span><span style="color:#6F42C1;">systemctl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">status</span><span style="color:#24292E;"> </span><span style="color:#032F62;">containerd.service</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">[root@other containerd]# systemctl status containerd</span></span>
<span class="line"><span style="color:#6F42C1;">●</span><span style="color:#24292E;"> </span><span style="color:#032F62;">containerd.service</span><span style="color:#24292E;"> </span><span style="color:#032F62;">-</span><span style="color:#24292E;"> </span><span style="color:#032F62;">containerd</span><span style="color:#24292E;"> </span><span style="color:#032F62;">container</span><span style="color:#24292E;"> </span><span style="color:#032F62;">runtime</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#6F42C1;">Loaded:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">loaded</span><span style="color:#24292E;"> (/etc/systemd/system/containerd.service; </span><span style="color:#6F42C1;">enabled</span><span style="color:#24292E;">; </span><span style="color:#6F42C1;">vendor</span><span style="color:#24292E;"> </span><span style="color:#032F62;">preset:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">disabled</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#6F42C1;">Active:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">active</span><span style="color:#24292E;"> (running) since 四 2023-10-26 10:59:58 CST; </span><span style="color:#6F42C1;">6s</span><span style="color:#24292E;"> </span><span style="color:#032F62;">ago</span></span>
<span class="line"><span style="color:#24292E;">     </span><span style="color:#6F42C1;">Docs:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">https://containerd.io</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">Process:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1767</span><span style="color:#24292E;"> </span><span style="color:#032F62;">ExecStartPre=/sbin/modprobe</span><span style="color:#24292E;"> </span><span style="color:#032F62;">overlay</span><span style="color:#24292E;"> (code=exited, </span><span style="color:#032F62;">status=</span><span style="color:#005CC5;">0</span><span style="color:#032F62;">/SUCCESS</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Main</span><span style="color:#24292E;"> </span><span style="color:#032F62;">PID:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1779</span><span style="color:#24292E;"> (containerd)</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">Tasks:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">8</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#6F42C1;">Memory:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">15.9</span><span style="color:#032F62;">M</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#6F42C1;">CGroup:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/system.slice/containerd.service</span></span>
<span class="line"><span style="color:#24292E;">           </span><span style="color:#6F42C1;">└─1779</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/usr/local/bin/containerd</span></span></code></pre></div><ul><li>查看版本号</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">[root@kube-master-01 containers]# ctr version</span></span>
<span class="line"><span style="color:#B392F0;">Client:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">Version:</span><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">v1.7.7</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">Revision:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">7</span><span style="color:#9ECBFF;">f7fdf5fed64eb6a7caf99b3e12efcf9d60e311c</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">Go</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">version:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">go1.22.7</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">Server:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">Version:</span><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">v1.7.7</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">Revision:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">7</span><span style="color:#9ECBFF;">f7fdf5fed64eb6a7caf99b3e12efcf9d60e311c</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">UUID:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">e99af880-4220-489a-b0a0-6ae2fb786877</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">[root@kube-master-01 containers]# ctr version</span></span>
<span class="line"><span style="color:#6F42C1;">Client:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">Version:</span><span style="color:#24292E;">  </span><span style="color:#032F62;">v1.7.7</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">Revision:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">7</span><span style="color:#032F62;">f7fdf5fed64eb6a7caf99b3e12efcf9d60e311c</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">Go</span><span style="color:#24292E;"> </span><span style="color:#032F62;">version:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">go1.22.7</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">Server:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">Version:</span><span style="color:#24292E;">  </span><span style="color:#032F62;">v1.7.7</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">Revision:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">7</span><span style="color:#032F62;">f7fdf5fed64eb6a7caf99b3e12efcf9d60e311c</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">UUID:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">e99af880-4220-489a-b0a0-6ae2fb786877</span></span></code></pre></div><p><a href="https://blog.csdn.net/ChaITSimpleLove/article/details/125031074" target="_blank" rel="noreferrer">https://blog.csdn.net/ChaITSimpleLove/article/details/125031074</a></p><p><a href="https://blog.huweihuang.com/" target="_blank" rel="noreferrer">https://blog.huweihuang.com/</a></p><h2 id="_4-container客户端工具" tabindex="-1">4.container客户端工具 <a class="header-anchor" href="#_4-container客户端工具" aria-label="Permalink to &quot;4.container客户端工具&quot;">​</a></h2><p>客户端工具有两种，分别是crictl和nerdctl</p><p><code>推荐使用nerdctl，使用效果与docker命令的语法一致</code></p><p>github下载链接：<a href="https://github.com/containerd/nerdctl/releases" target="_blank" rel="noreferrer">https://github.com/containerd/nerdctl/releases</a></p><h3 id="_4-1-crictl" tabindex="-1">4.1 crictl <a class="header-anchor" href="#_4-1-crictl" aria-label="Permalink to &quot;4.1 crictl&quot;">​</a></h3><p>crictl 是 CRI 兼容的容器运行时命令行接口，和containerd无关，由Kubernetes提供，可以使用它来检查和调试 k8s 节点上的容器运行时和应用程序。</p><p>下载地址：<a href="https://github.com/kubernetes-sigs/cri-tools/releases" target="_blank" rel="noreferrer">https://github.com/kubernetes-sigs/cri-tools/releases</a></p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;"># 下载,根据k8s版本进行安装</span></span>
<span class="line"><span style="color:#B392F0;">wget</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">https://github.com/kubernetes-sigs/cri-tools/releases/download/v1.27.1/crictl-v1.27.1-linux-amd64.tar.gz</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 解压</span></span>
<span class="line"><span style="color:#B392F0;">tar</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-zxvf</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">crictl-v1.27.1-linux-amd64.tar.gz</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-C</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/usr/local/bin</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 配置</span></span>
<span class="line"><span style="color:#B392F0;">cat</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/etc/crictl.yaml</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">&lt;&lt;</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">EOF</span></span>
<span class="line"><span style="color:#9ECBFF;">runtime-endpoint: &quot;unix:///run/containerd/containerd.sock&quot;</span></span>
<span class="line"><span style="color:#9ECBFF;">image-endpoint: &quot;unix:///run/containerd/containerd.sock&quot;</span></span>
<span class="line"><span style="color:#9ECBFF;">timeout: 0</span></span>
<span class="line"><span style="color:#9ECBFF;">debug: false</span></span>
<span class="line"><span style="color:#9ECBFF;">pull-image-on-create: false</span></span>
<span class="line"><span style="color:#9ECBFF;">disable-pull-on-run: false</span></span>
<span class="line"><span style="color:#9ECBFF;">EOF</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 验证</span></span>
<span class="line"><span style="color:#B392F0;">crictl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">version</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;"># 下载,根据k8s版本进行安装</span></span>
<span class="line"><span style="color:#6F42C1;">wget</span><span style="color:#24292E;"> </span><span style="color:#032F62;">https://github.com/kubernetes-sigs/cri-tools/releases/download/v1.27.1/crictl-v1.27.1-linux-amd64.tar.gz</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 解压</span></span>
<span class="line"><span style="color:#6F42C1;">tar</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-zxvf</span><span style="color:#24292E;"> </span><span style="color:#032F62;">crictl-v1.27.1-linux-amd64.tar.gz</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-C</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/usr/local/bin</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 配置</span></span>
<span class="line"><span style="color:#6F42C1;">cat</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/etc/crictl.yaml</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&lt;&lt;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">EOF</span></span>
<span class="line"><span style="color:#032F62;">runtime-endpoint: &quot;unix:///run/containerd/containerd.sock&quot;</span></span>
<span class="line"><span style="color:#032F62;">image-endpoint: &quot;unix:///run/containerd/containerd.sock&quot;</span></span>
<span class="line"><span style="color:#032F62;">timeout: 0</span></span>
<span class="line"><span style="color:#032F62;">debug: false</span></span>
<span class="line"><span style="color:#032F62;">pull-image-on-create: false</span></span>
<span class="line"><span style="color:#032F62;">disable-pull-on-run: false</span></span>
<span class="line"><span style="color:#032F62;">EOF</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 验证</span></span>
<span class="line"><span style="color:#6F42C1;">crictl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">version</span></span></code></pre></div><h3 id="_4-2-nerdctl" tabindex="-1">4.2 nerdctl <a class="header-anchor" href="#_4-2-nerdctl" aria-label="Permalink to &quot;4.2 nerdctl&quot;">​</a></h3><p>containerd虽然可直接提供给终端用户直接使用，也提供了命令行工具(ctr)，但并不是很友好，所以nerdctl应运而生，它也是containerd的命令行工具，支持docker cli关于容器生命周期管理的所有命令，并且支持docker compose (nerdctl compose up).</p><p>下载地址：<a href="https://github.com/containerd/nerdctl/releases" target="_blank" rel="noreferrer">https://github.com/containerd/nerdctl/releases</a></p><ul><li>精简 (nerdctl--linux-amd64.tar.gz): 只包含nerdctl</li><li>完整 (nerdctl-full--linux-amd64.tar.gz): 包含 containerd, runc, and CNI等依赖</li></ul><blockquote><p><code>nerdctl</code> 的目标并不是单纯地复制 docker 的功能，它还实现了很多 docker 不具备的功能，例如延迟拉取镜像（lazy-pulling）、镜像加密（imgcrypt）等</p></blockquote><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">#二进制包,如果没有安装 containerd，则可以下载 nerdctl-full-&lt;VERSION&gt;-linux-amd64.tar.gz 包进行安装</span></span>
<span class="line"><span style="color:#B392F0;">wget</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">https://github.com/containerd/nerdctl/releases/download/v1.6.2/nerdctl-1.6.2-linux-amd64.tar.gz</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#解压cp</span></span>
<span class="line"><span style="color:#B392F0;">tar</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">xvf</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">nerdctl-1.6.2-linux-amd64.tar.gz</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">cp</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">nerdctl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/usr/local/bin/</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#验证</span></span>
<span class="line"><span style="color:#B392F0;">nerdctl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">version</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">#二进制包,如果没有安装 containerd，则可以下载 nerdctl-full-&lt;VERSION&gt;-linux-amd64.tar.gz 包进行安装</span></span>
<span class="line"><span style="color:#6F42C1;">wget</span><span style="color:#24292E;"> </span><span style="color:#032F62;">https://github.com/containerd/nerdctl/releases/download/v1.6.2/nerdctl-1.6.2-linux-amd64.tar.gz</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#解压cp</span></span>
<span class="line"><span style="color:#6F42C1;">tar</span><span style="color:#24292E;"> </span><span style="color:#032F62;">xvf</span><span style="color:#24292E;"> </span><span style="color:#032F62;">nerdctl-1.6.2-linux-amd64.tar.gz</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">cp</span><span style="color:#24292E;"> </span><span style="color:#032F62;">nerdctl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/usr/local/bin/</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#验证</span></span>
<span class="line"><span style="color:#6F42C1;">nerdctl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">version</span></span></code></pre></div>`,49),e=[o];function c(t,r,E,y,i,F){return n(),a("div",null,e)}const C=s(p,[["render",c]]);export{u as __pageData,C as default};
