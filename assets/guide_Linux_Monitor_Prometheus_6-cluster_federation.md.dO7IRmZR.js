import{_ as s,o as a,c as e,R as n}from"./chunks/framework.zUbWieqp.js";const y=JSON.parse('{"title":"1. Prometheus联邦集群","description":"","frontmatter":{},"headers":[],"relativePath":"guide/Linux/Monitor/Prometheus/6-cluster_federation.md","filePath":"guide/Linux/Monitor/Prometheus/6-cluster_federation.md","lastUpdated":1739960402000}'),o={name:"guide/Linux/Monitor/Prometheus/6-cluster_federation.md"},l=n(`<h1 id="_1-prometheus联邦集群" tabindex="-1">1. Prometheus联邦集群 <a class="header-anchor" href="#_1-prometheus联邦集群" aria-label="Permalink to &quot;1. Prometheus联邦集群&quot;">​</a></h1><p><a href="https://prometheus.io/docs/prometheus/latest/federation/" target="_blank" rel="noreferrer">https://prometheus.io/docs/prometheus/latest/federation/</a></p><h2 id="_1-1-介绍" tabindex="-1">1.1 介绍 <a class="header-anchor" href="#_1-1-介绍" aria-label="Permalink to &quot;1.1 介绍&quot;">​</a></h2><p>Pormetheus Federation（联邦）机制是 Promehteus 本身提供的一种集群化的扩展能力。当我们要监控的服务很多的时候，我们会部署很多的 Prometheus 节点分别 Pull 这些服务暴露的 Metrics，Federation 机制可以讲这些分别部署的 Prometheus 节点所获得的指标聚合起来，存放在一个中心点的 Prometheus。</p><p><img src="https://nnaigos.oss-cn-hangzhou.aliyuncs.com/imgs/202502191734782.png" alt="image-20250219173402017"></p><h2 id="_1-2-作用" tabindex="-1">1.2 作用 <a class="header-anchor" href="#_1-2-作用" aria-label="Permalink to &quot;1.2 作用&quot;">​</a></h2><p>如果prometheus需要采集的服务器过多，会导致prometheus server节点压力过大，降低服务器性能。为了分担server节点的压力，可以配置prometheus联邦集群。   Prometheus联邦集群通过设置多个prometheus联邦从节点采集服务器数据，然后再将联邦节点的数据汇总到prometheus联邦server主节点。server主节点负责接收联邦节点数据，而采集服务器数据的任务则是由联邦节点完成，这样就可以分担server节点的压力。</p><h2 id="_1-3-环境配置" tabindex="-1">1.3 环境配置 <a class="header-anchor" href="#_1-3-环境配置" aria-label="Permalink to &quot;1.3 环境配置&quot;">​</a></h2><table><thead><tr><th>ip</th><th>描述</th></tr></thead><tbody><tr><td>10.103.236.199</td><td>Prometheus Server，node_exporter</td></tr><tr><td>10.103.236.20</td><td>Prometheus Federation</td></tr><tr><td>10.103.236.21</td><td>Prometheus Federation</td></tr></tbody></table><h1 id="_2-prometheus部署" tabindex="-1">2. Prometheus部署 <a class="header-anchor" href="#_2-prometheus部署" aria-label="Permalink to &quot;2. Prometheus部署&quot;">​</a></h1><h2 id="_2-1-所有节点部署" tabindex="-1">2.1 所有节点部署 <a class="header-anchor" href="#_2-1-所有节点部署" aria-label="Permalink to &quot;2.1 所有节点部署&quot;">​</a></h2><h2 id="_2-2-聚合节点" tabindex="-1">2.2 聚合节点 <a class="header-anchor" href="#_2-2-聚合节点" aria-label="Permalink to &quot;2.2 聚合节点&quot;">​</a></h2><ul><li>10.103.236.199</li></ul><div class="language-yml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yml</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#85E89D;">scrape_configs</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  - </span><span style="color:#85E89D;">job_name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&#39;federate&#39;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">scrape_interval</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">10s</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">honor_labels</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">true</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">metrics_path</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&#39;/federate&#39;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;"># 通过 match 参数，配置要拉取的 Metrics，</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;"># 不要 Pull full metrics</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">params</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#9ECBFF;">&#39;match[]&#39;</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">        - </span><span style="color:#9ECBFF;">&#39;{job=&quot;prometheus&quot;}&#39;</span></span>
<span class="line"><span style="color:#E1E4E8;">        - </span><span style="color:#9ECBFF;">&#39;{job=&quot;node&quot;}&#39;</span></span>
<span class="line"><span style="color:#E1E4E8;">        - </span><span style="color:#9ECBFF;">&#39;{job=&quot;blackbox&quot;}&#39;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">static_configs</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#6A737D;"># 其他 Prometheus 节点</span></span>
<span class="line"><span style="color:#E1E4E8;">      - </span><span style="color:#85E89D;">targets</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">        - </span><span style="color:#9ECBFF;">&#39;prometheus-follower-1:9090&#39;</span></span>
<span class="line"><span style="color:#E1E4E8;">        - </span><span style="color:#9ECBFF;">&#39;prometheus-follower-2:9090&#39;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#22863A;">scrape_configs</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  - </span><span style="color:#22863A;">job_name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&#39;federate&#39;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">scrape_interval</span><span style="color:#24292E;">: </span><span style="color:#032F62;">10s</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">honor_labels</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">true</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">metrics_path</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&#39;/federate&#39;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;"># 通过 match 参数，配置要拉取的 Metrics，</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;"># 不要 Pull full metrics</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">params</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#032F62;">&#39;match[]&#39;</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">        - </span><span style="color:#032F62;">&#39;{job=&quot;prometheus&quot;}&#39;</span></span>
<span class="line"><span style="color:#24292E;">        - </span><span style="color:#032F62;">&#39;{job=&quot;node&quot;}&#39;</span></span>
<span class="line"><span style="color:#24292E;">        - </span><span style="color:#032F62;">&#39;{job=&quot;blackbox&quot;}&#39;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">static_configs</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#6A737D;"># 其他 Prometheus 节点</span></span>
<span class="line"><span style="color:#24292E;">      - </span><span style="color:#22863A;">targets</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">        - </span><span style="color:#032F62;">&#39;prometheus-follower-1:9090&#39;</span></span>
<span class="line"><span style="color:#24292E;">        - </span><span style="color:#032F62;">&#39;prometheus-follower-2:9090&#39;</span></span></code></pre></div><h2 id="_2-3-federation01" tabindex="-1">2.3 Federation01 <a class="header-anchor" href="#_2-3-federation01" aria-label="Permalink to &quot;2.3 Federation01&quot;">​</a></h2><ul><li>10.103.236.20</li></ul><h2 id="_2-4-federation02" tabindex="-1">2.4 Federation02 <a class="header-anchor" href="#_2-4-federation02" aria-label="Permalink to &quot;2.4 Federation02&quot;">​</a></h2><ul><li>10.103.236.20</li></ul>`,18),t=[l];function p(r,c,i,E,h,u){return a(),e("div",null,t)}const m=s(o,[["render",p]]);export{y as __pageData,m as default};
