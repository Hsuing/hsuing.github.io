import{_ as s,o as a,c as n,R as p}from"./chunks/framework.zUbWieqp.js";const d=JSON.parse('{"title":"1.cert-manager + Let‘s Encrypt + DNS 实现基于K8S的https证书自动签发","description":"","frontmatter":{},"headers":[],"relativePath":"guide/container/k8s/TroubleshootingMaintenanceManual/25-cert-manager.md","filePath":"guide/container/k8s/TroubleshootingMaintenanceManual/25-cert-manager.md","lastUpdated":1756092571000}'),l={name:"guide/container/k8s/TroubleshootingMaintenanceManual/25-cert-manager.md"},e=p(`<h1 id="_1-cert-manager-let-s-encrypt-dns-实现基于k8s的https证书自动签发" tabindex="-1">1.cert-manager + Let‘s Encrypt + DNS 实现基于K8S的https证书自动签发 <a class="header-anchor" href="#_1-cert-manager-let-s-encrypt-dns-实现基于k8s的https证书自动签发" aria-label="Permalink to &quot;1.cert-manager + Let‘s Encrypt + DNS 实现基于K8S的https证书自动签发&quot;">​</a></h1><p>原理</p><p>创建ClusterIssuer或者Issuer资源用于创建颁发者，决定cert-manager签发证书的方式，然后会在cert-manager上的namespace下生成该颁发者的secret用于证书申请的准备。</p><p>通过创建Certificate资源来告知cert-manager ：在哪个namespace生成证书、需要签发的域名的证书名称，域名对应的secret资源，以及的引用ClusterIssuer或者Issuer资源等等信息。</p><p>cert-manager拿着创建好的Certificate资源与ClusterIssuer或者Issuer资源的secret通过内部或外部的webhook向所支持的域名服务提供商对域名进行解析，这里会发起certificaterequests与challenges动作。</p><p>解析通过acme校验后将证书返回至cert-manager，certificatere对应项会变成True验证通过状态，再将证书转换到对应namespace下的secret资源做证书引用准备。</p><p>在Ingress-controller上生成ingress资源引用该证书secret即可实现https可信访问。</p><h2 id="_1-1-部署" tabindex="-1">1.1 部署 <a class="header-anchor" href="#_1-1-部署" aria-label="Permalink to &quot;1.1 部署&quot;">​</a></h2><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">apply</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-f</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">https://github.com/cert-manager/cert-manager/releases/download/v1.15.3/cert-manager.yaml</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">apply</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-f</span><span style="color:#24292E;"> </span><span style="color:#032F62;">https://github.com/cert-manager/cert-manager/releases/download/v1.15.3/cert-manager.yaml</span></span></code></pre></div><h2 id="_1-2-导入阿里云的aksk-管理dns的权限" tabindex="-1">1.2 导入阿里云的AKSK(管理DNS的权限) <a class="header-anchor" href="#_1-2-导入阿里云的aksk-管理dns的权限" aria-label="Permalink to &quot;1.2 导入阿里云的AKSK(管理DNS的权限)&quot;">​</a></h2><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">apiVersion: v1</span></span>
<span class="line"><span style="color:#e1e4e8;">kind: Secret</span></span>
<span class="line"><span style="color:#e1e4e8;">metadata:</span></span>
<span class="line"><span style="color:#e1e4e8;">  name: alidns-secret</span></span>
<span class="line"><span style="color:#e1e4e8;">  namespace: cert-manager</span></span>
<span class="line"><span style="color:#e1e4e8;">stringData:</span></span>
<span class="line"><span style="color:#e1e4e8;">  access-key-id: &quot;Your Access Key Id&quot;</span></span>
<span class="line"><span style="color:#e1e4e8;">  access-key-secret: &quot;Your Access Key Secret&quot;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">apiVersion: v1</span></span>
<span class="line"><span style="color:#24292e;">kind: Secret</span></span>
<span class="line"><span style="color:#24292e;">metadata:</span></span>
<span class="line"><span style="color:#24292e;">  name: alidns-secret</span></span>
<span class="line"><span style="color:#24292e;">  namespace: cert-manager</span></span>
<span class="line"><span style="color:#24292e;">stringData:</span></span>
<span class="line"><span style="color:#24292e;">  access-key-id: &quot;Your Access Key Id&quot;</span></span>
<span class="line"><span style="color:#24292e;">  access-key-secret: &quot;Your Access Key Secret&quot;</span></span></code></pre></div><h2 id="_1-3-部署alidns-webhook" tabindex="-1">1.3 部署alidns-webhook <a class="header-anchor" href="#_1-3-部署alidns-webhook" aria-label="Permalink to &quot;1.3 部署alidns-webhook&quot;">​</a></h2><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;"># alidns-webhook 仓库</span></span>
<span class="line"><span style="color:#6A737D;"># https://github.com/wjiec/alidns-webhook</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">helm</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">upgrade</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--install</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">alidns-webhook</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">alidns-webhook</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#79B8FF;">--repo</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">https://wjiec.github.io/alidns-webhook</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#79B8FF;">--namespace</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">cert-manager</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--create-namespace</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#79B8FF;">--set</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">groupName=acme.yourcompany.com</span></span>
<span class="line"><span style="color:#6A737D;"># groupName=设置成你的名称(可以不是申请证书的域名)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 部署后更换国内镜像</span></span>
<span class="line"><span style="color:#6A737D;"># registry.cn-shenzhen.aliyuncs.com/starsl/alidns-webhook:v1.0.0</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;"># alidns-webhook 仓库</span></span>
<span class="line"><span style="color:#6A737D;"># https://github.com/wjiec/alidns-webhook</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">helm</span><span style="color:#24292E;"> </span><span style="color:#032F62;">upgrade</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--install</span><span style="color:#24292E;"> </span><span style="color:#032F62;">alidns-webhook</span><span style="color:#24292E;"> </span><span style="color:#032F62;">alidns-webhook</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#005CC5;">--repo</span><span style="color:#24292E;"> </span><span style="color:#032F62;">https://wjiec.github.io/alidns-webhook</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#005CC5;">--namespace</span><span style="color:#24292E;"> </span><span style="color:#032F62;">cert-manager</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--create-namespace</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#005CC5;">--set</span><span style="color:#24292E;"> </span><span style="color:#032F62;">groupName=acme.yourcompany.com</span></span>
<span class="line"><span style="color:#6A737D;"># groupName=设置成你的名称(可以不是申请证书的域名)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 部署后更换国内镜像</span></span>
<span class="line"><span style="color:#6A737D;"># registry.cn-shenzhen.aliyuncs.com/starsl/alidns-webhook:v1.0.0</span></span></code></pre></div><h2 id="_1-4-创建ca证书颁发者" tabindex="-1">1.4 创建CA证书颁发者 <a class="header-anchor" href="#_1-4-创建ca证书颁发者" aria-label="Permalink to &quot;1.4 创建CA证书颁发者&quot;">​</a></h2><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">apiVersion:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">cert-manager.io/v1</span></span>
<span class="line"><span style="color:#B392F0;">kind:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">ClusterIssuer</span></span>
<span class="line"><span style="color:#B392F0;">metadata:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">name:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">example-acme</span></span>
<span class="line"><span style="color:#B392F0;">spec:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">acme:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">server:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">https://acme-v02.api.letsencrypt.org/directory</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">email:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">your@aaabbbccc.com</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># 填写邮箱名称</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">privateKeySecretRef:</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#B392F0;">name:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">example-acme</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># 用于存储 ACME 帐户私钥的密钥名称(可自定义名称)</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">solvers:</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#B392F0;">-</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">dns01:</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#B392F0;">webhook:</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#B392F0;">groupName:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">acme.yourcompany.com</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># 要和安装的时候配置的groupName一致</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#B392F0;">solverName:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">alidns</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#B392F0;">config:</span></span>
<span class="line"><span style="color:#E1E4E8;">              </span><span style="color:#B392F0;">region:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;cn-hangzhou&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># 不用修改</span></span>
<span class="line"><span style="color:#E1E4E8;">              </span><span style="color:#B392F0;">accessKeyIdRef:</span></span>
<span class="line"><span style="color:#E1E4E8;">                </span><span style="color:#B392F0;">name:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">alidns-secret</span></span>
<span class="line"><span style="color:#E1E4E8;">                </span><span style="color:#B392F0;">key:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">access-key-id</span></span>
<span class="line"><span style="color:#E1E4E8;">              </span><span style="color:#B392F0;">accessKeySecretRef:</span></span>
<span class="line"><span style="color:#E1E4E8;">                </span><span style="color:#B392F0;">name:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">alidns-secret</span></span>
<span class="line"><span style="color:#E1E4E8;">                </span><span style="color:#B392F0;">key:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">access-key-secret</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">apiVersion:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">cert-manager.io/v1</span></span>
<span class="line"><span style="color:#6F42C1;">kind:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">ClusterIssuer</span></span>
<span class="line"><span style="color:#6F42C1;">metadata:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">name:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">example-acme</span></span>
<span class="line"><span style="color:#6F42C1;">spec:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">acme:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">server:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">https://acme-v02.api.letsencrypt.org/directory</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">email:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">your@aaabbbccc.com</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 填写邮箱名称</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">privateKeySecretRef:</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#6F42C1;">name:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">example-acme</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 用于存储 ACME 帐户私钥的密钥名称(可自定义名称)</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">solvers:</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#6F42C1;">-</span><span style="color:#24292E;"> </span><span style="color:#032F62;">dns01:</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#6F42C1;">webhook:</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#6F42C1;">groupName:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">acme.yourcompany.com</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 要和安装的时候配置的groupName一致</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#6F42C1;">solverName:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">alidns</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#6F42C1;">config:</span></span>
<span class="line"><span style="color:#24292E;">              </span><span style="color:#6F42C1;">region:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;cn-hangzhou&quot;</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 不用修改</span></span>
<span class="line"><span style="color:#24292E;">              </span><span style="color:#6F42C1;">accessKeyIdRef:</span></span>
<span class="line"><span style="color:#24292E;">                </span><span style="color:#6F42C1;">name:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">alidns-secret</span></span>
<span class="line"><span style="color:#24292E;">                </span><span style="color:#6F42C1;">key:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">access-key-id</span></span>
<span class="line"><span style="color:#24292E;">              </span><span style="color:#6F42C1;">accessKeySecretRef:</span></span>
<span class="line"><span style="color:#24292E;">                </span><span style="color:#6F42C1;">name:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">alidns-secret</span></span>
<span class="line"><span style="color:#24292E;">                </span><span style="color:#6F42C1;">key:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">access-key-secret</span></span></code></pre></div><h2 id="_1-5-创建证书" tabindex="-1">1.5 创建证书 <a class="header-anchor" href="#_1-5-创建证书" aria-label="Permalink to &quot;1.5 创建证书&quot;">​</a></h2><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">apiVersion:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">cert-manager.io/v1</span></span>
<span class="line"><span style="color:#B392F0;">kind:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Certificate</span></span>
<span class="line"><span style="color:#B392F0;">metadata:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">name:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">star-example-com</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">namespace:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">cert-manager</span></span>
<span class="line"><span style="color:#B392F0;">spec:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">secretName:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">star-example-com-tls</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;">#生成证书文件的名称</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">dnsNames:</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># 需要签发证书的域名</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">-</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;example.com&quot;</span><span style="color:#E1E4E8;"> </span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">-</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;*.example.com&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">issuerRef:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">name:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">example-acme</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># 上一步生成的ClusterIssuer的名称</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">kind:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">ClusterIssuer</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">apiVersion:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">cert-manager.io/v1</span></span>
<span class="line"><span style="color:#6F42C1;">kind:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Certificate</span></span>
<span class="line"><span style="color:#6F42C1;">metadata:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">name:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">star-example-com</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">namespace:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">cert-manager</span></span>
<span class="line"><span style="color:#6F42C1;">spec:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">secretName:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">star-example-com-tls</span><span style="color:#24292E;"> </span><span style="color:#6A737D;">#生成证书文件的名称</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">dnsNames:</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 需要签发证书的域名</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">-</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;example.com&quot;</span><span style="color:#24292E;"> </span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">-</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;*.example.com&quot;</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">issuerRef:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">name:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">example-acme</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 上一步生成的ClusterIssuer的名称</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">kind:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">ClusterIssuer</span></span></code></pre></div><p>创建Certificate后，cert-manager与alidns-webhook开始进行证书签发工作:</p><p>alidns-webhook使用AKSK去请求阿里的DNS域名解析接口去进行解析记录操作。</p><p>检查创建的certificate资源，状态变为True表示证书已经签发成功。</p><p>查看secret资源，生成的star-example-com-tls即为证书文件。</p><h2 id="_1-6-从ingress自动生成证书" tabindex="-1">1.6 从ingress自动生成证书 <a class="header-anchor" href="#_1-6-从ingress自动生成证书" aria-label="Permalink to &quot;1.6 从ingress自动生成证书&quot;">​</a></h2><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">kind:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Ingress</span></span>
<span class="line"><span style="color:#B392F0;">apiVersion:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">networking.k8s.io/v1</span></span>
<span class="line"><span style="color:#B392F0;">metadata:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">name:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">foo-example-com</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">annotations:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">cert-manager.io/cluster-issuer:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;example-acme&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># 增加该行即可自动生成证书</span></span>
<span class="line"><span style="color:#B392F0;">spec:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">tls:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">-</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">hosts:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">-</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">foo.example.com</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">secretName:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">foo-example-com-tls</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">rules:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">-</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">host:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">foo.example.com</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">http:</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#B392F0;">paths:</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#B392F0;">-</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">path:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#B392F0;">pathType:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Prefix</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#B392F0;">backend:</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#B392F0;">service:</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#B392F0;">name:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">backend-service</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#B392F0;">port:</span></span>
<span class="line"><span style="color:#E1E4E8;">              </span><span style="color:#B392F0;">name:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">http</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">kind:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Ingress</span></span>
<span class="line"><span style="color:#6F42C1;">apiVersion:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">networking.k8s.io/v1</span></span>
<span class="line"><span style="color:#6F42C1;">metadata:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">name:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">foo-example-com</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">annotations:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">cert-manager.io/cluster-issuer:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;example-acme&quot;</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 增加该行即可自动生成证书</span></span>
<span class="line"><span style="color:#6F42C1;">spec:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">tls:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">-</span><span style="color:#24292E;"> </span><span style="color:#032F62;">hosts:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">-</span><span style="color:#24292E;"> </span><span style="color:#032F62;">foo.example.com</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">secretName:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">foo-example-com-tls</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">rules:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">-</span><span style="color:#24292E;"> </span><span style="color:#032F62;">host:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">foo.example.com</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">http:</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#6F42C1;">paths:</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#6F42C1;">-</span><span style="color:#24292E;"> </span><span style="color:#032F62;">path:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6F42C1;">pathType:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Prefix</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6F42C1;">backend:</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#6F42C1;">service:</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#6F42C1;">name:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">backend-service</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#6F42C1;">port:</span></span>
<span class="line"><span style="color:#24292E;">              </span><span style="color:#6F42C1;">name:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">http</span></span></code></pre></div>`,23),o=[e];function c(t,r,y,E,i,F){return a(),n("div",null,o)}const h=s(l,[["render",c]]);export{d as __pageData,h as default};
