import{_ as s,o as a,c as n,R as l}from"./chunks/framework.zUbWieqp.js";const b=JSON.parse('{"title":"1. 什么是Dashboard","description":"","frontmatter":{},"headers":[],"relativePath":"guide/container/k8s/Ingress/ingress_nginx/6-dashboard.md","filePath":"guide/container/k8s/Ingress/ingress_nginx/6-dashboard.md","lastUpdated":1720533756000}'),p={name:"guide/container/k8s/Ingress/ingress_nginx/6-dashboard.md"},o=l(`<h1 id="_1-什么是dashboard" tabindex="-1">1. 什么是Dashboard <a class="header-anchor" href="#_1-什么是dashboard" aria-label="Permalink to &quot;1. 什么是Dashboard&quot;">​</a></h1><p>Dashboard是kubernetes的Web GUI,可用于在kubernetes集群上部署容器化应用，应用排障、管理集群本身及其附加的资源等。它常被管理员用于集群及应用速览，创建或修改单个资源(deployment、jobs和daemonset)以及扩展deployment、启动滚动更新、重启pod或使用部署向导一个新应用等；</p><p>这里需注意一点是Dashboard依赖于Metrics-Server完成指标数据的采集和可视化；</p><p>官方地址: <a href="https://kubernetes.io/docs/tasks/access-application-cluster/web-ui-dashboard/" target="_blank" rel="noreferrer">https://kubernetes.io/docs/tasks/access-application-cluster/web-ui-dashboard/</a></p><p>GitHub地址: <a href="https://github.com/kubernetes/dashboard" target="_blank" rel="noreferrer">https://github.com/kubernetes/dashboard</a></p><h2 id="_1-1-下载yaml" tabindex="-1">1.1 下载yaml <a class="header-anchor" href="#_1-1-下载yaml" aria-label="Permalink to &quot;1.1 下载yaml&quot;">​</a></h2><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">wget</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">https://raw.githubusercontent.com/kubernetes/dashboard/v2.6.1/aio/deploy/recommended.yaml</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">wget</span><span style="color:#24292E;"> </span><span style="color:#032F62;">https://raw.githubusercontent.com/kubernetes/dashboard/v2.6.1/aio/deploy/recommended.yaml</span></span></code></pre></div><h2 id="_1-2-安装" tabindex="-1">1.2 安装 <a class="header-anchor" href="#_1-2-安装" aria-label="Permalink to &quot;1.2 安装&quot;">​</a></h2><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">[root@kube-master dashboard]# kubectl apply -f recommended.yaml</span></span>
<span class="line"><span style="color:#B392F0;">namespace/kubernetes-dashboard</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">created</span></span>
<span class="line"><span style="color:#B392F0;">serviceaccount/kubernetes-dashboard</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">created</span></span>
<span class="line"><span style="color:#B392F0;">service/kubernetes-dashboard</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">created</span></span>
<span class="line"><span style="color:#B392F0;">secret/kubernetes-dashboard-certs</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">created</span></span>
<span class="line"><span style="color:#B392F0;">secret/kubernetes-dashboard-csrf</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">created</span></span>
<span class="line"><span style="color:#B392F0;">secret/kubernetes-dashboard-key-holder</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">created</span></span>
<span class="line"><span style="color:#B392F0;">configmap/kubernetes-dashboard-settings</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">created</span></span>
<span class="line"><span style="color:#B392F0;">role.rbac.authorization.k8s.io/kubernetes-dashboard</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">created</span></span>
<span class="line"><span style="color:#B392F0;">clusterrole.rbac.authorization.k8s.io/kubernetes-dashboard</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">created</span></span>
<span class="line"><span style="color:#B392F0;">rolebinding.rbac.authorization.k8s.io/kubernetes-dashboard</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">created</span></span>
<span class="line"><span style="color:#B392F0;">clusterrolebinding.rbac.authorization.k8s.io/kubernetes-dashboard</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">created</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">[root@kube-master dashboard]# kubectl apply -f recommended.yaml</span></span>
<span class="line"><span style="color:#6F42C1;">namespace/kubernetes-dashboard</span><span style="color:#24292E;"> </span><span style="color:#032F62;">created</span></span>
<span class="line"><span style="color:#6F42C1;">serviceaccount/kubernetes-dashboard</span><span style="color:#24292E;"> </span><span style="color:#032F62;">created</span></span>
<span class="line"><span style="color:#6F42C1;">service/kubernetes-dashboard</span><span style="color:#24292E;"> </span><span style="color:#032F62;">created</span></span>
<span class="line"><span style="color:#6F42C1;">secret/kubernetes-dashboard-certs</span><span style="color:#24292E;"> </span><span style="color:#032F62;">created</span></span>
<span class="line"><span style="color:#6F42C1;">secret/kubernetes-dashboard-csrf</span><span style="color:#24292E;"> </span><span style="color:#032F62;">created</span></span>
<span class="line"><span style="color:#6F42C1;">secret/kubernetes-dashboard-key-holder</span><span style="color:#24292E;"> </span><span style="color:#032F62;">created</span></span>
<span class="line"><span style="color:#6F42C1;">configmap/kubernetes-dashboard-settings</span><span style="color:#24292E;"> </span><span style="color:#032F62;">created</span></span>
<span class="line"><span style="color:#6F42C1;">role.rbac.authorization.k8s.io/kubernetes-dashboard</span><span style="color:#24292E;"> </span><span style="color:#032F62;">created</span></span>
<span class="line"><span style="color:#6F42C1;">clusterrole.rbac.authorization.k8s.io/kubernetes-dashboard</span><span style="color:#24292E;"> </span><span style="color:#032F62;">created</span></span>
<span class="line"><span style="color:#6F42C1;">rolebinding.rbac.authorization.k8s.io/kubernetes-dashboard</span><span style="color:#24292E;"> </span><span style="color:#032F62;">created</span></span>
<span class="line"><span style="color:#6F42C1;">clusterrolebinding.rbac.authorization.k8s.io/kubernetes-dashboard</span><span style="color:#24292E;"> </span><span style="color:#032F62;">created</span></span></code></pre></div><ul><li>查看</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">[root@kube-master dashboard]# kubectl get pods,service  -n kubernetes-dashboard</span></span>
<span class="line"><span style="color:#B392F0;">NAME</span><span style="color:#E1E4E8;">                                             </span><span style="color:#9ECBFF;">READY</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">STATUS</span><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">RESTARTS</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">AGE</span></span>
<span class="line"><span style="color:#B392F0;">pod/dashboard-metrics-scraper-7c857855d9-h46gm</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">1</span><span style="color:#9ECBFF;">/1</span><span style="color:#E1E4E8;">     </span><span style="color:#9ECBFF;">Running</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">          </span><span style="color:#79B8FF;">2</span><span style="color:#9ECBFF;">m20s</span></span>
<span class="line"><span style="color:#B392F0;">pod/kubernetes-dashboard-6b79449649-pcphx</span><span style="color:#E1E4E8;">        </span><span style="color:#79B8FF;">1</span><span style="color:#9ECBFF;">/1</span><span style="color:#E1E4E8;">     </span><span style="color:#9ECBFF;">Running</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">          </span><span style="color:#79B8FF;">2</span><span style="color:#9ECBFF;">m20s</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">NAME</span><span style="color:#E1E4E8;">                                </span><span style="color:#9ECBFF;">TYPE</span><span style="color:#E1E4E8;">        </span><span style="color:#9ECBFF;">CLUSTER-IP</span><span style="color:#E1E4E8;">        </span><span style="color:#9ECBFF;">EXTERNAL-IP</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">PORT</span><span style="color:#E1E4E8;">(</span><span style="color:#B392F0;">S</span><span style="color:#E1E4E8;">)    </span><span style="color:#9ECBFF;">AGE</span></span>
<span class="line"><span style="color:#B392F0;">service/dashboard-metrics-scraper</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">ClusterIP</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">192.168</span><span style="color:#9ECBFF;">.159.205</span><span style="color:#E1E4E8;">   </span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">non</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;">        </span><span style="color:#79B8FF;">8000</span><span style="color:#9ECBFF;">/TCP</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">2</span><span style="color:#9ECBFF;">m20s</span></span>
<span class="line"><span style="color:#B392F0;">service/kubernetes-dashboard</span><span style="color:#E1E4E8;">        </span><span style="color:#9ECBFF;">ClusterIP</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">192.168</span><span style="color:#9ECBFF;">.11.25</span><span style="color:#E1E4E8;">     </span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">non</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;">        </span><span style="color:#79B8FF;">443</span><span style="color:#9ECBFF;">/TCP</span><span style="color:#E1E4E8;">    </span><span style="color:#79B8FF;">2</span><span style="color:#9ECBFF;">m20s</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">[root@kube-master dashboard]# kubectl get pods,service  -n kubernetes-dashboard</span></span>
<span class="line"><span style="color:#6F42C1;">NAME</span><span style="color:#24292E;">                                             </span><span style="color:#032F62;">READY</span><span style="color:#24292E;">   </span><span style="color:#032F62;">STATUS</span><span style="color:#24292E;">    </span><span style="color:#032F62;">RESTARTS</span><span style="color:#24292E;">   </span><span style="color:#032F62;">AGE</span></span>
<span class="line"><span style="color:#6F42C1;">pod/dashboard-metrics-scraper-7c857855d9-h46gm</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">1</span><span style="color:#032F62;">/1</span><span style="color:#24292E;">     </span><span style="color:#032F62;">Running</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">          </span><span style="color:#005CC5;">2</span><span style="color:#032F62;">m20s</span></span>
<span class="line"><span style="color:#6F42C1;">pod/kubernetes-dashboard-6b79449649-pcphx</span><span style="color:#24292E;">        </span><span style="color:#005CC5;">1</span><span style="color:#032F62;">/1</span><span style="color:#24292E;">     </span><span style="color:#032F62;">Running</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">          </span><span style="color:#005CC5;">2</span><span style="color:#032F62;">m20s</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">NAME</span><span style="color:#24292E;">                                </span><span style="color:#032F62;">TYPE</span><span style="color:#24292E;">        </span><span style="color:#032F62;">CLUSTER-IP</span><span style="color:#24292E;">        </span><span style="color:#032F62;">EXTERNAL-IP</span><span style="color:#24292E;">   </span><span style="color:#032F62;">PORT</span><span style="color:#24292E;">(</span><span style="color:#6F42C1;">S</span><span style="color:#24292E;">)    </span><span style="color:#032F62;">AGE</span></span>
<span class="line"><span style="color:#6F42C1;">service/dashboard-metrics-scraper</span><span style="color:#24292E;">   </span><span style="color:#032F62;">ClusterIP</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">192.168</span><span style="color:#032F62;">.159.205</span><span style="color:#24292E;">   </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">non</span><span style="color:#24292E;">e</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;">        </span><span style="color:#005CC5;">8000</span><span style="color:#032F62;">/TCP</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">2</span><span style="color:#032F62;">m20s</span></span>
<span class="line"><span style="color:#6F42C1;">service/kubernetes-dashboard</span><span style="color:#24292E;">        </span><span style="color:#032F62;">ClusterIP</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">192.168</span><span style="color:#032F62;">.11.25</span><span style="color:#24292E;">     </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">non</span><span style="color:#24292E;">e</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;">        </span><span style="color:#005CC5;">443</span><span style="color:#032F62;">/TCP</span><span style="color:#24292E;">    </span><span style="color:#005CC5;">2</span><span style="color:#032F62;">m20s</span></span></code></pre></div><blockquote><p>修改svc ClusterIP 为NodePort</p></blockquote><h2 id="_1-3-创建授权" tabindex="-1">1.3 创建授权 <a class="header-anchor" href="#_1-3-创建授权" aria-label="Permalink to &quot;1.3 创建授权&quot;">​</a></h2><p>安装好了，没有账号还是无法访问的。所以要授权；</p><h3 id="基于token认证与授权" tabindex="-1">基于token认证与授权 <a class="header-anchor" href="#基于token认证与授权" aria-label="Permalink to &quot;基于token认证与授权&quot;">​</a></h3><h4 id="创建serviceaccount" tabindex="-1">创建ServiceAccount <a class="header-anchor" href="#创建serviceaccount" aria-label="Permalink to &quot;创建ServiceAccount&quot;">​</a></h4><p>创建ServiceAccount然后通过dashboard的token进行验证</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">create</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">serviceaccount</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">admin-user</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-n</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">kubernetes-dashboard</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">create</span><span style="color:#24292E;"> </span><span style="color:#032F62;">serviceaccount</span><span style="color:#24292E;"> </span><span style="color:#032F62;">admin-user</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-n</span><span style="color:#24292E;"> </span><span style="color:#032F62;">kubernetes-dashboard</span></span></code></pre></div><h4 id="绑定用户" tabindex="-1">绑定用户 <a class="header-anchor" href="#绑定用户" aria-label="Permalink to &quot;绑定用户&quot;">​</a></h4><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">#将sa账户通过clusterrolebinding绑定到cluster-admin集群角色上，以便拥有集群管理员权限</span></span>
<span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">create</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">clusterrolebinding</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">admin-user</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--clusterrole=cluster-admin</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--serviceaccount=kubernetes-dashboard:admin-user</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">#将sa账户通过clusterrolebinding绑定到cluster-admin集群角色上，以便拥有集群管理员权限</span></span>
<span class="line"><span style="color:#6F42C1;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">create</span><span style="color:#24292E;"> </span><span style="color:#032F62;">clusterrolebinding</span><span style="color:#24292E;"> </span><span style="color:#032F62;">admin-user</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--clusterrole=cluster-admin</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--serviceaccount=kubernetes-dashboard:admin-user</span></span></code></pre></div><h4 id="查看secret" tabindex="-1">查看secret <a class="header-anchor" href="#查看secret" aria-label="Permalink to &quot;查看secret&quot;">​</a></h4><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">[root@kube-master dashboard]# kubectl describe sa admin-user -n kubernetes-dashboard</span></span>
<span class="line"><span style="color:#B392F0;">Name:</span><span style="color:#E1E4E8;">                </span><span style="color:#9ECBFF;">admin-user</span></span>
<span class="line"><span style="color:#B392F0;">Namespace:</span><span style="color:#E1E4E8;">           </span><span style="color:#9ECBFF;">kubernetes-dashboard</span></span>
<span class="line"><span style="color:#B392F0;">Labels:</span><span style="color:#E1E4E8;">              </span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">non</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span></span>
<span class="line"><span style="color:#B392F0;">Annotations:</span><span style="color:#E1E4E8;">         </span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">non</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span></span>
<span class="line"><span style="color:#B392F0;">Image</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pull</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">secrets:</span><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">non</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span></span>
<span class="line"><span style="color:#B392F0;">Mountable</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">secrets:</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">admin-user-token-tjbgz</span></span>
<span class="line"><span style="color:#B392F0;">Tokens:</span><span style="color:#E1E4E8;">              </span><span style="color:#9ECBFF;">admin-user-token-tjbgz</span></span>
<span class="line"><span style="color:#B392F0;">Events:</span><span style="color:#E1E4E8;">              </span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">non</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">[root@kube-master dashboard]# kubectl describe sa admin-user -n kubernetes-dashboard</span></span>
<span class="line"><span style="color:#6F42C1;">Name:</span><span style="color:#24292E;">                </span><span style="color:#032F62;">admin-user</span></span>
<span class="line"><span style="color:#6F42C1;">Namespace:</span><span style="color:#24292E;">           </span><span style="color:#032F62;">kubernetes-dashboard</span></span>
<span class="line"><span style="color:#6F42C1;">Labels:</span><span style="color:#24292E;">              </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">non</span><span style="color:#24292E;">e</span><span style="color:#D73A49;">&gt;</span></span>
<span class="line"><span style="color:#6F42C1;">Annotations:</span><span style="color:#24292E;">         </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">non</span><span style="color:#24292E;">e</span><span style="color:#D73A49;">&gt;</span></span>
<span class="line"><span style="color:#6F42C1;">Image</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pull</span><span style="color:#24292E;"> </span><span style="color:#032F62;">secrets:</span><span style="color:#24292E;">  </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">non</span><span style="color:#24292E;">e</span><span style="color:#D73A49;">&gt;</span></span>
<span class="line"><span style="color:#6F42C1;">Mountable</span><span style="color:#24292E;"> </span><span style="color:#032F62;">secrets:</span><span style="color:#24292E;">   </span><span style="color:#032F62;">admin-user-token-tjbgz</span></span>
<span class="line"><span style="color:#6F42C1;">Tokens:</span><span style="color:#24292E;">              </span><span style="color:#032F62;">admin-user-token-tjbgz</span></span>
<span class="line"><span style="color:#6F42C1;">Events:</span><span style="color:#24292E;">              </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">non</span><span style="color:#24292E;">e</span><span style="color:#D73A49;">&gt;</span></span></code></pre></div><ul><li>通过文件创建权限</li></ul><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">[</span><span style="color:#9ECBFF;">root@kube-master dashboard</span><span style="color:#E1E4E8;">]# </span><span style="color:#9ECBFF;">cat 2.admin.yaml</span></span>
<span class="line"><span style="color:#85E89D;">apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">v1</span></span>
<span class="line"><span style="color:#85E89D;">kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">ServiceAccount</span></span>
<span class="line"><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">admin-user</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">namespace</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">kubernetes-dashboard</span></span>
<span class="line"><span style="color:#B392F0;">---</span></span>
<span class="line"><span style="color:#85E89D;">apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">rbac.authorization.k8s.io/v1</span></span>
<span class="line"><span style="color:#85E89D;">kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">ClusterRoleBinding</span></span>
<span class="line"><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">admin-user</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">annotations</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">rbac.authorization.kubernetes.io/autoupdate</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;true&quot;</span></span>
<span class="line"><span style="color:#85E89D;">roleRef</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">apiGroup</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">rbac.authorization.k8s.io</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">ClusterRole</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">cluster-admin</span></span>
<span class="line"><span style="color:#85E89D;">subjects</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">- </span><span style="color:#85E89D;">kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">ServiceAccount</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">admin-user</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">namespace</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">kubernetes-dashboard</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">[</span><span style="color:#032F62;">root@kube-master dashboard</span><span style="color:#24292E;">]# </span><span style="color:#032F62;">cat 2.admin.yaml</span></span>
<span class="line"><span style="color:#22863A;">apiVersion</span><span style="color:#24292E;">: </span><span style="color:#032F62;">v1</span></span>
<span class="line"><span style="color:#22863A;">kind</span><span style="color:#24292E;">: </span><span style="color:#032F62;">ServiceAccount</span></span>
<span class="line"><span style="color:#22863A;">metadata</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">admin-user</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">namespace</span><span style="color:#24292E;">: </span><span style="color:#032F62;">kubernetes-dashboard</span></span>
<span class="line"><span style="color:#6F42C1;">---</span></span>
<span class="line"><span style="color:#22863A;">apiVersion</span><span style="color:#24292E;">: </span><span style="color:#032F62;">rbac.authorization.k8s.io/v1</span></span>
<span class="line"><span style="color:#22863A;">kind</span><span style="color:#24292E;">: </span><span style="color:#032F62;">ClusterRoleBinding</span></span>
<span class="line"><span style="color:#22863A;">metadata</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">admin-user</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">annotations</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">rbac.authorization.kubernetes.io/autoupdate</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;true&quot;</span></span>
<span class="line"><span style="color:#22863A;">roleRef</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">apiGroup</span><span style="color:#24292E;">: </span><span style="color:#032F62;">rbac.authorization.k8s.io</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">kind</span><span style="color:#24292E;">: </span><span style="color:#032F62;">ClusterRole</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">cluster-admin</span></span>
<span class="line"><span style="color:#22863A;">subjects</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">- </span><span style="color:#22863A;">kind</span><span style="color:#24292E;">: </span><span style="color:#032F62;">ServiceAccount</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">admin-user</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">namespace</span><span style="color:#24292E;">: </span><span style="color:#032F62;">kubernetes-dashboard</span></span></code></pre></div><ul><li>访问</li></ul><p><img src="https://nnaigos.oss-cn-hangzhou.aliyuncs.com/imgs/202406042200143.png" alt="image-20240604220002323"></p><ul><li>获取token</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">[root@kube-master dashboard]# kubectl describe sa admin-user -n kubernetes-dashboard</span></span>
<span class="line"><span style="color:#B392F0;">Name:</span><span style="color:#E1E4E8;">                </span><span style="color:#9ECBFF;">admin-user</span></span>
<span class="line"><span style="color:#B392F0;">Namespace:</span><span style="color:#E1E4E8;">           </span><span style="color:#9ECBFF;">kubernetes-dashboard</span></span>
<span class="line"><span style="color:#B392F0;">Labels:</span><span style="color:#E1E4E8;">              </span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">non</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span></span>
<span class="line"><span style="color:#B392F0;">Annotations:</span><span style="color:#E1E4E8;">         </span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">non</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span></span>
<span class="line"><span style="color:#B392F0;">Image</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pull</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">secrets:</span><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">non</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span></span>
<span class="line"><span style="color:#B392F0;">Mountable</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">secrets:</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">admin-user-token-tjbgz</span></span>
<span class="line"><span style="color:#B392F0;">Tokens:</span><span style="color:#E1E4E8;">              </span><span style="color:#9ECBFF;">admin-user-token-tjbgz</span></span>
<span class="line"><span style="color:#B392F0;">Events:</span><span style="color:#E1E4E8;">              </span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">non</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">[root@kube-master dashboard]# kubectl describe secrets admin-user-token-tjbgz  -n kubernetes-dashboard</span></span>
<span class="line"><span style="color:#B392F0;">Name:</span><span style="color:#E1E4E8;">         </span><span style="color:#9ECBFF;">admin-user-token-tjbgz</span></span>
<span class="line"><span style="color:#B392F0;">Namespace:</span><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">kubernetes-dashboard</span></span>
<span class="line"><span style="color:#B392F0;">Labels:</span><span style="color:#E1E4E8;">       </span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">non</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span></span>
<span class="line"><span style="color:#B392F0;">Annotations:</span><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">kubernetes.io/service-account.name:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">admin-user</span></span>
<span class="line"><span style="color:#E1E4E8;">              </span><span style="color:#B392F0;">kubernetes.io/service-account.uid:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">cbf8157c-92da-45f3-89f1-23f37c3671df</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">Type:</span><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">kubernetes.io/service-account-token</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">Data</span></span>
<span class="line"><span style="color:#E1E4E8;">====</span></span>
<span class="line"><span style="color:#B392F0;">ca.crt:</span><span style="color:#E1E4E8;">     </span><span style="color:#79B8FF;">1099</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">bytes</span></span>
<span class="line"><span style="color:#B392F0;">namespace:</span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">20</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">bytes</span></span>
<span class="line"><span style="color:#B392F0;">token:</span><span style="color:#E1E4E8;">      </span><span style="color:#9ECBFF;">eyJhbGciOiJSUzI1NiIsImtpZCI6IjhPUFdTTy0teFQ3QTVYSnI3Mk1rTU1fUFYyc1oxQUpWMkZ3cER2WkE3NmcifQ.eyJpc3MiOiJrdWJlcm5ldGVzL3NlcnZpY2VhY2NvdW50Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9uYW1lc3BhY2UiOiJrdWJlcm5ldGVzLWRhc2hib2FyZCIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VjcmV0Lm5hbWUiOiJhZG1pbi11c2VyLXRva2VuLXRqYmd6Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9zZXJ2aWNlLWFjY291bnQubmFtZSI6ImFkbWluLXVzZXIiLCJrdWJlcm5ldGVzLmlvL3NlcnZpY2VhY2NvdW50L3NlcnZpY2UtYWNjb3VudC51aWQiOiJjYmY4MTU3Yy05MmRhLTQ1ZjMtODlmMS0yM2YzN2MzNjcxZGYiLCJzdWIiOiJzeXN0ZW06c2VydmljZWFjY291bnQ6a3ViZXJuZXRlcy1kYXNoYm9hcmQ6YWRtaW4tdXNlciJ9.epaYpJP9qYH_MWqa2nMDgF-TwwaL_EGA9iUBNkiGyy8sstsvC94eRGuNP2891Ht0hYBwYDe7keub03Tn6IwjzBPo2H3GQyYdIDBxJOjcBb4YbZorHm35mFlWzNsSYpBQ80PKlsqFOpmyRZcswr0TjjttKg5NsPgq-jTDJ76j57CTR12Yi29pxAh5AzEmBE0GCarvQDNIhUrHeVv6t21AWQgckBamvOYyxdPoVrPw3I2154e36z4Q2wW7XLSrIrTjFKTc0QwvleR5o3hAs_zq-GC09rZKqPKfRNURxlxkPkefvjtGLph8lcQz3uJqHaQ5cSF0QglNDfZFZ9AOXRr8Ow</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">[root@kube-master dashboard]# kubectl describe sa admin-user -n kubernetes-dashboard</span></span>
<span class="line"><span style="color:#6F42C1;">Name:</span><span style="color:#24292E;">                </span><span style="color:#032F62;">admin-user</span></span>
<span class="line"><span style="color:#6F42C1;">Namespace:</span><span style="color:#24292E;">           </span><span style="color:#032F62;">kubernetes-dashboard</span></span>
<span class="line"><span style="color:#6F42C1;">Labels:</span><span style="color:#24292E;">              </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">non</span><span style="color:#24292E;">e</span><span style="color:#D73A49;">&gt;</span></span>
<span class="line"><span style="color:#6F42C1;">Annotations:</span><span style="color:#24292E;">         </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">non</span><span style="color:#24292E;">e</span><span style="color:#D73A49;">&gt;</span></span>
<span class="line"><span style="color:#6F42C1;">Image</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pull</span><span style="color:#24292E;"> </span><span style="color:#032F62;">secrets:</span><span style="color:#24292E;">  </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">non</span><span style="color:#24292E;">e</span><span style="color:#D73A49;">&gt;</span></span>
<span class="line"><span style="color:#6F42C1;">Mountable</span><span style="color:#24292E;"> </span><span style="color:#032F62;">secrets:</span><span style="color:#24292E;">   </span><span style="color:#032F62;">admin-user-token-tjbgz</span></span>
<span class="line"><span style="color:#6F42C1;">Tokens:</span><span style="color:#24292E;">              </span><span style="color:#032F62;">admin-user-token-tjbgz</span></span>
<span class="line"><span style="color:#6F42C1;">Events:</span><span style="color:#24292E;">              </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">non</span><span style="color:#24292E;">e</span><span style="color:#D73A49;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">[root@kube-master dashboard]# kubectl describe secrets admin-user-token-tjbgz  -n kubernetes-dashboard</span></span>
<span class="line"><span style="color:#6F42C1;">Name:</span><span style="color:#24292E;">         </span><span style="color:#032F62;">admin-user-token-tjbgz</span></span>
<span class="line"><span style="color:#6F42C1;">Namespace:</span><span style="color:#24292E;">    </span><span style="color:#032F62;">kubernetes-dashboard</span></span>
<span class="line"><span style="color:#6F42C1;">Labels:</span><span style="color:#24292E;">       </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">non</span><span style="color:#24292E;">e</span><span style="color:#D73A49;">&gt;</span></span>
<span class="line"><span style="color:#6F42C1;">Annotations:</span><span style="color:#24292E;">  </span><span style="color:#032F62;">kubernetes.io/service-account.name:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">admin-user</span></span>
<span class="line"><span style="color:#24292E;">              </span><span style="color:#6F42C1;">kubernetes.io/service-account.uid:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">cbf8157c-92da-45f3-89f1-23f37c3671df</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">Type:</span><span style="color:#24292E;">  </span><span style="color:#032F62;">kubernetes.io/service-account-token</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">Data</span></span>
<span class="line"><span style="color:#24292E;">====</span></span>
<span class="line"><span style="color:#6F42C1;">ca.crt:</span><span style="color:#24292E;">     </span><span style="color:#005CC5;">1099</span><span style="color:#24292E;"> </span><span style="color:#032F62;">bytes</span></span>
<span class="line"><span style="color:#6F42C1;">namespace:</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">20</span><span style="color:#24292E;"> </span><span style="color:#032F62;">bytes</span></span>
<span class="line"><span style="color:#6F42C1;">token:</span><span style="color:#24292E;">      </span><span style="color:#032F62;">eyJhbGciOiJSUzI1NiIsImtpZCI6IjhPUFdTTy0teFQ3QTVYSnI3Mk1rTU1fUFYyc1oxQUpWMkZ3cER2WkE3NmcifQ.eyJpc3MiOiJrdWJlcm5ldGVzL3NlcnZpY2VhY2NvdW50Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9uYW1lc3BhY2UiOiJrdWJlcm5ldGVzLWRhc2hib2FyZCIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VjcmV0Lm5hbWUiOiJhZG1pbi11c2VyLXRva2VuLXRqYmd6Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9zZXJ2aWNlLWFjY291bnQubmFtZSI6ImFkbWluLXVzZXIiLCJrdWJlcm5ldGVzLmlvL3NlcnZpY2VhY2NvdW50L3NlcnZpY2UtYWNjb3VudC51aWQiOiJjYmY4MTU3Yy05MmRhLTQ1ZjMtODlmMS0yM2YzN2MzNjcxZGYiLCJzdWIiOiJzeXN0ZW06c2VydmljZWFjY291bnQ6a3ViZXJuZXRlcy1kYXNoYm9hcmQ6YWRtaW4tdXNlciJ9.epaYpJP9qYH_MWqa2nMDgF-TwwaL_EGA9iUBNkiGyy8sstsvC94eRGuNP2891Ht0hYBwYDe7keub03Tn6IwjzBPo2H3GQyYdIDBxJOjcBb4YbZorHm35mFlWzNsSYpBQ80PKlsqFOpmyRZcswr0TjjttKg5NsPgq-jTDJ76j57CTR12Yi29pxAh5AzEmBE0GCarvQDNIhUrHeVv6t21AWQgckBamvOYyxdPoVrPw3I2154e36z4Q2wW7XLSrIrTjFKTc0QwvleR5o3hAs_zq-GC09rZKqPKfRNURxlxkPkefvjtGLph8lcQz3uJqHaQ5cSF0QglNDfZFZ9AOXRr8Ow</span></span></code></pre></div><p><img src="https://nnaigos.oss-cn-hangzhou.aliyuncs.com/imgs/202406042202079.png" alt="image-20240604220203835"></p><p><img src="https://nnaigos.oss-cn-hangzhou.aliyuncs.com/imgs/202406042203447.png" alt="image-20240604220315427"></p><h1 id="_2-基于ingress发布dashboard" tabindex="-1">2. 基于ingress发布dashboard <a class="header-anchor" href="#_2-基于ingress发布dashboard" aria-label="Permalink to &quot;2. 基于ingress发布dashboard&quot;">​</a></h1><h2 id="_2-1-查看dashboard默认的访问方式" tabindex="-1">2.1 查看dashboard默认的访问方式 <a class="header-anchor" href="#_2-1-查看dashboard默认的访问方式" aria-label="Permalink to &quot;2.1 查看dashboard默认的访问方式&quot;">​</a></h2><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">[root@kube-master dashboard]# kubectl get pods,svc -n kubernetes-dashboard</span></span>
<span class="line"><span style="color:#B392F0;">NAME</span><span style="color:#E1E4E8;">                                             </span><span style="color:#9ECBFF;">READY</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">STATUS</span><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">RESTARTS</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">AGE</span></span>
<span class="line"><span style="color:#B392F0;">pod/dashboard-metrics-scraper-7c857855d9-h46gm</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">1</span><span style="color:#9ECBFF;">/1</span><span style="color:#E1E4E8;">     </span><span style="color:#9ECBFF;">Running</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">          </span><span style="color:#79B8FF;">26</span><span style="color:#9ECBFF;">m</span></span>
<span class="line"><span style="color:#B392F0;">pod/kubernetes-dashboard-6b79449649-pcphx</span><span style="color:#E1E4E8;">        </span><span style="color:#79B8FF;">1</span><span style="color:#9ECBFF;">/1</span><span style="color:#E1E4E8;">     </span><span style="color:#9ECBFF;">Running</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">          </span><span style="color:#79B8FF;">26</span><span style="color:#9ECBFF;">m</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">NAME</span><span style="color:#E1E4E8;">                                </span><span style="color:#9ECBFF;">TYPE</span><span style="color:#E1E4E8;">        </span><span style="color:#9ECBFF;">CLUSTER-IP</span><span style="color:#E1E4E8;">        </span><span style="color:#9ECBFF;">EXTERNAL-IP</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">PORT</span><span style="color:#E1E4E8;">(</span><span style="color:#B392F0;">S</span><span style="color:#E1E4E8;">)    </span><span style="color:#9ECBFF;">AGE</span></span>
<span class="line"><span style="color:#B392F0;">service/dashboard-metrics-scraper</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">ClusterIP</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">192.168</span><span style="color:#9ECBFF;">.159.205</span><span style="color:#E1E4E8;">   </span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">non</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;">        </span><span style="color:#79B8FF;">8000</span><span style="color:#9ECBFF;">/TCP</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">26</span><span style="color:#9ECBFF;">m</span></span>
<span class="line"><span style="color:#B392F0;">service/kubernetes-dashboard</span><span style="color:#E1E4E8;">        </span><span style="color:#9ECBFF;">ClusterIP</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">192.168</span><span style="color:#9ECBFF;">.11.25</span><span style="color:#E1E4E8;">     </span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">non</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;">        </span><span style="color:#79B8FF;">443</span><span style="color:#9ECBFF;">/TCP</span><span style="color:#E1E4E8;">    </span><span style="color:#79B8FF;">26</span><span style="color:#9ECBFF;">m</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">[root@kube-master dashboard]# kubectl get pods,svc -n kubernetes-dashboard</span></span>
<span class="line"><span style="color:#6F42C1;">NAME</span><span style="color:#24292E;">                                             </span><span style="color:#032F62;">READY</span><span style="color:#24292E;">   </span><span style="color:#032F62;">STATUS</span><span style="color:#24292E;">    </span><span style="color:#032F62;">RESTARTS</span><span style="color:#24292E;">   </span><span style="color:#032F62;">AGE</span></span>
<span class="line"><span style="color:#6F42C1;">pod/dashboard-metrics-scraper-7c857855d9-h46gm</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">1</span><span style="color:#032F62;">/1</span><span style="color:#24292E;">     </span><span style="color:#032F62;">Running</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">          </span><span style="color:#005CC5;">26</span><span style="color:#032F62;">m</span></span>
<span class="line"><span style="color:#6F42C1;">pod/kubernetes-dashboard-6b79449649-pcphx</span><span style="color:#24292E;">        </span><span style="color:#005CC5;">1</span><span style="color:#032F62;">/1</span><span style="color:#24292E;">     </span><span style="color:#032F62;">Running</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">          </span><span style="color:#005CC5;">26</span><span style="color:#032F62;">m</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">NAME</span><span style="color:#24292E;">                                </span><span style="color:#032F62;">TYPE</span><span style="color:#24292E;">        </span><span style="color:#032F62;">CLUSTER-IP</span><span style="color:#24292E;">        </span><span style="color:#032F62;">EXTERNAL-IP</span><span style="color:#24292E;">   </span><span style="color:#032F62;">PORT</span><span style="color:#24292E;">(</span><span style="color:#6F42C1;">S</span><span style="color:#24292E;">)    </span><span style="color:#032F62;">AGE</span></span>
<span class="line"><span style="color:#6F42C1;">service/dashboard-metrics-scraper</span><span style="color:#24292E;">   </span><span style="color:#032F62;">ClusterIP</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">192.168</span><span style="color:#032F62;">.159.205</span><span style="color:#24292E;">   </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">non</span><span style="color:#24292E;">e</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;">        </span><span style="color:#005CC5;">8000</span><span style="color:#032F62;">/TCP</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">26</span><span style="color:#032F62;">m</span></span>
<span class="line"><span style="color:#6F42C1;">service/kubernetes-dashboard</span><span style="color:#24292E;">        </span><span style="color:#032F62;">ClusterIP</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">192.168</span><span style="color:#032F62;">.11.25</span><span style="color:#24292E;">     </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">non</span><span style="color:#24292E;">e</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;">        </span><span style="color:#005CC5;">443</span><span style="color:#032F62;">/TCP</span><span style="color:#24292E;">    </span><span style="color:#005CC5;">26</span><span style="color:#032F62;">m</span></span></code></pre></div><h2 id="_2-2-检查ingress-controller" tabindex="-1">2.2 检查Ingress Controller <a class="header-anchor" href="#_2-2-检查ingress-controller" aria-label="Permalink to &quot;2.2 检查Ingress Controller&quot;">​</a></h2><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">[root@kube-master dashboard]# kubectl get pods -n ingress-nginx</span></span>
<span class="line"><span style="color:#B392F0;">NAME</span><span style="color:#E1E4E8;">                                   </span><span style="color:#9ECBFF;">READY</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">STATUS</span><span style="color:#E1E4E8;">      </span><span style="color:#9ECBFF;">RESTARTS</span><span style="color:#E1E4E8;">       </span><span style="color:#9ECBFF;">AGE</span></span>
<span class="line"><span style="color:#B392F0;">ingress-nginx-admission-create-s2zhk</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">0</span><span style="color:#9ECBFF;">/1</span><span style="color:#E1E4E8;">     </span><span style="color:#9ECBFF;">Completed</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">              </span><span style="color:#79B8FF;">9</span><span style="color:#9ECBFF;">d</span></span>
<span class="line"><span style="color:#B392F0;">ingress-nginx-admission-patch-dq5hw</span><span style="color:#E1E4E8;">    </span><span style="color:#79B8FF;">0</span><span style="color:#9ECBFF;">/1</span><span style="color:#E1E4E8;">     </span><span style="color:#9ECBFF;">Completed</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">              </span><span style="color:#79B8FF;">9</span><span style="color:#9ECBFF;">d</span></span>
<span class="line"><span style="color:#B392F0;">ingress-nginx-controller-nx4lb</span><span style="color:#E1E4E8;">         </span><span style="color:#79B8FF;">1</span><span style="color:#9ECBFF;">/1</span><span style="color:#E1E4E8;">     </span><span style="color:#9ECBFF;">Running</span><span style="color:#E1E4E8;">     </span><span style="color:#79B8FF;">13</span><span style="color:#E1E4E8;"> (77m </span><span style="color:#9ECBFF;">ago</span><span style="color:#E1E4E8;">)   9d</span></span>
<span class="line"><span style="color:#B392F0;">ingress-nginx-controller-wtftx</span><span style="color:#E1E4E8;">         </span><span style="color:#79B8FF;">1</span><span style="color:#9ECBFF;">/1</span><span style="color:#E1E4E8;">     </span><span style="color:#9ECBFF;">Running</span><span style="color:#E1E4E8;">     </span><span style="color:#79B8FF;">12</span><span style="color:#E1E4E8;"> (77m </span><span style="color:#9ECBFF;">ago</span><span style="color:#E1E4E8;">)   9d</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">[root@kube-master dashboard]# kubectl get pods -n ingress-nginx</span></span>
<span class="line"><span style="color:#6F42C1;">NAME</span><span style="color:#24292E;">                                   </span><span style="color:#032F62;">READY</span><span style="color:#24292E;">   </span><span style="color:#032F62;">STATUS</span><span style="color:#24292E;">      </span><span style="color:#032F62;">RESTARTS</span><span style="color:#24292E;">       </span><span style="color:#032F62;">AGE</span></span>
<span class="line"><span style="color:#6F42C1;">ingress-nginx-admission-create-s2zhk</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">0</span><span style="color:#032F62;">/1</span><span style="color:#24292E;">     </span><span style="color:#032F62;">Completed</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">              </span><span style="color:#005CC5;">9</span><span style="color:#032F62;">d</span></span>
<span class="line"><span style="color:#6F42C1;">ingress-nginx-admission-patch-dq5hw</span><span style="color:#24292E;">    </span><span style="color:#005CC5;">0</span><span style="color:#032F62;">/1</span><span style="color:#24292E;">     </span><span style="color:#032F62;">Completed</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">              </span><span style="color:#005CC5;">9</span><span style="color:#032F62;">d</span></span>
<span class="line"><span style="color:#6F42C1;">ingress-nginx-controller-nx4lb</span><span style="color:#24292E;">         </span><span style="color:#005CC5;">1</span><span style="color:#032F62;">/1</span><span style="color:#24292E;">     </span><span style="color:#032F62;">Running</span><span style="color:#24292E;">     </span><span style="color:#005CC5;">13</span><span style="color:#24292E;"> (77m </span><span style="color:#032F62;">ago</span><span style="color:#24292E;">)   9d</span></span>
<span class="line"><span style="color:#6F42C1;">ingress-nginx-controller-wtftx</span><span style="color:#24292E;">         </span><span style="color:#005CC5;">1</span><span style="color:#032F62;">/1</span><span style="color:#24292E;">     </span><span style="color:#032F62;">Running</span><span style="color:#24292E;">     </span><span style="color:#005CC5;">12</span><span style="color:#24292E;"> (77m </span><span style="color:#032F62;">ago</span><span style="color:#24292E;">)   9d</span></span></code></pre></div><h2 id="_2-3-创建自签证书" tabindex="-1">2.3 创建自签证书 <a class="header-anchor" href="#_2-3-创建自签证书" aria-label="Permalink to &quot;2.3 创建自签证书&quot;">​</a></h2><blockquote><p>自签发证书。当然生产环境中理应当使用机构签发的证书</p></blockquote><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">[root@kube-master dashboard]# openssl req -x509 -nodes -days 365 -newkey rsa:2048 -keyout kube-dashboard.key -out kube-dashboard.crt -subj </span><span style="color:#9ECBFF;">&quot;/CN=dashboard.kube.com/O=dashboard.ikubernetes.net&quot;</span></span>
<span class="line"><span style="color:#B392F0;">Generating</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">a</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2048</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">bit</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">RSA</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">private</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">key</span></span>
<span class="line"><span style="color:#79B8FF;">................................................................................................................................</span><span style="color:#E1E4E8;">+++</span></span>
<span class="line"><span style="color:#79B8FF;">.........</span><span style="color:#E1E4E8;">+++</span></span>
<span class="line"><span style="color:#B392F0;">writing</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">new</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">private</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">key</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">to</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;kube-dashboard.key&#39;</span></span>
<span class="line"><span style="color:#B392F0;">-----</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">[root@kube-master dashboard]# openssl req -x509 -nodes -days 365 -newkey rsa:2048 -keyout kube-dashboard.key -out kube-dashboard.crt -subj </span><span style="color:#032F62;">&quot;/CN=dashboard.kube.com/O=dashboard.ikubernetes.net&quot;</span></span>
<span class="line"><span style="color:#6F42C1;">Generating</span><span style="color:#24292E;"> </span><span style="color:#032F62;">a</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2048</span><span style="color:#24292E;"> </span><span style="color:#032F62;">bit</span><span style="color:#24292E;"> </span><span style="color:#032F62;">RSA</span><span style="color:#24292E;"> </span><span style="color:#032F62;">private</span><span style="color:#24292E;"> </span><span style="color:#032F62;">key</span></span>
<span class="line"><span style="color:#005CC5;">................................................................................................................................</span><span style="color:#24292E;">+++</span></span>
<span class="line"><span style="color:#005CC5;">.........</span><span style="color:#24292E;">+++</span></span>
<span class="line"><span style="color:#6F42C1;">writing</span><span style="color:#24292E;"> </span><span style="color:#032F62;">new</span><span style="color:#24292E;"> </span><span style="color:#032F62;">private</span><span style="color:#24292E;"> </span><span style="color:#032F62;">key</span><span style="color:#24292E;"> </span><span style="color:#032F62;">to</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;kube-dashboard.key&#39;</span></span>
<span class="line"><span style="color:#6F42C1;">-----</span></span></code></pre></div><ul><li>创建tls类型的Secret为ingress提供配置</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">#创建</span></span>
<span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">create</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">secret</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">tls</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">dashboard-tls</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--key</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">kube-dashboard.key</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--cert</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">kube-dashboard.crt</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-n</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">kubernetes-dashboard</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#查看</span></span>
<span class="line"><span style="color:#E1E4E8;">[root@kube-master dashboard]# kubectl get secrets -n kubernetes-dashboard</span></span>
<span class="line"><span style="color:#B392F0;">NAME</span><span style="color:#E1E4E8;">                               </span><span style="color:#9ECBFF;">TYPE</span><span style="color:#E1E4E8;">                                  </span><span style="color:#9ECBFF;">DATA</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">AGE</span></span>
<span class="line"><span style="color:#B392F0;">dashboard-tls</span><span style="color:#E1E4E8;">                      </span><span style="color:#9ECBFF;">kubernetes.io/tls</span><span style="color:#E1E4E8;">                     </span><span style="color:#79B8FF;">2</span><span style="color:#E1E4E8;">      </span><span style="color:#79B8FF;">32</span><span style="color:#9ECBFF;">s</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">#创建</span></span>
<span class="line"><span style="color:#6F42C1;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">create</span><span style="color:#24292E;"> </span><span style="color:#032F62;">secret</span><span style="color:#24292E;"> </span><span style="color:#032F62;">tls</span><span style="color:#24292E;"> </span><span style="color:#032F62;">dashboard-tls</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--key</span><span style="color:#24292E;"> </span><span style="color:#032F62;">kube-dashboard.key</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--cert</span><span style="color:#24292E;"> </span><span style="color:#032F62;">kube-dashboard.crt</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-n</span><span style="color:#24292E;"> </span><span style="color:#032F62;">kubernetes-dashboard</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#查看</span></span>
<span class="line"><span style="color:#24292E;">[root@kube-master dashboard]# kubectl get secrets -n kubernetes-dashboard</span></span>
<span class="line"><span style="color:#6F42C1;">NAME</span><span style="color:#24292E;">                               </span><span style="color:#032F62;">TYPE</span><span style="color:#24292E;">                                  </span><span style="color:#032F62;">DATA</span><span style="color:#24292E;">   </span><span style="color:#032F62;">AGE</span></span>
<span class="line"><span style="color:#6F42C1;">dashboard-tls</span><span style="color:#24292E;">                      </span><span style="color:#032F62;">kubernetes.io/tls</span><span style="color:#24292E;">                     </span><span style="color:#005CC5;">2</span><span style="color:#24292E;">      </span><span style="color:#005CC5;">32</span><span style="color:#032F62;">s</span></span></code></pre></div><h2 id="_2-4-配置ingress规则" tabindex="-1">2.4 配置Ingress规则 <a class="header-anchor" href="#_2-4-配置ingress规则" aria-label="Permalink to &quot;2.4 配置Ingress规则&quot;">​</a></h2><p>Nginx Ingress Controller默认使用HTTP协议转发请求到后端业务容器。当您的业务容器为HTTPS协议时，可以通过使用注解nginx.ingress.kubernetes.io/backend-protocol: &quot;HTTPS&quot;来使得Nginx Ingress Controller使用HTTP协议转发请求到后端业务容器</p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">[</span><span style="color:#9ECBFF;">root@kube-master dashboard</span><span style="color:#E1E4E8;">]# </span><span style="color:#9ECBFF;">cat 3.ingress-dashboard.yaml</span></span>
<span class="line"><span style="color:#6A737D;"># cat ingress-dashboard.yaml</span></span>
<span class="line"><span style="color:#85E89D;">apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">networking.k8s.io/v1</span></span>
<span class="line"><span style="color:#85E89D;">kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Ingress</span></span>
<span class="line"><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">dashboard-ingress</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">namespace</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">kubernetes-dashboard</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">annotations</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">nginx.ingress.kubernetes.io/backend-protocol</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;HTTPS&quot;</span><span style="color:#E1E4E8;">   </span><span style="color:#6A737D;">#注意这里：必须指定后端服务为HTTPS服务。</span></span>
<span class="line"><span style="color:#85E89D;">spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">ingressClassName</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;nginx&quot;</span><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;">#控制器的类型为nginx</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">tls</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  - </span><span style="color:#85E89D;">hosts</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    - </span><span style="color:#9ECBFF;">dashboard.ikubernetes.net</span><span style="color:#E1E4E8;">   </span><span style="color:#6A737D;">#主机名</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">secretName</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">dashboard-tls</span><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;">#这里引用创建的secrets</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">rules</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  - </span><span style="color:#85E89D;">host</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">dashboard.ikubernetes.net</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">http</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">paths</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      - </span><span style="color:#85E89D;">path</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">/</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">pathType</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Prefix</span><span style="color:#E1E4E8;">   </span><span style="color:#6A737D;">#起始与根都进行代理。</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">backend</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#85E89D;">service</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">kubernetes-dashboard</span><span style="color:#E1E4E8;">   </span><span style="color:#6A737D;">#service名称</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#85E89D;">port</span><span style="color:#E1E4E8;">:     </span><span style="color:#6A737D;">#后端端口</span></span>
<span class="line"><span style="color:#E1E4E8;">              </span><span style="color:#85E89D;">number</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">443</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">[</span><span style="color:#032F62;">root@kube-master dashboard</span><span style="color:#24292E;">]# </span><span style="color:#032F62;">cat 3.ingress-dashboard.yaml</span></span>
<span class="line"><span style="color:#6A737D;"># cat ingress-dashboard.yaml</span></span>
<span class="line"><span style="color:#22863A;">apiVersion</span><span style="color:#24292E;">: </span><span style="color:#032F62;">networking.k8s.io/v1</span></span>
<span class="line"><span style="color:#22863A;">kind</span><span style="color:#24292E;">: </span><span style="color:#032F62;">Ingress</span></span>
<span class="line"><span style="color:#22863A;">metadata</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">dashboard-ingress</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">namespace</span><span style="color:#24292E;">: </span><span style="color:#032F62;">kubernetes-dashboard</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">annotations</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">nginx.ingress.kubernetes.io/backend-protocol</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;HTTPS&quot;</span><span style="color:#24292E;">   </span><span style="color:#6A737D;">#注意这里：必须指定后端服务为HTTPS服务。</span></span>
<span class="line"><span style="color:#22863A;">spec</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">ingressClassName</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;nginx&quot;</span><span style="color:#24292E;">  </span><span style="color:#6A737D;">#控制器的类型为nginx</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">tls</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  - </span><span style="color:#22863A;">hosts</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    - </span><span style="color:#032F62;">dashboard.ikubernetes.net</span><span style="color:#24292E;">   </span><span style="color:#6A737D;">#主机名</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">secretName</span><span style="color:#24292E;">: </span><span style="color:#032F62;">dashboard-tls</span><span style="color:#24292E;">  </span><span style="color:#6A737D;">#这里引用创建的secrets</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">rules</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  - </span><span style="color:#22863A;">host</span><span style="color:#24292E;">: </span><span style="color:#032F62;">dashboard.ikubernetes.net</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">http</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">paths</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      - </span><span style="color:#22863A;">path</span><span style="color:#24292E;">: </span><span style="color:#032F62;">/</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">pathType</span><span style="color:#24292E;">: </span><span style="color:#032F62;">Prefix</span><span style="color:#24292E;">   </span><span style="color:#6A737D;">#起始与根都进行代理。</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">backend</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#22863A;">service</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">kubernetes-dashboard</span><span style="color:#24292E;">   </span><span style="color:#6A737D;">#service名称</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#22863A;">port</span><span style="color:#24292E;">:     </span><span style="color:#6A737D;">#后端端口</span></span>
<span class="line"><span style="color:#24292E;">              </span><span style="color:#22863A;">number</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">443</span></span></code></pre></div><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">加载配置文件</span><span style="color:#E1E4E8;">	  </span></span>
<span class="line"><span style="color:#6A737D;"># kubectl apply -f 3.ingress-dashboard.yaml </span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#检查Ingress配置文件</span></span>
<span class="line"><span style="color:#E1E4E8;">[root@kube-master dashboard]# kubectl describe ingress -n kubernetes-dashboard</span></span>
<span class="line"><span style="color:#B392F0;">Name:</span><span style="color:#E1E4E8;">             </span><span style="color:#9ECBFF;">dashboard-ingress</span></span>
<span class="line"><span style="color:#B392F0;">Namespace:</span><span style="color:#E1E4E8;">        </span><span style="color:#9ECBFF;">kubernetes-dashboard</span></span>
<span class="line"><span style="color:#B392F0;">Address:</span><span style="color:#E1E4E8;">          </span><span style="color:#79B8FF;">10.103</span><span style="color:#9ECBFF;">.236.70</span></span>
<span class="line"><span style="color:#B392F0;">Default</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">backend:</span><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">default-http-backend:80</span><span style="color:#E1E4E8;"> (&lt;error: </span><span style="color:#9ECBFF;">endpoints</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;default-http-backend&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">not</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">foun</span><span style="color:#E1E4E8;">d</span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#B392F0;">TLS:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">dashboard-tls</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">terminates</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">dashboard.ikubernetes.net</span></span>
<span class="line"><span style="color:#B392F0;">Rules:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">Host</span><span style="color:#E1E4E8;">                       </span><span style="color:#9ECBFF;">Path</span><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">Backends</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">----</span><span style="color:#E1E4E8;">                       </span><span style="color:#79B8FF;">----</span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">--------</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">dashboard.ikubernetes.net</span></span>
<span class="line"><span style="color:#E1E4E8;">                             </span><span style="color:#B392F0;">/</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">kubernetes-dashboard:443</span><span style="color:#E1E4E8;"> (172.30.0.163:8443)</span></span>
<span class="line"><span style="color:#B392F0;">Annotations:</span><span style="color:#E1E4E8;">                 </span><span style="color:#9ECBFF;">nginx.ingress.kubernetes.io/backend-protocol:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">HTTPS</span></span>
<span class="line"><span style="color:#B392F0;">Events:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">Type</span><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">Reason</span><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">Age</span><span style="color:#E1E4E8;">                    </span><span style="color:#9ECBFF;">From</span><span style="color:#E1E4E8;">                      </span><span style="color:#9ECBFF;">Message</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">----</span><span style="color:#E1E4E8;">    </span><span style="color:#79B8FF;">------</span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">----</span><span style="color:#E1E4E8;">                   </span><span style="color:#79B8FF;">----</span><span style="color:#E1E4E8;">                      </span><span style="color:#79B8FF;">-------</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">Normal</span><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">Sync</span><span style="color:#E1E4E8;">    </span><span style="color:#79B8FF;">7</span><span style="color:#9ECBFF;">m43s</span><span style="color:#E1E4E8;"> (x2 </span><span style="color:#9ECBFF;">over</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">7</span><span style="color:#9ECBFF;">m51s</span><span style="color:#E1E4E8;">)  nginx-ingress-controller  Scheduled </span><span style="color:#F97583;">for</span><span style="color:#E1E4E8;"> sync</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">Normal</span><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">Sync</span><span style="color:#E1E4E8;">    </span><span style="color:#79B8FF;">7</span><span style="color:#9ECBFF;">m42s</span><span style="color:#E1E4E8;"> (x2 </span><span style="color:#9ECBFF;">over</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">7</span><span style="color:#9ECBFF;">m51s</span><span style="color:#E1E4E8;">)  nginx-ingress-controller  Scheduled </span><span style="color:#F97583;">for</span><span style="color:#E1E4E8;"> sync</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">加载配置文件</span><span style="color:#24292E;">	  </span></span>
<span class="line"><span style="color:#6A737D;"># kubectl apply -f 3.ingress-dashboard.yaml </span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#检查Ingress配置文件</span></span>
<span class="line"><span style="color:#24292E;">[root@kube-master dashboard]# kubectl describe ingress -n kubernetes-dashboard</span></span>
<span class="line"><span style="color:#6F42C1;">Name:</span><span style="color:#24292E;">             </span><span style="color:#032F62;">dashboard-ingress</span></span>
<span class="line"><span style="color:#6F42C1;">Namespace:</span><span style="color:#24292E;">        </span><span style="color:#032F62;">kubernetes-dashboard</span></span>
<span class="line"><span style="color:#6F42C1;">Address:</span><span style="color:#24292E;">          </span><span style="color:#005CC5;">10.103</span><span style="color:#032F62;">.236.70</span></span>
<span class="line"><span style="color:#6F42C1;">Default</span><span style="color:#24292E;"> </span><span style="color:#032F62;">backend:</span><span style="color:#24292E;">  </span><span style="color:#032F62;">default-http-backend:80</span><span style="color:#24292E;"> (&lt;error: </span><span style="color:#032F62;">endpoints</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;default-http-backend&quot;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">not</span><span style="color:#24292E;"> </span><span style="color:#032F62;">foun</span><span style="color:#24292E;">d</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#6F42C1;">TLS:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">dashboard-tls</span><span style="color:#24292E;"> </span><span style="color:#032F62;">terminates</span><span style="color:#24292E;"> </span><span style="color:#032F62;">dashboard.ikubernetes.net</span></span>
<span class="line"><span style="color:#6F42C1;">Rules:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">Host</span><span style="color:#24292E;">                       </span><span style="color:#032F62;">Path</span><span style="color:#24292E;">  </span><span style="color:#032F62;">Backends</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">----</span><span style="color:#24292E;">                       </span><span style="color:#005CC5;">----</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">--------</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">dashboard.ikubernetes.net</span></span>
<span class="line"><span style="color:#24292E;">                             </span><span style="color:#6F42C1;">/</span><span style="color:#24292E;">   </span><span style="color:#032F62;">kubernetes-dashboard:443</span><span style="color:#24292E;"> (172.30.0.163:8443)</span></span>
<span class="line"><span style="color:#6F42C1;">Annotations:</span><span style="color:#24292E;">                 </span><span style="color:#032F62;">nginx.ingress.kubernetes.io/backend-protocol:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">HTTPS</span></span>
<span class="line"><span style="color:#6F42C1;">Events:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">Type</span><span style="color:#24292E;">    </span><span style="color:#032F62;">Reason</span><span style="color:#24292E;">  </span><span style="color:#032F62;">Age</span><span style="color:#24292E;">                    </span><span style="color:#032F62;">From</span><span style="color:#24292E;">                      </span><span style="color:#032F62;">Message</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">----</span><span style="color:#24292E;">    </span><span style="color:#005CC5;">------</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">----</span><span style="color:#24292E;">                   </span><span style="color:#005CC5;">----</span><span style="color:#24292E;">                      </span><span style="color:#005CC5;">-------</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">Normal</span><span style="color:#24292E;">  </span><span style="color:#032F62;">Sync</span><span style="color:#24292E;">    </span><span style="color:#005CC5;">7</span><span style="color:#032F62;">m43s</span><span style="color:#24292E;"> (x2 </span><span style="color:#032F62;">over</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">7</span><span style="color:#032F62;">m51s</span><span style="color:#24292E;">)  nginx-ingress-controller  Scheduled </span><span style="color:#D73A49;">for</span><span style="color:#24292E;"> sync</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">Normal</span><span style="color:#24292E;">  </span><span style="color:#032F62;">Sync</span><span style="color:#24292E;">    </span><span style="color:#005CC5;">7</span><span style="color:#032F62;">m42s</span><span style="color:#24292E;"> (x2 </span><span style="color:#032F62;">over</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">7</span><span style="color:#032F62;">m51s</span><span style="color:#24292E;">)  nginx-ingress-controller  Scheduled </span><span style="color:#D73A49;">for</span><span style="color:#24292E;"> sync</span></span></code></pre></div><ul><li>访问</li></ul><p><img src="https://nnaigos.oss-cn-hangzhou.aliyuncs.com/imgs/202406042228598.png" alt="image-20240604222810826"></p>`,46),e=[o];function t(c,r,y,E,i,F){return a(),n("div",null,e)}const u=s(p,[["render",t]]);export{b as __pageData,u as default};
