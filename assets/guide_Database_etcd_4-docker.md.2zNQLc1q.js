import{_ as s,o as n,c as a,R as l}from"./chunks/framework.zUbWieqp.js";const h=JSON.parse('{"title":"1.docker单机部署ETCD","description":"","frontmatter":{},"headers":[],"relativePath":"guide/Database/etcd/4-docker.md","filePath":"guide/Database/etcd/4-docker.md","lastUpdated":1703141608000}'),p={name:"guide/Database/etcd/4-docker.md"},e=l(`<h1 id="_1-docker单机部署etcd" tabindex="-1">1.docker单机部署ETCD <a class="header-anchor" href="#_1-docker单机部署etcd" aria-label="Permalink to &quot;1.docker单机部署ETCD&quot;">​</a></h1><div class="language-undefined vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">undefined</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">docker pull quay.io/coreos/etcd</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">docker pull quay.io/coreos/etcd</span></span></code></pre></div><ul><li>设置环境变量和监听地址</li></ul><div class="language-undefined vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">undefined</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">-e ETCDCTL_API=3</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">-p 2379:2379 -p 2380:2380</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">-e ETCDCTL_API=3</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">-p 2379:2379 -p 2380:2380</span></span></code></pre></div><ul><li>运行</li></ul><div class="language-cpp vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">cpp</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">docker run </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">d </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">it </span><span style="color:#F97583;">--</span><span style="color:#E1E4E8;">rm </span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#F97583;">--</span><span style="color:#E1E4E8;">name etcd_test </span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">e ETCDCTL_API</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">3</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">p </span><span style="color:#79B8FF;">2379</span><span style="color:#E1E4E8;">:</span><span style="color:#79B8FF;">2379</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">p </span><span style="color:#79B8FF;">2380</span><span style="color:#E1E4E8;">:</span><span style="color:#79B8FF;">2380</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#E1E4E8;">quay.io</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">coreos</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">etcd </span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#E1E4E8;">etcd </span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#F97583;">--</span><span style="color:#E1E4E8;">advertise</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">client</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">urls http:</span><span style="color:#6A737D;">//0.0.0.0:2379 </span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#6A737D;">--listen-client-urls http://0.0.0.0:2379</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">docker run </span><span style="color:#D73A49;">-</span><span style="color:#24292E;">d </span><span style="color:#D73A49;">-</span><span style="color:#24292E;">it </span><span style="color:#D73A49;">--</span><span style="color:#24292E;">rm </span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#D73A49;">--</span><span style="color:#24292E;">name etcd_test </span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#D73A49;">-</span><span style="color:#24292E;">e ETCDCTL_API</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">3</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#D73A49;">-</span><span style="color:#24292E;">p </span><span style="color:#005CC5;">2379</span><span style="color:#24292E;">:</span><span style="color:#005CC5;">2379</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#D73A49;">-</span><span style="color:#24292E;">p </span><span style="color:#005CC5;">2380</span><span style="color:#24292E;">:</span><span style="color:#005CC5;">2380</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#24292E;">quay.io</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">coreos</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">etcd </span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#24292E;">etcd </span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#D73A49;">--</span><span style="color:#24292E;">advertise</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">client</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">urls http:</span><span style="color:#6A737D;">//0.0.0.0:2379 </span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#6A737D;">--listen-client-urls http://0.0.0.0:2379</span></span></code></pre></div><p>容器退出自动删除rm</p><div class="language-cpp vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">cpp</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">[root@bogon </span><span style="color:#FFAB70;">etcd</span><span style="color:#E1E4E8;">]# docker run -d -it --rm --name etcd_test -e ETCDCTL_API=3 -p 2379:2379 -p 2380:2380 quay.io/coreos/etcd:v3.3.9 etcd --advertise-client-urls http://0.0.0.0:2379 --listen-client-urls http://0.0.0.0:2379</span></span>
<span class="line"><span style="color:#E1E4E8;">ca444c094b6bf00b47726b0dee600620d3962cd0fb78d224db9fae12da94dc13</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">[root@bogon </span><span style="color:#E36209;">etcd</span><span style="color:#24292E;">]# docker run -d -it --rm --name etcd_test -e ETCDCTL_API=3 -p 2379:2379 -p 2380:2380 quay.io/coreos/etcd:v3.3.9 etcd --advertise-client-urls http://0.0.0.0:2379 --listen-client-urls http://0.0.0.0:2379</span></span>
<span class="line"><span style="color:#24292E;">ca444c094b6bf00b47726b0dee600620d3962cd0fb78d224db9fae12da94dc13</span></span></code></pre></div><p>容器停止总是重启</p><div class="language-cpp vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">cpp</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">[root@ansible</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">server </span><span style="color:#F97583;">~</span><span style="color:#E1E4E8;">]# docker run -d -it --restart=always --name etcd1 -e ETCDCTL_API=3 -p 2379:2379 -p 2380:2380 quay.io/coreos/etcd:v3.3.9 etcd --advertise-client-urls http://0.0.0.0:2379 --listen-client-urls http://0.0.0.0:2379</span></span>
<span class="line"><span style="color:#E1E4E8;">199b521dcdd1a742701350c8024dd76c179db2ded0d05a40dd44adfd14f2fb27</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">[root@ansible</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">server </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# docker run -d -it --restart=always --name etcd1 -e ETCDCTL_API=3 -p 2379:2379 -p 2380:2380 quay.io/coreos/etcd:v3.3.9 etcd --advertise-client-urls http://0.0.0.0:2379 --listen-client-urls http://0.0.0.0:2379</span></span>
<span class="line"><span style="color:#24292E;">199b521dcdd1a742701350c8024dd76c179db2ded0d05a40dd44adfd14f2fb27</span></span></code></pre></div><p>其他状态：</p><ul><li>no，默认策略，在容器退出时不重启容器</li><li>on-failure，在容器非正常退出时（退出状态非0），才会重启容器</li><li>on-failure:3，在容器非正常退出时重启容器，最多重启3次</li><li>always，在容器退出时总是重启容器</li><li>unless-stopped，在容器退出时总是重启容器，但是不考虑在Docker守护进程启动时就已经停止了的容器</li></ul><h1 id="_2-docker集群部署" tabindex="-1">2.docker集群部署 <a class="header-anchor" href="#_2-docker集群部署" aria-label="Permalink to &quot;2.docker集群部署&quot;">​</a></h1><h2 id="_1-etcd集群" tabindex="-1">1.etcd集群 <a class="header-anchor" href="#_1-etcd集群" aria-label="Permalink to &quot;1.etcd集群&quot;">​</a></h2><div class="language-undefined vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">undefined</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">docker pull busybox</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">docker pull busybox</span></span></code></pre></div><h2 id="_2-network" tabindex="-1">2.network <a class="header-anchor" href="#_2-network" aria-label="Permalink to &quot;2.network&quot;">​</a></h2><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">#docker network create etcd_cluster</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">docker</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">network</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">create</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--subnet</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">172.16</span><span style="color:#9ECBFF;">.3.0/16</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">etcd_cluster</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">docker</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">network</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">inspect</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">etcd_cluster</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#docker network rm etcd_cluster</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">docker</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">run</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-itd</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--rm</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--network</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">etcd_cluster</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--ip</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">172.16</span><span style="color:#9ECBFF;">.3.0</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--name</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">test</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">busybox</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">#docker network create etcd_cluster</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">docker</span><span style="color:#24292E;"> </span><span style="color:#032F62;">network</span><span style="color:#24292E;"> </span><span style="color:#032F62;">create</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--subnet</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">172.16</span><span style="color:#032F62;">.3.0/16</span><span style="color:#24292E;"> </span><span style="color:#032F62;">etcd_cluster</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">docker</span><span style="color:#24292E;"> </span><span style="color:#032F62;">network</span><span style="color:#24292E;"> </span><span style="color:#032F62;">inspect</span><span style="color:#24292E;"> </span><span style="color:#032F62;">etcd_cluster</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#docker network rm etcd_cluster</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">docker</span><span style="color:#24292E;"> </span><span style="color:#032F62;">run</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-itd</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--rm</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--network</span><span style="color:#24292E;"> </span><span style="color:#032F62;">etcd_cluster</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--ip</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">172.16</span><span style="color:#032F62;">.3.0</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--name</span><span style="color:#24292E;"> </span><span style="color:#032F62;">test</span><span style="color:#24292E;"> </span><span style="color:#032F62;">busybox</span></span></code></pre></div><h2 id="_3-cluster" tabindex="-1">3.cluster <a class="header-anchor" href="#_3-cluster" aria-label="Permalink to &quot;3.cluster&quot;">​</a></h2><div class="language-csharp vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">csharp</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;"># etcd1</span></span>
<span class="line"><span style="color:#E1E4E8;">docker run </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">itd </span><span style="color:#F97583;">--</span><span style="color:#E1E4E8;">restart</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">always \\</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">--</span><span style="color:#E1E4E8;">network etcd_cluster \\</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">--</span><span style="color:#E1E4E8;">ip </span><span style="color:#FDAEB7;font-style:italic;">172.16.3.31</span><span style="color:#E1E4E8;"> \\</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">--</span><span style="color:#E1E4E8;">hostname etcd1 \\</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">--</span><span style="color:#E1E4E8;">name etcd1 \\</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">e ETCDCTL_API</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">3</span><span style="color:#E1E4E8;"> \\</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">p </span><span style="color:#79B8FF;">12379</span><span style="color:#F97583;">:</span><span style="color:#79B8FF;">2379</span><span style="color:#E1E4E8;"> \\</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">p </span><span style="color:#79B8FF;">12380</span><span style="color:#F97583;">:</span><span style="color:#79B8FF;">2380</span><span style="color:#E1E4E8;"> \\</span></span>
<span class="line"><span style="color:#E1E4E8;">    quay.io</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">coreos</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">etcd</span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;">v3.</span><span style="color:#79B8FF;">3.9</span><span style="color:#E1E4E8;"> \\</span></span>
<span class="line"><span style="color:#E1E4E8;">    etcd </span><span style="color:#F97583;">--</span><span style="color:#E1E4E8;">name etcd1 \\</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">--</span><span style="color:#E1E4E8;">initial</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">advertise</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">peer</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">urls http</span><span style="color:#F97583;">:</span><span style="color:#6A737D;">//172.16.3.31:2380 \\</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">--</span><span style="color:#E1E4E8;">listen</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">peer</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">urls http</span><span style="color:#F97583;">:</span><span style="color:#6A737D;">//172.16.3.31:2380 \\</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">--</span><span style="color:#E1E4E8;">listen</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">client</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">urls http</span><span style="color:#F97583;">:</span><span style="color:#6A737D;">//172.16.3.31:2379,http://127.0.0.1:2379 \\</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">--</span><span style="color:#E1E4E8;">advertise</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">client</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">urls http</span><span style="color:#F97583;">:</span><span style="color:#6A737D;">//172.16.3.31:2379 \\</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">--</span><span style="color:#E1E4E8;">initial</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">cluster</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">token etcd</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">cluster</span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;"> \\</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">--</span><span style="color:#E1E4E8;">initial</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">cluster etcd1</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">http</span><span style="color:#F97583;">:</span><span style="color:#6A737D;">//172.16.3.31:2380,etcd2=http://172.16.3.32:2380,etcd3=http://172.16.3.33:2380 \\</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">--</span><span style="color:#E1E4E8;">initial</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">cluster</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">state </span><span style="color:#F97583;">new</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span></span>
<span class="line"><span style="color:#E1E4E8;">  # etcd2  </span></span>
<span class="line"><span style="color:#E1E4E8;">    docker run -itd --restart=always \\</span></span>
<span class="line"><span style="color:#E1E4E8;">    --network etcd_cluster \\</span></span>
<span class="line"><span style="color:#E1E4E8;">    --ip 172.16.3.32 \\</span></span>
<span class="line"><span style="color:#E1E4E8;">    --hostname etcd2 \\</span></span>
<span class="line"><span style="color:#E1E4E8;">    --name etcd2 \\</span></span>
<span class="line"><span style="color:#E1E4E8;">    -e ETCDCTL_API=3 \\</span></span>
<span class="line"><span style="color:#E1E4E8;">    -p 22379:2379 \\</span></span>
<span class="line"><span style="color:#E1E4E8;">    -p 22380:2380 \\</span></span>
<span class="line"><span style="color:#E1E4E8;">    quay.io/coreos/etcd:v3.3.9 \\</span></span>
<span class="line"><span style="color:#E1E4E8;">    etcd --name etcd2 \\</span></span>
<span class="line"><span style="color:#E1E4E8;">    --initial-advertise-peer-urls http:</span><span style="color:#6A737D;">//172.16.3.32:2380 \\</span></span>
<span class="line"><span style="color:#E1E4E8;">    --listen-peer-urls http:</span><span style="color:#6A737D;">//172.16.3.32:2380 \\</span></span>
<span class="line"><span style="color:#E1E4E8;">    --listen-client-urls http:</span><span style="color:#6A737D;">//172.16.3.32:2379,http://127.0.0.1:2379 \\</span></span>
<span class="line"><span style="color:#E1E4E8;">    --advertise-client-urls http:</span><span style="color:#6A737D;">//172.16.3.32:2379 \\</span></span>
<span class="line"><span style="color:#E1E4E8;">    --initial-cluster-token etcd-cluster-1 \\</span></span>
<span class="line"><span style="color:#E1E4E8;">    --initial-cluster etcd1=http:</span><span style="color:#6A737D;">//172.16.3.31:2380,etcd2=http://172.16.3.32:2380,etcd3=http://172.16.3.33:2380 \\</span></span>
<span class="line"><span style="color:#E1E4E8;">    --initial-cluster-state new</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span></span>
<span class="line"><span style="color:#E1E4E8;">  # etcd3</span></span>
<span class="line"><span style="color:#E1E4E8;">    docker run -itd --restart=always \\</span></span>
<span class="line"><span style="color:#E1E4E8;">    --network etcd_cluster \\</span></span>
<span class="line"><span style="color:#E1E4E8;">    --ip 172.16.3.33 \\</span></span>
<span class="line"><span style="color:#E1E4E8;">    --hostname etcd3 \\</span></span>
<span class="line"><span style="color:#E1E4E8;">    --name etcd3 \\</span></span>
<span class="line"><span style="color:#E1E4E8;">    -e ETCDCTL_API=3 \\</span></span>
<span class="line"><span style="color:#E1E4E8;">    -p 32379:2379 \\</span></span>
<span class="line"><span style="color:#E1E4E8;">    -p 32380:2380 \\</span></span>
<span class="line"><span style="color:#E1E4E8;">    quay.io/coreos/etcd:v3.3.9 \\</span></span>
<span class="line"><span style="color:#E1E4E8;">    etcd --name etcd3 \\</span></span>
<span class="line"><span style="color:#E1E4E8;">    --initial-advertise-peer-urls http:</span><span style="color:#6A737D;">//172.16.3.33:2380 \\</span></span>
<span class="line"><span style="color:#E1E4E8;">    --listen-peer-urls http:</span><span style="color:#6A737D;">//172.16.3.33:2380 \\</span></span>
<span class="line"><span style="color:#E1E4E8;">    --listen-client-urls http:</span><span style="color:#6A737D;">//172.16.3.33:2379,http://127.0.0.1:2379 \\</span></span>
<span class="line"><span style="color:#E1E4E8;">    --advertise-client-urls http:</span><span style="color:#6A737D;">//172.16.3.33:2379 \\</span></span>
<span class="line"><span style="color:#E1E4E8;">    --initial-cluster-token etcd-cluster-1 \\</span></span>
<span class="line"><span style="color:#E1E4E8;">    --initial-cluster etcd1=http:</span><span style="color:#6A737D;">//172.16.3.31:2380,etcd2=http://172.16.3.32:2380,etcd3=http://172.16.3.33:2380 \\</span></span>
<span class="line"><span style="color:#E1E4E8;">    --initial-cluster-state new</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span></span>
<span class="line"><span style="color:#E1E4E8;"> # client</span></span>
<span class="line"><span style="color:#E1E4E8;"> #进入容器 </span></span>
<span class="line"><span style="color:#E1E4E8;">docker exec -it etcd1 bin/sh</span></span>
<span class="line"><span style="color:#E1E4E8;">#客户端测试</span></span>
<span class="line"><span style="color:#E1E4E8;">etcdctl --write-out=table --endpoints=http:</span><span style="color:#6A737D;">//127.0.0.1:2379 member list</span></span>
<span class="line"><span style="color:#E1E4E8;">etcdctl --endpoints=http:</span><span style="color:#6A737D;">//127.0.0.1:2379 put foo bar</span></span>
<span class="line"><span style="color:#E1E4E8;">etcdctl --endpoints=http:</span><span style="color:#6A737D;">//127.0.0.1:2379 get foo</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">#测试结果如下</span></span>
<span class="line"><span style="color:#E1E4E8;">[root@bogon ~]# docker exec -it etcd1 bin/sh</span></span>
<span class="line"><span style="color:#E1E4E8;">/ # etcdctl --write-out=table --endpoints=http:</span><span style="color:#6A737D;">//127.0.0.1:2379 member list</span></span>
<span class="line"><span style="color:#E1E4E8;">+------------------+---------+-------+-------------------------+-------------------------+</span></span>
<span class="line"><span style="color:#E1E4E8;">|        ID        | STATUS  | NAME  |       PEER ADDRS        |      CLIENT ADDRS       |</span></span>
<span class="line"><span style="color:#E1E4E8;">+------------------+---------+-------+-------------------------+-------------------------+</span></span>
<span class="line"><span style="color:#E1E4E8;">|  c26d6ba798c079c | started | etcd3 | http:</span><span style="color:#6A737D;">//172.16.3.33:2380 | http://172.16.3.33:2379 |</span></span>
<span class="line"><span style="color:#E1E4E8;">| 4631df2115e1ef72 | started | etcd2 | http:</span><span style="color:#6A737D;">//172.16.3.32:2380 | http://172.16.3.32:2379 |</span></span>
<span class="line"><span style="color:#E1E4E8;">| a92fe5422902bc40 | started | etcd1 | http:</span><span style="color:#6A737D;">//172.16.3.31:2380 | http://172.16.3.31:2379 |</span></span>
<span class="line"><span style="color:#E1E4E8;">+------------------+---------+-------+-------------------------+-------------------------+</span></span>
<span class="line"><span style="color:#E1E4E8;">/ # etcdctl --endpoints=http:</span><span style="color:#6A737D;">//127.0.0.1:2379 put foo bar</span></span>
<span class="line"><span style="color:#E1E4E8;">OK</span></span>
<span class="line"><span style="color:#E1E4E8;">/ # etcdctl --endpoints=http:</span><span style="color:#6A737D;">//127.0.0.1:2379 get foo</span></span>
<span class="line"><span style="color:#E1E4E8;">foo</span></span>
<span class="line"><span style="color:#E1E4E8;">bar</span></span>
<span class="line"><span style="color:#E1E4E8;">#docker ps</span></span>
<span class="line"><span style="color:#E1E4E8;">[root@bogon docker]# docker ps</span></span>
<span class="line"><span style="color:#E1E4E8;">CONTAINER ID        IMAGE                        COMMAND                  CREATED             STATUS              PORTS                                              NAMES</span></span>
<span class="line"><span style="color:#E1E4E8;">5988c4443eb5        quay.io/coreos/etcd:v3.3.9   &quot;etcd --name etcd3...&quot;   37 seconds ago      Up 36 seconds       0.0.0.0:32379-&gt;2379/tcp, 0.0.0.0:32380-&gt;2380/tcp   etcd3</span></span>
<span class="line"><span style="color:#E1E4E8;">d4fdda6400cc        quay.io/coreos/etcd:v3.3.9   &quot;etcd --name etcd2...&quot;   44 seconds ago      Up 44 seconds       0.0.0.0:22379-&gt;2379/tcp, 0.0.0.0:22380-&gt;2380/tcp   etcd2</span></span>
<span class="line"><span style="color:#E1E4E8;">af86e5fd2ae5        quay.io/coreos/etcd:v3.3.9   &quot;etcd --name etcd1...&quot;   53 seconds ago      Up 52 seconds       0.0.0.0:2379-2380-&gt;2379-2380/tcp                   etcd1</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;"># etcd1</span></span>
<span class="line"><span style="color:#24292E;">docker run </span><span style="color:#D73A49;">-</span><span style="color:#24292E;">itd </span><span style="color:#D73A49;">--</span><span style="color:#24292E;">restart</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">always \\</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">--</span><span style="color:#24292E;">network etcd_cluster \\</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">--</span><span style="color:#24292E;">ip </span><span style="color:#B31D28;font-style:italic;">172.16.3.31</span><span style="color:#24292E;"> \\</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">--</span><span style="color:#24292E;">hostname etcd1 \\</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">--</span><span style="color:#24292E;">name etcd1 \\</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">-</span><span style="color:#24292E;">e ETCDCTL_API</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">3</span><span style="color:#24292E;"> \\</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">-</span><span style="color:#24292E;">p </span><span style="color:#005CC5;">12379</span><span style="color:#D73A49;">:</span><span style="color:#005CC5;">2379</span><span style="color:#24292E;"> \\</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">-</span><span style="color:#24292E;">p </span><span style="color:#005CC5;">12380</span><span style="color:#D73A49;">:</span><span style="color:#005CC5;">2380</span><span style="color:#24292E;"> \\</span></span>
<span class="line"><span style="color:#24292E;">    quay.io</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">coreos</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">etcd</span><span style="color:#D73A49;">:</span><span style="color:#24292E;">v3.</span><span style="color:#005CC5;">3.9</span><span style="color:#24292E;"> \\</span></span>
<span class="line"><span style="color:#24292E;">    etcd </span><span style="color:#D73A49;">--</span><span style="color:#24292E;">name etcd1 \\</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">--</span><span style="color:#24292E;">initial</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">advertise</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">peer</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">urls http</span><span style="color:#D73A49;">:</span><span style="color:#6A737D;">//172.16.3.31:2380 \\</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">--</span><span style="color:#24292E;">listen</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">peer</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">urls http</span><span style="color:#D73A49;">:</span><span style="color:#6A737D;">//172.16.3.31:2380 \\</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">--</span><span style="color:#24292E;">listen</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">client</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">urls http</span><span style="color:#D73A49;">:</span><span style="color:#6A737D;">//172.16.3.31:2379,http://127.0.0.1:2379 \\</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">--</span><span style="color:#24292E;">advertise</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">client</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">urls http</span><span style="color:#D73A49;">:</span><span style="color:#6A737D;">//172.16.3.31:2379 \\</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">--</span><span style="color:#24292E;">initial</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">cluster</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">token etcd</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">cluster</span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">1</span><span style="color:#24292E;"> \\</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">--</span><span style="color:#24292E;">initial</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">cluster etcd1</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">http</span><span style="color:#D73A49;">:</span><span style="color:#6A737D;">//172.16.3.31:2380,etcd2=http://172.16.3.32:2380,etcd3=http://172.16.3.33:2380 \\</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">--</span><span style="color:#24292E;">initial</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">cluster</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">state </span><span style="color:#D73A49;">new</span></span>
<span class="line"><span style="color:#24292E;">    </span></span>
<span class="line"><span style="color:#24292E;">  # etcd2  </span></span>
<span class="line"><span style="color:#24292E;">    docker run -itd --restart=always \\</span></span>
<span class="line"><span style="color:#24292E;">    --network etcd_cluster \\</span></span>
<span class="line"><span style="color:#24292E;">    --ip 172.16.3.32 \\</span></span>
<span class="line"><span style="color:#24292E;">    --hostname etcd2 \\</span></span>
<span class="line"><span style="color:#24292E;">    --name etcd2 \\</span></span>
<span class="line"><span style="color:#24292E;">    -e ETCDCTL_API=3 \\</span></span>
<span class="line"><span style="color:#24292E;">    -p 22379:2379 \\</span></span>
<span class="line"><span style="color:#24292E;">    -p 22380:2380 \\</span></span>
<span class="line"><span style="color:#24292E;">    quay.io/coreos/etcd:v3.3.9 \\</span></span>
<span class="line"><span style="color:#24292E;">    etcd --name etcd2 \\</span></span>
<span class="line"><span style="color:#24292E;">    --initial-advertise-peer-urls http:</span><span style="color:#6A737D;">//172.16.3.32:2380 \\</span></span>
<span class="line"><span style="color:#24292E;">    --listen-peer-urls http:</span><span style="color:#6A737D;">//172.16.3.32:2380 \\</span></span>
<span class="line"><span style="color:#24292E;">    --listen-client-urls http:</span><span style="color:#6A737D;">//172.16.3.32:2379,http://127.0.0.1:2379 \\</span></span>
<span class="line"><span style="color:#24292E;">    --advertise-client-urls http:</span><span style="color:#6A737D;">//172.16.3.32:2379 \\</span></span>
<span class="line"><span style="color:#24292E;">    --initial-cluster-token etcd-cluster-1 \\</span></span>
<span class="line"><span style="color:#24292E;">    --initial-cluster etcd1=http:</span><span style="color:#6A737D;">//172.16.3.31:2380,etcd2=http://172.16.3.32:2380,etcd3=http://172.16.3.33:2380 \\</span></span>
<span class="line"><span style="color:#24292E;">    --initial-cluster-state new</span></span>
<span class="line"><span style="color:#24292E;">  </span></span>
<span class="line"><span style="color:#24292E;">  # etcd3</span></span>
<span class="line"><span style="color:#24292E;">    docker run -itd --restart=always \\</span></span>
<span class="line"><span style="color:#24292E;">    --network etcd_cluster \\</span></span>
<span class="line"><span style="color:#24292E;">    --ip 172.16.3.33 \\</span></span>
<span class="line"><span style="color:#24292E;">    --hostname etcd3 \\</span></span>
<span class="line"><span style="color:#24292E;">    --name etcd3 \\</span></span>
<span class="line"><span style="color:#24292E;">    -e ETCDCTL_API=3 \\</span></span>
<span class="line"><span style="color:#24292E;">    -p 32379:2379 \\</span></span>
<span class="line"><span style="color:#24292E;">    -p 32380:2380 \\</span></span>
<span class="line"><span style="color:#24292E;">    quay.io/coreos/etcd:v3.3.9 \\</span></span>
<span class="line"><span style="color:#24292E;">    etcd --name etcd3 \\</span></span>
<span class="line"><span style="color:#24292E;">    --initial-advertise-peer-urls http:</span><span style="color:#6A737D;">//172.16.3.33:2380 \\</span></span>
<span class="line"><span style="color:#24292E;">    --listen-peer-urls http:</span><span style="color:#6A737D;">//172.16.3.33:2380 \\</span></span>
<span class="line"><span style="color:#24292E;">    --listen-client-urls http:</span><span style="color:#6A737D;">//172.16.3.33:2379,http://127.0.0.1:2379 \\</span></span>
<span class="line"><span style="color:#24292E;">    --advertise-client-urls http:</span><span style="color:#6A737D;">//172.16.3.33:2379 \\</span></span>
<span class="line"><span style="color:#24292E;">    --initial-cluster-token etcd-cluster-1 \\</span></span>
<span class="line"><span style="color:#24292E;">    --initial-cluster etcd1=http:</span><span style="color:#6A737D;">//172.16.3.31:2380,etcd2=http://172.16.3.32:2380,etcd3=http://172.16.3.33:2380 \\</span></span>
<span class="line"><span style="color:#24292E;">    --initial-cluster-state new</span></span>
<span class="line"><span style="color:#24292E;">    </span></span>
<span class="line"><span style="color:#24292E;"> # client</span></span>
<span class="line"><span style="color:#24292E;"> #进入容器 </span></span>
<span class="line"><span style="color:#24292E;">docker exec -it etcd1 bin/sh</span></span>
<span class="line"><span style="color:#24292E;">#客户端测试</span></span>
<span class="line"><span style="color:#24292E;">etcdctl --write-out=table --endpoints=http:</span><span style="color:#6A737D;">//127.0.0.1:2379 member list</span></span>
<span class="line"><span style="color:#24292E;">etcdctl --endpoints=http:</span><span style="color:#6A737D;">//127.0.0.1:2379 put foo bar</span></span>
<span class="line"><span style="color:#24292E;">etcdctl --endpoints=http:</span><span style="color:#6A737D;">//127.0.0.1:2379 get foo</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">#测试结果如下</span></span>
<span class="line"><span style="color:#24292E;">[root@bogon ~]# docker exec -it etcd1 bin/sh</span></span>
<span class="line"><span style="color:#24292E;">/ # etcdctl --write-out=table --endpoints=http:</span><span style="color:#6A737D;">//127.0.0.1:2379 member list</span></span>
<span class="line"><span style="color:#24292E;">+------------------+---------+-------+-------------------------+-------------------------+</span></span>
<span class="line"><span style="color:#24292E;">|        ID        | STATUS  | NAME  |       PEER ADDRS        |      CLIENT ADDRS       |</span></span>
<span class="line"><span style="color:#24292E;">+------------------+---------+-------+-------------------------+-------------------------+</span></span>
<span class="line"><span style="color:#24292E;">|  c26d6ba798c079c | started | etcd3 | http:</span><span style="color:#6A737D;">//172.16.3.33:2380 | http://172.16.3.33:2379 |</span></span>
<span class="line"><span style="color:#24292E;">| 4631df2115e1ef72 | started | etcd2 | http:</span><span style="color:#6A737D;">//172.16.3.32:2380 | http://172.16.3.32:2379 |</span></span>
<span class="line"><span style="color:#24292E;">| a92fe5422902bc40 | started | etcd1 | http:</span><span style="color:#6A737D;">//172.16.3.31:2380 | http://172.16.3.31:2379 |</span></span>
<span class="line"><span style="color:#24292E;">+------------------+---------+-------+-------------------------+-------------------------+</span></span>
<span class="line"><span style="color:#24292E;">/ # etcdctl --endpoints=http:</span><span style="color:#6A737D;">//127.0.0.1:2379 put foo bar</span></span>
<span class="line"><span style="color:#24292E;">OK</span></span>
<span class="line"><span style="color:#24292E;">/ # etcdctl --endpoints=http:</span><span style="color:#6A737D;">//127.0.0.1:2379 get foo</span></span>
<span class="line"><span style="color:#24292E;">foo</span></span>
<span class="line"><span style="color:#24292E;">bar</span></span>
<span class="line"><span style="color:#24292E;">#docker ps</span></span>
<span class="line"><span style="color:#24292E;">[root@bogon docker]# docker ps</span></span>
<span class="line"><span style="color:#24292E;">CONTAINER ID        IMAGE                        COMMAND                  CREATED             STATUS              PORTS                                              NAMES</span></span>
<span class="line"><span style="color:#24292E;">5988c4443eb5        quay.io/coreos/etcd:v3.3.9   &quot;etcd --name etcd3...&quot;   37 seconds ago      Up 36 seconds       0.0.0.0:32379-&gt;2379/tcp, 0.0.0.0:32380-&gt;2380/tcp   etcd3</span></span>
<span class="line"><span style="color:#24292E;">d4fdda6400cc        quay.io/coreos/etcd:v3.3.9   &quot;etcd --name etcd2...&quot;   44 seconds ago      Up 44 seconds       0.0.0.0:22379-&gt;2379/tcp, 0.0.0.0:22380-&gt;2380/tcp   etcd2</span></span>
<span class="line"><span style="color:#24292E;">af86e5fd2ae5        quay.io/coreos/etcd:v3.3.9   &quot;etcd --name etcd1...&quot;   53 seconds ago      Up 52 seconds       0.0.0.0:2379-2380-&gt;2379-2380/tcp                   etcd1</span></span></code></pre></div>`,19),o=[e];function t(c,r,E,y,i,d){return n(),a("div",null,o)}const F=s(p,[["render",t]]);export{h as __pageData,F as default};
