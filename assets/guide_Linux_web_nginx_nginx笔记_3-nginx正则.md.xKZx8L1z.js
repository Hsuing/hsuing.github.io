import{_ as n,o as a,c as l,k as s,a as p,R as o}from"./chunks/framework.zUbWieqp.js";const e="/assets/ze.gqPKMNIQ.png",b=JSON.parse('{"title":"一、正则表达式","description":"","frontmatter":{},"headers":[],"relativePath":"guide/Linux/web/nginx/nginx笔记/3-nginx正则.md","filePath":"guide/Linux/web/nginx/nginx笔记/3-nginx正则.md","lastUpdated":1701684699000}'),t={name:"guide/Linux/web/nginx/nginx笔记/3-nginx正则.md"},c=s("h1",{id:"一、正则表达式",tabindex:"-1"},[p("一、正则表达式 "),s("a",{class:"header-anchor",href:"#一、正则表达式","aria-label":'Permalink to "一、正则表达式"'},"​")],-1),r=s("table",null,[s("thead",null,[s("tr",null,[s("th",null,"元字符"),s("th",null,"说明")])]),s("tbody",null,[s("tr",null,[s("td",null,"."),s("td",null,"匹配除换行符以外的任意字符")]),s("tr",null,[s("td",null,"\\w"),s("td",null,"匹配字母或数字或下划线或汉字")]),s("tr",null,[s("td",null,"\\s"),s("td",null,"匹配任意空白字符")]),s("tr",null,[s("td",null,"\\d"),s("td",null,"匹配数字")]),s("tr",null,[s("td",null,"\\b"),s("td",null,"匹配单词的开始或结束")]),s("tr",null,[s("td",null,"^"),s("td",null,"匹配字符串的开始")]),s("tr",null,[s("td",null,"$"),s("td",null,"匹配字符串的结束")]),s("tr",null,[s("td",null,"重复"),s("td")]),s("tr",null,[s("td",null,"*"),s("td",null,"重复零次或更多次")]),s("tr",null,[s("td",null,"+"),s("td",null,"重复一次或更多次")]),s("tr",null,[s("td",null,"?"),s("td",null,"重复零次或一次")]),s("tr",null,[s("td",{n:""}),s("td",null,"重复n次")]),s("tr",null,[s("td",{"n,":""}),s("td",null,"重复n次或更多次")]),s("tr",null,[s("td",{"n,m":""}),s("td",null,"重复n次到m次")])])],-1),i=o('<p>\\ 转意字符：取消原字符的特殊含义</p><p>?（）分组与取值$</p><p>验证正则表达式工具：pcretest</p><p><img src="'+e+`" alt=""></p><h2 id="_1-n-含义" tabindex="-1">$1...n 含义 <a class="header-anchor" href="#_1-n-含义" aria-label="Permalink to &quot;$1...n 含义&quot;">​</a></h2><p><code>$1|$2|$3 ...</code>是nginx在匹配正则时生成的变量，用于捕获<strong>一个</strong>正则表达式括号中匹配的字符串（从左到右依次存储在<code>$1|$2|$3 ...</code>中），新值覆盖旧值</p><p>$1、$2、$3，$n，代表nginx正则匹配的第一个、第二个、第三个参数，第 n个参数</p><p>比如：</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (</span><span style="color:#F97583;">!</span><span style="color:#B392F0;">-e</span><span style="color:#E1E4E8;"> $request_filename) {</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">rewrite</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">^/</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">.</span><span style="color:#E1E4E8;">*) </span><span style="color:#9ECBFF;">/index.php?</span><span style="color:#FFAB70;">$1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">last</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (</span><span style="color:#D73A49;">!</span><span style="color:#6F42C1;">-e</span><span style="color:#24292E;"> $request_filename) {</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">rewrite</span><span style="color:#24292E;"> </span><span style="color:#032F62;">^/</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">.</span><span style="color:#24292E;">*) </span><span style="color:#032F62;">/index.php?</span><span style="color:#E36209;">$1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">last</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre></div><p>比如：</p><p>将<a href="http://dede.com/index.php?t=3%E7%94%A8%E4%BC%AA%E9%9D%99%E6%80%81%E8%A7%84%E5%88%99%E8%A1%A8%E7%A4%BA%E6%88%90" target="_blank" rel="noreferrer">http://dede.com/index.php?t=3用伪静态规则表示成</a> <a href="http://dede.com/t3.html" target="_blank" rel="noreferrer">http://dede.com/t3.html</a></p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">rewrite 语法：</span></span>
<span class="line"><span style="color:#e1e4e8;">	rewrite  new  old;</span></span>
<span class="line"><span style="color:#e1e4e8;">location / {</span></span>
<span class="line"><span style="color:#e1e4e8;">	rewrite ^(.*)/t(\\d+)\\.html$ $1/index.php?t=3 last;</span></span>
<span class="line"><span style="color:#e1e4e8;">}</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">说明：</span></span>
<span class="line"><span style="color:#e1e4e8;">一个rewrite声明，然后^伪静态规则开头，</span></span>
<span class="line"><span style="color:#e1e4e8;">(.*) 匹配任意字符，这里匹配的是域名，t是想加的东西，</span></span>
<span class="line"><span style="color:#e1e4e8;">(\\d+)匹配数字，.html匹配后缀，</span></span>
<span class="line"><span style="color:#e1e4e8;">$结束，后半部分是要修改的url， </span></span>
<span class="line"><span style="color:#e1e4e8;">$1开头表示域名，/index.php?t=3就是要改写的URL，用last结束即可。</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">rewrite 语法：</span></span>
<span class="line"><span style="color:#24292e;">	rewrite  new  old;</span></span>
<span class="line"><span style="color:#24292e;">location / {</span></span>
<span class="line"><span style="color:#24292e;">	rewrite ^(.*)/t(\\d+)\\.html$ $1/index.php?t=3 last;</span></span>
<span class="line"><span style="color:#24292e;">}</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">说明：</span></span>
<span class="line"><span style="color:#24292e;">一个rewrite声明，然后^伪静态规则开头，</span></span>
<span class="line"><span style="color:#24292e;">(.*) 匹配任意字符，这里匹配的是域名，t是想加的东西，</span></span>
<span class="line"><span style="color:#24292e;">(\\d+)匹配数字，.html匹配后缀，</span></span>
<span class="line"><span style="color:#24292e;">$结束，后半部分是要修改的url， </span></span>
<span class="line"><span style="color:#24292e;">$1开头表示域名，/index.php?t=3就是要改写的URL，用last结束即可。</span></span></code></pre></div><h1 id="_2-location匹配规则详解" tabindex="-1">2.location匹配规则详解 <a class="header-anchor" href="#_2-location匹配规则详解" aria-label="Permalink to &quot;2.location匹配规则详解&quot;">​</a></h1><p>nginx官方文档给出location语法如下</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">location [=|~|~*|^~] uri { … }</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">location [=|~|~*|^~] uri { … }</span></span></code></pre></div><p>其中，方括号中的四种标识符是可选项，用来改变请求字符串和uri的匹配方式。uri是待匹配的请求字符串，可以是不包含正则的字符串，这种模式被称为“标准的uri&quot;；也可以包含正则，这种模式被称为&quot;正则uri&quot;，如下：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">location ~ .*\\.(php|php5)?$ {</span></span>
<span class="line"><span style="color:#e1e4e8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">location ~ .*\\.(php|php5)?$ {</span></span>
<span class="line"><span style="color:#24292e;">}</span></span></code></pre></div><h2 id="_2-1四种可选的标识符" tabindex="-1">2.1四种可选的标识符 <a class="header-anchor" href="#_2-1四种可选的标识符" aria-label="Permalink to &quot;2.1四种可选的标识符&quot;">​</a></h2><table><thead><tr><th><strong>标识符</strong></th><th><strong>描述</strong></th></tr></thead><tbody><tr><td>=</td><td><strong>精确匹配</strong>；用于标准uri前，要求请求字符串和uri严格匹配。如果匹配成功，就停止匹配，立即执行该location里面的请求。</td></tr><tr><td>~</td><td><strong>正则匹配</strong>；用于正则uri前，表示uri里面包含正则，并且区分大小写。</td></tr><tr><td>~*</td><td><strong>正则匹配</strong>；用于正则uri前，表示uri里面包含正则，不区分大小写。</td></tr><tr><td>^~</td><td><strong>非正则匹配</strong>；用于标准uri前，nginx服务器匹配到前缀最多的uri后就结束，该模式匹配成功后，不会使用正则匹配。</td></tr><tr><td>无</td><td><strong>普通匹配（最长字符匹配）</strong>；与location顺序无关，是按照匹配的长短来取匹配结果。若完全匹配，就停止匹配。</td></tr></tbody></table><p>1、如果uri里面包含正则表达式，就必须使用~或~*标识符；</p><p>2、针对~和~*匹配标识符，可以在前面加上!来取反，如下：</p><p>!~ 表示正则不匹配，区分大小写。</p><p>!~* 表示正则不匹配，不区分大小写。</p><p><strong>2.1 “=”精准匹配案例</strong></p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">location = /login {</span></span>
<span class="line"><span style="color:#e1e4e8;"> # 精确匹配 /login ，匹配成功后，立即结束</span></span>
<span class="line"><span style="color:#e1e4e8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">location = /login {</span></span>
<span class="line"><span style="color:#24292e;"> # 精确匹配 /login ，匹配成功后，立即结束</span></span>
<span class="line"><span style="color:#24292e;">}</span></span></code></pre></div><p><strong>2.2 “~”区分大小写正则匹配案例</strong></p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">location ~ /images/ {</span></span>
<span class="line"><span style="color:#e1e4e8;"> #正则匹配，区分大小写，匹配成功后，立即结束</span></span>
<span class="line"><span style="color:#e1e4e8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">location ~ /images/ {</span></span>
<span class="line"><span style="color:#24292e;"> #正则匹配，区分大小写，匹配成功后，立即结束</span></span>
<span class="line"><span style="color:#24292e;">}</span></span></code></pre></div><p><strong>2.3 “~*”不区分大小写正则匹配案例</strong></p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">location ~* /images/ {</span></span>
<span class="line"><span style="color:#e1e4e8;"> #正则匹配，不区分大小写，匹配成功后，立即结束</span></span>
<span class="line"><span style="color:#e1e4e8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">location ~* /images/ {</span></span>
<span class="line"><span style="color:#24292e;"> #正则匹配，不区分大小写，匹配成功后，立即结束</span></span>
<span class="line"><span style="color:#24292e;">}</span></span></code></pre></div><p><strong>2.4 “^~” 不进行正则匹配的标准匹配</strong></p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">location ^~ /images/ {</span></span>
<span class="line"><span style="color:#e1e4e8;"> # 匹配任何以 /images/ 开头的地址，匹配符合以后，停止往下搜索正则，采用这一条。</span></span>
<span class="line"><span style="color:#e1e4e8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">location ^~ /images/ {</span></span>
<span class="line"><span style="color:#24292e;"> # 匹配任何以 /images/ 开头的地址，匹配符合以后，停止往下搜索正则，采用这一条。</span></span>
<span class="line"><span style="color:#24292e;">}</span></span></code></pre></div><p><strong>2.5 普通匹配（最长字符匹配）</strong></p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">location /blog/ {</span></span>
<span class="line"><span style="color:#e1e4e8;"> # 与location顺序无关</span></span>
<span class="line"><span style="color:#e1e4e8;"> # 若完全匹配成功，就不在继续匹配，否则还会进行正则匹配</span></span>
<span class="line"><span style="color:#e1e4e8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">location /blog/ {</span></span>
<span class="line"><span style="color:#24292e;"> # 与location顺序无关</span></span>
<span class="line"><span style="color:#24292e;"> # 若完全匹配成功，就不在继续匹配，否则还会进行正则匹配</span></span>
<span class="line"><span style="color:#24292e;">}</span></span></code></pre></div><h2 id="_2-2location匹配顺序" tabindex="-1">2.2location匹配顺序 <a class="header-anchor" href="#_2-2location匹配顺序" aria-label="Permalink to &quot;2.2location匹配顺序&quot;">​</a></h2><p>在没有标识符的请求下，匹配规则如下：</p><p>1、nginx服务器首先在server块的多个location块中搜索是否有标准的uri和请求字符串匹配。如果有多个标准uri可以匹配，就匹配其中匹配度最高的一个location。</p><p>2、然后，nginx在使用location块中，正则uri和请求字符串，进行匹配。如果正则匹配成功，则结束匹配，并使用这个location处理请求；如果正则匹配失败，则使用标准uri中，匹配度最高的location。</p><p><strong>备注：</strong></p><p>1、如果有精确匹配，会先进行精确匹配，匹配成功，立刻返回结果。</p><p>2、普通匹配与顺序无关，因为按照匹配的长短来取匹配结果。</p><p>3、正则匹配与顺序有关，因为是从上往下匹配。(首先匹配，就结束解析过程)</p><p>4、在location中，有一种统配的location，所有的请求，都可以匹配，如下：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">location / {</span></span>
<span class="line"><span style="color:#e1e4e8;"> # 因为所有的地址都以 / 开头，所以这条规则将匹配到所有请求</span></span>
<span class="line"><span style="color:#e1e4e8;"> # 但是正则和最长字符串会优先匹配</span></span>
<span class="line"><span style="color:#e1e4e8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">location / {</span></span>
<span class="line"><span style="color:#24292e;"> # 因为所有的地址都以 / 开头，所以这条规则将匹配到所有请求</span></span>
<span class="line"><span style="color:#24292e;"> # 但是正则和最长字符串会优先匹配</span></span>
<span class="line"><span style="color:#24292e;">}</span></span></code></pre></div><p>结合标识符，匹配顺序如下：</p><p>(location =) &gt; (location 完整路径) &gt; (location ^~ 路径) &gt; (location ~,~* 正则顺序) &gt; (location 部分起始路径) &gt; (location /)</p><p>即</p><p>（精确匹配）&gt; (最长字符串匹配，但完全匹配) &gt;（非正则匹配）&gt;（正则匹配）&gt;（最长字符串匹配，不完全匹配）&gt;（location通配）</p><h3 id="案例" tabindex="-1">案例 <a class="header-anchor" href="#案例" aria-label="Permalink to &quot;案例&quot;">​</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">location</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">{</span><span style="color:#E1E4E8;">  </span></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#B392F0;">//精确匹配/</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">，主机名后面不能带任何字符串</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#79B8FF;">echo</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;规则A&quot;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span>
<span class="line"><span style="color:#E1E4E8;"> </span></span>
<span class="line"><span style="color:#B392F0;">location</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/login</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">{</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">//精确匹配</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/login</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">开头的地址，匹配符合以后，不在继续往下搜索</span><span style="color:#E1E4E8;"> </span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#79B8FF;">echo</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;规则B&quot;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span>
<span class="line"><span style="color:#E1E4E8;"> </span></span>
<span class="line"><span style="color:#B392F0;">location</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">^~</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/blog/</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">{</span><span style="color:#E1E4E8;"> </span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">//非正则匹配，匹配/blog/后，停止往下搜索正则，采用这一条</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">echo</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;规则C&quot;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span>
<span class="line"><span style="color:#E1E4E8;"> </span></span>
<span class="line"><span style="color:#E1E4E8;"> </span></span>
<span class="line"><span style="color:#B392F0;">location</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">~</span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">\\.</span><span style="color:#E1E4E8;">(</span><span style="color:#B392F0;">gif</span><span style="color:#F97583;">|</span><span style="color:#B392F0;">jpg</span><span style="color:#F97583;">|</span><span style="color:#B392F0;">png</span><span style="color:#F97583;">|</span><span style="color:#B392F0;">js</span><span style="color:#F97583;">|</span><span style="color:#B392F0;">css</span><span style="color:#E1E4E8;">)$ </span><span style="color:#9ECBFF;">{</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">//区分大小写的正则匹配</span><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">若匹配成功，停止往下搜索正则，采用这一条</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#79B8FF;">echo</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;规则D&quot;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span>
<span class="line"><span style="color:#E1E4E8;"> </span></span>
<span class="line"><span style="color:#E1E4E8;"> </span></span>
<span class="line"><span style="color:#B392F0;">location</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">~</span><span style="color:#79B8FF;">*</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">\\.</span><span style="color:#9ECBFF;">png</span><span style="color:#E1E4E8;">$ </span><span style="color:#9ECBFF;">{</span><span style="color:#E1E4E8;">  </span></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#B392F0;">//区分大小写的正则匹配</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">，停止往下搜索正则，采用这一条</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#79B8FF;">echo</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;规则E&quot;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span>
<span class="line"><span style="color:#E1E4E8;"> </span></span>
<span class="line"><span style="color:#B392F0;">location</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">{</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">//因为所有的地址都以</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">开头，所以这条规则将匹配到所有请求</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">//如果没任何规则匹配上，就采用这条规则</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#79B8FF;">echo</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;规则F&quot;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span>
<span class="line"><span style="color:#E1E4E8;"> </span></span>
<span class="line"><span style="color:#B392F0;">location</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/blog/detail</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">{</span><span style="color:#E1E4E8;"> </span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">//最长字符串匹配，若完全匹配成功，就不在继续匹配，否则还会进行正则匹配</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">echo</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;规则G&quot;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span>
<span class="line"><span style="color:#E1E4E8;"> </span></span>
<span class="line"><span style="color:#B392F0;">location</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/images</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">{</span><span style="color:#E1E4E8;">  </span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">//最长字符串匹配，同上</span><span style="color:#E1E4E8;"> </span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#79B8FF;">echo</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;规则Y&quot;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span>
<span class="line"><span style="color:#E1E4E8;"> </span></span>
<span class="line"><span style="color:#B392F0;">location</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">^~</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/static/files</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">{</span><span style="color:#E1E4E8;">  </span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">//非正则匹配，若匹配成功，就不在继续匹配</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#79B8FF;">echo</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;规则X&quot;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">location</span><span style="color:#24292E;"> </span><span style="color:#032F62;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/</span><span style="color:#24292E;"> </span><span style="color:#032F62;">{</span><span style="color:#24292E;">  </span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#6F42C1;">//精确匹配/</span><span style="color:#24292E;"> </span><span style="color:#032F62;">，主机名后面不能带任何字符串</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#005CC5;">echo</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;规则A&quot;</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">}</span></span>
<span class="line"><span style="color:#24292E;"> </span></span>
<span class="line"><span style="color:#6F42C1;">location</span><span style="color:#24292E;"> </span><span style="color:#032F62;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/login</span><span style="color:#24292E;"> </span><span style="color:#032F62;">{</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">//精确匹配</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/login</span><span style="color:#24292E;"> </span><span style="color:#032F62;">开头的地址，匹配符合以后，不在继续往下搜索</span><span style="color:#24292E;"> </span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#005CC5;">echo</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;规则B&quot;</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">}</span></span>
<span class="line"><span style="color:#24292E;"> </span></span>
<span class="line"><span style="color:#6F42C1;">location</span><span style="color:#24292E;"> </span><span style="color:#032F62;">^~</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/blog/</span><span style="color:#24292E;"> </span><span style="color:#032F62;">{</span><span style="color:#24292E;"> </span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">//非正则匹配，匹配/blog/后，停止往下搜索正则，采用这一条</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#005CC5;">echo</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;规则C&quot;</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">}</span></span>
<span class="line"><span style="color:#24292E;"> </span></span>
<span class="line"><span style="color:#24292E;"> </span></span>
<span class="line"><span style="color:#6F42C1;">location</span><span style="color:#24292E;"> </span><span style="color:#032F62;">~</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">\\.</span><span style="color:#24292E;">(</span><span style="color:#6F42C1;">gif</span><span style="color:#D73A49;">|</span><span style="color:#6F42C1;">jpg</span><span style="color:#D73A49;">|</span><span style="color:#6F42C1;">png</span><span style="color:#D73A49;">|</span><span style="color:#6F42C1;">js</span><span style="color:#D73A49;">|</span><span style="color:#6F42C1;">css</span><span style="color:#24292E;">)$ </span><span style="color:#032F62;">{</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">//区分大小写的正则匹配</span><span style="color:#24292E;">  </span><span style="color:#032F62;">若匹配成功，停止往下搜索正则，采用这一条</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#005CC5;">echo</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;规则D&quot;</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">}</span></span>
<span class="line"><span style="color:#24292E;"> </span></span>
<span class="line"><span style="color:#24292E;"> </span></span>
<span class="line"><span style="color:#6F42C1;">location</span><span style="color:#24292E;"> </span><span style="color:#032F62;">~</span><span style="color:#005CC5;">*</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">\\.</span><span style="color:#032F62;">png</span><span style="color:#24292E;">$ </span><span style="color:#032F62;">{</span><span style="color:#24292E;">  </span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#6F42C1;">//区分大小写的正则匹配</span><span style="color:#24292E;"> </span><span style="color:#032F62;">，停止往下搜索正则，采用这一条</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#005CC5;">echo</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;规则E&quot;</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">}</span></span>
<span class="line"><span style="color:#24292E;"> </span></span>
<span class="line"><span style="color:#6F42C1;">location</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/</span><span style="color:#24292E;"> </span><span style="color:#032F62;">{</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">//因为所有的地址都以</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/</span><span style="color:#24292E;"> </span><span style="color:#032F62;">开头，所以这条规则将匹配到所有请求</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">//如果没任何规则匹配上，就采用这条规则</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#005CC5;">echo</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;规则F&quot;</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">}</span></span>
<span class="line"><span style="color:#24292E;"> </span></span>
<span class="line"><span style="color:#6F42C1;">location</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/blog/detail</span><span style="color:#24292E;"> </span><span style="color:#032F62;">{</span><span style="color:#24292E;"> </span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">//最长字符串匹配，若完全匹配成功，就不在继续匹配，否则还会进行正则匹配</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#005CC5;">echo</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;规则G&quot;</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">}</span></span>
<span class="line"><span style="color:#24292E;"> </span></span>
<span class="line"><span style="color:#6F42C1;">location</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/images</span><span style="color:#24292E;"> </span><span style="color:#032F62;">{</span><span style="color:#24292E;">  </span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">//最长字符串匹配，同上</span><span style="color:#24292E;"> </span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#005CC5;">echo</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;规则Y&quot;</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">}</span></span>
<span class="line"><span style="color:#24292E;"> </span></span>
<span class="line"><span style="color:#6F42C1;">location</span><span style="color:#24292E;"> </span><span style="color:#032F62;">^~</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/static/files</span><span style="color:#24292E;"> </span><span style="color:#032F62;">{</span><span style="color:#24292E;">  </span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">//非正则匹配，若匹配成功，就不在继续匹配</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#005CC5;">echo</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;规则X&quot;</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre></div><p>1、当访问根路径/的时候，比如<a href="http://www.findme.wang/" target="_blank" rel="noreferrer">http://www.findme.wang/</a> ，会匹配规则A。</p><p>2、当访如<a href="http://www.findme.wang/login" target="_blank" rel="noreferrer">http://www.findme.wang/login</a> ，会匹配规则B。</p><p>3、当访如<a href="http://www.findme.wang/login.html" target="_blank" rel="noreferrer">http://www.findme.wang/login.html</a> ，会匹配规则F。</p><p>4、当访如<a href="http://www.findme.wang/blog/detail/3.html" target="_blank" rel="noreferrer">http://www.findme.wang/blog/detail/3.html</a> ，会匹配规则C。分析思路，首先看看，“<strong>精确匹配</strong>”是否可以匹配成功，显示不可以；然后，看看是否可以“<strong>普通匹配</strong>”是否可以完全匹配，显示也没有；接着在看看非正则匹配，是否可以匹配成功，发现同规则C匹配上了，所以采用了规则C。</p>`,53),y=[c,r,i];function E(d,F,g,h,u,C){return a(),l("div",null,y)}const v=n(t,[["render",E]]);export{b as __pageData,v as default};
