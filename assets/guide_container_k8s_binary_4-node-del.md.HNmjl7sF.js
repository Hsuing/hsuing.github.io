import{_ as s,o as a,c as n,R as l}from"./chunks/framework.zUbWieqp.js";const u=JSON.parse('{"title":"1.查看集群状态","description":"","frontmatter":{},"headers":[],"relativePath":"guide/container/k8s/binary/4-node-del.md","filePath":"guide/container/k8s/binary/4-node-del.md","lastUpdated":1729073852000}'),o={name:"guide/container/k8s/binary/4-node-del.md"},p=l(`<h1 id="_1-查看集群状态" tabindex="-1">1.查看集群状态 <a class="header-anchor" href="#_1-查看集群状态" aria-label="Permalink to &quot;1.查看集群状态&quot;">​</a></h1><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">[root@kube-master-01 </span><span style="color:#F97583;">~</span><span style="color:#E1E4E8;">]# kubectl get node</span></span>
<span class="line"><span style="color:#B392F0;">NAME</span><span style="color:#E1E4E8;">             </span><span style="color:#9ECBFF;">STATUS</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">ROLES</span><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">AGE</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">VERSION</span></span>
<span class="line"><span style="color:#B392F0;">kube-master-01</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">Ready</span><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">non</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">23</span><span style="color:#9ECBFF;">d</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">v1.29.7</span></span>
<span class="line"><span style="color:#B392F0;">kube-node-01</span><span style="color:#E1E4E8;">     </span><span style="color:#9ECBFF;">Ready</span><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">non</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">23</span><span style="color:#9ECBFF;">d</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">v1.29.7</span></span>
<span class="line"><span style="color:#B392F0;">kube-node-02</span><span style="color:#E1E4E8;">     </span><span style="color:#9ECBFF;">Ready</span><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">non</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">23</span><span style="color:#9ECBFF;">d</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">v1.29.7</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">[root@kube-master-01 </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# kubectl get node</span></span>
<span class="line"><span style="color:#6F42C1;">NAME</span><span style="color:#24292E;">             </span><span style="color:#032F62;">STATUS</span><span style="color:#24292E;">   </span><span style="color:#032F62;">ROLES</span><span style="color:#24292E;">    </span><span style="color:#032F62;">AGE</span><span style="color:#24292E;">   </span><span style="color:#032F62;">VERSION</span></span>
<span class="line"><span style="color:#6F42C1;">kube-master-01</span><span style="color:#24292E;">   </span><span style="color:#032F62;">Ready</span><span style="color:#24292E;">    </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">non</span><span style="color:#24292E;">e</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">23</span><span style="color:#032F62;">d</span><span style="color:#24292E;">   </span><span style="color:#032F62;">v1.29.7</span></span>
<span class="line"><span style="color:#6F42C1;">kube-node-01</span><span style="color:#24292E;">     </span><span style="color:#032F62;">Ready</span><span style="color:#24292E;">    </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">non</span><span style="color:#24292E;">e</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">23</span><span style="color:#032F62;">d</span><span style="color:#24292E;">   </span><span style="color:#032F62;">v1.29.7</span></span>
<span class="line"><span style="color:#6F42C1;">kube-node-02</span><span style="color:#24292E;">     </span><span style="color:#032F62;">Ready</span><span style="color:#24292E;">    </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">non</span><span style="color:#24292E;">e</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">23</span><span style="color:#032F62;">d</span><span style="color:#24292E;">   </span><span style="color:#032F62;">v1.29.7</span></span></code></pre></div><h2 id="_1-1-禁止调度" tabindex="-1">1.1 禁止调度 <a class="header-anchor" href="#_1-1-禁止调度" aria-label="Permalink to &quot;1.1 禁止调度&quot;">​</a></h2><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">[root@kube-master-01 </span><span style="color:#F97583;">~</span><span style="color:#E1E4E8;">]# kubectl cordon kube-node-02</span></span>
<span class="line"><span style="color:#B392F0;">node/kube-node-02</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">cordoned</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">[root@kube-master-01 </span><span style="color:#F97583;">~</span><span style="color:#E1E4E8;">]# kubectl get node</span></span>
<span class="line"><span style="color:#B392F0;">NAME</span><span style="color:#E1E4E8;">             </span><span style="color:#9ECBFF;">STATUS</span><span style="color:#E1E4E8;">                     </span><span style="color:#9ECBFF;">ROLES</span><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">AGE</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">VERSION</span></span>
<span class="line"><span style="color:#B392F0;">kube-master-01</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">Ready</span><span style="color:#E1E4E8;">                      </span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">non</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">23</span><span style="color:#9ECBFF;">d</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">v1.29.7</span></span>
<span class="line"><span style="color:#B392F0;">kube-node-01</span><span style="color:#E1E4E8;">     </span><span style="color:#9ECBFF;">Ready</span><span style="color:#E1E4E8;">                      </span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">non</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">23</span><span style="color:#9ECBFF;">d</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">v1.29.7</span></span>
<span class="line"><span style="color:#B392F0;">kube-node-02</span><span style="color:#E1E4E8;">     </span><span style="color:#9ECBFF;">Ready,SchedulingDisabled</span><span style="color:#E1E4E8;">   </span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">non</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">23</span><span style="color:#9ECBFF;">d</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">v1.29.7</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">[root@kube-master-01 </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# kubectl cordon kube-node-02</span></span>
<span class="line"><span style="color:#6F42C1;">node/kube-node-02</span><span style="color:#24292E;"> </span><span style="color:#032F62;">cordoned</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">[root@kube-master-01 </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# kubectl get node</span></span>
<span class="line"><span style="color:#6F42C1;">NAME</span><span style="color:#24292E;">             </span><span style="color:#032F62;">STATUS</span><span style="color:#24292E;">                     </span><span style="color:#032F62;">ROLES</span><span style="color:#24292E;">    </span><span style="color:#032F62;">AGE</span><span style="color:#24292E;">   </span><span style="color:#032F62;">VERSION</span></span>
<span class="line"><span style="color:#6F42C1;">kube-master-01</span><span style="color:#24292E;">   </span><span style="color:#032F62;">Ready</span><span style="color:#24292E;">                      </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">non</span><span style="color:#24292E;">e</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">23</span><span style="color:#032F62;">d</span><span style="color:#24292E;">   </span><span style="color:#032F62;">v1.29.7</span></span>
<span class="line"><span style="color:#6F42C1;">kube-node-01</span><span style="color:#24292E;">     </span><span style="color:#032F62;">Ready</span><span style="color:#24292E;">                      </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">non</span><span style="color:#24292E;">e</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">23</span><span style="color:#032F62;">d</span><span style="color:#24292E;">   </span><span style="color:#032F62;">v1.29.7</span></span>
<span class="line"><span style="color:#6F42C1;">kube-node-02</span><span style="color:#24292E;">     </span><span style="color:#032F62;">Ready,SchedulingDisabled</span><span style="color:#24292E;">   </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">non</span><span style="color:#24292E;">e</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">23</span><span style="color:#032F62;">d</span><span style="color:#24292E;">   </span><span style="color:#032F62;">v1.29.7</span></span></code></pre></div><h2 id="_1-2-驱逐pod" tabindex="-1">1.2 驱逐Pod <a class="header-anchor" href="#_1-2-驱逐pod" aria-label="Permalink to &quot;1.2 驱逐Pod&quot;">​</a></h2><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">drain</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">node-nam</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--ignore-daemonsets</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--delete-emptydir-data</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">drain</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">node-nam</span><span style="color:#24292E;">e</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--ignore-daemonsets</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--delete-emptydir-data</span></span></code></pre></div><div class="danger custom-block"><p class="custom-block-title">❌ 注意</p><p>kubectl drain --ignore-daemonsets --delete-local-data</p><p>低版本使用(1.24之前) --delete-local-data</p></div><h2 id="_1-3-停止服务" tabindex="-1">1.3 停止服务 <a class="header-anchor" href="#_1-3-停止服务" aria-label="Permalink to &quot;1.3 停止服务&quot;">​</a></h2><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">$ systemctl stop kubelet kube-proxy</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">$ systemctl stop kubelet kube-proxy</span></span></code></pre></div><h2 id="_1-4-删除节点" tabindex="-1">1.4 删除节点 <a class="header-anchor" href="#_1-4-删除节点" aria-label="Permalink to &quot;1.4 删除节点&quot;">​</a></h2><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">delete</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">node</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">node-nam</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">delete</span><span style="color:#24292E;"> </span><span style="color:#032F62;">node</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">node-nam</span><span style="color:#24292E;">e</span><span style="color:#D73A49;">&gt;</span></span></code></pre></div><h2 id="_1-5-删除数据目录" tabindex="-1">1.5 删除数据目录 <a class="header-anchor" href="#_1-5-删除数据目录" aria-label="Permalink to &quot;1.5 删除数据目录&quot;">​</a></h2><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">cat kubelet.conf</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">cat kubelet.conf</span></span></code></pre></div><blockquote><p>确认是否有 <code>root-dir</code> 参数。如果有的话，那kubelet数据就存放在该目录下，默认在 <code>/var/lib/kubelet</code> 目录下</p></blockquote><h3 id="docker" tabindex="-1">docker <a class="header-anchor" href="#docker" aria-label="Permalink to &quot;docker&quot;">​</a></h3><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">cat /etc/docker/daemon.json</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">cat /etc/docker/daemon.json</span></span></code></pre></div><blockquote><p>确认是否有 <code>data-root 或者 graph</code> 参数。如果有的话，那docker数据就存放在该目录下，默认在 <code>/var/lib/docker</code> 目录下</p></blockquote><ul><li>清理docker数据</li></ul><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">docker system prune -af</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">docker system prune -af</span></span></code></pre></div><ul><li>停止docker服务</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">systemctl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">stop</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">docker</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;"> </span><span style="color:#6F42C1;">systemctl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">stop</span><span style="color:#24292E;"> </span><span style="color:#032F62;">docker</span></span></code></pre></div><ul><li>取消挂载</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">$</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">umount</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">$(</span><span style="color:#B392F0;">df</span><span style="color:#9ECBFF;"> </span><span style="color:#79B8FF;">-HT</span><span style="color:#9ECBFF;"> </span><span style="color:#F97583;">|</span><span style="color:#9ECBFF;"> </span><span style="color:#B392F0;">grep</span><span style="color:#9ECBFF;"> &#39;/var/lib/kubelet/pods&#39; </span><span style="color:#F97583;">|</span><span style="color:#9ECBFF;"> </span><span style="color:#B392F0;">awk</span><span style="color:#9ECBFF;"> &#39;{print $7}&#39;)</span></span>
<span class="line"><span style="color:#B392F0;">$</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">rm</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-rf</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/var/lib/kubelet/</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/data/docker/data/</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">$</span><span style="color:#24292E;"> </span><span style="color:#032F62;">umount</span><span style="color:#24292E;"> </span><span style="color:#032F62;">$(</span><span style="color:#6F42C1;">df</span><span style="color:#032F62;"> </span><span style="color:#005CC5;">-HT</span><span style="color:#032F62;"> </span><span style="color:#D73A49;">|</span><span style="color:#032F62;"> </span><span style="color:#6F42C1;">grep</span><span style="color:#032F62;"> &#39;/var/lib/kubelet/pods&#39; </span><span style="color:#D73A49;">|</span><span style="color:#032F62;"> </span><span style="color:#6F42C1;">awk</span><span style="color:#032F62;"> &#39;{print $7}&#39;)</span></span>
<span class="line"><span style="color:#6F42C1;">$</span><span style="color:#24292E;"> </span><span style="color:#032F62;">rm</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-rf</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/var/lib/kubelet/</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/data/docker/data/</span></span></code></pre></div><h3 id="containerd" tabindex="-1">containerd <a class="header-anchor" href="#containerd" aria-label="Permalink to &quot;containerd&quot;">​</a></h3><h2 id="_1-6-删除k8s网络插件目录" tabindex="-1">1.6 删除k8s网络插件目录 <a class="header-anchor" href="#_1-6-删除k8s网络插件目录" aria-label="Permalink to &quot;1.6 删除k8s网络插件目录&quot;">​</a></h2><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">$ rm -rf /opt/cni/bin /etc/cni/net.d /var/lib/cni</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">$ rm -rf /opt/cni/bin /etc/cni/net.d /var/lib/cni</span></span></code></pre></div><ul><li>删除启动文件</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">#根据各自的路径进行删除</span></span>
<span class="line"><span style="color:#B392F0;">$</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">rm</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-rf</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/usr/lib/systemd/system/kubelet.service</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/usr/lib/systemd/system/kube-proxy.service</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">#根据各自的路径进行删除</span></span>
<span class="line"><span style="color:#6F42C1;">$</span><span style="color:#24292E;"> </span><span style="color:#032F62;">rm</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-rf</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/usr/lib/systemd/system/kubelet.service</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/usr/lib/systemd/system/kube-proxy.service</span></span></code></pre></div>`,28),e=[p];function t(c,r,y,E,d,i){return a(),n("div",null,e)}const b=s(o,[["render",t]]);export{u as __pageData,b as default};
