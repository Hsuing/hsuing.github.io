import{_ as s,o as n,c as a,R as l}from"./chunks/framework.zUbWieqp.js";const d=JSON.parse('{"title":"1.下载","description":"","frontmatter":{},"headers":[],"relativePath":"guide/Linux/Gitlab/0-install.md","filePath":"guide/Linux/Gitlab/0-install.md","lastUpdated":1726727909000}'),p={name:"guide/Linux/Gitlab/0-install.md"},o=l(`<p><code>centos7.9环境下</code></p><p><code>gitlab-ee.16.0.0</code></p><h1 id="_1-下载" tabindex="-1">1.下载 <a class="header-anchor" href="#_1-下载" aria-label="Permalink to &quot;1.下载&quot;">​</a></h1><p><a href="https://packages.gitlab.com/gitlab/gitlab-ee" target="_blank" rel="noreferrer">https://packages.gitlab.com/gitlab/gitlab-ee</a></p><p>或者</p><p><a href="https://mirrors.tuna.tsinghua.edu.cn/gitlab-ee/yum/el7/" target="_blank" rel="noreferrer">https://mirrors.tuna.tsinghua.edu.cn/gitlab-ee/yum/el7/</a></p><h1 id="_2-安装" tabindex="-1">2.安装 <a class="header-anchor" href="#_2-安装" aria-label="Permalink to &quot;2.安装&quot;">​</a></h1><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">[root@k8s-master01 </span><span style="color:#F97583;">~</span><span style="color:#E1E4E8;">]# rpm -ivh gitlab-ee-16.0.0-ee.0.el7.x86_64.rpm </span></span>
<span class="line"><span style="color:#B392F0;">警告：gitlab-ee-16.0.0-ee.0.el7.x86_64.rpm:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">头V4</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">RSA/SHA1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Signature,</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">密钥</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">ID</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">f27eab47:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">NOKEY</span></span>
<span class="line"><span style="color:#B392F0;">准备中...</span><span style="color:#E1E4E8;">                          </span><span style="color:#6A737D;">################################# [100%]</span></span>
<span class="line"><span style="color:#B392F0;">正在升级/安装...</span></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#B392F0;">1:gitlab-ee-16.0.0-ee.0.el7</span><span style="color:#E1E4E8;">        </span><span style="color:#6A737D;">################################# [100%]</span></span>
<span class="line"><span style="color:#B392F0;">It</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">looks</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">like</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">GitLab</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">has</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">not</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">been</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">configured</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">yet</span><span style="color:#E1E4E8;">; </span><span style="color:#B392F0;">skipping</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">the</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">upgrade</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">script.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">       </span><span style="color:#B392F0;">*.</span><span style="color:#E1E4E8;">                  </span><span style="color:#79B8FF;">*</span><span style="color:#9ECBFF;">.</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#B392F0;">***</span><span style="color:#E1E4E8;">                 </span><span style="color:#79B8FF;">***</span></span>
<span class="line"><span style="color:#E1E4E8;">     </span><span style="color:#B392F0;">*****</span><span style="color:#E1E4E8;">               </span><span style="color:#79B8FF;">*****</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#79B8FF;">.</span><span style="color:#E1E4E8;">******             </span><span style="color:#79B8FF;">*******</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">********</span><span style="color:#E1E4E8;">            </span><span style="color:#79B8FF;">********</span></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#B392F0;">,,,,,,,,,***********,,,,,,,,,</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">,,,,,,,,,,,*********,,,,,,,,,,,</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">.</span><span style="color:#E1E4E8;">,,,,,,,,,,,*******,,,,,,,,,,,,</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#B392F0;">,,,,,,,,,*****,,,,,,,,,.</span></span>
<span class="line"><span style="color:#E1E4E8;">         </span><span style="color:#B392F0;">,,,,,,,****,,,,,,</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#79B8FF;">.</span><span style="color:#E1E4E8;">,,,***,,,,</span></span>
<span class="line"><span style="color:#E1E4E8;">                </span><span style="color:#B392F0;">,*,.</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">     </span><span style="color:#B392F0;">_______</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">__</span><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">__</span><span style="color:#E1E4E8;">          </span><span style="color:#9ECBFF;">__</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">/</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">____</span><span style="color:#E1E4E8;">(</span><span style="color:#B392F0;">_</span><span style="color:#E1E4E8;">) </span><span style="color:#9ECBFF;">/_/</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">____</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">_/</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/_</span></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#B392F0;">/</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">__/</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">__/</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">/</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">__</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">\`</span><span style="color:#B392F0;">/</span><span style="color:#9ECBFF;"> __ </span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#9ECBFF;">  / /_/ / / /_/ /___/ /_/ / /_/ /</span></span>
<span class="line"><span style="color:#9ECBFF;">  </span><span style="color:#B392F0;">\\____/_/\\__/_____/\\__,_/_.___/</span></span>
<span class="line"><span style="color:#9ECBFF;">  </span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">Thank</span><span style="color:#9ECBFF;"> you for installing GitLab!</span></span>
<span class="line"><span style="color:#B392F0;">GitLab</span><span style="color:#9ECBFF;"> was unable to detect a valid hostname for your instance.</span></span>
<span class="line"><span style="color:#B392F0;">Please</span><span style="color:#9ECBFF;"> configure a URL for your GitLab instance by setting \`</span><span style="color:#B392F0;">external_url</span><span style="color:#9ECBFF;">\`</span></span>
<span class="line"><span style="color:#B392F0;">configuration</span><span style="color:#9ECBFF;"> in /etc/gitlab/gitlab.rb file.</span></span>
<span class="line"><span style="color:#B392F0;">Then,</span><span style="color:#9ECBFF;"> you can start your GitLab instance by running the following command:</span></span>
<span class="line"><span style="color:#9ECBFF;">  </span><span style="color:#B392F0;">sudo</span><span style="color:#9ECBFF;"> gitlab-ctl reconfigure</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">For</span><span style="color:#9ECBFF;"> a comprehensive list of configuration options please see the Omnibus GitLab readme</span></span>
<span class="line"><span style="color:#B392F0;">https://gitlab.com/gitlab-org/omnibus-gitlab/blob/master/README.md</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">Help</span><span style="color:#9ECBFF;"> us improve the installation experience, let us know how we did with a </span><span style="color:#79B8FF;">1</span><span style="color:#9ECBFF;"> minute survey:</span></span>
<span class="line"><span style="color:#B392F0;">https://gitlab.fra1.qualtrics.com/jfe/form/SV_6kVqZANThUQ1bZb?installation</span><span style="color:#9ECBFF;">=omnibus&amp;</span><span style="color:#E1E4E8;">release</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">16</span><span style="color:#9ECBFF;">-0</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">[root@k8s-master01 </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# rpm -ivh gitlab-ee-16.0.0-ee.0.el7.x86_64.rpm </span></span>
<span class="line"><span style="color:#6F42C1;">警告：gitlab-ee-16.0.0-ee.0.el7.x86_64.rpm:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">头V4</span><span style="color:#24292E;"> </span><span style="color:#032F62;">RSA/SHA1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Signature,</span><span style="color:#24292E;"> </span><span style="color:#032F62;">密钥</span><span style="color:#24292E;"> </span><span style="color:#032F62;">ID</span><span style="color:#24292E;"> </span><span style="color:#032F62;">f27eab47:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">NOKEY</span></span>
<span class="line"><span style="color:#6F42C1;">准备中...</span><span style="color:#24292E;">                          </span><span style="color:#6A737D;">################################# [100%]</span></span>
<span class="line"><span style="color:#6F42C1;">正在升级/安装...</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#6F42C1;">1:gitlab-ee-16.0.0-ee.0.el7</span><span style="color:#24292E;">        </span><span style="color:#6A737D;">################################# [100%]</span></span>
<span class="line"><span style="color:#6F42C1;">It</span><span style="color:#24292E;"> </span><span style="color:#032F62;">looks</span><span style="color:#24292E;"> </span><span style="color:#032F62;">like</span><span style="color:#24292E;"> </span><span style="color:#032F62;">GitLab</span><span style="color:#24292E;"> </span><span style="color:#032F62;">has</span><span style="color:#24292E;"> </span><span style="color:#032F62;">not</span><span style="color:#24292E;"> </span><span style="color:#032F62;">been</span><span style="color:#24292E;"> </span><span style="color:#032F62;">configured</span><span style="color:#24292E;"> </span><span style="color:#032F62;">yet</span><span style="color:#24292E;">; </span><span style="color:#6F42C1;">skipping</span><span style="color:#24292E;"> </span><span style="color:#032F62;">the</span><span style="color:#24292E;"> </span><span style="color:#032F62;">upgrade</span><span style="color:#24292E;"> </span><span style="color:#032F62;">script.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">       </span><span style="color:#6F42C1;">*.</span><span style="color:#24292E;">                  </span><span style="color:#005CC5;">*</span><span style="color:#032F62;">.</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#6F42C1;">***</span><span style="color:#24292E;">                 </span><span style="color:#005CC5;">***</span></span>
<span class="line"><span style="color:#24292E;">     </span><span style="color:#6F42C1;">*****</span><span style="color:#24292E;">               </span><span style="color:#005CC5;">*****</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#005CC5;">.</span><span style="color:#24292E;">******             </span><span style="color:#005CC5;">*******</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">********</span><span style="color:#24292E;">            </span><span style="color:#005CC5;">********</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#6F42C1;">,,,,,,,,,***********,,,,,,,,,</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">,,,,,,,,,,,*********,,,,,,,,,,,</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#005CC5;">.</span><span style="color:#24292E;">,,,,,,,,,,,*******,,,,,,,,,,,,</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#6F42C1;">,,,,,,,,,*****,,,,,,,,,.</span></span>
<span class="line"><span style="color:#24292E;">         </span><span style="color:#6F42C1;">,,,,,,,****,,,,,,</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#005CC5;">.</span><span style="color:#24292E;">,,,***,,,,</span></span>
<span class="line"><span style="color:#24292E;">                </span><span style="color:#6F42C1;">,*,.</span></span>
<span class="line"><span style="color:#24292E;">  </span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">     </span><span style="color:#6F42C1;">_______</span><span style="color:#24292E;"> </span><span style="color:#032F62;">__</span><span style="color:#24292E;">  </span><span style="color:#032F62;">__</span><span style="color:#24292E;">          </span><span style="color:#032F62;">__</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">/</span><span style="color:#24292E;"> </span><span style="color:#032F62;">____</span><span style="color:#24292E;">(</span><span style="color:#6F42C1;">_</span><span style="color:#24292E;">) </span><span style="color:#032F62;">/_/</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/</span><span style="color:#24292E;">   </span><span style="color:#032F62;">____</span><span style="color:#24292E;"> </span><span style="color:#032F62;">_/</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/_</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#6F42C1;">/</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/</span><span style="color:#24292E;"> </span><span style="color:#032F62;">__/</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/</span><span style="color:#24292E;"> </span><span style="color:#032F62;">__/</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/</span><span style="color:#24292E;">   </span><span style="color:#032F62;">/</span><span style="color:#24292E;"> </span><span style="color:#032F62;">__</span><span style="color:#24292E;"> </span><span style="color:#032F62;">\`</span><span style="color:#6F42C1;">/</span><span style="color:#032F62;"> __ </span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#032F62;">  / /_/ / / /_/ /___/ /_/ / /_/ /</span></span>
<span class="line"><span style="color:#032F62;">  </span><span style="color:#6F42C1;">\\____/_/\\__/_____/\\__,_/_.___/</span></span>
<span class="line"><span style="color:#032F62;">  </span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">Thank</span><span style="color:#032F62;"> you for installing GitLab!</span></span>
<span class="line"><span style="color:#6F42C1;">GitLab</span><span style="color:#032F62;"> was unable to detect a valid hostname for your instance.</span></span>
<span class="line"><span style="color:#6F42C1;">Please</span><span style="color:#032F62;"> configure a URL for your GitLab instance by setting \`</span><span style="color:#6F42C1;">external_url</span><span style="color:#032F62;">\`</span></span>
<span class="line"><span style="color:#6F42C1;">configuration</span><span style="color:#032F62;"> in /etc/gitlab/gitlab.rb file.</span></span>
<span class="line"><span style="color:#6F42C1;">Then,</span><span style="color:#032F62;"> you can start your GitLab instance by running the following command:</span></span>
<span class="line"><span style="color:#032F62;">  </span><span style="color:#6F42C1;">sudo</span><span style="color:#032F62;"> gitlab-ctl reconfigure</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">For</span><span style="color:#032F62;"> a comprehensive list of configuration options please see the Omnibus GitLab readme</span></span>
<span class="line"><span style="color:#6F42C1;">https://gitlab.com/gitlab-org/omnibus-gitlab/blob/master/README.md</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">Help</span><span style="color:#032F62;"> us improve the installation experience, let us know how we did with a </span><span style="color:#005CC5;">1</span><span style="color:#032F62;"> minute survey:</span></span>
<span class="line"><span style="color:#6F42C1;">https://gitlab.fra1.qualtrics.com/jfe/form/SV_6kVqZANThUQ1bZb?installation</span><span style="color:#032F62;">=omnibus&amp;</span><span style="color:#24292E;">release</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">16</span><span style="color:#032F62;">-0</span></span></code></pre></div><ul><li>修改配置</li></ul><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">vim /etc/gitlab/gitlab.rb</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">vim /etc/gitlab/gitlab.rb</span></span></code></pre></div><ul><li>初始化</li></ul><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">gitlab-ctl reconfigure</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">gitlab-ctl reconfigure</span></span></code></pre></div><ul><li>查密码</li></ul><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">cat /etc/gitlab/initial_root_password</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">cat /etc/gitlab/initial_root_password</span></span></code></pre></div><ul><li>访问</li></ul><p><a href="http://ip" target="_blank" rel="noreferrer">http://ip</a></p><p><img src="https://nnaigos.oss-cn-hangzhou.aliyuncs.com/imgs/202404081358406.jpg" alt=""></p><h1 id="_3-破解" tabindex="-1">3.破解 <a class="header-anchor" href="#_3-破解" aria-label="Permalink to &quot;3.破解&quot;">​</a></h1><h2 id="_3-1安装ruby" tabindex="-1">3.1安装ruby <a class="header-anchor" href="#_3-1安装ruby" aria-label="Permalink to &quot;3.1安装ruby&quot;">​</a></h2><h3 id="_3-1-0安装" tabindex="-1">3.1.0安装 <a class="header-anchor" href="#_3-1-0安装" aria-label="Permalink to &quot;3.1.0安装&quot;">​</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">yum</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">install</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">centos-release-scl-rh　　　　#</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">会在/etc/yum.repos.d/目录下多出一个CentOS-SCLo-scl-rh.repo源</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">yum</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">install</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-y</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">rh-ruby27</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">　　#</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">直接yum安装即可　　</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">scl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">enable</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">rh-ruby27</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">bash</span><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;"># 启用哪个版本</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">yum</span><span style="color:#24292E;"> </span><span style="color:#032F62;">install</span><span style="color:#24292E;"> </span><span style="color:#032F62;">centos-release-scl-rh　　　　#</span><span style="color:#24292E;"> </span><span style="color:#032F62;">会在/etc/yum.repos.d/目录下多出一个CentOS-SCLo-scl-rh.repo源</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">yum</span><span style="color:#24292E;"> </span><span style="color:#032F62;">install</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-y</span><span style="color:#24292E;"> </span><span style="color:#032F62;">rh-ruby27</span><span style="color:#24292E;"> </span><span style="color:#032F62;">　　#</span><span style="color:#24292E;"> </span><span style="color:#032F62;">直接yum安装即可　　</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">scl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">enable</span><span style="color:#24292E;"> </span><span style="color:#032F62;">rh-ruby27</span><span style="color:#24292E;"> </span><span style="color:#032F62;">bash</span><span style="color:#24292E;">    </span><span style="color:#6A737D;"># 启用哪个版本</span></span></code></pre></div><h3 id="_3-1-1查看版本" tabindex="-1">3.1.1查看版本 <a class="header-anchor" href="#_3-1-1查看版本" aria-label="Permalink to &quot;3.1.1查看版本&quot;">​</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">[root@k8s-master01 gitlab]# ruby -v</span></span>
<span class="line"><span style="color:#B392F0;">ruby</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2.7</span><span style="color:#9ECBFF;">.4p191</span><span style="color:#E1E4E8;"> (2021-07-07 </span><span style="color:#9ECBFF;">revision</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">a21a3b7d23</span><span style="color:#E1E4E8;">) [x86_64-linux]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">[root@k8s-master01 gitlab]# gem -v </span></span>
<span class="line"><span style="color:#B392F0;">3.1.6</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">[root@k8s-master01 gitlab]# ruby -v</span></span>
<span class="line"><span style="color:#6F42C1;">ruby</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2.7</span><span style="color:#032F62;">.4p191</span><span style="color:#24292E;"> (2021-07-07 </span><span style="color:#032F62;">revision</span><span style="color:#24292E;"> </span><span style="color:#032F62;">a21a3b7d23</span><span style="color:#24292E;">) [x86_64-linux]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">[root@k8s-master01 gitlab]# gem -v </span></span>
<span class="line"><span style="color:#6F42C1;">3.1.6</span></span></code></pre></div><h3 id="_3-1-2安装gitlab-license" tabindex="-1">3.1.2安装gitlab-license <a class="header-anchor" href="#_3-1-2安装gitlab-license" aria-label="Permalink to &quot;3.1.2安装gitlab-license&quot;">​</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">[root@k8s-master01 gitlab]# gem install gitlab-license</span></span>
<span class="line"><span style="color:#B392F0;">Fetching</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">gitlab-license-2.2.2.gem</span></span>
<span class="line"><span style="color:#B392F0;">Successfully</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">installed</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">gitlab-license-2.2.2</span></span>
<span class="line"><span style="color:#B392F0;">Parsing</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">documentation</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">for</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">gitlab-license-2.2.2</span></span>
<span class="line"><span style="color:#B392F0;">Installing</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">ri</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">documentation</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">for</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">gitlab-license-2.2.2</span></span>
<span class="line"><span style="color:#B392F0;">Done</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">installing</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">documentation</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">for</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">gitlab-license</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">after</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">seconds</span></span>
<span class="line"><span style="color:#B392F0;">1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">gem</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">installed</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">[root@k8s-master01 gitlab]# gem install gitlab-license</span></span>
<span class="line"><span style="color:#6F42C1;">Fetching</span><span style="color:#24292E;"> </span><span style="color:#032F62;">gitlab-license-2.2.2.gem</span></span>
<span class="line"><span style="color:#6F42C1;">Successfully</span><span style="color:#24292E;"> </span><span style="color:#032F62;">installed</span><span style="color:#24292E;"> </span><span style="color:#032F62;">gitlab-license-2.2.2</span></span>
<span class="line"><span style="color:#6F42C1;">Parsing</span><span style="color:#24292E;"> </span><span style="color:#032F62;">documentation</span><span style="color:#24292E;"> </span><span style="color:#032F62;">for</span><span style="color:#24292E;"> </span><span style="color:#032F62;">gitlab-license-2.2.2</span></span>
<span class="line"><span style="color:#6F42C1;">Installing</span><span style="color:#24292E;"> </span><span style="color:#032F62;">ri</span><span style="color:#24292E;"> </span><span style="color:#032F62;">documentation</span><span style="color:#24292E;"> </span><span style="color:#032F62;">for</span><span style="color:#24292E;"> </span><span style="color:#032F62;">gitlab-license-2.2.2</span></span>
<span class="line"><span style="color:#6F42C1;">Done</span><span style="color:#24292E;"> </span><span style="color:#032F62;">installing</span><span style="color:#24292E;"> </span><span style="color:#032F62;">documentation</span><span style="color:#24292E;"> </span><span style="color:#032F62;">for</span><span style="color:#24292E;"> </span><span style="color:#032F62;">gitlab-license</span><span style="color:#24292E;"> </span><span style="color:#032F62;">after</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0</span><span style="color:#24292E;"> </span><span style="color:#032F62;">seconds</span></span>
<span class="line"><span style="color:#6F42C1;">1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">gem</span><span style="color:#24292E;"> </span><span style="color:#032F62;">installed</span></span></code></pre></div><ul><li>创建license文件</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#79B8FF;">cd</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/var/opt/gitlab/backups</span></span>
<span class="line"><span style="color:#B392F0;">touch</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">license.rb</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#005CC5;">cd</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/var/opt/gitlab/backups</span></span>
<span class="line"><span style="color:#6F42C1;">touch</span><span style="color:#24292E;"> </span><span style="color:#032F62;">license.rb</span></span></code></pre></div><ul><li>vi license.rb</li></ul><div class="language-ruby vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ruby</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">require</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;openssl&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">require</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;gitlab/license&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">    key_pair </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">OpenSSL</span><span style="color:#E1E4E8;">::</span><span style="color:#79B8FF;">PKey</span><span style="color:#E1E4E8;">::</span><span style="color:#79B8FF;">RSA</span><span style="color:#E1E4E8;">.generate(</span><span style="color:#79B8FF;">2048</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#79B8FF;">File</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">open</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;license_key&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&quot;w&quot;</span><span style="color:#E1E4E8;">) { |f| f.write(key_pair.to_pem) }</span></span>
<span class="line"><span style="color:#E1E4E8;">    public_key </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> key_pair.public_key</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#79B8FF;">File</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">open</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;license_key.pub&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&quot;w&quot;</span><span style="color:#E1E4E8;">) { |f| f.write(public_key.to_pem) }</span></span>
<span class="line"><span style="color:#E1E4E8;">    private_key </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">OpenSSL</span><span style="color:#E1E4E8;">::</span><span style="color:#79B8FF;">PKey</span><span style="color:#E1E4E8;">::</span><span style="color:#79B8FF;">RSA</span><span style="color:#E1E4E8;">.</span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">File</span><span style="color:#E1E4E8;">.read(</span><span style="color:#9ECBFF;">&quot;license_key&quot;</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#79B8FF;">Gitlab</span><span style="color:#E1E4E8;">::</span><span style="color:#79B8FF;">License</span><span style="color:#E1E4E8;">.encryption_key </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> private_key</span></span>
<span class="line"><span style="color:#E1E4E8;">    license </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">Gitlab</span><span style="color:#E1E4E8;">::</span><span style="color:#79B8FF;">License</span><span style="color:#E1E4E8;">.</span><span style="color:#F97583;">new</span></span>
<span class="line"><span style="color:#E1E4E8;">    license.licensee </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">&quot;Name&quot;</span><span style="color:#E1E4E8;"> =&gt; </span><span style="color:#9ECBFF;">&quot;none&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">&quot;Company&quot;</span><span style="color:#E1E4E8;"> =&gt; </span><span style="color:#9ECBFF;">&quot;none&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">&quot;Email&quot;</span><span style="color:#E1E4E8;"> =&gt; </span><span style="color:#9ECBFF;">&quot;example@test.com&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">    license.starts_at </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">Date</span><span style="color:#E1E4E8;">.</span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">2021</span><span style="color:#E1E4E8;">, </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">, </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">) </span><span style="color:#6A737D;"># 开始时间</span></span>
<span class="line"><span style="color:#E1E4E8;">    license.expires_at </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">Date</span><span style="color:#E1E4E8;">.</span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">2050</span><span style="color:#E1E4E8;">, </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">, </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">) </span><span style="color:#6A737D;"># 结束时间</span></span>
<span class="line"><span style="color:#E1E4E8;">    license.notify_admins_at </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">Date</span><span style="color:#E1E4E8;">.</span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">2049</span><span style="color:#E1E4E8;">, </span><span style="color:#79B8FF;">12</span><span style="color:#E1E4E8;">, </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">    license.notify_users_at </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">Date</span><span style="color:#E1E4E8;">.</span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">2049</span><span style="color:#E1E4E8;">, </span><span style="color:#79B8FF;">12</span><span style="color:#E1E4E8;">, </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">    license.block_changes_at </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">Date</span><span style="color:#E1E4E8;">.</span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">2050</span><span style="color:#E1E4E8;">, </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">, </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">    license.restrictions </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#79B8FF;">active_user_count:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">10000</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#79B8FF;">puts</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;License:&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#79B8FF;">puts</span><span style="color:#E1E4E8;"> license</span></span>
<span class="line"><span style="color:#E1E4E8;">    data </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> license.export</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#79B8FF;">puts</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;Exported license:&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#79B8FF;">puts</span><span style="color:#E1E4E8;"> data</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#79B8FF;">File</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">open</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;GitLabBV.gitlab-license&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&quot;w&quot;</span><span style="color:#E1E4E8;">) { |f| f.write(data) }</span></span>
<span class="line"><span style="color:#E1E4E8;">    public_key </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">OpenSSL</span><span style="color:#E1E4E8;">::</span><span style="color:#79B8FF;">PKey</span><span style="color:#E1E4E8;">::</span><span style="color:#79B8FF;">RSA</span><span style="color:#E1E4E8;">.</span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">File</span><span style="color:#E1E4E8;">.read(</span><span style="color:#9ECBFF;">&quot;license_key.pub&quot;</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#79B8FF;">Gitlab</span><span style="color:#E1E4E8;">::</span><span style="color:#79B8FF;">License</span><span style="color:#E1E4E8;">.encryption_key </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> public_key</span></span>
<span class="line"><span style="color:#E1E4E8;">    data </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">File</span><span style="color:#E1E4E8;">.read(</span><span style="color:#9ECBFF;">&quot;GitLabBV.gitlab-license&quot;</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">    $license </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">Gitlab</span><span style="color:#E1E4E8;">::</span><span style="color:#79B8FF;">License</span><span style="color:#E1E4E8;">.import(data)</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#79B8FF;">puts</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;Imported license:&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#79B8FF;">puts</span><span style="color:#E1E4E8;"> $license</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">unless</span><span style="color:#E1E4E8;"> $license</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">raise</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;The license is invalid.&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">end</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> $license.restricted?(</span><span style="color:#79B8FF;">:active_user_count</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">    active_user_count </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">10000</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> active_user_count </span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;"> $license.restrictions[</span><span style="color:#79B8FF;">:active_user_count</span><span style="color:#E1E4E8;">]</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">raise</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;The active user count exceeds the allowed amount!&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">end</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">end</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> $license.notify_admins?</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#79B8FF;">puts</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;The license is due to expire on </span><span style="color:#9ECBFF;">#{</span><span style="color:#E1E4E8;">$license</span><span style="color:#9ECBFF;">.expires_at}</span><span style="color:#9ECBFF;">.&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">end</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> $license.notify_users?</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#79B8FF;">puts</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;The license is due to expire on </span><span style="color:#9ECBFF;">#{</span><span style="color:#E1E4E8;">$license</span><span style="color:#9ECBFF;">.expires_at}</span><span style="color:#9ECBFF;">.&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">end</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">module</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Gitlab</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">class</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">GitAccess</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">def</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">check</span><span style="color:#E1E4E8;">(cmd, changes </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">nil</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> $license.block_changes?</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> build_status_object(</span><span style="color:#79B8FF;">false</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&quot;License expired&quot;</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">end</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">end</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">end</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">end</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#79B8FF;">puts</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;This instance of GitLab Enterprise Edition is licensed to:&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">    $license.licensee.each </span><span style="color:#F97583;">do</span><span style="color:#E1E4E8;"> |key, value|</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#79B8FF;">puts</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;</span><span style="color:#9ECBFF;">#{key}</span><span style="color:#9ECBFF;">: </span><span style="color:#9ECBFF;">#{value}</span><span style="color:#9ECBFF;">&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">end</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> $license.expired?</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#79B8FF;">puts</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;The license expired on </span><span style="color:#9ECBFF;">#{</span><span style="color:#E1E4E8;">$license</span><span style="color:#9ECBFF;">.expires_at}</span><span style="color:#9ECBFF;">&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">elsif</span><span style="color:#E1E4E8;"> $license.will_expire?</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#79B8FF;">puts</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;The license will expire on </span><span style="color:#9ECBFF;">#{</span><span style="color:#E1E4E8;">$license</span><span style="color:#9ECBFF;">.expires_at}</span><span style="color:#9ECBFF;">&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">else</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#79B8FF;">puts</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;The license will never expire.&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">end</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">require</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;openssl&quot;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">require</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;gitlab/license&quot;</span></span>
<span class="line"><span style="color:#24292E;">    key_pair </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">OpenSSL</span><span style="color:#24292E;">::</span><span style="color:#005CC5;">PKey</span><span style="color:#24292E;">::</span><span style="color:#005CC5;">RSA</span><span style="color:#24292E;">.generate(</span><span style="color:#005CC5;">2048</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#005CC5;">File</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">open</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;license_key&quot;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;w&quot;</span><span style="color:#24292E;">) { |f| f.write(key_pair.to_pem) }</span></span>
<span class="line"><span style="color:#24292E;">    public_key </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> key_pair.public_key</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#005CC5;">File</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">open</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;license_key.pub&quot;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;w&quot;</span><span style="color:#24292E;">) { |f| f.write(public_key.to_pem) }</span></span>
<span class="line"><span style="color:#24292E;">    private_key </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">OpenSSL</span><span style="color:#24292E;">::</span><span style="color:#005CC5;">PKey</span><span style="color:#24292E;">::</span><span style="color:#005CC5;">RSA</span><span style="color:#24292E;">.</span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">File</span><span style="color:#24292E;">.read(</span><span style="color:#032F62;">&quot;license_key&quot;</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#005CC5;">Gitlab</span><span style="color:#24292E;">::</span><span style="color:#005CC5;">License</span><span style="color:#24292E;">.encryption_key </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> private_key</span></span>
<span class="line"><span style="color:#24292E;">    license </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">Gitlab</span><span style="color:#24292E;">::</span><span style="color:#005CC5;">License</span><span style="color:#24292E;">.</span><span style="color:#D73A49;">new</span></span>
<span class="line"><span style="color:#24292E;">    license.licensee </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#032F62;">&quot;Name&quot;</span><span style="color:#24292E;"> =&gt; </span><span style="color:#032F62;">&quot;none&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#032F62;">&quot;Company&quot;</span><span style="color:#24292E;"> =&gt; </span><span style="color:#032F62;">&quot;none&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#032F62;">&quot;Email&quot;</span><span style="color:#24292E;"> =&gt; </span><span style="color:#032F62;">&quot;example@test.com&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"><span style="color:#24292E;">    license.starts_at </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">Date</span><span style="color:#24292E;">.</span><span style="color:#D73A49;">new</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">2021</span><span style="color:#24292E;">, </span><span style="color:#005CC5;">1</span><span style="color:#24292E;">, </span><span style="color:#005CC5;">1</span><span style="color:#24292E;">) </span><span style="color:#6A737D;"># 开始时间</span></span>
<span class="line"><span style="color:#24292E;">    license.expires_at </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">Date</span><span style="color:#24292E;">.</span><span style="color:#D73A49;">new</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">2050</span><span style="color:#24292E;">, </span><span style="color:#005CC5;">1</span><span style="color:#24292E;">, </span><span style="color:#005CC5;">1</span><span style="color:#24292E;">) </span><span style="color:#6A737D;"># 结束时间</span></span>
<span class="line"><span style="color:#24292E;">    license.notify_admins_at </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">Date</span><span style="color:#24292E;">.</span><span style="color:#D73A49;">new</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">2049</span><span style="color:#24292E;">, </span><span style="color:#005CC5;">12</span><span style="color:#24292E;">, </span><span style="color:#005CC5;">1</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">    license.notify_users_at </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">Date</span><span style="color:#24292E;">.</span><span style="color:#D73A49;">new</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">2049</span><span style="color:#24292E;">, </span><span style="color:#005CC5;">12</span><span style="color:#24292E;">, </span><span style="color:#005CC5;">1</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">    license.block_changes_at </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">Date</span><span style="color:#24292E;">.</span><span style="color:#D73A49;">new</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">2050</span><span style="color:#24292E;">, </span><span style="color:#005CC5;">1</span><span style="color:#24292E;">, </span><span style="color:#005CC5;">1</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">    license.restrictions </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#005CC5;">active_user_count:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">10000</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#005CC5;">puts</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;License:&quot;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#005CC5;">puts</span><span style="color:#24292E;"> license</span></span>
<span class="line"><span style="color:#24292E;">    data </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> license.export</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#005CC5;">puts</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;Exported license:&quot;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#005CC5;">puts</span><span style="color:#24292E;"> data</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#005CC5;">File</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">open</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;GitLabBV.gitlab-license&quot;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;w&quot;</span><span style="color:#24292E;">) { |f| f.write(data) }</span></span>
<span class="line"><span style="color:#24292E;">    public_key </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">OpenSSL</span><span style="color:#24292E;">::</span><span style="color:#005CC5;">PKey</span><span style="color:#24292E;">::</span><span style="color:#005CC5;">RSA</span><span style="color:#24292E;">.</span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">File</span><span style="color:#24292E;">.read(</span><span style="color:#032F62;">&quot;license_key.pub&quot;</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#005CC5;">Gitlab</span><span style="color:#24292E;">::</span><span style="color:#005CC5;">License</span><span style="color:#24292E;">.encryption_key </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> public_key</span></span>
<span class="line"><span style="color:#24292E;">    data </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">File</span><span style="color:#24292E;">.read(</span><span style="color:#032F62;">&quot;GitLabBV.gitlab-license&quot;</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">    $license </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">Gitlab</span><span style="color:#24292E;">::</span><span style="color:#005CC5;">License</span><span style="color:#24292E;">.import(data)</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#005CC5;">puts</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;Imported license:&quot;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#005CC5;">puts</span><span style="color:#24292E;"> $license</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">unless</span><span style="color:#24292E;"> $license</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">raise</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;The license is invalid.&quot;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">end</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> $license.restricted?(</span><span style="color:#005CC5;">:active_user_count</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">    active_user_count </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">10000</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> active_user_count </span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;"> $license.restrictions[</span><span style="color:#005CC5;">:active_user_count</span><span style="color:#24292E;">]</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">raise</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;The active user count exceeds the allowed amount!&quot;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">end</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">end</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> $license.notify_admins?</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#005CC5;">puts</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;The license is due to expire on </span><span style="color:#032F62;">#{</span><span style="color:#24292E;">$license</span><span style="color:#032F62;">.expires_at}</span><span style="color:#032F62;">.&quot;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">end</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> $license.notify_users?</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#005CC5;">puts</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;The license is due to expire on </span><span style="color:#032F62;">#{</span><span style="color:#24292E;">$license</span><span style="color:#032F62;">.expires_at}</span><span style="color:#032F62;">.&quot;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">end</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">module</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Gitlab</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">class</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">GitAccess</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">def</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">check</span><span style="color:#24292E;">(cmd, changes </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">nil</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> $license.block_changes?</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> build_status_object(</span><span style="color:#005CC5;">false</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;License expired&quot;</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">end</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">end</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">end</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">end</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#005CC5;">puts</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;This instance of GitLab Enterprise Edition is licensed to:&quot;</span></span>
<span class="line"><span style="color:#24292E;">    $license.licensee.each </span><span style="color:#D73A49;">do</span><span style="color:#24292E;"> |key, value|</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#005CC5;">puts</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;</span><span style="color:#032F62;">#{key}</span><span style="color:#032F62;">: </span><span style="color:#032F62;">#{value}</span><span style="color:#032F62;">&quot;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">end</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> $license.expired?</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#005CC5;">puts</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;The license expired on </span><span style="color:#032F62;">#{</span><span style="color:#24292E;">$license</span><span style="color:#032F62;">.expires_at}</span><span style="color:#032F62;">&quot;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">elsif</span><span style="color:#24292E;"> $license.will_expire?</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#005CC5;">puts</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;The license will expire on </span><span style="color:#032F62;">#{</span><span style="color:#24292E;">$license</span><span style="color:#032F62;">.expires_at}</span><span style="color:#032F62;">&quot;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">else</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#005CC5;">puts</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;The license will never expire.&quot;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">end</span></span></code></pre></div><ul><li>生成文件</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">#生成 GitLabBV.gitlab-license license_key license_key.pub 这三个文件</span></span>
<span class="line"></span>
<span class="line"><span style="color:#79B8FF;">cd</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/var/opt/gitlab/backups</span></span>
<span class="line"><span style="color:#B392F0;">ruby</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">license.rb</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">License:</span></span>
<span class="line"><span style="color:#6A737D;">#&lt;Gitlab::License:0x0000000001f4dac0&gt;</span></span>
<span class="line"><span style="color:#B392F0;">Exported</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">license:</span></span>
<span class="line"><span style="color:#B392F0;">eyJkYXRhIjoib0I1YjgzUXMzY0s4VDBMNndrNXJ2Y1JnQ0o3VzNIMkxsWFlp</span></span>
<span class="line"><span style="color:#B392F0;">Ri9sUTNuakI0bGpBSVJhc21XUjQ2dy81XG5JTCtDVlBKQnM3Q01sai81Z2lm</span></span>
<span class="line"><span style="color:#B392F0;">cnplcHJUZkxKd1JGUFM1NHlxeUFzeHdoajNGbFlnSEdTa1ZoME1jQ1Bcbkl5</span></span>
<span class="line"><span style="color:#B392F0;">bkcxMTVPbUplMzNnc3R6NDN6amNaUjlsa0tjR3ZGN1hKSWd3Q1ZBNTFjcHdw</span></span>
<span class="line"><span style="color:#B392F0;">dG81MkpTK2RWMkREcFxuN3NWc1Iydk5vQnpYT05Yc05vVjZwamd6c25IQUVX</span></span>
<span class="line"><span style="color:#B392F0;">RXpKejJlNFdyU09scUNQaGJuRDdqYjFVQWQzVjhoXG5BVXN1ek9rT2xqTHZX</span></span>
<span class="line"><span style="color:#B392F0;">U3E0MklOcFRxVWJ1NHdQUEl3M1d6N011d0FsQkpNb2drcnRtWk5NeUEyVUVi</span></span>
<span class="line"><span style="color:#B392F0;">T25cbkZKemhDZkJrdllQTU9xT1VWUDdWWnJoczlCTGpTNmhCRXZzbnM5UzFD</span></span>
<span class="line"><span style="color:#B392F0;">TFhHb1FJRjkwVzFLdG5La09ZbVxuTitUYTFLbGVkdFROMTVGczFRTjV5L3B5</span></span>
<span class="line"><span style="color:#B392F0;">UnJRZUlwK0JNTklWOC9ZQWhoSmkrb2JObVdMT29EVTYwbjhBXG5LcEpMekZL</span></span>
<span class="line"><span style="color:#B392F0;">VVBHR0UrYmlIV1NuWm5TYjloOWY5aTJBdk1ueVRYWE14WFI5bExjd1lPa3RD</span></span>
<span class="line"><span style="color:#B392F0;">b0ljRC9PdVpcbllBdzBRQ3BJNXJNbm5VZFZISmh1bGJmQ3A4amNNMEdiN2JX</span></span>
<span class="line"><span style="color:#B392F0;">MG5EMEI5K1UzVDlZYlNvL2RRVmNpeDJIY1xuK0xBNnhBMDF0VGlSUnNzL2Rp</span></span>
<span class="line"><span style="color:#B392F0;">RWppM3BWSHZCejhTcFhxSm53UnNlWlVOM0dWZndIUkt5VkgvNDN3Sk56XG5s</span></span>
<span class="line"><span style="color:#B392F0;">RGU5bDU2bis5R2hFaXVpWTl0UjloSGVzTWE0UlFiLytJUGVMcnJKT1B4ZXJp</span></span>
<span class="line"><span style="color:#B392F0;">SDFiOWJiWUx1Z2hRdEZcblJRPT1cbiIsImtleSI6IkQ5NURWWHdLUWR5K1JP</span></span>
<span class="line"><span style="color:#B392F0;">Qm5FNnByVndzbFQ4cDNWUmNVd1ZzdnVtWm5Ub09mTUdPUTFNSkNuTy9vRHpj</span></span>
<span class="line"><span style="color:#B392F0;">d1xuN0Jid3p5WFg2S2RtNE8xZGlIZzdZVWJqL1ZxMjFHZkl6OEU2VVU1ZVZw</span></span>
<span class="line"><span style="color:#B392F0;">dVBEbXA1SHp4RG1mUkxCUllDXG5BQ1lKZDY0NDV6RG1lN3ZlV1BqYVFvNTg5</span></span>
<span class="line"><span style="color:#B392F0;">T3JqakcxU3ZxVEJhNmhWRWFWUDM1YnNZUUtmcEFCVWdmTThcbk1YZS82VkF4</span></span>
<span class="line"><span style="color:#B392F0;">a1FrcEY5M2pxa3E4MkxzTERSYzY4YzNCbDN1MGRUamg2WDJJV3BmaHZqUE9p</span></span>
<span class="line"><span style="color:#B392F0;">Y0lrL2JhQlxuK3pxZFNURUxoUjRwMWs3aHVKb0o0V2ZVS1hpbzgxL2RuQUxi</span></span>
<span class="line"><span style="color:#B392F0;">a3JRaXRnN3dCSnZTZHhEQ1NvM0RlQVd2XG5XZ1dMS2FXZldMSTFWaTM1Qk4x</span></span>
<span class="line"><span style="color:#B392F0;">b1ljckhOTm0yc2FjaWh2bnhBeG5nbHc9PVxuIiwiaXYiOiJNWWduRER4WXJZ</span></span>
<span class="line"><span style="color:#B392F0;">QWY3NXMzSjRENTVRPT1cbiJ9</span></span>
<span class="line"><span style="color:#B392F0;">Imported</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">license:</span></span>
<span class="line"><span style="color:#6A737D;">#&lt;Gitlab::License:0x0000000002243ab8&gt;</span></span>
<span class="line"><span style="color:#B392F0;">This</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">instance</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">of</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">GitLab</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Enterprise</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Edition</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">is</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">licensed</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">to:</span></span>
<span class="line"><span style="color:#B392F0;">Name:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">none</span></span>
<span class="line"><span style="color:#B392F0;">Company:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">none</span></span>
<span class="line"><span style="color:#B392F0;">Email:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">example@test.com</span></span>
<span class="line"><span style="color:#B392F0;">The</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">license</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">will</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">expire</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">on</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2050</span><span style="color:#9ECBFF;">-01-01</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#生成三个文件</span></span>
<span class="line"><span style="color:#E1E4E8;">[root@k8s-master01 backups]# ll</span></span>
<span class="line"><span style="color:#B392F0;">总用量</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">16</span></span>
<span class="line"><span style="color:#B392F0;">-rw-r--r--</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">root</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">root</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">1489</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5</span><span style="color:#9ECBFF;">月</span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">29</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">15</span><span style="color:#9ECBFF;">:06</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">GitLabBV.gitlab-license</span></span>
<span class="line"><span style="color:#B392F0;">-rw-r--r--</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">root</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">root</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">1675</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5</span><span style="color:#9ECBFF;">月</span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">29</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">15</span><span style="color:#9ECBFF;">:06</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">license_key</span></span>
<span class="line"><span style="color:#B392F0;">-rw-r--r--</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">root</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">root</span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">451</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5</span><span style="color:#9ECBFF;">月</span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">29</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">15</span><span style="color:#9ECBFF;">:06</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">license_key.pub</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">#生成 GitLabBV.gitlab-license license_key license_key.pub 这三个文件</span></span>
<span class="line"></span>
<span class="line"><span style="color:#005CC5;">cd</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/var/opt/gitlab/backups</span></span>
<span class="line"><span style="color:#6F42C1;">ruby</span><span style="color:#24292E;"> </span><span style="color:#032F62;">license.rb</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">License:</span></span>
<span class="line"><span style="color:#6A737D;">#&lt;Gitlab::License:0x0000000001f4dac0&gt;</span></span>
<span class="line"><span style="color:#6F42C1;">Exported</span><span style="color:#24292E;"> </span><span style="color:#032F62;">license:</span></span>
<span class="line"><span style="color:#6F42C1;">eyJkYXRhIjoib0I1YjgzUXMzY0s4VDBMNndrNXJ2Y1JnQ0o3VzNIMkxsWFlp</span></span>
<span class="line"><span style="color:#6F42C1;">Ri9sUTNuakI0bGpBSVJhc21XUjQ2dy81XG5JTCtDVlBKQnM3Q01sai81Z2lm</span></span>
<span class="line"><span style="color:#6F42C1;">cnplcHJUZkxKd1JGUFM1NHlxeUFzeHdoajNGbFlnSEdTa1ZoME1jQ1Bcbkl5</span></span>
<span class="line"><span style="color:#6F42C1;">bkcxMTVPbUplMzNnc3R6NDN6amNaUjlsa0tjR3ZGN1hKSWd3Q1ZBNTFjcHdw</span></span>
<span class="line"><span style="color:#6F42C1;">dG81MkpTK2RWMkREcFxuN3NWc1Iydk5vQnpYT05Yc05vVjZwamd6c25IQUVX</span></span>
<span class="line"><span style="color:#6F42C1;">RXpKejJlNFdyU09scUNQaGJuRDdqYjFVQWQzVjhoXG5BVXN1ek9rT2xqTHZX</span></span>
<span class="line"><span style="color:#6F42C1;">U3E0MklOcFRxVWJ1NHdQUEl3M1d6N011d0FsQkpNb2drcnRtWk5NeUEyVUVi</span></span>
<span class="line"><span style="color:#6F42C1;">T25cbkZKemhDZkJrdllQTU9xT1VWUDdWWnJoczlCTGpTNmhCRXZzbnM5UzFD</span></span>
<span class="line"><span style="color:#6F42C1;">TFhHb1FJRjkwVzFLdG5La09ZbVxuTitUYTFLbGVkdFROMTVGczFRTjV5L3B5</span></span>
<span class="line"><span style="color:#6F42C1;">UnJRZUlwK0JNTklWOC9ZQWhoSmkrb2JObVdMT29EVTYwbjhBXG5LcEpMekZL</span></span>
<span class="line"><span style="color:#6F42C1;">VVBHR0UrYmlIV1NuWm5TYjloOWY5aTJBdk1ueVRYWE14WFI5bExjd1lPa3RD</span></span>
<span class="line"><span style="color:#6F42C1;">b0ljRC9PdVpcbllBdzBRQ3BJNXJNbm5VZFZISmh1bGJmQ3A4amNNMEdiN2JX</span></span>
<span class="line"><span style="color:#6F42C1;">MG5EMEI5K1UzVDlZYlNvL2RRVmNpeDJIY1xuK0xBNnhBMDF0VGlSUnNzL2Rp</span></span>
<span class="line"><span style="color:#6F42C1;">RWppM3BWSHZCejhTcFhxSm53UnNlWlVOM0dWZndIUkt5VkgvNDN3Sk56XG5s</span></span>
<span class="line"><span style="color:#6F42C1;">RGU5bDU2bis5R2hFaXVpWTl0UjloSGVzTWE0UlFiLytJUGVMcnJKT1B4ZXJp</span></span>
<span class="line"><span style="color:#6F42C1;">SDFiOWJiWUx1Z2hRdEZcblJRPT1cbiIsImtleSI6IkQ5NURWWHdLUWR5K1JP</span></span>
<span class="line"><span style="color:#6F42C1;">Qm5FNnByVndzbFQ4cDNWUmNVd1ZzdnVtWm5Ub09mTUdPUTFNSkNuTy9vRHpj</span></span>
<span class="line"><span style="color:#6F42C1;">d1xuN0Jid3p5WFg2S2RtNE8xZGlIZzdZVWJqL1ZxMjFHZkl6OEU2VVU1ZVZw</span></span>
<span class="line"><span style="color:#6F42C1;">dVBEbXA1SHp4RG1mUkxCUllDXG5BQ1lKZDY0NDV6RG1lN3ZlV1BqYVFvNTg5</span></span>
<span class="line"><span style="color:#6F42C1;">T3JqakcxU3ZxVEJhNmhWRWFWUDM1YnNZUUtmcEFCVWdmTThcbk1YZS82VkF4</span></span>
<span class="line"><span style="color:#6F42C1;">a1FrcEY5M2pxa3E4MkxzTERSYzY4YzNCbDN1MGRUamg2WDJJV3BmaHZqUE9p</span></span>
<span class="line"><span style="color:#6F42C1;">Y0lrL2JhQlxuK3pxZFNURUxoUjRwMWs3aHVKb0o0V2ZVS1hpbzgxL2RuQUxi</span></span>
<span class="line"><span style="color:#6F42C1;">a3JRaXRnN3dCSnZTZHhEQ1NvM0RlQVd2XG5XZ1dMS2FXZldMSTFWaTM1Qk4x</span></span>
<span class="line"><span style="color:#6F42C1;">b1ljckhOTm0yc2FjaWh2bnhBeG5nbHc9PVxuIiwiaXYiOiJNWWduRER4WXJZ</span></span>
<span class="line"><span style="color:#6F42C1;">QWY3NXMzSjRENTVRPT1cbiJ9</span></span>
<span class="line"><span style="color:#6F42C1;">Imported</span><span style="color:#24292E;"> </span><span style="color:#032F62;">license:</span></span>
<span class="line"><span style="color:#6A737D;">#&lt;Gitlab::License:0x0000000002243ab8&gt;</span></span>
<span class="line"><span style="color:#6F42C1;">This</span><span style="color:#24292E;"> </span><span style="color:#032F62;">instance</span><span style="color:#24292E;"> </span><span style="color:#032F62;">of</span><span style="color:#24292E;"> </span><span style="color:#032F62;">GitLab</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Enterprise</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Edition</span><span style="color:#24292E;"> </span><span style="color:#032F62;">is</span><span style="color:#24292E;"> </span><span style="color:#032F62;">licensed</span><span style="color:#24292E;"> </span><span style="color:#032F62;">to:</span></span>
<span class="line"><span style="color:#6F42C1;">Name:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">none</span></span>
<span class="line"><span style="color:#6F42C1;">Company:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">none</span></span>
<span class="line"><span style="color:#6F42C1;">Email:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">example@test.com</span></span>
<span class="line"><span style="color:#6F42C1;">The</span><span style="color:#24292E;"> </span><span style="color:#032F62;">license</span><span style="color:#24292E;"> </span><span style="color:#032F62;">will</span><span style="color:#24292E;"> </span><span style="color:#032F62;">expire</span><span style="color:#24292E;"> </span><span style="color:#032F62;">on</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2050</span><span style="color:#032F62;">-01-01</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#生成三个文件</span></span>
<span class="line"><span style="color:#24292E;">[root@k8s-master01 backups]# ll</span></span>
<span class="line"><span style="color:#6F42C1;">总用量</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">16</span></span>
<span class="line"><span style="color:#6F42C1;">-rw-r--r--</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">root</span><span style="color:#24292E;"> </span><span style="color:#032F62;">root</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1489</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5</span><span style="color:#032F62;">月</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">29</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">15</span><span style="color:#032F62;">:06</span><span style="color:#24292E;"> </span><span style="color:#032F62;">GitLabBV.gitlab-license</span></span>
<span class="line"><span style="color:#6F42C1;">-rw-r--r--</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">root</span><span style="color:#24292E;"> </span><span style="color:#032F62;">root</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1675</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5</span><span style="color:#032F62;">月</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">29</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">15</span><span style="color:#032F62;">:06</span><span style="color:#24292E;"> </span><span style="color:#032F62;">license_key</span></span>
<span class="line"><span style="color:#6F42C1;">-rw-r--r--</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">root</span><span style="color:#24292E;"> </span><span style="color:#032F62;">root</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">451</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5</span><span style="color:#032F62;">月</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">29</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">15</span><span style="color:#032F62;">:06</span><span style="color:#24292E;"> </span><span style="color:#032F62;">license_key.pub</span></span></code></pre></div><ul><li>查看没有激活之前的状态</li></ul><p>菜单-&gt;管理员-&gt;订阅(<a href="http://192.168.177.130/admin/subscription" target="_blank" rel="noreferrer">http://192.168.177.130/admin/subscription</a>)</p><p><img src="https://nnaigos.oss-cn-hangzhou.aliyuncs.com/imgs/202404081358784.jpg" alt=""></p><ul><li>开始激活</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">#覆盖新的key.pub</span></span>
<span class="line"><span style="color:#B392F0;">cp</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">license_key.pub</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/opt/gitlab/embedded/service/gitlab-rails/.license_encryption_key.pub</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">#覆盖新的key.pub</span></span>
<span class="line"><span style="color:#6F42C1;">cp</span><span style="color:#24292E;"> </span><span style="color:#032F62;">license_key.pub</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/opt/gitlab/embedded/service/gitlab-rails/.license_encryption_key.pub</span></span></code></pre></div><ul><li>修改等级</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">---</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/opt/gitlab/embedded/service/gitlab-rails/ee/app/models/license.rb</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">+++</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/opt/gitlab/embedded/service/gitlab-rails/ee/app/models/license.rb</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">@@</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-367,7</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">+367,7</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">@@</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">end</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">def</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">plan</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">-</span><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">restricted_attr</span><span style="color:#E1E4E8;">(</span><span style="color:#B392F0;">:plan</span><span style="color:#E1E4E8;">)</span><span style="color:#9ECBFF;">.presence</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">||</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">STARTER_PLAN</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">+</span><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">restricted_attr</span><span style="color:#E1E4E8;">(</span><span style="color:#B392F0;">:plan</span><span style="color:#E1E4E8;">)</span><span style="color:#9ECBFF;">.presence</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">||</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">ULTIMATE_PLAN</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">end</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">def</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">edition</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">---</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/opt/gitlab/embedded/service/gitlab-rails/ee/app/models/license.rb</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">+++</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/opt/gitlab/embedded/service/gitlab-rails/ee/app/models/license.rb</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">@@</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-367,7</span><span style="color:#24292E;"> </span><span style="color:#032F62;">+367,7</span><span style="color:#24292E;"> </span><span style="color:#032F62;">@@</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">end</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">def</span><span style="color:#24292E;"> </span><span style="color:#032F62;">plan</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">-</span><span style="color:#24292E;">    </span><span style="color:#032F62;">restricted_attr</span><span style="color:#24292E;">(</span><span style="color:#6F42C1;">:plan</span><span style="color:#24292E;">)</span><span style="color:#032F62;">.presence</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">||</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">STARTER_PLAN</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">+</span><span style="color:#24292E;">    </span><span style="color:#032F62;">restricted_attr</span><span style="color:#24292E;">(</span><span style="color:#6F42C1;">:plan</span><span style="color:#24292E;">)</span><span style="color:#032F62;">.presence</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">||</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">ULTIMATE_PLAN</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">end</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">def</span><span style="color:#24292E;"> </span><span style="color:#032F62;">edition</span></span></code></pre></div><ul><li>重启gitlab服务</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">gitlab-ctl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">restart</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">gitlab-ctl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">restart</span></span></code></pre></div><ul><li>Gitlab添加许可证</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">http://$</span><span style="color:#E1E4E8;">{your_gitlab_server_address}</span><span style="color:#B392F0;">/admin/application_settings/general</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">http://$</span><span style="color:#24292E;">{your_gitlab_server_address}</span><span style="color:#6F42C1;">/admin/application_settings/general</span></span></code></pre></div><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">展开 add license</span></span>
<span class="line"><span style="color:#e1e4e8;">上传，GitLabBV.gitlab-license</span></span>
<span class="line"><span style="color:#e1e4e8;">勾选Enter license key, 填入license,</span></span>
<span class="line"><span style="color:#e1e4e8;">勾选terms of service 点击add license按钮,</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">展开 add license</span></span>
<span class="line"><span style="color:#24292e;">上传，GitLabBV.gitlab-license</span></span>
<span class="line"><span style="color:#24292e;">勾选Enter license key, 填入license,</span></span>
<span class="line"><span style="color:#24292e;">勾选terms of service 点击add license按钮,</span></span></code></pre></div><ul><li>激活成功</li></ul><p><img src="https://nnaigos.oss-cn-hangzhou.aliyuncs.com/imgs/202404081358103.jpg" alt=""></p><h2 id="_3-2-容器安装ruby环境" tabindex="-1">3.2 容器安装ruby环境 <a class="header-anchor" href="#_3-2-容器安装ruby环境" aria-label="Permalink to &quot;3.2 容器安装ruby环境&quot;">​</a></h2><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">docker</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">run</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-it</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--rm</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">ruby</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/bin/bash</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">root@d359bcd4ca50:/#</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">gem</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">install</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">gitlab-license</span></span>
<span class="line"><span style="color:#B392F0;">Fetching</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">gitlab-license-2.3.0.gem</span></span>
<span class="line"><span style="color:#B392F0;">Successfully</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">installed</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">gitlab-license-2.3.0</span></span>
<span class="line"><span style="color:#B392F0;">1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">gem</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">installed</span></span>
<span class="line"><span style="color:#B392F0;">A</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">new</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">release</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">of</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">RubyGems</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">is</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">available:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">3.4</span><span style="color:#9ECBFF;">.10</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">→</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">3.4</span><span style="color:#9ECBFF;">.22!</span></span>
<span class="line"><span style="color:#B392F0;">Run</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">\`</span><span style="color:#B392F0;">gem</span><span style="color:#9ECBFF;"> update </span><span style="color:#79B8FF;">--system</span><span style="color:#9ECBFF;"> </span><span style="color:#79B8FF;">3.4</span><span style="color:#9ECBFF;">.22\`</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">to</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">update</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">your</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">installation.</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">docker</span><span style="color:#24292E;"> </span><span style="color:#032F62;">run</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-it</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--rm</span><span style="color:#24292E;"> </span><span style="color:#032F62;">ruby</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/bin/bash</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">root@d359bcd4ca50:/#</span><span style="color:#24292E;"> </span><span style="color:#032F62;">gem</span><span style="color:#24292E;"> </span><span style="color:#032F62;">install</span><span style="color:#24292E;"> </span><span style="color:#032F62;">gitlab-license</span></span>
<span class="line"><span style="color:#6F42C1;">Fetching</span><span style="color:#24292E;"> </span><span style="color:#032F62;">gitlab-license-2.3.0.gem</span></span>
<span class="line"><span style="color:#6F42C1;">Successfully</span><span style="color:#24292E;"> </span><span style="color:#032F62;">installed</span><span style="color:#24292E;"> </span><span style="color:#032F62;">gitlab-license-2.3.0</span></span>
<span class="line"><span style="color:#6F42C1;">1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">gem</span><span style="color:#24292E;"> </span><span style="color:#032F62;">installed</span></span>
<span class="line"><span style="color:#6F42C1;">A</span><span style="color:#24292E;"> </span><span style="color:#032F62;">new</span><span style="color:#24292E;"> </span><span style="color:#032F62;">release</span><span style="color:#24292E;"> </span><span style="color:#032F62;">of</span><span style="color:#24292E;"> </span><span style="color:#032F62;">RubyGems</span><span style="color:#24292E;"> </span><span style="color:#032F62;">is</span><span style="color:#24292E;"> </span><span style="color:#032F62;">available:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">3.4</span><span style="color:#032F62;">.10</span><span style="color:#24292E;"> </span><span style="color:#032F62;">→</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">3.4</span><span style="color:#032F62;">.22!</span></span>
<span class="line"><span style="color:#6F42C1;">Run</span><span style="color:#24292E;"> </span><span style="color:#032F62;">\`</span><span style="color:#6F42C1;">gem</span><span style="color:#032F62;"> update </span><span style="color:#005CC5;">--system</span><span style="color:#032F62;"> </span><span style="color:#005CC5;">3.4</span><span style="color:#032F62;">.22\`</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">to</span><span style="color:#24292E;"> </span><span style="color:#032F62;">update</span><span style="color:#24292E;"> </span><span style="color:#032F62;">your</span><span style="color:#24292E;"> </span><span style="color:#032F62;">installation.</span></span></code></pre></div><p>之后和3.1步骤一样</p>`,48),e=[o];function c(t,r,y,E,i,F){return n(),a("div",null,e)}const u=s(p,[["render",c]]);export{d as __pageData,u as default};
