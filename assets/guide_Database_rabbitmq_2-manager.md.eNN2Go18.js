import{_ as a,o as n,c as e,R as l}from"./chunks/framework.zUbWieqp.js";const p="data:image/png;base64,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",t="/assets/rabbitmq-work-queue.DPh4GkmP.png",s="/assets/rabbitmq-fanout-exchang-1.QiDGNjbt.png",o="/assets/rabbitmq-fanout-exchange-2.xixqyow_.png",i="/assets/rabbitmq-direct-exchange-2.Yzog9ZIt.png",c="/assets/rabbitmq-topic-exchange-1.eRSDFIg7.png",r="/assets/rabbitmq-topic-exchange-2.HP9oDKa9.png",d="/assets/am1.MkoExRcQ.jpg",u="/assets/am2.J8dBHXll.jpg",b="/assets/am3.Ecm3Xopa.jpg",h="/assets/am4.eem1azd4.jpg",C=JSON.parse('{"title":"1.rabbitmqadmin","description":"","frontmatter":{},"headers":[],"relativePath":"guide/Database/rabbitmq/2-manager.md","filePath":"guide/Database/rabbitmq/2-manager.md","lastUpdated":1716287268000}'),y={name:"guide/Database/rabbitmq/2-manager.md"},m=l(`<p>文档，<a href="https://www.rabbitmq.com/docs/cli" target="_blank" rel="noreferrer">https://www.rabbitmq.com/docs/cli</a></p><h1 id="_1-rabbitmqadmin" tabindex="-1">1.rabbitmqadmin <a class="header-anchor" href="#_1-rabbitmqadmin" aria-label="Permalink to &quot;1.rabbitmqadmin&quot;">​</a></h1><h3 id="如何获取rabbitmqadmin" tabindex="-1">如何获取rabbitmqadmin <a class="header-anchor" href="#如何获取rabbitmqadmin" aria-label="Permalink to &quot;如何获取rabbitmqadmin&quot;">​</a></h3><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">cp /data/ajime/ajime_data/rabbitmq_data/mnesia/rabbit-plugins-expand/rabbitmq_management-3.6.12/priv/www/cli/rabbitmqadmin /usr/local/bin/rabbitmqadmin</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">[root@beta cli]# chmod +x /usr/local/bin/rabbitmqadmin</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">#或者</span></span>
<span class="line"><span style="color:#e1e4e8;">wget http://localhost:15672/cli/rabbitmqadmin</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">注意运行此脚本需要python2.7</span></span>
<span class="line"><span style="color:#e1e4e8;">yum install python2.7</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">[root@beta cli]# head  /usr/local/bin/rabbitmqadmin </span></span>
<span class="line"><span style="color:#e1e4e8;">#!/usr/bin/env python2</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">cp /data/ajime/ajime_data/rabbitmq_data/mnesia/rabbit-plugins-expand/rabbitmq_management-3.6.12/priv/www/cli/rabbitmqadmin /usr/local/bin/rabbitmqadmin</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">[root@beta cli]# chmod +x /usr/local/bin/rabbitmqadmin</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">#或者</span></span>
<span class="line"><span style="color:#24292e;">wget http://localhost:15672/cli/rabbitmqadmin</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">注意运行此脚本需要python2.7</span></span>
<span class="line"><span style="color:#24292e;">yum install python2.7</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">[root@beta cli]# head  /usr/local/bin/rabbitmqadmin </span></span>
<span class="line"><span style="color:#24292e;">#!/usr/bin/env python2</span></span></code></pre></div><h3 id="常用命令" tabindex="-1">常用命令 <a class="header-anchor" href="#常用命令" aria-label="Permalink to &quot;常用命令&quot;">​</a></h3><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">rabbitmqadmin list users                #查看用户列表</span></span>
<span class="line"><span style="color:#e1e4e8;">rabbitmqadmin list vhosts               #查看vhosts</span></span>
<span class="line"><span style="color:#e1e4e8;">rabbitmqadmin list connections          ###查看 connections</span></span>
<span class="line"><span style="color:#e1e4e8;">rabbitmqadmin list exchanges            ##查看 exchanges</span></span>
<span class="line"><span style="color:#e1e4e8;">rabbitmqadmin list bindings             ##查看 bindings</span></span>
<span class="line"><span style="color:#e1e4e8;">rabbitmqadmin list permissions          ##查看 permissions</span></span>
<span class="line"><span style="color:#e1e4e8;">rabbitmqadmin list channels             ##查看 channels</span></span>
<span class="line"><span style="color:#e1e4e8;">rabbitmqadmin list parameters           ##查看 parameters</span></span>
<span class="line"><span style="color:#e1e4e8;">rabbitmqadmin list consumers            ##查看consumers</span></span>
<span class="line"><span style="color:#e1e4e8;">rabbitmqadmin list queues               ##查看queues</span></span>
<span class="line"><span style="color:#e1e4e8;">rabbitmqadmin list policies             ##查看policies</span></span>
<span class="line"><span style="color:#e1e4e8;">rabbitmqadmin list nodes                ##查看nodes</span></span>
<span class="line"><span style="color:#e1e4e8;">rabbitmqadmin show overview             ##查看overview</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">rabbitmqadmin list users                #查看用户列表</span></span>
<span class="line"><span style="color:#24292e;">rabbitmqadmin list vhosts               #查看vhosts</span></span>
<span class="line"><span style="color:#24292e;">rabbitmqadmin list connections          ###查看 connections</span></span>
<span class="line"><span style="color:#24292e;">rabbitmqadmin list exchanges            ##查看 exchanges</span></span>
<span class="line"><span style="color:#24292e;">rabbitmqadmin list bindings             ##查看 bindings</span></span>
<span class="line"><span style="color:#24292e;">rabbitmqadmin list permissions          ##查看 permissions</span></span>
<span class="line"><span style="color:#24292e;">rabbitmqadmin list channels             ##查看 channels</span></span>
<span class="line"><span style="color:#24292e;">rabbitmqadmin list parameters           ##查看 parameters</span></span>
<span class="line"><span style="color:#24292e;">rabbitmqadmin list consumers            ##查看consumers</span></span>
<span class="line"><span style="color:#24292e;">rabbitmqadmin list queues               ##查看queues</span></span>
<span class="line"><span style="color:#24292e;">rabbitmqadmin list policies             ##查看policies</span></span>
<span class="line"><span style="color:#24292e;">rabbitmqadmin list nodes                ##查看nodes</span></span>
<span class="line"><span style="color:#24292e;">rabbitmqadmin show overview             ##查看overview</span></span></code></pre></div><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">[root@beta cli]# rabbitmqadmin list users</span></span>
<span class="line"><span style="color:#e1e4e8;">+-------+--------------------------------+--------------------------------------------------+---------------+</span></span>
<span class="line"><span style="color:#e1e4e8;">| name  |       hashing_algorithm        |                  password_hash                   |     tags      |</span></span>
<span class="line"><span style="color:#e1e4e8;">+-------+--------------------------------+--------------------------------------------------+---------------+</span></span>
<span class="line"><span style="color:#e1e4e8;">| admin | rabbit_password_hashing_sha256 | tRq/NfJCRPtzUrooJ70Gdm/fEGFgHsbxASDXXgI8HqxNBn6n | administrator |</span></span>
<span class="line"><span style="color:#e1e4e8;">| guest | rabbit_password_hashing_sha256 | D5v/uN6uFdOfnnjaUW8btb9hsgVeN+3Y4n8Tvwl6woQpCbWG | administrator |</span></span>
<span class="line"><span style="color:#e1e4e8;">+-------+--------------------------------+--------------------------------------------------+---------------+</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">[root@beta cli]# rabbitmqadmin list users</span></span>
<span class="line"><span style="color:#24292e;">+-------+--------------------------------+--------------------------------------------------+---------------+</span></span>
<span class="line"><span style="color:#24292e;">| name  |       hashing_algorithm        |                  password_hash                   |     tags      |</span></span>
<span class="line"><span style="color:#24292e;">+-------+--------------------------------+--------------------------------------------------+---------------+</span></span>
<span class="line"><span style="color:#24292e;">| admin | rabbit_password_hashing_sha256 | tRq/NfJCRPtzUrooJ70Gdm/fEGFgHsbxASDXXgI8HqxNBn6n | administrator |</span></span>
<span class="line"><span style="color:#24292e;">| guest | rabbit_password_hashing_sha256 | D5v/uN6uFdOfnnjaUW8btb9hsgVeN+3Y4n8Tvwl6woQpCbWG | administrator |</span></span>
<span class="line"><span style="color:#24292e;">+-------+--------------------------------+--------------------------------------------------+---------------+</span></span></code></pre></div><h1 id="_2-系统操作" tabindex="-1">2.系统操作 <a class="header-anchor" href="#_2-系统操作" aria-label="Permalink to &quot;2.系统操作&quot;">​</a></h1><h2 id="_2-0用户角色" tabindex="-1">2.0用户角色 <a class="header-anchor" href="#_2-0用户角色" aria-label="Permalink to &quot;2.0用户角色&quot;">​</a></h2><p>共6中角色</p><table><thead><tr><th>用户</th><th>说明</th></tr></thead><tbody><tr><td>administrator</td><td>超级管理员，可登陆管理控制台，可查看所有的信息，并且可以对用户，策略(policy)进行操作</td></tr><tr><td>monitoring</td><td>可登陆管理控制台，同时可以查看rabbitmq节点的相关信息(进程数，内存使用情况，磁盘使用情况等)</td></tr><tr><td>policymaker</td><td>策略制定者，可登陆管理控制台, 同时可以对policy进行管理。但无法查看节点的相关信息</td></tr><tr><td>management</td><td>普通管理者，仅可登陆管理控制台，无法看到节点信息，也无法对策略进行管理</td></tr><tr><td>Impersonator</td><td>模拟者，无法登录管理控制台，因为没有管理者权限</td></tr><tr><td>none</td><td>无法登陆管理控制台，无任何角色。新创建的用户的角色默认为none</td></tr></tbody></table><h3 id="设置用户角色" tabindex="-1">设置用户角色 <a class="header-anchor" href="#设置用户角色" aria-label="Permalink to &quot;设置用户角色&quot;">​</a></h3><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">rabbitmqctl  set_user_tags  User  Tag</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">User为用户名， Tag为角色名(对应于administrator，monitoring，policymaker，management</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">#同时也可以设置多个角色</span></span>
<span class="line"><span style="color:#e1e4e8;">rabbitmqctl  set_user_tags  hncscwc  monitoring policymaker</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">rabbitmqctl  set_user_tags  User  Tag</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">User为用户名， Tag为角色名(对应于administrator，monitoring，policymaker，management</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">#同时也可以设置多个角色</span></span>
<span class="line"><span style="color:#24292e;">rabbitmqctl  set_user_tags  hncscwc  monitoring policymaker</span></span></code></pre></div><h2 id="_2-1用户管理操作" tabindex="-1">2.1用户管理操作 <a class="header-anchor" href="#_2-1用户管理操作" aria-label="Permalink to &quot;2.1用户管理操作&quot;">​</a></h2><p>官方文档，<a href="https://www.rabbitmq.com/access-control.html" target="_blank" rel="noreferrer">https://www.rabbitmq.com/access-control.html</a></p><p>用户权限指的是用户对其所能访问的 VHostPath 的 exchange，queue 的操作权限，包括配置权限，读写权限。配置权限会影响到 exchange，queue 的声明和删除；读写权限影响到从 queue 里取消息，向 exchange 发送消息以及 queue 和 exchange 的绑定 (bind) 操作。例如： 将 queue 绑定到某 exchange 上，需要具有 queue 的可写权限，以及 exchange 的可读权限；向 exchange 发送消息需要具有 exchange 的可写权限；从 queue 里取数据需要具有 queue 的可读权限。详细请参考官方文档中 <a href="https://www.rabbitmq.com/access-control.html" target="_blank" rel="noreferrer">“How permissions work”</a> 部分</p><h3 id="添加用户" tabindex="-1">添加用户 <a class="header-anchor" href="#添加用户" aria-label="Permalink to &quot;添加用户&quot;">​</a></h3><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">语法：rabbitmqctl  add_user  Username  Password</span></span>
<span class="line"><span style="color:#e1e4e8;">这个不会增加标签</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">[root@beta cli]# rabbitmqctl  add_user  han 1234han</span></span>
<span class="line"><span style="color:#e1e4e8;">Creating user &quot;han&quot;</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">#增加标签</span></span>
<span class="line"><span style="color:#e1e4e8;">rabbitmqadmin declare user name=han password=123han tags=administrator</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">语法：rabbitmqctl  add_user  Username  Password</span></span>
<span class="line"><span style="color:#24292e;">这个不会增加标签</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">[root@beta cli]# rabbitmqctl  add_user  han 1234han</span></span>
<span class="line"><span style="color:#24292e;">Creating user &quot;han&quot;</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">#增加标签</span></span>
<span class="line"><span style="color:#24292e;">rabbitmqadmin declare user name=han password=123han tags=administrator</span></span></code></pre></div><blockquote><p><strong>注意：如果是设置多个角色，管理界面用,分隔，命令用空格分隔</strong></p></blockquote><h3 id="删除用户" tabindex="-1">删除用户 <a class="header-anchor" href="#删除用户" aria-label="Permalink to &quot;删除用户&quot;">​</a></h3><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">[root@beta cli]# rabbitmqctl delete_user han</span></span>
<span class="line"><span style="color:#e1e4e8;">Deleting user &quot;han&quot;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">[root@beta cli]# rabbitmqctl delete_user han</span></span>
<span class="line"><span style="color:#24292e;">Deleting user &quot;han&quot;</span></span></code></pre></div><h3 id="修改用户的密码" tabindex="-1">修改用户的密码 <a class="header-anchor" href="#修改用户的密码" aria-label="Permalink to &quot;修改用户的密码&quot;">​</a></h3><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">语法：rabbitmqctl  change_password  Username  Newpassword</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">[root@beta cli]# rabbitmqctl change_password han12 han123</span></span>
<span class="line"><span style="color:#e1e4e8;">Changing password for user &quot;han12&quot;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">语法：rabbitmqctl  change_password  Username  Newpassword</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">[root@beta cli]# rabbitmqctl change_password han12 han123</span></span>
<span class="line"><span style="color:#24292e;">Changing password for user &quot;han12&quot;</span></span></code></pre></div><h3 id="验证用户密码" tabindex="-1">验证用户密码 <a class="header-anchor" href="#验证用户密码" aria-label="Permalink to &quot;验证用户密码&quot;">​</a></h3><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;"> rabbitmqctl authenticate_user {username} {passwd}</span></span>
<span class="line"><span style="color:#e1e4e8;"> </span></span>
<span class="line"><span style="color:#e1e4e8;">[root@appman ~]# rabbitmqctl authenticate_user han han123</span></span>
<span class="line"><span style="color:#e1e4e8;">Authenticating user &quot;han&quot; ...</span></span>
<span class="line"><span style="color:#e1e4e8;">Success</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;"> rabbitmqctl authenticate_user {username} {passwd}</span></span>
<span class="line"><span style="color:#24292e;"> </span></span>
<span class="line"><span style="color:#24292e;">[root@appman ~]# rabbitmqctl authenticate_user han han123</span></span>
<span class="line"><span style="color:#24292e;">Authenticating user &quot;han&quot; ...</span></span>
<span class="line"><span style="color:#24292e;">Success</span></span></code></pre></div><h3 id="授权用户" tabindex="-1">授权用户 <a class="header-anchor" href="#授权用户" aria-label="Permalink to &quot;授权用户&quot;">​</a></h3><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">rabbitmqctl set_user_tags {username} {tag}</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">#</span></span>
<span class="line"><span style="color:#e1e4e8;">rabbitmqctl set_user_tags han administrator</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">rabbitmqctl set_user_tags {username} {tag}</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">#</span></span>
<span class="line"><span style="color:#24292e;">rabbitmqctl set_user_tags han administrator</span></span></code></pre></div><h3 id="显示用户授权权限" tabindex="-1">显示用户授权权限 <a class="header-anchor" href="#显示用户授权权限" aria-label="Permalink to &quot;显示用户授权权限&quot;">​</a></h3><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">#没有权限显示空</span></span>
<span class="line"><span style="color:#e1e4e8;">[root@appman ~]#  rabbitmqctl list_user_permissions han</span></span>
<span class="line"><span style="color:#e1e4e8;">Listing permissions for user &quot;han&quot; ...</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">[root@appman ~]#  rabbitmqctl list_user_permissions admin</span></span>
<span class="line"><span style="color:#e1e4e8;">Listing permissions for user &quot;admin&quot; ...</span></span>
<span class="line"><span style="color:#e1e4e8;">vhost	configure	write	read</span></span>
<span class="line"><span style="color:#e1e4e8;">/	.*	.*	.*</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">#没有权限显示空</span></span>
<span class="line"><span style="color:#24292e;">[root@appman ~]#  rabbitmqctl list_user_permissions han</span></span>
<span class="line"><span style="color:#24292e;">Listing permissions for user &quot;han&quot; ...</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">[root@appman ~]#  rabbitmqctl list_user_permissions admin</span></span>
<span class="line"><span style="color:#24292e;">Listing permissions for user &quot;admin&quot; ...</span></span>
<span class="line"><span style="color:#24292e;">vhost	configure	write	read</span></span>
<span class="line"><span style="color:#24292e;">/	.*	.*	.*</span></span></code></pre></div><blockquote><p>如果没有授权，登陆15672管理界面的时候，则提示，Not management user</p></blockquote><h4 id="所有用户的权限" tabindex="-1">所有用户的权限 <a class="header-anchor" href="#所有用户的权限" aria-label="Permalink to &quot;所有用户的权限&quot;">​</a></h4><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">rabbitmqctl  list_permissions</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">rabbitmqctl  list_permissions</span></span></code></pre></div><h3 id="查看当前用户列表" tabindex="-1">查看当前用户列表 <a class="header-anchor" href="#查看当前用户列表" aria-label="Permalink to &quot;查看当前用户列表&quot;">​</a></h3><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">[root@beta cli]# rabbitmqctl list_users</span></span>
<span class="line"><span style="color:#e1e4e8;">Listing users</span></span>
<span class="line"><span style="color:#e1e4e8;">han12	[administrator]</span></span>
<span class="line"><span style="color:#e1e4e8;">admin	[administrator]</span></span>
<span class="line"><span style="color:#e1e4e8;">guest	[administrator]</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">#或者格式化输出</span></span>
<span class="line"><span style="color:#e1e4e8;">[root@beta cli]# rabbitmqadmin list users</span></span>
<span class="line"><span style="color:#e1e4e8;">+-------+--------------------------------+--------------------------------------------------+---------------+</span></span>
<span class="line"><span style="color:#e1e4e8;">| name  |       hashing_algorithm        |                  password_hash                   |     tags      |</span></span>
<span class="line"><span style="color:#e1e4e8;">+-------+--------------------------------+--------------------------------------------------+---------------+</span></span>
<span class="line"><span style="color:#e1e4e8;">| admin | rabbit_password_hashing_sha256 | tRq/NfJCRPtzUrooJ70Gdm/fEGFgHsbxASDXXgI8HqxNBn6n | administrator |</span></span>
<span class="line"><span style="color:#e1e4e8;">| guest | rabbit_password_hashing_sha256 | D5v/uN6uFdOfnnjaUW8btb9hsgVeN+3Y4n8Tvwl6woQpCbWG | administrator |</span></span>
<span class="line"><span style="color:#e1e4e8;">| han12 | rabbit_password_hashing_sha256 | yOWAHIGQVtDI8L6sPn7TGJuDkdphsks7fMPvw2/iz3wxZSxc | administrator |</span></span>
<span class="line"><span style="color:#e1e4e8;">+-------+--------------------------------+--------------------------------------------------+---------------+</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">[root@beta cli]#rabbitmqadmin list users name # 查看 users的时候限制字段</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;"># 创建某个项目的专用用户，限制只能访问自己项目的virtual hosts</span></span>
<span class="line"><span style="color:#e1e4e8;"># rabbitmqctl add_user user_proj your_password</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;"># 赋予management给某个项目的专用用户</span></span>
<span class="line"><span style="color:#e1e4e8;"># rabbitmqctl set_user_tags user_proj management</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;"># 查看用户与角色列表</span></span>
<span class="line"><span style="color:#e1e4e8;"># rabbitmqctl list_users</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">[root@beta cli]# rabbitmqctl list_users</span></span>
<span class="line"><span style="color:#24292e;">Listing users</span></span>
<span class="line"><span style="color:#24292e;">han12	[administrator]</span></span>
<span class="line"><span style="color:#24292e;">admin	[administrator]</span></span>
<span class="line"><span style="color:#24292e;">guest	[administrator]</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">#或者格式化输出</span></span>
<span class="line"><span style="color:#24292e;">[root@beta cli]# rabbitmqadmin list users</span></span>
<span class="line"><span style="color:#24292e;">+-------+--------------------------------+--------------------------------------------------+---------------+</span></span>
<span class="line"><span style="color:#24292e;">| name  |       hashing_algorithm        |                  password_hash                   |     tags      |</span></span>
<span class="line"><span style="color:#24292e;">+-------+--------------------------------+--------------------------------------------------+---------------+</span></span>
<span class="line"><span style="color:#24292e;">| admin | rabbit_password_hashing_sha256 | tRq/NfJCRPtzUrooJ70Gdm/fEGFgHsbxASDXXgI8HqxNBn6n | administrator |</span></span>
<span class="line"><span style="color:#24292e;">| guest | rabbit_password_hashing_sha256 | D5v/uN6uFdOfnnjaUW8btb9hsgVeN+3Y4n8Tvwl6woQpCbWG | administrator |</span></span>
<span class="line"><span style="color:#24292e;">| han12 | rabbit_password_hashing_sha256 | yOWAHIGQVtDI8L6sPn7TGJuDkdphsks7fMPvw2/iz3wxZSxc | administrator |</span></span>
<span class="line"><span style="color:#24292e;">+-------+--------------------------------+--------------------------------------------------+---------------+</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">[root@beta cli]#rabbitmqadmin list users name # 查看 users的时候限制字段</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;"># 创建某个项目的专用用户，限制只能访问自己项目的virtual hosts</span></span>
<span class="line"><span style="color:#24292e;"># rabbitmqctl add_user user_proj your_password</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;"># 赋予management给某个项目的专用用户</span></span>
<span class="line"><span style="color:#24292e;"># rabbitmqctl set_user_tags user_proj management</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;"># 查看用户与角色列表</span></span>
<span class="line"><span style="color:#24292e;"># rabbitmqctl list_users</span></span></code></pre></div><h1 id="_3-创建虚拟机" tabindex="-1">3.创建虚拟机 <a class="header-anchor" href="#_3-创建虚拟机" aria-label="Permalink to &quot;3.创建虚拟机&quot;">​</a></h1><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">rabbitmqctl add_vhost {vhost}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">rabbitmqctl add_vhost {vhost}</span></span></code></pre></div><h2 id="_3-1列出" tabindex="-1">3.1列出 <a class="header-anchor" href="#_3-1列出" aria-label="Permalink to &quot;3.1列出&quot;">​</a></h2><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">#列出当前所有vhost的信息</span></span>
<span class="line"><span style="color:#e1e4e8;">[root@appman ~]# rabbitmqctl list_vhosts</span></span>
<span class="line"><span style="color:#e1e4e8;">Listing vhosts ...</span></span>
<span class="line"><span style="color:#e1e4e8;">name</span></span>
<span class="line"><span style="color:#e1e4e8;">/</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">#列出当前所有vhost的信息</span></span>
<span class="line"><span style="color:#24292e;">[root@appman ~]# rabbitmqctl list_vhosts</span></span>
<span class="line"><span style="color:#24292e;">Listing vhosts ...</span></span>
<span class="line"><span style="color:#24292e;">name</span></span>
<span class="line"><span style="color:#24292e;">/</span></span></code></pre></div><h2 id="_3-2删除" tabindex="-1">3.2删除 <a class="header-anchor" href="#_3-2删除" aria-label="Permalink to &quot;3.2删除&quot;">​</a></h2><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">rabbitmqctl delete_vhost {vhost}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">rabbitmqctl delete_vhost {vhost}</span></span></code></pre></div><h2 id="_3-3授权vhost" tabindex="-1">3.3授权vhost <a class="header-anchor" href="#_3-3授权vhost" aria-label="Permalink to &quot;3.3授权vhost&quot;">​</a></h2><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;"> rabbitmqctl set_permissions [-p vhost] {user} {conf} {write} {read}</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">#设置han在vhost1上的权限，在以test开头的资源上有可配置权</span></span>
<span class="line"><span style="color:#e1e4e8;">rabbitmqctl set_permissions -p vhost1 han &quot;^test.*&quot; &quot;.*&quot; &quot;.*&quot;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;"> rabbitmqctl set_permissions [-p vhost] {user} {conf} {write} {read}</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">#设置han在vhost1上的权限，在以test开头的资源上有可配置权</span></span>
<span class="line"><span style="color:#24292e;">rabbitmqctl set_permissions -p vhost1 han &quot;^test.*&quot; &quot;.*&quot; &quot;.*&quot;</span></span></code></pre></div><h2 id="_3-4显示vhost权限" tabindex="-1">3.4显示vhost权限 <a class="header-anchor" href="#_3-4显示vhost权限" aria-label="Permalink to &quot;3.4显示vhost权限&quot;">​</a></h2><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">[root@appman ~]# rabbitmqctl list_permissions -p /</span></span>
<span class="line"><span style="color:#e1e4e8;">Listing permissions for vhost &quot;/&quot; ...</span></span>
<span class="line"><span style="color:#e1e4e8;">user	configure	write	read</span></span>
<span class="line"><span style="color:#e1e4e8;">guest	.*	.*	.*</span></span>
<span class="line"><span style="color:#e1e4e8;">admin	.*	.*	.*</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">[root@appman ~]# rabbitmqctl list_permissions -p /</span></span>
<span class="line"><span style="color:#24292e;">Listing permissions for vhost &quot;/&quot; ...</span></span>
<span class="line"><span style="color:#24292e;">user	configure	write	read</span></span>
<span class="line"><span style="color:#24292e;">guest	.*	.*	.*</span></span>
<span class="line"><span style="color:#24292e;">admin	.*	.*	.*</span></span></code></pre></div><h2 id="_3-4清除权限" tabindex="-1">3.4清除权限 <a class="header-anchor" href="#_3-4清除权限" aria-label="Permalink to &quot;3.4清除权限&quot;">​</a></h2><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">rabbitmqctl clear_permissions [-p vhost] {username}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">rabbitmqctl clear_permissions [-p vhost] {username}</span></span></code></pre></div><h2 id="_3-5完整案例" tabindex="-1">3.5完整案例 <a class="header-anchor" href="#_3-5完整案例" aria-label="Permalink to &quot;3.5完整案例&quot;">​</a></h2><ul><li>设置用户权限</li></ul><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">rabbitmqctl add_user han han123</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">rabbitmqctl set_user_tags han administrator</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">rabbitmqctl set_permissions -p / han .* .* .*</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">rabbitmqctl list_user_permissions han</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">rabbitmqctl add_user han han123</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">rabbitmqctl set_user_tags han administrator</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">rabbitmqctl set_permissions -p / han .* .* .*</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">rabbitmqctl list_user_permissions han</span></span></code></pre></div><h1 id="_4-队列操作" tabindex="-1">4.队列操作 <a class="header-anchor" href="#_4-队列操作" aria-label="Permalink to &quot;4.队列操作&quot;">​</a></h1><h2 id="_4-1添加queue" tabindex="-1">4.1添加queue <a class="header-anchor" href="#_4-1添加queue" aria-label="Permalink to &quot;4.1添加queue&quot;">​</a></h2><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">#rabbitmqadmin declare queue name=test durable=true</span></span>
<span class="line"><span style="color:#e1e4e8;">queue declared   </span></span>
<span class="line"><span style="color:#e1e4e8;">## durable=true 代表持久化打开  declare是宣布的意思</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">#指定vhost添加队列</span></span>
<span class="line"><span style="color:#e1e4e8;">rabbitmqadmin --vhost=test --username=admin --password=admin  declare queue name=test durable=true</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">#rabbitmqadmin declare queue name=test durable=true</span></span>
<span class="line"><span style="color:#24292e;">queue declared   </span></span>
<span class="line"><span style="color:#24292e;">## durable=true 代表持久化打开  declare是宣布的意思</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">#指定vhost添加队列</span></span>
<span class="line"><span style="color:#24292e;">rabbitmqadmin --vhost=test --username=admin --password=admin  declare queue name=test durable=true</span></span></code></pre></div><h2 id="_4-2查看queues" tabindex="-1">4.2查看queues <a class="header-anchor" href="#_4-2查看queues" aria-label="Permalink to &quot;4.2查看queues&quot;">​</a></h2><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">[root@beta cli]# rabbitmqadmin list queues</span></span>
<span class="line"><span style="color:#e1e4e8;">+------+----------+</span></span>
<span class="line"><span style="color:#e1e4e8;">| name | messages |</span></span>
<span class="line"><span style="color:#e1e4e8;">+------+----------+</span></span>
<span class="line"><span style="color:#e1e4e8;">| test | 0        |</span></span>
<span class="line"><span style="color:#e1e4e8;">+------+----------+</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">#查看bindings</span></span>
<span class="line"><span style="color:#e1e4e8;">[root@beta cli]# rabbitmqadmin list bindings</span></span>
<span class="line"><span style="color:#e1e4e8;">+--------+-------------+-------------+</span></span>
<span class="line"><span style="color:#e1e4e8;">| source | destination | routing_key |</span></span>
<span class="line"><span style="color:#e1e4e8;">+--------+-------------+-------------+</span></span>
<span class="line"><span style="color:#e1e4e8;">|        | test        | test        |</span></span>
<span class="line"><span style="color:#e1e4e8;">+--------+-------------+-------------+</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">[root@beta cli]# rabbitmqadmin list queues</span></span>
<span class="line"><span style="color:#24292e;">+------+----------+</span></span>
<span class="line"><span style="color:#24292e;">| name | messages |</span></span>
<span class="line"><span style="color:#24292e;">+------+----------+</span></span>
<span class="line"><span style="color:#24292e;">| test | 0        |</span></span>
<span class="line"><span style="color:#24292e;">+------+----------+</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">#查看bindings</span></span>
<span class="line"><span style="color:#24292e;">[root@beta cli]# rabbitmqadmin list bindings</span></span>
<span class="line"><span style="color:#24292e;">+--------+-------------+-------------+</span></span>
<span class="line"><span style="color:#24292e;">| source | destination | routing_key |</span></span>
<span class="line"><span style="color:#24292e;">+--------+-------------+-------------+</span></span>
<span class="line"><span style="color:#24292e;">|        | test        | test        |</span></span>
<span class="line"><span style="color:#24292e;">+--------+-------------+-------------+</span></span></code></pre></div><h2 id="_4-3添加消息到test-queue" tabindex="-1">4.3添加消息到test queue <a class="header-anchor" href="#_4-3添加消息到test-queue" aria-label="Permalink to &quot;4.3添加消息到test queue&quot;">​</a></h2><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">[root@beta cli]# rabbitmqadmin publish routing_key=test payload=&quot;this is a testing&quot;</span></span>
<span class="line"><span style="color:#e1e4e8;">Message published</span></span>
<span class="line"><span style="color:#e1e4e8;">##未指定exchange默认 exchange name为空</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">#查看对列发现test有一条消息</span></span>
<span class="line"><span style="color:#e1e4e8;">[root@beta cli]# rabbitmqadmin list queues</span></span>
<span class="line"><span style="color:#e1e4e8;">+------+----------+</span></span>
<span class="line"><span style="color:#e1e4e8;">| name | messages |</span></span>
<span class="line"><span style="color:#e1e4e8;">+------+----------+</span></span>
<span class="line"><span style="color:#e1e4e8;">| test | 1        |</span></span>
<span class="line"><span style="color:#e1e4e8;">+------+----------+</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">#从test queue消费一条信息</span></span>
<span class="line"><span style="color:#e1e4e8;">[root@beta cli]# rabbitmqadmin get queue=test requeue=true</span></span>
<span class="line"><span style="color:#e1e4e8;">+-------------+----------+---------------+-------------------+---------------+------------------+------------+-------------+</span></span>
<span class="line"><span style="color:#e1e4e8;">| routing_key | exchange | message_count |      payload      | payload_bytes | payload_encoding | properties | redelivered |</span></span>
<span class="line"><span style="color:#e1e4e8;">+-------------+----------+---------------+-------------------+---------------+------------------+------------+-------------+</span></span>
<span class="line"><span style="color:#e1e4e8;">| test        |          | 0             | this is a testing | 17            | string           |            | False       |</span></span>
<span class="line"><span style="color:#e1e4e8;">+-------------+----------+---------------+-------------------+---------------+------------------+------------+-------------+</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">#requeue=true 这条消息消费后还在，反之如果为false消费后消息就不在了</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">[root@beta cli]# rabbitmqadmin publish routing_key=test payload=&quot;this is a testing&quot;</span></span>
<span class="line"><span style="color:#24292e;">Message published</span></span>
<span class="line"><span style="color:#24292e;">##未指定exchange默认 exchange name为空</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">#查看对列发现test有一条消息</span></span>
<span class="line"><span style="color:#24292e;">[root@beta cli]# rabbitmqadmin list queues</span></span>
<span class="line"><span style="color:#24292e;">+------+----------+</span></span>
<span class="line"><span style="color:#24292e;">| name | messages |</span></span>
<span class="line"><span style="color:#24292e;">+------+----------+</span></span>
<span class="line"><span style="color:#24292e;">| test | 1        |</span></span>
<span class="line"><span style="color:#24292e;">+------+----------+</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">#从test queue消费一条信息</span></span>
<span class="line"><span style="color:#24292e;">[root@beta cli]# rabbitmqadmin get queue=test requeue=true</span></span>
<span class="line"><span style="color:#24292e;">+-------------+----------+---------------+-------------------+---------------+------------------+------------+-------------+</span></span>
<span class="line"><span style="color:#24292e;">| routing_key | exchange | message_count |      payload      | payload_bytes | payload_encoding | properties | redelivered |</span></span>
<span class="line"><span style="color:#24292e;">+-------------+----------+---------------+-------------------+---------------+------------------+------------+-------------+</span></span>
<span class="line"><span style="color:#24292e;">| test        |          | 0             | this is a testing | 17            | string           |            | False       |</span></span>
<span class="line"><span style="color:#24292e;">+-------------+----------+---------------+-------------------+---------------+------------------+------------+-------------+</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">#requeue=true 这条消息消费后还在，反之如果为false消费后消息就不在了</span></span></code></pre></div><h2 id="_4-4删除队列" tabindex="-1">4.4删除队列 <a class="header-anchor" href="#_4-4删除队列" aria-label="Permalink to &quot;4.4删除队列&quot;">​</a></h2><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">[root@beta cli]# rabbitmqadmin delete queue name=test</span></span>
<span class="line"><span style="color:#e1e4e8;">queue deleted</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">#没有清理之前</span></span>
<span class="line"><span style="color:#e1e4e8;">[root@beta cli]# rabbitmqadmin list queues</span></span>
<span class="line"><span style="color:#e1e4e8;">+------+----------+</span></span>
<span class="line"><span style="color:#e1e4e8;">| name | messages |</span></span>
<span class="line"><span style="color:#e1e4e8;">+------+----------+</span></span>
<span class="line"><span style="color:#e1e4e8;">| test | 1        |</span></span>
<span class="line"><span style="color:#e1e4e8;">+------+----------+</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">#清除队列消息内容</span></span>
<span class="line"><span style="color:#e1e4e8;">rabbitmqadmin purge queue name=队列名</span></span>
<span class="line"><span style="color:#e1e4e8;">或者</span></span>
<span class="line"><span style="color:#e1e4e8;">rabbitmqctl -q  purge_queue queue_name</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">[root@beta cli]# rabbitmqadmin purge queue name=test</span></span>
<span class="line"><span style="color:#e1e4e8;">queue purged</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">[root@beta cli]# rabbitmqadmin list queues</span></span>
<span class="line"><span style="color:#e1e4e8;">+------+----------+</span></span>
<span class="line"><span style="color:#e1e4e8;">| name | messages |</span></span>
<span class="line"><span style="color:#e1e4e8;">+------+----------+</span></span>
<span class="line"><span style="color:#e1e4e8;">| test | 0        |</span></span>
<span class="line"><span style="color:#e1e4e8;">+------+----------+</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">[root@beta cli]# rabbitmqadmin delete queue name=test</span></span>
<span class="line"><span style="color:#24292e;">queue deleted</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">#没有清理之前</span></span>
<span class="line"><span style="color:#24292e;">[root@beta cli]# rabbitmqadmin list queues</span></span>
<span class="line"><span style="color:#24292e;">+------+----------+</span></span>
<span class="line"><span style="color:#24292e;">| name | messages |</span></span>
<span class="line"><span style="color:#24292e;">+------+----------+</span></span>
<span class="line"><span style="color:#24292e;">| test | 1        |</span></span>
<span class="line"><span style="color:#24292e;">+------+----------+</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">#清除队列消息内容</span></span>
<span class="line"><span style="color:#24292e;">rabbitmqadmin purge queue name=队列名</span></span>
<span class="line"><span style="color:#24292e;">或者</span></span>
<span class="line"><span style="color:#24292e;">rabbitmqctl -q  purge_queue queue_name</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">[root@beta cli]# rabbitmqadmin purge queue name=test</span></span>
<span class="line"><span style="color:#24292e;">queue purged</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">[root@beta cli]# rabbitmqadmin list queues</span></span>
<span class="line"><span style="color:#24292e;">+------+----------+</span></span>
<span class="line"><span style="color:#24292e;">| name | messages |</span></span>
<span class="line"><span style="color:#24292e;">+------+----------+</span></span>
<span class="line"><span style="color:#24292e;">| test | 0        |</span></span>
<span class="line"><span style="color:#24292e;">+------+----------+</span></span></code></pre></div><blockquote><p>手动清空所有队列消息</p><p>cd /var/lib/rabbitmq/mnesia/rabbit@连接账户名/queues # 清空该目录下所有文件即可</p></blockquote><h3 id="策略删除数据" tabindex="-1">策略删除数据 <a class="header-anchor" href="#策略删除数据" aria-label="Permalink to &quot;策略删除数据&quot;">​</a></h3><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">rabbitmqctl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">set_policy</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">deleter</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;.*&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;{&quot;expires&quot;:1}&#39;</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--apply-to</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">queues</span></span>
<span class="line"><span style="color:#B392F0;">rabbitmqctl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">clear_policy</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">deleter</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">rabbitmqctl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">set_policy</span><span style="color:#24292E;"> </span><span style="color:#032F62;">deleter</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;.*&quot;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;{&quot;expires&quot;:1}&#39;</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--apply-to</span><span style="color:#24292E;"> </span><span style="color:#032F62;">queues</span></span>
<span class="line"><span style="color:#6F42C1;">rabbitmqctl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">clear_policy</span><span style="color:#24292E;"> </span><span style="color:#032F62;">deleter</span></span></code></pre></div><blockquote><p>通过创建一个policy，该policy名字为deleter，针对所有名字符合”.*”正则表达式的队列，设置他们的expires属性为1。1s之后清理这个policy，以免影响之后的正常使用</p></blockquote><h2 id="_4-5队列模式" tabindex="-1">4.5队列模式 <a class="header-anchor" href="#_4-5队列模式" aria-label="Permalink to &quot;4.5队列模式&quot;">​</a></h2><h3 id="rabbitmq-simple-queue-模式-简单队列" tabindex="-1">RabbitMQ Simple Queue 模式（简单队列） <a class="header-anchor" href="#rabbitmq-simple-queue-模式-简单队列" aria-label="Permalink to &quot;RabbitMQ Simple Queue 模式（简单队列）&quot;">​</a></h3><p>简单队列模式下，每条消息只会被一个消费者所接收，不存在多个消费者接收到同一条消息的情况，而且不管有多少个消费者，默认情况下服务端都会以轮询分发（round-robin）的方式确保每个消费者接收到的消息数量是一样的</p><p><img src="`+p+'" alt=""></p><h3 id="rabbitmq-work-queue-模式-工作队列" tabindex="-1"><strong>RabbitMQ Work Queue 模式（工作队列）</strong> <a class="header-anchor" href="#rabbitmq-work-queue-模式-工作队列" aria-label="Permalink to &quot;**RabbitMQ Work Queue 模式（工作队列）**&quot;">​</a></h3><p>工作队列模式下，每条消息只会被一个消费者所接收，不存在多个消费者接收到同一条消息的情况；同时工作队列模式可以使用公平分发（fair dispatch）的方式来发送消息，特点是处理能力强的消费者可以接收到更多的消息（能者多劳），这也是与简单队列模式相比较不同的地方。当使用公平分发时，消费者可调用 basicQos（）方法，同时需要手动确认消息（ACK 机制）</p><p><img src="'+t+'" alt=""></p><h3 id="rabbitmq-fanout-模式-发布-订阅" tabindex="-1"><strong>RabbitMQ Fanout 模式（发布 / 订阅）</strong> <a class="header-anchor" href="#rabbitmq-fanout-模式-发布-订阅" aria-label="Permalink to &quot;**RabbitMQ Fanout 模式（发布 / 订阅）**&quot;">​</a></h3><p>单个生产者可以对应多个消费者，每个消费者都有自己的队列，同一条消息可以被多个消费者接收。所有发送到 Fanout Exchange 的消息都会被转发到与该 Exchange 绑定 (Binding) 的所有 Queue 上。Fanout Exchange 不需要额外处理 RouteKey，只需要简单地将队列绑定到 Exchange 上，这样发送到 Exchange 的消息都会被转发到与该交换机绑定的所有队列上，作用类似子网广播，每台子网内的主机都获得了一份复制的消息，因此 Fanout Exchange 转发消息是最快的</p><p><img src="'+s+'" alt=""></p><p><img src="'+o+'" alt=""></p><h3 id="rabbitmq-direct-模式-路由" tabindex="-1"><strong>RabbitMQ Direct 模式（路由）</strong> <a class="header-anchor" href="#rabbitmq-direct-模式-路由" aria-label="Permalink to &quot;**RabbitMQ Direct 模式（路由）**&quot;">​</a></h3><p>单个生产者可以对应多个消费者，每个消费者都有自己的队列，同一条消息可以被多个消费者接收。所有发送到 Direct Exchange 的消息会被转发到 RouteKey 中指定的 Queue 上。消息传递时，RouteKey 必须完全匹配，才会被队列接收，否则该消息会被抛弃</p><p><img src="'+s+'" alt=""></p><p><img src="'+i+'" alt=""></p><h3 id="rabbitmq-topic-模式-通配符" tabindex="-1"><strong>RabbitMQ Topic 模式（通配符）</strong> <a class="header-anchor" href="#rabbitmq-topic-模式-通配符" aria-label="Permalink to &quot;**RabbitMQ Topic 模式（通配符）**&quot;">​</a></h3><p>单个生产者可以对应多个消费者，每个消费者都有自己的队列，同一条消息可以被多个消费者接收。所有发送到 Topic Exchange 的消息会被转发到指定 Topic 的 Queue 上，Exchange 会将 RouteKey 和某个 Topic 进行模糊匹配，此时队列需要绑定一个 Topic。RouteKey 可以使用通配符进行模糊匹配，符号”#” 表示匹配一个或多个词，符号”<em>” 表示匹配不多不少一个词。因此”log.#” 能够匹配到”log.info.oa”，但是”log.</em>” 只会匹配到”log.error”，所以 Topic Exchange 的使用非常灵活</p><p><img src="'+c+'" alt=""></p><p><img src="'+r+`" alt=""></p><h1 id="_5-交换机" tabindex="-1">5.交换机 <a class="header-anchor" href="#_5-交换机" aria-label="Permalink to &quot;5.交换机&quot;">​</a></h1><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;"># 列出所有交换机</span></span>
<span class="line"><span style="color:#e1e4e8;"># rabbitmqctl list_exchanges</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;"># 列出所有绑定</span></span>
<span class="line"><span style="color:#e1e4e8;"># rabbitmqctl list_bindings</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;"># 列出所有交换机</span></span>
<span class="line"><span style="color:#24292e;"># rabbitmqctl list_exchanges</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;"># 列出所有绑定</span></span>
<span class="line"><span style="color:#24292e;"># rabbitmqctl list_bindings</span></span></code></pre></div><h2 id="_5-0amqp-简介" tabindex="-1">5.0AMQP 简介 <a class="header-anchor" href="#_5-0amqp-简介" aria-label="Permalink to &quot;5.0AMQP 简介&quot;">​</a></h2><p>官方文档，<a href="https://www.rabbitmq.com/tutorials/amqp-concepts.html" target="_blank" rel="noreferrer">https://www.rabbitmq.com/tutorials/amqp-concepts.html</a></p><p>RabbitMQ 是实现了 AMQP 协议的消息中间件，所以说下面讲到这些概念不仅限于RabbitMQ，所有实现AMQP 协议的消息中间件都具备这些</p><p>AMQP 模型图如下</p><p><img src="`+d+`" alt=""></p><p>**Publisher（发布者）**和 **Consumer（消费者）**可以理解为是我们的应用程序</p><p><strong>Exchange（交换机）</strong>，我们的Publisher 会将消息先推送到Exchange ，Exchange 类似邮局，他会将消息再路由到 **Queue（队列）**中，Queue会将消息推送给Consumer</p><p>Exchange 和 Queue 之间通过 **Binding （绑定）**将两者关联到一起，一个Exchange 可以绑定多个Queue，一个Queue 可以绑定多个Exchange</p><h2 id="_5-1exchange" tabindex="-1">5.1Exchange <a class="header-anchor" href="#_5-1exchange" aria-label="Permalink to &quot;5.1Exchange&quot;">​</a></h2><p>刚刚我们说Exchange类似邮局。邮局的话，当然会有很多的邮递方式，所以我们的Exchange有多种类型，每种类型都有自己的策略</p><p>AMQP 提供四种Exchange类型</p><table><thead><tr><th style="text-align:left;">name</th><th style="text-align:left;">默认预设名</th></tr></thead><tbody><tr><td style="text-align:left;">Direct exchange</td><td style="text-align:left;">(Empty string) and amq.direct</td></tr><tr><td style="text-align:left;">Fanout exchange</td><td style="text-align:left;">amq.fanout</td></tr><tr><td style="text-align:left;">Topic exchange</td><td style="text-align:left;">amq.topic</td></tr><tr><td style="text-align:left;">Headers exchange</td><td style="text-align:left;">amq.match (and amq.headers in RabbitMQ)</td></tr></tbody></table><h3 id="direct-exchange-type-直连" tabindex="-1">Direct Exchange type(直连) <a class="header-anchor" href="#direct-exchange-type-直连" aria-label="Permalink to &quot;Direct Exchange type(直连)&quot;">​</a></h3><p>所有发送到Direct Exchange的消息被转发到RouteKey中指定的Queue</p><blockquote><p>注意：Direct模式可以使用RabbitMQ自带的Exchange：default Exchange,所以不需要将Exchange进行任何绑定(binding)操作，消息传递时，RouteKey必须完全匹配才会被队列接收，否则该消息会被抛弃</p></blockquote><p>Direct Exchange基于RoutingKey 将消息传递到队列</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">// 第一个参数为Exchange，第二个参数就是RoutingKey </span></span>
<span class="line"><span style="color:#e1e4e8;">rabbitTemplate.convertAndSend(&quot;user_exchange&quot;, &quot;user_routingKey&quot;, message);</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">// 绑定的时候 也会关联一个RoutingKey</span></span>
<span class="line"><span style="color:#e1e4e8;">BindingBuilder.bind(queue()).to(userExchange()).with(&quot;user_routingKey&quot;)</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">// 第一个参数为Exchange，第二个参数就是RoutingKey </span></span>
<span class="line"><span style="color:#24292e;">rabbitTemplate.convertAndSend(&quot;user_exchange&quot;, &quot;user_routingKey&quot;, message);</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">// 绑定的时候 也会关联一个RoutingKey</span></span>
<span class="line"><span style="color:#24292e;">BindingBuilder.bind(queue()).to(userExchange()).with(&quot;user_routingKey&quot;)</span></span></code></pre></div><p><img src="`+u+`" alt=""></p><blockquote><p><strong>重点：routing key与队列queues 的key保持一致，即可以路由到对应的queue中</strong></p></blockquote><h3 id="default-exchange-type" tabindex="-1">Default Exchange type <a class="header-anchor" href="#default-exchange-type" aria-label="Permalink to &quot;Default Exchange type&quot;">​</a></h3><p>Default Exchange 其实是AMQP中预先声明的，并且它属于 Direct Exchange，通常来说每个Exchange都会有自己的名，Default Exchange 的名是 <code>&quot;&quot;</code>.</p><p>他有一个特殊的属性，当你手动创建一个队列时，MQ会自动将这个队列绑定到Default Exchange 上，绑定时 RoutingKey 与队列名称相同</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">// 声明一个 Queue，这个时候我们不主动Binding的话，test_queue 会和Default Exchange 绑定，此时 routingKey = test_queue</span></span>
<span class="line"><span style="color:#e1e4e8;">Queue queue = new Queue(&quot;test_queue&quot;);</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">// 向默认交换机发布消息</span></span>
<span class="line"><span style="color:#e1e4e8;">rabbitTemplate.convertAndSend(&quot;&quot;, &quot;test_queue&quot;, message);</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">// 声明一个 Queue，这个时候我们不主动Binding的话，test_queue 会和Default Exchange 绑定，此时 routingKey = test_queue</span></span>
<span class="line"><span style="color:#24292e;">Queue queue = new Queue(&quot;test_queue&quot;);</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">// 向默认交换机发布消息</span></span>
<span class="line"><span style="color:#24292e;">rabbitTemplate.convertAndSend(&quot;&quot;, &quot;test_queue&quot;, message);</span></span></code></pre></div><h3 id="fanout-exchange-type" tabindex="-1">Fanout Exchange type <a class="header-anchor" href="#fanout-exchange-type" aria-label="Permalink to &quot;Fanout Exchange type&quot;">​</a></h3><ul><li>不处理路由键，只需要简单的将队里绑定到交换机上</li><li>发送到交换机的消息都会被转发到与该交换机绑定的所有队列上</li><li>Fanout交换机转发消息是最快的</li></ul><p>Fanout Exchange 很简单，适合发布订阅场景。他不使用RoutingKey，他将消息路由到所有与其绑定的队列</p><p><img src="`+b+'" alt=""></p><h3 id="topic-exchange-type" tabindex="-1">Topic Exchange type <a class="header-anchor" href="#topic-exchange-type" aria-label="Permalink to &quot;Topic Exchange type&quot;">​</a></h3><ul><li>所有发送到Topic Exchange的消息被转发到所有管线RouteKey中指定Topic的Queue上</li><li>Exchange将RouteKey和某Topic进行模糊匹配,此时队列需要绑定一个Topic</li></ul><p>Topic Exchange 又是基于RoutingKey来路由转发的，但是有些不同</p><p><img src="'+h+`" alt=""></p><p>在使用 Topic 的时候，routingKey 可以是 <code>*.orange.*</code>,<code>lazy.#</code> 这种表达式</p><ul><li><code>*</code> (星) 代表一个词.</li><li><code>#</code> (hash) 代表0或多个词</li></ul><p>案例，</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">log.#  能够匹配到 log.info.oa</span></span>
<span class="line"><span style="color:#e1e4e8;">log.*  只会匹配到 log.erro</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">log.#  能够匹配到 log.info.oa</span></span>
<span class="line"><span style="color:#24292e;">log.*  只会匹配到 log.erro</span></span></code></pre></div><p>同理，当发布消息时的 routingKey 与其匹配时，会路由到相应的队列</p><h3 id="headers-exchange-type" tabindex="-1">Headers Exchange type <a class="header-anchor" href="#headers-exchange-type" aria-label="Permalink to &quot;Headers Exchange type&quot;">​</a></h3><p>基于Header中的属性来匹配路由，由于不是很常用</p><h2 id="_5-2bingding" tabindex="-1">5.2Bingding <a class="header-anchor" href="#_5-2bingding" aria-label="Permalink to &quot;5.2Bingding&quot;">​</a></h2><ul><li>Exchange和Exchange、Queue之间的连接关系</li><li>Bingding可以包含RoutingKey或者参数</li></ul><h2 id="_5-3queue——消息队列" tabindex="-1">5.3Queue——消息队列 <a class="header-anchor" href="#_5-3queue——消息队列" aria-label="Permalink to &quot;5.3Queue——消息队列&quot;">​</a></h2><ul><li>消息队列，实际存储消息数据</li><li>Durability：是否持久化，Durable:是 ，Transient：否</li><li>Auto delete：如选yes，代表当最后一个监听被移除之后，该Queue会自动被删除</li></ul><h2 id="_5-4message" tabindex="-1">5.4Message <a class="header-anchor" href="#_5-4message" aria-label="Permalink to &quot;5.4Message&quot;">​</a></h2><ul><li>服务器与应用程序之间传送的数据</li><li>本质上就是一段数据，由Properties和Payload（Body）组成</li><li>常用属性：delivery mode、headers(自定义属性)</li></ul><h2 id="_5-5virtual-host" tabindex="-1">5.5Virtual Host <a class="header-anchor" href="#_5-5virtual-host" aria-label="Permalink to &quot;5.5Virtual Host&quot;">​</a></h2><ul><li>虚拟地址,用于进行逻辑隔离，最上层的消息路由</li><li>一个Virtual Host里面可以有若干个Exchange和Queue</li><li>同一个Virtual Host里面不能有相同名称的Exchange或Queue</li></ul><h1 id="_6-权限" tabindex="-1">6.权限 <a class="header-anchor" href="#_6-权限" aria-label="Permalink to &quot;6.权限&quot;">​</a></h1><p><strong>RabbitMQ权限分类</strong>：</p><ul><li>读：有关消费消息的任何操作，包括清除整个队列（需要绑定操作成功）</li><li>写：发布消息（需要绑定操作成功）</li><li>配置：队列和交换器的创建和删除</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">rabbitmqctl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">set_permissions</span><span style="color:#E1E4E8;"> [-pvhostpath] {</span><span style="color:#B392F0;">user}</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">{conf}</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">{write}</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">{read}</span></span>
<span class="line"><span style="color:#B392F0;">Vhostpath：虚拟主机，表示该用户可以访问那台虚拟主机；</span></span>
<span class="line"><span style="color:#B392F0;">user：用户名。</span></span>
<span class="line"><span style="color:#B392F0;">Conf：一个正则表达式match哪些配置资源能够被该用户访问。</span></span>
<span class="line"><span style="color:#B392F0;">Write：一个正则表达式match哪些配置资源能够被该用户设置。</span></span>
<span class="line"><span style="color:#B392F0;">Read：一个正则表达式match哪些配置资源能够被该用户访问</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">rabbitmqctl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">set_permissions</span><span style="color:#24292E;"> [-pvhostpath] {</span><span style="color:#6F42C1;">user}</span><span style="color:#24292E;"> </span><span style="color:#032F62;">{conf}</span><span style="color:#24292E;"> </span><span style="color:#032F62;">{write}</span><span style="color:#24292E;"> </span><span style="color:#032F62;">{read}</span></span>
<span class="line"><span style="color:#6F42C1;">Vhostpath：虚拟主机，表示该用户可以访问那台虚拟主机；</span></span>
<span class="line"><span style="color:#6F42C1;">user：用户名。</span></span>
<span class="line"><span style="color:#6F42C1;">Conf：一个正则表达式match哪些配置资源能够被该用户访问。</span></span>
<span class="line"><span style="color:#6F42C1;">Write：一个正则表达式match哪些配置资源能够被该用户设置。</span></span>
<span class="line"><span style="color:#6F42C1;">Read：一个正则表达式match哪些配置资源能够被该用户访问</span></span></code></pre></div><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">rabbitmqctl list_queues：查看所有队列信息</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">rabbitmqctl stop_app：关闭应用（关闭当前启动的节点）</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">rabbitmqctl start_app：启动应用，和上述关闭命令配合使用，达到清空队列的目的</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">rabbitmqctl reset：从管理数据库中移除所有数据，例如配置过的用户和虚拟宿主, 删除所有持久化的消息（这个命令要在rabbitmqctl stop_app之后使用）</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">rabbitmqctl force_reset：作用和rabbitmqctl reset一样，区别是无条件重置节点，不管当前管理数据库状态以及集群的配置。如果数据库或者集群配置发生错误才使用这个最后的手段</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">rabbitmqctl status：节点状态</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">rabbitmqctl add_user username password：添加用户</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">rabbitmqctl list_users：列出所有用户</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">rabbitmqctl list_user_permissions username：列出用户权限</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">rabbitmqctl change_password username newpassword：修改密码</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">rabbitmqctl list_permissions -p vhostpath：列出虚拟主机上的所有权限 </span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">rabbitmqctl clear_permissions -p vhostpath username：清除用户权限</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">rabbitmqctl -p vhostpath purge_queue blue：清除队列里的消息</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">rabbitmqctl delete_user username：删除用户</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">rabbitmqctl delete_vhost vhostpath：删除虚拟主机</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">rabbitmqctl list_queues：查看所有队列信息</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">rabbitmqctl stop_app：关闭应用（关闭当前启动的节点）</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">rabbitmqctl start_app：启动应用，和上述关闭命令配合使用，达到清空队列的目的</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">rabbitmqctl reset：从管理数据库中移除所有数据，例如配置过的用户和虚拟宿主, 删除所有持久化的消息（这个命令要在rabbitmqctl stop_app之后使用）</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">rabbitmqctl force_reset：作用和rabbitmqctl reset一样，区别是无条件重置节点，不管当前管理数据库状态以及集群的配置。如果数据库或者集群配置发生错误才使用这个最后的手段</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">rabbitmqctl status：节点状态</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">rabbitmqctl add_user username password：添加用户</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">rabbitmqctl list_users：列出所有用户</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">rabbitmqctl list_user_permissions username：列出用户权限</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">rabbitmqctl change_password username newpassword：修改密码</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">rabbitmqctl list_permissions -p vhostpath：列出虚拟主机上的所有权限 </span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">rabbitmqctl clear_permissions -p vhostpath username：清除用户权限</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">rabbitmqctl -p vhostpath purge_queue blue：清除队列里的消息</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">rabbitmqctl delete_user username：删除用户</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">rabbitmqctl delete_vhost vhostpath：删除虚拟主机</span></span></code></pre></div><h2 id="_6-1权限" tabindex="-1">6.1权限 <a class="header-anchor" href="#_6-1权限" aria-label="Permalink to &quot;6.1权限&quot;">​</a></h2><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">[root@beta mnesia]# rabbitmqctl  list_permissions</span></span>
<span class="line"><span style="color:#e1e4e8;">Listing permissions in vhost &quot;/&quot;</span></span>
<span class="line"><span style="color:#e1e4e8;">admin	.*	.*	.*</span></span>
<span class="line"><span style="color:#e1e4e8;">guest	.*	.*	.*</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">[root@beta mnesia]# rabbitmqctl  list_permissions</span></span>
<span class="line"><span style="color:#24292e;">Listing permissions in vhost &quot;/&quot;</span></span>
<span class="line"><span style="color:#24292e;">admin	.*	.*	.*</span></span>
<span class="line"><span style="color:#24292e;">guest	.*	.*	.*</span></span></code></pre></div><ul><li>为用户添加权限</li></ul><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">语法：rabbitmqctl set_permissions -p vhostpath username &quot;.*&quot; &quot;.*&quot; &quot;.*&quot;</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">rabbitmqctl set_permissions -p / developer &quot;.*&quot; &quot;.*&quot; &quot;.*&quot;</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">-p / ：表示对/ 虚拟主机设置权限，如何省略vhost，默认为“/”虚拟主机</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">developer：对developer用户设置权限</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">后面的三个&quot;.*&quot;分别对应配置、写、读的权限</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">“.*”为正则表达式，指代所有权限，&quot;.*&quot;意味着匹配所有交换器和队列。这样就允许developer用户对/ 虚拟主机的所有队列和交换器执行配置、写、读命令</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">语法：rabbitmqctl set_permissions -p vhostpath username &quot;.*&quot; &quot;.*&quot; &quot;.*&quot;</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">rabbitmqctl set_permissions -p / developer &quot;.*&quot; &quot;.*&quot; &quot;.*&quot;</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">-p / ：表示对/ 虚拟主机设置权限，如何省略vhost，默认为“/”虚拟主机</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">developer：对developer用户设置权限</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">后面的三个&quot;.*&quot;分别对应配置、写、读的权限</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">“.*”为正则表达式，指代所有权限，&quot;.*&quot;意味着匹配所有交换器和队列。这样就允许developer用户对/ 虚拟主机的所有队列和交换器执行配置、写、读命令</span></span></code></pre></div><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;"># rabbitmqctl set_permissions -p / aaa &quot;&quot; &quot;check-.*&quot; &quot;.*&quot;</span></span>
<span class="line"><span style="color:#e1e4e8;">Setting permissions for user &quot;aaa&quot; in vhost &quot;/&quot; ...</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">对“/”虚拟主机赋予 aaa用户不能配置，限制只能对以“check-”开头的队列和交换器写操作，对所有队列和交换器可读的操作的权限</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;"># rabbitmqctl set_permissions -p / aaa &quot;&quot; &quot;check-.*&quot; &quot;.*&quot;</span></span>
<span class="line"><span style="color:#24292e;">Setting permissions for user &quot;aaa&quot; in vhost &quot;/&quot; ...</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">对“/”虚拟主机赋予 aaa用户不能配置，限制只能对以“check-”开头的队列和交换器写操作，对所有队列和交换器可读的操作的权限</span></span></code></pre></div><h3 id="查看" tabindex="-1">查看 <a class="header-anchor" href="#查看" aria-label="Permalink to &quot;查看&quot;">​</a></h3><ul><li><h3 id="指定vhostpath-所有用户的权限" tabindex="-1">指定vhostpath)所有用户的权限 <a class="header-anchor" href="#指定vhostpath-所有用户的权限" aria-label="Permalink to &quot;指定vhostpath)所有用户的权限&quot;">​</a></h3></li></ul><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">[root@beta ~]# rabbitmqctl  list_permissions -p /</span></span>
<span class="line"><span style="color:#e1e4e8;">Listing permissions in vhost &quot;/&quot;</span></span>
<span class="line"><span style="color:#e1e4e8;">admin	.*	.*	.*</span></span>
<span class="line"><span style="color:#e1e4e8;">guest	.*	.*	.*</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">[root@beta ~]# rabbitmqctl  list_permissions -p /</span></span>
<span class="line"><span style="color:#24292e;">Listing permissions in vhost &quot;/&quot;</span></span>
<span class="line"><span style="color:#24292e;">admin	.*	.*	.*</span></span>
<span class="line"><span style="color:#24292e;">guest	.*	.*	.*</span></span></code></pre></div><ul><li><h3 id="指定用户的权限" tabindex="-1">指定用户的权限 <a class="header-anchor" href="#指定用户的权限" aria-label="Permalink to &quot;指定用户的权限&quot;">​</a></h3></li></ul><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">[root@beta ~]# rabbitmqctl  list_user_permissions guest</span></span>
<span class="line"><span style="color:#e1e4e8;">Listing permissions for user &quot;guest&quot;</span></span>
<span class="line"><span style="color:#e1e4e8;">/	.*	.*	.*</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">[root@beta ~]# rabbitmqctl  list_user_permissions guest</span></span>
<span class="line"><span style="color:#24292e;">Listing permissions for user &quot;guest&quot;</span></span>
<span class="line"><span style="color:#24292e;">/	.*	.*	.*</span></span></code></pre></div><h2 id="_6-2清除用户权限" tabindex="-1">6.2清除用户权限 <a class="header-anchor" href="#_6-2清除用户权限" aria-label="Permalink to &quot;6.2清除用户权限&quot;">​</a></h2><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">rabbitmqctl clear_permissions -p [vhost_name] [user_name]</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">[root@beta ~]# rabbitmqctl  clear_permissions han</span></span>
<span class="line"><span style="color:#e1e4e8;">Clearing permissions for user &quot;han&quot; in vhost &quot;/&quot;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">rabbitmqctl clear_permissions -p [vhost_name] [user_name]</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">[root@beta ~]# rabbitmqctl  clear_permissions han</span></span>
<span class="line"><span style="color:#24292e;">Clearing permissions for user &quot;han&quot; in vhost &quot;/&quot;</span></span></code></pre></div><h2 id="_6-3虚拟主机" tabindex="-1">6.3虚拟主机 <a class="header-anchor" href="#_6-3虚拟主机" aria-label="Permalink to &quot;6.3虚拟主机&quot;">​</a></h2><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">#列出所有虚拟主机</span></span>
<span class="line"><span style="color:#e1e4e8;">[root@beta ~]# rabbitmqctl list_vhosts</span></span>
<span class="line"><span style="color:#e1e4e8;">Listing vhosts</span></span>
<span class="line"><span style="color:#e1e4e8;">/</span></span>
<span class="line"><span style="color:#e1e4e8;">han_test</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">#创建虚拟主机</span></span>
<span class="line"><span style="color:#e1e4e8;">rabbitmqctl add_vhost vhostpath</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">[root@beta ~]# rabbitmqctl add_vhost han_test</span></span>
<span class="line"><span style="color:#e1e4e8;">Creating vhost &quot;han_test&quot;</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">#删除虚拟主机</span></span>
<span class="line"><span style="color:#e1e4e8;">[root@beta ~]# rabbitmqctl delete_vhost han_test</span></span>
<span class="line"><span style="color:#e1e4e8;">Deleting vhost &quot;han_test&quot;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">#列出所有虚拟主机</span></span>
<span class="line"><span style="color:#24292e;">[root@beta ~]# rabbitmqctl list_vhosts</span></span>
<span class="line"><span style="color:#24292e;">Listing vhosts</span></span>
<span class="line"><span style="color:#24292e;">/</span></span>
<span class="line"><span style="color:#24292e;">han_test</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">#创建虚拟主机</span></span>
<span class="line"><span style="color:#24292e;">rabbitmqctl add_vhost vhostpath</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">[root@beta ~]# rabbitmqctl add_vhost han_test</span></span>
<span class="line"><span style="color:#24292e;">Creating vhost &quot;han_test&quot;</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">#删除虚拟主机</span></span>
<span class="line"><span style="color:#24292e;">[root@beta ~]# rabbitmqctl delete_vhost han_test</span></span>
<span class="line"><span style="color:#24292e;">Deleting vhost &quot;han_test&quot;</span></span></code></pre></div><h1 id="_7-mq消息迁移" tabindex="-1">7.MQ消息迁移 <a class="header-anchor" href="#_7-mq消息迁移" aria-label="Permalink to &quot;7.MQ消息迁移&quot;">​</a></h1><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;"># 首先在来源的MQ集群开启插件</span></span>
<span class="line"><span style="color:#e1e4e8;">rabbitmq-plugins enable rabbitmq_shovel</span></span>
<span class="line"><span style="color:#e1e4e8;">rabbitmq-plugins enable rabbitmq_shovel_management</span></span>
<span class="line"><span style="color:#e1e4e8;">rabbitmq-plugins enable rabbitmq_federation</span></span>
<span class="line"><span style="color:#e1e4e8;">rabbitmq-plugins enable rabbitmq_federation_management</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;"># 首先在来源的MQ集群开启插件</span></span>
<span class="line"><span style="color:#24292e;">rabbitmq-plugins enable rabbitmq_shovel</span></span>
<span class="line"><span style="color:#24292e;">rabbitmq-plugins enable rabbitmq_shovel_management</span></span>
<span class="line"><span style="color:#24292e;">rabbitmq-plugins enable rabbitmq_federation</span></span>
<span class="line"><span style="color:#24292e;">rabbitmq-plugins enable rabbitmq_federation_management</span></span></code></pre></div><blockquote><p>安装好rabbitmq_shovel和rabbitmq_shovel_management两个插件之后，就可以在rabbitmq的管理页面查看到这两个插件，首先创建一个shovel.填入的信息主要包括要同步的vhost名称，起一个名字，来源mq服务器地址和队列，目标mq服务器地址和队列，其中要有对vhost授权的账户和密码。目标MQ集群要提前创建好vhost,配置的授权账户和密码，包括队列等</p><p>有一个插件Federation，这个插件一般用于实时同步消息的</p></blockquote><ol start="8"><li></li></ol>`,152),g=[m];function q(v,_,k,x,f,w){return n(),e("div",null,g)}const A=a(y,[["render",q]]);export{C as __pageData,A as default};
