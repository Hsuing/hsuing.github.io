import{_ as s,o as a,c as o,R as e}from"./chunks/framework.zUbWieqp.js";const h=JSON.parse('{"title":"1. PromQL æ“ä½œç¬¦","description":"","frontmatter":{},"headers":[],"relativePath":"guide/Linux/Monitor/Prometheus/4-promql_operator.md","filePath":"guide/Linux/Monitor/Prometheus/4-promql_operator.md","lastUpdated":1736763438000}'),l={name:"guide/Linux/Monitor/Prometheus/4-promql_operator.md"},t=e(`<h1 id="_1-promql-æ“ä½œç¬¦" tabindex="-1">1. PromQL æ“ä½œç¬¦ <a class="header-anchor" href="#_1-promql-æ“ä½œç¬¦" aria-label="Permalink to &quot;1. PromQL æ“ä½œç¬¦&quot;">â€‹</a></h1><p><a href="https://prometheus.io/docs/prometheus/2.55/querying/operators/" target="_blank" rel="noreferrer">å®˜å½“</a></p><p>Prometheus çš„æŸ¥è¯¢è¯­è¨€æ”¯æŒåŸºæœ¬çš„é€»è¾‘å’Œç®—æœ¯è¿ç®—ç¬¦ã€‚å¯¹äºä¸¤ä¸ªå³æ—¶å‘é‡ä¹‹é—´çš„è¿ç®—ï¼Œ<a href="https://prometheus.io/docs/prometheus/2.55/querying/operators/#vector-matching" target="_blank" rel="noreferrer">åŒ¹é…è¡Œä¸º</a> å¯ä»¥ä¿®æ”¹</p><h2 id="_1-1-äºŒå…ƒæ“ä½œç¬¦" tabindex="-1">1.1 äºŒå…ƒæ“ä½œç¬¦ <a class="header-anchor" href="#_1-1-äºŒå…ƒæ“ä½œç¬¦" aria-label="Permalink to &quot;1.1 äºŒå…ƒæ“ä½œç¬¦&quot;">â€‹</a></h2><p>PromQL çš„äºŒå…ƒæ“ä½œç¬¦æ”¯æŒåŸºæœ¬çš„é€»è¾‘å’Œç®—æœ¯è¿ç®—ï¼ŒåŒ…å«<strong>ç®—æœ¯ç±»</strong>ã€<strong>æ¯”è¾ƒç±»</strong>å’Œ<strong>é€»è¾‘ç±»</strong>ä¸‰å¤§ç±»</p><h3 id="_1-ç®—æœ¯ç±»äºŒå…ƒæ“ä½œç¬¦" tabindex="-1">1.ç®—æœ¯ç±»äºŒå…ƒæ“ä½œç¬¦ <a class="header-anchor" href="#_1-ç®—æœ¯ç±»äºŒå…ƒæ“ä½œç¬¦" aria-label="Permalink to &quot;1.ç®—æœ¯ç±»äºŒå…ƒæ“ä½œç¬¦&quot;">â€‹</a></h3><p>ç®—æœ¯ç±»äºŒå…ƒæ“ä½œç¬¦æœ‰ä»¥ä¸‹å‡ ç§ï¼š</p><ul><li><code>+</code>ï¼šåŠ </li><li><code>-</code>ï¼šå‡</li><li><code>*</code>ï¼šä¹˜</li><li><code>/</code>ï¼šé™¤</li><li><code>%</code>ï¼šæ±‚ä½™</li><li><code>^</code>ï¼šä¹˜æ–¹æˆ–è€…æ±‚å¹‚</li></ul><p>ç®—æœ¯ç±»äºŒå…ƒæ“ä½œç¬¦å¯ä»¥ä½¿ç”¨åœ¨æ ‡é‡ä¸æ ‡é‡ã€å‘é‡ä¸æ ‡é‡ï¼Œä»¥åŠå‘é‡ä¸å‘é‡ä¹‹é—´ã€‚</p><p>æ¯”å¦‚ï¼šæ ‡é‡ä¸æ ‡é‡</p><p><img src="https://nnaigos.oss-cn-hangzhou.aliyuncs.com/imgs/202501031431511.png" alt="image-20250103143128927"></p><p>æ¯”å¦‚ï¼šå³æ—¶å‘é‡ä¸æ ‡é‡</p><p>è®¡ç®—å†…å­˜</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">node_memory_MemTotal_bytes/(1024*1024)</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">node_memory_MemTotal_bytes/(1024*1024)</span></span></code></pre></div><p><img src="https://nnaigos.oss-cn-hangzhou.aliyuncs.com/imgs/202501031433914.png" alt="image-20250103143316413"></p><p>æ¯”å¦‚ï¼šå‘é‡å’Œå‘é‡</p><p>è·å–å†…å­˜ä½¿ç”¨ç‡</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">node_memory_Active_bytes / node_memory_MemTotal_bytes * 100</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">node_memory_Active_bytes / node_memory_MemTotal_bytes * 100</span></span></code></pre></div><p><img src="https://nnaigos.oss-cn-hangzhou.aliyuncs.com/imgs/202501031438454.png" alt="image-20250103143803346"></p><p><strong>äºŒå…ƒæ“ä½œç¬¦ä¸Šä¸‹æ–‡é‡Œçš„å‘é‡ç‰¹æŒ‡ç¬æ—¶å‘é‡ï¼Œä¸åŒ…æ‹¬åŒºé—´å‘é‡ã€‚</strong></p><ul><li>æ ‡é‡ä¸æ ‡é‡ä¹‹é—´ï¼Œç»“æœå¾ˆæ˜æ˜¾ï¼Œè·Ÿé€šå¸¸çš„ç®—æœ¯è¿ç®—ä¸€è‡´ã€‚</li><li>å‘é‡ä¸æ ‡é‡ä¹‹é—´ï¼Œç›¸å½“äºæŠŠæ ‡é‡è·Ÿå‘é‡é‡Œçš„æ¯ä¸€ä¸ªæ ‡é‡è¿›è¡Œè¿ç®—ï¼Œè¿™äº›è®¡ç®—ç»“æœç»„æˆäº†ä¸€ä¸ªæ–°çš„å‘é‡ã€‚</li><li>å‘é‡ä¸å‘é‡ä¹‹é—´ï¼Œä¼šç¨å¾®éº»çƒ¦ä¸€äº›ã€‚è¿ç®—çš„æ—¶å€™é¦–å…ˆä¼šä¸ºå·¦è¾¹å‘é‡é‡Œçš„æ¯ä¸€ä¸ªå…ƒç´ åœ¨å³è¾¹å‘é‡é‡Œå»å¯»æ‰¾ä¸€ä¸ªåŒ¹é…å…ƒç´ ï¼ˆåŒ¹é…è§„åˆ™åé¢ä¼šè®²ï¼‰ï¼Œç„¶åå¯¹è¿™ä¸¤ä¸ªåŒ¹é…å…ƒç´ æ‰§è¡Œè®¡ç®—ï¼Œè¿™æ ·æ¯å¯¹åŒ¹é…å…ƒç´ çš„è®¡ç®—ç»“æœç»„æˆäº†ä¸€ä¸ªæ–°çš„å‘é‡ã€‚å¦‚æœæ²¡æœ‰æ‰¾åˆ°åŒ¹é…å…ƒç´ ï¼Œåˆ™è¯¥å…ƒç´ ä¸¢å¼ƒã€‚</li></ul><h3 id="_2-æ¯”è¾ƒç±»äºŒå…ƒæ“ä½œç¬¦" tabindex="-1">2.æ¯”è¾ƒç±»äºŒå…ƒæ“ä½œç¬¦ <a class="header-anchor" href="#_2-æ¯”è¾ƒç±»äºŒå…ƒæ“ä½œç¬¦" aria-label="Permalink to &quot;2.æ¯”è¾ƒç±»äºŒå…ƒæ“ä½œç¬¦&quot;">â€‹</a></h3><p>æ¯”è¾ƒç±»äºŒå…ƒæ“ä½œç¬¦æœ‰ä»¥ä¸‹å‡ ç§ï¼š</p><ul><li><code>==</code> (equal)</li><li><code>!=</code> (not-equal)</li><li><code>&gt;</code> (greater-than)</li><li><code>&lt;</code> (less-than)</li><li><code>&gt;=</code> (greater-or-equal)</li><li><code>&lt;=</code> (less-or-equal)</li></ul><p>æ¯”è¾ƒç±»äºŒå…ƒæ“ä½œç¬¦åŒæ ·å¯ä»¥ä½¿ç”¨åœ¨æ ‡é‡ä¸æ ‡é‡ã€å‘é‡ä¸æ ‡é‡ï¼Œä»¥åŠå‘é‡ä¸å‘é‡ä¹‹é—´ã€‚é»˜è®¤æ‰§è¡Œçš„æ˜¯è¿‡æ»¤ï¼Œä¹Ÿå°±æ˜¯ä¿ç•™å€¼ã€‚</p><p>ä¹Ÿå¯ä»¥é€šè¿‡åœ¨è¿ç®—ç¬¦åé¢è·Ÿ bool ä¿®é¥°ç¬¦æ¥ä½¿å¾—è¿”å›å€¼ 0 å’Œ 1ï¼Œè€Œä¸æ˜¯è¿‡æ»¤ã€‚</p><ul><li>æ ‡é‡ä¸æ ‡é‡ä¹‹é—´ï¼Œå¿…é¡»è·Ÿ bool ä¿®é¥°ç¬¦ï¼Œå› æ­¤ç»“æœåªå¯èƒ½æ˜¯ 0ï¼ˆfalseï¼‰ æˆ– 1ï¼ˆtrueï¼‰ã€‚</li><li>å‘é‡ä¸æ ‡é‡ä¹‹é—´ï¼Œç›¸å½“äºæŠŠå‘é‡é‡Œçš„æ¯ä¸€ä¸ªæ ‡é‡è·Ÿæ ‡é‡è¿›è¡Œæ¯”è¾ƒï¼Œç»“æœä¸ºçœŸåˆ™ä¿ç•™ï¼Œå¦åˆ™ä¸¢å¼ƒã€‚å¦‚æœåé¢è·Ÿäº† bool ä¿®é¥°ç¬¦ï¼Œåˆ™ç»“æœåˆ†åˆ«ä¸º 1 å’Œ 0ã€‚</li><li>å‘é‡ä¸å‘é‡ä¹‹é—´ï¼Œè¿ç®—è¿‡ç¨‹ç±»ä¼¼äºç®—æœ¯ç±»æ“ä½œç¬¦ï¼Œåªä¸è¿‡å¦‚æœæ¯”è¾ƒç»“æœä¸ºçœŸåˆ™ä¿ç•™å·¦è¾¹çš„å€¼ï¼ˆåŒ…æ‹¬åº¦é‡æŒ‡æ ‡å’Œæ ‡ç­¾è¿™äº›å±æ€§ï¼‰ï¼Œå¦åˆ™ä¸¢å¼ƒï¼Œæ²¡æ‰¾åˆ°åŒ¹é…ä¹Ÿæ˜¯ä¸¢å¼ƒã€‚å¦‚æœåé¢è·Ÿäº† bool ä¿®é¥°ç¬¦ï¼Œåˆ™ä¿ç•™å’Œä¸¢å¼ƒæ—¶ç»“æœç›¸åº”ä¸º 1 å’Œ 0ã€‚</li></ul><p>æ¯”å¦‚ï¼šæ ‡é‡ä¸æ ‡é‡</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">12 &gt; bool 10</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">12 &gt; bool 10</span></span></code></pre></div><p>æ¯”å¦‚ï¼šå³æ—¶å‘é‡ä¸æ ‡é‡</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">node_load1 &gt; bool 1</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">node_load1 &gt; bool 1</span></span></code></pre></div><p>æ¯”å¦‚ï¼šå‘é‡ä¸å‘é‡</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">node_memory_MemAvailable_bytes &gt; bool node_memory_MemTotal_bytes</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">node_memory_MemAvailable_bytes &gt; bool node_memory_MemTotal_bytes</span></span></code></pre></div><h3 id="_3-é€»è¾‘ç±»äºŒå…ƒæ“ä½œç¬¦" tabindex="-1">3.é€»è¾‘ç±»äºŒå…ƒæ“ä½œç¬¦ <a class="header-anchor" href="#_3-é€»è¾‘ç±»äºŒå…ƒæ“ä½œç¬¦" aria-label="Permalink to &quot;3.é€»è¾‘ç±»äºŒå…ƒæ“ä½œç¬¦&quot;">â€‹</a></h3><p>é€»è¾‘æ“ä½œç¬¦ä»…ç”¨äºå‘é‡ä¸å‘é‡ä¹‹é—´ã€‚</p><ul><li><code>and</code>ï¼šäº¤é›†</li><li><code>or</code>ï¼šåˆé›†</li><li><code>unless</code>ï¼šè¡¥é›†</li></ul><p>å…·ä½“è¿ç®—è§„åˆ™å¦‚ä¸‹ï¼š</p><ul><li><code>vector1 and vector2</code> çš„ç»“æœç”±åœ¨ vector2 é‡Œæœ‰åŒ¹é…ï¼ˆæ ‡ç­¾é”®å€¼å¯¹ç»„åˆç›¸åŒï¼‰å…ƒç´ çš„ vector1 é‡Œçš„å…ƒç´ ç»„æˆã€‚</li><li><code>vector1 or vector2</code> çš„ç»“æœç”±æ‰€æœ‰ vector1 é‡Œçš„å…ƒç´ åŠ ä¸Šåœ¨ vector1 é‡Œæ²¡æœ‰åŒ¹é…ï¼ˆæ ‡ç­¾é”®å€¼å¯¹ç»„åˆç›¸åŒï¼‰å…ƒç´ çš„ vector2 é‡Œçš„å…ƒç´ ç»„æˆã€‚</li><li><code>vector1 unless vector2</code> çš„ç»“æœç”±åœ¨ vector2 é‡Œæ²¡æœ‰åŒ¹é…ï¼ˆæ ‡ç­¾é”®å€¼å¯¹ç»„åˆç›¸åŒï¼‰å…ƒç´ çš„ vector1 é‡Œçš„å…ƒç´ ç»„æˆã€‚</li></ul><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">node_cpu_seconds_total{mode=~&quot;idle|user&quot;} and node_cpu_seconds_total{mode=~&quot;system|user&quot;}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">node_cpu_seconds_total{mode=~&quot;idle|user&quot;} and node_cpu_seconds_total{mode=~&quot;system|user&quot;}</span></span></code></pre></div><h3 id="_4-äºŒå…ƒæ“ä½œç¬¦ä¼˜å…ˆçº§" tabindex="-1">4.äºŒå…ƒæ“ä½œç¬¦ä¼˜å…ˆçº§ <a class="header-anchor" href="#_4-äºŒå…ƒæ“ä½œç¬¦ä¼˜å…ˆçº§" aria-label="Permalink to &quot;4.äºŒå…ƒæ“ä½œç¬¦ä¼˜å…ˆçº§&quot;">â€‹</a></h3><p>PromQL çš„å„ç±»äºŒå…ƒæ“ä½œç¬¦è¿ç®—ä¼˜å…ˆçº§å¦‚ä¸‹ï¼š</p><ol><li><code>^</code></li><li><code>*, /, %</code></li><li><code>+, -</code></li><li><code>==, !=, &lt;=, &lt;, &gt;=, &gt;</code></li><li><code>and, unless</code>-&gt;é€»è¾‘è¿ç®—</li><li><code>or</code>-&gt;é€»è¾‘è¿ç®—</li></ol><h5 id="and" tabindex="-1">and <a class="header-anchor" href="#and" aria-label="Permalink to &quot;and&quot;">â€‹</a></h5><p>andé€»è¾‘è¿ç®—ä¼šäº§ç”Ÿä¸€ä¸ªç”±vector1çš„å…ƒç´ ç»„æˆçš„æ–°çš„å‘é‡ã€‚è¯¥å‘é‡åŒ…å«vector1ä¸­å®Œå…¨åŒ¹é…vector2ä¸­çš„å…ƒç´ ã€‚è¡¨è¾¾å¼ç¤ºä¾‹å¦‚ä¸‹ï¼š<code>å½“å¤šä¸ªæ¡ä»¶è¢«åŒæ—¶æ»¡è¶³æ—¶è¿›è¡Œæ˜¾ç¤º</code></p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">node_filesystem_size_bytes{fstype!=&quot;tmpfs&quot;} and node_filesystem_size_bytes != 0 and node_filesystem_size_bytes{mountpoint=&quot;/root-disk&quot;}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">node_filesystem_size_bytes{fstype!=&quot;tmpfs&quot;} and node_filesystem_size_bytes != 0 and node_filesystem_size_bytes{mountpoint=&quot;/root-disk&quot;}</span></span></code></pre></div><h5 id="or" tabindex="-1">or <a class="header-anchor" href="#or" aria-label="Permalink to &quot;or&quot;">â€‹</a></h5><p>oré€»è¾‘è¿ç®—ä¼šäº§ç”Ÿä¸€ä¸ªæ–°çš„å‘é‡ï¼Œè¯¥å‘é‡åŒ…å«vector1çš„æ‰€æœ‰åŸå§‹å…ƒç´ ï¼ˆæ ‡ç­¾é›†+å€¼ï¼‰çš„å‘é‡ï¼Œä»¥åŠvector2ä¸­æ²¡æœ‰ä¸vector1åŒ¹é…æ ‡ç­¾é›†çš„æ‰€æœ‰å…ƒç´ ã€‚å‡è®¾åˆ¤æ–­node_test_metricæŒ‡æ ‡æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœæŒ‡æ ‡ä¸å­˜åœ¨åˆ™è¿”å›0ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸æ¯ä¸ªç›®æ ‡å…³è”çš„upæŒ‡æ ‡è¿›è¡Œè¡¨è¾¾å¼æ“ä½œï¼š</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">node_filesystem_avail_bytes &gt; 200000 or node_filesystem_avail_bytes &lt; 2500000</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">node_filesystem_avail_bytes &gt; 200000 or node_filesystem_avail_bytes &lt; 2500000</span></span></code></pre></div><h5 id="unless" tabindex="-1">unless <a class="header-anchor" href="#unless" aria-label="Permalink to &quot;unless&quot;">â€‹</a></h5><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">#å½“ç¬¬ä¸€ä¸ªå€¼çš„æ ‡ç­¾å’Œç¬¬äºŒä¸ªå€¼çš„æ ‡ç­¾ä¸åŒ¹é…çš„æƒ…å†µä¸‹ä¼šè¾“å‡º</span></span>
<span class="line"><span style="color:#e1e4e8;">up{instance=&quot;192.168.1.20:9100&quot;,job=&quot;node&quot;} unless up{instance=&quot;192.168.1.21:9100&quot;,job=&quot;node&quot;}</span></span>
<span class="line"><span style="color:#e1e4e8;"> </span></span>
<span class="line"><span style="color:#e1e4e8;">#å½“æ ‡ç­¾ç›¸åŒæ—¶åˆ™ä¸è¾“å‡º</span></span>
<span class="line"><span style="color:#e1e4e8;">up{instance=&quot;192.168.1.20:9100&quot;,job=&quot;node&quot;} unless up{instance=&quot;192.168.1.20:9100&quot;,job=&quot;node&quot;}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">#å½“ç¬¬ä¸€ä¸ªå€¼çš„æ ‡ç­¾å’Œç¬¬äºŒä¸ªå€¼çš„æ ‡ç­¾ä¸åŒ¹é…çš„æƒ…å†µä¸‹ä¼šè¾“å‡º</span></span>
<span class="line"><span style="color:#24292e;">up{instance=&quot;192.168.1.20:9100&quot;,job=&quot;node&quot;} unless up{instance=&quot;192.168.1.21:9100&quot;,job=&quot;node&quot;}</span></span>
<span class="line"><span style="color:#24292e;"> </span></span>
<span class="line"><span style="color:#24292e;">#å½“æ ‡ç­¾ç›¸åŒæ—¶åˆ™ä¸è¾“å‡º</span></span>
<span class="line"><span style="color:#24292e;">up{instance=&quot;192.168.1.20:9100&quot;,job=&quot;node&quot;} unless up{instance=&quot;192.168.1.20:9100&quot;,job=&quot;node&quot;}</span></span></code></pre></div><h2 id="_1-2-å‘é‡åŒ¹é…" tabindex="-1">1.2 å‘é‡åŒ¹é… <a class="header-anchor" href="#_1-2-å‘é‡åŒ¹é…" aria-label="Permalink to &quot;1.2 å‘é‡åŒ¹é…&quot;">â€‹</a></h2><p>ç®—æœ¯ç±»å’Œæ¯”è¾ƒç±»æ“ä½œç¬¦éƒ½éœ€è¦åœ¨å‘é‡ä¹‹é—´è¿›è¡ŒåŒ¹é…ã€‚å…±æœ‰ä¸¤ç§åŒ¹é…ç±»å‹ï¼Œ<code>one-to-one</code> å’Œ <code>many-to-one</code> / <code>one-to-many</code></p><h3 id="_1-one-to-one-å‘é‡åŒ¹é…" tabindex="-1">1.One-to-one å‘é‡åŒ¹é… <a class="header-anchor" href="#_1-one-to-one-å‘é‡åŒ¹é…" aria-label="Permalink to &quot;1.One-to-one å‘é‡åŒ¹é…&quot;">â€‹</a></h3><p>è¿™ç§åŒ¹é…æ¨¡å¼ä¸‹ï¼Œä¸¤è¾¹å‘é‡é‡Œçš„å…ƒç´ å¦‚æœå…¶æ ‡ç­¾é”®å€¼å¯¹ç»„åˆç›¸åŒåˆ™ä¸ºåŒ¹é…ï¼Œå¹¶ä¸”åªä¼šæœ‰ä¸€ä¸ªåŒ¹é…å…ƒç´ ã€‚å¯ä»¥ä½¿ç”¨ <code>ignoring</code> å…³é”®è¯æ¥å¿½ç•¥ä¸å‚ä¸åŒ¹é…çš„æ ‡ç­¾ï¼Œæˆ–è€…ä½¿ç”¨ <code>on</code> å…³é”®è¯æ¥æŒ‡å®šè¦å‚ä¸åŒ¹é…çš„æ ‡ç­¾ã€‚è¯­æ³•å¦‚ä¸‹ï¼š</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">&lt;</span><span style="color:#E1E4E8;">vector expr</span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">&lt;</span><span style="color:#E1E4E8;">bin-op</span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;"> ignoring(</span><span style="color:#F97583;">&lt;</span><span style="color:#E1E4E8;">label list</span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">&lt;</span><span style="color:#E1E4E8;">vector expr</span><span style="color:#F97583;">&gt;</span></span>
<span class="line"><span style="color:#F97583;">&lt;</span><span style="color:#E1E4E8;">vector expr</span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">&lt;</span><span style="color:#E1E4E8;">bin-op</span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;"> on(</span><span style="color:#F97583;">&lt;</span><span style="color:#E1E4E8;">label list</span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">&lt;</span><span style="color:#E1E4E8;">vector expr</span><span style="color:#F97583;">&gt;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">&lt;</span><span style="color:#24292E;">vector expr</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&lt;</span><span style="color:#24292E;">bin-op</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;"> ignoring(</span><span style="color:#D73A49;">&lt;</span><span style="color:#24292E;">label list</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">&lt;</span><span style="color:#24292E;">vector expr</span><span style="color:#D73A49;">&gt;</span></span>
<span class="line"><span style="color:#D73A49;">&lt;</span><span style="color:#24292E;">vector expr</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&lt;</span><span style="color:#24292E;">bin-op</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;"> on(</span><span style="color:#D73A49;">&lt;</span><span style="color:#24292E;">label list</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">&lt;</span><span style="color:#24292E;">vector expr</span><span style="color:#D73A49;">&gt;</span></span></code></pre></div><p>æ¯”å¦‚ï¼š</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">process_open_fds</span><span style="color:#E1E4E8;">{instance=</span><span style="color:#B392F0;">&quot;10.103.236.199&quot;</span><span style="color:#B392F0;">,</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">job=&quot;node-exporter-10.103.236.199&quot;}</span><span style="color:#E1E4E8;">    </span></span>
<span class="line"><span style="color:#B392F0;">/</span></span>
<span class="line"><span style="color:#B392F0;">process_max_fds</span><span style="color:#E1E4E8;">{instance=</span><span style="color:#B392F0;">&quot;10.103.236.199&quot;</span><span style="color:#B392F0;">,</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">job=&quot;node-exporter-10.103.236.199&quot;}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">process_open_fds</span><span style="color:#24292E;">{instance=</span><span style="color:#6F42C1;">&quot;10.103.236.199&quot;</span><span style="color:#6F42C1;">,</span><span style="color:#24292E;"> </span><span style="color:#032F62;">job=&quot;node-exporter-10.103.236.199&quot;}</span><span style="color:#24292E;">    </span></span>
<span class="line"><span style="color:#6F42C1;">/</span></span>
<span class="line"><span style="color:#6F42C1;">process_max_fds</span><span style="color:#24292E;">{instance=</span><span style="color:#6F42C1;">&quot;10.103.236.199&quot;</span><span style="color:#6F42C1;">,</span><span style="color:#24292E;"> </span><span style="color:#032F62;">job=&quot;node-exporter-10.103.236.199&quot;}</span></span></code></pre></div><p>æ¯”å¦‚ï¼šignoring</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">node_disk_read_time_seconds_total</span><span style="color:#E1E4E8;">{device=</span><span style="color:#B392F0;">&quot;nvme0n1&quot;</span><span style="color:#B392F0;">}</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">+</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">ignoring</span><span style="color:#E1E4E8;">(</span><span style="color:#B392F0;">device</span><span style="color:#E1E4E8;">) </span><span style="color:#9ECBFF;">node_disk_read_time_seconds_total{device=&quot;dm-0&quot;}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">node_disk_read_time_seconds_total</span><span style="color:#24292E;">{device=</span><span style="color:#6F42C1;">&quot;nvme0n1&quot;</span><span style="color:#6F42C1;">}</span><span style="color:#24292E;"> </span><span style="color:#032F62;">+</span><span style="color:#24292E;"> </span><span style="color:#032F62;">ignoring</span><span style="color:#24292E;">(</span><span style="color:#6F42C1;">device</span><span style="color:#24292E;">) </span><span style="color:#032F62;">node_disk_read_time_seconds_total{device=&quot;dm-0&quot;}</span></span></code></pre></div><div class="warning custom-block"><p class="custom-block-title">ğŸ’¡ è¯´æ˜</p><p>è®°ä½ä¸€å¥è¯ä¸¤ä¸ªå‘é‡ä¹‹é—´åšè¿ç®—å¿…é¡»ä¸¤è¾¹çš„æ ‡ç­¾åå’Œæ ‡ç­¾å€¼å¿…é¡»åŒ¹é…æ‰èƒ½åšè®¡ç®—</p></div><p>æ¯”å¦‚ï¼š</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">#è¡¨è¾¾å¼ä¸­ä½¿ç”¨åˆ°äº†rate()å‡½æ•°ï¼Œå³è®¡ç®—æŸä¸ªæ—¶é—´åºåˆ—èŒƒå›´å†…çš„å¹³å‡å¢é•¿ç‡</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">sum</span><span style="color:#E1E4E8;"> (rate(node_cpu_seconds_total{mode</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&quot;idle&quot;}[</span><span style="color:#79B8FF;">5</span><span style="color:#9ECBFF;">m]</span><span style="color:#E1E4E8;">)) </span><span style="color:#B392F0;">by</span><span style="color:#E1E4E8;"> (instance) / sum (</span><span style="color:#B392F0;">rate(node_cpu_seconds_total[5m]</span><span style="color:#E1E4E8;">)) by (</span><span style="color:#B392F0;">instance</span><span style="color:#E1E4E8;">)</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">#è¡¨è¾¾å¼ä¸­ä½¿ç”¨åˆ°äº†rate()å‡½æ•°ï¼Œå³è®¡ç®—æŸä¸ªæ—¶é—´åºåˆ—èŒƒå›´å†…çš„å¹³å‡å¢é•¿ç‡</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">sum</span><span style="color:#24292E;"> (rate(node_cpu_seconds_total{mode</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&quot;idle&quot;}[</span><span style="color:#005CC5;">5</span><span style="color:#032F62;">m]</span><span style="color:#24292E;">)) </span><span style="color:#6F42C1;">by</span><span style="color:#24292E;"> (instance) / sum (</span><span style="color:#6F42C1;">rate(node_cpu_seconds_total[5m]</span><span style="color:#24292E;">)) by (</span><span style="color:#6F42C1;">instance</span><span style="color:#24292E;">)</span></span></code></pre></div><h3 id="_2-many-to-one-one-to-many-å‘é‡åŒ¹é…" tabindex="-1">2.Many-to-one / one-to-many å‘é‡åŒ¹é… <a class="header-anchor" href="#_2-many-to-one-one-to-many-å‘é‡åŒ¹é…" aria-label="Permalink to &quot;2.Many-to-one / one-to-many å‘é‡åŒ¹é…&quot;">â€‹</a></h3><p>å¤šå¯¹ä¸€å’Œä¸€å¯¹å¤šçš„åŒ¹é…æ¨¡å¼ï¼Œå¯ä»¥ç†è§£ä¸ºå¦‚æœä¸¤ä¸ªç¬æ—¶å‘é‡æ•°é‡ä¸ä¸€è‡´æ—¶å¯é€šè¿‡ã€‚è¿™æ—¶å°±éœ€è¦ä½¿ç”¨ <code>group_left</code> æˆ– <code>group_right</code> ç»„ä¿®é¥°ç¬¦æ¥æŒ‡æ˜å“ªè¾¹åŒ¹é…å…ƒç´ è¾ƒå¤šï¼Œå·¦è¾¹å¤šåˆ™ç”¨ <code>group_left</code>ï¼Œå³è¾¹å¤šåˆ™ç”¨ <code>group_right</code>ã€‚å…¶è¯­æ³•å¦‚ä¸‹ï¼š</p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#9ECBFF;">&lt;vector expr&gt; &lt;bin-op&gt; ignoring(&lt;label list&gt;) group_left(&lt;label list&gt;) &lt;vector expr&gt;</span></span>
<span class="line"><span style="color:#9ECBFF;">&lt;vector expr&gt; &lt;bin-op&gt; ignoring(&lt;label list&gt;) group_right(&lt;label list&gt;) &lt;vector expr&gt;</span></span>
<span class="line"><span style="color:#9ECBFF;">&lt;vector expr&gt; &lt;bin-op&gt; on(&lt;label list&gt;) group_left(&lt;label list&gt;) &lt;vector expr&gt;</span></span>
<span class="line"><span style="color:#9ECBFF;">&lt;vector expr&gt; &lt;bin-op&gt; on(&lt;label list&gt;) group_right(&lt;label list&gt;) &lt;vector expr&gt;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#032F62;">&lt;vector expr&gt; &lt;bin-op&gt; ignoring(&lt;label list&gt;) group_left(&lt;label list&gt;) &lt;vector expr&gt;</span></span>
<span class="line"><span style="color:#032F62;">&lt;vector expr&gt; &lt;bin-op&gt; ignoring(&lt;label list&gt;) group_right(&lt;label list&gt;) &lt;vector expr&gt;</span></span>
<span class="line"><span style="color:#032F62;">&lt;vector expr&gt; &lt;bin-op&gt; on(&lt;label list&gt;) group_left(&lt;label list&gt;) &lt;vector expr&gt;</span></span>
<span class="line"><span style="color:#032F62;">&lt;vector expr&gt; &lt;bin-op&gt; on(&lt;label list&gt;) group_right(&lt;label list&gt;) &lt;vector expr&gt;</span></span></code></pre></div><p>æ¯”å¦‚ï¼š</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">sum by (node) ((kube_pod_status_phase{phase=&quot;Running&quot;} == 1) + on(pod) group_left(node) (0 * kube_pod_info{pod_template_hash=&quot;&quot;})) / sum by (node) (kube_node_status_allocatable{resource=&quot;pods&quot;}) * 100 &gt; 90</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">sum by (node) ((kube_pod_status_phase{phase=&quot;Running&quot;} == 1) + on(pod) group_left(node) (0 * kube_pod_info{pod_template_hash=&quot;&quot;})) / sum by (node) (kube_node_status_allocatable{resource=&quot;pods&quot;}) * 100 &gt; 90</span></span></code></pre></div><h2 id="_1-3-èšåˆæ“ä½œç¬¦" tabindex="-1">1.3 èšåˆæ“ä½œç¬¦ <a class="header-anchor" href="#_1-3-èšåˆæ“ä½œç¬¦" aria-label="Permalink to &quot;1.3 èšåˆæ“ä½œç¬¦&quot;">â€‹</a></h2><p><a href="https://prometheus.io/docs/prometheus/2.55/querying/operators/#aggregation-operators" target="_blank" rel="noreferrer">PromQL</a> çš„èšåˆæ“ä½œç¬¦ç”¨æ¥å°†å‘é‡é‡Œçš„å…ƒç´ èšåˆå¾—æ›´å°‘ã€‚æ€»å…±æœ‰ä¸‹é¢è¿™äº›èšåˆæ“ä½œç¬¦ï¼š</p><table><thead><tr><th>æ“ä½œç¬¦</th><th>æè¿°</th></tr></thead><tbody><tr><td>sum</td><td>æ±‚å’Œ</td></tr><tr><td>min</td><td>æœ€å°å€¼</td></tr><tr><td>max</td><td>æœ€å¤§å€¼</td></tr><tr><td>avg</td><td>å¹³å‡å€¼</td></tr><tr><td>stddev</td><td>æ ‡å‡†å·®</td></tr><tr><td>stdvar</td><td>æ–¹å·®</td></tr><tr><td>count</td><td>å…ƒç´ ä¸ªæ•°</td></tr><tr><td><code>count_values</code>,æ”¯æŒparameter</td><td>ç­‰äºæŸå€¼çš„å…ƒç´ ä¸ªæ•°</td></tr><tr><td><code>bottomk</code>ï¼Œæ”¯æŒparameter</td><td>æœ€å°çš„ k ä¸ªå…ƒç´ </td></tr><tr><td><code>topk</code>ï¼Œæ”¯æŒparameter</td><td>æœ€å¤§çš„ k ä¸ªå…ƒç´ </td></tr><tr><td><code>quantile</code>ï¼Œæ”¯æŒparameter</td><td>åˆ†ä½æ•°</td></tr><tr><td>limitk(ä½¿ç”¨limitçš„å¼€å¯ --enable-feature=promql-experimental-functionsåŠŸèƒ½)</td><td></td></tr><tr><td>limit_ratio</td><td></td></tr></tbody></table><p>èšåˆæ“ä½œç¬¦è¯­æ³•å¦‚ä¸‹ï¼š</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">&lt;</span><span style="color:#E1E4E8;">aggr-op</span><span style="color:#9ECBFF;">&gt;([parameter,] </span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">vector expression</span><span style="color:#F97583;">&gt;</span><span style="color:#9ECBFF;">)</span><span style="color:#E1E4E8;"> [without</span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">by (</span><span style="color:#F97583;">&lt;</span><span style="color:#E1E4E8;">label list</span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;">)]</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">&lt;</span><span style="color:#24292E;">aggr-op</span><span style="color:#032F62;">&gt;([parameter,] </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">vector expression</span><span style="color:#D73A49;">&gt;</span><span style="color:#032F62;">)</span><span style="color:#24292E;"> [without</span><span style="color:#D73A49;">|</span><span style="color:#24292E;">by (</span><span style="color:#D73A49;">&lt;</span><span style="color:#24292E;">label list</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;">)]</span></span></code></pre></div><p>å…¶ä¸­ <code>without</code> ç”¨æ¥æŒ‡å®šä¸éœ€è¦ä¿ç•™çš„æ ‡ç­¾ï¼ˆä¹Ÿå°±æ˜¯è¿™äº›æ ‡ç­¾çš„å¤šä¸ªå€¼ä¼šè¢«èšåˆï¼‰ï¼Œè€Œ <code>by</code> æ­£å¥½ç›¸åï¼Œç”¨æ¥æŒ‡å®šéœ€è¦ä¿ç•™çš„æ ‡ç­¾ï¼ˆä¹Ÿå°±æ˜¯æŒ‰è¿™äº›æ ‡ç­¾æ¥èšåˆï¼‰</p><h3 id="_1-sum" tabindex="-1">1.sum <a class="header-anchor" href="#_1-sum" aria-label="Permalink to &quot;1.sum&quot;">â€‹</a></h3><p>sumå’Œwithoutæ˜¯åŒæ—¶å­˜åœ¨çš„</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">sum(node_timex_sync_status</span><span style="color:#E1E4E8;">) without (</span><span style="color:#B392F0;">job,mode</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;"> </span></span>
<span class="line"><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">ç­‰ä»·äº</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">sum(node_timex_sync_status</span><span style="color:#E1E4E8;">) by (</span><span style="color:#B392F0;">instance</span><span style="color:#E1E4E8;">)</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;"> </span><span style="color:#6F42C1;">sum(node_timex_sync_status</span><span style="color:#24292E;">) without (</span><span style="color:#6F42C1;">job,mode</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;"> </span></span>
<span class="line"><span style="color:#24292E;"> </span><span style="color:#6F42C1;">ç­‰ä»·äº</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">sum(node_timex_sync_status</span><span style="color:#24292E;">) by (</span><span style="color:#6F42C1;">instance</span><span style="color:#24292E;">)</span></span></code></pre></div><h3 id="_2-max" tabindex="-1">2.max <a class="header-anchor" href="#_2-max" aria-label="Permalink to &quot;2.max&quot;">â€‹</a></h3><p>è¿”å›æ‰€æœ‰è®°å½•çš„æœ€å¤§å€¼</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">max(node_cpu_seconds_total) by (mode)</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">max(node_cpu_seconds_total) by (mode)</span></span></code></pre></div><h3 id="_3-avg" tabindex="-1">3.avg <a class="header-anchor" href="#_3-avg" aria-label="Permalink to &quot;3.avg&quot;">â€‹</a></h3><p>avg å‡½æ•°è¿”å›æ‰€æœ‰è®°å½•çš„å¹³å‡å€¼ã€‚</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">avg(node_cpu_seconds_total) by (mode)</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">avg(node_cpu_seconds_total) by (mode)</span></span></code></pre></div><p>cpuå¤§äº80%</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">100</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">-</span><span style="color:#E1E4E8;">(</span><span style="color:#B392F0;">avg</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">by</span><span style="color:#E1E4E8;">(</span><span style="color:#B392F0;">instance</span><span style="color:#E1E4E8;">)(</span><span style="color:#B392F0;">rate(node_cpu_seconds_total</span><span style="color:#E1E4E8;">{mode=</span><span style="color:#B392F0;">&quot;idle&quot;</span><span style="color:#B392F0;">}[2m]</span><span style="color:#E1E4E8;">)) </span><span style="color:#79B8FF;">*</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">100</span><span style="color:#E1E4E8;">)</span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;"> 80</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">100</span><span style="color:#24292E;"> </span><span style="color:#032F62;">-</span><span style="color:#24292E;">(</span><span style="color:#6F42C1;">avg</span><span style="color:#24292E;"> </span><span style="color:#032F62;">by</span><span style="color:#24292E;">(</span><span style="color:#6F42C1;">instance</span><span style="color:#24292E;">)(</span><span style="color:#6F42C1;">rate(node_cpu_seconds_total</span><span style="color:#24292E;">{mode=</span><span style="color:#6F42C1;">&quot;idle&quot;</span><span style="color:#6F42C1;">}[2m]</span><span style="color:#24292E;">)) </span><span style="color:#005CC5;">*</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">100</span><span style="color:#24292E;">)</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;"> 80</span></span></code></pre></div><h3 id="_4-count" tabindex="-1">4.count <a class="header-anchor" href="#_4-count" aria-label="Permalink to &quot;4.count&quot;">â€‹</a></h3><p>count å‡½æ•°è¿”å›æ‰€æœ‰è®°å½•çš„è®¡æ•°ã€‚</p><p>ä¾‹å¦‚ï¼š<code>count(prometheus_http_requests_total)</code> è¡¨ç¤ºç»Ÿè®¡æ‰€æœ‰ HTTP è¯·æ±‚çš„æ¬¡æ•°ã€‚</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">count(prometheus_http_requests_total</span><span style="color:#E1E4E8;">)</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">count(prometheus_http_requests_total</span><span style="color:#24292E;">)</span></span></code></pre></div><h3 id="_5-bottomk-åå‡ æ¡" tabindex="-1">5.bottomk(<strong>åå‡ æ¡</strong>) <a class="header-anchor" href="#_5-bottomk-åå‡ æ¡" aria-label="Permalink to &quot;5.bottomk(**åå‡ æ¡**)&quot;">â€‹</a></h3><p>ç»Ÿè®¡æœ€å°çš„å‡ ä¸ªå€¼ã€‚ä»æœ€å°å¾€ä¸‹ä¾æ¬¡å¢å¤§è¿›è¡Œæ’åº</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">bottomk(3,sum(node_cpu_seconds_total</span><span style="color:#E1E4E8;">)by (</span><span style="color:#B392F0;">mode</span><span style="color:#E1E4E8;">))</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">3---&gt;ä»£è¡¨æ˜¯å±•ç¤ºå‡ ä¸ª</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">bottomk(3,sum(node_cpu_seconds_total</span><span style="color:#24292E;">)by (</span><span style="color:#6F42C1;">mode</span><span style="color:#24292E;">))</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">3---&gt;ä»£è¡¨æ˜¯å±•ç¤ºå‡ ä¸ª</span></span></code></pre></div><h3 id="_6-topk-å‰å‡ æ¡" tabindex="-1">6.topk(å‰å‡ æ¡) <a class="header-anchor" href="#_6-topk-å‰å‡ æ¡" aria-label="Permalink to &quot;6.topk(å‰å‡ æ¡)&quot;">â€‹</a></h3><p>ç»Ÿè®¡æœ€å¤§çš„å‡ ä¸ªå€¼</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">topk(3,sum(node_cpu_seconds_total</span><span style="color:#E1E4E8;">)by (</span><span style="color:#B392F0;">mode</span><span style="color:#E1E4E8;">))</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">topk(3,sum(node_cpu_seconds_total</span><span style="color:#24292E;">)by (</span><span style="color:#6F42C1;">mode</span><span style="color:#24292E;">))</span></span></code></pre></div>`,94),n=[t];function p(c,r,i,d,y,u){return a(),o("div",null,n)}const b=s(l,[["render",p]]);export{h as __pageData,b as default};
