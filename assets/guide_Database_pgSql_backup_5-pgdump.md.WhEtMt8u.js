import{_ as s,o as a,c as n,R as p}from"./chunks/framework.zUbWieqp.js";const C=JSON.parse('{"title":"1.概述","description":"","frontmatter":{},"headers":[],"relativePath":"guide/Database/pgSql/backup/5-pgdump.md","filePath":"guide/Database/pgSql/backup/5-pgdump.md","lastUpdated":1711723208000}'),l={name:"guide/Database/pgSql/backup/5-pgdump.md"},o=p(`<p>官网，</p><p>​ <a href="https://www.postgresql.org/docs/12/runtime-config-wal.html?spm=a2c4e.10696291.0.0.128d19a4ubIxMT#RUNTIME-CONFIG-WAL-ARCHIVE-RECOVERY" target="_blank" rel="noreferrer">postgresql目标恢复-官网</a></p><p>​ <a href="https://www.postgresql.org/docs/12/continuous-archiving.html#BACKUP-PITR-RECOVERY" target="_blank" rel="noreferrer">postgresql连续归档与恢复-官网</a></p><h1 id="_1-概述" tabindex="-1">1.概述 <a class="header-anchor" href="#_1-概述" aria-label="Permalink to &quot;1.概述&quot;">​</a></h1><p>​ 任何系统都有崩溃的可能，数据库备份工作的重要性毋庸置疑。通过备份和恢复来保护数据，避免数据丢失，在发生灾难或人为误操作的情况下，能够进行恢复是DBA的日常最重要的工作。不仅要保证能够成功备份，还要保证备份数据能够恢复，如果能在更短的时间进行恢复更是锦上添花。利用现有资源，基于现实情况考虑，制定严谨、可靠的备份策略，应对可能出现的需要恢复的情况是每个DBA都应该掌握的基本技能</p><h2 id="_1-1pg-dump和pg-dumpall对比" tabindex="-1">1.1pg_dump和pg_dumpall对比 <a class="header-anchor" href="#_1-1pg-dump和pg-dumpall对比" aria-label="Permalink to &quot;1.1pg_dump和pg_dumpall对比&quot;">​</a></h2><p>备份工具：pg_dump和pg_dumpall</p><p>pg_dump可备份一个指定的database</p><p>pg_dumpall可一次性备份所有database的数据及系统全局数据</p><p>pg_dump比pg_dumpall更合适，因为前者支持精确指定要备份的表，schema和database，而后者不支持</p><p>pg_dump可以将数据备份为SQL文本文件格式，也支持备份为用户定义压缩格式或者是TAR包格式，在数据恢复时，对压缩格式和TAR包格式的备份文件可以实现并行恢复，该特性是从8.4版开始支持</p><p>pg_dumpall工具可以将当前postgresql服务实例中所有database的数据都导出为SQL文本（pg_dumpall不支持导出SQL文本以外的其他格式），也可以同时导出表间定义和角色等全局对象</p><h1 id="_2-pg-dump" tabindex="-1">2.pg_dump <a class="header-anchor" href="#_2-pg-dump" aria-label="Permalink to &quot;2.pg_dump&quot;">​</a></h1><p>pg_dump — 把PostgreSQL数据库抽取为一个脚本文件或其他归档文件。</p><p>pg_dump是用于备份一种PostgreSQL数据库的工具。即使数据库正在被并发使用，它也能创建一致的备份。pg_dump不阻塞其他用户访问数据库（读取或写入）。</p><p>pg_dump只转储单个数据库。要备份一个集簇中 对于所有数据库公共的全局对象（例如角色和表空间），应使用 pg_dumpall</p><h2 id="_2-1-pg-dump" tabindex="-1">2.1 pg_dump <a class="header-anchor" href="#_2-1-pg-dump" aria-label="Permalink to &quot;2.1 pg_dump&quot;">​</a></h2><p>Usage: pg_dump [OPTION]... [DBNAME] <strong>数据库</strong>名放最后，不指定默认是系统变量PGDATABASE指定的数据库</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">General options:(一般选项)</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">  -f, --file=FILENAME          output file or directory name导出后保存的文件名</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">  -F, --format=c|d|t|p         output file format (custom, directory, tar,导出文件的格式</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">                               plain text (default))</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">  -j, --jobs=NUM               use this many parallel jobs to dump并行数</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">  -v, --verbose                verbose mode </span></span>
<span class="line"><span style="color:#e1e4e8;">详细模式 </span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">  -V, --version                output version information, then exit输出版本信息, 然后退出</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">  -Z, --compress=0-9           compression level for compressed formats被压缩格式的压缩级别</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">  --lock-wait-timeout=TIMEOUT  fail after waiting TIMEOUT for a table lock在等待表锁超时后操作失败</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">  -?, --help                   show this help, then exit显示此帮助信息, 然后退出</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">Options controlling the output content:(控制输出的选项)</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">  -a, --data-only              dump only the data, not the schema只导出数据，不包括模式</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">  -b, --blobs                  include large objects in dump在转储中包括大对象</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">  -c, --clean                  clean (drop) database objects before recreating在重新创建之前，先清除（删除）数据库对象</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">  -C, --create                 include commands to create database in dump在转储中包括命令,以便创建数据库（包括建库语句，无需在导入之前先建数据库）</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">  -E, --encoding=ENCODING      dump the data in encoding ENCODING转储以ENCODING形式编码的数据</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">  -n, --schema=SCHEMA          dump the named schema(s) only只转储指定名称的模式</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">  -N, --exclude-schema=SCHEMA  do NOT dump the named schema(s)不转储已命名的模式</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">  -o, --oids                   include OIDs in dump在转储中包括 OID</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">  -O, --no-owner               skip restoration of object ownership in在明文格式中, 忽略恢复对象所属者</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">                               plain-text format </span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">  -s, --schema-only            dump only the schema, no data只转储模式, 不包括数据(不导出数据)</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">  -S, --superuser=NAME         superuser user name to use in plain-text format在转储中, 指定的超级用户名</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">  -t, --table=TABLE            dump the named table(s) only只转储指定名称的表</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">  -T, --exclude-table=TABLE    do NOT dump the named table(s)只转储指定名称的表</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">  -x, --no-privileges          do not dump privileges (grant/revoke)不要转储权限 (grant/revoke)</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">  --binary-upgrade             for use by upgrade utilities only只能由升级工具使用</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">  --column-inserts             dump data as INSERT commands with column names以带有列名的INSERT命令形式转储数据</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">  --disable-dollar-quoting     disable dollar quoting, use SQL standard quoting取消美元 (符号) 引号, 使用 SQL 标准引号</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">  --disable-triggers           disable triggers during data-only restore在只恢复数据的过程中禁用触发器</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">  --exclude-table-data=TABLE   do NOT dump data for the named table(s)以INSERT命令，而不是COPY命令的形式转储数据</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">  --inserts                    dump data as INSERT commands, rather than COPY</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">  --no-security-labels         do not dump security label assignments</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">  --no-synchronized-snapshots  do not use synchronized snapshots in parallel jobs</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">  --no-tablespaces             do not dump tablespace assignments不转储表空间分配信息</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">  --no-unlogged-table-data     do not dump unlogged table data</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">  --quote-all-identifiers      quote all identifiers, even if not key words</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">  --section=SECTION            dump named section (pre-data, data, or post-data)</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">  --serializable-deferrable    wait until the dump can run without anomalies</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">  --use-set-session-authorization</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">                               use SET SESSION AUTHORIZATION commands instead of</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">                               ALTER OWNER commands to set ownership</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">Connection options:(控制连接的选项)</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">  -d, --dbname=DBNAME      database to dump </span></span>
<span class="line"><span style="color:#e1e4e8;">数据库名</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">  -h, --host=HOSTNAME      database server host or socket directory数据库服务器的主机名或套接字目录</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">  -p, --port=PORT          database server port number数据库服务器的端口号</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">  -U, --username=NAME      connect as specified database user以指定的数据库用户联接</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">  -w, --no-password        never prompt for password永远不提示输入口令</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">  -W, --password           force password prompt (should happen automatically)强制口令提示 (自动)</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">  --role=ROLENAME          do SET ROLE before dump</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">General options:(一般选项)</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">  -f, --file=FILENAME          output file or directory name导出后保存的文件名</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">  -F, --format=c|d|t|p         output file format (custom, directory, tar,导出文件的格式</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">                               plain text (default))</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">  -j, --jobs=NUM               use this many parallel jobs to dump并行数</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">  -v, --verbose                verbose mode </span></span>
<span class="line"><span style="color:#24292e;">详细模式 </span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">  -V, --version                output version information, then exit输出版本信息, 然后退出</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">  -Z, --compress=0-9           compression level for compressed formats被压缩格式的压缩级别</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">  --lock-wait-timeout=TIMEOUT  fail after waiting TIMEOUT for a table lock在等待表锁超时后操作失败</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">  -?, --help                   show this help, then exit显示此帮助信息, 然后退出</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">Options controlling the output content:(控制输出的选项)</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">  -a, --data-only              dump only the data, not the schema只导出数据，不包括模式</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">  -b, --blobs                  include large objects in dump在转储中包括大对象</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">  -c, --clean                  clean (drop) database objects before recreating在重新创建之前，先清除（删除）数据库对象</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">  -C, --create                 include commands to create database in dump在转储中包括命令,以便创建数据库（包括建库语句，无需在导入之前先建数据库）</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">  -E, --encoding=ENCODING      dump the data in encoding ENCODING转储以ENCODING形式编码的数据</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">  -n, --schema=SCHEMA          dump the named schema(s) only只转储指定名称的模式</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">  -N, --exclude-schema=SCHEMA  do NOT dump the named schema(s)不转储已命名的模式</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">  -o, --oids                   include OIDs in dump在转储中包括 OID</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">  -O, --no-owner               skip restoration of object ownership in在明文格式中, 忽略恢复对象所属者</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">                               plain-text format </span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">  -s, --schema-only            dump only the schema, no data只转储模式, 不包括数据(不导出数据)</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">  -S, --superuser=NAME         superuser user name to use in plain-text format在转储中, 指定的超级用户名</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">  -t, --table=TABLE            dump the named table(s) only只转储指定名称的表</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">  -T, --exclude-table=TABLE    do NOT dump the named table(s)只转储指定名称的表</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">  -x, --no-privileges          do not dump privileges (grant/revoke)不要转储权限 (grant/revoke)</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">  --binary-upgrade             for use by upgrade utilities only只能由升级工具使用</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">  --column-inserts             dump data as INSERT commands with column names以带有列名的INSERT命令形式转储数据</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">  --disable-dollar-quoting     disable dollar quoting, use SQL standard quoting取消美元 (符号) 引号, 使用 SQL 标准引号</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">  --disable-triggers           disable triggers during data-only restore在只恢复数据的过程中禁用触发器</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">  --exclude-table-data=TABLE   do NOT dump data for the named table(s)以INSERT命令，而不是COPY命令的形式转储数据</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">  --inserts                    dump data as INSERT commands, rather than COPY</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">  --no-security-labels         do not dump security label assignments</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">  --no-synchronized-snapshots  do not use synchronized snapshots in parallel jobs</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">  --no-tablespaces             do not dump tablespace assignments不转储表空间分配信息</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">  --no-unlogged-table-data     do not dump unlogged table data</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">  --quote-all-identifiers      quote all identifiers, even if not key words</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">  --section=SECTION            dump named section (pre-data, data, or post-data)</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">  --serializable-deferrable    wait until the dump can run without anomalies</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">  --use-set-session-authorization</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">                               use SET SESSION AUTHORIZATION commands instead of</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">                               ALTER OWNER commands to set ownership</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">Connection options:(控制连接的选项)</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">  -d, --dbname=DBNAME      database to dump </span></span>
<span class="line"><span style="color:#24292e;">数据库名</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">  -h, --host=HOSTNAME      database server host or socket directory数据库服务器的主机名或套接字目录</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">  -p, --port=PORT          database server port number数据库服务器的端口号</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">  -U, --username=NAME      connect as specified database user以指定的数据库用户联接</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">  -w, --no-password        never prompt for password永远不提示输入口令</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">  -W, --password           force password prompt (should happen automatically)强制口令提示 (自动)</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">  --role=ROLENAME          do SET ROLE before dump</span></span></code></pre></div><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">备份：</span></span>
<span class="line"><span style="color:#E1E4E8;">pg_dump </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">h localhost </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">p </span><span style="color:#79B8FF;">5432</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">U tradesns </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">W </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">F c </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">b </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">v </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">f </span><span style="color:#9ECBFF;">&quot;/root/us2010.backup&quot;</span><span style="color:#E1E4E8;"> us2010</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">恢复：</span></span>
<span class="line"><span style="color:#E1E4E8;">pg_restore </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">h </span><span style="color:#79B8FF;">192</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">168</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">100</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">p </span><span style="color:#79B8FF;">5432</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">U postgres </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">W </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">d us2011 </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">v </span><span style="color:#9ECBFF;">&quot;/root/us2010.backup&quot;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">备份：</span></span>
<span class="line"><span style="color:#24292E;">pg_dump </span><span style="color:#D73A49;">-</span><span style="color:#24292E;">h localhost </span><span style="color:#D73A49;">-</span><span style="color:#24292E;">p </span><span style="color:#005CC5;">5432</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">-</span><span style="color:#24292E;">U tradesns </span><span style="color:#D73A49;">-</span><span style="color:#24292E;">W </span><span style="color:#D73A49;">-</span><span style="color:#24292E;">F c </span><span style="color:#D73A49;">-</span><span style="color:#24292E;">b </span><span style="color:#D73A49;">-</span><span style="color:#24292E;">v </span><span style="color:#D73A49;">-</span><span style="color:#24292E;">f </span><span style="color:#032F62;">&quot;/root/us2010.backup&quot;</span><span style="color:#24292E;"> us2010</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">恢复：</span></span>
<span class="line"><span style="color:#24292E;">pg_restore </span><span style="color:#D73A49;">-</span><span style="color:#24292E;">h </span><span style="color:#005CC5;">192</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">168</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">0</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">100</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">-</span><span style="color:#24292E;">p </span><span style="color:#005CC5;">5432</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">-</span><span style="color:#24292E;">U postgres </span><span style="color:#D73A49;">-</span><span style="color:#24292E;">W </span><span style="color:#D73A49;">-</span><span style="color:#24292E;">d us2011 </span><span style="color:#D73A49;">-</span><span style="color:#24292E;">v </span><span style="color:#032F62;">&quot;/root/us2010.backup&quot;</span></span></code></pre></div><p>pg_dump备份是一致的备份</p><p>因为pg_dump备份时使用的是serializable隔离级别, 如在hot_standby上面备份将使用repeatable read隔离级别.(目前hot_standby数据库不支持serializable隔离级别). 使用这两种隔离级别进行备份，整个事务从开始时就是看到的一个数据库的snapshot</p><p>优点：</p><p>​ pg_dump不会堵塞对表的DML操作</p><p>缺点：</p><p>使用pg_dump备份的时候，这个过程产生的垃圾数据不可以被VACUUM掉，所以一个很长时间的pg_dump操作会带来更多的垃圾数据.换句话说表的膨胀</p><p>DML(Data Manipulation Language)数据操纵语言，对数据库中的数据进行一些简单操作，如insert、delete、update、select等。DML操作是可以手动控制事务的开启、提交和回滚的。</p><p>DDL(Data Definition Language)数据定义语言，对数据库中的某些对象(例如database、table)进行管理，如create、alter和drop。DDL操作是隐性提交的，不能rollback</p><h1 id="_3-案例" tabindex="-1">3.案例 <a class="header-anchor" href="#_3-案例" aria-label="Permalink to &quot;3.案例&quot;">​</a></h1><h2 id="_3-1-配置环境" tabindex="-1">3.1 配置环境 <a class="header-anchor" href="#_3-1-配置环境" aria-label="Permalink to &quot;3.1 配置环境&quot;">​</a></h2><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">postgres</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">#</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">create</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">database</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">db_name</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">encoding</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">UTF8</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#B392F0;">CREATE</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">DATABASE</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#创建表</span></span>
<span class="line"><span style="color:#E1E4E8;">test</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">#</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">CREATE</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">TABLE</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">adg</span><span style="color:#E1E4E8;"> (c1 </span><span style="color:#9ECBFF;">bigint</span><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">primary</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">key,c2</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">bigint,c3</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">time,c4</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">character</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">varying</span><span style="color:#E1E4E8;">(</span><span style="color:#B392F0;">136</span><span style="color:#E1E4E8;">));</span></span>
<span class="line"><span style="color:#B392F0;">CREATE</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">TABLE</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">test</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">#</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">insert</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">into</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">adg</span><span style="color:#E1E4E8;">(</span><span style="color:#B392F0;">c1,c2,c3,c4</span><span style="color:#E1E4E8;">) </span><span style="color:#9ECBFF;">values</span><span style="color:#E1E4E8;"> (random()*10000000, random()*1000,now(),md5(random()::text));</span></span>
<span class="line"><span style="color:#B392F0;">INSERT</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">1</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">test</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">#</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">select</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">*</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">from</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">adg</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#B392F0;">c1</span><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">c2</span><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">       </span><span style="color:#B392F0;">c3</span><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">                </span><span style="color:#B392F0;">c4</span><span style="color:#E1E4E8;">                </span></span>
<span class="line"><span style="color:#B392F0;">---------+-----+-----------------+----------------------------------</span></span>
<span class="line"><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">1364770</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">587</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">11:31:52.513474</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">4fc3602caf806531a7b51bf20ad3421d</span></span>
<span class="line"><span style="color:#E1E4E8;">(</span><span style="color:#B392F0;">1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">row</span><span style="color:#E1E4E8;">)</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">postgres</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">#</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">create</span><span style="color:#24292E;"> </span><span style="color:#032F62;">database</span><span style="color:#24292E;"> </span><span style="color:#032F62;">db_name</span><span style="color:#24292E;"> </span><span style="color:#032F62;">encoding</span><span style="color:#24292E;"> </span><span style="color:#032F62;">UTF8</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#6F42C1;">CREATE</span><span style="color:#24292E;"> </span><span style="color:#032F62;">DATABASE</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#创建表</span></span>
<span class="line"><span style="color:#24292E;">test</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">#</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">CREATE</span><span style="color:#24292E;"> </span><span style="color:#032F62;">TABLE</span><span style="color:#24292E;"> </span><span style="color:#032F62;">adg</span><span style="color:#24292E;"> (c1 </span><span style="color:#032F62;">bigint</span><span style="color:#24292E;">  </span><span style="color:#032F62;">primary</span><span style="color:#24292E;"> </span><span style="color:#032F62;">key,c2</span><span style="color:#24292E;"> </span><span style="color:#032F62;">bigint,c3</span><span style="color:#24292E;"> </span><span style="color:#032F62;">time,c4</span><span style="color:#24292E;"> </span><span style="color:#032F62;">character</span><span style="color:#24292E;"> </span><span style="color:#032F62;">varying</span><span style="color:#24292E;">(</span><span style="color:#6F42C1;">136</span><span style="color:#24292E;">));</span></span>
<span class="line"><span style="color:#6F42C1;">CREATE</span><span style="color:#24292E;"> </span><span style="color:#032F62;">TABLE</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">test</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">#</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">insert</span><span style="color:#24292E;"> </span><span style="color:#032F62;">into</span><span style="color:#24292E;"> </span><span style="color:#032F62;">adg</span><span style="color:#24292E;">(</span><span style="color:#6F42C1;">c1,c2,c3,c4</span><span style="color:#24292E;">) </span><span style="color:#032F62;">values</span><span style="color:#24292E;"> (random()*10000000, random()*1000,now(),md5(random()::text));</span></span>
<span class="line"><span style="color:#6F42C1;">INSERT</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">test</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">#</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">select</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">*</span><span style="color:#24292E;"> </span><span style="color:#032F62;">from</span><span style="color:#24292E;"> </span><span style="color:#032F62;">adg</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#6F42C1;">c1</span><span style="color:#24292E;">    </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">c2</span><span style="color:#24292E;">  </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">       </span><span style="color:#6F42C1;">c3</span><span style="color:#24292E;">        </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">                </span><span style="color:#6F42C1;">c4</span><span style="color:#24292E;">                </span></span>
<span class="line"><span style="color:#6F42C1;">---------+-----+-----------------+----------------------------------</span></span>
<span class="line"><span style="color:#24292E;"> </span><span style="color:#6F42C1;">1364770</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">587</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">11:31:52.513474</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">4fc3602caf806531a7b51bf20ad3421d</span></span>
<span class="line"><span style="color:#24292E;">(</span><span style="color:#6F42C1;">1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">row</span><span style="color:#24292E;">)</span></span></code></pre></div><h2 id="_3-2备份单个数据库包含数据" tabindex="-1">3.2备份单个数据库包含数据 <a class="header-anchor" href="#_3-2备份单个数据库包含数据" aria-label="Permalink to &quot;3.2备份单个数据库包含数据&quot;">​</a></h2><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">#生成文本模式</span></span>
<span class="line"><span style="color:#E1E4E8;">[postgres@pg01 </span><span style="color:#F97583;">~</span><span style="color:#E1E4E8;">]$ pg_dump -U postgres -h 127.0.0.1 -p 5532 -d test </span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;">test.sql</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">-U</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">指定用户名</span></span>
<span class="line"><span style="color:#B392F0;">-p</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">指定端口</span></span>
<span class="line"><span style="color:#B392F0;">-d</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">指定数据库</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">#生成文本模式</span></span>
<span class="line"><span style="color:#24292E;">[postgres@pg01 </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]$ pg_dump -U postgres -h 127.0.0.1 -p 5532 -d test </span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;">test.sql</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">-U</span><span style="color:#24292E;"> </span><span style="color:#032F62;">指定用户名</span></span>
<span class="line"><span style="color:#6F42C1;">-p</span><span style="color:#24292E;"> </span><span style="color:#032F62;">指定端口</span></span>
<span class="line"><span style="color:#6F42C1;">-d</span><span style="color:#24292E;"> </span><span style="color:#032F62;">指定数据库</span></span></code></pre></div><h2 id="_3-3只备份结构" tabindex="-1">3.3只备份结构 <a class="header-anchor" href="#_3-3只备份结构" aria-label="Permalink to &quot;3.3只备份结构&quot;">​</a></h2><table><thead><tr><th>sername</th><th style="text-align:left;">RDS PostgreSQL实例高权限账号名称。</th></tr></thead><tbody><tr><td>port</td><td style="text-align:left;">RDS PostgreSQL实例端口。</td></tr><tr><td>table</td><td style="text-align:left;">需要备份的表。可以用多个<code>-t &lt;table&gt;</code>选择多个表。</td></tr><tr><td>-Fc</td><td style="text-align:left;">输出格式。<code>-Fc</code>表示输出自定义格式的存档，这个格式适合通过pg_restore进行导入还原。更多选项的详细说明请参见<a href="https://www.postgresql.org/docs/10/app-pgdump.html" target="_blank" rel="noreferrer">pg_dump</a>。</td></tr><tr><td>dbname</td><td style="text-align:left;">目标数据库名称。</td></tr><tr><td>dumpdir</td><td style="text-align:left;">导出的备份文件路径及名称</td></tr></tbody></table><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">#pg_dump -h &#39;&lt;hostname&gt;&#39; -U &lt;username&gt; -p &lt;port&gt; -t &lt;table&gt; -Fc &lt;dbname&gt; &gt; &lt;dumpdir&gt;</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">[postgres@pg01 </span><span style="color:#F97583;">~</span><span style="color:#E1E4E8;">]$ pg_dump -U postgres -h 127.0.0.1 -p 5532 -s test </span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;">test_stru.sql</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">-s</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">只有结构</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">或者</span></span>
<span class="line"><span style="color:#E1E4E8;">[postgres@pg01 </span><span style="color:#F97583;">~</span><span style="color:#E1E4E8;">]$ pg_dump -U postgres -h 127.0.0.1 -p 5532 -s test -f test_stru.sql</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">-f</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">指定保存文件</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">#pg_dump -h &#39;&lt;hostname&gt;&#39; -U &lt;username&gt; -p &lt;port&gt; -t &lt;table&gt; -Fc &lt;dbname&gt; &gt; &lt;dumpdir&gt;</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">[postgres@pg01 </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]$ pg_dump -U postgres -h 127.0.0.1 -p 5532 -s test </span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;">test_stru.sql</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">-s</span><span style="color:#24292E;"> </span><span style="color:#032F62;">只有结构</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">或者</span></span>
<span class="line"><span style="color:#24292E;">[postgres@pg01 </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]$ pg_dump -U postgres -h 127.0.0.1 -p 5532 -s test -f test_stru.sql</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">-f</span><span style="color:#24292E;"> </span><span style="color:#032F62;">指定保存文件</span></span></code></pre></div><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">pg_dump</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-U</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">afc</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">edb</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-Fp</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-v</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--schema=afc</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--schema-only</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--no-owner</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--no-tablespaces</span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">--no-privileges</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-T</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">c_card_trade</span><span style="color:#79B8FF;">*</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-f</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">19</span><span style="color:#9ECBFF;">_edb_schema_afc.sql</span><span style="color:#E1E4E8;"> </span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">--</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">例子</span></span>
<span class="line"><span style="color:#B392F0;">pg_dump</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-U</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">postgres</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-d</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">usercenter</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-h</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">127.0</span><span style="color:#9ECBFF;">.0.1</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-p</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5532</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-Fp</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">--schema-only</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--no-owner</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--no-tablespaces</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--no-privileges</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">hello.sql</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">或者</span></span>
<span class="line"><span style="color:#B392F0;">pg_dump</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-U</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">postgres</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-h</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">127.0</span><span style="color:#9ECBFF;">.0.1</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-p</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5532</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-s</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-d</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">usercenter</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">&gt;</span><span style="color:#9ECBFF;">usercenter_stru_2020_08_12.sql</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">这个方式含有用户</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">pg_dump</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-U</span><span style="color:#24292E;"> </span><span style="color:#032F62;">afc</span><span style="color:#24292E;"> </span><span style="color:#032F62;">edb</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-Fp</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-v</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--schema=afc</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--schema-only</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--no-owner</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--no-tablespaces</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">--no-privileges</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-T</span><span style="color:#24292E;"> </span><span style="color:#032F62;">c_card_trade</span><span style="color:#005CC5;">*</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-f</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">19</span><span style="color:#032F62;">_edb_schema_afc.sql</span><span style="color:#24292E;"> </span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">--</span><span style="color:#24292E;"> </span><span style="color:#032F62;">例子</span></span>
<span class="line"><span style="color:#6F42C1;">pg_dump</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-U</span><span style="color:#24292E;"> </span><span style="color:#032F62;">postgres</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-d</span><span style="color:#24292E;"> </span><span style="color:#032F62;">usercenter</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-h</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">127.0</span><span style="color:#032F62;">.0.1</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-p</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5532</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-Fp</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">--schema-only</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--no-owner</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--no-tablespaces</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--no-privileges</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">hello.sql</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">或者</span></span>
<span class="line"><span style="color:#6F42C1;">pg_dump</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-U</span><span style="color:#24292E;"> </span><span style="color:#032F62;">postgres</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-h</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">127.0</span><span style="color:#032F62;">.0.1</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-p</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5532</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-s</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-d</span><span style="color:#24292E;"> </span><span style="color:#032F62;">usercenter</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&gt;</span><span style="color:#032F62;">usercenter_stru_2020_08_12.sql</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">这个方式含有用户</span></span></code></pre></div><h2 id="_3-4备份单表" tabindex="-1">3.4备份单表 <a class="header-anchor" href="#_3-4备份单表" aria-label="Permalink to &quot;3.4备份单表&quot;">​</a></h2><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">#包含表结构和数据</span></span>
<span class="line"><span style="color:#E1E4E8;">[postgres@pg01 </span><span style="color:#F97583;">~</span><span style="color:#E1E4E8;">]$ pg_dump -U postgres -h 127.0.0.1 -p 5532 -t table_name -d db_name -x -O -f adg_data.sql</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">-t</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">指定表名字</span></span>
<span class="line"><span style="color:#B392F0;">-x</span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">--no-privileges</span></span>
<span class="line"><span style="color:#B392F0;">-O</span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">--no-owner</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#只备份表结构,-s</span></span>
<span class="line"><span style="color:#E1E4E8;">[postgres@pg01 </span><span style="color:#F97583;">~</span><span style="color:#E1E4E8;">]$ pg_dump -U postgres -h 127.0.0.1 -p 5532 -s -t table_name db_name -f adg_str.sql</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#备份某个模式所有表</span></span>
<span class="line"><span style="color:#E1E4E8;">[postgres@pg01 </span><span style="color:#F97583;">~</span><span style="color:#E1E4E8;">]$ pg_dump -U postgres -h 127.0.0.1 -p 5532 -s -t </span><span style="color:#9ECBFF;">&#39;adg.*&#39;</span><span style="color:#E1E4E8;"> test01 -f all_table_str.sql</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#只备份表数据,不包含表结构,-a</span></span>
<span class="line"><span style="color:#B392F0;">pg_dump</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-U</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">postgres</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-h</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">172.19</span><span style="color:#9ECBFF;">.149.143</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-p</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5432</span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">-W</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-t</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">table_name</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-a</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">db_name</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-x</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-O</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-f</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">tb.sql</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">#包含表结构和数据</span></span>
<span class="line"><span style="color:#24292E;">[postgres@pg01 </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]$ pg_dump -U postgres -h 127.0.0.1 -p 5532 -t table_name -d db_name -x -O -f adg_data.sql</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">-t</span><span style="color:#24292E;"> </span><span style="color:#032F62;">指定表名字</span></span>
<span class="line"><span style="color:#6F42C1;">-x</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">--no-privileges</span></span>
<span class="line"><span style="color:#6F42C1;">-O</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">--no-owner</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#只备份表结构,-s</span></span>
<span class="line"><span style="color:#24292E;">[postgres@pg01 </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]$ pg_dump -U postgres -h 127.0.0.1 -p 5532 -s -t table_name db_name -f adg_str.sql</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#备份某个模式所有表</span></span>
<span class="line"><span style="color:#24292E;">[postgres@pg01 </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]$ pg_dump -U postgres -h 127.0.0.1 -p 5532 -s -t </span><span style="color:#032F62;">&#39;adg.*&#39;</span><span style="color:#24292E;"> test01 -f all_table_str.sql</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#只备份表数据,不包含表结构,-a</span></span>
<span class="line"><span style="color:#6F42C1;">pg_dump</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-U</span><span style="color:#24292E;"> </span><span style="color:#032F62;">postgres</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-h</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">172.19</span><span style="color:#032F62;">.149.143</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-p</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5432</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">-W</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-t</span><span style="color:#24292E;"> </span><span style="color:#032F62;">table_name</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-a</span><span style="color:#24292E;"> </span><span style="color:#032F62;">db_name</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-x</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-O</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-f</span><span style="color:#24292E;"> </span><span style="color:#032F62;">tb.sql</span></span></code></pre></div><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">#在数据库里面备份一张表结构</span></span>
<span class="line"><span style="color:#B392F0;">create</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">table</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">test11</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">as</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">select</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">*</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">from</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">test15</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">where</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">1</span><span style="color:#9ECBFF;">=</span><span style="color:#79B8FF;">2</span><span style="color:#E1E4E8;"> ;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">#在数据库里面备份一张表结构</span></span>
<span class="line"><span style="color:#6F42C1;">create</span><span style="color:#24292E;"> </span><span style="color:#032F62;">table</span><span style="color:#24292E;"> </span><span style="color:#032F62;">test11</span><span style="color:#24292E;"> </span><span style="color:#032F62;">as</span><span style="color:#24292E;"> </span><span style="color:#032F62;">select</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">*</span><span style="color:#24292E;"> </span><span style="color:#032F62;">from</span><span style="color:#24292E;"> </span><span style="color:#032F62;">test15</span><span style="color:#24292E;"> </span><span style="color:#032F62;">where</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1</span><span style="color:#032F62;">=</span><span style="color:#005CC5;">2</span><span style="color:#24292E;"> ;</span></span></code></pre></div><h3 id="排除指定表" tabindex="-1">排除指定表 <a class="header-anchor" href="#排除指定表" aria-label="Permalink to &quot;排除指定表&quot;">​</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">pg_dump</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-h</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;&lt;hostname&gt;&#39;</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-U</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">usernam</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-p</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">por</span><span style="color:#E1E4E8;">t</span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-T</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">tabl</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-Fc</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">dbnam</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">dumpdi</span><span style="color:#E1E4E8;">r</span><span style="color:#F97583;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">示例：</span></span>
<span class="line"><span style="color:#B392F0;">pg_dump</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-h</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;pgm-bpxxxxx.pg.rds.aliyuncs.com&#39;</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-U</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">test123</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-p</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">3433</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-T</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">products1</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-Fc</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">testdb2</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/tmp/testdb2.dump</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">--备份某个模式emp开头表，排除一张表</span></span>
<span class="line"><span style="color:#B392F0;">pg_dump</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-t</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;mysch.t*&#39;</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-T</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">mysch.t1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">mydb</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/pgbackup/sche1_t_2019.sql</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">pg_dump</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-h</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;&lt;hostname&gt;&#39;</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-U</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">usernam</span><span style="color:#24292E;">e</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-p</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">por</span><span style="color:#24292E;">t</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-T</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">tabl</span><span style="color:#24292E;">e</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-Fc</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">dbnam</span><span style="color:#24292E;">e</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">dumpdi</span><span style="color:#24292E;">r</span><span style="color:#D73A49;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">示例：</span></span>
<span class="line"><span style="color:#6F42C1;">pg_dump</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-h</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;pgm-bpxxxxx.pg.rds.aliyuncs.com&#39;</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-U</span><span style="color:#24292E;"> </span><span style="color:#032F62;">test123</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-p</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">3433</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-T</span><span style="color:#24292E;"> </span><span style="color:#032F62;">products1</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-Fc</span><span style="color:#24292E;"> </span><span style="color:#032F62;">testdb2</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/tmp/testdb2.dump</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">--备份某个模式emp开头表，排除一张表</span></span>
<span class="line"><span style="color:#6F42C1;">pg_dump</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-t</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;mysch.t*&#39;</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-T</span><span style="color:#24292E;"> </span><span style="color:#032F62;">mysch.t1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">mydb</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/pgbackup/sche1_t_2019.sql</span></span></code></pre></div><h3 id="导出insert模式" tabindex="-1">导出insert模式 <a class="header-anchor" href="#导出insert模式" aria-label="Permalink to &quot;导出insert模式&quot;">​</a></h3><p>导出test数据库中表adg的数据,以insert语句的形式，默认是copy形式</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">[postgres@pg01 </span><span style="color:#F97583;">~</span><span style="color:#E1E4E8;">]$ pg_dump -U postgres -h 127.0.0.1 -p 5532 -t adg test --column-inserts -f adg_data_in.sql</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">[postgres@pg01 </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]$ pg_dump -U postgres -h 127.0.0.1 -p 5532 -t adg test --column-inserts -f adg_data_in.sql</span></span></code></pre></div><h3 id="文件不落地-实现两个数据库迁移" tabindex="-1">文件不落地，实现两个数据库迁移 <a class="header-anchor" href="#文件不落地-实现两个数据库迁移" aria-label="Permalink to &quot;文件不落地，实现两个数据库迁移&quot;">​</a></h3><ul><li>配置两个数据库之间的信任关系 (必须)</li></ul><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">host all all 192.168.18.0/24 trust</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">host all all 192.168.18.0/24 trust</span></span></code></pre></div><ul><li>数据库之间进行某个数据库迁移</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">pg_dump</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-h</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg1</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-p</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">1922</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-U</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">postgres</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">testdblpsql</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-h</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg2</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-p</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5432</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-U</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">postgres</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">testdb</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">pg_dump</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-h</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg1</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-p</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1922</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-U</span><span style="color:#24292E;"> </span><span style="color:#032F62;">postgres</span><span style="color:#24292E;"> </span><span style="color:#032F62;">testdblpsql</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-h</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg2</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-p</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5432</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-U</span><span style="color:#24292E;"> </span><span style="color:#032F62;">postgres</span><span style="color:#24292E;"> </span><span style="color:#032F62;">testdb</span></span></code></pre></div><ul><li>迁移所有的数据库到目标数据库</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">pg_dumpall</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-h</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg1</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-p</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">1922</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-U</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">postgres</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Ipsql-h</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg2</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-p</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5432</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-U</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">postgres</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">pg_dumpall</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-h</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg1</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-p</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1922</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-U</span><span style="color:#24292E;"> </span><span style="color:#032F62;">postgres</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Ipsql-h</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg2</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-p</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5432</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-U</span><span style="color:#24292E;"> </span><span style="color:#032F62;">postgres</span></span></code></pre></div><p>注意：</p><p>1、PG数据库之间迁移无需配置dblink，只要指定主机名和端口即可。</p><p>2、由于用的是管道符，所以必须配置两个数据库远程登录信任关系。</p><p>3、迁移时两个数据库必须要有相同的表空间，需要提前创建。</p><h2 id="_3-5恢复" tabindex="-1">3.5恢复 <a class="header-anchor" href="#_3-5恢复" aria-label="Permalink to &quot;3.5恢复&quot;">​</a></h2><h3 id="普通文本模式" tabindex="-1">普通文本模式 <a class="header-anchor" href="#普通文本模式" aria-label="Permalink to &quot;普通文本模式&quot;">​</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">pg_dump</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-U</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">postgres</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-h</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">127.0</span><span style="color:#9ECBFF;">.0.1</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-p</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5532</span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">-d</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">db_name</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-x</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-O</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-f</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">dataName.sql</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;"> </span><span style="color:#6F42C1;">pg_dump</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-U</span><span style="color:#24292E;"> </span><span style="color:#032F62;">postgres</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-h</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">127.0</span><span style="color:#032F62;">.0.1</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-p</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5532</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">-d</span><span style="color:#24292E;"> </span><span style="color:#032F62;">db_name</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-x</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-O</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-f</span><span style="color:#24292E;"> </span><span style="color:#032F62;">dataName.sql</span></span></code></pre></div><h4 id="split切割文件" tabindex="-1">split切割文件 <a class="header-anchor" href="#split切割文件" aria-label="Permalink to &quot;split切割文件&quot;">​</a></h4><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">[postgres@pg01 </span><span style="color:#F97583;">~</span><span style="color:#E1E4E8;">]$ pg_dump -U postgres -h 127.0.0.1 -p 5532 -d test01  </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">split</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-b</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">100</span><span style="color:#9ECBFF;">k</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">-</span><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">~/test01</span></span>
<span class="line"><span style="color:#E1E4E8;">[postgres@pg01 </span><span style="color:#F97583;">~</span><span style="color:#E1E4E8;">]$ ls</span></span>
<span class="line"><span style="color:#B392F0;">test01aa</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#恢复</span></span>
<span class="line"><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">cat</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/test01</span><span style="color:#79B8FF;">*</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">psql</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">-U</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">postgres</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-h</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">127.0</span><span style="color:#9ECBFF;">.0.1</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-p</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5532</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-d</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">test01</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">[postgres@pg01 </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]$ pg_dump -U postgres -h 127.0.0.1 -p 5532 -d test01  </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">split</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-b</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">100</span><span style="color:#032F62;">k</span><span style="color:#24292E;"> </span><span style="color:#032F62;">-</span><span style="color:#24292E;">  </span><span style="color:#032F62;">~/test01</span></span>
<span class="line"><span style="color:#24292E;">[postgres@pg01 </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]$ ls</span></span>
<span class="line"><span style="color:#6F42C1;">test01aa</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#恢复</span></span>
<span class="line"><span style="color:#24292E;"> </span><span style="color:#6F42C1;">cat</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/test01</span><span style="color:#005CC5;">*</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">psql</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">-U</span><span style="color:#24292E;"> </span><span style="color:#032F62;">postgres</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-h</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">127.0</span><span style="color:#032F62;">.0.1</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-p</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5532</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-d</span><span style="color:#24292E;"> </span><span style="color:#032F62;">test01</span></span></code></pre></div><h3 id="二进制模式" tabindex="-1">二进制模式 <a class="header-anchor" href="#二进制模式" aria-label="Permalink to &quot;二进制模式&quot;">​</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">1.</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">先备份：</span><span style="color:#E1E4E8;"> </span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#B392F0;">pg_dump</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-U</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">postgres</span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">-h</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">127.0</span><span style="color:#9ECBFF;">.0.1</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-p</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5532</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-F</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">t</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-f</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/vendemo.tar</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">db_name</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">.</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">恢复：</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#B392F0;">pg_restore</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-U</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">postgres</span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">-h</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">127.0</span><span style="color:#9ECBFF;">.0.1</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-p</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5532</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-d</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">bk01</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/vendemo.tar</span><span style="color:#E1E4E8;"> </span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">2.</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">先备份：</span><span style="color:#E1E4E8;"> </span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#B392F0;">pg_dump</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-U</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">postgres</span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">-h</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">127.0</span><span style="color:#9ECBFF;">.0.1</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-p</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5532</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-F</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">c</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-f</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/vendemo.tar</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">vendemo</span><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">备份下来有300多k</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">.</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">恢复：</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#B392F0;">pg_restore</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-U</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">postgres</span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">-h</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">127.0</span><span style="color:#9ECBFF;">.0.1</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-p</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5532</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-d</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">bk01</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/vendemo.tar</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">1.</span><span style="color:#24292E;"> </span><span style="color:#032F62;">先备份：</span><span style="color:#24292E;"> </span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#6F42C1;">pg_dump</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-U</span><span style="color:#24292E;"> </span><span style="color:#032F62;">postgres</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">-h</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">127.0</span><span style="color:#032F62;">.0.1</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-p</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5532</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-F</span><span style="color:#24292E;"> </span><span style="color:#032F62;">t</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-f</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/vendemo.tar</span><span style="color:#24292E;"> </span><span style="color:#032F62;">db_name</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;"> </span><span style="color:#005CC5;">.</span><span style="color:#24292E;"> </span><span style="color:#032F62;">恢复：</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#6F42C1;">pg_restore</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-U</span><span style="color:#24292E;"> </span><span style="color:#032F62;">postgres</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">-h</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">127.0</span><span style="color:#032F62;">.0.1</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-p</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5532</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-d</span><span style="color:#24292E;"> </span><span style="color:#032F62;">bk01</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/vendemo.tar</span><span style="color:#24292E;"> </span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">2.</span><span style="color:#24292E;"> </span><span style="color:#032F62;">先备份：</span><span style="color:#24292E;"> </span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#6F42C1;">pg_dump</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-U</span><span style="color:#24292E;"> </span><span style="color:#032F62;">postgres</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">-h</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">127.0</span><span style="color:#032F62;">.0.1</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-p</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5532</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-F</span><span style="color:#24292E;"> </span><span style="color:#032F62;">c</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-f</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/vendemo.tar</span><span style="color:#24292E;"> </span><span style="color:#032F62;">vendemo</span><span style="color:#24292E;">  </span><span style="color:#032F62;">备份下来有300多k</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;"> </span><span style="color:#005CC5;">.</span><span style="color:#24292E;"> </span><span style="color:#032F62;">恢复：</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#6F42C1;">pg_restore</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-U</span><span style="color:#24292E;"> </span><span style="color:#032F62;">postgres</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">-h</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">127.0</span><span style="color:#032F62;">.0.1</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-p</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5532</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-d</span><span style="color:#24292E;"> </span><span style="color:#032F62;">bk01</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/vendemo.tar</span></span></code></pre></div><h4 id="压缩备份与恢复" tabindex="-1">压缩备份与恢复 <a class="header-anchor" href="#压缩备份与恢复" aria-label="Permalink to &quot;压缩备份与恢复&quot;">​</a></h4><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">[postgres@pg01 </span><span style="color:#F97583;">~</span><span style="color:#E1E4E8;">]$ pg_dump -U postgres -h 127.0.0.1 -p 5532 test01 </span><span style="color:#F97583;">|</span><span style="color:#B392F0;">gzip</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">test01.gz</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#恢复</span></span>
<span class="line"><span style="color:#E1E4E8;">[postgres@pg01 </span><span style="color:#F97583;">~</span><span style="color:#E1E4E8;">]$ gunzip  -c test01.gz </span><span style="color:#F97583;">|</span><span style="color:#B392F0;">pg_dump</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-U</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">postgres</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-h</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">127.0</span><span style="color:#9ECBFF;">.0.1</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-p</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5532</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">test01</span></span>
<span class="line"><span style="color:#B392F0;">或者</span></span>
<span class="line"><span style="color:#E1E4E8;">[postgres@pg01 </span><span style="color:#F97583;">~</span><span style="color:#E1E4E8;">]$ cat test01.gz </span><span style="color:#F97583;">|</span><span style="color:#B392F0;">gunzip</span><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">|</span><span style="color:#B392F0;">pg_dump</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-U</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">postgres</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-h</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">127.0</span><span style="color:#9ECBFF;">.0.1</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-p</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5532</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">test01</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">[postgres@pg01 </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]$ pg_dump -U postgres -h 127.0.0.1 -p 5532 test01 </span><span style="color:#D73A49;">|</span><span style="color:#6F42C1;">gzip</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">test01.gz</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#恢复</span></span>
<span class="line"><span style="color:#24292E;">[postgres@pg01 </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]$ gunzip  -c test01.gz </span><span style="color:#D73A49;">|</span><span style="color:#6F42C1;">pg_dump</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-U</span><span style="color:#24292E;"> </span><span style="color:#032F62;">postgres</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-h</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">127.0</span><span style="color:#032F62;">.0.1</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-p</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5532</span><span style="color:#24292E;"> </span><span style="color:#032F62;">test01</span></span>
<span class="line"><span style="color:#6F42C1;">或者</span></span>
<span class="line"><span style="color:#24292E;">[postgres@pg01 </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]$ cat test01.gz </span><span style="color:#D73A49;">|</span><span style="color:#6F42C1;">gunzip</span><span style="color:#24292E;">  </span><span style="color:#D73A49;">|</span><span style="color:#6F42C1;">pg_dump</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-U</span><span style="color:#24292E;"> </span><span style="color:#032F62;">postgres</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-h</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">127.0</span><span style="color:#032F62;">.0.1</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-p</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5532</span><span style="color:#24292E;"> </span><span style="color:#032F62;">test01</span></span></code></pre></div><h4 id="恢复指定表数据" tabindex="-1">恢复指定表数据 <a class="header-anchor" href="#恢复指定表数据" aria-label="Permalink to &quot;恢复指定表数据&quot;">​</a></h4><table><thead><tr><th>username</th><th>RDS PostgreSQL实例高权限账号名称。</th></tr></thead><tbody><tr><td>port</td><td>RDS PostgreSQL实例端口。</td></tr><tr><td>dbname</td><td>待恢复数据的数据库名称。</td></tr><tr><td>table</td><td>待恢复的表名。</td></tr><tr><td>-c</td><td><code>-c</code>表示在恢复时，会先删除数据库对象再恢复。更多选项的详细说明请参见<a href="https://www.postgresql.org/docs/10/app-pgrestore.html" target="_blank" rel="noreferrer">pg_restore</a>。</td></tr><tr><td>dumpdir</td><td>备份文件路径及名称</td></tr></tbody></table><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">#语法：</span></span>
<span class="line"><span style="color:#B392F0;">pg_restore</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-h</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;&lt;hostname&gt;&#39;</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-U</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">usernam</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-p</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">por</span><span style="color:#E1E4E8;">t</span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-d</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">dbnam</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-t</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">tabl</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-c</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">dumpdi</span><span style="color:#E1E4E8;">r</span><span style="color:#F97583;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#示例</span></span>
<span class="line"><span style="color:#E1E4E8;">[postgres@pg01 </span><span style="color:#F97583;">~</span><span style="color:#E1E4E8;">]$ pg_restore -h </span><span style="color:#9ECBFF;">&#39;127.0.0.1&#39;</span><span style="color:#E1E4E8;"> -U test123 -p 3433 -d testdb2 -t products -c /tmp/testdb.dump</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">#语法：</span></span>
<span class="line"><span style="color:#6F42C1;">pg_restore</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-h</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;&lt;hostname&gt;&#39;</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-U</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">usernam</span><span style="color:#24292E;">e</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-p</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">por</span><span style="color:#24292E;">t</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-d</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">dbnam</span><span style="color:#24292E;">e</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-t</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">tabl</span><span style="color:#24292E;">e</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-c</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">dumpdi</span><span style="color:#24292E;">r</span><span style="color:#D73A49;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#示例</span></span>
<span class="line"><span style="color:#24292E;">[postgres@pg01 </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]$ pg_restore -h </span><span style="color:#032F62;">&#39;127.0.0.1&#39;</span><span style="color:#24292E;"> -U test123 -p 3433 -d testdb2 -t products -c /tmp/testdb.dump</span></span></code></pre></div><h4 id="恢复数据库结构" tabindex="-1">恢复数据库结构 <a class="header-anchor" href="#恢复数据库结构" aria-label="Permalink to &quot;恢复数据库结构&quot;">​</a></h4><table><thead><tr><th>username</th><th>RDS PostgreSQL实例高权限账号名称。</th></tr></thead><tbody><tr><td>port</td><td>RDS PostgreSQL实例端口。</td></tr><tr><td>dbname</td><td>待恢复模式的数据库名称。</td></tr><tr><td>-s</td><td><code>-s</code>表示仅恢复模式，不恢复数据。更多选项的详细说明请参见<a href="https://www.postgresql.org/docs/10/app-pgrestore.html" target="_blank" rel="noreferrer">pg_restore</a>。</td></tr><tr><td>dumpdir</td><td>备份文件路径及名称</td></tr></tbody></table><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">#语法：</span></span>
<span class="line"><span style="color:#B392F0;">pg_restore</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-h</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;&lt;hostname&gt;&#39;</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-U</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">usernam</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-p</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">por</span><span style="color:#E1E4E8;">t</span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-d</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">dbnam</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-s</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">dumpdi</span><span style="color:#E1E4E8;">r</span><span style="color:#F97583;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">[postgres@pg01 </span><span style="color:#F97583;">~</span><span style="color:#E1E4E8;">]$pg_restore -h </span><span style="color:#9ECBFF;">&#39;127.0.0.1&#39;</span><span style="color:#E1E4E8;"> -U test123 -p 3433 -d testdb4 -s /tmp/testdb2.dump</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">#语法：</span></span>
<span class="line"><span style="color:#6F42C1;">pg_restore</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-h</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;&lt;hostname&gt;&#39;</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-U</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">usernam</span><span style="color:#24292E;">e</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-p</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">por</span><span style="color:#24292E;">t</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-d</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">dbnam</span><span style="color:#24292E;">e</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-s</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">dumpdi</span><span style="color:#24292E;">r</span><span style="color:#D73A49;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">[postgres@pg01 </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]$pg_restore -h </span><span style="color:#032F62;">&#39;127.0.0.1&#39;</span><span style="color:#24292E;"> -U test123 -p 3433 -d testdb4 -s /tmp/testdb2.dump</span></span></code></pre></div><h4 id="toc文件" tabindex="-1">toc文件 <a class="header-anchor" href="#toc文件" aria-label="Permalink to &quot;toc文件&quot;">​</a></h4><ul><li>实现精细度恢复</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">#生成备份</span></span>
<span class="line"><span style="color:#B392F0;">pg_dump</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-U</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">postgres</span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">-h</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">127.0</span><span style="color:#9ECBFF;">.0.1</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-p</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5532</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-Fc</span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">-f</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">test.dump</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">test</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#产生toc文件</span></span>
<span class="line"><span style="color:#B392F0;">pg_restore</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-l</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-f</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">test.toc</span><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">test.dump</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#查看toc文件内容,适合数据量小的文件</span></span>
<span class="line"><span style="color:#B392F0;">cat</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">test.toc</span></span>
<span class="line"><span style="color:#E1E4E8;">; </span><span style="color:#B392F0;">Selected</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">TOC</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Entries:</span></span>
<span class="line"><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#B392F0;">215</span><span style="color:#E1E4E8;">; </span><span style="color:#B392F0;">1259</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">40977</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">TABLE</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">public</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">adg</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">postgres</span></span>
<span class="line"><span style="color:#B392F0;">4053</span><span style="color:#E1E4E8;">; </span><span style="color:#B392F0;">0</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">40977</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">TABLE</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">DATA</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">public</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">adg</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">postgres</span></span>
<span class="line"><span style="color:#B392F0;">3909</span><span style="color:#E1E4E8;">; </span><span style="color:#B392F0;">2606</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">40981</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">CONSTRAINT</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">public</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">adg</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">adg_pkey</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">postgres</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#开始恢复</span></span>
<span class="line"><span style="color:#B392F0;">pg_restore</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-F</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">c</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-L</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">test.toc</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-d</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">test</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">test.dump</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">#生成备份</span></span>
<span class="line"><span style="color:#6F42C1;">pg_dump</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-U</span><span style="color:#24292E;"> </span><span style="color:#032F62;">postgres</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">-h</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">127.0</span><span style="color:#032F62;">.0.1</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-p</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5532</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-Fc</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">-f</span><span style="color:#24292E;"> </span><span style="color:#032F62;">test.dump</span><span style="color:#24292E;"> </span><span style="color:#032F62;">test</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#产生toc文件</span></span>
<span class="line"><span style="color:#6F42C1;">pg_restore</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-l</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-f</span><span style="color:#24292E;"> </span><span style="color:#032F62;">test.toc</span><span style="color:#24292E;">  </span><span style="color:#032F62;">test.dump</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#查看toc文件内容,适合数据量小的文件</span></span>
<span class="line"><span style="color:#6F42C1;">cat</span><span style="color:#24292E;"> </span><span style="color:#032F62;">test.toc</span></span>
<span class="line"><span style="color:#24292E;">; </span><span style="color:#6F42C1;">Selected</span><span style="color:#24292E;"> </span><span style="color:#032F62;">TOC</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Entries:</span></span>
<span class="line"><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#6F42C1;">215</span><span style="color:#24292E;">; </span><span style="color:#6F42C1;">1259</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">40977</span><span style="color:#24292E;"> </span><span style="color:#032F62;">TABLE</span><span style="color:#24292E;"> </span><span style="color:#032F62;">public</span><span style="color:#24292E;"> </span><span style="color:#032F62;">adg</span><span style="color:#24292E;"> </span><span style="color:#032F62;">postgres</span></span>
<span class="line"><span style="color:#6F42C1;">4053</span><span style="color:#24292E;">; </span><span style="color:#6F42C1;">0</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">40977</span><span style="color:#24292E;"> </span><span style="color:#032F62;">TABLE</span><span style="color:#24292E;"> </span><span style="color:#032F62;">DATA</span><span style="color:#24292E;"> </span><span style="color:#032F62;">public</span><span style="color:#24292E;"> </span><span style="color:#032F62;">adg</span><span style="color:#24292E;"> </span><span style="color:#032F62;">postgres</span></span>
<span class="line"><span style="color:#6F42C1;">3909</span><span style="color:#24292E;">; </span><span style="color:#6F42C1;">2606</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">40981</span><span style="color:#24292E;"> </span><span style="color:#032F62;">CONSTRAINT</span><span style="color:#24292E;"> </span><span style="color:#032F62;">public</span><span style="color:#24292E;"> </span><span style="color:#032F62;">adg</span><span style="color:#24292E;"> </span><span style="color:#032F62;">adg_pkey</span><span style="color:#24292E;"> </span><span style="color:#032F62;">postgres</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#开始恢复</span></span>
<span class="line"><span style="color:#6F42C1;">pg_restore</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-F</span><span style="color:#24292E;"> </span><span style="color:#032F62;">c</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-L</span><span style="color:#24292E;"> </span><span style="color:#032F62;">test.toc</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-d</span><span style="color:#24292E;"> </span><span style="color:#032F62;">test</span><span style="color:#24292E;"> </span><span style="color:#032F62;">test.dump</span></span></code></pre></div><h3 id="导出数据直接进行恢复" tabindex="-1">导出数据直接进行恢复 <a class="header-anchor" href="#导出数据直接进行恢复" aria-label="Permalink to &quot;导出数据直接进行恢复&quot;">​</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">pg_dump</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-h</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">127.0</span><span style="color:#9ECBFF;">.0.1</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-U</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">postgres</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-d</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">testdb</span><span style="color:#F97583;">|</span><span style="color:#B392F0;">psql</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-h</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">127.0</span><span style="color:#9ECBFF;">.0.1</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-U</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">postgres</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-d</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">testdb1</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">pg_dump</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-h</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">127.0</span><span style="color:#032F62;">.0.1</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-U</span><span style="color:#24292E;"> </span><span style="color:#032F62;">postgres</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-d</span><span style="color:#24292E;"> </span><span style="color:#032F62;">testdb</span><span style="color:#D73A49;">|</span><span style="color:#6F42C1;">psql</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-h</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">127.0</span><span style="color:#032F62;">.0.1</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-U</span><span style="color:#24292E;"> </span><span style="color:#032F62;">postgres</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-d</span><span style="color:#24292E;"> </span><span style="color:#032F62;">testdb1</span></span></code></pre></div><h3 id="并行导入导出" tabindex="-1">并行导入导出 <a class="header-anchor" href="#并行导入导出" aria-label="Permalink to &quot;并行导入导出&quot;">​</a></h3><p>-j4</p><h1 id="_4-常用维护语句" tabindex="-1">4.常用维护语句 <a class="header-anchor" href="#_4-常用维护语句" aria-label="Permalink to &quot;4.常用维护语句&quot;">​</a></h1><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;"> pg_dump </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">U postgres </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">h </span><span style="color:#79B8FF;">127</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">p </span><span style="color:#79B8FF;">5532</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">d fllowordersystem  </span><span style="color:#6A737D;">--no-owner --no-tablespaces --no-privileges &gt;fll.sql</span></span>
<span class="line"><span style="color:#E1E4E8;"> </span></span>
<span class="line"><span style="color:#E1E4E8;"> pg_dump </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">U postgres </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">h </span><span style="color:#79B8FF;">127</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">p </span><span style="color:#79B8FF;">5532</span><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">t fllowordersetting fllowordersystem  </span><span style="color:#6A737D;">--no-owner --no-tablespaces --no-privileges &gt;fllowordersetting.sql</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;"> pg_dump </span><span style="color:#D73A49;">-</span><span style="color:#24292E;">U postgres </span><span style="color:#D73A49;">-</span><span style="color:#24292E;">h </span><span style="color:#005CC5;">127</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">0</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">0</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">1</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">-</span><span style="color:#24292E;">p </span><span style="color:#005CC5;">5532</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">-</span><span style="color:#24292E;">d fllowordersystem  </span><span style="color:#6A737D;">--no-owner --no-tablespaces --no-privileges &gt;fll.sql</span></span>
<span class="line"><span style="color:#24292E;"> </span></span>
<span class="line"><span style="color:#24292E;"> pg_dump </span><span style="color:#D73A49;">-</span><span style="color:#24292E;">U postgres </span><span style="color:#D73A49;">-</span><span style="color:#24292E;">h </span><span style="color:#005CC5;">127</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">0</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">0</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">1</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">-</span><span style="color:#24292E;">p </span><span style="color:#005CC5;">5532</span><span style="color:#24292E;">  </span><span style="color:#D73A49;">-</span><span style="color:#24292E;">t fllowordersetting fllowordersystem  </span><span style="color:#6A737D;">--no-owner --no-tablespaces --no-privileges &gt;fllowordersetting.sql</span></span></code></pre></div><ul><li>创建用户和密码</li></ul><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">postgres@postgres</span><span style="color:#F97583;">=&gt;create</span><span style="color:#E1E4E8;"> user videoh5 </span><span style="color:#F97583;">with</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">password</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;genngiff61&#39;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">postgres@postgres</span><span style="color:#F97583;">=&gt;create</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">database</span><span style="color:#E1E4E8;"> videosh5 </span><span style="color:#F97583;">owner</span><span style="color:#E1E4E8;"> videoh5;</span></span>
<span class="line"><span style="color:#E1E4E8;">postgres@postgres</span><span style="color:#F97583;">=&gt;grant</span><span style="color:#E1E4E8;"> all privileges </span><span style="color:#F97583;">on</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">database</span><span style="color:#E1E4E8;"> videosh5 </span><span style="color:#F97583;">to</span><span style="color:#E1E4E8;"> videoh5;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">GRANT</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">SELECT</span><span style="color:#E1E4E8;">,</span><span style="color:#F97583;">update</span><span style="color:#E1E4E8;">,</span><span style="color:#F97583;">INSERT</span><span style="color:#E1E4E8;">,</span><span style="color:#F97583;">delete</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">ON</span><span style="color:#E1E4E8;"> ALL TABLES </span><span style="color:#F97583;">IN</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">SCHEMA</span><span style="color:#E1E4E8;"> public </span><span style="color:#F97583;">TO</span><span style="color:#E1E4E8;"> gendanuser ;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">postgres@postgres</span><span style="color:#D73A49;">=&gt;create</span><span style="color:#24292E;"> user videoh5 </span><span style="color:#D73A49;">with</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">password</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;genngiff61&#39;</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">postgres@postgres</span><span style="color:#D73A49;">=&gt;create</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">database</span><span style="color:#24292E;"> videosh5 </span><span style="color:#D73A49;">owner</span><span style="color:#24292E;"> videoh5;</span></span>
<span class="line"><span style="color:#24292E;">postgres@postgres</span><span style="color:#D73A49;">=&gt;grant</span><span style="color:#24292E;"> all privileges </span><span style="color:#D73A49;">on</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">database</span><span style="color:#24292E;"> videosh5 </span><span style="color:#D73A49;">to</span><span style="color:#24292E;"> videoh5;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">GRANT</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">SELECT</span><span style="color:#24292E;">,</span><span style="color:#D73A49;">update</span><span style="color:#24292E;">,</span><span style="color:#D73A49;">INSERT</span><span style="color:#24292E;">,</span><span style="color:#D73A49;">delete</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">ON</span><span style="color:#24292E;"> ALL TABLES </span><span style="color:#D73A49;">IN</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">SCHEMA</span><span style="color:#24292E;"> public </span><span style="color:#D73A49;">TO</span><span style="color:#24292E;"> gendanuser ;</span></span></code></pre></div><ul><li>import</li></ul><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">psql </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">U lianghua </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">h </span><span style="color:#79B8FF;">127</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">p </span><span style="color:#79B8FF;">5532</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">f </span><span style="color:#79B8FF;">my</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">sql</span><span style="color:#E1E4E8;"> db_name</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">psql </span><span style="color:#D73A49;">-</span><span style="color:#24292E;">U lianghua </span><span style="color:#D73A49;">-</span><span style="color:#24292E;">h </span><span style="color:#005CC5;">127</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">0</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">0</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">1</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">-</span><span style="color:#24292E;">p </span><span style="color:#005CC5;">5532</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">-</span><span style="color:#24292E;">f </span><span style="color:#005CC5;">my</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">sql</span><span style="color:#24292E;"> db_name</span></span></code></pre></div><ul><li>删除日志脚本</li></ul><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">reserved_num</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">10</span><span style="color:#E1E4E8;">  #保留文件数</span></span>
<span class="line"><span style="color:#E1E4E8;">file_dir</span><span style="color:#F97583;">=/data/</span><span style="color:#E1E4E8;">pgdata</span><span style="color:#F97583;">/data/log</span></span>
<span class="line"><span style="color:#F97583;">date=</span><span style="color:#E1E4E8;">$(</span><span style="color:#F97583;">date</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;+%Y-%m-%d&quot;</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">cd $file_dir   #进入备份目录</span></span>
<span class="line"><span style="color:#E1E4E8;">file_num</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">$(ls </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">l | wc </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">l)   #当前有几个文件夹，即几个备份</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">while</span><span style="color:#E1E4E8;">(( $file_num </span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;"> $reserved_num ))</span></span>
<span class="line"><span style="color:#E1E4E8;">do</span></span>
<span class="line"><span style="color:#E1E4E8;">    old_file</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">$(ls </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">rt | head </span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">)         #获取最旧的那个备份文件夹</span></span>
<span class="line"><span style="color:#E1E4E8;">    echo  $</span><span style="color:#F97583;">date</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;Delete File:&quot;</span><span style="color:#E1E4E8;">$old_file</span></span>
<span class="line"><span style="color:#E1E4E8;">    rm </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">f </span><span style="color:#9ECBFF;">&quot;\${file_dir}/$old_file&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">    let </span><span style="color:#9ECBFF;">&quot;file_num--&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">done </span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">ls </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">l $file_dir</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">reserved_num</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">10</span><span style="color:#24292E;">  #保留文件数</span></span>
<span class="line"><span style="color:#24292E;">file_dir</span><span style="color:#D73A49;">=/data/</span><span style="color:#24292E;">pgdata</span><span style="color:#D73A49;">/data/log</span></span>
<span class="line"><span style="color:#D73A49;">date=</span><span style="color:#24292E;">$(</span><span style="color:#D73A49;">date</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;+%Y-%m-%d&quot;</span><span style="color:#24292E;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">cd $file_dir   #进入备份目录</span></span>
<span class="line"><span style="color:#24292E;">file_num</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">$(ls </span><span style="color:#D73A49;">-</span><span style="color:#24292E;">l | wc </span><span style="color:#D73A49;">-</span><span style="color:#24292E;">l)   #当前有几个文件夹，即几个备份</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">while</span><span style="color:#24292E;">(( $file_num </span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;"> $reserved_num ))</span></span>
<span class="line"><span style="color:#24292E;">do</span></span>
<span class="line"><span style="color:#24292E;">    old_file</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">$(ls </span><span style="color:#D73A49;">-</span><span style="color:#24292E;">rt | head </span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">1</span><span style="color:#24292E;">)         #获取最旧的那个备份文件夹</span></span>
<span class="line"><span style="color:#24292E;">    echo  $</span><span style="color:#D73A49;">date</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;Delete File:&quot;</span><span style="color:#24292E;">$old_file</span></span>
<span class="line"><span style="color:#24292E;">    rm </span><span style="color:#D73A49;">-</span><span style="color:#24292E;">f </span><span style="color:#032F62;">&quot;\${file_dir}/$old_file&quot;</span></span>
<span class="line"><span style="color:#24292E;">    let </span><span style="color:#032F62;">&quot;file_num--&quot;</span></span>
<span class="line"><span style="color:#24292E;">done </span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">ls </span><span style="color:#D73A49;">-</span><span style="color:#24292E;">l $file_dir</span></span></code></pre></div>`,86),e=[o];function t(c,r,y,E,i,F){return a(),n("div",null,e)}const g=s(l,[["render",t]]);export{C as __pageData,g as default};
