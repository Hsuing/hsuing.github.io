import{_ as s,o as a,c as n,R as o}from"./chunks/framework.zUbWieqp.js";const C=JSON.parse('{"title":"1. 节点notready时pod快速驱逐","description":"","frontmatter":{},"headers":[],"relativePath":"guide/container/k8s/cmd/kubelet.md","filePath":"guide/container/k8s/cmd/kubelet.md","lastUpdated":1723536306000}'),l={name:"guide/container/k8s/cmd/kubelet.md"},p=o(`<h1 id="_1-节点notready时pod快速驱逐" tabindex="-1">1. 节点notready时pod快速驱逐 <a class="header-anchor" href="#_1-节点notready时pod快速驱逐" aria-label="Permalink to &quot;1. 节点notready时pod快速驱逐&quot;">​</a></h1><h2 id="_1-1-场景" tabindex="-1">1.1 场景 <a class="header-anchor" href="#_1-1-场景" aria-label="Permalink to &quot;1.1 场景&quot;">​</a></h2><p>节点notready后大概5分钟才能重新调度pod，生产环境中高并发的场景下，一个副本5分钟无法提供服务，肯定会将请求压力转到其他副本，容易造成堵塞，严重的会阻断服务。如何缩短这个时间？</p><h2 id="_1-2-解决方式" tabindex="-1">1.2 解决方式 <a class="header-anchor" href="#_1-2-解决方式" aria-label="Permalink to &quot;1.2 解决方式&quot;">​</a></h2><p>k8s中有个准入控制器：<code>DefaultTolerationSeconds</code>。</p><p>此准入控制器基于 k8s-apiserver 的输入参数 <code>default-not-ready-toleration-seconds</code> 和 <code>default-unreachable-toleration-seconds</code> 为 Pod 设置默认的容忍度，以容忍 notready:NoExecute 和 unreachable:NoExecute 污点 （如果 Pod 尚未容忍 node.kubernetes.io/not-ready：NoExecute 和 node.kubernetes.io/unreachable：NoExecute 污点的话）。</p><p><code>default-not-ready-toleration-seconds</code> 和 <code>default-unreachable-toleration-seconds</code> 的默认值是 5 分钟</p><h1 id="_2-测试" tabindex="-1">2. 测试 <a class="header-anchor" href="#_2-测试" aria-label="Permalink to &quot;2. 测试&quot;">​</a></h1><h2 id="_2-1-修改参数之前" tabindex="-1">2.1 修改参数之前 <a class="header-anchor" href="#_2-1-修改参数之前" aria-label="Permalink to &quot;2.1 修改参数之前&quot;">​</a></h2><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">[root@k8s-master daemonset]# kubectl get pod -n test -o wide -w</span></span>
<span class="line"><span style="color:#B392F0;">NAME</span><span style="color:#E1E4E8;">                     </span><span style="color:#9ECBFF;">READY</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">STATUS</span><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">RESTARTS</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">AGE</span><span style="color:#E1E4E8;">     </span><span style="color:#9ECBFF;">IP</span><span style="color:#E1E4E8;">               </span><span style="color:#9ECBFF;">NODE</span><span style="color:#E1E4E8;">        </span><span style="color:#9ECBFF;">NOMINATED</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">NODE</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">READINESS</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">GATES</span></span>
<span class="line"><span style="color:#B392F0;">nginx-854d5f75db-f9h89</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">1</span><span style="color:#9ECBFF;">/1</span><span style="color:#E1E4E8;">     </span><span style="color:#9ECBFF;">Running</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">          </span><span style="color:#79B8FF;">2</span><span style="color:#9ECBFF;">m30s</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">10.244</span><span style="color:#9ECBFF;">.169.143</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">k8s-node2</span><span style="color:#E1E4E8;">   </span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">non</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;">           </span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">non</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">[root@k8s-master daemonset]# kubectl get pod -n test -o wide -w</span></span>
<span class="line"><span style="color:#6F42C1;">NAME</span><span style="color:#24292E;">                     </span><span style="color:#032F62;">READY</span><span style="color:#24292E;">   </span><span style="color:#032F62;">STATUS</span><span style="color:#24292E;">    </span><span style="color:#032F62;">RESTARTS</span><span style="color:#24292E;">   </span><span style="color:#032F62;">AGE</span><span style="color:#24292E;">     </span><span style="color:#032F62;">IP</span><span style="color:#24292E;">               </span><span style="color:#032F62;">NODE</span><span style="color:#24292E;">        </span><span style="color:#032F62;">NOMINATED</span><span style="color:#24292E;"> </span><span style="color:#032F62;">NODE</span><span style="color:#24292E;">   </span><span style="color:#032F62;">READINESS</span><span style="color:#24292E;"> </span><span style="color:#032F62;">GATES</span></span>
<span class="line"><span style="color:#6F42C1;">nginx-854d5f75db-f9h89</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">1</span><span style="color:#032F62;">/1</span><span style="color:#24292E;">     </span><span style="color:#032F62;">Running</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">          </span><span style="color:#005CC5;">2</span><span style="color:#032F62;">m30s</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">10.244</span><span style="color:#032F62;">.169.143</span><span style="color:#24292E;">   </span><span style="color:#032F62;">k8s-node2</span><span style="color:#24292E;">   </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">non</span><span style="color:#24292E;">e</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;">           </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">non</span><span style="color:#24292E;">e</span><span style="color:#D73A49;">&gt;</span></span></code></pre></div><p>停止k8s-node2的kubelet，使node notready</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">systemctl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">stop</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">kubelet</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">systemctl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">stop</span><span style="color:#24292E;"> </span><span style="color:#032F62;">kubelet</span></span></code></pre></div><ul><li>查看节点</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">[root@k8s-master </span><span style="color:#F97583;">~</span><span style="color:#E1E4E8;">]# kubectl get node</span></span>
<span class="line"><span style="color:#B392F0;">NAME</span><span style="color:#E1E4E8;">         </span><span style="color:#9ECBFF;">STATUS</span><span style="color:#E1E4E8;">                     </span><span style="color:#9ECBFF;">ROLES</span><span style="color:#E1E4E8;">                  </span><span style="color:#9ECBFF;">AGE</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">VERSION</span></span>
<span class="line"><span style="color:#B392F0;">k8s-master</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">Ready</span><span style="color:#E1E4E8;">                      </span><span style="color:#9ECBFF;">control-plane,master</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">29</span><span style="color:#9ECBFF;">d</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">v1.20.13</span></span>
<span class="line"><span style="color:#B392F0;">k8s-node1</span><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">Ready</span><span style="color:#E1E4E8;">                      </span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">non</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;">                 </span><span style="color:#79B8FF;">29</span><span style="color:#9ECBFF;">d</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">v1.20.13</span></span>
<span class="line"><span style="color:#B392F0;">k8s-node2</span><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">NotReady</span><span style="color:#E1E4E8;">                   </span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">non</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;">                 </span><span style="color:#79B8FF;">29</span><span style="color:#9ECBFF;">d</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">v1.20.13</span></span>
<span class="line"><span style="color:#B392F0;">k8s-node3</span><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">Ready,SchedulingDisabled</span><span style="color:#E1E4E8;">   </span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">non</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;">                 </span><span style="color:#79B8FF;">29</span><span style="color:#9ECBFF;">d</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">v1.20.13</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">[root@k8s-master </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# kubectl get node</span></span>
<span class="line"><span style="color:#6F42C1;">NAME</span><span style="color:#24292E;">         </span><span style="color:#032F62;">STATUS</span><span style="color:#24292E;">                     </span><span style="color:#032F62;">ROLES</span><span style="color:#24292E;">                  </span><span style="color:#032F62;">AGE</span><span style="color:#24292E;">   </span><span style="color:#032F62;">VERSION</span></span>
<span class="line"><span style="color:#6F42C1;">k8s-master</span><span style="color:#24292E;">   </span><span style="color:#032F62;">Ready</span><span style="color:#24292E;">                      </span><span style="color:#032F62;">control-plane,master</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">29</span><span style="color:#032F62;">d</span><span style="color:#24292E;">   </span><span style="color:#032F62;">v1.20.13</span></span>
<span class="line"><span style="color:#6F42C1;">k8s-node1</span><span style="color:#24292E;">    </span><span style="color:#032F62;">Ready</span><span style="color:#24292E;">                      </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">non</span><span style="color:#24292E;">e</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;">                 </span><span style="color:#005CC5;">29</span><span style="color:#032F62;">d</span><span style="color:#24292E;">   </span><span style="color:#032F62;">v1.20.13</span></span>
<span class="line"><span style="color:#6F42C1;">k8s-node2</span><span style="color:#24292E;">    </span><span style="color:#032F62;">NotReady</span><span style="color:#24292E;">                   </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">non</span><span style="color:#24292E;">e</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;">                 </span><span style="color:#005CC5;">29</span><span style="color:#032F62;">d</span><span style="color:#24292E;">   </span><span style="color:#032F62;">v1.20.13</span></span>
<span class="line"><span style="color:#6F42C1;">k8s-node3</span><span style="color:#24292E;">    </span><span style="color:#032F62;">Ready,SchedulingDisabled</span><span style="color:#24292E;">   </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">non</span><span style="color:#24292E;">e</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;">                 </span><span style="color:#005CC5;">29</span><span style="color:#032F62;">d</span><span style="color:#24292E;">   </span><span style="color:#032F62;">v1.20.13</span></span></code></pre></div><ul><li>再次查看Pod</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">[root@k8s-master daemonset]# kubectl get pod -n test -o wide</span></span>
<span class="line"><span style="color:#B392F0;">NAME</span><span style="color:#E1E4E8;">                     </span><span style="color:#9ECBFF;">READY</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">STATUS</span><span style="color:#E1E4E8;">        </span><span style="color:#9ECBFF;">RESTARTS</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">AGE</span><span style="color:#E1E4E8;">     </span><span style="color:#9ECBFF;">IP</span><span style="color:#E1E4E8;">               </span><span style="color:#9ECBFF;">NODE</span><span style="color:#E1E4E8;">        </span><span style="color:#9ECBFF;">NOMINATED</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">NODE</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">READINESS</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">GATES</span></span>
<span class="line"><span style="color:#B392F0;">nginx-854d5f75db-f9h89</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">1</span><span style="color:#9ECBFF;">/1</span><span style="color:#E1E4E8;">     </span><span style="color:#9ECBFF;">Terminating</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">          </span><span style="color:#79B8FF;">50</span><span style="color:#9ECBFF;">m</span><span style="color:#E1E4E8;">     </span><span style="color:#79B8FF;">10.244</span><span style="color:#9ECBFF;">.169.143</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">k8s-node2</span><span style="color:#E1E4E8;">   </span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">non</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;">           </span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">non</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span></span>
<span class="line"><span style="color:#B392F0;">nginx-854d5f75db-r29rb</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">1</span><span style="color:#9ECBFF;">/1</span><span style="color:#E1E4E8;">     </span><span style="color:#9ECBFF;">Running</span><span style="color:#E1E4E8;">       </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">          </span><span style="color:#79B8FF;">3</span><span style="color:#9ECBFF;">m54s</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">10.244</span><span style="color:#9ECBFF;">.36.116</span><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">k8s-node1</span><span style="color:#E1E4E8;">   </span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">non</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;">           </span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">non</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">[root@k8s-master daemonset]# kubectl get pod -n test -o wide</span></span>
<span class="line"><span style="color:#6F42C1;">NAME</span><span style="color:#24292E;">                     </span><span style="color:#032F62;">READY</span><span style="color:#24292E;">   </span><span style="color:#032F62;">STATUS</span><span style="color:#24292E;">        </span><span style="color:#032F62;">RESTARTS</span><span style="color:#24292E;">   </span><span style="color:#032F62;">AGE</span><span style="color:#24292E;">     </span><span style="color:#032F62;">IP</span><span style="color:#24292E;">               </span><span style="color:#032F62;">NODE</span><span style="color:#24292E;">        </span><span style="color:#032F62;">NOMINATED</span><span style="color:#24292E;"> </span><span style="color:#032F62;">NODE</span><span style="color:#24292E;">   </span><span style="color:#032F62;">READINESS</span><span style="color:#24292E;"> </span><span style="color:#032F62;">GATES</span></span>
<span class="line"><span style="color:#6F42C1;">nginx-854d5f75db-f9h89</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">1</span><span style="color:#032F62;">/1</span><span style="color:#24292E;">     </span><span style="color:#032F62;">Terminating</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">          </span><span style="color:#005CC5;">50</span><span style="color:#032F62;">m</span><span style="color:#24292E;">     </span><span style="color:#005CC5;">10.244</span><span style="color:#032F62;">.169.143</span><span style="color:#24292E;">   </span><span style="color:#032F62;">k8s-node2</span><span style="color:#24292E;">   </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">non</span><span style="color:#24292E;">e</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;">           </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">non</span><span style="color:#24292E;">e</span><span style="color:#D73A49;">&gt;</span></span>
<span class="line"><span style="color:#6F42C1;">nginx-854d5f75db-r29rb</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">1</span><span style="color:#032F62;">/1</span><span style="color:#24292E;">     </span><span style="color:#032F62;">Running</span><span style="color:#24292E;">       </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">          </span><span style="color:#005CC5;">3</span><span style="color:#032F62;">m54s</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">10.244</span><span style="color:#032F62;">.36.116</span><span style="color:#24292E;">    </span><span style="color:#032F62;">k8s-node1</span><span style="color:#24292E;">   </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">non</span><span style="color:#24292E;">e</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;">           </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">non</span><span style="color:#24292E;">e</span><span style="color:#D73A49;">&gt;</span></span></code></pre></div><h3 id="_2-1-1-判断节点notready5分钟后pod被调度" tabindex="-1">2.1.1 判断节点notready5分钟后pod被调度 <a class="header-anchor" href="#_2-1-1-判断节点notready5分钟后pod被调度" aria-label="Permalink to &quot;2.1.1 判断节点notready5分钟后pod被调度&quot;">​</a></h3><ul><li>查看node的污点创建时间</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">[root@k8s-master </span><span style="color:#F97583;">~</span><span style="color:#E1E4E8;">]# kubectl get node k8s-node2 -o custom-columns=Name:.metadata.name,Taints:.spec.taints</span></span>
<span class="line"><span style="color:#B392F0;">Name</span><span style="color:#E1E4E8;">        </span><span style="color:#9ECBFF;">Taints</span></span>
<span class="line"><span style="color:#B392F0;">k8s-node2</span><span style="color:#E1E4E8;">   [map[effect:NoSchedule </span><span style="color:#9ECBFF;">key:node.kubernetes.io/unreachable</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">timeAdded:2023-03-09T09:27:52Z]</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">map[effect:NoExecute</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">key:node.kubernetes.io/unreachable</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">timeAdded:2023-03-09T09:27:57Z]]</span></span>
<span class="line"><span style="color:#6A737D;">## effect=NoExcute污点添加时间是27分57秒</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">[root@k8s-master </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# kubectl get node k8s-node2 -o custom-columns=Name:.metadata.name,Taints:.spec.taints</span></span>
<span class="line"><span style="color:#6F42C1;">Name</span><span style="color:#24292E;">        </span><span style="color:#032F62;">Taints</span></span>
<span class="line"><span style="color:#6F42C1;">k8s-node2</span><span style="color:#24292E;">   [map[effect:NoSchedule </span><span style="color:#032F62;">key:node.kubernetes.io/unreachable</span><span style="color:#24292E;"> </span><span style="color:#032F62;">timeAdded:2023-03-09T09:27:52Z]</span><span style="color:#24292E;"> </span><span style="color:#032F62;">map[effect:NoExecute</span><span style="color:#24292E;"> </span><span style="color:#032F62;">key:node.kubernetes.io/unreachable</span><span style="color:#24292E;"> </span><span style="color:#032F62;">timeAdded:2023-03-09T09:27:57Z]]</span></span>
<span class="line"><span style="color:#6A737D;">## effect=NoExcute污点添加时间是27分57秒</span></span></code></pre></div><ul><li>查看pod创建时间</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">[root@k8s-master daemonset]# kubectl describe  pod nginx-854d5f75db-r29rb -n test</span></span>
<span class="line"><span style="color:#B392F0;">Name:</span><span style="color:#E1E4E8;">         </span><span style="color:#9ECBFF;">nginx-854d5f75db-r29rb</span></span>
<span class="line"><span style="color:#B392F0;">Namespace:</span><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">test</span></span>
<span class="line"><span style="color:#B392F0;">Priority:</span><span style="color:#E1E4E8;">     </span><span style="color:#79B8FF;">0</span></span>
<span class="line"><span style="color:#B392F0;">Node:</span><span style="color:#E1E4E8;">         </span><span style="color:#9ECBFF;">k8s-node1/192.168.0.38</span></span>
<span class="line"><span style="color:#B392F0;">Start</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Time:</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">Thu,</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">09</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Mar</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2023</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">17</span><span style="color:#9ECBFF;">:32:57</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">+0800</span><span style="color:#E1E4E8;">        </span><span style="color:#6A737D;"># pod启动时间是32分57秒</span></span>
<span class="line"><span style="color:#B392F0;">Labels:</span><span style="color:#E1E4E8;">       </span><span style="color:#9ECBFF;">k8s.kuboard.cn/layer=gateway</span></span>
<span class="line"><span style="color:#E1E4E8;">              </span><span style="color:#B392F0;">k8s.kuboard.cn/name</span><span style="color:#E1E4E8;">=nginx</span></span>
<span class="line"><span style="color:#E1E4E8;">              pod-template-hash</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">854</span><span style="color:#9ECBFF;">d5f75db</span></span>
<span class="line"><span style="color:#B392F0;">Annotations:</span><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">cni.projectcalico.org/containerID:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">d0a0cd39f52fa3dfb65a6a0b710e78dd44b8a9c31780885a28ec56aa7a0cd07c</span></span>
<span class="line"><span style="color:#E1E4E8;">              </span><span style="color:#B392F0;">cni.projectcalico.org/podIP:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">10.244</span><span style="color:#9ECBFF;">.36.116/32</span></span>
<span class="line"><span style="color:#E1E4E8;">              </span><span style="color:#B392F0;">cni.projectcalico.org/podIPs:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">10.244</span><span style="color:#9ECBFF;">.36.116/32</span></span>
<span class="line"><span style="color:#B392F0;">Status:</span><span style="color:#E1E4E8;">       </span><span style="color:#9ECBFF;">Running</span></span>
<span class="line"><span style="color:#B392F0;">IP:</span><span style="color:#E1E4E8;">           </span><span style="color:#79B8FF;">10.244</span><span style="color:#9ECBFF;">.36.116</span></span>
<span class="line"><span style="color:#B392F0;">。。。。。。</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">[root@k8s-master daemonset]# kubectl describe  pod nginx-854d5f75db-r29rb -n test</span></span>
<span class="line"><span style="color:#6F42C1;">Name:</span><span style="color:#24292E;">         </span><span style="color:#032F62;">nginx-854d5f75db-r29rb</span></span>
<span class="line"><span style="color:#6F42C1;">Namespace:</span><span style="color:#24292E;">    </span><span style="color:#032F62;">test</span></span>
<span class="line"><span style="color:#6F42C1;">Priority:</span><span style="color:#24292E;">     </span><span style="color:#005CC5;">0</span></span>
<span class="line"><span style="color:#6F42C1;">Node:</span><span style="color:#24292E;">         </span><span style="color:#032F62;">k8s-node1/192.168.0.38</span></span>
<span class="line"><span style="color:#6F42C1;">Start</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Time:</span><span style="color:#24292E;">   </span><span style="color:#032F62;">Thu,</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">09</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Mar</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2023</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">17</span><span style="color:#032F62;">:32:57</span><span style="color:#24292E;"> </span><span style="color:#032F62;">+0800</span><span style="color:#24292E;">        </span><span style="color:#6A737D;"># pod启动时间是32分57秒</span></span>
<span class="line"><span style="color:#6F42C1;">Labels:</span><span style="color:#24292E;">       </span><span style="color:#032F62;">k8s.kuboard.cn/layer=gateway</span></span>
<span class="line"><span style="color:#24292E;">              </span><span style="color:#6F42C1;">k8s.kuboard.cn/name</span><span style="color:#24292E;">=nginx</span></span>
<span class="line"><span style="color:#24292E;">              pod-template-hash</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">854</span><span style="color:#032F62;">d5f75db</span></span>
<span class="line"><span style="color:#6F42C1;">Annotations:</span><span style="color:#24292E;">  </span><span style="color:#032F62;">cni.projectcalico.org/containerID:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">d0a0cd39f52fa3dfb65a6a0b710e78dd44b8a9c31780885a28ec56aa7a0cd07c</span></span>
<span class="line"><span style="color:#24292E;">              </span><span style="color:#6F42C1;">cni.projectcalico.org/podIP:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">10.244</span><span style="color:#032F62;">.36.116/32</span></span>
<span class="line"><span style="color:#24292E;">              </span><span style="color:#6F42C1;">cni.projectcalico.org/podIPs:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">10.244</span><span style="color:#032F62;">.36.116/32</span></span>
<span class="line"><span style="color:#6F42C1;">Status:</span><span style="color:#24292E;">       </span><span style="color:#032F62;">Running</span></span>
<span class="line"><span style="color:#6F42C1;">IP:</span><span style="color:#24292E;">           </span><span style="color:#005CC5;">10.244</span><span style="color:#032F62;">.36.116</span></span>
<span class="line"><span style="color:#6F42C1;">。。。。。。</span></span></code></pre></div><blockquote><p><strong>pod创建时间 - 污点添加时间=5分钟</strong></p></blockquote><h2 id="_2-2-修改参数" tabindex="-1">2.2 修改参数 <a class="header-anchor" href="#_2-2-修改参数" aria-label="Permalink to &quot;2.2 修改参数&quot;">​</a></h2><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">[root@k8s-master daemonset]# vim /etc/kubernetes/manifests/kube-apiserver.yaml</span></span>
<span class="line"><span style="color:#6A737D;">##在command末尾添加</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">-</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--default-not-ready-toleration-seconds=30</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">-</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--default-unreachable-toleration-seconds=30</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">[root@k8s-master daemonset]# vim /etc/kubernetes/manifests/kube-apiserver.yaml</span></span>
<span class="line"><span style="color:#6A737D;">##在command末尾添加</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">-</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--default-not-ready-toleration-seconds=30</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">-</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--default-unreachable-toleration-seconds=30</span></span></code></pre></div><p>之后,kube-apiserver会自动重启</p><p><strong>查看时间,根据2.1.1中的方式查看</strong></p>`,26),e=[p];function t(c,r,y,E,F,d){return a(),n("div",null,e)}const u=s(l,[["render",t]]);export{C as __pageData,u as default};
