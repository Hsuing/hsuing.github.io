import{_ as s,o as a,c as n,R as l}from"./chunks/framework.zUbWieqp.js";const F=JSON.parse('{"title":"1. 连接数据库","description":"","frontmatter":{},"headers":[],"relativePath":"guide/Linux/Logs/Clickhouse/base/2-query.md","filePath":"guide/Linux/Logs/Clickhouse/base/2-query.md","lastUpdated":1730975389000}'),p={name:"guide/Linux/Logs/Clickhouse/base/2-query.md"},o=l(`<h1 id="_1-连接数据库" tabindex="-1">1. 连接数据库 <a class="header-anchor" href="#_1-连接数据库" aria-label="Permalink to &quot;1. 连接数据库&quot;">​</a></h1><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">#有密码</span></span>
<span class="line"><span style="color:#B392F0;">clickhouse-client</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-h</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">127.0</span><span style="color:#9ECBFF;">.0.1</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-u</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">default</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--password</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">123456</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#无密码</span></span>
<span class="line"><span style="color:#B392F0;">clickhouse-client</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">#有密码</span></span>
<span class="line"><span style="color:#6F42C1;">clickhouse-client</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-h</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">127.0</span><span style="color:#032F62;">.0.1</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-u</span><span style="color:#24292E;"> </span><span style="color:#032F62;">default</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--password</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">123456</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#无密码</span></span>
<span class="line"><span style="color:#6F42C1;">clickhouse-client</span></span></code></pre></div><h1 id="_2-查询" tabindex="-1">2. 查询 <a class="header-anchor" href="#_2-查询" aria-label="Permalink to &quot;2. 查询&quot;">​</a></h1><h2 id="_1-查询存储空间" tabindex="-1">1. 查询存储空间 <a class="header-anchor" href="#_1-查询存储空间" aria-label="Permalink to &quot;1. 查询存储空间&quot;">​</a></h2><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">SELECT</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">name</span><span style="color:#E1E4E8;">, </span><span style="color:#F97583;">path</span><span style="color:#E1E4E8;">, formatReadableSize(free_space) </span><span style="color:#F97583;">AS</span><span style="color:#E1E4E8;"> free, formatReadableSize(total_space) </span><span style="color:#F97583;">AS</span><span style="color:#E1E4E8;"> total, formatReadableSize(keep_free_space) </span><span style="color:#F97583;">AS</span><span style="color:#E1E4E8;"> reserved </span><span style="color:#F97583;">FROM</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">system</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">disks</span><span style="color:#E1E4E8;">;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">SELECT</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">name</span><span style="color:#24292E;">, </span><span style="color:#D73A49;">path</span><span style="color:#24292E;">, formatReadableSize(free_space) </span><span style="color:#D73A49;">AS</span><span style="color:#24292E;"> free, formatReadableSize(total_space) </span><span style="color:#D73A49;">AS</span><span style="color:#24292E;"> total, formatReadableSize(keep_free_space) </span><span style="color:#D73A49;">AS</span><span style="color:#24292E;"> reserved </span><span style="color:#D73A49;">FROM</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">system</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">disks</span><span style="color:#24292E;">;</span></span></code></pre></div><p><img src="https://nnaigos.oss-cn-hangzhou.aliyuncs.com/imgs/202411052112952.png" alt="image-20241105211231782"></p><h2 id="_2-查看数据库大小" tabindex="-1">2. 查看数据库大小 <a class="header-anchor" href="#_2-查看数据库大小" aria-label="Permalink to &quot;2. 查看数据库大小&quot;">​</a></h2><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">SELECT</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">database</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    formatReadableSize(</span><span style="color:#79B8FF;">sum</span><span style="color:#E1E4E8;">(bytes_on_disk)) </span><span style="color:#F97583;">AS</span><span style="color:#E1E4E8;"> size_on_disk</span></span>
<span class="line"><span style="color:#F97583;">FROM</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">system</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">parts</span></span>
<span class="line"><span style="color:#F97583;">WHERE</span><span style="color:#E1E4E8;"> active</span></span>
<span class="line"><span style="color:#F97583;">GROUP BY</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">database</span></span>
<span class="line"><span style="color:#F97583;">ORDER BY</span><span style="color:#E1E4E8;"> size_on_disk </span><span style="color:#F97583;">DESC</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">SELECT</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">database</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">    formatReadableSize(</span><span style="color:#005CC5;">sum</span><span style="color:#24292E;">(bytes_on_disk)) </span><span style="color:#D73A49;">AS</span><span style="color:#24292E;"> size_on_disk</span></span>
<span class="line"><span style="color:#D73A49;">FROM</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">system</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">parts</span></span>
<span class="line"><span style="color:#D73A49;">WHERE</span><span style="color:#24292E;"> active</span></span>
<span class="line"><span style="color:#D73A49;">GROUP BY</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">database</span></span>
<span class="line"><span style="color:#D73A49;">ORDER BY</span><span style="color:#24292E;"> size_on_disk </span><span style="color:#D73A49;">DESC</span></span></code></pre></div><p><img src="https://nnaigos.oss-cn-hangzhou.aliyuncs.com/imgs/202411061635748.png" alt="image-20241106163456603"></p><h2 id="_3-查看表大小" tabindex="-1">3. 查看表大小 <a class="header-anchor" href="#_3-查看表大小" aria-label="Permalink to &quot;3. 查看表大小&quot;">​</a></h2><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">SELECT</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">table</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    formatReadableSize(</span><span style="color:#79B8FF;">sum</span><span style="color:#E1E4E8;">(bytes_on_disk)) </span><span style="color:#F97583;">AS</span><span style="color:#E1E4E8;"> size_on_disk</span></span>
<span class="line"><span style="color:#F97583;">FROM</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">system</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">parts</span></span>
<span class="line"><span style="color:#F97583;">WHERE</span><span style="color:#E1E4E8;"> active</span></span>
<span class="line"><span style="color:#F97583;">GROUP BY</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">table</span></span>
<span class="line"><span style="color:#F97583;">ORDER BY</span><span style="color:#E1E4E8;"> size_on_disk </span><span style="color:#F97583;">DESC</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">SELECT</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">table</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">    formatReadableSize(</span><span style="color:#005CC5;">sum</span><span style="color:#24292E;">(bytes_on_disk)) </span><span style="color:#D73A49;">AS</span><span style="color:#24292E;"> size_on_disk</span></span>
<span class="line"><span style="color:#D73A49;">FROM</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">system</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">parts</span></span>
<span class="line"><span style="color:#D73A49;">WHERE</span><span style="color:#24292E;"> active</span></span>
<span class="line"><span style="color:#D73A49;">GROUP BY</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">table</span></span>
<span class="line"><span style="color:#D73A49;">ORDER BY</span><span style="color:#24292E;"> size_on_disk </span><span style="color:#D73A49;">DESC</span></span></code></pre></div><h3 id="_1-查看系统表" tabindex="-1">1.查看系统表 <a class="header-anchor" href="#_1-查看系统表" aria-label="Permalink to &quot;1.查看系统表&quot;">​</a></h3><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">select</span></span>
<span class="line"><span style="color:#E1E4E8;">　　</span><span style="color:#F97583;">database</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">　　</span><span style="color:#F97583;">table</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">　　formatReadableSize(</span><span style="color:#F97583;">size</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">size</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">　　formatReadableSize(bytes_on_disk) </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> bytes_on_disk,</span></span>
<span class="line"><span style="color:#E1E4E8;">　　formatReadableSize(data_uncompressed_bytes) </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> data_uncompressed_bytes,</span></span>
<span class="line"><span style="color:#E1E4E8;">　　formatReadableSize(data_compressed_bytes) </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> data_compressed_bytes,</span></span>
<span class="line"><span style="color:#E1E4E8;">　 compress_rate,</span></span>
<span class="line"><span style="color:#E1E4E8;">　　</span><span style="color:#F97583;">rows</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">　　</span><span style="color:#F97583;">days</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">　　formatReadableSize(avgDaySize) </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> avgDaySize</span></span>
<span class="line"><span style="color:#F97583;">from</span></span>
<span class="line"><span style="color:#E1E4E8;">　(</span></span>
<span class="line"><span style="color:#E1E4E8;">　　　</span><span style="color:#F97583;">select</span></span>
<span class="line"><span style="color:#E1E4E8;">　　　　　　</span><span style="color:#F97583;">database</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">　　　　　　</span><span style="color:#F97583;">table</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">　　　　　　</span><span style="color:#79B8FF;">sum</span><span style="color:#E1E4E8;">(bytes) </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">size</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">　　　　　　</span><span style="color:#79B8FF;">sum</span><span style="color:#E1E4E8;">(</span><span style="color:#F97583;">rows</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">rows</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">　　　　　　</span><span style="color:#79B8FF;">min</span><span style="color:#E1E4E8;">(min_date) </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> min_date,</span></span>
<span class="line"><span style="color:#E1E4E8;">　　　　　　</span><span style="color:#79B8FF;">max</span><span style="color:#E1E4E8;">(max_date) </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> max_date,</span></span>
<span class="line"><span style="color:#E1E4E8;">　　　　　　</span><span style="color:#79B8FF;">sum</span><span style="color:#E1E4E8;">(bytes_on_disk) </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> bytes_on_disk,</span></span>
<span class="line"><span style="color:#E1E4E8;">　　　　　　</span><span style="color:#79B8FF;">sum</span><span style="color:#E1E4E8;">(data_uncompressed_bytes) </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> data_uncompressed_bytes,</span></span>
<span class="line"><span style="color:#E1E4E8;">　　　　　　</span><span style="color:#79B8FF;">sum</span><span style="color:#E1E4E8;">(data_compressed_bytes) </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> data_compressed_bytes,</span></span>
<span class="line"><span style="color:#E1E4E8;">　　　　　　(data_compressed_bytes </span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;"> data_uncompressed_bytes) </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">100</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> compress_rate,</span></span>
<span class="line"><span style="color:#E1E4E8;">　　　　　　max_date </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;"> min_date </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">days</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">　　　　　　</span><span style="color:#F97583;">size</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;"> (max_date </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;"> min_date) </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> avgDaySize</span></span>
<span class="line"><span style="color:#E1E4E8;">　　　　</span><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">system</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">parts</span></span>
<span class="line"><span style="color:#E1E4E8;">　　　　</span><span style="color:#F97583;">where</span><span style="color:#E1E4E8;"> active</span></span>
<span class="line"><span style="color:#E1E4E8;">　　　　</span><span style="color:#F97583;">and</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">database</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;system&#39;</span></span>
<span class="line"><span style="color:#E1E4E8;">　　　　</span><span style="color:#F97583;">and</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">\`table\`</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">in</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;query_thread_log&#39;</span><span style="color:#E1E4E8;">,</span><span style="color:#9ECBFF;">&#39;query_log&#39;</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">　　　　</span><span style="color:#F97583;">and</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">\`partition\`</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&#39;202411&#39;</span></span>
<span class="line"><span style="color:#E1E4E8;">　　　　</span><span style="color:#F97583;">group by</span></span>
<span class="line"><span style="color:#E1E4E8;">　　　　　　</span><span style="color:#F97583;">database</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">　　　　　　</span><span style="color:#F97583;">table</span></span>
<span class="line"><span style="color:#E1E4E8;">　　　　</span><span style="color:#F97583;">order by</span><span style="color:#E1E4E8;"> data_compressed_bytes </span><span style="color:#F97583;">desc</span></span>
<span class="line"><span style="color:#E1E4E8;">);</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">select</span></span>
<span class="line"><span style="color:#24292E;">　　</span><span style="color:#D73A49;">database</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">　　</span><span style="color:#D73A49;">table</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">　　formatReadableSize(</span><span style="color:#D73A49;">size</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">size</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">　　formatReadableSize(bytes_on_disk) </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> bytes_on_disk,</span></span>
<span class="line"><span style="color:#24292E;">　　formatReadableSize(data_uncompressed_bytes) </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> data_uncompressed_bytes,</span></span>
<span class="line"><span style="color:#24292E;">　　formatReadableSize(data_compressed_bytes) </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> data_compressed_bytes,</span></span>
<span class="line"><span style="color:#24292E;">　 compress_rate,</span></span>
<span class="line"><span style="color:#24292E;">　　</span><span style="color:#D73A49;">rows</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">　　</span><span style="color:#D73A49;">days</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">　　formatReadableSize(avgDaySize) </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> avgDaySize</span></span>
<span class="line"><span style="color:#D73A49;">from</span></span>
<span class="line"><span style="color:#24292E;">　(</span></span>
<span class="line"><span style="color:#24292E;">　　　</span><span style="color:#D73A49;">select</span></span>
<span class="line"><span style="color:#24292E;">　　　　　　</span><span style="color:#D73A49;">database</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">　　　　　　</span><span style="color:#D73A49;">table</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">　　　　　　</span><span style="color:#005CC5;">sum</span><span style="color:#24292E;">(bytes) </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">size</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">　　　　　　</span><span style="color:#005CC5;">sum</span><span style="color:#24292E;">(</span><span style="color:#D73A49;">rows</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">rows</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">　　　　　　</span><span style="color:#005CC5;">min</span><span style="color:#24292E;">(min_date) </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> min_date,</span></span>
<span class="line"><span style="color:#24292E;">　　　　　　</span><span style="color:#005CC5;">max</span><span style="color:#24292E;">(max_date) </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> max_date,</span></span>
<span class="line"><span style="color:#24292E;">　　　　　　</span><span style="color:#005CC5;">sum</span><span style="color:#24292E;">(bytes_on_disk) </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> bytes_on_disk,</span></span>
<span class="line"><span style="color:#24292E;">　　　　　　</span><span style="color:#005CC5;">sum</span><span style="color:#24292E;">(data_uncompressed_bytes) </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> data_uncompressed_bytes,</span></span>
<span class="line"><span style="color:#24292E;">　　　　　　</span><span style="color:#005CC5;">sum</span><span style="color:#24292E;">(data_compressed_bytes) </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> data_compressed_bytes,</span></span>
<span class="line"><span style="color:#24292E;">　　　　　　(data_compressed_bytes </span><span style="color:#D73A49;">/</span><span style="color:#24292E;"> data_uncompressed_bytes) </span><span style="color:#D73A49;">*</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">100</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> compress_rate,</span></span>
<span class="line"><span style="color:#24292E;">　　　　　　max_date </span><span style="color:#D73A49;">-</span><span style="color:#24292E;"> min_date </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">days</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">　　　　　　</span><span style="color:#D73A49;">size</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">/</span><span style="color:#24292E;"> (max_date </span><span style="color:#D73A49;">-</span><span style="color:#24292E;"> min_date) </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> avgDaySize</span></span>
<span class="line"><span style="color:#24292E;">　　　　</span><span style="color:#D73A49;">from</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">system</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">parts</span></span>
<span class="line"><span style="color:#24292E;">　　　　</span><span style="color:#D73A49;">where</span><span style="color:#24292E;"> active</span></span>
<span class="line"><span style="color:#24292E;">　　　　</span><span style="color:#D73A49;">and</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">database</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;system&#39;</span></span>
<span class="line"><span style="color:#24292E;">　　　　</span><span style="color:#D73A49;">and</span><span style="color:#24292E;"> </span><span style="color:#032F62;">\`table\`</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">in</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;query_thread_log&#39;</span><span style="color:#24292E;">,</span><span style="color:#032F62;">&#39;query_log&#39;</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">　　　　</span><span style="color:#D73A49;">and</span><span style="color:#24292E;"> </span><span style="color:#032F62;">\`partition\`</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&#39;202411&#39;</span></span>
<span class="line"><span style="color:#24292E;">　　　　</span><span style="color:#D73A49;">group by</span></span>
<span class="line"><span style="color:#24292E;">　　　　　　</span><span style="color:#D73A49;">database</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">　　　　　　</span><span style="color:#D73A49;">table</span></span>
<span class="line"><span style="color:#24292E;">　　　　</span><span style="color:#D73A49;">order by</span><span style="color:#24292E;"> data_compressed_bytes </span><span style="color:#D73A49;">desc</span></span>
<span class="line"><span style="color:#24292E;">);</span></span></code></pre></div><blockquote><p>202411,query_thread_log&#39;,&#39;query_log&#39; 注意修改时间</p></blockquote><h3 id="_2-查看所有表" tabindex="-1">2.查看所有表 <a class="header-anchor" href="#_2-查看所有表" aria-label="Permalink to &quot;2.查看所有表&quot;">​</a></h3><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">select</span></span>
<span class="line"><span style="color:#E1E4E8;">　　</span><span style="color:#F97583;">database</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">　　</span><span style="color:#F97583;">table</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">　　formatReadableSize(</span><span style="color:#F97583;">size</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">size</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">　　formatReadableSize(bytes_on_disk) </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> bytes_on_disk,</span></span>
<span class="line"><span style="color:#E1E4E8;">　　formatReadableSize(data_uncompressed_bytes) </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> data_uncompressed_bytes,</span></span>
<span class="line"><span style="color:#E1E4E8;">　　formatReadableSize(data_compressed_bytes) </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> data_compressed_bytes,</span></span>
<span class="line"><span style="color:#E1E4E8;">　 compress_rate,</span></span>
<span class="line"><span style="color:#E1E4E8;">　　</span><span style="color:#F97583;">rows</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">　　</span><span style="color:#F97583;">days</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">　　formatReadableSize(avgDaySize) </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> avgDaySize</span></span>
<span class="line"><span style="color:#F97583;">from</span></span>
<span class="line"><span style="color:#E1E4E8;">　(</span></span>
<span class="line"><span style="color:#E1E4E8;">　　　</span><span style="color:#F97583;">select</span></span>
<span class="line"><span style="color:#E1E4E8;">　　　　　　</span><span style="color:#F97583;">database</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">　　　　　　</span><span style="color:#F97583;">table</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">　　　　　　</span><span style="color:#79B8FF;">sum</span><span style="color:#E1E4E8;">(bytes) </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">size</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">　　　　　　</span><span style="color:#79B8FF;">sum</span><span style="color:#E1E4E8;">(</span><span style="color:#F97583;">rows</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">rows</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">　　　　　　</span><span style="color:#79B8FF;">min</span><span style="color:#E1E4E8;">(min_date) </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> min_date,</span></span>
<span class="line"><span style="color:#E1E4E8;">　　　　　　</span><span style="color:#79B8FF;">max</span><span style="color:#E1E4E8;">(max_date) </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> max_date,</span></span>
<span class="line"><span style="color:#E1E4E8;">　　　　　　</span><span style="color:#79B8FF;">sum</span><span style="color:#E1E4E8;">(bytes_on_disk) </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> bytes_on_disk,</span></span>
<span class="line"><span style="color:#E1E4E8;">　　　　　　</span><span style="color:#79B8FF;">sum</span><span style="color:#E1E4E8;">(data_uncompressed_bytes) </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> data_uncompressed_bytes,</span></span>
<span class="line"><span style="color:#E1E4E8;">　　　　　　</span><span style="color:#79B8FF;">sum</span><span style="color:#E1E4E8;">(data_compressed_bytes) </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> data_compressed_bytes,</span></span>
<span class="line"><span style="color:#E1E4E8;">　　　　　　(data_compressed_bytes </span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;"> data_uncompressed_bytes) </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">100</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> compress_rate,</span></span>
<span class="line"><span style="color:#E1E4E8;">　　　　　　max_date </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;"> min_date </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">days</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">　　　　　　</span><span style="color:#F97583;">size</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;"> (max_date </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;"> min_date) </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> avgDaySize</span></span>
<span class="line"><span style="color:#E1E4E8;">　　　　</span><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">system</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">parts</span></span>
<span class="line"><span style="color:#E1E4E8;">　　　　</span><span style="color:#F97583;">where</span><span style="color:#E1E4E8;"> active</span></span>
<span class="line"><span style="color:#E1E4E8;">　　　　</span><span style="color:#F97583;">group by</span></span>
<span class="line"><span style="color:#E1E4E8;">　　　　　　</span><span style="color:#F97583;">database</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">　　　　　　</span><span style="color:#F97583;">table</span></span>
<span class="line"><span style="color:#E1E4E8;">　　　　</span><span style="color:#F97583;">order by</span><span style="color:#E1E4E8;"> data_compressed_bytes </span><span style="color:#F97583;">desc</span></span>
<span class="line"><span style="color:#E1E4E8;">);</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">select</span></span>
<span class="line"><span style="color:#24292E;">　　</span><span style="color:#D73A49;">database</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">　　</span><span style="color:#D73A49;">table</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">　　formatReadableSize(</span><span style="color:#D73A49;">size</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">size</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">　　formatReadableSize(bytes_on_disk) </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> bytes_on_disk,</span></span>
<span class="line"><span style="color:#24292E;">　　formatReadableSize(data_uncompressed_bytes) </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> data_uncompressed_bytes,</span></span>
<span class="line"><span style="color:#24292E;">　　formatReadableSize(data_compressed_bytes) </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> data_compressed_bytes,</span></span>
<span class="line"><span style="color:#24292E;">　 compress_rate,</span></span>
<span class="line"><span style="color:#24292E;">　　</span><span style="color:#D73A49;">rows</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">　　</span><span style="color:#D73A49;">days</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">　　formatReadableSize(avgDaySize) </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> avgDaySize</span></span>
<span class="line"><span style="color:#D73A49;">from</span></span>
<span class="line"><span style="color:#24292E;">　(</span></span>
<span class="line"><span style="color:#24292E;">　　　</span><span style="color:#D73A49;">select</span></span>
<span class="line"><span style="color:#24292E;">　　　　　　</span><span style="color:#D73A49;">database</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">　　　　　　</span><span style="color:#D73A49;">table</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">　　　　　　</span><span style="color:#005CC5;">sum</span><span style="color:#24292E;">(bytes) </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">size</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">　　　　　　</span><span style="color:#005CC5;">sum</span><span style="color:#24292E;">(</span><span style="color:#D73A49;">rows</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">rows</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">　　　　　　</span><span style="color:#005CC5;">min</span><span style="color:#24292E;">(min_date) </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> min_date,</span></span>
<span class="line"><span style="color:#24292E;">　　　　　　</span><span style="color:#005CC5;">max</span><span style="color:#24292E;">(max_date) </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> max_date,</span></span>
<span class="line"><span style="color:#24292E;">　　　　　　</span><span style="color:#005CC5;">sum</span><span style="color:#24292E;">(bytes_on_disk) </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> bytes_on_disk,</span></span>
<span class="line"><span style="color:#24292E;">　　　　　　</span><span style="color:#005CC5;">sum</span><span style="color:#24292E;">(data_uncompressed_bytes) </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> data_uncompressed_bytes,</span></span>
<span class="line"><span style="color:#24292E;">　　　　　　</span><span style="color:#005CC5;">sum</span><span style="color:#24292E;">(data_compressed_bytes) </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> data_compressed_bytes,</span></span>
<span class="line"><span style="color:#24292E;">　　　　　　(data_compressed_bytes </span><span style="color:#D73A49;">/</span><span style="color:#24292E;"> data_uncompressed_bytes) </span><span style="color:#D73A49;">*</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">100</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> compress_rate,</span></span>
<span class="line"><span style="color:#24292E;">　　　　　　max_date </span><span style="color:#D73A49;">-</span><span style="color:#24292E;"> min_date </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">days</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">　　　　　　</span><span style="color:#D73A49;">size</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">/</span><span style="color:#24292E;"> (max_date </span><span style="color:#D73A49;">-</span><span style="color:#24292E;"> min_date) </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> avgDaySize</span></span>
<span class="line"><span style="color:#24292E;">　　　　</span><span style="color:#D73A49;">from</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">system</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">parts</span></span>
<span class="line"><span style="color:#24292E;">　　　　</span><span style="color:#D73A49;">where</span><span style="color:#24292E;"> active</span></span>
<span class="line"><span style="color:#24292E;">　　　　</span><span style="color:#D73A49;">group by</span></span>
<span class="line"><span style="color:#24292E;">　　　　　　</span><span style="color:#D73A49;">database</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">　　　　　　</span><span style="color:#D73A49;">table</span></span>
<span class="line"><span style="color:#24292E;">　　　　</span><span style="color:#D73A49;">order by</span><span style="color:#24292E;"> data_compressed_bytes </span><span style="color:#D73A49;">desc</span></span>
<span class="line"><span style="color:#24292E;">);</span></span></code></pre></div><h2 id="_4-查询当前所在库" tabindex="-1">4.查询当前所在库 <a class="header-anchor" href="#_4-查询当前所在库" aria-label="Permalink to &quot;4.查询当前所在库&quot;">​</a></h2><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">select</span><span style="color:#E1E4E8;"> currentDatabase() FORMAT TabSeparatedWithNamesAndTypes</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">select</span><span style="color:#24292E;"> currentDatabase() FORMAT TabSeparatedWithNamesAndTypes</span></span></code></pre></div>`,18),e=[o];function t(c,r,y,E,i,d){return a(),n("div",null,e)}const m=s(p,[["render",t]]);export{F as __pageData,m as default};
