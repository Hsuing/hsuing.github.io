import{_ as s,o as a,c as n,R as l}from"./chunks/framework.zUbWieqp.js";const _=JSON.parse('{"title":"1.现象","description":"","frontmatter":{},"headers":[],"relativePath":"guide/Database/pgSql/faq/6-序列问题.md","filePath":"guide/Database/pgSql/faq/6-序列问题.md","lastUpdated":1734344767000}'),p={name:"guide/Database/pgSql/faq/6-序列问题.md"},o=l(`<h1 id="_1-现象" tabindex="-1">1.现象 <a class="header-anchor" href="#_1-现象" aria-label="Permalink to &quot;1.现象&quot;">​</a></h1><p>从测试数据库导出<code>单表</code>，往正式里面导入，出现了插入数据的时候不会id不会自增(默认是自动增长)</p><h2 id="_1-1-查看数据库seq" tabindex="-1">1.1 查看数据库seq <a class="header-anchor" href="#_1-1-查看数据库seq" aria-label="Permalink to &quot;1.1 查看数据库seq&quot;">​</a></h2><h3 id="_1-当前数据库" tabindex="-1">1.当前数据库 <a class="header-anchor" href="#_1-当前数据库" aria-label="Permalink to &quot;1.当前数据库&quot;">​</a></h3><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">SELECT</span><span style="color:#E1E4E8;"> sequence_name</span></span>
<span class="line"><span style="color:#F97583;">FROM</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">information_schema</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">sequences</span></span>
<span class="line"><span style="color:#F97583;">WHERE</span><span style="color:#E1E4E8;"> sequence_schema </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;public&#39;</span><span style="color:#E1E4E8;">; </span><span style="color:#6A737D;">-- 如果你想查看特定模式下的序列，可以修改这里的模式名，查看是所有</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">SELECT</span><span style="color:#24292E;"> sequence_name</span></span>
<span class="line"><span style="color:#D73A49;">FROM</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">information_schema</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">sequences</span></span>
<span class="line"><span style="color:#D73A49;">WHERE</span><span style="color:#24292E;"> sequence_schema </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;public&#39;</span><span style="color:#24292E;">; </span><span style="color:#6A737D;">-- 如果你想查看特定模式下的序列，可以修改这里的模式名，查看是所有</span></span></code></pre></div><h3 id="_2-根据表名" tabindex="-1">2.根据表名 <a class="header-anchor" href="#_2-根据表名" aria-label="Permalink to &quot;2.根据表名&quot;">​</a></h3><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">SELECT</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">c</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">relname</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">AS</span><span style="color:#E1E4E8;"> sequence_name</span></span>
<span class="line"><span style="color:#F97583;">FROM</span><span style="color:#E1E4E8;"> pg_class c</span></span>
<span class="line"><span style="color:#F97583;">JOIN</span><span style="color:#E1E4E8;"> pg_namespace n </span><span style="color:#F97583;">ON</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">n</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">oid</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">c</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">relnamespace</span></span>
<span class="line"><span style="color:#F97583;">WHERE</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">c</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">relkind</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;S&#39;</span></span>
<span class="line"><span style="color:#F97583;">AND</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">n</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">nspname</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;public&#39;</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;">-- 根据需要修改模式名</span></span>
<span class="line"><span style="color:#F97583;">AND</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">c</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">relname</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">LIKE</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;your_table%&#39;</span><span style="color:#E1E4E8;">;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">SELECT</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">c</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">relname</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">AS</span><span style="color:#24292E;"> sequence_name</span></span>
<span class="line"><span style="color:#D73A49;">FROM</span><span style="color:#24292E;"> pg_class c</span></span>
<span class="line"><span style="color:#D73A49;">JOIN</span><span style="color:#24292E;"> pg_namespace n </span><span style="color:#D73A49;">ON</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">n</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">oid</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">c</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">relnamespace</span></span>
<span class="line"><span style="color:#D73A49;">WHERE</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">c</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">relkind</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;S&#39;</span></span>
<span class="line"><span style="color:#D73A49;">AND</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">n</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">nspname</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;public&#39;</span><span style="color:#24292E;"> </span><span style="color:#6A737D;">-- 根据需要修改模式名</span></span>
<span class="line"><span style="color:#D73A49;">AND</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">c</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">relname</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">LIKE</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;your_table%&#39;</span><span style="color:#24292E;">;</span></span></code></pre></div><h2 id="_1-2-解决方式" tabindex="-1">1.2 解决方式 <a class="header-anchor" href="#_1-2-解决方式" aria-label="Permalink to &quot;1.2 解决方式&quot;">​</a></h2><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">#查看最大id</span></span>
<span class="line"><span style="color:#F97583;">SELECT</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">MAX</span><span style="color:#E1E4E8;">(id) </span><span style="color:#F97583;">FROM</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;document&quot;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">#修改</span></span>
<span class="line"><span style="color:#F97583;">SELECT</span><span style="color:#E1E4E8;"> setval(</span><span style="color:#9ECBFF;">&#39;your_table_id_seq&#39;</span><span style="color:#E1E4E8;">, (</span><span style="color:#F97583;">SELECT</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">MAX</span><span style="color:#E1E4E8;">(id) </span><span style="color:#F97583;">FROM</span><span style="color:#E1E4E8;"> your_table) </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">);</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">#查看最大id</span></span>
<span class="line"><span style="color:#D73A49;">SELECT</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">MAX</span><span style="color:#24292E;">(id) </span><span style="color:#D73A49;">FROM</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;document&quot;</span><span style="color:#24292E;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">#修改</span></span>
<span class="line"><span style="color:#D73A49;">SELECT</span><span style="color:#24292E;"> setval(</span><span style="color:#032F62;">&#39;your_table_id_seq&#39;</span><span style="color:#24292E;">, (</span><span style="color:#D73A49;">SELECT</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">MAX</span><span style="color:#24292E;">(id) </span><span style="color:#D73A49;">FROM</span><span style="color:#24292E;"> your_table) </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1</span><span style="color:#24292E;">);</span></span></code></pre></div>`,9),e=[o];function c(t,r,E,y,i,d){return a(),n("div",null,e)}const C=s(p,[["render",c]]);export{_ as __pageData,C as default};
