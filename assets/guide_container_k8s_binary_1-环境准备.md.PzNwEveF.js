import{_ as s,o as n,c as a,R as l}from"./chunks/framework.zUbWieqp.js";const C=JSON.parse('{"title":"1. 系统","description":"","frontmatter":{},"headers":[],"relativePath":"guide/container/k8s/binary/1-环境准备.md","filePath":"guide/container/k8s/binary/1-环境准备.md","lastUpdated":1730196597000}'),p={name:"guide/container/k8s/binary/1-环境准备.md"},o=l(`<h1 id="_1-系统" tabindex="-1">1. 系统 <a class="header-anchor" href="#_1-系统" aria-label="Permalink to &quot;1. 系统&quot;">​</a></h1><p>rocklinux9.4</p><p>vmware17.0</p><div class="danger custom-block"><p class="custom-block-title">❌ 注意</p><p>所有节点进行操作</p></div><h2 id="_1-1-下载" tabindex="-1">1.1 下载 <a class="header-anchor" href="#_1-1-下载" aria-label="Permalink to &quot;1.1 下载&quot;">​</a></h2><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;"># 官方下载地址</span></span>
<span class="line"><span style="color:#B392F0;">https://rockylinux.org/download</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;"># 官方下载地址</span></span>
<span class="line"><span style="color:#6F42C1;">https://rockylinux.org/download</span></span></code></pre></div><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;"># 阿里云镜像下载地址</span></span>
<span class="line"><span style="color:#B392F0;">https://mirrors.aliyun.com/rockylinux/9/isos/x86_64</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;"># 阿里云镜像下载地址</span></span>
<span class="line"><span style="color:#6F42C1;">https://mirrors.aliyun.com/rockylinux/9/isos/x86_64</span></span></code></pre></div><h2 id="_1-2-配置网卡vm" tabindex="-1">1.2 配置网卡vm <a class="header-anchor" href="#_1-2-配置网卡vm" aria-label="Permalink to &quot;1.2 配置网卡vm&quot;">​</a></h2><ol><li>弃用Centos7改用Rocky Linux9。</li><li>修改IP的方式有不同，不再是修改<code>/etc/sysconfig/network-scripts/</code>之下的脚本，系统也没有名叫<code>network</code>(systemd-networkd)的服务。</li><li>系统通过NetworkManger和网络connetions来管理网卡和IP</li></ol><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">[root@localhost system-connections]# cat /etc/NetworkManager/system-connections/ens160.nmconnection</span></span>
<span class="line"><span style="color:#E1E4E8;">[connection]</span></span>
<span class="line"><span style="color:#E1E4E8;">id</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">ens160</span></span>
<span class="line"><span style="color:#E1E4E8;">uuid</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">f22e14b7-30bf-32fe-af7f-cf378a65062c</span></span>
<span class="line"><span style="color:#E1E4E8;">type</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">ethernet</span></span>
<span class="line"><span style="color:#E1E4E8;">autoconnect-priority</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">-999</span></span>
<span class="line"><span style="color:#E1E4E8;">interface-name</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">ens160</span></span>
<span class="line"><span style="color:#E1E4E8;">timestamp</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">1723996239</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">[ethernet]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">[ipv4]</span></span>
<span class="line"><span style="color:#E1E4E8;">method</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">manual</span></span>
<span class="line"><span style="color:#E1E4E8;">address1</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">10.103</span><span style="color:#9ECBFF;">.236.150/24,10.103.236.2</span></span>
<span class="line"><span style="color:#E1E4E8;">dns</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">114.114</span><span style="color:#9ECBFF;">.114.114</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">[ipv6]</span></span>
<span class="line"><span style="color:#E1E4E8;">addr-gen-mode</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">eui64</span></span>
<span class="line"><span style="color:#E1E4E8;">method</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">auto</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">[proxy]</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">[root@localhost system-connections]# cat /etc/NetworkManager/system-connections/ens160.nmconnection</span></span>
<span class="line"><span style="color:#24292E;">[connection]</span></span>
<span class="line"><span style="color:#24292E;">id</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">ens160</span></span>
<span class="line"><span style="color:#24292E;">uuid</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">f22e14b7-30bf-32fe-af7f-cf378a65062c</span></span>
<span class="line"><span style="color:#24292E;">type</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">ethernet</span></span>
<span class="line"><span style="color:#24292E;">autoconnect-priority</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">-999</span></span>
<span class="line"><span style="color:#24292E;">interface-name</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">ens160</span></span>
<span class="line"><span style="color:#24292E;">timestamp</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">1723996239</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">[ethernet]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">[ipv4]</span></span>
<span class="line"><span style="color:#24292E;">method</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">manual</span></span>
<span class="line"><span style="color:#24292E;">address1</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">10.103</span><span style="color:#032F62;">.236.150/24,10.103.236.2</span></span>
<span class="line"><span style="color:#24292E;">dns</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">114.114</span><span style="color:#032F62;">.114.114</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">[ipv6]</span></span>
<span class="line"><span style="color:#24292E;">addr-gen-mode</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">eui64</span></span>
<span class="line"><span style="color:#24292E;">method</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">auto</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">[proxy]</span></span></code></pre></div><blockquote><p>只修改ip4区域</p><p>10.103.236.2网关地址</p></blockquote><h3 id="_1-2-1-重启网卡" tabindex="-1">1.2.1 重启网卡 <a class="header-anchor" href="#_1-2-1-重启网卡" aria-label="Permalink to &quot;1.2.1 重启网卡&quot;">​</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">service</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">NetworkManager</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">restart</span><span style="color:#E1E4E8;">	</span><span style="color:#6A737D;">#IP配置不生效</span></span>
<span class="line"><span style="color:#B392F0;">nmcli</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">connection</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">reload</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">ens160</span><span style="color:#E1E4E8;">	</span><span style="color:#6A737D;">#IP配置不生效</span></span>
<span class="line"><span style="color:#B392F0;">nmcli</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">connection</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">down</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">ens160</span><span style="color:#E1E4E8;">	</span><span style="color:#6A737D;">#先断开网卡，再次连接网卡，IP配置生效。</span></span>
<span class="line"><span style="color:#B392F0;">nmcli</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">device</span></span>
<span class="line"><span style="color:#B392F0;">nmcli</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">connection</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">up</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">ens160</span><span style="color:#E1E4E8;">		</span><span style="color:#6A737D;">#先断开网卡，再次连接网卡，IP配置生效。</span></span>
<span class="line"><span style="color:#B392F0;">nmcli</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">device</span></span>
<span class="line"><span style="color:#B392F0;">ifconfig</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">service</span><span style="color:#24292E;"> </span><span style="color:#032F62;">NetworkManager</span><span style="color:#24292E;"> </span><span style="color:#032F62;">restart</span><span style="color:#24292E;">	</span><span style="color:#6A737D;">#IP配置不生效</span></span>
<span class="line"><span style="color:#6F42C1;">nmcli</span><span style="color:#24292E;"> </span><span style="color:#032F62;">connection</span><span style="color:#24292E;"> </span><span style="color:#032F62;">reload</span><span style="color:#24292E;"> </span><span style="color:#032F62;">ens160</span><span style="color:#24292E;">	</span><span style="color:#6A737D;">#IP配置不生效</span></span>
<span class="line"><span style="color:#6F42C1;">nmcli</span><span style="color:#24292E;"> </span><span style="color:#032F62;">connection</span><span style="color:#24292E;"> </span><span style="color:#032F62;">down</span><span style="color:#24292E;"> </span><span style="color:#032F62;">ens160</span><span style="color:#24292E;">	</span><span style="color:#6A737D;">#先断开网卡，再次连接网卡，IP配置生效。</span></span>
<span class="line"><span style="color:#6F42C1;">nmcli</span><span style="color:#24292E;"> </span><span style="color:#032F62;">device</span></span>
<span class="line"><span style="color:#6F42C1;">nmcli</span><span style="color:#24292E;"> </span><span style="color:#032F62;">connection</span><span style="color:#24292E;"> </span><span style="color:#032F62;">up</span><span style="color:#24292E;"> </span><span style="color:#032F62;">ens160</span><span style="color:#24292E;">		</span><span style="color:#6A737D;">#先断开网卡，再次连接网卡，IP配置生效。</span></span>
<span class="line"><span style="color:#6F42C1;">nmcli</span><span style="color:#24292E;"> </span><span style="color:#032F62;">device</span></span>
<span class="line"><span style="color:#6F42C1;">ifconfig</span></span></code></pre></div><h2 id="_1-3-配置yum源" tabindex="-1">1.3 配置yum源 <a class="header-anchor" href="#_1-3-配置yum源" aria-label="Permalink to &quot;1.3 配置yum源&quot;">​</a></h2><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;"># Rocky 系统软件源更换成阿里云</span></span>
<span class="line"><span style="color:#B392F0;">sed</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-e</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;s|^mirrorlist=|#mirrorlist=|g&#39;</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#79B8FF;">-e</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;s|^#baseurl=http://dl.rockylinux.org/$contentdir|baseurl=https://mirrors.aliyun.com/rockylinux|g&#39;</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#79B8FF;">-i.bak</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">/etc/yum.repos.d/[Rr]ocky</span><span style="color:#79B8FF;">*</span><span style="color:#9ECBFF;">.repo</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#刷新</span></span>
<span class="line"><span style="color:#B392F0;">dnf</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">makecache</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;"># Rocky 系统软件源更换成阿里云</span></span>
<span class="line"><span style="color:#6F42C1;">sed</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-e</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;s|^mirrorlist=|#mirrorlist=|g&#39;</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#005CC5;">-e</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;s|^#baseurl=http://dl.rockylinux.org/$contentdir|baseurl=https://mirrors.aliyun.com/rockylinux|g&#39;</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#005CC5;">-i.bak</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#032F62;">/etc/yum.repos.d/[Rr]ocky</span><span style="color:#005CC5;">*</span><span style="color:#032F62;">.repo</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#刷新</span></span>
<span class="line"><span style="color:#6F42C1;">dnf</span><span style="color:#24292E;"> </span><span style="color:#032F62;">makecache</span></span></code></pre></div><h2 id="_1-4-关闭防火墙" tabindex="-1">1.4 关闭防火墙 <a class="header-anchor" href="#_1-4-关闭防火墙" aria-label="Permalink to &quot;1.4 关闭防火墙&quot;">​</a></h2><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;"># 防火墙修改 firewalld 为 iptables</span></span>
<span class="line"><span style="color:#B392F0;">systemctl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">stop</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">firewalld</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">systemctl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">disable</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">firewalld</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">yum</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-y</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">install</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">iptables-services</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">systemctl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">start</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">iptables</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">iptables</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-F</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">systemctl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">enable</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">iptables</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;"># 防火墙修改 firewalld 为 iptables</span></span>
<span class="line"><span style="color:#6F42C1;">systemctl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">stop</span><span style="color:#24292E;"> </span><span style="color:#032F62;">firewalld</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">systemctl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">disable</span><span style="color:#24292E;"> </span><span style="color:#032F62;">firewalld</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">yum</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-y</span><span style="color:#24292E;"> </span><span style="color:#032F62;">install</span><span style="color:#24292E;"> </span><span style="color:#032F62;">iptables-services</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">systemctl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">start</span><span style="color:#24292E;"> </span><span style="color:#032F62;">iptables</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">iptables</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-F</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">systemctl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">enable</span><span style="color:#24292E;"> </span><span style="color:#032F62;">iptables</span></span></code></pre></div><h2 id="_1-5-禁用selinux" tabindex="-1">1.5 禁用Selinux <a class="header-anchor" href="#_1-5-禁用selinux" aria-label="Permalink to &quot;1.5 禁用Selinux&quot;">​</a></h2><p>安全增强型 Linux（SELinux）是一个 Linux 内核的功能，它提供支持访问控制的安全政策保护机制</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;"># 禁用 Selinux</span></span>
<span class="line"><span style="color:#B392F0;">setenforce</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0</span></span>
<span class="line"><span style="color:#B392F0;">sed</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-i</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;s/SELINUX=enforcing/SELINUX=disabled/g&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/etc/selinux/config</span></span>
<span class="line"><span style="color:#B392F0;">grubby</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--update-kernel</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">ALL</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--args</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">selinux=</span><span style="color:#79B8FF;">0</span></span>
<span class="line"><span style="color:#6A737D;"># 查看是否禁用，grubby --info DEFAULT</span></span>
<span class="line"><span style="color:#6A737D;"># 回滚内核层禁用操作，grubby --update-kernel ALL --remove-args selinux</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;"># 禁用 Selinux</span></span>
<span class="line"><span style="color:#6F42C1;">setenforce</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0</span></span>
<span class="line"><span style="color:#6F42C1;">sed</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-i</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;s/SELINUX=enforcing/SELINUX=disabled/g&quot;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/etc/selinux/config</span></span>
<span class="line"><span style="color:#6F42C1;">grubby</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--update-kernel</span><span style="color:#24292E;"> </span><span style="color:#032F62;">ALL</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--args</span><span style="color:#24292E;"> </span><span style="color:#032F62;">selinux=</span><span style="color:#005CC5;">0</span></span>
<span class="line"><span style="color:#6A737D;"># 查看是否禁用，grubby --info DEFAULT</span></span>
<span class="line"><span style="color:#6A737D;"># 回滚内核层禁用操作，grubby --update-kernel ALL --remove-args selinux</span></span></code></pre></div><h2 id="_1-6-设置时区" tabindex="-1">1.6 设置时区 <a class="header-anchor" href="#_1-6-设置时区" aria-label="Permalink to &quot;1.6 设置时区&quot;">​</a></h2><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;"># 设置时区</span></span>
<span class="line"><span style="color:#B392F0;">timedatectl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">set-timezone</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Asia/Shanghai</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;"># 设置时区</span></span>
<span class="line"><span style="color:#6F42C1;">timedatectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">set-timezone</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Asia/Shanghai</span></span></code></pre></div><h2 id="_1-7-关闭swap" tabindex="-1">1.7 关闭swap <a class="header-anchor" href="#_1-7-关闭swap" aria-label="Permalink to &quot;1.7 关闭swap&quot;">​</a></h2><p>swap 的用途 ?</p><p>swap 分区就是交换分区，(windows 平台叫虚拟内存) 在物理内存不够用时，操作系统会从物理内存中把部分暂时不被使用的数据转移到交换分区，从而为当前运行的程序留出足够的物理内存空间。</p><p>为什么要关闭 swap ?</p><p>swap 启用后，在使用磁盘空间和内存交换数据时，性能表现会较差，会减慢程序执行的速度。</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;"># 关闭 swap 分区</span></span>
<span class="line"><span style="color:#B392F0;">swapoff</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-a</span></span>
<span class="line"><span style="color:#B392F0;">sed</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-i</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;s:/dev/mapper/rl_bogon-swap:#/dev/mapper/rl_bogon-swap:g&#39;</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/etc/fstab</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;"># 关闭 swap 分区</span></span>
<span class="line"><span style="color:#6F42C1;">swapoff</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-a</span></span>
<span class="line"><span style="color:#6F42C1;">sed</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-i</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;s:/dev/mapper/rl_bogon-swap:#/dev/mapper/rl_bogon-swap:g&#39;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/etc/fstab</span></span></code></pre></div><h2 id="_1-8-安装ipvs" tabindex="-1">1.8 安装ipvs <a class="header-anchor" href="#_1-8-安装ipvs" aria-label="Permalink to &quot;1.8 安装ipvs&quot;">​</a></h2><p>IPVS 称之为 IP虚拟服务器（<strong>IP Virtual Server，简写为 IPVS</strong>）。是运行在 LVS 下的提供负载平衡功能的一种技术。</p><p>IPVS 基本上是一种高效的 Layer-4 交换机，它提供负载平衡的功能。</p><p>IPVS 已经加入到了 Linux 内核的主干</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;"># 安装 ipvs</span></span>
<span class="line"><span style="color:#B392F0;">yum</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">install</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-y</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">ipvsadm</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;"># 安装 ipvs</span></span>
<span class="line"><span style="color:#6F42C1;">yum</span><span style="color:#24292E;"> </span><span style="color:#032F62;">install</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-y</span><span style="color:#24292E;"> </span><span style="color:#032F62;">ipvsadm</span></span></code></pre></div><h2 id="_1-9-安装依赖" tabindex="-1">1.9 安装依赖 <a class="header-anchor" href="#_1-9-安装依赖" aria-label="Permalink to &quot;1.9 安装依赖&quot;">​</a></h2><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;"># 安装必备的工具包</span></span>
<span class="line"><span style="color:#B392F0;">yum</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">update</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-y</span><span style="color:#E1E4E8;"> &amp;&amp; </span><span style="color:#B392F0;">yum</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-y</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">install</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">wget</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">psmisc</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">net-tools</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">nfs-utils</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">telnet</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">yum-utils</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">device-mapper-persistent-data</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">lvm2</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">systemd-resolved</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">systemctl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">enable</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">systemd-resolved</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--now</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;"># 安装必备的工具包</span></span>
<span class="line"><span style="color:#6F42C1;">yum</span><span style="color:#24292E;"> </span><span style="color:#032F62;">update</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-y</span><span style="color:#24292E;"> &amp;&amp; </span><span style="color:#6F42C1;">yum</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-y</span><span style="color:#24292E;"> </span><span style="color:#032F62;">install</span><span style="color:#24292E;"> </span><span style="color:#032F62;">wget</span><span style="color:#24292E;"> </span><span style="color:#032F62;">psmisc</span><span style="color:#24292E;"> </span><span style="color:#032F62;">net-tools</span><span style="color:#24292E;"> </span><span style="color:#032F62;">nfs-utils</span><span style="color:#24292E;"> </span><span style="color:#032F62;">telnet</span><span style="color:#24292E;"> </span><span style="color:#032F62;">yum-utils</span><span style="color:#24292E;"> </span><span style="color:#032F62;">device-mapper-persistent-data</span><span style="color:#24292E;"> </span><span style="color:#032F62;">lvm2</span><span style="color:#24292E;"> </span><span style="color:#032F62;">systemd-resolved</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">systemctl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">enable</span><span style="color:#24292E;"> </span><span style="color:#032F62;">systemd-resolved</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--now</span></span></code></pre></div><h2 id="_2-0-排除calico-网卡" tabindex="-1">2.0 排除calico 网卡 <a class="header-anchor" href="#_2-0-排除calico-网卡" aria-label="Permalink to &quot;2.0 排除calico 网卡&quot;">​</a></h2><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;"># 排除 calico 网卡被 NetworkManager 所管理</span></span>
<span class="line"><span style="color:#B392F0;">cat</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/etc/NetworkManager/conf.d/calico.conf</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">&lt;&lt;</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">EOF</span><span style="color:#E1E4E8;"> </span></span>
<span class="line"><span style="color:#9ECBFF;">[keyfile]</span></span>
<span class="line"><span style="color:#9ECBFF;">unmanaged-devices=interface-name:cali*;interface-name:tunl*</span></span>
<span class="line"><span style="color:#9ECBFF;">EOF</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">systemctl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">restart</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">NetworkManager</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;"># 排除 calico 网卡被 NetworkManager 所管理</span></span>
<span class="line"><span style="color:#6F42C1;">cat</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/etc/NetworkManager/conf.d/calico.conf</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&lt;&lt;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">EOF</span><span style="color:#24292E;"> </span></span>
<span class="line"><span style="color:#032F62;">[keyfile]</span></span>
<span class="line"><span style="color:#032F62;">unmanaged-devices=interface-name:cali*;interface-name:tunl*</span></span>
<span class="line"><span style="color:#032F62;">EOF</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">systemctl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">restart</span><span style="color:#24292E;"> </span><span style="color:#032F62;">NetworkManager</span></span></code></pre></div><div class="danger custom-block"><p class="custom-block-title">❌ 注意</p><p>这个参数用于指定不由 NetworkManager 管理的设备。它由以下两个部分组成</p><p>interface-name:cali* 表示以 &quot;cali&quot; 开头的接口名称被排除在 NetworkManager 管理之外。例如，&quot;cali0&quot;, &quot;cali1&quot; 等接口不受 NetworkManager 管理</p><p>interface-name:tunl* 表示以 &quot;tunl&quot; 开头的接口名称被排除在 NetworkManager 管理之外。例如，&quot;tunl0&quot;, &quot;tunl1&quot; 等接口不受 NetworkManager 管理</p><p>通过使用这个参数，可以将特定的接口排除在 NetworkManager 的管理范围之外，以便其他工具或进程可以独立地管理和配置这些接口</p><p>必须配置,必须配置,必须配置,否则有可能出现以下问题</p><p><strong>路由冲突</strong>：</p><ul><li>Calico 使用 BGP（边界网关协议）来管理 Kubernetes 节点之间的网络路由。而 NetworkManager 也管理路由信息，可能会导致路由表中的冲突，特别是在管理 <code>flannel.1</code> 等网络接口时。如果 NetworkManager 试图更改或删除 Calico 的路由设置，可能会导致网络连接中断。</li></ul><p><strong>接口管理冲突</strong>：</p><ul><li>NetworkManager 可能会尝试管理 Calico 创建的虚拟网络接口（如 <code>cali*</code> 接口）。这些接口是由 Calico 用来处理 Pod 网络流量的，如果 NetworkManager 改变这些接口的配置（如 IP 地址或 MTU），可能会导致 Pod 之间无法通信或网络不稳定。</li></ul><p><strong>Firewall 规则干扰</strong>：</p><ul><li>Calico 依赖 <code>iptables</code> 来实现网络策略和防火墙规则。如果 NetworkManager 管理防火墙或使用 <code>firewalld</code> 服务，这可能会覆盖或冲突 Calico 所设置的规则，进而导致网络策略失效或安全问题。</li></ul><p><strong>多路径路由问题</strong>：</p><ul><li>如果 NetworkManager 使用多路径路由或其他高级网络功能，这些可能与 Calico 的 BGP 路由产生冲突，导致不稳定的网络行为或路径选择问题。</li></ul><p>或者禁用NetworkManger,而使用systemd-networkd</p></div><h2 id="_2-1-时间服务器" tabindex="-1">2.1 时间服务器 <a class="header-anchor" href="#_2-1-时间服务器" aria-label="Permalink to &quot;2.1 时间服务器&quot;">​</a></h2><h3 id="_2-1-1-自定义" tabindex="-1">2.1.1 自定义 <a class="header-anchor" href="#_2-1-1-自定义" aria-label="Permalink to &quot;2.1.1 自定义&quot;">​</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;"># 时间同步配置</span></span>
<span class="line"><span style="color:#6A737D;"># 服务端只在一个节点执行</span></span>
<span class="line"><span style="color:#B392F0;">yum</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">install</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">chrony</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-y</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">cat</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/etc/chrony.conf</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">&lt;&lt;</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">EOF</span><span style="color:#E1E4E8;"> </span></span>
<span class="line"><span style="color:#9ECBFF;">pool ntp.aliyun.com iburst</span></span>
<span class="line"><span style="color:#9ECBFF;">driftfile /var/lib/chrony/drift</span></span>
<span class="line"><span style="color:#9ECBFF;">makestep 1.0 3</span></span>
<span class="line"><span style="color:#9ECBFF;">rtcsync</span></span>
<span class="line"><span style="color:#9ECBFF;">allow 10.103.236.0/20</span></span>
<span class="line"><span style="color:#9ECBFF;">local stratum 10</span></span>
<span class="line"><span style="color:#9ECBFF;">keyfile /etc/chrony.keys</span></span>
<span class="line"><span style="color:#9ECBFF;">leapsectz right/UTC</span></span>
<span class="line"><span style="color:#9ECBFF;">logdir /var/log/chrony</span></span>
<span class="line"><span style="color:#9ECBFF;">EOF</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">systemctl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">restart</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">chronyd</span><span style="color:#E1E4E8;"> ; </span><span style="color:#B392F0;">systemctl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">enable</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">chronyd</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 客户端</span></span>
<span class="line"><span style="color:#B392F0;">yum</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">install</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">chrony</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-y</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">cat</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/etc/chrony.conf</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">&lt;&lt;</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">EOF</span><span style="color:#E1E4E8;"> </span></span>
<span class="line"><span style="color:#9ECBFF;">pool 10.103.236.11 iburst</span></span>
<span class="line"><span style="color:#9ECBFF;">pool 10.103.236.12 iburst</span></span>
<span class="line"><span style="color:#9ECBFF;">pool 10.103.236.13 iburst</span></span>
<span class="line"><span style="color:#9ECBFF;">driftfile /var/lib/chrony/drift</span></span>
<span class="line"><span style="color:#9ECBFF;">makestep 1.0 3</span></span>
<span class="line"><span style="color:#9ECBFF;">rtcsync</span></span>
<span class="line"><span style="color:#9ECBFF;">keyfile /etc/chrony.keys</span></span>
<span class="line"><span style="color:#9ECBFF;">leapsectz right/UTC</span></span>
<span class="line"><span style="color:#9ECBFF;">logdir /var/log/chrony</span></span>
<span class="line"><span style="color:#9ECBFF;">EOF</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">systemctl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">restart</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">chronyd</span><span style="color:#E1E4E8;"> ; </span><span style="color:#B392F0;">systemctl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">enable</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">chronyd</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#使用客户端进行验证</span></span>
<span class="line"><span style="color:#B392F0;">chronyc</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">sources</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-v</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;"># 时间同步配置</span></span>
<span class="line"><span style="color:#6A737D;"># 服务端只在一个节点执行</span></span>
<span class="line"><span style="color:#6F42C1;">yum</span><span style="color:#24292E;"> </span><span style="color:#032F62;">install</span><span style="color:#24292E;"> </span><span style="color:#032F62;">chrony</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-y</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">cat</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/etc/chrony.conf</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&lt;&lt;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">EOF</span><span style="color:#24292E;"> </span></span>
<span class="line"><span style="color:#032F62;">pool ntp.aliyun.com iburst</span></span>
<span class="line"><span style="color:#032F62;">driftfile /var/lib/chrony/drift</span></span>
<span class="line"><span style="color:#032F62;">makestep 1.0 3</span></span>
<span class="line"><span style="color:#032F62;">rtcsync</span></span>
<span class="line"><span style="color:#032F62;">allow 10.103.236.0/20</span></span>
<span class="line"><span style="color:#032F62;">local stratum 10</span></span>
<span class="line"><span style="color:#032F62;">keyfile /etc/chrony.keys</span></span>
<span class="line"><span style="color:#032F62;">leapsectz right/UTC</span></span>
<span class="line"><span style="color:#032F62;">logdir /var/log/chrony</span></span>
<span class="line"><span style="color:#032F62;">EOF</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">systemctl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">restart</span><span style="color:#24292E;"> </span><span style="color:#032F62;">chronyd</span><span style="color:#24292E;"> ; </span><span style="color:#6F42C1;">systemctl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">enable</span><span style="color:#24292E;"> </span><span style="color:#032F62;">chronyd</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 客户端</span></span>
<span class="line"><span style="color:#6F42C1;">yum</span><span style="color:#24292E;"> </span><span style="color:#032F62;">install</span><span style="color:#24292E;"> </span><span style="color:#032F62;">chrony</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-y</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">cat</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/etc/chrony.conf</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&lt;&lt;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">EOF</span><span style="color:#24292E;"> </span></span>
<span class="line"><span style="color:#032F62;">pool 10.103.236.11 iburst</span></span>
<span class="line"><span style="color:#032F62;">pool 10.103.236.12 iburst</span></span>
<span class="line"><span style="color:#032F62;">pool 10.103.236.13 iburst</span></span>
<span class="line"><span style="color:#032F62;">driftfile /var/lib/chrony/drift</span></span>
<span class="line"><span style="color:#032F62;">makestep 1.0 3</span></span>
<span class="line"><span style="color:#032F62;">rtcsync</span></span>
<span class="line"><span style="color:#032F62;">keyfile /etc/chrony.keys</span></span>
<span class="line"><span style="color:#032F62;">leapsectz right/UTC</span></span>
<span class="line"><span style="color:#032F62;">logdir /var/log/chrony</span></span>
<span class="line"><span style="color:#032F62;">EOF</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">systemctl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">restart</span><span style="color:#24292E;"> </span><span style="color:#032F62;">chronyd</span><span style="color:#24292E;"> ; </span><span style="color:#6F42C1;">systemctl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">enable</span><span style="color:#24292E;"> </span><span style="color:#032F62;">chronyd</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#使用客户端进行验证</span></span>
<span class="line"><span style="color:#6F42C1;">chronyc</span><span style="color:#24292E;"> </span><span style="color:#032F62;">sources</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-v</span></span></code></pre></div><blockquote><p>allow 根据自己内网ip地址修改</p></blockquote><p>参数介绍</p><table><thead><tr><th>pool ntp.aliyun.com iburst</th><th>指定使用ntp.aliyun.com作为时间服务器池，iburst选项表示在初始同步时会发送多个请求以加快同步速度</th></tr></thead><tbody><tr><td>driftfile /var/lib/chrony/drift</td><td>指定用于保存时钟漂移信息的文件路径</td></tr><tr><td>makestep 1.0 3</td><td>设置当系统时间与服务器时间偏差大于1秒时，会以1秒的步长进行调整。如果偏差超过3秒，则立即进行时间调整</td></tr><tr><td>rtcsync</td><td>启用硬件时钟同步功能，可以提高时钟的准确性</td></tr><tr><td>allow 10.103.236.0/20</td><td>允许10.103.0.0/24网段范围内的主机与chrony进行时间同步</td></tr><tr><td>local stratum 10</td><td>将本地时钟设为stratum 10，stratum值表示时钟的准确度，值越小表示准确度越高</td></tr><tr><td>keyfile /etc/chrony.keys</td><td>指定使用的密钥文件路径，用于对时间同步进行身份验证</td></tr><tr><td>leapsectz right/UTC</td><td>指定时区为UTC</td></tr><tr><td>logdir /var/log/chrony</td><td>指定日志文件存放目录</td></tr></tbody></table><h3 id="_2-1-2-同步公网时间" tabindex="-1">2.1.2 同步公网时间 <a class="header-anchor" href="#_2-1-2-同步公网时间" aria-label="Permalink to &quot;2.1.2 同步公网时间&quot;">​</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">#安装服务</span></span>
<span class="line"><span style="color:#B392F0;">yum</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">install</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">chrony</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-y</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#启动服务</span></span>
<span class="line"><span style="color:#B392F0;">systemctl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">enable</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">chronyd</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--now</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#同步时间</span></span>
<span class="line"><span style="color:#E1E4E8;">[root@kube-master yum.repos.d]# chronyc sources</span></span>
<span class="line"><span style="color:#B392F0;">210</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Number</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">of</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">sources</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">4</span></span>
<span class="line"><span style="color:#B392F0;">MS</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Name/IP</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">address</span><span style="color:#E1E4E8;">         </span><span style="color:#9ECBFF;">Stratum</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Poll</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Reach</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">LastRx</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Last</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">sample</span></span>
<span class="line"><span style="color:#E1E4E8;">===============================================================================</span></span>
<span class="line"><span style="color:#B392F0;">^-</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">tock.ntp.infomaniak.ch</span><span style="color:#E1E4E8;">        </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">10</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">377</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">283</span><span style="color:#E1E4E8;">    </span><span style="color:#79B8FF;">-10ms[  -10ms]</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">+/-</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">87</span><span style="color:#9ECBFF;">ms</span></span>
<span class="line"><span style="color:#B392F0;">^-</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">ntp8.flashdance.cx</span><span style="color:#E1E4E8;">            </span><span style="color:#79B8FF;">2</span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">10</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">377</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">192</span><span style="color:#E1E4E8;">    </span><span style="color:#79B8FF;">-18ms[  -18ms]</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">+/-</span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">154</span><span style="color:#9ECBFF;">ms</span></span>
<span class="line"><span style="color:#B392F0;">^*</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">139.199</span><span style="color:#9ECBFF;">.215.251</span><span style="color:#E1E4E8;">               </span><span style="color:#79B8FF;">2</span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">10</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">377</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">859</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">-902us[ -511us]</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">+/-</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">59</span><span style="color:#9ECBFF;">ms</span></span>
<span class="line"><span style="color:#B392F0;">^-</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">tick.ntp.infomaniak.ch</span><span style="color:#E1E4E8;">        </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">10</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">377</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">27</span><span style="color:#9ECBFF;">m</span><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">+26ms[</span><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">+26ms]</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">+/-</span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">133</span><span style="color:#9ECBFF;">ms</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">#安装服务</span></span>
<span class="line"><span style="color:#6F42C1;">yum</span><span style="color:#24292E;"> </span><span style="color:#032F62;">install</span><span style="color:#24292E;"> </span><span style="color:#032F62;">chrony</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-y</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#启动服务</span></span>
<span class="line"><span style="color:#6F42C1;">systemctl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">enable</span><span style="color:#24292E;"> </span><span style="color:#032F62;">chronyd</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--now</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#同步时间</span></span>
<span class="line"><span style="color:#24292E;">[root@kube-master yum.repos.d]# chronyc sources</span></span>
<span class="line"><span style="color:#6F42C1;">210</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Number</span><span style="color:#24292E;"> </span><span style="color:#032F62;">of</span><span style="color:#24292E;"> </span><span style="color:#032F62;">sources</span><span style="color:#24292E;"> </span><span style="color:#032F62;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">4</span></span>
<span class="line"><span style="color:#6F42C1;">MS</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Name/IP</span><span style="color:#24292E;"> </span><span style="color:#032F62;">address</span><span style="color:#24292E;">         </span><span style="color:#032F62;">Stratum</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Poll</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Reach</span><span style="color:#24292E;"> </span><span style="color:#032F62;">LastRx</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Last</span><span style="color:#24292E;"> </span><span style="color:#032F62;">sample</span></span>
<span class="line"><span style="color:#24292E;">===============================================================================</span></span>
<span class="line"><span style="color:#6F42C1;">^-</span><span style="color:#24292E;"> </span><span style="color:#032F62;">tock.ntp.infomaniak.ch</span><span style="color:#24292E;">        </span><span style="color:#005CC5;">1</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">10</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">377</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">283</span><span style="color:#24292E;">    </span><span style="color:#005CC5;">-10ms[  -10ms]</span><span style="color:#24292E;"> </span><span style="color:#032F62;">+/-</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">87</span><span style="color:#032F62;">ms</span></span>
<span class="line"><span style="color:#6F42C1;">^-</span><span style="color:#24292E;"> </span><span style="color:#032F62;">ntp8.flashdance.cx</span><span style="color:#24292E;">            </span><span style="color:#005CC5;">2</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">10</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">377</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">192</span><span style="color:#24292E;">    </span><span style="color:#005CC5;">-18ms[  -18ms]</span><span style="color:#24292E;"> </span><span style="color:#032F62;">+/-</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">154</span><span style="color:#032F62;">ms</span></span>
<span class="line"><span style="color:#6F42C1;">^*</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">139.199</span><span style="color:#032F62;">.215.251</span><span style="color:#24292E;">               </span><span style="color:#005CC5;">2</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">10</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">377</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">859</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">-902us[ -511us]</span><span style="color:#24292E;"> </span><span style="color:#032F62;">+/-</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">59</span><span style="color:#032F62;">ms</span></span>
<span class="line"><span style="color:#6F42C1;">^-</span><span style="color:#24292E;"> </span><span style="color:#032F62;">tick.ntp.infomaniak.ch</span><span style="color:#24292E;">        </span><span style="color:#005CC5;">1</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">10</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">377</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">27</span><span style="color:#032F62;">m</span><span style="color:#24292E;">    </span><span style="color:#032F62;">+26ms[</span><span style="color:#24292E;">  </span><span style="color:#032F62;">+26ms]</span><span style="color:#24292E;"> </span><span style="color:#032F62;">+/-</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">133</span><span style="color:#032F62;">ms</span></span></code></pre></div><ul><li>或者</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">rpm</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-ivh</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">http://mirrors.wlnmp.com/centos/wlnmp-release-centos.noarch.rpm</span></span>
<span class="line"><span style="color:#B392F0;">yum</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">install</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">ntpdate</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-y</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#操作如下</span></span>
<span class="line"><span style="color:#B392F0;">ln</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-sf</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/usr/share/zoneinfo/Asia/Shanghai</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/etc/localtime</span></span>
<span class="line"><span style="color:#79B8FF;">echo</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;Asia/Shanghai&#39;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">&gt;</span><span style="color:#9ECBFF;">/etc/timezone</span></span>
<span class="line"><span style="color:#B392F0;">ntpdate</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">time2.aliyun.com</span></span>
<span class="line"><span style="color:#6A737D;"># 加入到crontab</span></span>
<span class="line"><span style="color:#F97583;">*</span><span style="color:#E1E4E8;">/5 </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;"> /usr/sbin/ntpdate time2.aliyun.com</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">rpm</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-ivh</span><span style="color:#24292E;"> </span><span style="color:#032F62;">http://mirrors.wlnmp.com/centos/wlnmp-release-centos.noarch.rpm</span></span>
<span class="line"><span style="color:#6F42C1;">yum</span><span style="color:#24292E;"> </span><span style="color:#032F62;">install</span><span style="color:#24292E;"> </span><span style="color:#032F62;">ntpdate</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-y</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#操作如下</span></span>
<span class="line"><span style="color:#6F42C1;">ln</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-sf</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/usr/share/zoneinfo/Asia/Shanghai</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/etc/localtime</span></span>
<span class="line"><span style="color:#005CC5;">echo</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;Asia/Shanghai&#39;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&gt;</span><span style="color:#032F62;">/etc/timezone</span></span>
<span class="line"><span style="color:#6F42C1;">ntpdate</span><span style="color:#24292E;"> </span><span style="color:#032F62;">time2.aliyun.com</span></span>
<span class="line"><span style="color:#6A737D;"># 加入到crontab</span></span>
<span class="line"><span style="color:#D73A49;">*</span><span style="color:#24292E;">/5 </span><span style="color:#D73A49;">*</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">*</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">*</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">*</span><span style="color:#24292E;"> /usr/sbin/ntpdate time2.aliyun.com</span></span></code></pre></div><h2 id="_2-2-配置limit" tabindex="-1">2.2 配置limit <a class="header-anchor" href="#_2-2-配置limit" aria-label="Permalink to &quot;2.2 配置limit&quot;">​</a></h2><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#79B8FF;">ulimit</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-SHn</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">65535</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#添加配置文件</span></span>
<span class="line"><span style="color:#B392F0;">cat</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">&gt;&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/etc/security/limits.conf</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">&lt;&lt;</span><span style="color:#E1E4E8;">&#39;</span><span style="color:#9ECBFF;">EOF</span><span style="color:#E1E4E8;">&#39;</span></span>
<span class="line"><span style="color:#9ECBFF;">* soft nofile 655360</span></span>
<span class="line"><span style="color:#9ECBFF;">* hard nofile 131072</span></span>
<span class="line"><span style="color:#9ECBFF;">* soft nproc 655350</span></span>
<span class="line"><span style="color:#9ECBFF;">* hard nproc 655350</span></span>
<span class="line"><span style="color:#9ECBFF;">* soft memlock unlimited</span></span>
<span class="line"><span style="color:#9ECBFF;">* hard memlock unlimited</span></span>
<span class="line"><span style="color:#9ECBFF;">EOF</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#005CC5;">ulimit</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-SHn</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">65535</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#添加配置文件</span></span>
<span class="line"><span style="color:#6F42C1;">cat</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&gt;&gt;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/etc/security/limits.conf</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&lt;&lt;</span><span style="color:#24292E;">&#39;</span><span style="color:#032F62;">EOF</span><span style="color:#24292E;">&#39;</span></span>
<span class="line"><span style="color:#032F62;">* soft nofile 655360</span></span>
<span class="line"><span style="color:#032F62;">* hard nofile 131072</span></span>
<span class="line"><span style="color:#032F62;">* soft nproc 655350</span></span>
<span class="line"><span style="color:#032F62;">* hard nproc 655350</span></span>
<span class="line"><span style="color:#032F62;">* soft memlock unlimited</span></span>
<span class="line"><span style="color:#032F62;">* hard memlock unlimited</span></span>
<span class="line"><span style="color:#032F62;">EOF</span></span></code></pre></div><blockquote><p>soft nofile 655360 soft表示软限制，nofile表示一个进程可打开的最大文件数，默认值为1024。这里的软限制设置为655360，即一个进程可打开的最大文件数为655360。</p><p>hard nofile 131072 hard表示硬限制，即系统设置的最大值。nofile表示一个进程可打开的最大文件数，默认值为4096。这里的硬限制设置为131072，即系统设置的最大文件数为131072。</p><p>soft nproc 655350 soft表示软限制，nproc表示一个用户可创建的最大进程数，默认值为30720。这里的软限制设置为655350，即一个用户可创建的最大进程数为655350。</p><p>hard nproc 655350 hard表示硬限制，即系统设置的最大值。nproc表示一个用户可创建的最大进程数，默认值为4096。这里的硬限制设置为655350，即系统设置的最大进程数为655350。</p><p>soft memlock unlimited seft表示软限制，memlock表示一个进程可锁定在RAM中的最大内存，默认值为64 KB。这里的软限制设置为unlimited，即一个进程可锁定的最大内存为无限制。</p><p>hard memlock unlimited hard表示硬限制，即系统设置的最大值。memlock表示一个进程可锁定在RAM中的最大内存，默认值为64 KB。这里的硬限制设置为unlimited，即系统设置的最大内存锁定为无限制。</p></blockquote><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">sed</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-i</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;s@#UseDNS yes@UseDNS no@g&#39;</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/etc/ssh/sshd_config</span></span>
<span class="line"><span style="color:#B392F0;">sed</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-i</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;s@^GSSAPIAuthentication yes@GSSAPIAuthentication no@g&#39;</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/etc/ssh/sshd_config</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">	</span><span style="color:#B392F0;">-</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">UseDNS选项:</span></span>
<span class="line"><span style="color:#E1E4E8;">	</span><span style="color:#B392F0;">打开状态下，当客户端试图登录SSH服务器时，服务器端先根据客户端的IP地址进行DNS</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">PTR反向查询出客户端的主机名，然后根据查询出的客户端主机名进行DNS正向A记录查询，验证与其原始IP地址是否一致，这是防止客户端欺骗的一种措施，但一般我们的是动态IP不会有PTR记录，打开这个选项不过是在白白浪费时间而已，不如将其关闭。</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">	</span><span style="color:#B392F0;">-</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">GSSAPIAuthentication:</span></span>
<span class="line"><span style="color:#E1E4E8;">	</span><span style="color:#B392F0;">当这个参数开启（</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">GSSAPIAuthentication</span><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">yes</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">）的时候，通过SSH登陆服务器时候会有些会很慢！这是由于服务器端启用了GSSAPI。登陆的时候客户端需要对服务器端的IP地址进行反解析，如果服务器的IP地址没有配置PTR记录，那么就容易在这里卡住了。</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">sed</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-i</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;s@#UseDNS yes@UseDNS no@g&#39;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/etc/ssh/sshd_config</span></span>
<span class="line"><span style="color:#6F42C1;">sed</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-i</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;s@^GSSAPIAuthentication yes@GSSAPIAuthentication no@g&#39;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/etc/ssh/sshd_config</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">	</span><span style="color:#6F42C1;">-</span><span style="color:#24292E;"> </span><span style="color:#032F62;">UseDNS选项:</span></span>
<span class="line"><span style="color:#24292E;">	</span><span style="color:#6F42C1;">打开状态下，当客户端试图登录SSH服务器时，服务器端先根据客户端的IP地址进行DNS</span><span style="color:#24292E;"> </span><span style="color:#032F62;">PTR反向查询出客户端的主机名，然后根据查询出的客户端主机名进行DNS正向A记录查询，验证与其原始IP地址是否一致，这是防止客户端欺骗的一种措施，但一般我们的是动态IP不会有PTR记录，打开这个选项不过是在白白浪费时间而已，不如将其关闭。</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">	</span><span style="color:#6F42C1;">-</span><span style="color:#24292E;"> </span><span style="color:#032F62;">GSSAPIAuthentication:</span></span>
<span class="line"><span style="color:#24292E;">	</span><span style="color:#6F42C1;">当这个参数开启（</span><span style="color:#24292E;"> </span><span style="color:#032F62;">GSSAPIAuthentication</span><span style="color:#24292E;">  </span><span style="color:#032F62;">yes</span><span style="color:#24292E;"> </span><span style="color:#032F62;">）的时候，通过SSH登陆服务器时候会有些会很慢！这是由于服务器端启用了GSSAPI。登陆的时候客户端需要对服务器端的IP地址进行反解析，如果服务器的IP地址没有配置PTR记录，那么就容易在这里卡住了。</span></span></code></pre></div><ul><li>ssh免密</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">yum</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">install</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-y</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">sshpass</span></span>
<span class="line"><span style="color:#B392F0;">ssh-keygen</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-f</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/root/.ssh/id_rsa</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-P</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;&#39;</span></span>
<span class="line"><span style="color:#F97583;">export</span><span style="color:#E1E4E8;"> IP</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&quot;10.103.236.151 10.103.236.152&quot;</span></span>
<span class="line"><span style="color:#F97583;">export</span><span style="color:#E1E4E8;"> SSHPASS</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">123456</span></span>
<span class="line"><span style="color:#F97583;">for</span><span style="color:#E1E4E8;"> HOST </span><span style="color:#F97583;">in</span><span style="color:#E1E4E8;"> $IP;</span><span style="color:#F97583;">do</span></span>
<span class="line"><span style="color:#E1E4E8;">     </span><span style="color:#B392F0;">sshpass</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-e</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">ssh-copy-id</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-o</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">StrictHostKeyChecking=no</span><span style="color:#E1E4E8;"> $HOST</span></span>
<span class="line"><span style="color:#F97583;">done</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">yum</span><span style="color:#24292E;"> </span><span style="color:#032F62;">install</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-y</span><span style="color:#24292E;"> </span><span style="color:#032F62;">sshpass</span></span>
<span class="line"><span style="color:#6F42C1;">ssh-keygen</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-f</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/root/.ssh/id_rsa</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-P</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;&#39;</span></span>
<span class="line"><span style="color:#D73A49;">export</span><span style="color:#24292E;"> IP</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&quot;10.103.236.151 10.103.236.152&quot;</span></span>
<span class="line"><span style="color:#D73A49;">export</span><span style="color:#24292E;"> SSHPASS</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">123456</span></span>
<span class="line"><span style="color:#D73A49;">for</span><span style="color:#24292E;"> HOST </span><span style="color:#D73A49;">in</span><span style="color:#24292E;"> $IP;</span><span style="color:#D73A49;">do</span></span>
<span class="line"><span style="color:#24292E;">     </span><span style="color:#6F42C1;">sshpass</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-e</span><span style="color:#24292E;"> </span><span style="color:#032F62;">ssh-copy-id</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-o</span><span style="color:#24292E;"> </span><span style="color:#032F62;">StrictHostKeyChecking=no</span><span style="color:#24292E;"> $HOST</span></span>
<span class="line"><span style="color:#D73A49;">done</span></span></code></pre></div><h2 id="_2-3-内核配置" tabindex="-1">2.3 内核配置 <a class="header-anchor" href="#_2-3-内核配置" aria-label="Permalink to &quot;2.3 内核配置&quot;">​</a></h2><h3 id="_2-3-1-内核升级" tabindex="-1">2.3.1 内核升级 <a class="header-anchor" href="#_2-3-1-内核升级" aria-label="Permalink to &quot;2.3.1 内核升级&quot;">​</a></h3><p>CentOS7 需要升级内核至4.18+，本次升级的版本为4.19，<strong>所有节点升级</strong>,,由于从8版本开始默认使用5.x以上版本</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">#下载</span></span>
<span class="line"><span style="color:#B392F0;">wget</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">http://193.49.22.109/elrepo/kernel/el7/x86_64/RPMS/kernel-ml-devel-4.19.12-1.el7.elrepo.x86_64.rpm</span></span>
<span class="line"><span style="color:#B392F0;">wget</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">http://193.49.22.109/elrepo/kernel/el7/x86_64/RPMS/kernel-ml-4.19.12-1.el7.elrepo.x86_64.rpm</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#安装</span></span>
<span class="line"><span style="color:#B392F0;">yum</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">localinstall</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-y</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">kernel-ml</span><span style="color:#79B8FF;">*</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#更改内核启动顺序</span></span>
<span class="line"><span style="color:#B392F0;">grub2-set-default</span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;"> &amp;&amp; </span><span style="color:#B392F0;">grub2-mkconfig</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-o</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/etc/grub2.cfg</span></span>
<span class="line"><span style="color:#B392F0;">grubby</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--args=</span><span style="color:#9ECBFF;">&quot;user_namespace.enable=1&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--update-kernel=</span><span style="color:#9ECBFF;">&quot;$(</span><span style="color:#B392F0;">grubby</span><span style="color:#9ECBFF;"> </span><span style="color:#79B8FF;">--default-kernel</span><span style="color:#9ECBFF;">)&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#查看内核启动版本</span></span>
<span class="line"><span style="color:#E1E4E8;">[root@kube-master yum.repos.d]# grubby --default-kernel</span></span>
<span class="line"><span style="color:#B392F0;">/boot/vmlinuz-4.19.12-1.el7.elrepo.x86_64</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#启动所有节点</span></span>
<span class="line"><span style="color:#B392F0;">reboot</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#查看版本</span></span>
<span class="line"><span style="color:#B392F0;">uname</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-a</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">#下载</span></span>
<span class="line"><span style="color:#6F42C1;">wget</span><span style="color:#24292E;"> </span><span style="color:#032F62;">http://193.49.22.109/elrepo/kernel/el7/x86_64/RPMS/kernel-ml-devel-4.19.12-1.el7.elrepo.x86_64.rpm</span></span>
<span class="line"><span style="color:#6F42C1;">wget</span><span style="color:#24292E;"> </span><span style="color:#032F62;">http://193.49.22.109/elrepo/kernel/el7/x86_64/RPMS/kernel-ml-4.19.12-1.el7.elrepo.x86_64.rpm</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#安装</span></span>
<span class="line"><span style="color:#6F42C1;">yum</span><span style="color:#24292E;"> </span><span style="color:#032F62;">localinstall</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-y</span><span style="color:#24292E;"> </span><span style="color:#032F62;">kernel-ml</span><span style="color:#005CC5;">*</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#更改内核启动顺序</span></span>
<span class="line"><span style="color:#6F42C1;">grub2-set-default</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">0</span><span style="color:#24292E;"> &amp;&amp; </span><span style="color:#6F42C1;">grub2-mkconfig</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-o</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/etc/grub2.cfg</span></span>
<span class="line"><span style="color:#6F42C1;">grubby</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--args=</span><span style="color:#032F62;">&quot;user_namespace.enable=1&quot;</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--update-kernel=</span><span style="color:#032F62;">&quot;$(</span><span style="color:#6F42C1;">grubby</span><span style="color:#032F62;"> </span><span style="color:#005CC5;">--default-kernel</span><span style="color:#032F62;">)&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#查看内核启动版本</span></span>
<span class="line"><span style="color:#24292E;">[root@kube-master yum.repos.d]# grubby --default-kernel</span></span>
<span class="line"><span style="color:#6F42C1;">/boot/vmlinuz-4.19.12-1.el7.elrepo.x86_64</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#启动所有节点</span></span>
<span class="line"><span style="color:#6F42C1;">reboot</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#查看版本</span></span>
<span class="line"><span style="color:#6F42C1;">uname</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-a</span></span></code></pre></div><h3 id="_2-3-2-安装ipvsadm" tabindex="-1">2.3.2 安装ipvsadm <a class="header-anchor" href="#_2-3-2-安装ipvsadm" aria-label="Permalink to &quot;2.3.2 安装ipvsadm&quot;">​</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">yum</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">install</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">ipvsadm</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">ipset</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">sysstat</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">conntrack</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">libseccomp</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-y</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">yum</span><span style="color:#24292E;"> </span><span style="color:#032F62;">install</span><span style="color:#24292E;"> </span><span style="color:#032F62;">ipvsadm</span><span style="color:#24292E;"> </span><span style="color:#032F62;">ipset</span><span style="color:#24292E;"> </span><span style="color:#032F62;">sysstat</span><span style="color:#24292E;"> </span><span style="color:#032F62;">conntrack</span><span style="color:#24292E;"> </span><span style="color:#032F62;">libseccomp</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-y</span></span></code></pre></div><h4 id="配置ipvs模块" tabindex="-1">配置ipvs模块 <a class="header-anchor" href="#配置ipvs模块" aria-label="Permalink to &quot;配置ipvs模块&quot;">​</a></h4><h5 id="第一种方式" tabindex="-1">第一种方式 <a class="header-anchor" href="#第一种方式" aria-label="Permalink to &quot;第一种方式&quot;">​</a></h5><p>在内核4.19+版本nf_conntrack_ipv4已经改为nf_conntrack</p><p>在内核4.18以下使用nf_conntrack_ipv4</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">cat</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/etc/modules-load.d/ipvs.conf</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">&lt;&lt;</span><span style="color:#9ECBFF;">EOF</span></span>
<span class="line"><span style="color:#9ECBFF;"># 加入以下内容</span></span>
<span class="line"><span style="color:#9ECBFF;">ip_vs</span></span>
<span class="line"><span style="color:#9ECBFF;">ip_vs_lc</span></span>
<span class="line"><span style="color:#9ECBFF;">ip_vs_wlc</span></span>
<span class="line"><span style="color:#9ECBFF;">ip_vs_rr</span></span>
<span class="line"><span style="color:#9ECBFF;">ip_vs_wrr</span></span>
<span class="line"><span style="color:#9ECBFF;">ip_vs_lblc</span></span>
<span class="line"><span style="color:#9ECBFF;">ip_vs_lblcr</span></span>
<span class="line"><span style="color:#9ECBFF;">ip_vs_dh</span></span>
<span class="line"><span style="color:#9ECBFF;">ip_vs_sh</span></span>
<span class="line"><span style="color:#9ECBFF;">ip_vs_fo</span></span>
<span class="line"><span style="color:#9ECBFF;">ip_vs_nq</span></span>
<span class="line"><span style="color:#9ECBFF;">ip_vs_sed</span></span>
<span class="line"><span style="color:#9ECBFF;">ip_vs_ftp</span></span>
<span class="line"><span style="color:#9ECBFF;">ip_vs_sh</span></span>
<span class="line"><span style="color:#9ECBFF;">nf_conntrack</span></span>
<span class="line"><span style="color:#9ECBFF;">ip_tables</span></span>
<span class="line"><span style="color:#9ECBFF;">ip_set</span></span>
<span class="line"><span style="color:#9ECBFF;">xt_set</span></span>
<span class="line"><span style="color:#9ECBFF;">ipt_set</span></span>
<span class="line"><span style="color:#9ECBFF;">ipt_rpfilter</span></span>
<span class="line"><span style="color:#9ECBFF;">ipt_REJECT</span></span>
<span class="line"><span style="color:#9ECBFF;">ipip</span></span>
<span class="line"><span style="color:#9ECBFF;">br_netfilter</span></span>
<span class="line"><span style="color:#9ECBFF;">overlay</span></span>
<span class="line"><span style="color:#9ECBFF;">EOF</span></span>
<span class="line"><span style="color:#6A737D;">#启动</span></span>
<span class="line"><span style="color:#B392F0;">systemctl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">enable</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--now</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">systemd-modules-load.service</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">cat</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/etc/modules-load.d/ipvs.conf</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&lt;&lt;</span><span style="color:#032F62;">EOF</span></span>
<span class="line"><span style="color:#032F62;"># 加入以下内容</span></span>
<span class="line"><span style="color:#032F62;">ip_vs</span></span>
<span class="line"><span style="color:#032F62;">ip_vs_lc</span></span>
<span class="line"><span style="color:#032F62;">ip_vs_wlc</span></span>
<span class="line"><span style="color:#032F62;">ip_vs_rr</span></span>
<span class="line"><span style="color:#032F62;">ip_vs_wrr</span></span>
<span class="line"><span style="color:#032F62;">ip_vs_lblc</span></span>
<span class="line"><span style="color:#032F62;">ip_vs_lblcr</span></span>
<span class="line"><span style="color:#032F62;">ip_vs_dh</span></span>
<span class="line"><span style="color:#032F62;">ip_vs_sh</span></span>
<span class="line"><span style="color:#032F62;">ip_vs_fo</span></span>
<span class="line"><span style="color:#032F62;">ip_vs_nq</span></span>
<span class="line"><span style="color:#032F62;">ip_vs_sed</span></span>
<span class="line"><span style="color:#032F62;">ip_vs_ftp</span></span>
<span class="line"><span style="color:#032F62;">ip_vs_sh</span></span>
<span class="line"><span style="color:#032F62;">nf_conntrack</span></span>
<span class="line"><span style="color:#032F62;">ip_tables</span></span>
<span class="line"><span style="color:#032F62;">ip_set</span></span>
<span class="line"><span style="color:#032F62;">xt_set</span></span>
<span class="line"><span style="color:#032F62;">ipt_set</span></span>
<span class="line"><span style="color:#032F62;">ipt_rpfilter</span></span>
<span class="line"><span style="color:#032F62;">ipt_REJECT</span></span>
<span class="line"><span style="color:#032F62;">ipip</span></span>
<span class="line"><span style="color:#032F62;">br_netfilter</span></span>
<span class="line"><span style="color:#032F62;">overlay</span></span>
<span class="line"><span style="color:#032F62;">EOF</span></span>
<span class="line"><span style="color:#6A737D;">#启动</span></span>
<span class="line"><span style="color:#6F42C1;">systemctl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">enable</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--now</span><span style="color:#24292E;"> </span><span style="color:#032F62;">systemd-modules-load.service</span></span></code></pre></div><h5 id="第二种方式" tabindex="-1">第二种方式 <a class="header-anchor" href="#第二种方式" aria-label="Permalink to &quot;第二种方式&quot;">​</a></h5><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">#启动时能自动加载模块</span></span>
<span class="line"><span style="color:#B392F0;">cat</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">&gt;</span><span style="color:#9ECBFF;">/etc/modules-load.d/containerd.conf</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">&lt;&lt;</span><span style="color:#9ECBFF;">EOF</span></span>
<span class="line"><span style="color:#9ECBFF;">#!/bin/bash</span></span>
<span class="line"><span style="color:#9ECBFF;">modprobe -- ip_vs</span></span>
<span class="line"><span style="color:#9ECBFF;">modprobe -- ip_vs_rr</span></span>
<span class="line"><span style="color:#9ECBFF;">modprobe -- ip_vs_wrr</span></span>
<span class="line"><span style="color:#9ECBFF;">modprobe -- ip_vs_sh</span></span>
<span class="line"><span style="color:#9ECBFF;">modprobe -- nf_conntrack</span></span>
<span class="line"><span style="color:#9ECBFF;">modprobe -- overlay</span></span>
<span class="line"><span style="color:#9ECBFF;">modprobe -- br_netfilter</span></span>
<span class="line"><span style="color:#9ECBFF;">EOF</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#授权</span></span>
<span class="line"><span style="color:#B392F0;">chmod</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">755</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/etc/modules-load.d/containerd.conf</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#执行</span></span>
<span class="line"><span style="color:#B392F0;">sh</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/etc/modules-load.d/containerd.conf</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#查看</span></span>
<span class="line"><span style="color:#E1E4E8;">[root@kube-master yum.repos.d]# lsmod </span><span style="color:#F97583;">|</span><span style="color:#B392F0;">grep</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-e</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">ip_vs</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-e</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">nf_conntrack</span></span>
<span class="line"><span style="color:#B392F0;">nf_conntrack_netlink</span><span style="color:#E1E4E8;">    </span><span style="color:#79B8FF;">40960</span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">0</span></span>
<span class="line"><span style="color:#B392F0;">nfnetlink</span><span style="color:#E1E4E8;">              </span><span style="color:#79B8FF;">16384</span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">3</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">nf_conntrack_netlink,ip_set</span></span>
<span class="line"><span style="color:#B392F0;">ip_vs_ftp</span><span style="color:#E1E4E8;">              </span><span style="color:#79B8FF;">16384</span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">0</span></span>
<span class="line"><span style="color:#B392F0;">nf_nat</span><span style="color:#E1E4E8;">                 </span><span style="color:#79B8FF;">32768</span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">2</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">nf_nat_ipv4,ip_vs_ftp</span></span>
<span class="line"><span style="color:#B392F0;">ip_vs_sed</span><span style="color:#E1E4E8;">              </span><span style="color:#79B8FF;">16384</span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">0</span></span>
<span class="line"><span style="color:#B392F0;">ip_vs_nq</span><span style="color:#E1E4E8;">               </span><span style="color:#79B8FF;">16384</span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">0</span></span>
<span class="line"><span style="color:#B392F0;">ip_vs_fo</span><span style="color:#E1E4E8;">               </span><span style="color:#79B8FF;">16384</span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">0</span></span>
<span class="line"><span style="color:#B392F0;">ip_vs_sh</span><span style="color:#E1E4E8;">               </span><span style="color:#79B8FF;">16384</span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">0</span></span>
<span class="line"><span style="color:#B392F0;">ip_vs_dh</span><span style="color:#E1E4E8;">               </span><span style="color:#79B8FF;">16384</span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">0</span></span>
<span class="line"><span style="color:#B392F0;">ip_vs_lblcr</span><span style="color:#E1E4E8;">            </span><span style="color:#79B8FF;">16384</span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">0</span></span>
<span class="line"><span style="color:#B392F0;">ip_vs_lblc</span><span style="color:#E1E4E8;">             </span><span style="color:#79B8FF;">16384</span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">0</span></span>
<span class="line"><span style="color:#B392F0;">ip_vs_wrr</span><span style="color:#E1E4E8;">              </span><span style="color:#79B8FF;">16384</span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">0</span></span>
<span class="line"><span style="color:#B392F0;">ip_vs_rr</span><span style="color:#E1E4E8;">               </span><span style="color:#79B8FF;">16384</span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">0</span></span>
<span class="line"><span style="color:#B392F0;">ip_vs_wlc</span><span style="color:#E1E4E8;">              </span><span style="color:#79B8FF;">16384</span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">0</span></span>
<span class="line"><span style="color:#B392F0;">ip_vs_lc</span><span style="color:#E1E4E8;">               </span><span style="color:#79B8FF;">16384</span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">0</span></span>
<span class="line"><span style="color:#B392F0;">ip_vs</span><span style="color:#E1E4E8;">                 </span><span style="color:#79B8FF;">151552</span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">24</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">ip_vs_wlc,ip_vs_rr,ip_vs_dh,ip_vs_lblcr,ip_vs_sh,ip_vs_fo,ip_vs_nq,ip_vs_lblc,ip_vs_wrr,ip_vs_lc,ip_vs_sed,ip_vs_ftp</span></span>
<span class="line"><span style="color:#B392F0;">nf_conntrack</span><span style="color:#E1E4E8;">          </span><span style="color:#79B8FF;">143360</span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">6</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">xt_conntrack,nf_nat,ipt_MASQUERADE,nf_nat_ipv4,nf_conntrack_netlink,ip_vs</span></span>
<span class="line"><span style="color:#B392F0;">nf_defrag_ipv6</span><span style="color:#E1E4E8;">         </span><span style="color:#79B8FF;">20480</span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">nf_conntrack</span></span>
<span class="line"><span style="color:#B392F0;">nf_defrag_ipv4</span><span style="color:#E1E4E8;">         </span><span style="color:#79B8FF;">16384</span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">nf_conntrack</span></span>
<span class="line"><span style="color:#B392F0;">libcrc32c</span><span style="color:#E1E4E8;">              </span><span style="color:#79B8FF;">16384</span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">4</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">nf_conntrack,nf_nat,xfs,ip_vs</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">#启动时能自动加载模块</span></span>
<span class="line"><span style="color:#6F42C1;">cat</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&gt;</span><span style="color:#032F62;">/etc/modules-load.d/containerd.conf</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&lt;&lt;</span><span style="color:#032F62;">EOF</span></span>
<span class="line"><span style="color:#032F62;">#!/bin/bash</span></span>
<span class="line"><span style="color:#032F62;">modprobe -- ip_vs</span></span>
<span class="line"><span style="color:#032F62;">modprobe -- ip_vs_rr</span></span>
<span class="line"><span style="color:#032F62;">modprobe -- ip_vs_wrr</span></span>
<span class="line"><span style="color:#032F62;">modprobe -- ip_vs_sh</span></span>
<span class="line"><span style="color:#032F62;">modprobe -- nf_conntrack</span></span>
<span class="line"><span style="color:#032F62;">modprobe -- overlay</span></span>
<span class="line"><span style="color:#032F62;">modprobe -- br_netfilter</span></span>
<span class="line"><span style="color:#032F62;">EOF</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#授权</span></span>
<span class="line"><span style="color:#6F42C1;">chmod</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">755</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/etc/modules-load.d/containerd.conf</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#执行</span></span>
<span class="line"><span style="color:#6F42C1;">sh</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/etc/modules-load.d/containerd.conf</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#查看</span></span>
<span class="line"><span style="color:#24292E;">[root@kube-master yum.repos.d]# lsmod </span><span style="color:#D73A49;">|</span><span style="color:#6F42C1;">grep</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-e</span><span style="color:#24292E;"> </span><span style="color:#032F62;">ip_vs</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-e</span><span style="color:#24292E;"> </span><span style="color:#032F62;">nf_conntrack</span></span>
<span class="line"><span style="color:#6F42C1;">nf_conntrack_netlink</span><span style="color:#24292E;">    </span><span style="color:#005CC5;">40960</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">0</span></span>
<span class="line"><span style="color:#6F42C1;">nfnetlink</span><span style="color:#24292E;">              </span><span style="color:#005CC5;">16384</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">3</span><span style="color:#24292E;"> </span><span style="color:#032F62;">nf_conntrack_netlink,ip_set</span></span>
<span class="line"><span style="color:#6F42C1;">ip_vs_ftp</span><span style="color:#24292E;">              </span><span style="color:#005CC5;">16384</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">0</span></span>
<span class="line"><span style="color:#6F42C1;">nf_nat</span><span style="color:#24292E;">                 </span><span style="color:#005CC5;">32768</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">2</span><span style="color:#24292E;"> </span><span style="color:#032F62;">nf_nat_ipv4,ip_vs_ftp</span></span>
<span class="line"><span style="color:#6F42C1;">ip_vs_sed</span><span style="color:#24292E;">              </span><span style="color:#005CC5;">16384</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">0</span></span>
<span class="line"><span style="color:#6F42C1;">ip_vs_nq</span><span style="color:#24292E;">               </span><span style="color:#005CC5;">16384</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">0</span></span>
<span class="line"><span style="color:#6F42C1;">ip_vs_fo</span><span style="color:#24292E;">               </span><span style="color:#005CC5;">16384</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">0</span></span>
<span class="line"><span style="color:#6F42C1;">ip_vs_sh</span><span style="color:#24292E;">               </span><span style="color:#005CC5;">16384</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">0</span></span>
<span class="line"><span style="color:#6F42C1;">ip_vs_dh</span><span style="color:#24292E;">               </span><span style="color:#005CC5;">16384</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">0</span></span>
<span class="line"><span style="color:#6F42C1;">ip_vs_lblcr</span><span style="color:#24292E;">            </span><span style="color:#005CC5;">16384</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">0</span></span>
<span class="line"><span style="color:#6F42C1;">ip_vs_lblc</span><span style="color:#24292E;">             </span><span style="color:#005CC5;">16384</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">0</span></span>
<span class="line"><span style="color:#6F42C1;">ip_vs_wrr</span><span style="color:#24292E;">              </span><span style="color:#005CC5;">16384</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">0</span></span>
<span class="line"><span style="color:#6F42C1;">ip_vs_rr</span><span style="color:#24292E;">               </span><span style="color:#005CC5;">16384</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">0</span></span>
<span class="line"><span style="color:#6F42C1;">ip_vs_wlc</span><span style="color:#24292E;">              </span><span style="color:#005CC5;">16384</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">0</span></span>
<span class="line"><span style="color:#6F42C1;">ip_vs_lc</span><span style="color:#24292E;">               </span><span style="color:#005CC5;">16384</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">0</span></span>
<span class="line"><span style="color:#6F42C1;">ip_vs</span><span style="color:#24292E;">                 </span><span style="color:#005CC5;">151552</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">24</span><span style="color:#24292E;"> </span><span style="color:#032F62;">ip_vs_wlc,ip_vs_rr,ip_vs_dh,ip_vs_lblcr,ip_vs_sh,ip_vs_fo,ip_vs_nq,ip_vs_lblc,ip_vs_wrr,ip_vs_lc,ip_vs_sed,ip_vs_ftp</span></span>
<span class="line"><span style="color:#6F42C1;">nf_conntrack</span><span style="color:#24292E;">          </span><span style="color:#005CC5;">143360</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">6</span><span style="color:#24292E;"> </span><span style="color:#032F62;">xt_conntrack,nf_nat,ipt_MASQUERADE,nf_nat_ipv4,nf_conntrack_netlink,ip_vs</span></span>
<span class="line"><span style="color:#6F42C1;">nf_defrag_ipv6</span><span style="color:#24292E;">         </span><span style="color:#005CC5;">20480</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">nf_conntrack</span></span>
<span class="line"><span style="color:#6F42C1;">nf_defrag_ipv4</span><span style="color:#24292E;">         </span><span style="color:#005CC5;">16384</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">nf_conntrack</span></span>
<span class="line"><span style="color:#6F42C1;">libcrc32c</span><span style="color:#24292E;">              </span><span style="color:#005CC5;">16384</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">4</span><span style="color:#24292E;"> </span><span style="color:#032F62;">nf_conntrack,nf_nat,xfs,ip_vs</span></span></code></pre></div><h3 id="_2-3-3-配置内核参数" tabindex="-1">2.3.3 配置内核参数 <a class="header-anchor" href="#_2-3-3-配置内核参数" aria-label="Permalink to &quot;2.3.3 配置内核参数&quot;">​</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">cat</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">&lt;&lt;</span><span style="color:#9ECBFF;">EOF</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;"> /etc/sysctl.d/k8s.conf</span></span>
<span class="line"><span style="color:#9ECBFF;">net.ipv4.ip_forward = 1</span></span>
<span class="line"><span style="color:#9ECBFF;">net.bridge.bridge-nf-call-iptables = 1</span></span>
<span class="line"><span style="color:#9ECBFF;">net.bridge.bridge-nf-call-ip6tables = 1</span></span>
<span class="line"><span style="color:#9ECBFF;">fs.may_detach_mounts = 1</span></span>
<span class="line"><span style="color:#9ECBFF;">net.ipv4.conf.all.route_localnet = 1</span></span>
<span class="line"><span style="color:#9ECBFF;">vm.overcommit_memory=1</span></span>
<span class="line"><span style="color:#9ECBFF;">vm.panic_on_oom=0</span></span>
<span class="line"><span style="color:#9ECBFF;">fs.inotify.max_user_watches=89100</span></span>
<span class="line"><span style="color:#9ECBFF;">fs.file-max=52706963</span></span>
<span class="line"><span style="color:#9ECBFF;">fs.nr_open=52706963</span></span>
<span class="line"><span style="color:#9ECBFF;">net.netfilter.nf_conntrack_max=2310720</span></span>
<span class="line"><span style="color:#9ECBFF;">net.ipv4.tcp_keepalive_time = 600</span></span>
<span class="line"><span style="color:#9ECBFF;">net.ipv4.tcp_keepalive_probes = 3</span></span>
<span class="line"><span style="color:#9ECBFF;">net.ipv4.tcp_keepalive_intvl =15</span></span>
<span class="line"><span style="color:#9ECBFF;">net.ipv4.tcp_max_tw_buckets = 36000</span></span>
<span class="line"><span style="color:#9ECBFF;">net.ipv4.tcp_tw_reuse = 1</span></span>
<span class="line"><span style="color:#9ECBFF;">net.ipv4.tcp_max_orphans = 327680</span></span>
<span class="line"><span style="color:#9ECBFF;">net.ipv4.tcp_orphan_retries = 3</span></span>
<span class="line"><span style="color:#9ECBFF;">net.ipv4.tcp_syncookies = 1</span></span>
<span class="line"><span style="color:#9ECBFF;">net.ipv4.tcp_max_syn_backlog = 16384</span></span>
<span class="line"><span style="color:#9ECBFF;">net.ipv4.ip_conntrack_max = 65536</span></span>
<span class="line"><span style="color:#9ECBFF;">net.ipv4.tcp_max_syn_backlog = 16384</span></span>
<span class="line"><span style="color:#9ECBFF;">net.ipv4.tcp_timestamps = 0</span></span>
<span class="line"><span style="color:#9ECBFF;">net.core.somaxconn = 16384</span></span>
<span class="line"><span style="color:#9ECBFF;">net.ipv6.conf.all.disable_ipv6 = 0</span></span>
<span class="line"><span style="color:#9ECBFF;">net.ipv6.conf.default.disable_ipv6 = 0</span></span>
<span class="line"><span style="color:#9ECBFF;">net.ipv6.conf.lo.disable_ipv6 = 0</span></span>
<span class="line"><span style="color:#9ECBFF;">net.ipv6.conf.all.forwarding = 1</span></span>
<span class="line"><span style="color:#9ECBFF;">EOF</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">cat</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&lt;&lt;</span><span style="color:#032F62;">EOF</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;"> /etc/sysctl.d/k8s.conf</span></span>
<span class="line"><span style="color:#032F62;">net.ipv4.ip_forward = 1</span></span>
<span class="line"><span style="color:#032F62;">net.bridge.bridge-nf-call-iptables = 1</span></span>
<span class="line"><span style="color:#032F62;">net.bridge.bridge-nf-call-ip6tables = 1</span></span>
<span class="line"><span style="color:#032F62;">fs.may_detach_mounts = 1</span></span>
<span class="line"><span style="color:#032F62;">net.ipv4.conf.all.route_localnet = 1</span></span>
<span class="line"><span style="color:#032F62;">vm.overcommit_memory=1</span></span>
<span class="line"><span style="color:#032F62;">vm.panic_on_oom=0</span></span>
<span class="line"><span style="color:#032F62;">fs.inotify.max_user_watches=89100</span></span>
<span class="line"><span style="color:#032F62;">fs.file-max=52706963</span></span>
<span class="line"><span style="color:#032F62;">fs.nr_open=52706963</span></span>
<span class="line"><span style="color:#032F62;">net.netfilter.nf_conntrack_max=2310720</span></span>
<span class="line"><span style="color:#032F62;">net.ipv4.tcp_keepalive_time = 600</span></span>
<span class="line"><span style="color:#032F62;">net.ipv4.tcp_keepalive_probes = 3</span></span>
<span class="line"><span style="color:#032F62;">net.ipv4.tcp_keepalive_intvl =15</span></span>
<span class="line"><span style="color:#032F62;">net.ipv4.tcp_max_tw_buckets = 36000</span></span>
<span class="line"><span style="color:#032F62;">net.ipv4.tcp_tw_reuse = 1</span></span>
<span class="line"><span style="color:#032F62;">net.ipv4.tcp_max_orphans = 327680</span></span>
<span class="line"><span style="color:#032F62;">net.ipv4.tcp_orphan_retries = 3</span></span>
<span class="line"><span style="color:#032F62;">net.ipv4.tcp_syncookies = 1</span></span>
<span class="line"><span style="color:#032F62;">net.ipv4.tcp_max_syn_backlog = 16384</span></span>
<span class="line"><span style="color:#032F62;">net.ipv4.ip_conntrack_max = 65536</span></span>
<span class="line"><span style="color:#032F62;">net.ipv4.tcp_max_syn_backlog = 16384</span></span>
<span class="line"><span style="color:#032F62;">net.ipv4.tcp_timestamps = 0</span></span>
<span class="line"><span style="color:#032F62;">net.core.somaxconn = 16384</span></span>
<span class="line"><span style="color:#032F62;">net.ipv6.conf.all.disable_ipv6 = 0</span></span>
<span class="line"><span style="color:#032F62;">net.ipv6.conf.default.disable_ipv6 = 0</span></span>
<span class="line"><span style="color:#032F62;">net.ipv6.conf.lo.disable_ipv6 = 0</span></span>
<span class="line"><span style="color:#032F62;">net.ipv6.conf.all.forwarding = 1</span></span>
<span class="line"><span style="color:#032F62;">EOF</span></span></code></pre></div><ul><li>重新加载</li></ul><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">sysctl --system</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">sysctl --system</span></span></code></pre></div><ul><li>重启所有系统，查看模块是否加载好</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">reboot</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">lsmod</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">grep</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--color=auto</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-e</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">ip_vs</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-e</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">nf_conntrack</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">reboot</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">lsmod</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">grep</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--color=auto</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-e</span><span style="color:#24292E;"> </span><span style="color:#032F62;">ip_vs</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-e</span><span style="color:#24292E;"> </span><span style="color:#032F62;">nf_conntrack</span></span></code></pre></div><h2 id="_2-4-systemd-journald" tabindex="-1">2.4 systemd-journald <a class="header-anchor" href="#_2-4-systemd-journald" aria-label="Permalink to &quot;2.4 systemd-journald&quot;">​</a></h2><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">cat</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">&gt;&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/etc/systemd/journald.conf</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">&lt;&lt;</span><span style="color:#9ECBFF;">EOF</span></span>
<span class="line"><span style="color:#9ECBFF;"># 持久化保存到磁盘</span></span>
<span class="line"><span style="color:#9ECBFF;">Storage=persistent</span></span>
<span class="line"><span style="color:#9ECBFF;"># 压缩历史日志</span></span>
<span class="line"><span style="color:#9ECBFF;">Compress=yes</span></span>
<span class="line"><span style="color:#9ECBFF;">SyncIntervalSec=5m</span></span>
<span class="line"><span style="color:#9ECBFF;">RateLimitInterval=30s</span></span>
<span class="line"><span style="color:#9ECBFF;">RateLimitBurst=1000</span></span>
<span class="line"><span style="color:#9ECBFF;"># 最大占用空间 10G</span></span>
<span class="line"><span style="color:#9ECBFF;">SystemMaxUse=1G</span></span>
<span class="line"><span style="color:#9ECBFF;"># 单日志文件最大 200M</span></span>
<span class="line"><span style="color:#9ECBFF;">SystemMaxFileSize=10M</span></span>
<span class="line"><span style="color:#9ECBFF;"># 日志保存时间 2 周</span></span>
<span class="line"><span style="color:#9ECBFF;">MaxRetentionSec=2week</span></span>
<span class="line"><span style="color:#9ECBFF;"># 不将日志转发到 syslog</span></span>
<span class="line"><span style="color:#9ECBFF;">ForwardToSyslog=no</span></span>
<span class="line"><span style="color:#9ECBFF;">EOF</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">cat</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&gt;&gt;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/etc/systemd/journald.conf</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&lt;&lt;</span><span style="color:#032F62;">EOF</span></span>
<span class="line"><span style="color:#032F62;"># 持久化保存到磁盘</span></span>
<span class="line"><span style="color:#032F62;">Storage=persistent</span></span>
<span class="line"><span style="color:#032F62;"># 压缩历史日志</span></span>
<span class="line"><span style="color:#032F62;">Compress=yes</span></span>
<span class="line"><span style="color:#032F62;">SyncIntervalSec=5m</span></span>
<span class="line"><span style="color:#032F62;">RateLimitInterval=30s</span></span>
<span class="line"><span style="color:#032F62;">RateLimitBurst=1000</span></span>
<span class="line"><span style="color:#032F62;"># 最大占用空间 10G</span></span>
<span class="line"><span style="color:#032F62;">SystemMaxUse=1G</span></span>
<span class="line"><span style="color:#032F62;"># 单日志文件最大 200M</span></span>
<span class="line"><span style="color:#032F62;">SystemMaxFileSize=10M</span></span>
<span class="line"><span style="color:#032F62;"># 日志保存时间 2 周</span></span>
<span class="line"><span style="color:#032F62;">MaxRetentionSec=2week</span></span>
<span class="line"><span style="color:#032F62;"># 不将日志转发到 syslog</span></span>
<span class="line"><span style="color:#032F62;">ForwardToSyslog=no</span></span>
<span class="line"><span style="color:#032F62;">EOF</span></span></code></pre></div><ul><li>启动</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">systemctl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">restart</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">systemd-journald</span><span style="color:#E1E4E8;"> &amp;&amp; </span><span style="color:#B392F0;">systemctl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">enable</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">systemd-journald</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">systemctl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">restart</span><span style="color:#24292E;"> </span><span style="color:#032F62;">systemd-journald</span><span style="color:#24292E;"> &amp;&amp; </span><span style="color:#6F42C1;">systemctl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">enable</span><span style="color:#24292E;"> </span><span style="color:#032F62;">systemd-journald</span></span></code></pre></div><h2 id="_2-5-cgroup采用v1-v2" tabindex="-1">2.5 cgroup采用v1,v2 ? <a class="header-anchor" href="#_2-5-cgroup采用v1-v2" aria-label="Permalink to &quot;2.5 cgroup采用v1,v2 ?&quot;">​</a></h2><p><code>systemd.unified_cgroup_hierarchy=0</code>：启用 <strong>cgroupv1</strong>，禁用 <strong>cgroupv2</strong></p><h3 id="_2-5-1-查看当前状态" tabindex="-1">2.5.1 查看当前状态 <a class="header-anchor" href="#_2-5-1-查看当前状态" aria-label="Permalink to &quot;2.5.1 查看当前状态&quot;">​</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">#代表是v2</span></span>
<span class="line"><span style="color:#E1E4E8;">[root@kube-master-01 </span><span style="color:#F97583;">~</span><span style="color:#E1E4E8;">]# mount </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">grep</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">cgroup</span></span>
<span class="line"><span style="color:#B392F0;">cgroup2</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">on</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/sys/fs/cgroup</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">type</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">cgroup2</span><span style="color:#E1E4E8;"> (rw,nosuid,nodev,noexec,relatime,nsdelegate,memory_recursiveprot)</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">#代表是v2</span></span>
<span class="line"><span style="color:#24292E;">[root@kube-master-01 </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# mount </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">grep</span><span style="color:#24292E;"> </span><span style="color:#032F62;">cgroup</span></span>
<span class="line"><span style="color:#6F42C1;">cgroup2</span><span style="color:#24292E;"> </span><span style="color:#032F62;">on</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/sys/fs/cgroup</span><span style="color:#24292E;"> </span><span style="color:#032F62;">type</span><span style="color:#24292E;"> </span><span style="color:#032F62;">cgroup2</span><span style="color:#24292E;"> (rw,nosuid,nodev,noexec,relatime,nsdelegate,memory_recursiveprot)</span></span></code></pre></div><h3 id="_2-5-2-修改v1" tabindex="-1">2.5.2 修改v1 <a class="header-anchor" href="#_2-5-2-修改v1" aria-label="Permalink to &quot;2.5.2 修改v1&quot;">​</a></h3><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">vim /etc/default/grub</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">vim /etc/default/grub</span></span></code></pre></div><p>示例修改前：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">GRUB_CMDLINE_LINUX=&quot;rhgb quiet&quot;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">GRUB_CMDLINE_LINUX=&quot;rhgb quiet&quot;</span></span></code></pre></div><p>示例修改后：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">GRUB_CMDLINE_LINUX=&quot;rhgb quiet systemd.unified_cgroup_hierarchy=0&quot;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">GRUB_CMDLINE_LINUX=&quot;rhgb quiet systemd.unified_cgroup_hierarchy=0&quot;</span></span></code></pre></div><ul><li>更新 GRUB 配置</li></ul><p>对于 BIOS 系统：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">sudo grub2-mkconfig -o /boot/grub2/grub.cfg</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">sudo grub2-mkconfig -o /boot/grub2/grub.cfg</span></span></code></pre></div><p>对于 UEFI 系统：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">sudo grub2-mkconfig -o /boot/efi/EFI/rocklinux/grub.cfg</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">sudo grub2-mkconfig -o /boot/efi/EFI/rocklinux/grub.cfg</span></span></code></pre></div><p>继续修改,</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#79B8FF;">cd</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/boot/loader/entries/</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">vim</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">e3c5308bc67d4a8faf3a4dc0752f7916-5.14.0-427.13.1.el9_4.x86_64.conf</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#在options中添加systemd.unified_cgroup_hierarchy=0</span></span>
<span class="line"><span style="color:#B392F0;">options</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">root=/dev/mapper/rl_bogon-root</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">ro</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">resume=/dev/mapper/rl_bogon-swap</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">rd.lvm.lv=rl_bogon/root</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">rd.lvm.lv=rl_bogon/swap</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">rhgb</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">quiet</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">systemd.unified_cgroup_hierarchy=</span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">selinux=</span><span style="color:#79B8FF;">0</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#005CC5;">cd</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/boot/loader/entries/</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">vim</span><span style="color:#24292E;"> </span><span style="color:#032F62;">e3c5308bc67d4a8faf3a4dc0752f7916-5.14.0-427.13.1.el9_4.x86_64.conf</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#在options中添加systemd.unified_cgroup_hierarchy=0</span></span>
<span class="line"><span style="color:#6F42C1;">options</span><span style="color:#24292E;"> </span><span style="color:#032F62;">root=/dev/mapper/rl_bogon-root</span><span style="color:#24292E;"> </span><span style="color:#032F62;">ro</span><span style="color:#24292E;"> </span><span style="color:#032F62;">resume=/dev/mapper/rl_bogon-swap</span><span style="color:#24292E;"> </span><span style="color:#032F62;">rd.lvm.lv=rl_bogon/root</span><span style="color:#24292E;"> </span><span style="color:#032F62;">rd.lvm.lv=rl_bogon/swap</span><span style="color:#24292E;"> </span><span style="color:#032F62;">rhgb</span><span style="color:#24292E;"> </span><span style="color:#032F62;">quiet</span><span style="color:#24292E;"> </span><span style="color:#032F62;">systemd.unified_cgroup_hierarchy=</span><span style="color:#005CC5;">0</span><span style="color:#24292E;"> </span><span style="color:#032F62;">selinux=</span><span style="color:#005CC5;">0</span></span></code></pre></div><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">#重启系统</span></span>
<span class="line"><span style="color:#e1e4e8;">reboot</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">#重启系统</span></span>
<span class="line"><span style="color:#24292e;">reboot</span></span></code></pre></div><ul><li>验证是否修改成v1,出现下面代表成功</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">[root@kube-node-02 </span><span style="color:#F97583;">~</span><span style="color:#E1E4E8;">]# mount </span><span style="color:#F97583;">|</span><span style="color:#B392F0;">grep</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">cgroup</span></span>
<span class="line"><span style="color:#B392F0;">tmpfs</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">on</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/sys/fs/cgroup</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">type</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">tmpfs</span><span style="color:#E1E4E8;"> (ro,nosuid,nodev,noexec,size=4096k,nr_inodes=1024,mode=755,inode64)</span></span>
<span class="line"><span style="color:#B392F0;">cgroup2</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">on</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/sys/fs/cgroup/unified</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">type</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">cgroup2</span><span style="color:#E1E4E8;"> (rw,nosuid,nodev,noexec,relatime,nsdelegate)</span></span>
<span class="line"><span style="color:#B392F0;">cgroup</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">on</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/sys/fs/cgroup/systemd</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">type</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">cgroup</span><span style="color:#E1E4E8;"> (rw,nosuid,nodev,noexec,relatime,xattr,name=systemd)</span></span>
<span class="line"><span style="color:#B392F0;">cgroup</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">on</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/sys/fs/cgroup/perf_event</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">type</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">cgroup</span><span style="color:#E1E4E8;"> (rw,nosuid,nodev,noexec,relatime,perf_event)</span></span>
<span class="line"><span style="color:#B392F0;">cgroup</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">on</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/sys/fs/cgroup/memory</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">type</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">cgroup</span><span style="color:#E1E4E8;"> (rw,nosuid,nodev,noexec,relatime,memory)</span></span>
<span class="line"><span style="color:#B392F0;">cgroup</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">on</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/sys/fs/cgroup/net_cls,net_prio</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">type</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">cgroup</span><span style="color:#E1E4E8;"> (rw,nosuid,nodev,noexec,relatime,net_cls,net_prio)</span></span>
<span class="line"><span style="color:#B392F0;">cgroup</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">on</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/sys/fs/cgroup/cpuset</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">type</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">cgroup</span><span style="color:#E1E4E8;"> (rw,nosuid,nodev,noexec,relatime,cpuset)</span></span>
<span class="line"><span style="color:#B392F0;">cgroup</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">on</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/sys/fs/cgroup/devices</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">type</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">cgroup</span><span style="color:#E1E4E8;"> (rw,nosuid,nodev,noexec,relatime,devices)</span></span>
<span class="line"><span style="color:#B392F0;">cgroup</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">on</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/sys/fs/cgroup/rdma</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">type</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">cgroup</span><span style="color:#E1E4E8;"> (rw,nosuid,nodev,noexec,relatime,rdma)</span></span>
<span class="line"><span style="color:#B392F0;">cgroup</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">on</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/sys/fs/cgroup/cpu,cpuacct</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">type</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">cgroup</span><span style="color:#E1E4E8;"> (rw,nosuid,nodev,noexec,relatime,cpu,cpuacct)</span></span>
<span class="line"><span style="color:#B392F0;">cgroup</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">on</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/sys/fs/cgroup/misc</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">type</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">cgroup</span><span style="color:#E1E4E8;"> (rw,nosuid,nodev,noexec,relatime,misc)</span></span>
<span class="line"><span style="color:#B392F0;">cgroup</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">on</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/sys/fs/cgroup/freezer</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">type</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">cgroup</span><span style="color:#E1E4E8;"> (rw,nosuid,nodev,noexec,relatime,freezer)</span></span>
<span class="line"><span style="color:#B392F0;">cgroup</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">on</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/sys/fs/cgroup/pids</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">type</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">cgroup</span><span style="color:#E1E4E8;"> (rw,nosuid,nodev,noexec,relatime,pids)</span></span>
<span class="line"><span style="color:#B392F0;">cgroup</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">on</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/sys/fs/cgroup/blkio</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">type</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">cgroup</span><span style="color:#E1E4E8;"> (rw,nosuid,nodev,noexec,relatime,blkio)</span></span>
<span class="line"><span style="color:#B392F0;">cgroup</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">on</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/sys/fs/cgroup/hugetlb</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">type</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">cgroup</span><span style="color:#E1E4E8;"> (rw,nosuid,nodev,noexec,relatime,hugetlb)</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">[root@kube-node-02 </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# mount </span><span style="color:#D73A49;">|</span><span style="color:#6F42C1;">grep</span><span style="color:#24292E;"> </span><span style="color:#032F62;">cgroup</span></span>
<span class="line"><span style="color:#6F42C1;">tmpfs</span><span style="color:#24292E;"> </span><span style="color:#032F62;">on</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/sys/fs/cgroup</span><span style="color:#24292E;"> </span><span style="color:#032F62;">type</span><span style="color:#24292E;"> </span><span style="color:#032F62;">tmpfs</span><span style="color:#24292E;"> (ro,nosuid,nodev,noexec,size=4096k,nr_inodes=1024,mode=755,inode64)</span></span>
<span class="line"><span style="color:#6F42C1;">cgroup2</span><span style="color:#24292E;"> </span><span style="color:#032F62;">on</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/sys/fs/cgroup/unified</span><span style="color:#24292E;"> </span><span style="color:#032F62;">type</span><span style="color:#24292E;"> </span><span style="color:#032F62;">cgroup2</span><span style="color:#24292E;"> (rw,nosuid,nodev,noexec,relatime,nsdelegate)</span></span>
<span class="line"><span style="color:#6F42C1;">cgroup</span><span style="color:#24292E;"> </span><span style="color:#032F62;">on</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/sys/fs/cgroup/systemd</span><span style="color:#24292E;"> </span><span style="color:#032F62;">type</span><span style="color:#24292E;"> </span><span style="color:#032F62;">cgroup</span><span style="color:#24292E;"> (rw,nosuid,nodev,noexec,relatime,xattr,name=systemd)</span></span>
<span class="line"><span style="color:#6F42C1;">cgroup</span><span style="color:#24292E;"> </span><span style="color:#032F62;">on</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/sys/fs/cgroup/perf_event</span><span style="color:#24292E;"> </span><span style="color:#032F62;">type</span><span style="color:#24292E;"> </span><span style="color:#032F62;">cgroup</span><span style="color:#24292E;"> (rw,nosuid,nodev,noexec,relatime,perf_event)</span></span>
<span class="line"><span style="color:#6F42C1;">cgroup</span><span style="color:#24292E;"> </span><span style="color:#032F62;">on</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/sys/fs/cgroup/memory</span><span style="color:#24292E;"> </span><span style="color:#032F62;">type</span><span style="color:#24292E;"> </span><span style="color:#032F62;">cgroup</span><span style="color:#24292E;"> (rw,nosuid,nodev,noexec,relatime,memory)</span></span>
<span class="line"><span style="color:#6F42C1;">cgroup</span><span style="color:#24292E;"> </span><span style="color:#032F62;">on</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/sys/fs/cgroup/net_cls,net_prio</span><span style="color:#24292E;"> </span><span style="color:#032F62;">type</span><span style="color:#24292E;"> </span><span style="color:#032F62;">cgroup</span><span style="color:#24292E;"> (rw,nosuid,nodev,noexec,relatime,net_cls,net_prio)</span></span>
<span class="line"><span style="color:#6F42C1;">cgroup</span><span style="color:#24292E;"> </span><span style="color:#032F62;">on</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/sys/fs/cgroup/cpuset</span><span style="color:#24292E;"> </span><span style="color:#032F62;">type</span><span style="color:#24292E;"> </span><span style="color:#032F62;">cgroup</span><span style="color:#24292E;"> (rw,nosuid,nodev,noexec,relatime,cpuset)</span></span>
<span class="line"><span style="color:#6F42C1;">cgroup</span><span style="color:#24292E;"> </span><span style="color:#032F62;">on</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/sys/fs/cgroup/devices</span><span style="color:#24292E;"> </span><span style="color:#032F62;">type</span><span style="color:#24292E;"> </span><span style="color:#032F62;">cgroup</span><span style="color:#24292E;"> (rw,nosuid,nodev,noexec,relatime,devices)</span></span>
<span class="line"><span style="color:#6F42C1;">cgroup</span><span style="color:#24292E;"> </span><span style="color:#032F62;">on</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/sys/fs/cgroup/rdma</span><span style="color:#24292E;"> </span><span style="color:#032F62;">type</span><span style="color:#24292E;"> </span><span style="color:#032F62;">cgroup</span><span style="color:#24292E;"> (rw,nosuid,nodev,noexec,relatime,rdma)</span></span>
<span class="line"><span style="color:#6F42C1;">cgroup</span><span style="color:#24292E;"> </span><span style="color:#032F62;">on</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/sys/fs/cgroup/cpu,cpuacct</span><span style="color:#24292E;"> </span><span style="color:#032F62;">type</span><span style="color:#24292E;"> </span><span style="color:#032F62;">cgroup</span><span style="color:#24292E;"> (rw,nosuid,nodev,noexec,relatime,cpu,cpuacct)</span></span>
<span class="line"><span style="color:#6F42C1;">cgroup</span><span style="color:#24292E;"> </span><span style="color:#032F62;">on</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/sys/fs/cgroup/misc</span><span style="color:#24292E;"> </span><span style="color:#032F62;">type</span><span style="color:#24292E;"> </span><span style="color:#032F62;">cgroup</span><span style="color:#24292E;"> (rw,nosuid,nodev,noexec,relatime,misc)</span></span>
<span class="line"><span style="color:#6F42C1;">cgroup</span><span style="color:#24292E;"> </span><span style="color:#032F62;">on</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/sys/fs/cgroup/freezer</span><span style="color:#24292E;"> </span><span style="color:#032F62;">type</span><span style="color:#24292E;"> </span><span style="color:#032F62;">cgroup</span><span style="color:#24292E;"> (rw,nosuid,nodev,noexec,relatime,freezer)</span></span>
<span class="line"><span style="color:#6F42C1;">cgroup</span><span style="color:#24292E;"> </span><span style="color:#032F62;">on</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/sys/fs/cgroup/pids</span><span style="color:#24292E;"> </span><span style="color:#032F62;">type</span><span style="color:#24292E;"> </span><span style="color:#032F62;">cgroup</span><span style="color:#24292E;"> (rw,nosuid,nodev,noexec,relatime,pids)</span></span>
<span class="line"><span style="color:#6F42C1;">cgroup</span><span style="color:#24292E;"> </span><span style="color:#032F62;">on</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/sys/fs/cgroup/blkio</span><span style="color:#24292E;"> </span><span style="color:#032F62;">type</span><span style="color:#24292E;"> </span><span style="color:#032F62;">cgroup</span><span style="color:#24292E;"> (rw,nosuid,nodev,noexec,relatime,blkio)</span></span>
<span class="line"><span style="color:#6F42C1;">cgroup</span><span style="color:#24292E;"> </span><span style="color:#032F62;">on</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/sys/fs/cgroup/hugetlb</span><span style="color:#24292E;"> </span><span style="color:#032F62;">type</span><span style="color:#24292E;"> </span><span style="color:#032F62;">cgroup</span><span style="color:#24292E;"> (rw,nosuid,nodev,noexec,relatime,hugetlb)</span></span></code></pre></div><h3 id="_2-5-3-container2-x" tabindex="-1">2.5.3 container2.x <a class="header-anchor" href="#_2-5-3-container2-x" aria-label="Permalink to &quot;2.5.3 container2.x&quot;">​</a></h3><p>containerd2.x 开始支持v2</p>`,99),e=[o];function c(t,r,y,E,i,F){return n(),a("div",null,e)}const u=s(p,[["render",c]]);export{C as __pageData,u as default};
