import{_ as s,o as a,c as n,R as l}from"./chunks/framework.zUbWieqp.js";const d=JSON.parse('{"title":"","description":"","frontmatter":{},"headers":[],"relativePath":"guide/Database/pgSql/faq/2-toast.md","filePath":"guide/Database/pgSql/faq/2-toast.md","lastUpdated":1712022000000}'),p={name:"guide/Database/pgSql/faq/2-toast.md"},o=l(`<h2 id="一、pg-statistic的toast表数据损坏" tabindex="-1">一、pg_statistic的toast表数据损坏 <a class="header-anchor" href="#一、pg-statistic的toast表数据损坏" aria-label="Permalink to &quot;一、pg_statistic的toast表数据损坏&quot;">​</a></h2><h3 id="问题现象" tabindex="-1">问题现象 <a class="header-anchor" href="#问题现象" aria-label="Permalink to &quot;问题现象&quot;">​</a></h3><p>在安装插件的时候使用\\dx元命令的时候，突然发现报了一个错误：</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">postgres</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">#</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">\\dx</span></span>
<span class="line"><span style="color:#B392F0;">ERROR:</span><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">missing</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">chunk</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">number</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">for</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">toast</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">value</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">32789</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">in</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_toast_2619</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">postgres</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">#</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">\\dx</span></span>
<span class="line"><span style="color:#6F42C1;">ERROR:</span><span style="color:#24292E;">  </span><span style="color:#032F62;">missing</span><span style="color:#24292E;"> </span><span style="color:#032F62;">chunk</span><span style="color:#24292E;"> </span><span style="color:#032F62;">number</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0</span><span style="color:#24292E;"> </span><span style="color:#032F62;">for</span><span style="color:#24292E;"> </span><span style="color:#032F62;">toast</span><span style="color:#24292E;"> </span><span style="color:#032F62;">value</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">32789</span><span style="color:#24292E;"> </span><span style="color:#032F62;">in</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_toast_2619</span></span></code></pre></div><p>根据提示来看，主表字段还留存着Toast Pointer，但Toast表中已经没有对应的Chunk条目，怀疑toast表存在损坏或者缺失数据。</p><p>toast表的表名是字符串&quot;pg_toast&quot;与表的oid拼接而成，根据这个pg_toast_2619的2619的oid，可以定位到是pg_statistic的表。</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">postgres</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">#</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">select</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">2619::regclass</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#B392F0;">regclass</span><span style="color:#E1E4E8;">   </span></span>
<span class="line"><span style="color:#B392F0;">--------------</span></span>
<span class="line"><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">pg_statistic</span></span>
<span class="line"><span style="color:#E1E4E8;">(</span><span style="color:#B392F0;">1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">row</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">postgres</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">#</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">select</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">*</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">from</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_statistic</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#B392F0;">ERROR:</span><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">missing</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">chunk</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">number</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">for</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">toast</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">value</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">32789</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">in</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pg_toast_2619</span></span>
<span class="line"><span style="color:#E1E4E8;">postgres</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">#</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">postgres</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">#</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">select</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">2619::regclass</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#6F42C1;">regclass</span><span style="color:#24292E;">   </span></span>
<span class="line"><span style="color:#6F42C1;">--------------</span></span>
<span class="line"><span style="color:#24292E;"> </span><span style="color:#6F42C1;">pg_statistic</span></span>
<span class="line"><span style="color:#24292E;">(</span><span style="color:#6F42C1;">1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">row</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">postgres</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">#</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">select</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">*</span><span style="color:#24292E;"> </span><span style="color:#032F62;">from</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_statistic</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#6F42C1;">ERROR:</span><span style="color:#24292E;">  </span><span style="color:#032F62;">missing</span><span style="color:#24292E;"> </span><span style="color:#032F62;">chunk</span><span style="color:#24292E;"> </span><span style="color:#032F62;">number</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0</span><span style="color:#24292E;"> </span><span style="color:#032F62;">for</span><span style="color:#24292E;"> </span><span style="color:#032F62;">toast</span><span style="color:#24292E;"> </span><span style="color:#032F62;">value</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">32789</span><span style="color:#24292E;"> </span><span style="color:#032F62;">in</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pg_toast_2619</span></span>
<span class="line"><span style="color:#24292E;">postgres</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">#</span></span></code></pre></div><h3 id="问题原因" tabindex="-1">问题原因 <a class="header-anchor" href="#问题原因" aria-label="Permalink to &quot;问题原因&quot;">​</a></h3><p>对应toast表的数据可能存在损坏</p><h3 id="处理方法" tabindex="-1">处理方法 <a class="header-anchor" href="#处理方法" aria-label="Permalink to &quot;处理方法&quot;">​</a></h3><p>需要定位损坏的行的位置，然后可以删除有问题的行。因为pg_statistic的toast数据是更新统计信息的时候插入的，损坏后可以直接清理。vacuum analyze后会重新生成。</p><p>其他系统表损坏比较建议建议zero_damaged_pages设置为on来跳过损坏的块，然后备份业务数据，之后恢复到一个新的环境。</p><p>可以暂时先做下简单的修复，看是否能解决问题，可能执行过程会出现报错：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">postgres=# REINDEX TABLE pg_toast.pg_toast_2619;</span></span>
<span class="line"><span style="color:#e1e4e8;">postgres=# REINDEX TABLE pg_statistic;</span></span>
<span class="line"><span style="color:#e1e4e8;">postgres=# VACUUM ANALYZE pg_statistic;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">postgres=# REINDEX TABLE pg_toast.pg_toast_2619;</span></span>
<span class="line"><span style="color:#24292e;">postgres=# REINDEX TABLE pg_statistic;</span></span>
<span class="line"><span style="color:#24292e;">postgres=# VACUUM ANALYZE pg_statistic;</span></span></code></pre></div><p>使用存储过程</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;"> DO $$</span></span>
<span class="line"><span style="color:#e1e4e8;">DECLARE</span></span>
<span class="line"><span style="color:#e1e4e8;">  rec record;</span></span>
<span class="line"><span style="color:#e1e4e8;">BEGIN</span></span>
<span class="line"><span style="color:#e1e4e8;">FOR rec in SELECT * FROM pg_statistic LOOP</span></span>
<span class="line"><span style="color:#e1e4e8;">  raise notice &#39;Parameter is: %&#39;, rec.ctid;</span></span>
<span class="line"><span style="color:#e1e4e8;">   raise notice &#39;Parameter is: %&#39;, rec;</span></span>
<span class="line"><span style="color:#e1e4e8;">END LOOP; </span></span>
<span class="line"><span style="color:#e1e4e8;">END;</span></span>
<span class="line"><span style="color:#e1e4e8;">$$</span></span>
<span class="line"><span style="color:#e1e4e8;">LANGUAGE plpgsql;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;"> DO $$</span></span>
<span class="line"><span style="color:#24292e;">DECLARE</span></span>
<span class="line"><span style="color:#24292e;">  rec record;</span></span>
<span class="line"><span style="color:#24292e;">BEGIN</span></span>
<span class="line"><span style="color:#24292e;">FOR rec in SELECT * FROM pg_statistic LOOP</span></span>
<span class="line"><span style="color:#24292e;">  raise notice &#39;Parameter is: %&#39;, rec.ctid;</span></span>
<span class="line"><span style="color:#24292e;">   raise notice &#39;Parameter is: %&#39;, rec;</span></span>
<span class="line"><span style="color:#24292e;">END LOOP; </span></span>
<span class="line"><span style="color:#24292e;">END;</span></span>
<span class="line"><span style="color:#24292e;">$$</span></span>
<span class="line"><span style="color:#24292e;">LANGUAGE plpgsql;</span></span></code></pre></div><p>结果如下：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">NOTICE:  Parameter is: (0,1)</span></span>
<span class="line"><span style="color:#e1e4e8;">NOTICE:  Parameter is: (1255,28,f,0.9830149,1294,-0.016985118,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,,,,,,,,,,)</span></span>
<span class="line"><span style="color:#e1e4e8;">NOTICE:  Parameter is: (0,2)</span></span>
<span class="line"><span style="color:#e1e4e8;">NOTICE:  Parameter is: (1255,29,f,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,,,,,,,,,,)</span></span>
<span class="line"><span style="color:#e1e4e8;">NOTICE:  Parameter is: (0,3)</span></span>
<span class="line"><span style="color:#e1e4e8;">NOTICE:  Parameter is: (2606,22,f,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,,,,,,,,,,)</span></span>
<span class="line"><span style="color:#e1e4e8;">NOTICE:  Parameter is: (0,4)</span></span>
<span class="line"><span style="color:#e1e4e8;">NOTICE:  Parameter is: (1260,1,f,0,4,-1,2,3,0,0,0,609,609,0,0,0,0,0,0,0,0,,{0.4365325},,,,&quot;{10,3373,3374,3375,3377,4200,4544,4549,4550,4569,4570,4571,6171,6181,6182,6304,16392,16393}&quot;,,,,)</span></span>
<span class="line"><span style="color:#e1e4e8;">NOTICE:  Parameter is: (0,5)</span></span>
<span class="line"><span style="color:#e1e4e8;">NOTICE:  Parameter is: (1260,2,f,0,64,-1,2,3,0,0,0,660,660,0,0,0,950,950,0,0,0,,{0.104231164},,,,&quot;{pg_checkpoint,pg_create_subscription,pg_database_owner,pg_execute_server_program,pg_maintain,pg_monitor,pg_read_all_data,pg_read_all_settings,pg_read_all_stats,pg_read_server_files,pg_signal_backend,pg_stat_scan_tables,pg_use_reserved_connections,pg_write_all_data,pg_write_server_files,postgres,u1,u2}&quot;,,,,)</span></span>
<span class="line"><span style="color:#e1e4e8;">NOTICE:  Parameter is: (0,6)</span></span>
<span class="line"><span style="color:#e1e4e8;">NOTICE:  Parameter is: (1260,3,f,0,1,-0.11111111,1,3,0,0,0,91,58,0,0,0,0,0,0,0,0,{0.9444444},{0.68421054},,,,{f},,,,)</span></span>
<span class="line"><span style="color:#e1e4e8;">NOTICE:  Parameter is: (0,7)</span></span>
<span class="line"><span style="color:#e1e4e8;">NOTICE:  Parameter is: (1260,4,f,0,1,1,1,3,0,0,0,91,58,0,0,0,0,0,0,0,0,{1},{1},,,,{t},,,,)</span></span>
<span class="line"><span style="color:#e1e4e8;"> </span></span>
<span class="line"><span style="color:#e1e4e8;">... ...</span></span>
<span class="line"><span style="color:#e1e4e8;"> </span></span>
<span class="line"><span style="color:#e1e4e8;">NOTICE:  Parameter is: (16,6)</span></span>
<span class="line"><span style="color:#e1e4e8;">NOTICE:  Parameter is: (2618,7,f,0,5,2,1,3,0,0,0,98,664,0,0,0,950,950,0,0,0,{0.993007},{0.9716709},,,,{&lt;&gt;},,,,)</span></span>
<span class="line"><span style="color:#e1e4e8;">NOTICE:  Parameter is: (16,7)</span></span>
<span class="line"><span style="color:#e1e4e8;">NOTICE:  Parameter is: (2618,8,f,0,589,-1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,,,,,,,,,,)</span></span>
<span class="line"><span style="color:#e1e4e8;">ERROR:  missing chunk number 0 for toast value 32789 in pg_toast_2619</span></span>
<span class="line"><span style="color:#e1e4e8;">CONTEXT:  PL/pgSQL function inline_code_block line 5 at FOR over SELECT rows·</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">NOTICE:  Parameter is: (0,1)</span></span>
<span class="line"><span style="color:#24292e;">NOTICE:  Parameter is: (1255,28,f,0.9830149,1294,-0.016985118,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,,,,,,,,,,)</span></span>
<span class="line"><span style="color:#24292e;">NOTICE:  Parameter is: (0,2)</span></span>
<span class="line"><span style="color:#24292e;">NOTICE:  Parameter is: (1255,29,f,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,,,,,,,,,,)</span></span>
<span class="line"><span style="color:#24292e;">NOTICE:  Parameter is: (0,3)</span></span>
<span class="line"><span style="color:#24292e;">NOTICE:  Parameter is: (2606,22,f,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,,,,,,,,,,)</span></span>
<span class="line"><span style="color:#24292e;">NOTICE:  Parameter is: (0,4)</span></span>
<span class="line"><span style="color:#24292e;">NOTICE:  Parameter is: (1260,1,f,0,4,-1,2,3,0,0,0,609,609,0,0,0,0,0,0,0,0,,{0.4365325},,,,&quot;{10,3373,3374,3375,3377,4200,4544,4549,4550,4569,4570,4571,6171,6181,6182,6304,16392,16393}&quot;,,,,)</span></span>
<span class="line"><span style="color:#24292e;">NOTICE:  Parameter is: (0,5)</span></span>
<span class="line"><span style="color:#24292e;">NOTICE:  Parameter is: (1260,2,f,0,64,-1,2,3,0,0,0,660,660,0,0,0,950,950,0,0,0,,{0.104231164},,,,&quot;{pg_checkpoint,pg_create_subscription,pg_database_owner,pg_execute_server_program,pg_maintain,pg_monitor,pg_read_all_data,pg_read_all_settings,pg_read_all_stats,pg_read_server_files,pg_signal_backend,pg_stat_scan_tables,pg_use_reserved_connections,pg_write_all_data,pg_write_server_files,postgres,u1,u2}&quot;,,,,)</span></span>
<span class="line"><span style="color:#24292e;">NOTICE:  Parameter is: (0,6)</span></span>
<span class="line"><span style="color:#24292e;">NOTICE:  Parameter is: (1260,3,f,0,1,-0.11111111,1,3,0,0,0,91,58,0,0,0,0,0,0,0,0,{0.9444444},{0.68421054},,,,{f},,,,)</span></span>
<span class="line"><span style="color:#24292e;">NOTICE:  Parameter is: (0,7)</span></span>
<span class="line"><span style="color:#24292e;">NOTICE:  Parameter is: (1260,4,f,0,1,1,1,3,0,0,0,91,58,0,0,0,0,0,0,0,0,{1},{1},,,,{t},,,,)</span></span>
<span class="line"><span style="color:#24292e;"> </span></span>
<span class="line"><span style="color:#24292e;">... ...</span></span>
<span class="line"><span style="color:#24292e;"> </span></span>
<span class="line"><span style="color:#24292e;">NOTICE:  Parameter is: (16,6)</span></span>
<span class="line"><span style="color:#24292e;">NOTICE:  Parameter is: (2618,7,f,0,5,2,1,3,0,0,0,98,664,0,0,0,950,950,0,0,0,{0.993007},{0.9716709},,,,{&lt;&gt;},,,,)</span></span>
<span class="line"><span style="color:#24292e;">NOTICE:  Parameter is: (16,7)</span></span>
<span class="line"><span style="color:#24292e;">NOTICE:  Parameter is: (2618,8,f,0,589,-1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,,,,,,,,,,)</span></span>
<span class="line"><span style="color:#24292e;">ERROR:  missing chunk number 0 for toast value 32789 in pg_toast_2619</span></span>
<span class="line"><span style="color:#24292e;">CONTEXT:  PL/pgSQL function inline_code_block line 5 at FOR over SELECT rows·</span></span></code></pre></div><p>最后在ctid=(16,7)的后边停了下来，我们根据查询下发现ctid= &#39;(16,7)&#39;的是正常的数据，接下来的ctid= &#39;(16,8)&#39;是有问题的数据。</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">postgres=# select * from pg_statistic where ctid= &#39;(16,7)&#39;;</span></span>
<span class="line"><span style="color:#e1e4e8;"> starelid | staattnum | stainherit | stanullfrac | stawidth | stadistinct | stakind1 | stakind2 | stakind3 | stakind4 | stakind5 | staop1 | staop2 | sta</span></span>
<span class="line"><span style="color:#e1e4e8;">op3 | staop4 | staop5 | stacoll1 | stacoll2 | stacoll3 | stacoll4 | stacoll5 | stanumbers1 | stanumbers2 | stanumbers3 | stanumbers4 | stanumbers5 | sta</span></span>
<span class="line"><span style="color:#e1e4e8;">values1 | stavalues2 | stavalues3 | stavalues4 | stavalues5 </span></span>
<span class="line"><span style="color:#e1e4e8;">----------+-----------+------------+-------------+----------+-------------+----------+----------+----------+----------+----------+--------+--------+----</span></span>
<span class="line"><span style="color:#e1e4e8;">----+--------+--------+----------+----------+----------+----------+----------+-------------+-------------+-------------+-------------+-------------+----</span></span>
<span class="line"><span style="color:#e1e4e8;">--------+------------+------------+------------+------------</span></span>
<span class="line"><span style="color:#e1e4e8;">     2618 |         8 | f          |           0 |      589 |          -1 |        0 |        0 |        0 |        0 |        0 |      0 |      0 |    </span></span>
<span class="line"><span style="color:#e1e4e8;">  0 |      0 |      0 |        0 |        0 |        0 |        0 |        0 |             |             |             |             |             |    </span></span>
<span class="line"><span style="color:#e1e4e8;">        |            |            |            | </span></span>
<span class="line"><span style="color:#e1e4e8;">(1 row)</span></span>
<span class="line"><span style="color:#e1e4e8;"> </span></span>
<span class="line"><span style="color:#e1e4e8;">postgres=# select * from pg_statistic where ctid= &#39;(16,8)&#39;;</span></span>
<span class="line"><span style="color:#e1e4e8;">ERROR:  missing chunk number 0 for toast value 32789 in pg_toast_2619</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">postgres=# select * from pg_statistic where ctid= &#39;(16,7)&#39;;</span></span>
<span class="line"><span style="color:#24292e;"> starelid | staattnum | stainherit | stanullfrac | stawidth | stadistinct | stakind1 | stakind2 | stakind3 | stakind4 | stakind5 | staop1 | staop2 | sta</span></span>
<span class="line"><span style="color:#24292e;">op3 | staop4 | staop5 | stacoll1 | stacoll2 | stacoll3 | stacoll4 | stacoll5 | stanumbers1 | stanumbers2 | stanumbers3 | stanumbers4 | stanumbers5 | sta</span></span>
<span class="line"><span style="color:#24292e;">values1 | stavalues2 | stavalues3 | stavalues4 | stavalues5 </span></span>
<span class="line"><span style="color:#24292e;">----------+-----------+------------+-------------+----------+-------------+----------+----------+----------+----------+----------+--------+--------+----</span></span>
<span class="line"><span style="color:#24292e;">----+--------+--------+----------+----------+----------+----------+----------+-------------+-------------+-------------+-------------+-------------+----</span></span>
<span class="line"><span style="color:#24292e;">--------+------------+------------+------------+------------</span></span>
<span class="line"><span style="color:#24292e;">     2618 |         8 | f          |           0 |      589 |          -1 |        0 |        0 |        0 |        0 |        0 |      0 |      0 |    </span></span>
<span class="line"><span style="color:#24292e;">  0 |      0 |      0 |        0 |        0 |        0 |        0 |        0 |             |             |             |             |             |    </span></span>
<span class="line"><span style="color:#24292e;">        |            |            |            | </span></span>
<span class="line"><span style="color:#24292e;">(1 row)</span></span>
<span class="line"><span style="color:#24292e;"> </span></span>
<span class="line"><span style="color:#24292e;">postgres=# select * from pg_statistic where ctid= &#39;(16,8)&#39;;</span></span>
<span class="line"><span style="color:#24292e;">ERROR:  missing chunk number 0 for toast value 32789 in pg_toast_2619</span></span></code></pre></div><p>接下来删除此条有问题的数据,然后发现\\dx的元命令可以执行了</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">postgres=# delete from pg_statistic where ctid= &#39;(16,8)&#39;;</span></span>
<span class="line"><span style="color:#e1e4e8;">DELETE 1</span></span>
<span class="line"><span style="color:#e1e4e8;">postgres=# \\dx</span></span>
<span class="line"><span style="color:#e1e4e8;">                                            List of installed extensions</span></span>
<span class="line"><span style="color:#e1e4e8;">        Name        | Version |   Schema   |                              Description                               </span></span>
<span class="line"><span style="color:#e1e4e8;">--------------------+---------+------------+------------------------------------------------------------------------</span></span>
<span class="line"><span style="color:#e1e4e8;"> pg_stat_statements | 1.10    | public     | track planning and execution statistics of all SQL statements executed</span></span>
<span class="line"><span style="color:#e1e4e8;"> plpgsql            | 1.0     | pg_catalog | PL/pgSQL procedural language</span></span>
<span class="line"><span style="color:#e1e4e8;">(2 rows)</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">postgres=# delete from pg_statistic where ctid= &#39;(16,8)&#39;;</span></span>
<span class="line"><span style="color:#24292e;">DELETE 1</span></span>
<span class="line"><span style="color:#24292e;">postgres=# \\dx</span></span>
<span class="line"><span style="color:#24292e;">                                            List of installed extensions</span></span>
<span class="line"><span style="color:#24292e;">        Name        | Version |   Schema   |                              Description                               </span></span>
<span class="line"><span style="color:#24292e;">--------------------+---------+------------+------------------------------------------------------------------------</span></span>
<span class="line"><span style="color:#24292e;"> pg_stat_statements | 1.10    | public     | track planning and execution statistics of all SQL statements executed</span></span>
<span class="line"><span style="color:#24292e;"> plpgsql            | 1.0     | pg_catalog | PL/pgSQL procedural language</span></span>
<span class="line"><span style="color:#24292e;">(2 rows)</span></span></code></pre></div><p>紧接着我们再次查询pg_statistic表，发现还存在问题数据。函数再执行一次，发现又报了问题</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">postgres=# select * from pg_statistic;</span></span>
<span class="line"><span style="color:#e1e4e8;">ERROR:  missing chunk number 0 for toast value 32791 in pg_toast_2619</span></span>
<span class="line"><span style="color:#e1e4e8;"> </span></span>
<span class="line"><span style="color:#e1e4e8;">NOTICE:  Parameter is: (18,15)</span></span>
<span class="line"><span style="color:#e1e4e8;">NOTICE:  Parameter is: (12624,1,f,0,5,-0.81349206,1,2,3,0,0,98,664,664,0,0,950,950,950,0,0,&quot;{0.018518519,0.017195767,0.014550265,0.013227513,0.011904762,0.011904762,0.011904762,0.01058201,0.01058201,0.01058201,0.01058201,0.009259259,0.009259259,0.007936508,0.007936508,0.007936508,0.0066137565,0.005291005,0.005291005,0.003968254,0.003968254,0.003968254,0.0026455026,0.0026455026}&quot;,,{0.97739166},,,&quot;{E061,E021,E081,E121,E051,E141,F051,E091,F031,F041,T321,E011,F021,E071,F131,F311,F261,E031,E101,E151,E152,F501,F302,S011}&quot;,&quot;{B011,B016,B033,B111,B117,B126,B203,B209,E161,F035,F054,F114,F171,F221,F271,F304,F341,F385,F393,F405,F432,F437,F471,F531,F641,F690,F711,F762,F812,F841,F847,F856,F862,F868,M005,M012,M018,M024,S023,S041,S091,S096,S161,S211,S251,S281,S404,T031,T044,T050,T061,T101,T133,T173,T180,T212,T218,T271,T322,T332,T434,T491,T522,T571,T612,T618,T624,T651,T662,T812,T824,T829,T835,T851,T865,T871,T877,X010,X016,X034,X041,X046,X052,X058,X068,X074,X081,X090,X111,X131,X142,X152,X170,X192,X205,X232,X254,X263,X281,X301,X410}&quot;,,,)</span></span>
<span class="line"><span style="color:#e1e4e8;">NOTICE:  Parameter is: (18,16)</span></span>
<span class="line"><span style="color:#e1e4e8;">NOTICE:  Parameter is: (12624,3,f,0,1,18,1,2,3,0,0,98,664,664,0,0,950,950,950,0,0,&quot;{0.81349206,0.03042328,0.02910053,0.023809524,0.022486772,0.017195767,0.015873017,0.013227513,0.01058201,0.005291005,0.005291005,0.0026455026,0.0026455026,0.0026455026}&quot;,,{0.26829666},,,&quot;{&quot;&quot;&quot;&quot;,01,02,03,04,05,06,07,08,09,10,11,12,13}&quot;,&quot;{14,16,17,19}&quot;,,,)</span></span>
<span class="line"><span style="color:#e1e4e8;">ERROR:  missing chunk number 0 for toast value 32791 in pg_toast_2619</span></span>
<span class="line"><span style="color:#e1e4e8;">CONTEXT:  PL/pgSQL function inline_code_block line 5 at FOR over SELECT rows</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">postgres=# select * from pg_statistic;</span></span>
<span class="line"><span style="color:#24292e;">ERROR:  missing chunk number 0 for toast value 32791 in pg_toast_2619</span></span>
<span class="line"><span style="color:#24292e;"> </span></span>
<span class="line"><span style="color:#24292e;">NOTICE:  Parameter is: (18,15)</span></span>
<span class="line"><span style="color:#24292e;">NOTICE:  Parameter is: (12624,1,f,0,5,-0.81349206,1,2,3,0,0,98,664,664,0,0,950,950,950,0,0,&quot;{0.018518519,0.017195767,0.014550265,0.013227513,0.011904762,0.011904762,0.011904762,0.01058201,0.01058201,0.01058201,0.01058201,0.009259259,0.009259259,0.007936508,0.007936508,0.007936508,0.0066137565,0.005291005,0.005291005,0.003968254,0.003968254,0.003968254,0.0026455026,0.0026455026}&quot;,,{0.97739166},,,&quot;{E061,E021,E081,E121,E051,E141,F051,E091,F031,F041,T321,E011,F021,E071,F131,F311,F261,E031,E101,E151,E152,F501,F302,S011}&quot;,&quot;{B011,B016,B033,B111,B117,B126,B203,B209,E161,F035,F054,F114,F171,F221,F271,F304,F341,F385,F393,F405,F432,F437,F471,F531,F641,F690,F711,F762,F812,F841,F847,F856,F862,F868,M005,M012,M018,M024,S023,S041,S091,S096,S161,S211,S251,S281,S404,T031,T044,T050,T061,T101,T133,T173,T180,T212,T218,T271,T322,T332,T434,T491,T522,T571,T612,T618,T624,T651,T662,T812,T824,T829,T835,T851,T865,T871,T877,X010,X016,X034,X041,X046,X052,X058,X068,X074,X081,X090,X111,X131,X142,X152,X170,X192,X205,X232,X254,X263,X281,X301,X410}&quot;,,,)</span></span>
<span class="line"><span style="color:#24292e;">NOTICE:  Parameter is: (18,16)</span></span>
<span class="line"><span style="color:#24292e;">NOTICE:  Parameter is: (12624,3,f,0,1,18,1,2,3,0,0,98,664,664,0,0,950,950,950,0,0,&quot;{0.81349206,0.03042328,0.02910053,0.023809524,0.022486772,0.017195767,0.015873017,0.013227513,0.01058201,0.005291005,0.005291005,0.0026455026,0.0026455026,0.0026455026}&quot;,,{0.26829666},,,&quot;{&quot;&quot;&quot;&quot;,01,02,03,04,05,06,07,08,09,10,11,12,13}&quot;,&quot;{14,16,17,19}&quot;,,,)</span></span>
<span class="line"><span style="color:#24292e;">ERROR:  missing chunk number 0 for toast value 32791 in pg_toast_2619</span></span>
<span class="line"><span style="color:#24292e;">CONTEXT:  PL/pgSQL function inline_code_block line 5 at FOR over SELECT rows</span></span></code></pre></div><p>同样的再次删除问题的行，发现pg_statistic表已经可以正常访问了</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">postgres=# delete from pg_statistic where ctid= &#39;(18,17)&#39;;</span></span>
<span class="line"><span style="color:#e1e4e8;">DELETE 1</span></span>
<span class="line"><span style="color:#e1e4e8;">postgres=# select * from pg_statistic;                    </span></span>
<span class="line"><span style="color:#e1e4e8;"> starelid | staattnum | stainherit | stanullfrac | stawidth |  stadistinct  | stakind1 | stakind2 | stakind3 | stakind4 | stakind5 | staop1 | staop2 | s</span></span>
<span class="line"><span style="color:#e1e4e8;">taop3 | staop4 | staop5 | stacoll1 | stacoll2 | stacoll3 | stacoll4 | stacoll5 |                                                                        </span></span>
<span class="line"><span style="color:#e1e4e8;">... ...</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">postgres=# delete from pg_statistic where ctid= &#39;(18,17)&#39;;</span></span>
<span class="line"><span style="color:#24292e;">DELETE 1</span></span>
<span class="line"><span style="color:#24292e;">postgres=# select * from pg_statistic;                    </span></span>
<span class="line"><span style="color:#24292e;"> starelid | staattnum | stainherit | stanullfrac | stawidth |  stadistinct  | stakind1 | stakind2 | stakind3 | stakind4 | stakind5 | staop1 | staop2 | s</span></span>
<span class="line"><span style="color:#24292e;">taop3 | staop4 | staop5 | stacoll1 | stacoll2 | stacoll3 | stacoll4 | stacoll5 |                                                                        </span></span>
<span class="line"><span style="color:#24292e;">... ...</span></span></code></pre></div><p>完成以上步骤后对该表进行一次完整的维护和索引重建</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">postgres=# REINDEX TABLE pg_toast.pg_toast_2619;</span></span>
<span class="line"><span style="color:#e1e4e8;">postgres=# REINDEX TABLE pg_statistic;</span></span>
<span class="line"><span style="color:#e1e4e8;">postgres=# VACUUM ANALYZE pg_statistic;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">postgres=# REINDEX TABLE pg_toast.pg_toast_2619;</span></span>
<span class="line"><span style="color:#24292e;">postgres=# REINDEX TABLE pg_statistic;</span></span>
<span class="line"><span style="color:#24292e;">postgres=# VACUUM ANALYZE pg_statistic;</span></span></code></pre></div><h2 id="二、业务表toast损坏恢复手段" tabindex="-1">二、业务表toast损坏恢复手段 <a class="header-anchor" href="#二、业务表toast损坏恢复手段" aria-label="Permalink to &quot;二、业务表toast损坏恢复手段&quot;">​</a></h2><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">#!/bin/bash</span></span>
<span class="line"><span style="color:#e1e4e8;"> j=500         #500是表的总行数</span></span>
<span class="line"><span style="color:#e1e4e8;">for ((i=1; i&lt;=j;i++)) </span></span>
<span class="line"><span style="color:#e1e4e8;">do</span></span>
<span class="line"><span style="color:#e1e4e8;">  psql -U user_recover -d postgres -c &quot;SELECT * FROM test_tab order by id  LIMIT 1 offset $i&quot; &gt;/dev/null || echo $i</span></span>
<span class="line"><span style="color:#e1e4e8;">done</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">#!/bin/bash</span></span>
<span class="line"><span style="color:#24292e;"> j=500         #500是表的总行数</span></span>
<span class="line"><span style="color:#24292e;">for ((i=1; i&lt;=j;i++)) </span></span>
<span class="line"><span style="color:#24292e;">do</span></span>
<span class="line"><span style="color:#24292e;">  psql -U user_recover -d postgres -c &quot;SELECT * FROM test_tab order by id  LIMIT 1 offset $i&quot; &gt;/dev/null || echo $i</span></span>
<span class="line"><span style="color:#24292e;">done</span></span></code></pre></div><h2 id="三、物理坏块" tabindex="-1">三、物理坏块 <a class="header-anchor" href="#三、物理坏块" aria-label="Permalink to &quot;三、物理坏块&quot;">​</a></h2><h3 id="_3-1现象" tabindex="-1">3.1现象 <a class="header-anchor" href="#_3-1现象" aria-label="Permalink to &quot;3.1现象&quot;">​</a></h3><p>逻辑备份时报错</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">pg_dump: Dumping the contents of table &quot;xxxx&quot; failed: PQgetResult() failed.</span></span>
<span class="line"><span style="color:#e1e4e8;">pg_dump: Error message from server: ERROR: invalid memory alloc request size 18446744073709551613</span></span>
<span class="line"><span style="color:#e1e4e8;">pg_dump: The command was: COPY xxxxxx (id, active_flag, bkd, blk, go_show, grs, lss, lsv, lt, no_show, value, wl, inv_seg_cabin_id, ind) TO stdout;</span></span>
<span class="line"><span style="color:#e1e4e8;">pg_dump: [parallel archiver] a worker process died unexpectedly</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">pg_dump: Dumping the contents of table &quot;xxxx&quot; failed: PQgetResult() failed.</span></span>
<span class="line"><span style="color:#24292e;">pg_dump: Error message from server: ERROR: invalid memory alloc request size 18446744073709551613</span></span>
<span class="line"><span style="color:#24292e;">pg_dump: The command was: COPY xxxxxx (id, active_flag, bkd, blk, go_show, grs, lss, lsv, lt, no_show, value, wl, inv_seg_cabin_id, ind) TO stdout;</span></span>
<span class="line"><span style="color:#24292e;">pg_dump: [parallel archiver] a worker process died unexpectedly</span></span></code></pre></div><p>考虑了pg自带参数zero_damaged_pages，将这个参数修改为true，但发现仍然是报错，看了下官方文档，这种方法不会对物理文件作修改，只是把内存上，损坏页面的缓存变为0。如果这个方法解决了报错，请将这表备份出来重新恢复，或者select到另一张表</p><h3 id="_3-2解决方式" tabindex="-1">3.2解决方式 <a class="header-anchor" href="#_3-2解决方式" aria-label="Permalink to &quot;3.2解决方式&quot;">​</a></h3><p><code>删除损坏行</code></p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">-- 创建扩展</span></span>
<span class="line"><span style="color:#F97583;">create</span><span style="color:#E1E4E8;"> extension hstore；</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">-- 创建扩展</span></span>
<span class="line"><span style="color:#D73A49;">create</span><span style="color:#24292E;"> extension hstore；</span></span></code></pre></div><h4 id="_1、定义函数" tabindex="-1"><strong>1、定义函数</strong>： <a class="header-anchor" href="#_1、定义函数" aria-label="Permalink to &quot;**1、定义函数**：&quot;">​</a></h4><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">CREATE</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">OR</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">REPLACE</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">FUNCTION</span></span>
<span class="line"><span style="color:#E1E4E8;">  find_bad_row(tableName </span><span style="color:#F97583;">TEXT</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">RETURNS</span><span style="color:#E1E4E8;"> tid</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> $find_bad_row$</span></span>
<span class="line"><span style="color:#F97583;">DECLARE</span></span>
<span class="line"><span style="color:#E1E4E8;">  result tid;</span></span>
<span class="line"><span style="color:#E1E4E8;">  curs REFCURSOR;</span></span>
<span class="line"><span style="color:#E1E4E8;">  row1 RECORD;</span></span>
<span class="line"><span style="color:#E1E4E8;">  row2 RECORD;</span></span>
<span class="line"><span style="color:#E1E4E8;">  tabName </span><span style="color:#F97583;">TEXT</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">  count </span><span style="color:#F97583;">BIGINT</span><span style="color:#E1E4E8;"> :</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#F97583;">BEGIN</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">SELECT</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">reverse</span><span style="color:#E1E4E8;">(split_part(</span><span style="color:#79B8FF;">reverse</span><span style="color:#E1E4E8;">($</span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">), </span><span style="color:#9ECBFF;">&#39;.&#39;</span><span style="color:#E1E4E8;">, </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">)) </span><span style="color:#F97583;">INTO</span><span style="color:#E1E4E8;"> tabName;</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">OPEN</span><span style="color:#E1E4E8;"> curs </span><span style="color:#F97583;">FOR</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">EXECUTE</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;SELECT ctid FROM &#39;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">||</span><span style="color:#E1E4E8;"> tableName;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">  count :</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">FETCH</span><span style="color:#E1E4E8;"> curs </span><span style="color:#F97583;">INTO</span><span style="color:#E1E4E8;"> row1;</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">WHILE</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">row1</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">ctid</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">IS NOT NULL</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">LOOP</span></span>
<span class="line"><span style="color:#E1E4E8;">    result </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">row1</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">ctid</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">    count :</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> count </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">FETCH</span><span style="color:#E1E4E8;"> curs </span><span style="color:#F97583;">INTO</span><span style="color:#E1E4E8;"> row1;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">EXECUTE</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;SELECT (each(hstore(&#39;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">||</span><span style="color:#E1E4E8;"> tabName </span><span style="color:#F97583;">||</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;))).* FROM &#39;</span></span>
<span class="line"><span style="color:#E1E4E8;">         </span><span style="color:#F97583;">||</span><span style="color:#E1E4E8;"> tableName </span><span style="color:#F97583;">||</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39; WHERE ctid = $1&#39;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">INTO</span><span style="color:#E1E4E8;"> row2</span></span>
<span class="line"><span style="color:#E1E4E8;">         </span><span style="color:#F97583;">USING</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">row1</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">ctid</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">IF</span><span style="color:#E1E4E8;"> count % </span><span style="color:#79B8FF;">100000</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">THEN</span></span>
<span class="line"><span style="color:#E1E4E8;">      RAISE NOTICE </span><span style="color:#9ECBFF;">&#39;rows processed: %&#39;</span><span style="color:#E1E4E8;">, count;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">END</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">IF</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">END</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">LOOP</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">CLOSE</span><span style="color:#E1E4E8;"> curs;</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">RETURN</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">row1</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">ctid</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">  EXCEPTION</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">WHEN</span><span style="color:#E1E4E8;"> OTHERS </span><span style="color:#F97583;">THEN</span></span>
<span class="line"><span style="color:#E1E4E8;">      RAISE NOTICE </span><span style="color:#9ECBFF;">&#39;LAST CTID: %&#39;</span><span style="color:#E1E4E8;">, result;</span></span>
<span class="line"><span style="color:#E1E4E8;">      RAISE NOTICE </span><span style="color:#9ECBFF;">&#39;%: %&#39;</span><span style="color:#E1E4E8;">, SQLSTATE, SQLERRM;</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">RETURN</span><span style="color:#E1E4E8;"> result;</span></span>
<span class="line"><span style="color:#F97583;">END</span></span>
<span class="line"><span style="color:#E1E4E8;">$find_bad_row$</span></span>
<span class="line"><span style="color:#F97583;">LANGUAGE</span><span style="color:#E1E4E8;"> plpgsql;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">CREATE</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">OR</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">REPLACE</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">FUNCTION</span></span>
<span class="line"><span style="color:#24292E;">  find_bad_row(tableName </span><span style="color:#D73A49;">TEXT</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">RETURNS</span><span style="color:#24292E;"> tid</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> $find_bad_row$</span></span>
<span class="line"><span style="color:#D73A49;">DECLARE</span></span>
<span class="line"><span style="color:#24292E;">  result tid;</span></span>
<span class="line"><span style="color:#24292E;">  curs REFCURSOR;</span></span>
<span class="line"><span style="color:#24292E;">  row1 RECORD;</span></span>
<span class="line"><span style="color:#24292E;">  row2 RECORD;</span></span>
<span class="line"><span style="color:#24292E;">  tabName </span><span style="color:#D73A49;">TEXT</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">  count </span><span style="color:#D73A49;">BIGINT</span><span style="color:#24292E;"> :</span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#D73A49;">BEGIN</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">SELECT</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">reverse</span><span style="color:#24292E;">(split_part(</span><span style="color:#005CC5;">reverse</span><span style="color:#24292E;">($</span><span style="color:#005CC5;">1</span><span style="color:#24292E;">), </span><span style="color:#032F62;">&#39;.&#39;</span><span style="color:#24292E;">, </span><span style="color:#005CC5;">1</span><span style="color:#24292E;">)) </span><span style="color:#D73A49;">INTO</span><span style="color:#24292E;"> tabName;</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">OPEN</span><span style="color:#24292E;"> curs </span><span style="color:#D73A49;">FOR</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">EXECUTE</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;SELECT ctid FROM &#39;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">||</span><span style="color:#24292E;"> tableName;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">  count :</span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">FETCH</span><span style="color:#24292E;"> curs </span><span style="color:#D73A49;">INTO</span><span style="color:#24292E;"> row1;</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">WHILE</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">row1</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">ctid</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">IS NOT NULL</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">LOOP</span></span>
<span class="line"><span style="color:#24292E;">    result </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">row1</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">ctid</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">    count :</span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> count </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">FETCH</span><span style="color:#24292E;"> curs </span><span style="color:#D73A49;">INTO</span><span style="color:#24292E;"> row1;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">EXECUTE</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;SELECT (each(hstore(&#39;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">||</span><span style="color:#24292E;"> tabName </span><span style="color:#D73A49;">||</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;))).* FROM &#39;</span></span>
<span class="line"><span style="color:#24292E;">         </span><span style="color:#D73A49;">||</span><span style="color:#24292E;"> tableName </span><span style="color:#D73A49;">||</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39; WHERE ctid = $1&#39;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">INTO</span><span style="color:#24292E;"> row2</span></span>
<span class="line"><span style="color:#24292E;">         </span><span style="color:#D73A49;">USING</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">row1</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">ctid</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">IF</span><span style="color:#24292E;"> count % </span><span style="color:#005CC5;">100000</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">THEN</span></span>
<span class="line"><span style="color:#24292E;">      RAISE NOTICE </span><span style="color:#032F62;">&#39;rows processed: %&#39;</span><span style="color:#24292E;">, count;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">END</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">IF</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">END</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">LOOP</span><span style="color:#24292E;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">CLOSE</span><span style="color:#24292E;"> curs;</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">RETURN</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">row1</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">ctid</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">  EXCEPTION</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">WHEN</span><span style="color:#24292E;"> OTHERS </span><span style="color:#D73A49;">THEN</span></span>
<span class="line"><span style="color:#24292E;">      RAISE NOTICE </span><span style="color:#032F62;">&#39;LAST CTID: %&#39;</span><span style="color:#24292E;">, result;</span></span>
<span class="line"><span style="color:#24292E;">      RAISE NOTICE </span><span style="color:#032F62;">&#39;%: %&#39;</span><span style="color:#24292E;">, SQLSTATE, SQLERRM;</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">RETURN</span><span style="color:#24292E;"> result;</span></span>
<span class="line"><span style="color:#D73A49;">END</span></span>
<span class="line"><span style="color:#24292E;">$find_bad_row$</span></span>
<span class="line"><span style="color:#D73A49;">LANGUAGE</span><span style="color:#24292E;"> plpgsql;</span></span></code></pre></div><h4 id="_2、通过函数查找问题行" tabindex="-1"><strong>2、通过函数查找问题行</strong>： <a class="header-anchor" href="#_2、通过函数查找问题行" aria-label="Permalink to &quot;**2、通过函数查找问题行**：&quot;">​</a></h4><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">han</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"># </span><span style="color:#F97583;">select</span><span style="color:#E1E4E8;"> find_bad_row(</span><span style="color:#9ECBFF;">&#39;public.description&#39;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">NOTICE: </span><span style="color:#F97583;">LAST</span><span style="color:#E1E4E8;"> CTID: (</span><span style="color:#79B8FF;">78497</span><span style="color:#E1E4E8;">,</span><span style="color:#79B8FF;">6</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">NOTICE: XX000: invalid memory alloc request </span><span style="color:#F97583;">size</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">18446744073709551613</span></span>
<span class="line"><span style="color:#E1E4E8;">find_bad_row</span></span>
<span class="line"><span style="color:#6A737D;">--------------</span></span>
<span class="line"><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">78497</span><span style="color:#E1E4E8;">,</span><span style="color:#79B8FF;">6</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">row</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">han</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"># </span><span style="color:#F97583;">select</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> xxxxxxx </span><span style="color:#F97583;">where</span><span style="color:#E1E4E8;"> ctid </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;(78498,1)&#39;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">ERROR: invalid memory alloc request </span><span style="color:#F97583;">size</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">18446744073709551613</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">han</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"># </span><span style="color:#F97583;">delete</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> xxxxxx </span><span style="color:#F97583;">where</span><span style="color:#E1E4E8;"> ctid </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;(78498,1)&#39;</span><span style="color:#E1E4E8;">;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">han</span><span style="color:#D73A49;">=</span><span style="color:#24292E;"># </span><span style="color:#D73A49;">select</span><span style="color:#24292E;"> find_bad_row(</span><span style="color:#032F62;">&#39;public.description&#39;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">NOTICE: </span><span style="color:#D73A49;">LAST</span><span style="color:#24292E;"> CTID: (</span><span style="color:#005CC5;">78497</span><span style="color:#24292E;">,</span><span style="color:#005CC5;">6</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">NOTICE: XX000: invalid memory alloc request </span><span style="color:#D73A49;">size</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">18446744073709551613</span></span>
<span class="line"><span style="color:#24292E;">find_bad_row</span></span>
<span class="line"><span style="color:#6A737D;">--------------</span></span>
<span class="line"><span style="color:#24292E;">(</span><span style="color:#005CC5;">78497</span><span style="color:#24292E;">,</span><span style="color:#005CC5;">6</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">(</span><span style="color:#005CC5;">1</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">row</span><span style="color:#24292E;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">han</span><span style="color:#D73A49;">=</span><span style="color:#24292E;"># </span><span style="color:#D73A49;">select</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">*</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">from</span><span style="color:#24292E;"> xxxxxxx </span><span style="color:#D73A49;">where</span><span style="color:#24292E;"> ctid </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;(78498,1)&#39;</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">ERROR: invalid memory alloc request </span><span style="color:#D73A49;">size</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">18446744073709551613</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">han</span><span style="color:#D73A49;">=</span><span style="color:#24292E;"># </span><span style="color:#D73A49;">delete</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">from</span><span style="color:#24292E;"> xxxxxx </span><span style="color:#D73A49;">where</span><span style="color:#24292E;"> ctid </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;(78498,1)&#39;</span><span style="color:#24292E;">;</span></span></code></pre></div><h4 id="_3、然后再执行pg-dump命令" tabindex="-1"><strong>3、然后再执行pg_dump命令</strong> <a class="header-anchor" href="#_3、然后再执行pg-dump命令" aria-label="Permalink to &quot;**3、然后再执行pg_dump命令**&quot;">​</a></h4><h2 id="四、pg-wal因断电文件损坏" tabindex="-1">四、pg_wal因断电文件损坏 <a class="header-anchor" href="#四、pg-wal因断电文件损坏" aria-label="Permalink to &quot;四、pg_wal因断电文件损坏&quot;">​</a></h2><p>报错信息：<code>Could not read from file &quot;&quot;pg_wal/0646&quot;&quot; at offset 243287</code></p><p>服务器异常断电，这台因为是测试库，所以没备份以及备库</p><ol><li>对数据库进行全库物理备份（为之后操作做保险）</li><li>用dd进行伪造这个数据块（数据块伪造全部提交）,并且更改权限</li></ol><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">for</span><span style="color:#E1E4E8;"> i </span><span style="color:#F97583;">in</span><span style="color:#E1E4E8;"> {</span><span style="color:#B392F0;">1..262144}</span><span style="color:#E1E4E8;">; </span><span style="color:#F97583;">do</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">printf</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;\\125&#39;</span><span style="color:#E1E4E8;">; </span><span style="color:#F97583;">done</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;"> committed</span></span>
<span class="line"><span style="color:#B392F0;">ls</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-l</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">committed</span></span>
<span class="line"><span style="color:#B392F0;">od</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-xv</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">committed</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">head</span></span>
<span class="line"><span style="color:#B392F0;">od</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-xv</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">committed</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">tail</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">$</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">ls</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-l</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">committed</span></span>
<span class="line"><span style="color:#B392F0;">-rw-r--r--</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">root</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">root</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">262144</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2009</span><span style="color:#9ECBFF;">-06-25</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">11</span><span style="color:#9ECBFF;">:01</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">committed</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">$</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">od</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-xv</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">committed</span><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">head</span></span>
<span class="line"><span style="color:#B392F0;">0000000</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5555</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5555</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5555</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5555</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5555</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5555</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5555</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5555</span></span>
<span class="line"><span style="color:#B392F0;">0000020</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5555</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5555</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5555</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5555</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5555</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5555</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5555</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5555</span></span>
<span class="line"><span style="color:#B392F0;">0000040</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5555</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5555</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5555</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5555</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5555</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5555</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5555</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5555</span></span>
<span class="line"><span style="color:#B392F0;">0000060</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5555</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5555</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5555</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5555</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5555</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5555</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5555</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5555</span></span>
<span class="line"><span style="color:#B392F0;">0000100</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5555</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5555</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5555</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5555</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5555</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5555</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5555</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5555</span></span>
<span class="line"><span style="color:#B392F0;">0000120</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5555</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5555</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5555</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5555</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5555</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5555</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5555</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5555</span></span>
<span class="line"><span style="color:#B392F0;">0000140</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5555</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5555</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5555</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5555</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5555</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5555</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5555</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5555</span></span>
<span class="line"><span style="color:#B392F0;">0000160</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5555</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5555</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5555</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5555</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5555</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5555</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5555</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5555</span></span>
<span class="line"><span style="color:#B392F0;">0000200</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5555</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5555</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5555</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5555</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5555</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5555</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5555</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5555</span></span>
<span class="line"><span style="color:#B392F0;">0000220</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5555</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5555</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5555</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5555</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5555</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5555</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5555</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5555</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">$</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">od</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-xv</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">committed</span><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">tail</span></span>
<span class="line"><span style="color:#B392F0;">0777560</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5555</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5555</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5555</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5555</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5555</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5555</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5555</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5555</span></span>
<span class="line"><span style="color:#B392F0;">0777600</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5555</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5555</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5555</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5555</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5555</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5555</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5555</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5555</span></span>
<span class="line"><span style="color:#B392F0;">0777620</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5555</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5555</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5555</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5555</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5555</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5555</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5555</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5555</span></span>
<span class="line"><span style="color:#B392F0;">0777640</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5555</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5555</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5555</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5555</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5555</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5555</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5555</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5555</span></span>
<span class="line"><span style="color:#B392F0;">0777660</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5555</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5555</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5555</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5555</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5555</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5555</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5555</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5555</span></span>
<span class="line"><span style="color:#B392F0;">0777700</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5555</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5555</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5555</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5555</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5555</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5555</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5555</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5555</span></span>
<span class="line"><span style="color:#B392F0;">0777720</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5555</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5555</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5555</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5555</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5555</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5555</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5555</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5555</span></span>
<span class="line"><span style="color:#B392F0;">0777740</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5555</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5555</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5555</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5555</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5555</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5555</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5555</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5555</span></span>
<span class="line"><span style="color:#B392F0;">0777760</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5555</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5555</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5555</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5555</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5555</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5555</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5555</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5555</span></span>
<span class="line"><span style="color:#B392F0;">1000000</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">chown</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">postgres.postgres</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">committed</span></span>
<span class="line"><span style="color:#B392F0;">chmod</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">600</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">committed</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">mv</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-i</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">committed</span><span style="color:#E1E4E8;"> $PGDATA</span><span style="color:#9ECBFF;">/pg_wal/0646</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">for</span><span style="color:#24292E;"> i </span><span style="color:#D73A49;">in</span><span style="color:#24292E;"> {</span><span style="color:#6F42C1;">1..262144}</span><span style="color:#24292E;">; </span><span style="color:#D73A49;">do</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">printf</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;\\125&#39;</span><span style="color:#24292E;">; </span><span style="color:#D73A49;">done</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;"> committed</span></span>
<span class="line"><span style="color:#6F42C1;">ls</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-l</span><span style="color:#24292E;"> </span><span style="color:#032F62;">committed</span></span>
<span class="line"><span style="color:#6F42C1;">od</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-xv</span><span style="color:#24292E;"> </span><span style="color:#032F62;">committed</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">head</span></span>
<span class="line"><span style="color:#6F42C1;">od</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-xv</span><span style="color:#24292E;"> </span><span style="color:#032F62;">committed</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">tail</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">$</span><span style="color:#24292E;"> </span><span style="color:#032F62;">ls</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-l</span><span style="color:#24292E;"> </span><span style="color:#032F62;">committed</span></span>
<span class="line"><span style="color:#6F42C1;">-rw-r--r--</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">root</span><span style="color:#24292E;"> </span><span style="color:#032F62;">root</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">262144</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2009</span><span style="color:#032F62;">-06-25</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">11</span><span style="color:#032F62;">:01</span><span style="color:#24292E;"> </span><span style="color:#032F62;">committed</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">$</span><span style="color:#24292E;"> </span><span style="color:#032F62;">od</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-xv</span><span style="color:#24292E;"> </span><span style="color:#032F62;">committed</span><span style="color:#24292E;">  </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">head</span></span>
<span class="line"><span style="color:#6F42C1;">0000000</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5555</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5555</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5555</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5555</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5555</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5555</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5555</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5555</span></span>
<span class="line"><span style="color:#6F42C1;">0000020</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5555</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5555</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5555</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5555</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5555</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5555</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5555</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5555</span></span>
<span class="line"><span style="color:#6F42C1;">0000040</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5555</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5555</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5555</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5555</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5555</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5555</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5555</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5555</span></span>
<span class="line"><span style="color:#6F42C1;">0000060</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5555</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5555</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5555</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5555</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5555</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5555</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5555</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5555</span></span>
<span class="line"><span style="color:#6F42C1;">0000100</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5555</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5555</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5555</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5555</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5555</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5555</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5555</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5555</span></span>
<span class="line"><span style="color:#6F42C1;">0000120</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5555</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5555</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5555</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5555</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5555</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5555</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5555</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5555</span></span>
<span class="line"><span style="color:#6F42C1;">0000140</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5555</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5555</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5555</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5555</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5555</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5555</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5555</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5555</span></span>
<span class="line"><span style="color:#6F42C1;">0000160</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5555</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5555</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5555</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5555</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5555</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5555</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5555</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5555</span></span>
<span class="line"><span style="color:#6F42C1;">0000200</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5555</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5555</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5555</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5555</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5555</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5555</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5555</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5555</span></span>
<span class="line"><span style="color:#6F42C1;">0000220</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5555</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5555</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5555</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5555</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5555</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5555</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5555</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5555</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">$</span><span style="color:#24292E;"> </span><span style="color:#032F62;">od</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-xv</span><span style="color:#24292E;"> </span><span style="color:#032F62;">committed</span><span style="color:#24292E;">  </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">tail</span></span>
<span class="line"><span style="color:#6F42C1;">0777560</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5555</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5555</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5555</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5555</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5555</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5555</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5555</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5555</span></span>
<span class="line"><span style="color:#6F42C1;">0777600</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5555</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5555</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5555</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5555</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5555</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5555</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5555</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5555</span></span>
<span class="line"><span style="color:#6F42C1;">0777620</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5555</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5555</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5555</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5555</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5555</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5555</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5555</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5555</span></span>
<span class="line"><span style="color:#6F42C1;">0777640</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5555</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5555</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5555</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5555</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5555</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5555</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5555</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5555</span></span>
<span class="line"><span style="color:#6F42C1;">0777660</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5555</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5555</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5555</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5555</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5555</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5555</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5555</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5555</span></span>
<span class="line"><span style="color:#6F42C1;">0777700</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5555</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5555</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5555</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5555</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5555</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5555</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5555</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5555</span></span>
<span class="line"><span style="color:#6F42C1;">0777720</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5555</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5555</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5555</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5555</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5555</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5555</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5555</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5555</span></span>
<span class="line"><span style="color:#6F42C1;">0777740</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5555</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5555</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5555</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5555</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5555</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5555</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5555</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5555</span></span>
<span class="line"><span style="color:#6F42C1;">0777760</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5555</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5555</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5555</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5555</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5555</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5555</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5555</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5555</span></span>
<span class="line"><span style="color:#6F42C1;">1000000</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">chown</span><span style="color:#24292E;"> </span><span style="color:#032F62;">postgres.postgres</span><span style="color:#24292E;"> </span><span style="color:#032F62;">committed</span></span>
<span class="line"><span style="color:#6F42C1;">chmod</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">600</span><span style="color:#24292E;"> </span><span style="color:#032F62;">committed</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">mv</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-i</span><span style="color:#24292E;"> </span><span style="color:#032F62;">committed</span><span style="color:#24292E;"> $PGDATA</span><span style="color:#032F62;">/pg_wal/0646</span></span></code></pre></div><div class="warning custom-block"><p class="custom-block-title">💡 说明</p><p>这个只能解决这个问题，不可以修复底层文件的损坏，所以如果有备份还是备份还原比较好</p></div>`,49),e=[o];function t(c,r,E,y,i,F){return a(),n("div",null,e)}const g=s(p,[["render",t]]);export{d as __pageData,g as default};
