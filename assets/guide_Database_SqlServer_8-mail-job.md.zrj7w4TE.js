import{_ as s,o as a,c as n,R as l}from"./chunks/framework.zUbWieqp.js";const D=JSON.parse('{"title":"一、实现JOB任务运行状态的检测","description":"","frontmatter":{},"headers":[],"relativePath":"guide/Database/SqlServer/8-mail-job.md","filePath":"guide/Database/SqlServer/8-mail-job.md","lastUpdated":1728725847000}'),p={name:"guide/Database/SqlServer/8-mail-job.md"},o=l(`<h1 id="一、实现job任务运行状态的检测" tabindex="-1">一、实现JOB任务运行状态的检测 <a class="header-anchor" href="#一、实现job任务运行状态的检测" aria-label="Permalink to &quot;一、实现JOB任务运行状态的检测&quot;">​</a></h1><h2 id="_1-创建操作员" tabindex="-1">1. 创建操作员 <a class="header-anchor" href="#_1-创建操作员" aria-label="Permalink to &quot;1. 创建操作员&quot;">​</a></h2><p>SQL Server Agent → Operators → New Operator</p><p><img src="https://nnaigos.oss-cn-hangzhou.aliyuncs.com/imgs/202410121130301.png" alt="image-20241012113014200"></p><p><img src="https://nnaigos.oss-cn-hangzhou.aliyuncs.com/imgs/202410121129789.png" alt="image-20241012112936241"></p><p>说明：</p><p>a. 姓名：操作员的姓名，可以是别名。</p><p>b. 电子邮件名称：邮箱的地址。</p><p>c. 寻呼值班计划：可根据实际情况设置时间</p><h2 id="_2-创建警告" tabindex="-1">2. 创建警告 <a class="header-anchor" href="#_2-创建警告" aria-label="Permalink to &quot;2. 创建警告&quot;">​</a></h2><p>如死锁警告</p><h3 id="_2-1查询当前警报等级信息" tabindex="-1">2.1查询当前警报等级信息 <a class="header-anchor" href="#_2-1查询当前警报等级信息" aria-label="Permalink to &quot;2.1查询当前警报等级信息&quot;">​</a></h3><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">select</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">msdb</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">dbo</span><span style="color:#E1E4E8;">.syscategories</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">select</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">*</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">from</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">msdb</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">dbo</span><span style="color:#24292E;">.syscategories</span></span></code></pre></div><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">select</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">msdb</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">dbo</span><span style="color:#E1E4E8;">.sysalerts</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">select</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">*</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">from</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">msdb</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">dbo</span><span style="color:#24292E;">.sysalerts</span></span></code></pre></div><h3 id="_2-2创建" tabindex="-1">2.2创建 <a class="header-anchor" href="#_2-2创建" aria-label="Permalink to &quot;2.2创建&quot;">​</a></h3><p><code>注意修改operator_name操作员名字</code></p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">USE</span><span style="color:#E1E4E8;"> [msdb]</span></span>
<span class="line"><span style="color:#F97583;">GO</span></span>
<span class="line"><span style="color:#E1E4E8;"> </span></span>
<span class="line"><span style="color:#F97583;">IF</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">NOT</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">EXISTS</span><span style="color:#E1E4E8;">(</span><span style="color:#F97583;">SELECT</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">FROM</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">msdb</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">dbo</span><span style="color:#E1E4E8;">.syscategories </span><span style="color:#F97583;">WHERE</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">name=</span><span style="color:#9ECBFF;">&#39;DBA_MONITORING&#39;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">AND</span><span style="color:#E1E4E8;"> category_class</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">2</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#F97583;">BEGIN</span></span>
<span class="line"><span style="color:#E1E4E8;"> </span></span>
<span class="line"><span style="color:#F97583;">EXEC</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">msdb</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">dbo</span><span style="color:#E1E4E8;">.sp_add_category</span></span>
<span class="line"><span style="color:#E1E4E8;">    @class</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">N&#39;ALERT&#39;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    @type</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">N&#39;NONE&#39;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    @name</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">N&#39;DBA_MONITORING&#39;</span><span style="color:#E1E4E8;"> ;</span></span>
<span class="line"><span style="color:#E1E4E8;"> </span></span>
<span class="line"><span style="color:#F97583;">END</span></span>
<span class="line"><span style="color:#F97583;">GO</span></span>
<span class="line"><span style="color:#E1E4E8;"> </span></span>
<span class="line"><span style="color:#F97583;">IF</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">EXISTS</span><span style="color:#E1E4E8;">(</span><span style="color:#F97583;">SELECT</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">FROM</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">msdb</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">dbo</span><span style="color:#E1E4E8;">.sysalerts </span><span style="color:#F97583;">WHERE</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">name=</span><span style="color:#9ECBFF;">&#39;SQL Server Dead Lock Detected&#39;</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#F97583;">BEGIN</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">EXEC</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">msdb</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">dbo</span><span style="color:#E1E4E8;">.sp_delete_alert @name</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">N&#39;SQL Server Dead Lock Detected&#39;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#F97583;">END</span></span>
<span class="line"><span style="color:#F97583;">GO</span></span>
<span class="line"><span style="color:#E1E4E8;"> </span></span>
<span class="line"><span style="color:#E1E4E8;"> </span></span>
<span class="line"><span style="color:#F97583;">IF</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">NOT</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">EXISTS</span><span style="color:#E1E4E8;">(</span><span style="color:#F97583;">SELECT</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">FROM</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">msdb</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">dbo</span><span style="color:#E1E4E8;">.sysalerts </span><span style="color:#F97583;">WHERE</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">name=</span><span style="color:#9ECBFF;">&#39;SQL Server Dead Lock Detected&#39;</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#F97583;">BEGIN</span></span>
<span class="line"><span style="color:#F97583;">EXEC</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">msdb</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">dbo</span><span style="color:#E1E4E8;">.sp_add_alert @name</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">N&#39;SQL Server Dead Lock Detected&#39;</span><span style="color:#E1E4E8;">, </span></span>
<span class="line"><span style="color:#E1E4E8;">        @message_id</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">1205</span><span style="color:#E1E4E8;">, </span></span>
<span class="line"><span style="color:#E1E4E8;">        @severity</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">, </span></span>
<span class="line"><span style="color:#E1E4E8;">        @enabled</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">, </span></span>
<span class="line"><span style="color:#E1E4E8;">        @delay_between_responses</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">, </span></span>
<span class="line"><span style="color:#E1E4E8;">        @include_event_description_in</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">, </span></span>
<span class="line"><span style="color:#E1E4E8;">        @category_name</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">N&#39;DBA_MONITORING&#39;</span><span style="color:#E1E4E8;">, </span></span>
<span class="line"><span style="color:#E1E4E8;">        @job_id</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">N&#39;00000000-0000-0000-0000-000000000000&#39;</span></span>
<span class="line"><span style="color:#F97583;">END</span></span>
<span class="line"><span style="color:#F97583;">GO</span></span>
<span class="line"><span style="color:#E1E4E8;"> </span></span>
<span class="line"><span style="color:#F97583;">IF</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">NOT</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">EXISTS</span><span style="color:#E1E4E8;"> ( </span><span style="color:#F97583;">SELECT</span><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">*</span></span>
<span class="line"><span style="color:#E1E4E8;">                </span><span style="color:#F97583;">FROM</span><span style="color:#E1E4E8;">    </span><span style="color:#79B8FF;">msdb</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">dbo</span><span style="color:#E1E4E8;">.sysnotifications</span></span>
<span class="line"><span style="color:#E1E4E8;">                </span><span style="color:#F97583;">WHERE</span><span style="color:#E1E4E8;">   alert_id </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> ( </span><span style="color:#F97583;">SELECT</span><span style="color:#E1E4E8;"> id</span></span>
<span class="line"><span style="color:#E1E4E8;">                                     </span><span style="color:#F97583;">FROM</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">msdb</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">dbo</span><span style="color:#E1E4E8;">.sysalerts</span></span>
<span class="line"><span style="color:#E1E4E8;">                                     </span><span style="color:#F97583;">WHERE</span><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">name</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;SQL Server Dead Lock Detected&#39;</span></span>
<span class="line"><span style="color:#E1E4E8;">                                   ) )</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">BEGIN</span></span>
<span class="line"><span style="color:#E1E4E8;"> </span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">EXEC</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">msdb</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">dbo</span><span style="color:#E1E4E8;">.sp_add_notification @alert_name </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">N&#39;SQL Server Dead Lock Detected&#39;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">            @operator_name </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">N&#39;han&#39;</span><span style="color:#E1E4E8;">, @notification_method </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">END</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#F97583;">GO</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">USE</span><span style="color:#24292E;"> [msdb]</span></span>
<span class="line"><span style="color:#D73A49;">GO</span></span>
<span class="line"><span style="color:#24292E;"> </span></span>
<span class="line"><span style="color:#D73A49;">IF</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">NOT</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">EXISTS</span><span style="color:#24292E;">(</span><span style="color:#D73A49;">SELECT</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">FROM</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">msdb</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">dbo</span><span style="color:#24292E;">.syscategories </span><span style="color:#D73A49;">WHERE</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">name=</span><span style="color:#032F62;">&#39;DBA_MONITORING&#39;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">AND</span><span style="color:#24292E;"> category_class</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">2</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#D73A49;">BEGIN</span></span>
<span class="line"><span style="color:#24292E;"> </span></span>
<span class="line"><span style="color:#D73A49;">EXEC</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">msdb</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">dbo</span><span style="color:#24292E;">.sp_add_category</span></span>
<span class="line"><span style="color:#24292E;">    @class</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">N&#39;ALERT&#39;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">    @type</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">N&#39;NONE&#39;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">    @name</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">N&#39;DBA_MONITORING&#39;</span><span style="color:#24292E;"> ;</span></span>
<span class="line"><span style="color:#24292E;"> </span></span>
<span class="line"><span style="color:#D73A49;">END</span></span>
<span class="line"><span style="color:#D73A49;">GO</span></span>
<span class="line"><span style="color:#24292E;"> </span></span>
<span class="line"><span style="color:#D73A49;">IF</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">EXISTS</span><span style="color:#24292E;">(</span><span style="color:#D73A49;">SELECT</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">FROM</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">msdb</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">dbo</span><span style="color:#24292E;">.sysalerts </span><span style="color:#D73A49;">WHERE</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">name=</span><span style="color:#032F62;">&#39;SQL Server Dead Lock Detected&#39;</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#D73A49;">BEGIN</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">EXEC</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">msdb</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">dbo</span><span style="color:#24292E;">.sp_delete_alert @name</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">N&#39;SQL Server Dead Lock Detected&#39;</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#D73A49;">END</span></span>
<span class="line"><span style="color:#D73A49;">GO</span></span>
<span class="line"><span style="color:#24292E;"> </span></span>
<span class="line"><span style="color:#24292E;"> </span></span>
<span class="line"><span style="color:#D73A49;">IF</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">NOT</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">EXISTS</span><span style="color:#24292E;">(</span><span style="color:#D73A49;">SELECT</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">FROM</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">msdb</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">dbo</span><span style="color:#24292E;">.sysalerts </span><span style="color:#D73A49;">WHERE</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">name=</span><span style="color:#032F62;">&#39;SQL Server Dead Lock Detected&#39;</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#D73A49;">BEGIN</span></span>
<span class="line"><span style="color:#D73A49;">EXEC</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">msdb</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">dbo</span><span style="color:#24292E;">.sp_add_alert @name</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">N&#39;SQL Server Dead Lock Detected&#39;</span><span style="color:#24292E;">, </span></span>
<span class="line"><span style="color:#24292E;">        @message_id</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">1205</span><span style="color:#24292E;">, </span></span>
<span class="line"><span style="color:#24292E;">        @severity</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">0</span><span style="color:#24292E;">, </span></span>
<span class="line"><span style="color:#24292E;">        @enabled</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">1</span><span style="color:#24292E;">, </span></span>
<span class="line"><span style="color:#24292E;">        @delay_between_responses</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">0</span><span style="color:#24292E;">, </span></span>
<span class="line"><span style="color:#24292E;">        @include_event_description_in</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">1</span><span style="color:#24292E;">, </span></span>
<span class="line"><span style="color:#24292E;">        @category_name</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">N&#39;DBA_MONITORING&#39;</span><span style="color:#24292E;">, </span></span>
<span class="line"><span style="color:#24292E;">        @job_id</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">N&#39;00000000-0000-0000-0000-000000000000&#39;</span></span>
<span class="line"><span style="color:#D73A49;">END</span></span>
<span class="line"><span style="color:#D73A49;">GO</span></span>
<span class="line"><span style="color:#24292E;"> </span></span>
<span class="line"><span style="color:#D73A49;">IF</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">NOT</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">EXISTS</span><span style="color:#24292E;"> ( </span><span style="color:#D73A49;">SELECT</span><span style="color:#24292E;">  </span><span style="color:#D73A49;">*</span></span>
<span class="line"><span style="color:#24292E;">                </span><span style="color:#D73A49;">FROM</span><span style="color:#24292E;">    </span><span style="color:#005CC5;">msdb</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">dbo</span><span style="color:#24292E;">.sysnotifications</span></span>
<span class="line"><span style="color:#24292E;">                </span><span style="color:#D73A49;">WHERE</span><span style="color:#24292E;">   alert_id </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> ( </span><span style="color:#D73A49;">SELECT</span><span style="color:#24292E;"> id</span></span>
<span class="line"><span style="color:#24292E;">                                     </span><span style="color:#D73A49;">FROM</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">msdb</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">dbo</span><span style="color:#24292E;">.sysalerts</span></span>
<span class="line"><span style="color:#24292E;">                                     </span><span style="color:#D73A49;">WHERE</span><span style="color:#24292E;">  </span><span style="color:#D73A49;">name</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;SQL Server Dead Lock Detected&#39;</span></span>
<span class="line"><span style="color:#24292E;">                                   ) )</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">BEGIN</span></span>
<span class="line"><span style="color:#24292E;"> </span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">EXEC</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">msdb</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">dbo</span><span style="color:#24292E;">.sp_add_notification @alert_name </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">N&#39;SQL Server Dead Lock Detected&#39;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">            @operator_name </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">N&#39;han&#39;</span><span style="color:#24292E;">, @notification_method </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">END</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#D73A49;">GO</span></span></code></pre></div><ul><li>效果</li></ul><p><img src="https://nnaigos.oss-cn-hangzhou.aliyuncs.com/imgs/202410121138365.png" alt="image-20241012113757537"></p><h2 id="_3-设置sql-server代理" tabindex="-1">3.设置SQL Server代理 <a class="header-anchor" href="#_3-设置sql-server代理" aria-label="Permalink to &quot;3.设置SQL Server代理&quot;">​</a></h2><p>SQL Server 代理 -- 右键 -- 属性</p><p><img src="https://nnaigos.oss-cn-hangzhou.aliyuncs.com/imgs/202410121139179.png" alt="image-20241012113937614"></p><p><img src="https://nnaigos.oss-cn-hangzhou.aliyuncs.com/imgs/202410121141951.png" alt="image-20241012114139917"></p><p><code>补充：其他选项页均保留默认设置</code></p><h2 id="_4-配置job" tabindex="-1">4. 配置job <a class="header-anchor" href="#_4-配置job" aria-label="Permalink to &quot;4. 配置job&quot;">​</a></h2><p>发送Database Log Space 邮件</p><h3 id="_1-创建job" tabindex="-1">1.创建job <a class="header-anchor" href="#_1-创建job" aria-label="Permalink to &quot;1.创建job&quot;">​</a></h3><p>SQL Server Agent → Job → New Job</p><p><img src="https://nnaigos.oss-cn-hangzhou.aliyuncs.com/imgs/202410121202545.png" alt="image-20241012120235443"></p><ul><li>General 选项页配置如下</li></ul><p><img src="https://nnaigos.oss-cn-hangzhou.aliyuncs.com/imgs/202410121203928.png" alt="image-20241012120328743"></p><ul><li>配置 Step 选项页，点击 New</li></ul><p><code>只修改常规</code></p><p><img src="https://nnaigos.oss-cn-hangzhou.aliyuncs.com/imgs/202410121205700.png" alt="image-20241012120507304"></p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">EXEC</span><span style="color:#E1E4E8;"> sp_send_dbmail</span></span>
<span class="line"><span style="color:#E1E4E8;">    @profile_name </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;SendEmailProfile&#39;</span><span style="color:#E1E4E8;">, </span><span style="color:#6A737D;">-- 修改</span></span>
<span class="line"><span style="color:#E1E4E8;">    @recipients </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;xxx@qq.com&#39;</span><span style="color:#E1E4E8;">, </span><span style="color:#6A737D;">-- 修改自己接收者邮箱</span></span>
<span class="line"><span style="color:#E1E4E8;">    @subject </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;Data Log Space&#39;</span><span style="color:#E1E4E8;">,@query</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&#39;dbcc sqlperf(logspace)&#39;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">EXEC</span><span style="color:#24292E;"> sp_send_dbmail</span></span>
<span class="line"><span style="color:#24292E;">    @profile_name </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;SendEmailProfile&#39;</span><span style="color:#24292E;">, </span><span style="color:#6A737D;">-- 修改</span></span>
<span class="line"><span style="color:#24292E;">    @recipients </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;xxx@qq.com&#39;</span><span style="color:#24292E;">, </span><span style="color:#6A737D;">-- 修改自己接收者邮箱</span></span>
<span class="line"><span style="color:#24292E;">    @subject </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;Data Log Space&#39;</span><span style="color:#24292E;">,@query</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&#39;dbcc sqlperf(logspace)&#39;</span></span></code></pre></div><p><code>高级不动</code></p><p>配置 Scheduler 选项页，点击 New</p><p>根据实际需求配置完成后，点击 OK</p><p>本例配置的是 每天每 2h 发一次邮件</p><p><img src="https://nnaigos.oss-cn-hangzhou.aliyuncs.com/imgs/202410121342839.png" alt="image-20241012134221621"></p><h3 id="_2-测试job" tabindex="-1">2.测试job <a class="header-anchor" href="#_2-测试job" aria-label="Permalink to &quot;2.测试job&quot;">​</a></h3><p><img src="https://nnaigos.oss-cn-hangzhou.aliyuncs.com/imgs/202410121345182.png" alt="image-20241012134507139"></p><p><img src="https://nnaigos.oss-cn-hangzhou.aliyuncs.com/imgs/202410121346572.png" alt="image-20241012134606541"></p>`,43),e=[o];function c(t,r,E,y,i,d){return a(),n("div",null,e)}const m=s(p,[["render",c]]);export{D as __pageData,m as default};
