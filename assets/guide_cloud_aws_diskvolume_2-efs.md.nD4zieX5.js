import{_ as s,o as a,c as n,R as e}from"./chunks/framework.zUbWieqp.js";const g=JSON.parse('{"title":"1. EFS (Elastic File System)","description":"","frontmatter":{},"headers":[],"relativePath":"guide/cloud/aws/diskvolume/2-efs.md","filePath":"guide/cloud/aws/diskvolume/2-efs.md","lastUpdated":1752568087000}'),o={name:"guide/cloud/aws/diskvolume/2-efs.md"},l=e(`<h1 id="_1-efs-elastic-file-system" tabindex="-1">1. EFS (Elastic File System) <a class="header-anchor" href="#_1-efs-elastic-file-system" aria-label="Permalink to &quot;1. EFS (Elastic File System)&quot;">​</a></h1><p><a href="https://docs.aws.amazon.com/efs/latest/ug/whatisefs.html" target="_blank" rel="noreferrer">官当</a></p><h2 id="_1-1-介绍" tabindex="-1">1.1 介绍 <a class="header-anchor" href="#_1-1-介绍" aria-label="Permalink to &quot;1.1 介绍&quot;">​</a></h2><p>AWS提供的三种主要的存储：<strong>AWS Elastic Block Store (EBS)</strong>，<strong>Simple Storage Service (Amazon S3)</strong> 和 <strong>Elastic File System (EFS)</strong></p><p>AWS S3对于静态页面的托管、多媒体分发、版本管理、大数据分析、数据存档来说都非常有用。S3可以和AWS CloudFront结合使用而达到更快的上传和下载速度。</p><p>AWS EBS是可以用来做数据库或托管应用程序的持续性文件系统，EBS具有很高的IO读写速度并且即插即用。</p><p>相比前面两种存储，AWS EFS是比较新的一项服务。它提供了可以在多个EC2实例之间共享的网络文件系统，功能类似于NAS设备。可以用EFS来处理大数据分析、多媒体处理和内容管理</p><h2 id="_1-2-特点" tabindex="-1">1.2 特点 <a class="header-anchor" href="#_1-2-特点" aria-label="Permalink to &quot;1.2 特点&quot;">​</a></h2><ul><li>支持Network File System vesion 4 (NFSv4) 协议</li><li>只为使用的EFS份额付费</li><li>容量可以扩展到PB级别</li><li>可以同时间支持成千上万的NFS连接</li><li>EFS的数据会保存在一个区域内的多个可用区</li><li><strong>读写一致性（Read After Write Consistency）</strong></li><li>高性能单区域iops/7000</li></ul><h1 id="_2-efs操作" tabindex="-1">2. EFS操作 <a class="header-anchor" href="#_2-efs操作" aria-label="Permalink to &quot;2. EFS操作&quot;">​</a></h1><h2 id="_2-1-登录" tabindex="-1">2.1 登录 <a class="header-anchor" href="#_2-1-登录" aria-label="Permalink to &quot;2.1 登录&quot;">​</a></h2><p><img src="https://nnaigos.oss-cn-hangzhou.aliyuncs.com/imgs/202411141459071.png" alt="image-20241114145913868"></p><h2 id="_2-2-创建" tabindex="-1">2.2 创建 <a class="header-anchor" href="#_2-2-创建" aria-label="Permalink to &quot;2.2 创建&quot;">​</a></h2><ul><li>Click on “Create file system.”</li></ul><p><img src="https://nnaigos.oss-cn-hangzhou.aliyuncs.com/imgs/202411141458850.png" alt="img"></p><ul><li>Select the VPC</li></ul><p><img src="https://nnaigos.oss-cn-hangzhou.aliyuncs.com/imgs/202411141501606.png" alt="image-20241114150125150"></p><ul><li>select define</li></ul><p><img src="https://nnaigos.oss-cn-hangzhou.aliyuncs.com/imgs/202411141502972.png" alt="img"></p><p><img src="https://nnaigos.oss-cn-hangzhou.aliyuncs.com/imgs/202411141503229.png" alt="img"></p><p>第一次创建只能选择弹性的</p><ul><li>Select the VPC</li></ul><blockquote><p>如果不想用默认的vpc和安全组，请自行修改</p></blockquote><p><img src="https://nnaigos.oss-cn-hangzhou.aliyuncs.com/imgs/20250713131322714.png" alt="image-20250713131313375"></p><p><img src="https://nnaigos.oss-cn-hangzhou.aliyuncs.com/imgs/202411141520869.png" alt="image-20241114152004391"></p><ul><li>检查是否配置的正确</li></ul><p><img src="https://nnaigos.oss-cn-hangzhou.aliyuncs.com/imgs/202411141521264.png" alt="image-20241114152100145"></p><ul><li>效果</li></ul><p><img src="https://nnaigos.oss-cn-hangzhou.aliyuncs.com/imgs/202411141522845.png" alt="image-20241114152155360"></p><h3 id="_1-配置安全组" tabindex="-1">1.配置安全组 <a class="header-anchor" href="#_1-配置安全组" aria-label="Permalink to &quot;1.配置安全组&quot;">​</a></h3><ul><li>编辑安全组，默认 traffic (port 2049)</li></ul><p>这里是允许所有的，你也可以配置指定的ec2来控制</p><p><img src="https://nnaigos.oss-cn-hangzhou.aliyuncs.com/imgs/202411141524889.png" alt="img"></p><h2 id="_2-3-efs挂载" tabindex="-1">2.3 efs挂载 <a class="header-anchor" href="#_2-3-efs挂载" aria-label="Permalink to &quot;2.3 efs挂载&quot;">​</a></h2><h3 id="_1-ip" tabindex="-1">1.ip <a class="header-anchor" href="#_1-ip" aria-label="Permalink to &quot;1.ip&quot;">​</a></h3><blockquote><p>ip需要选定区域</p></blockquote><p>点击attach可以选择方式</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">yum</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">install</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-y</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">nfs-utils</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">mount</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-t</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">nfs4</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-o</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">nfsvers=</span><span style="color:#79B8FF;">4.1</span><span style="color:#9ECBFF;">,rsize=</span><span style="color:#79B8FF;">1048576</span><span style="color:#9ECBFF;">,wsize=</span><span style="color:#79B8FF;">1048576</span><span style="color:#9ECBFF;">,hard,timeo=</span><span style="color:#79B8FF;">600</span><span style="color:#9ECBFF;">,retrans=</span><span style="color:#79B8FF;">2</span><span style="color:#9ECBFF;">,noresvport</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">i</span><span style="color:#E1E4E8;">p</span><span style="color:#F97583;">&gt;</span><span style="color:#9ECBFF;">:/</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">efs</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">yum</span><span style="color:#24292E;"> </span><span style="color:#032F62;">install</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-y</span><span style="color:#24292E;"> </span><span style="color:#032F62;">nfs-utils</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">mount</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-t</span><span style="color:#24292E;"> </span><span style="color:#032F62;">nfs4</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-o</span><span style="color:#24292E;"> </span><span style="color:#032F62;">nfsvers=</span><span style="color:#005CC5;">4.1</span><span style="color:#032F62;">,rsize=</span><span style="color:#005CC5;">1048576</span><span style="color:#032F62;">,wsize=</span><span style="color:#005CC5;">1048576</span><span style="color:#032F62;">,hard,timeo=</span><span style="color:#005CC5;">600</span><span style="color:#032F62;">,retrans=</span><span style="color:#005CC5;">2</span><span style="color:#032F62;">,noresvport</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">i</span><span style="color:#24292E;">p</span><span style="color:#D73A49;">&gt;</span><span style="color:#032F62;">:/</span><span style="color:#24292E;"> </span><span style="color:#032F62;">efs</span></span></code></pre></div><h3 id="_2-dns" tabindex="-1">2.dns <a class="header-anchor" href="#_2-dns" aria-label="Permalink to &quot;2.dns&quot;">​</a></h3><p>有两种协议进行挂载，efs，nfs</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">#efs</span></span>
<span class="line"><span style="color:#B392F0;">sudo</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">mount</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-t</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">efs</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-o</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">tls</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">efs_id_name:/</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/path/dir</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#nfs</span></span>
<span class="line"><span style="color:#B392F0;">mount</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-t</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">nfs4</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-o</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">nfsvers=</span><span style="color:#79B8FF;">4.1</span><span style="color:#9ECBFF;">,rsize=</span><span style="color:#79B8FF;">1048576</span><span style="color:#9ECBFF;">,wsize=</span><span style="color:#79B8FF;">1048576</span><span style="color:#9ECBFF;">,hard,timeo=</span><span style="color:#79B8FF;">600</span><span style="color:#9ECBFF;">,retrans=</span><span style="color:#79B8FF;">2</span><span style="color:#9ECBFF;">,noresvport</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">dn</span><span style="color:#E1E4E8;">s</span><span style="color:#F97583;">&gt;</span><span style="color:#9ECBFF;">:/</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/path/dir</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">#efs</span></span>
<span class="line"><span style="color:#6F42C1;">sudo</span><span style="color:#24292E;"> </span><span style="color:#032F62;">mount</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-t</span><span style="color:#24292E;"> </span><span style="color:#032F62;">efs</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-o</span><span style="color:#24292E;"> </span><span style="color:#032F62;">tls</span><span style="color:#24292E;"> </span><span style="color:#032F62;">efs_id_name:/</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/path/dir</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#nfs</span></span>
<span class="line"><span style="color:#6F42C1;">mount</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-t</span><span style="color:#24292E;"> </span><span style="color:#032F62;">nfs4</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-o</span><span style="color:#24292E;"> </span><span style="color:#032F62;">nfsvers=</span><span style="color:#005CC5;">4.1</span><span style="color:#032F62;">,rsize=</span><span style="color:#005CC5;">1048576</span><span style="color:#032F62;">,wsize=</span><span style="color:#005CC5;">1048576</span><span style="color:#032F62;">,hard,timeo=</span><span style="color:#005CC5;">600</span><span style="color:#032F62;">,retrans=</span><span style="color:#005CC5;">2</span><span style="color:#032F62;">,noresvport</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">dn</span><span style="color:#24292E;">s</span><span style="color:#D73A49;">&gt;</span><span style="color:#032F62;">:/</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/path/dir</span></span></code></pre></div><ul><li>测试磁盘吞吐量</li></ul><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">time dd if=/dev/zero of=/mnt/efs/20G-dd-$(date +%Y%m%d%H%M%S.%3N) bs=1M count=20480 conv=fsync</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">time dd if=/dev/zero of=/mnt/efs/20G-dd-$(date +%Y%m%d%H%M%S.%3N) bs=1M count=20480 conv=fsync</span></span></code></pre></div><h3 id="_3-efs" tabindex="-1">3.efs <a class="header-anchor" href="#_3-efs" aria-label="Permalink to &quot;3.efs&quot;">​</a></h3><p>安装amazon-efs-utils</p><ol><li><p>使用以下命令创建要用作文件系统装载点的目录 <code>efs</code>：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">sudo mkdir efs</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">sudo mkdir efs</span></span></code></pre></div></li><li><p>运行以下命令之一来挂载文件系统。</p><h6 id="注意" tabindex="-1">注意 <a class="header-anchor" href="#注意" aria-label="Permalink to &quot;注意&quot;">​</a></h6><p>如果 EC2 实例和要挂载的文件系统位于不同的 AWS 区域 s 中<a href="https://docs.aws.amazon.com/zh_cn/efs/latest/ug/mount-different-region.html" target="_blank" rel="noreferrer">从其他服务器装载 EFS 文件系统 AWS 区域</a>，请参阅编辑<code>efs-utils.conf</code>文件中的<code>region</code>属性。</p><ul><li><p>要使用文件系统 id 来装载，请执行以下操作：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">sudo mount -t efs file-system-id efs-mount-point/</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">sudo mount -t efs file-system-id efs-mount-point/</span></span></code></pre></div><p>使用要安装的文件系统的 ID <code>efs</code> 代替<code>efs-mount-point</code>。<code>file-system-id</code></p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">sudo mount -t efs fs-abcd123456789ef0 efs/</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">sudo mount -t efs fs-abcd123456789ef0 efs/</span></span></code></pre></div><p>或者，如果要使用传输中的数据加密，您可以使用以下命令挂载文件系统。</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">sudo mount -t efs -o tls fs-abcd123456789ef0:/ efs/</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">sudo mount -t efs -o tls fs-abcd123456789ef0:/ efs/</span></span></code></pre></div></li><li><p>使用文件系统 DNS 名称挂载：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">sudo mount -t efs -o tls file-system-dns-name efs-mount-point/</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">sudo mount -t efs -o tls file-system-dns-name efs-mount-point/</span></span></code></pre></div><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">sudo mount -t efs -o tls fs-abcd123456789ef0.efs.us-east-2.amazonaws.com efs/</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">sudo mount -t efs -o tls fs-abcd123456789ef0.efs.us-east-2.amazonaws.com efs/</span></span></code></pre></div></li><li><p>使用挂载目标 IP 地址挂载：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">sudo mount -t efs -o tls,mounttargetip=mount-target-ip file-system-id efs-mount-point/</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">sudo mount -t efs -o tls,mounttargetip=mount-target-ip file-system-id efs-mount-point/</span></span></code></pre></div><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">sudo mount -t efs -o tls,mounttargetip=192.0.2.0 fs-abcd123456789ef0 efs/</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">sudo mount -t efs -o tls,mounttargetip=192.0.2.0 fs-abcd123456789ef0 efs/</span></span></code></pre></div></li></ul></li></ol><p>官方文档：</p><p><a href="https://docs.aws.amazon.com/zh_cn/efs/latest/ug/efs-backup-solutions.html" target="_blank" rel="noreferrer">https://docs.aws.amazon.com/zh_cn/efs/latest/ug/efs-backup-solutions.html</a></p><p><a href="https://aws.amazon.com/cn/blogs/china/quickly-build-nfs-file-system-with-efs/" target="_blank" rel="noreferrer">https://aws.amazon.com/cn/blogs/china/quickly-build-nfs-file-system-with-efs/</a></p>`,49),p=[l];function t(c,i,r,d,y,u){return a(),n("div",null,p)}const m=s(o,[["render",t]]);export{g as __pageData,m as default};
