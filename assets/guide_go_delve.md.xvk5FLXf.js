import{_ as s,o as n,c as a,R as l}from"./chunks/framework.zUbWieqp.js";const C=JSON.parse('{"title":"","description":"","frontmatter":{},"headers":[],"relativePath":"guide/go/delve.md","filePath":"guide/go/delve.md","lastUpdated":1701928035000}'),p={name:"guide/go/delve.md"},o=l(`<h2 id="简介" tabindex="-1">简介 <a class="header-anchor" href="#简介" aria-label="Permalink to &quot;简介&quot;">​</a></h2><blockquote><p><code>Delve</code> 用来调试 <code>Go</code> 语言开发的程序，该工具的目标是为 <code>Go</code> 语言提供一个简单、功能齐全的调试工具。</p></blockquote><h2 id="为什么不推荐-gdb" tabindex="-1">为什么不推荐 gdb <a class="header-anchor" href="#为什么不推荐-gdb" aria-label="Permalink to &quot;为什么不推荐 gdb&quot;">​</a></h2><ul><li>gdb 对 Go 的调试支持是通过一个 python 脚本文件 <code>src/runtime/runtime-gdb.py</code> 扩展的，功能有限</li><li>gdb 只能做到最基本的变量打印，却理解不了 golang 的一些特殊类型，比如 channel，map，slice 等，gdb 原生是无法调适 goroutine 协程的， 因为这是用户态的调度单位，gdb 只能理解线程，所以只能通过 python 脚本的扩展，把协程结构按照链表输出</li></ul><h2 id="安装" tabindex="-1">安装 <a class="header-anchor" href="#安装" aria-label="Permalink to &quot;安装&quot;">​</a></h2><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">$</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">go</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">install</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">github.com/go-delve/delve/cmd/dlv@latest</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 安装完成后查看版本</span></span>
<span class="line"><span style="color:#B392F0;">$</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">dlv</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">verison</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">Delve</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Debugger</span></span>
<span class="line"><span style="color:#B392F0;">Version:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">1.20</span><span style="color:#9ECBFF;">.1</span></span>
<span class="line"><span style="color:#B392F0;">Build:</span><span style="color:#E1E4E8;"> $Id</span><span style="color:#9ECBFF;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">96</span><span style="color:#9ECBFF;">e65b6c615845d42e0e31d903f6475b0e4ece6e</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">$</span><span style="color:#24292E;"> </span><span style="color:#032F62;">go</span><span style="color:#24292E;"> </span><span style="color:#032F62;">install</span><span style="color:#24292E;"> </span><span style="color:#032F62;">github.com/go-delve/delve/cmd/dlv@latest</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 安装完成后查看版本</span></span>
<span class="line"><span style="color:#6F42C1;">$</span><span style="color:#24292E;"> </span><span style="color:#032F62;">dlv</span><span style="color:#24292E;"> </span><span style="color:#032F62;">verison</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">Delve</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Debugger</span></span>
<span class="line"><span style="color:#6F42C1;">Version:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1.20</span><span style="color:#032F62;">.1</span></span>
<span class="line"><span style="color:#6F42C1;">Build:</span><span style="color:#24292E;"> $Id</span><span style="color:#032F62;">:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">96</span><span style="color:#032F62;">e65b6c615845d42e0e31d903f6475b0e4ece6e</span></span></code></pre></div><h2 id="常用命令" tabindex="-1">常用命令 <a class="header-anchor" href="#常用命令" aria-label="Permalink to &quot;常用命令&quot;">​</a></h2><ul><li><code>dlv attach</code> - 调试进程</li><li><code>dlv core</code> - 调试 core</li><li><code>dlv debug</code> - 编译并调试当前目录的 <code>main</code> 包，也可以通过参数指定其他包</li><li><code>dlv exec</code> - 调试二进制文件</li><li><code>dlv test</code> - 编译并调试测试文件</li></ul><h2 id="快速开始" tabindex="-1">快速开始 <a class="header-anchor" href="#快速开始" aria-label="Permalink to &quot;快速开始&quot;">​</a></h2><p>我们首先从一个简单的示例程序开始，改程序打印字符串 <code>hello world</code>, 然后结束并退出。</p><h3 id="源文件" tabindex="-1">源文件 <a class="header-anchor" href="#源文件" aria-label="Permalink to &quot;源文件&quot;">​</a></h3><div class="language-go vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">// main.go</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">package</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">main</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">func</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">main</span><span style="color:#E1E4E8;">() {</span></span>
<span class="line"><span style="color:#E1E4E8;">	</span><span style="color:#79B8FF;">println</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;hello world&quot;</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">// main.go</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">package</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">main</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">func</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">main</span><span style="color:#24292E;">() {</span></span>
<span class="line"><span style="color:#24292E;">	</span><span style="color:#005CC5;">println</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;hello world&quot;</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre></div><h3 id="调试源文件" tabindex="-1">调试源文件 <a class="header-anchor" href="#调试源文件" aria-label="Permalink to &quot;调试源文件&quot;">​</a></h3><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">$</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">dlv</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">debug</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">main.go</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># Type &#39;help&#39; for list of commands.</span></span>
<span class="line"><span style="color:#E1E4E8;">(</span><span style="color:#B392F0;">dlv</span><span style="color:#E1E4E8;">) </span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 输入 help 查看参数说明</span></span>
<span class="line"><span style="color:#E1E4E8;">(</span><span style="color:#B392F0;">dlv</span><span style="color:#E1E4E8;">) help</span></span>
<span class="line"><span style="color:#B392F0;">The</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">following</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">commands</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">are</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">available:</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">Running</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">the</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">program:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">call</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">------------------------</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Resumes</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">process</span></span>
<span class="line"><span style="color:#79B8FF;">...</span></span>
<span class="line"><span style="color:#79B8FF;">...</span></span>
<span class="line"><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">types</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">----------------------</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Print</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">list</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">of</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">types</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">Type</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">help</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">followed</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">by</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">a</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">command</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">for</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">full</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">documentation.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 运行程序</span></span>
<span class="line"><span style="color:#E1E4E8;">(</span><span style="color:#B392F0;">dlv</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">continue</span></span>
<span class="line"><span style="color:#B392F0;">hello</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">world</span></span>
<span class="line"><span style="color:#B392F0;">Process</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">3637</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">has</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">exited</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">with</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">status</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">$</span><span style="color:#24292E;"> </span><span style="color:#032F62;">dlv</span><span style="color:#24292E;"> </span><span style="color:#032F62;">debug</span><span style="color:#24292E;"> </span><span style="color:#032F62;">main.go</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># Type &#39;help&#39; for list of commands.</span></span>
<span class="line"><span style="color:#24292E;">(</span><span style="color:#6F42C1;">dlv</span><span style="color:#24292E;">) </span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 输入 help 查看参数说明</span></span>
<span class="line"><span style="color:#24292E;">(</span><span style="color:#6F42C1;">dlv</span><span style="color:#24292E;">) help</span></span>
<span class="line"><span style="color:#6F42C1;">The</span><span style="color:#24292E;"> </span><span style="color:#032F62;">following</span><span style="color:#24292E;"> </span><span style="color:#032F62;">commands</span><span style="color:#24292E;"> </span><span style="color:#032F62;">are</span><span style="color:#24292E;"> </span><span style="color:#032F62;">available:</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">Running</span><span style="color:#24292E;"> </span><span style="color:#032F62;">the</span><span style="color:#24292E;"> </span><span style="color:#032F62;">program:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">call</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">------------------------</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Resumes</span><span style="color:#24292E;"> </span><span style="color:#032F62;">process</span></span>
<span class="line"><span style="color:#005CC5;">...</span></span>
<span class="line"><span style="color:#005CC5;">...</span></span>
<span class="line"><span style="color:#24292E;"> </span><span style="color:#6F42C1;">types</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">----------------------</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Print</span><span style="color:#24292E;"> </span><span style="color:#032F62;">list</span><span style="color:#24292E;"> </span><span style="color:#032F62;">of</span><span style="color:#24292E;"> </span><span style="color:#032F62;">types</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">Type</span><span style="color:#24292E;"> </span><span style="color:#032F62;">help</span><span style="color:#24292E;"> </span><span style="color:#032F62;">followed</span><span style="color:#24292E;"> </span><span style="color:#032F62;">by</span><span style="color:#24292E;"> </span><span style="color:#032F62;">a</span><span style="color:#24292E;"> </span><span style="color:#032F62;">command</span><span style="color:#24292E;"> </span><span style="color:#032F62;">for</span><span style="color:#24292E;"> </span><span style="color:#032F62;">full</span><span style="color:#24292E;"> </span><span style="color:#032F62;">documentation.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 运行程序</span></span>
<span class="line"><span style="color:#24292E;">(</span><span style="color:#6F42C1;">dlv</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">continue</span></span>
<span class="line"><span style="color:#6F42C1;">hello</span><span style="color:#24292E;"> </span><span style="color:#032F62;">world</span></span>
<span class="line"><span style="color:#6F42C1;">Process</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">3637</span><span style="color:#24292E;"> </span><span style="color:#032F62;">has</span><span style="color:#24292E;"> </span><span style="color:#032F62;">exited</span><span style="color:#24292E;"> </span><span style="color:#032F62;">with</span><span style="color:#24292E;"> </span><span style="color:#032F62;">status</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0</span></span></code></pre></div><h3 id="调试编译后二进制文件" tabindex="-1">调试编译后二进制文件 <a class="header-anchor" href="#调试编译后二进制文件" aria-label="Permalink to &quot;调试编译后二进制文件&quot;">​</a></h3><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;"># 编译源文件</span></span>
<span class="line"><span style="color:#B392F0;">$</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">go</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">build</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-o</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">main</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">main.go</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">$</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">dlv</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">exec</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">./main</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">Type</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;help&#39;</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">for</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">list</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">of</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">commands.</span></span>
<span class="line"><span style="color:#E1E4E8;">(</span><span style="color:#B392F0;">dlv</span><span style="color:#E1E4E8;">) </span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 接下来的步骤和调试源文件的一样，这里不再赘述</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;"># 编译源文件</span></span>
<span class="line"><span style="color:#6F42C1;">$</span><span style="color:#24292E;"> </span><span style="color:#032F62;">go</span><span style="color:#24292E;"> </span><span style="color:#032F62;">build</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-o</span><span style="color:#24292E;"> </span><span style="color:#032F62;">main</span><span style="color:#24292E;"> </span><span style="color:#032F62;">main.go</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">$</span><span style="color:#24292E;"> </span><span style="color:#032F62;">dlv</span><span style="color:#24292E;"> </span><span style="color:#032F62;">exec</span><span style="color:#24292E;"> </span><span style="color:#032F62;">./main</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">Type</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;help&#39;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">for</span><span style="color:#24292E;"> </span><span style="color:#032F62;">list</span><span style="color:#24292E;"> </span><span style="color:#032F62;">of</span><span style="color:#24292E;"> </span><span style="color:#032F62;">commands.</span></span>
<span class="line"><span style="color:#24292E;">(</span><span style="color:#6F42C1;">dlv</span><span style="color:#24292E;">) </span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 接下来的步骤和调试源文件的一样，这里不再赘述</span></span></code></pre></div><h3 id="调试进程" tabindex="-1">调试进程 <a class="header-anchor" href="#调试进程" aria-label="Permalink to &quot;调试进程&quot;">​</a></h3><p>为了让进程保持在运行状态，我们在程序中加一行休眠代码:</p><div class="language-go vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">package</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">main</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;</span><span style="color:#B392F0;">time</span><span style="color:#9ECBFF;">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">func</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">main</span><span style="color:#E1E4E8;">() {</span></span>
<span class="line"><span style="color:#E1E4E8;">	time.</span><span style="color:#79B8FF;">Sleep</span><span style="color:#E1E4E8;">(time.Minute)</span></span>
<span class="line"><span style="color:#E1E4E8;">	</span><span style="color:#79B8FF;">println</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;hello world&quot;</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">package</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">main</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">import</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;</span><span style="color:#6F42C1;">time</span><span style="color:#032F62;">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">func</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">main</span><span style="color:#24292E;">() {</span></span>
<span class="line"><span style="color:#24292E;">	time.</span><span style="color:#005CC5;">Sleep</span><span style="color:#24292E;">(time.Minute)</span></span>
<span class="line"><span style="color:#24292E;">	</span><span style="color:#005CC5;">println</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;hello world&quot;</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre></div><p>调试前先运行程序：</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">$</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">go</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">run</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">main.go</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 查看进程 ID</span></span>
<span class="line"><span style="color:#B392F0;">$</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">ps</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-ef</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">grep</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;go run main.go&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">7602</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">27666</span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">21</span><span style="color:#9ECBFF;">:30</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pts/6</span><span style="color:#E1E4E8;">    </span><span style="color:#79B8FF;">00</span><span style="color:#9ECBFF;">:00:00</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">go</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">run</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">main.go</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 调试进程</span></span>
<span class="line"><span style="color:#B392F0;">$</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">dlv</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">attach</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">7602</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">Type</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;help&#39;</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">for</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">list</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">of</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">commands.</span></span>
<span class="line"><span style="color:#E1E4E8;">(</span><span style="color:#B392F0;">dlv</span><span style="color:#E1E4E8;">) </span></span>
<span class="line"></span>
<span class="line"><span style="color:#79B8FF;">...</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 1 分钟之后，main.go 并未正常退出，因为当前正在调试</span></span>
<span class="line"><span style="color:#6A737D;"># 输入 continue 继续运行</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">(</span><span style="color:#B392F0;">dlv</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">continue</span><span style="color:#E1E4E8;"> </span></span>
<span class="line"><span style="color:#B392F0;">Process</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">7602</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">has</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">exited</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">with</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">status</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">$</span><span style="color:#24292E;"> </span><span style="color:#032F62;">go</span><span style="color:#24292E;"> </span><span style="color:#032F62;">run</span><span style="color:#24292E;"> </span><span style="color:#032F62;">main.go</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 查看进程 ID</span></span>
<span class="line"><span style="color:#6F42C1;">$</span><span style="color:#24292E;"> </span><span style="color:#032F62;">ps</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-ef</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">grep</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;go run main.go&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">7602</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">27666</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">0</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">21</span><span style="color:#032F62;">:30</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pts/6</span><span style="color:#24292E;">    </span><span style="color:#005CC5;">00</span><span style="color:#032F62;">:00:00</span><span style="color:#24292E;"> </span><span style="color:#032F62;">go</span><span style="color:#24292E;"> </span><span style="color:#032F62;">run</span><span style="color:#24292E;"> </span><span style="color:#032F62;">main.go</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 调试进程</span></span>
<span class="line"><span style="color:#6F42C1;">$</span><span style="color:#24292E;"> </span><span style="color:#032F62;">dlv</span><span style="color:#24292E;"> </span><span style="color:#032F62;">attach</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">7602</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">Type</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;help&#39;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">for</span><span style="color:#24292E;"> </span><span style="color:#032F62;">list</span><span style="color:#24292E;"> </span><span style="color:#032F62;">of</span><span style="color:#24292E;"> </span><span style="color:#032F62;">commands.</span></span>
<span class="line"><span style="color:#24292E;">(</span><span style="color:#6F42C1;">dlv</span><span style="color:#24292E;">) </span></span>
<span class="line"></span>
<span class="line"><span style="color:#005CC5;">...</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 1 分钟之后，main.go 并未正常退出，因为当前正在调试</span></span>
<span class="line"><span style="color:#6A737D;"># 输入 continue 继续运行</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">(</span><span style="color:#6F42C1;">dlv</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">continue</span><span style="color:#24292E;"> </span></span>
<span class="line"><span style="color:#6F42C1;">Process</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">7602</span><span style="color:#24292E;"> </span><span style="color:#032F62;">has</span><span style="color:#24292E;"> </span><span style="color:#032F62;">exited</span><span style="color:#24292E;"> </span><span style="color:#032F62;">with</span><span style="color:#24292E;"> </span><span style="color:#032F62;">status</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0</span></span></code></pre></div><h2 id="常用调试命令" tabindex="-1">常用调试命令 <a class="header-anchor" href="#常用调试命令" aria-label="Permalink to &quot;常用调试命令&quot;">​</a></h2><p>下列命令是启动 <code>dlv</code> 调试后可用的命令 (也就是当前命令行变为 <code>(dlv)</code> 之后可用)。</p><h3 id="运行程序" tabindex="-1">运行程序 <a class="header-anchor" href="#运行程序" aria-label="Permalink to &quot;运行程序&quot;">​</a></h3><table><thead><tr><th>命令</th><th>描述</th></tr></thead><tbody><tr><td>call</td><td>恢复进程，调用函数 (实验阶段)</td></tr><tr><td>continue</td><td>继续运行程序，直到遇到断点或程序结束</td></tr><tr><td>next</td><td>单步调试</td></tr><tr><td>restart</td><td>重新运行</td></tr><tr><td>step</td><td>单步调试某个函数</td></tr><tr><td>step-instruction</td><td>单步调试某个 CPU 指令</td></tr><tr><td>stepout</td><td>从当前函数跳出</td></tr></tbody></table><h3 id="操作断点" tabindex="-1">操作断点 <a class="header-anchor" href="#操作断点" aria-label="Permalink to &quot;操作断点&quot;">​</a></h3><table><thead><tr><th>命令</th><th>描述</th></tr></thead><tbody><tr><td>break</td><td>设置断点</td></tr><tr><td>breakpoints</td><td>打印所有断点</td></tr><tr><td>clear</td><td>删除断点</td></tr><tr><td>clearall</td><td>删除所有断点</td></tr><tr><td>condition</td><td>设置条件断点</td></tr><tr><td>on</td><td>设置一个断点触发时执行的命令</td></tr><tr><td>toggle</td><td>打开/关闭 断点</td></tr></tbody></table><h3 id="查看变量或内存" tabindex="-1">查看变量或内存 <a class="header-anchor" href="#查看变量或内存" aria-label="Permalink to &quot;查看变量或内存&quot;">​</a></h3><table><thead><tr><th>命令</th><th>描述</th></tr></thead><tbody><tr><td>args</td><td>打印函数参数</td></tr><tr><td>display</td><td>每次程序停止时打印表达式的值</td></tr><tr><td>examinemem</td><td>解析给定地址的内存</td></tr><tr><td>locals</td><td>打印本地变量</td></tr><tr><td>print</td><td>解析一个表达式</td></tr><tr><td>regs</td><td>打印寄存器信息</td></tr><tr><td>set</td><td>设置变量的值</td></tr><tr><td>vars</td><td>打印包内变量</td></tr><tr><td>whatis</td><td>打印类型信息</td></tr></tbody></table><h3 id="线程-goroutine-的展示与切换" tabindex="-1">线程 / goroutine 的展示与切换 <a class="header-anchor" href="#线程-goroutine-的展示与切换" aria-label="Permalink to &quot;线程 / goroutine 的展示与切换&quot;">​</a></h3><table><thead><tr><th>命令</th><th>描述</th></tr></thead><tbody><tr><td>goroutine</td><td>打印或切换 goroutine</td></tr><tr><td>goroutines</td><td>打印所有 goroutine</td></tr><tr><td>thread</td><td>切换到指定的线程</td></tr><tr><td>threads</td><td>打印所有线程信息</td></tr></tbody></table><h3 id="调用堆栈" tabindex="-1">调用堆栈 <a class="header-anchor" href="#调用堆栈" aria-label="Permalink to &quot;调用堆栈&quot;">​</a></h3><table><thead><tr><th>命令</th><th>描述</th></tr></thead><tbody><tr><td>deferred</td><td>在 defer 上下文中执行命令</td></tr><tr><td>frame</td><td>设置当前帧，或在不同的帧上执行命令</td></tr><tr><td>stack</td><td>打印堆栈信息</td></tr></tbody></table><h3 id="其他命令" tabindex="-1">其他命令 <a class="header-anchor" href="#其他命令" aria-label="Permalink to &quot;其他命令&quot;">​</a></h3><table><thead><tr><th>命令</th><th>描述</th></tr></thead><tbody><tr><td>config</td><td>更改配置参数</td></tr><tr><td>disassemble</td><td>反汇编</td></tr><tr><td>dump</td><td>dump core</td></tr><tr><td>exit</td><td>结束调试，也可以用 <code>quit</code></td></tr></tbody></table><h2 id="综合示例" tabindex="-1">综合示例 <a class="header-anchor" href="#综合示例" aria-label="Permalink to &quot;综合示例&quot;">​</a></h2><p>最后，我们使用一个的小例子，熟悉下常用的几个命令。</p><p>示例程序代码如下:</p><div class="language-go vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">go</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">// main.go</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">package</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">main</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">var</span><span style="color:#E1E4E8;"> (</span></span>
<span class="line"><span style="color:#E1E4E8;">	x </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">1024</span></span>
<span class="line"><span style="color:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">func</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">main</span><span style="color:#E1E4E8;">() {</span></span>
<span class="line"><span style="color:#E1E4E8;">	</span><span style="color:#F97583;">for</span><span style="color:#E1E4E8;"> i </span><span style="color:#F97583;">:=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">; i </span><span style="color:#F97583;">&lt;</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5</span><span style="color:#E1E4E8;">; i</span><span style="color:#F97583;">++</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">		</span><span style="color:#79B8FF;">println</span><span style="color:#E1E4E8;">(i)</span></span>
<span class="line"><span style="color:#E1E4E8;">	}</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">// main.go</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">package</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">main</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">var</span><span style="color:#24292E;"> (</span></span>
<span class="line"><span style="color:#24292E;">	x </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1024</span></span>
<span class="line"><span style="color:#24292E;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">func</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">main</span><span style="color:#24292E;">() {</span></span>
<span class="line"><span style="color:#24292E;">	</span><span style="color:#D73A49;">for</span><span style="color:#24292E;"> i </span><span style="color:#D73A49;">:=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">; i </span><span style="color:#D73A49;">&lt;</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5</span><span style="color:#24292E;">; i</span><span style="color:#D73A49;">++</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">		</span><span style="color:#005CC5;">println</span><span style="color:#24292E;">(i)</span></span>
<span class="line"><span style="color:#24292E;">	}</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre></div><hr><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;"># 开始调试</span></span>
<span class="line"><span style="color:#B392F0;">$</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">dlv</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">debug</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">main.go</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">Type</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;help&#39;</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">for</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">list</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">of</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">commands.</span></span>
<span class="line"><span style="color:#E1E4E8;">(</span><span style="color:#B392F0;">dlv</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;"> </span></span>
<span class="line"><span style="color:#6A737D;"># 增加断点</span></span>
<span class="line"><span style="color:#E1E4E8;">(</span><span style="color:#B392F0;">dlv</span><span style="color:#E1E4E8;">) b main.main</span></span>
<span class="line"><span style="color:#B392F0;">Breakpoint</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">set</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">at</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0x45f0c6</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">for</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">main.main</span><span style="color:#E1E4E8;">() </span><span style="color:#9ECBFF;">./main.go:7</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 查看断点</span></span>
<span class="line"><span style="color:#E1E4E8;">(</span><span style="color:#B392F0;">dlv</span><span style="color:#E1E4E8;">) bp</span></span>
<span class="line"><span style="color:#79B8FF;">...</span></span>
<span class="line"><span style="color:#B392F0;">Breakpoint</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2</span><span style="color:#E1E4E8;"> (enabled) at 0x45f0c6 </span><span style="color:#F97583;">for</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">main.main</span><span style="color:#E1E4E8;">() ./main.go:7 (</span><span style="color:#B392F0;">0</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 运行程序</span></span>
<span class="line"><span style="color:#E1E4E8;">(</span><span style="color:#B392F0;">dlv</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">continue</span></span>
<span class="line"><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">main.main</span><span style="color:#E1E4E8;">() ./main.go:7 (</span><span style="color:#B392F0;">hits</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">goroutine</span><span style="color:#E1E4E8;">(</span><span style="color:#B392F0;">1</span><span style="color:#E1E4E8;">)</span><span style="color:#9ECBFF;">:1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">total:1</span><span style="color:#E1E4E8;">) (</span><span style="color:#B392F0;">PC:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0x45f0c6</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">     </span><span style="color:#B392F0;">2:</span></span>
<span class="line"><span style="color:#E1E4E8;">     </span><span style="color:#B392F0;">3:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">var</span><span style="color:#E1E4E8;"> (</span></span>
<span class="line"><span style="color:#E1E4E8;">     </span><span style="color:#B392F0;">4:</span><span style="color:#E1E4E8;">         </span><span style="color:#9ECBFF;">x</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">1024</span></span>
<span class="line"><span style="color:#E1E4E8;">     </span><span style="color:#B392F0;">5:</span><span style="color:#E1E4E8;"> )</span></span>
<span class="line"><span style="color:#E1E4E8;">     </span><span style="color:#B392F0;">6:</span></span>
<span class="line"><span style="color:#E1E4E8;">=&gt;   </span><span style="color:#79B8FF;">7</span><span style="color:#9ECBFF;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">func</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">main</span><span style="color:#E1E4E8;">() </span><span style="color:#9ECBFF;">{</span></span>
<span class="line"><span style="color:#E1E4E8;">     </span><span style="color:#B392F0;">8:</span><span style="color:#E1E4E8;">         </span><span style="color:#9ECBFF;">for</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">i</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">:=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">; </span><span style="color:#B392F0;">i</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">&lt;</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5</span><span style="color:#E1E4E8;">; </span><span style="color:#B392F0;">i++</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">{</span></span>
<span class="line"><span style="color:#E1E4E8;">     </span><span style="color:#B392F0;">9:</span><span style="color:#E1E4E8;">                 </span><span style="color:#9ECBFF;">println</span><span style="color:#E1E4E8;">(</span><span style="color:#B392F0;">i</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">10:</span><span style="color:#E1E4E8;">         </span><span style="color:#9ECBFF;">}</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">11:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">}</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">12:</span></span>
<span class="line"><span style="color:#6A737D;"># 可以看到，程序停在了设置的断点上</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 打印包变量</span></span>
<span class="line"><span style="color:#E1E4E8;">(</span><span style="color:#B392F0;">dlv</span><span style="color:#E1E4E8;">) vars vars main.x</span></span>
<span class="line"><span style="color:#79B8FF;">...</span></span>
<span class="line"><span style="color:#B392F0;">main.x</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">1024</span></span>
<span class="line"><span style="color:#79B8FF;">...</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 单步调试</span></span>
<span class="line"><span style="color:#E1E4E8;">(</span><span style="color:#B392F0;">dlv</span><span style="color:#E1E4E8;">) next</span></span>
<span class="line"><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">main.main</span><span style="color:#E1E4E8;">() ./main.go:8 (</span><span style="color:#B392F0;">PC:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0x45f0d4</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">     </span><span style="color:#B392F0;">3:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">var</span><span style="color:#E1E4E8;"> (</span></span>
<span class="line"><span style="color:#E1E4E8;">     </span><span style="color:#B392F0;">4:</span><span style="color:#E1E4E8;">         </span><span style="color:#9ECBFF;">x</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">1024</span></span>
<span class="line"><span style="color:#E1E4E8;">     </span><span style="color:#B392F0;">5:</span><span style="color:#E1E4E8;"> )</span></span>
<span class="line"><span style="color:#E1E4E8;">     </span><span style="color:#B392F0;">6:</span></span>
<span class="line"><span style="color:#E1E4E8;">     </span><span style="color:#B392F0;">7:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">func</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">main</span><span style="color:#E1E4E8;">() </span><span style="color:#9ECBFF;">{</span></span>
<span class="line"><span style="color:#E1E4E8;">=&gt;   </span><span style="color:#79B8FF;">8</span><span style="color:#9ECBFF;">:</span><span style="color:#E1E4E8;">         </span><span style="color:#9ECBFF;">x</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0</span></span>
<span class="line"><span style="color:#E1E4E8;">     </span><span style="color:#B392F0;">9:</span><span style="color:#E1E4E8;">         </span><span style="color:#9ECBFF;">for</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">i</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">:=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">; </span><span style="color:#B392F0;">i</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">&lt;</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5</span><span style="color:#E1E4E8;">; </span><span style="color:#B392F0;">i++</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">{</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">10:</span><span style="color:#E1E4E8;">                 </span><span style="color:#9ECBFF;">println</span><span style="color:#E1E4E8;">(</span><span style="color:#B392F0;">i</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">11:</span><span style="color:#E1E4E8;">         </span><span style="color:#9ECBFF;">}</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">12:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">}</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">13:</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 再次单步调试</span></span>
<span class="line"><span style="color:#E1E4E8;">(</span><span style="color:#B392F0;">dlv</span><span style="color:#E1E4E8;">) next</span></span>
<span class="line"><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">main.main</span><span style="color:#E1E4E8;">() ./main.go:9 (</span><span style="color:#B392F0;">PC:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0x45f0df</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">     </span><span style="color:#B392F0;">4:</span><span style="color:#E1E4E8;">         </span><span style="color:#9ECBFF;">x</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">1024</span></span>
<span class="line"><span style="color:#E1E4E8;">     </span><span style="color:#B392F0;">5:</span><span style="color:#E1E4E8;"> )</span></span>
<span class="line"><span style="color:#E1E4E8;">     </span><span style="color:#B392F0;">6:</span></span>
<span class="line"><span style="color:#E1E4E8;">     </span><span style="color:#B392F0;">7:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">func</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">main</span><span style="color:#E1E4E8;">() </span><span style="color:#9ECBFF;">{</span></span>
<span class="line"><span style="color:#E1E4E8;">     </span><span style="color:#B392F0;">8:</span><span style="color:#E1E4E8;">         </span><span style="color:#9ECBFF;">x</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0</span></span>
<span class="line"><span style="color:#E1E4E8;">=&gt;   </span><span style="color:#79B8FF;">9</span><span style="color:#9ECBFF;">:</span><span style="color:#E1E4E8;">         </span><span style="color:#9ECBFF;">for</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">i</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">:=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">; </span><span style="color:#B392F0;">i</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">&lt;</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5</span><span style="color:#E1E4E8;">; </span><span style="color:#B392F0;">i++</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">{</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">10:</span><span style="color:#E1E4E8;">                 </span><span style="color:#9ECBFF;">println</span><span style="color:#E1E4E8;">(</span><span style="color:#B392F0;">i</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">11:</span><span style="color:#E1E4E8;">         </span><span style="color:#9ECBFF;">}</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">12:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">}</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">13:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">14:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">//timeout</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">:=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">time.After</span><span style="color:#E1E4E8;">(time.Minute)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 可以看到，程序停在了循环语句</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 打印包变量</span></span>
<span class="line"><span style="color:#E1E4E8;">(</span><span style="color:#B392F0;">dlv</span><span style="color:#E1E4E8;">) vars main.x</span></span>
<span class="line"><span style="color:#B392F0;">main.x</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 再次单步调试</span></span>
<span class="line"><span style="color:#E1E4E8;">(</span><span style="color:#B392F0;">dlv</span><span style="color:#E1E4E8;">) next</span></span>
<span class="line"><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">main.main</span><span style="color:#E1E4E8;">() ./main.go:10 (</span><span style="color:#B392F0;">PC:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0x45f0f4</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">     </span><span style="color:#B392F0;">5:</span><span style="color:#E1E4E8;"> )</span></span>
<span class="line"><span style="color:#E1E4E8;">     </span><span style="color:#B392F0;">6:</span></span>
<span class="line"><span style="color:#E1E4E8;">     </span><span style="color:#B392F0;">7:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">func</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">main</span><span style="color:#E1E4E8;">() </span><span style="color:#9ECBFF;">{</span></span>
<span class="line"><span style="color:#E1E4E8;">     </span><span style="color:#B392F0;">8:</span><span style="color:#E1E4E8;">         </span><span style="color:#9ECBFF;">x</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0</span></span>
<span class="line"><span style="color:#E1E4E8;">     </span><span style="color:#B392F0;">9:</span><span style="color:#E1E4E8;">         </span><span style="color:#9ECBFF;">for</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">i</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">:=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">; </span><span style="color:#B392F0;">i</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">&lt;</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5</span><span style="color:#E1E4E8;">; </span><span style="color:#B392F0;">i++</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">{</span></span>
<span class="line"><span style="color:#E1E4E8;">=&gt;  </span><span style="color:#79B8FF;">10</span><span style="color:#9ECBFF;">:</span><span style="color:#E1E4E8;">                 </span><span style="color:#9ECBFF;">println</span><span style="color:#E1E4E8;">(</span><span style="color:#B392F0;">i</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">11:</span><span style="color:#E1E4E8;">         </span><span style="color:#9ECBFF;">}</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">12:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">}</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">13:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">14:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">//timeout</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">:=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">time.After</span><span style="color:#E1E4E8;">(time.Minute)</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">15:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">//</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 打印本地变量</span></span>
<span class="line"><span style="color:#E1E4E8;">(</span><span style="color:#B392F0;">dlv</span><span style="color:#E1E4E8;">) locals</span></span>
<span class="line"><span style="color:#B392F0;">i</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 查看堆栈信息</span></span>
<span class="line"><span style="color:#E1E4E8;">(</span><span style="color:#B392F0;">dlv</span><span style="color:#E1E4E8;">) stack</span></span>
<span class="line"><span style="color:#B392F0;">0</span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">0x000000000045f0f4</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">in</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">main.main</span></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#B392F0;">at</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">./main.go:10</span></span>
<span class="line"><span style="color:#B392F0;">1</span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">0x00000000004358b8</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">in</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">runtime.main</span></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#B392F0;">at</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/usr/local/go/src/runtime/proc.go:250</span></span>
<span class="line"><span style="color:#B392F0;">2</span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">0x000000000045c0c1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">in</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">runtime.goexit</span></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#B392F0;">at</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/usr/local/go/src/runtime/asm_amd64.s:1594</span></span>
<span class="line"><span style="color:#E1E4E8;">   </span></span>
<span class="line"><span style="color:#E1E4E8;">   </span></span>
<span class="line"><span style="color:#6A737D;"># 打印 goroutine 信息</span></span>
<span class="line"><span style="color:#E1E4E8;">(</span><span style="color:#B392F0;">dlv</span><span style="color:#E1E4E8;">) goroutine</span></span>
<span class="line"><span style="color:#B392F0;">Thread</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">27873</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">at</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">./main.go:10</span></span>
<span class="line"><span style="color:#B392F0;">Goroutine</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">1</span><span style="color:#9ECBFF;">:</span></span>
<span class="line"><span style="color:#79B8FF;">...</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 删除所有断点</span></span>
<span class="line"><span style="color:#E1E4E8;">(</span><span style="color:#B392F0;">dlv</span><span style="color:#E1E4E8;">) clearall</span></span>
<span class="line"><span style="color:#B392F0;">Breakpoint</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">cleared</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">at</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0x45f0c6</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">for</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">main.main</span><span style="color:#E1E4E8;">() </span><span style="color:#9ECBFF;">./main.go:7</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 继续执行</span></span>
<span class="line"><span style="color:#E1E4E8;">(</span><span style="color:#B392F0;">dlv</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">continue</span></span>
<span class="line"><span style="color:#B392F0;">1</span></span>
<span class="line"><span style="color:#B392F0;">2</span></span>
<span class="line"><span style="color:#B392F0;">3</span></span>
<span class="line"><span style="color:#B392F0;">4</span></span>
<span class="line"><span style="color:#B392F0;">Process</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">27873</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">has</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">exited</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">with</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">status</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 退出调试</span></span>
<span class="line"><span style="color:#E1E4E8;">(</span><span style="color:#B392F0;">dlv</span><span style="color:#E1E4E8;">) exit</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;"># 开始调试</span></span>
<span class="line"><span style="color:#6F42C1;">$</span><span style="color:#24292E;"> </span><span style="color:#032F62;">dlv</span><span style="color:#24292E;"> </span><span style="color:#032F62;">debug</span><span style="color:#24292E;"> </span><span style="color:#032F62;">main.go</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">Type</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;help&#39;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">for</span><span style="color:#24292E;"> </span><span style="color:#032F62;">list</span><span style="color:#24292E;"> </span><span style="color:#032F62;">of</span><span style="color:#24292E;"> </span><span style="color:#032F62;">commands.</span></span>
<span class="line"><span style="color:#24292E;">(</span><span style="color:#6F42C1;">dlv</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;"> </span></span>
<span class="line"><span style="color:#6A737D;"># 增加断点</span></span>
<span class="line"><span style="color:#24292E;">(</span><span style="color:#6F42C1;">dlv</span><span style="color:#24292E;">) b main.main</span></span>
<span class="line"><span style="color:#6F42C1;">Breakpoint</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">set</span><span style="color:#24292E;"> </span><span style="color:#032F62;">at</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0x45f0c6</span><span style="color:#24292E;"> </span><span style="color:#032F62;">for</span><span style="color:#24292E;"> </span><span style="color:#032F62;">main.main</span><span style="color:#24292E;">() </span><span style="color:#032F62;">./main.go:7</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 查看断点</span></span>
<span class="line"><span style="color:#24292E;">(</span><span style="color:#6F42C1;">dlv</span><span style="color:#24292E;">) bp</span></span>
<span class="line"><span style="color:#005CC5;">...</span></span>
<span class="line"><span style="color:#6F42C1;">Breakpoint</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2</span><span style="color:#24292E;"> (enabled) at 0x45f0c6 </span><span style="color:#D73A49;">for</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">main.main</span><span style="color:#24292E;">() ./main.go:7 (</span><span style="color:#6F42C1;">0</span><span style="color:#24292E;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 运行程序</span></span>
<span class="line"><span style="color:#24292E;">(</span><span style="color:#6F42C1;">dlv</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">continue</span></span>
<span class="line"><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">main.main</span><span style="color:#24292E;">() ./main.go:7 (</span><span style="color:#6F42C1;">hits</span><span style="color:#24292E;"> </span><span style="color:#032F62;">goroutine</span><span style="color:#24292E;">(</span><span style="color:#6F42C1;">1</span><span style="color:#24292E;">)</span><span style="color:#032F62;">:1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">total:1</span><span style="color:#24292E;">) (</span><span style="color:#6F42C1;">PC:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0x45f0c6</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">     </span><span style="color:#6F42C1;">2:</span></span>
<span class="line"><span style="color:#24292E;">     </span><span style="color:#6F42C1;">3:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">var</span><span style="color:#24292E;"> (</span></span>
<span class="line"><span style="color:#24292E;">     </span><span style="color:#6F42C1;">4:</span><span style="color:#24292E;">         </span><span style="color:#032F62;">x</span><span style="color:#24292E;"> </span><span style="color:#032F62;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1024</span></span>
<span class="line"><span style="color:#24292E;">     </span><span style="color:#6F42C1;">5:</span><span style="color:#24292E;"> )</span></span>
<span class="line"><span style="color:#24292E;">     </span><span style="color:#6F42C1;">6:</span></span>
<span class="line"><span style="color:#24292E;">=&gt;   </span><span style="color:#005CC5;">7</span><span style="color:#032F62;">:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">func</span><span style="color:#24292E;"> </span><span style="color:#032F62;">main</span><span style="color:#24292E;">() </span><span style="color:#032F62;">{</span></span>
<span class="line"><span style="color:#24292E;">     </span><span style="color:#6F42C1;">8:</span><span style="color:#24292E;">         </span><span style="color:#032F62;">for</span><span style="color:#24292E;"> </span><span style="color:#032F62;">i</span><span style="color:#24292E;"> </span><span style="color:#032F62;">:=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">; </span><span style="color:#6F42C1;">i</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&lt;</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5</span><span style="color:#24292E;">; </span><span style="color:#6F42C1;">i++</span><span style="color:#24292E;"> </span><span style="color:#032F62;">{</span></span>
<span class="line"><span style="color:#24292E;">     </span><span style="color:#6F42C1;">9:</span><span style="color:#24292E;">                 </span><span style="color:#032F62;">println</span><span style="color:#24292E;">(</span><span style="color:#6F42C1;">i</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">10:</span><span style="color:#24292E;">         </span><span style="color:#032F62;">}</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">11:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">}</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">12:</span></span>
<span class="line"><span style="color:#6A737D;"># 可以看到，程序停在了设置的断点上</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 打印包变量</span></span>
<span class="line"><span style="color:#24292E;">(</span><span style="color:#6F42C1;">dlv</span><span style="color:#24292E;">) vars vars main.x</span></span>
<span class="line"><span style="color:#005CC5;">...</span></span>
<span class="line"><span style="color:#6F42C1;">main.x</span><span style="color:#24292E;"> </span><span style="color:#032F62;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1024</span></span>
<span class="line"><span style="color:#005CC5;">...</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 单步调试</span></span>
<span class="line"><span style="color:#24292E;">(</span><span style="color:#6F42C1;">dlv</span><span style="color:#24292E;">) next</span></span>
<span class="line"><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">main.main</span><span style="color:#24292E;">() ./main.go:8 (</span><span style="color:#6F42C1;">PC:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0x45f0d4</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">     </span><span style="color:#6F42C1;">3:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">var</span><span style="color:#24292E;"> (</span></span>
<span class="line"><span style="color:#24292E;">     </span><span style="color:#6F42C1;">4:</span><span style="color:#24292E;">         </span><span style="color:#032F62;">x</span><span style="color:#24292E;"> </span><span style="color:#032F62;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1024</span></span>
<span class="line"><span style="color:#24292E;">     </span><span style="color:#6F42C1;">5:</span><span style="color:#24292E;"> )</span></span>
<span class="line"><span style="color:#24292E;">     </span><span style="color:#6F42C1;">6:</span></span>
<span class="line"><span style="color:#24292E;">     </span><span style="color:#6F42C1;">7:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">func</span><span style="color:#24292E;"> </span><span style="color:#032F62;">main</span><span style="color:#24292E;">() </span><span style="color:#032F62;">{</span></span>
<span class="line"><span style="color:#24292E;">=&gt;   </span><span style="color:#005CC5;">8</span><span style="color:#032F62;">:</span><span style="color:#24292E;">         </span><span style="color:#032F62;">x</span><span style="color:#24292E;"> </span><span style="color:#032F62;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0</span></span>
<span class="line"><span style="color:#24292E;">     </span><span style="color:#6F42C1;">9:</span><span style="color:#24292E;">         </span><span style="color:#032F62;">for</span><span style="color:#24292E;"> </span><span style="color:#032F62;">i</span><span style="color:#24292E;"> </span><span style="color:#032F62;">:=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">; </span><span style="color:#6F42C1;">i</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&lt;</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5</span><span style="color:#24292E;">; </span><span style="color:#6F42C1;">i++</span><span style="color:#24292E;"> </span><span style="color:#032F62;">{</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">10:</span><span style="color:#24292E;">                 </span><span style="color:#032F62;">println</span><span style="color:#24292E;">(</span><span style="color:#6F42C1;">i</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">11:</span><span style="color:#24292E;">         </span><span style="color:#032F62;">}</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">12:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">}</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">13:</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 再次单步调试</span></span>
<span class="line"><span style="color:#24292E;">(</span><span style="color:#6F42C1;">dlv</span><span style="color:#24292E;">) next</span></span>
<span class="line"><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">main.main</span><span style="color:#24292E;">() ./main.go:9 (</span><span style="color:#6F42C1;">PC:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0x45f0df</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">     </span><span style="color:#6F42C1;">4:</span><span style="color:#24292E;">         </span><span style="color:#032F62;">x</span><span style="color:#24292E;"> </span><span style="color:#032F62;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1024</span></span>
<span class="line"><span style="color:#24292E;">     </span><span style="color:#6F42C1;">5:</span><span style="color:#24292E;"> )</span></span>
<span class="line"><span style="color:#24292E;">     </span><span style="color:#6F42C1;">6:</span></span>
<span class="line"><span style="color:#24292E;">     </span><span style="color:#6F42C1;">7:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">func</span><span style="color:#24292E;"> </span><span style="color:#032F62;">main</span><span style="color:#24292E;">() </span><span style="color:#032F62;">{</span></span>
<span class="line"><span style="color:#24292E;">     </span><span style="color:#6F42C1;">8:</span><span style="color:#24292E;">         </span><span style="color:#032F62;">x</span><span style="color:#24292E;"> </span><span style="color:#032F62;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0</span></span>
<span class="line"><span style="color:#24292E;">=&gt;   </span><span style="color:#005CC5;">9</span><span style="color:#032F62;">:</span><span style="color:#24292E;">         </span><span style="color:#032F62;">for</span><span style="color:#24292E;"> </span><span style="color:#032F62;">i</span><span style="color:#24292E;"> </span><span style="color:#032F62;">:=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">; </span><span style="color:#6F42C1;">i</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&lt;</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5</span><span style="color:#24292E;">; </span><span style="color:#6F42C1;">i++</span><span style="color:#24292E;"> </span><span style="color:#032F62;">{</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">10:</span><span style="color:#24292E;">                 </span><span style="color:#032F62;">println</span><span style="color:#24292E;">(</span><span style="color:#6F42C1;">i</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">11:</span><span style="color:#24292E;">         </span><span style="color:#032F62;">}</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">12:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">}</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">13:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">14:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">//timeout</span><span style="color:#24292E;"> </span><span style="color:#032F62;">:=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">time.After</span><span style="color:#24292E;">(time.Minute)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 可以看到，程序停在了循环语句</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 打印包变量</span></span>
<span class="line"><span style="color:#24292E;">(</span><span style="color:#6F42C1;">dlv</span><span style="color:#24292E;">) vars main.x</span></span>
<span class="line"><span style="color:#6F42C1;">main.x</span><span style="color:#24292E;"> </span><span style="color:#032F62;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 再次单步调试</span></span>
<span class="line"><span style="color:#24292E;">(</span><span style="color:#6F42C1;">dlv</span><span style="color:#24292E;">) next</span></span>
<span class="line"><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">main.main</span><span style="color:#24292E;">() ./main.go:10 (</span><span style="color:#6F42C1;">PC:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0x45f0f4</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">     </span><span style="color:#6F42C1;">5:</span><span style="color:#24292E;"> )</span></span>
<span class="line"><span style="color:#24292E;">     </span><span style="color:#6F42C1;">6:</span></span>
<span class="line"><span style="color:#24292E;">     </span><span style="color:#6F42C1;">7:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">func</span><span style="color:#24292E;"> </span><span style="color:#032F62;">main</span><span style="color:#24292E;">() </span><span style="color:#032F62;">{</span></span>
<span class="line"><span style="color:#24292E;">     </span><span style="color:#6F42C1;">8:</span><span style="color:#24292E;">         </span><span style="color:#032F62;">x</span><span style="color:#24292E;"> </span><span style="color:#032F62;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0</span></span>
<span class="line"><span style="color:#24292E;">     </span><span style="color:#6F42C1;">9:</span><span style="color:#24292E;">         </span><span style="color:#032F62;">for</span><span style="color:#24292E;"> </span><span style="color:#032F62;">i</span><span style="color:#24292E;"> </span><span style="color:#032F62;">:=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">; </span><span style="color:#6F42C1;">i</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&lt;</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5</span><span style="color:#24292E;">; </span><span style="color:#6F42C1;">i++</span><span style="color:#24292E;"> </span><span style="color:#032F62;">{</span></span>
<span class="line"><span style="color:#24292E;">=&gt;  </span><span style="color:#005CC5;">10</span><span style="color:#032F62;">:</span><span style="color:#24292E;">                 </span><span style="color:#032F62;">println</span><span style="color:#24292E;">(</span><span style="color:#6F42C1;">i</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">11:</span><span style="color:#24292E;">         </span><span style="color:#032F62;">}</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">12:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">}</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">13:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">14:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">//timeout</span><span style="color:#24292E;"> </span><span style="color:#032F62;">:=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">time.After</span><span style="color:#24292E;">(time.Minute)</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">15:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">//</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 打印本地变量</span></span>
<span class="line"><span style="color:#24292E;">(</span><span style="color:#6F42C1;">dlv</span><span style="color:#24292E;">) locals</span></span>
<span class="line"><span style="color:#6F42C1;">i</span><span style="color:#24292E;"> </span><span style="color:#032F62;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 查看堆栈信息</span></span>
<span class="line"><span style="color:#24292E;">(</span><span style="color:#6F42C1;">dlv</span><span style="color:#24292E;">) stack</span></span>
<span class="line"><span style="color:#6F42C1;">0</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">0x000000000045f0f4</span><span style="color:#24292E;"> </span><span style="color:#032F62;">in</span><span style="color:#24292E;"> </span><span style="color:#032F62;">main.main</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#6F42C1;">at</span><span style="color:#24292E;"> </span><span style="color:#032F62;">./main.go:10</span></span>
<span class="line"><span style="color:#6F42C1;">1</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">0x00000000004358b8</span><span style="color:#24292E;"> </span><span style="color:#032F62;">in</span><span style="color:#24292E;"> </span><span style="color:#032F62;">runtime.main</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#6F42C1;">at</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/usr/local/go/src/runtime/proc.go:250</span></span>
<span class="line"><span style="color:#6F42C1;">2</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">0x000000000045c0c1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">in</span><span style="color:#24292E;"> </span><span style="color:#032F62;">runtime.goexit</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#6F42C1;">at</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/usr/local/go/src/runtime/asm_amd64.s:1594</span></span>
<span class="line"><span style="color:#24292E;">   </span></span>
<span class="line"><span style="color:#24292E;">   </span></span>
<span class="line"><span style="color:#6A737D;"># 打印 goroutine 信息</span></span>
<span class="line"><span style="color:#24292E;">(</span><span style="color:#6F42C1;">dlv</span><span style="color:#24292E;">) goroutine</span></span>
<span class="line"><span style="color:#6F42C1;">Thread</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">27873</span><span style="color:#24292E;"> </span><span style="color:#032F62;">at</span><span style="color:#24292E;"> </span><span style="color:#032F62;">./main.go:10</span></span>
<span class="line"><span style="color:#6F42C1;">Goroutine</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1</span><span style="color:#032F62;">:</span></span>
<span class="line"><span style="color:#005CC5;">...</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 删除所有断点</span></span>
<span class="line"><span style="color:#24292E;">(</span><span style="color:#6F42C1;">dlv</span><span style="color:#24292E;">) clearall</span></span>
<span class="line"><span style="color:#6F42C1;">Breakpoint</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">cleared</span><span style="color:#24292E;"> </span><span style="color:#032F62;">at</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0x45f0c6</span><span style="color:#24292E;"> </span><span style="color:#032F62;">for</span><span style="color:#24292E;"> </span><span style="color:#032F62;">main.main</span><span style="color:#24292E;">() </span><span style="color:#032F62;">./main.go:7</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 继续执行</span></span>
<span class="line"><span style="color:#24292E;">(</span><span style="color:#6F42C1;">dlv</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">continue</span></span>
<span class="line"><span style="color:#6F42C1;">1</span></span>
<span class="line"><span style="color:#6F42C1;">2</span></span>
<span class="line"><span style="color:#6F42C1;">3</span></span>
<span class="line"><span style="color:#6F42C1;">4</span></span>
<span class="line"><span style="color:#6F42C1;">Process</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">27873</span><span style="color:#24292E;"> </span><span style="color:#032F62;">has</span><span style="color:#24292E;"> </span><span style="color:#032F62;">exited</span><span style="color:#24292E;"> </span><span style="color:#032F62;">with</span><span style="color:#24292E;"> </span><span style="color:#032F62;">status</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 退出调试</span></span>
<span class="line"><span style="color:#24292E;">(</span><span style="color:#6F42C1;">dlv</span><span style="color:#24292E;">) exit</span></span></code></pre></div><h2 id="与-ide-集成" tabindex="-1">与 IDE 集成 <a class="header-anchor" href="#与-ide-集成" aria-label="Permalink to &quot;与 IDE 集成&quot;">​</a></h2><p><code>Delve</code> 支持以插件的形式集成到主流的 IDE 里面，具体的支持列表请看 <a href="https://github.com/go-delve/delve/blob/master/Documentation/EditorIntegration.md" target="_blank" rel="noreferrer">这个页面</a>。</p><h2 id="常见问题" tabindex="-1">常见问题 <a class="header-anchor" href="#常见问题" aria-label="Permalink to &quot;常见问题&quot;">​</a></h2><h3 id="单点调试总是执行非预期的代码" tabindex="-1">单点调试总是执行非预期的代码？ <a class="header-anchor" href="#单点调试总是执行非预期的代码" aria-label="Permalink to &quot;单点调试总是执行非预期的代码？&quot;">​</a></h3><p><strong>一般是被编译器优化了，比如内联会导致 dlv 单步调试无法打印某些变量，解决方法是禁止编译优化。</strong></p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;"># 禁用内联和优化 (细节可以阅读引用文章列表)</span></span>
<span class="line"><span style="color:#B392F0;">go</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">run</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-gcflags</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;-N -l&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">main.go</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;"># 禁用内联和优化 (细节可以阅读引用文章列表)</span></span>
<span class="line"><span style="color:#6F42C1;">go</span><span style="color:#24292E;"> </span><span style="color:#032F62;">run</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-gcflags</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;-N -l&quot;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">main.go</span></span></code></pre></div><h2 id="reference" tabindex="-1">Reference <a class="header-anchor" href="#reference" aria-label="Permalink to &quot;Reference&quot;">​</a></h2><ul><li><a href="https://github.com/go-delve/delve" target="_blank" rel="noreferrer">go-delve/delve</a></li><li><a href="https://github.com/duanbiaowu/go-examples-for-beginners/blob/master/performance/stack_dump.md" target="_blank" rel="noreferrer">高效获取堆栈调用信息</a></li><li><a href="https://golang.dbwu.tech/performance/inline/" target="_blank" rel="noreferrer">内联优化</a></li><li><a href="https://dbwu.tech/posts/goland_escape/" target="_blank" rel="noreferrer">逃逸分析</a></li><li><a href="https://mp.weixin.qq.com/s/OXpWRiCHcxpFlylUk3RDEA" target="_blank" rel="noreferrer">golang 调试分析的高阶技巧</a></li></ul><h2 id="扩展阅读" tabindex="-1">扩展阅读 <a class="header-anchor" href="#扩展阅读" aria-label="Permalink to &quot;扩展阅读&quot;">​</a></h2><ul><li><a href="https://xargin.com/how-to-locate-for-block-in-golang/" target="_blank" rel="noreferrer">如何定位 golang 进程 hang 死的 bug</a></li><li><a href="https://sourceware.org/gdb/current/onlinedocs/gdb.html/" target="_blank" rel="noreferrer">Debugging with GDB</a></li><li><a href="https://github.com/hellogcc/100-gdb-tips" target="_blank" rel="noreferrer">100-gdb-tips</a></li><li><a href="https://colobu.com/2016/07/04/dive-into-go-11/" target="_blank" rel="noreferrer">深入 Go 语言 - 11</a></li><li><a href="https://gist.github.com/abel0b/b1881e41b9e1c4b16d84e5e083c38a13" target="_blank" rel="noreferrer">WSL2 安装 perf</a></li><li><a href="https://mp.weixin.qq.com/s/f46xUA8Bxv66wH_cMYf9Ig" target="_blank" rel="noreferrer">学习大佬使用 Delve 高效调试</a></li></ul>`,51),e=[o];function t(c,r,E,y,i,F){return n(),a("div",null,e)}const B=s(p,[["render",t]]);export{C as __pageData,B as default};
