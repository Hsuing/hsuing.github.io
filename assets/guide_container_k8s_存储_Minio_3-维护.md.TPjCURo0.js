import{_ as s,o as a,c as n,R as l}from"./chunks/framework.zUbWieqp.js";const F=JSON.parse('{"title":"1. 卸载 minio 操作","description":"","frontmatter":{},"headers":[],"relativePath":"guide/container/k8s/存储/Minio/3-维护.md","filePath":"guide/container/k8s/存储/Minio/3-维护.md","lastUpdated":1721309786000}'),p={name:"guide/container/k8s/存储/Minio/3-维护.md"},o=l(`<h1 id="_1-卸载-minio-操作" tabindex="-1">1. 卸载 minio 操作 <a class="header-anchor" href="#_1-卸载-minio-操作" aria-label="Permalink to &quot;1. 卸载 minio 操作&quot;">​</a></h1><h2 id="_1-1-查看当前的tenant" tabindex="-1">1.1 查看当前的tenant <a class="header-anchor" href="#_1-1-查看当前的tenant" aria-label="Permalink to &quot;1.1 查看当前的tenant&quot;">​</a></h2><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">[root@kube-master minio]#  kubectl minio tenant list</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">Tenant</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;minio-1&#39;,</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Namespace</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;minio-tenant-1&#39;,</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Total</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">capacity</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">12</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">GiB</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">Current</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">status:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Initialized</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">MinIO</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">version:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">registry.cn-zhangjiakou.aliyuncs.com/hsuing/minio:RELEASE.2023-04-20T17-56-55Z</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">[root@kube-master minio]#  kubectl minio tenant list</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">Tenant</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;minio-1&#39;,</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Namespace</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;minio-tenant-1&#39;,</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Total</span><span style="color:#24292E;"> </span><span style="color:#032F62;">capacity</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">12</span><span style="color:#24292E;"> </span><span style="color:#032F62;">GiB</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">Current</span><span style="color:#24292E;"> </span><span style="color:#032F62;">status:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Initialized</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">MinIO</span><span style="color:#24292E;"> </span><span style="color:#032F62;">version:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">registry.cn-zhangjiakou.aliyuncs.com/hsuing/minio:RELEASE.2023-04-20T17-56-55Z</span></span></code></pre></div><h2 id="_1-2-卸载minio" tabindex="-1">1.2 卸载minio <a class="header-anchor" href="#_1-2-卸载minio" aria-label="Permalink to &quot;1.2 卸载minio&quot;">​</a></h2><h3 id="_1-2-1-清理minio租户" tabindex="-1">1.2.1 清理minio租户 <a class="header-anchor" href="#_1-2-1-清理minio租户" aria-label="Permalink to &quot;1.2.1 清理minio租户&quot;">​</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">minio</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">tenant</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">delete</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">tenent_nam</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-n</span><span style="color:#E1E4E8;"> </span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#如</span></span>
<span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">minio</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">tenant</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">delete</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">minio-tenant-1</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--namespace</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">minio-tenant-1</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">minio</span><span style="color:#24292E;"> </span><span style="color:#032F62;">tenant</span><span style="color:#24292E;"> </span><span style="color:#032F62;">delete</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">tenent_nam</span><span style="color:#24292E;">e</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-n</span><span style="color:#24292E;"> </span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#如</span></span>
<span class="line"><span style="color:#6F42C1;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">minio</span><span style="color:#24292E;"> </span><span style="color:#032F62;">tenant</span><span style="color:#24292E;"> </span><span style="color:#032F62;">delete</span><span style="color:#24292E;"> </span><span style="color:#032F62;">minio-tenant-1</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--namespace</span><span style="color:#24292E;"> </span><span style="color:#032F62;">minio-tenant-1</span></span></code></pre></div><h3 id="_1-2-2-删除pvc、pv" tabindex="-1">1.2.2 删除pvc、pv <a class="header-anchor" href="#_1-2-2-删除pvc、pv" aria-label="Permalink to &quot;1.2.2 删除pvc、pv&quot;">​</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">delete</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pvc</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--all</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-n</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">namespac</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span></span>
<span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">delete</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pv</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--all</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-n</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">namespac</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">delete</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pvc</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--all</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-n</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">namespac</span><span style="color:#24292E;">e</span><span style="color:#D73A49;">&gt;</span></span>
<span class="line"><span style="color:#6F42C1;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">delete</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pv</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--all</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-n</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">namespac</span><span style="color:#24292E;">e</span><span style="color:#D73A49;">&gt;</span></span></code></pre></div><blockquote><p>在每个节点将/data/minio目录删除，重新创建</p></blockquote><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">ls -al</span></span>
<span class="line"><span style="color:#e1e4e8;">total 0</span></span>
<span class="line"><span style="color:#e1e4e8;">drwxrwsrwx 3 root      1000  24 Apr 24 10:52 .</span></span>
<span class="line"><span style="color:#e1e4e8;">drwxrwxrwx 6 root      root  50 Apr 22 17:00 ..</span></span>
<span class="line"><span style="color:#e1e4e8;">drwxrwsrwx 9 adminuser 1000 124 Apr 25 10:36 .minio.sys</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">ls -al</span></span>
<span class="line"><span style="color:#24292e;">total 0</span></span>
<span class="line"><span style="color:#24292e;">drwxrwsrwx 3 root      1000  24 Apr 24 10:52 .</span></span>
<span class="line"><span style="color:#24292e;">drwxrwxrwx 6 root      root  50 Apr 22 17:00 ..</span></span>
<span class="line"><span style="color:#24292e;">drwxrwsrwx 9 adminuser 1000 124 Apr 25 10:36 .minio.sys</span></span></code></pre></div><h3 id="_1-2-3-删除命名空间" tabindex="-1">1.2.3 删除命名空间 <a class="header-anchor" href="#_1-2-3-删除命名空间" aria-label="Permalink to &quot;1.2.3 删除命名空间&quot;">​</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">delete</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">ns</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">minio-tenant-1</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">delete</span><span style="color:#24292E;"> </span><span style="color:#032F62;">ns</span><span style="color:#24292E;"> </span><span style="color:#032F62;">minio-tenant-1</span></span></code></pre></div><h3 id="_1-2-4-清理minio-operator" tabindex="-1">1.2.4 清理minio-operator <a class="header-anchor" href="#_1-2-4-清理minio-operator" aria-label="Permalink to &quot;1.2.4 清理minio-operator&quot;">​</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">minio</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">delete</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--namespace</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">minio-operator</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">minio</span><span style="color:#24292E;"> </span><span style="color:#032F62;">delete</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--namespace</span><span style="color:#24292E;"> </span><span style="color:#032F62;">minio-operator</span></span></code></pre></div><h1 id="_2-水平扩容" tabindex="-1">2. 水平扩容 <a class="header-anchor" href="#_2-水平扩容" aria-label="Permalink to &quot;2. 水平扩容&quot;">​</a></h1><p><strong>水平扩容，一般指通过增加节点数扩展系统性能；</strong><code>推荐</code></p><p>水平扩容分为:<code>对等扩容</code>和<code>联邦扩容</code></p><h2 id="_2-0-对等扩容" tabindex="-1">2.0 对等扩容 <a class="header-anchor" href="#_2-0-对等扩容" aria-label="Permalink to &quot;2.0 对等扩容&quot;">​</a></h2><p>MinIO的极简设计理念使得MinIO分布式集群<strong>并不支持向集群中添加单个节点并进行自动调节的扩容方式</strong>，这是<strong>因为加入单个节点后所引发的数据均衡以及纠删组划分等问题会为整个集群带来复杂的调度和处理过程</strong>，并不利于维护。因此，MinIO提供了一种对等扩容的方式，即要求增加的节点数和磁盘数均需与原集群保持对等</p><p>优点:</p><p>对等扩容的优点在于配置操作简单易行，通过一条命令即可完成扩容（注意：推荐使用连续的节点IP，并参照MinIO官网在扩容命令中使用{}）。</p><p>缺点:</p><p>对等扩容的局限性在于：①扩容需重启；②扩容存在限制，集群节点数一般不超过32个，这是由于MinIO集群通过分布式锁保证强一致性，若集群节点数过大，维护强一致性将带来性能问题。</p><p><a href="https://min.io/docs/minio/linux/operations/install-deploy-manage/expand-minio-deployment.html#expand-minio-distributed" target="_blank" rel="noreferrer">扩容</a></p><blockquote><p><strong>水平扩容举例：</strong></p><p>例如原集群包含4个节点4块磁盘，则在扩容时必须同样增加4个节点4块磁盘（或为其倍数），以便系统维持相同的数据冗余SLA，从而极大地降低扩容的复杂性。如上例，在扩容后，MinIO集群并不会对全部的8个节点进行完全的数据均衡，而是将原本的4个节点视作一个区域，新加入的4节点视作另一区域，当有新对象上传时，集群将依据各区域的可用空间比例确定存放区域，在各区域内仍旧通过哈希算法确定对应的纠删组进行最终的存放。此外，集群进行一次对等扩容后，还可依据扩容规则继续进行对等扩容，但出于安全性考虑，集群的最大节点数一般不得超过32个</p></blockquote><p>要求扩容的机器和硬盘是原来的倍数。</p><p>假设新增4台服务器，每台4块硬盘，每块硬盘1T，给新的服务器的每一个硬盘创建pv，参考部署步骤。</p><h2 id="_2-1-准备磁盘" tabindex="-1">2.1 准备磁盘 <a class="header-anchor" href="#_2-1-准备磁盘" aria-label="Permalink to &quot;2.1 准备磁盘&quot;">​</a></h2><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">mkfs.xfs</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/dev/sdb</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-L</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">MINIO-DISK1</span></span>
<span class="line"><span style="color:#B392F0;">mkfs.xfs</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/dev/sdc</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-L</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">MINIO-DISK2</span></span>
<span class="line"><span style="color:#B392F0;">mkfs.xfs</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/dev/sdd</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-L</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">MINIO-DISK3</span></span>
<span class="line"><span style="color:#B392F0;">mkfs.xfs</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/dev/sde</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-L</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">MINIO-DISK4</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">mkfs.xfs</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/dev/sdb</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-L</span><span style="color:#24292E;"> </span><span style="color:#032F62;">MINIO-DISK1</span></span>
<span class="line"><span style="color:#6F42C1;">mkfs.xfs</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/dev/sdc</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-L</span><span style="color:#24292E;"> </span><span style="color:#032F62;">MINIO-DISK2</span></span>
<span class="line"><span style="color:#6F42C1;">mkfs.xfs</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/dev/sdd</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-L</span><span style="color:#24292E;"> </span><span style="color:#032F62;">MINIO-DISK3</span></span>
<span class="line"><span style="color:#6F42C1;">mkfs.xfs</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/dev/sde</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-L</span><span style="color:#24292E;"> </span><span style="color:#032F62;">MINIO-DISK4</span></span></code></pre></div><h2 id="_2-2-创建pv" tabindex="-1">2.2 创建pv <a class="header-anchor" href="#_2-2-创建pv" aria-label="Permalink to &quot;2.2 创建pv&quot;">​</a></h2><p>...</p><h2 id="_2-3-扩容" tabindex="-1">2.3 扩容 <a class="header-anchor" href="#_2-3-扩容" aria-label="Permalink to &quot;2.3 扩容&quot;">​</a></h2><h3 id="_2-3-1-命令行" tabindex="-1">2.3.1 命令行 <a class="header-anchor" href="#_2-3-1-命令行" aria-label="Permalink to &quot;2.3.1 命令行&quot;">​</a></h3><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">kubectl minio tenant expand minio-tenant-1   \\</span></span>
<span class="line"><span style="color:#e1e4e8;">  --servers                 4                \\</span></span>
<span class="line"><span style="color:#e1e4e8;">  --volumes                 16               \\</span></span>
<span class="line"><span style="color:#e1e4e8;">  --capacity                16Ti             \\</span></span>
<span class="line"><span style="color:#e1e4e8;">  --storage-class           minio-local-storage    \\</span></span>
<span class="line"><span style="color:#e1e4e8;">  --namespace               minio-tenant-1</span></span>
<span class="line"><span style="color:#e1e4e8;">  </span></span>
<span class="line"><span style="color:#e1e4e8;"> # 查看扩容后的情况</span></span>
<span class="line"><span style="color:#e1e4e8;"> kubectl minio tenant info minio-tenant-1 \\</span></span>
<span class="line"><span style="color:#e1e4e8;">  --namespace minio-tenant-1</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">kubectl minio tenant expand minio-tenant-1   \\</span></span>
<span class="line"><span style="color:#24292e;">  --servers                 4                \\</span></span>
<span class="line"><span style="color:#24292e;">  --volumes                 16               \\</span></span>
<span class="line"><span style="color:#24292e;">  --capacity                16Ti             \\</span></span>
<span class="line"><span style="color:#24292e;">  --storage-class           minio-local-storage    \\</span></span>
<span class="line"><span style="color:#24292e;">  --namespace               minio-tenant-1</span></span>
<span class="line"><span style="color:#24292e;">  </span></span>
<span class="line"><span style="color:#24292e;"> # 查看扩容后的情况</span></span>
<span class="line"><span style="color:#24292e;"> kubectl minio tenant info minio-tenant-1 \\</span></span>
<span class="line"><span style="color:#24292e;">  --namespace minio-tenant-1</span></span></code></pre></div><h3 id="_2-3-2-图形界面" tabindex="-1">2.3.2 图形界面 <a class="header-anchor" href="#_2-3-2-图形界面" aria-label="Permalink to &quot;2.3.2 图形界面&quot;">​</a></h3><p>1.点击pools</p><p><img src="https://nnaigos.oss-cn-hangzhou.aliyuncs.com/imgs/202407171442226.png" alt="image-20240717144219852"></p><h1 id="_3-垂直扩容" tabindex="-1">3. 垂直扩容 <a class="header-anchor" href="#_3-垂直扩容" aria-label="Permalink to &quot;3. 垂直扩容&quot;">​</a></h1><p><strong>垂直扩容则指提升各节点自身的性能，例如增加节点的磁盘存储空间</strong></p><p>直接采用垂直扩容方式扩容MinIO集群的节点磁盘空间，会为集群运行带来若干问题，官方也并<code>不推荐</code></p><h1 id="_4-数据恢复" tabindex="-1">4. 数据恢复 <a class="header-anchor" href="#_4-数据恢复" aria-label="Permalink to &quot;4. 数据恢复&quot;">​</a></h1><h2 id="_4-1-磁盘损坏" tabindex="-1">4.1 磁盘损坏 <a class="header-anchor" href="#_4-1-磁盘损坏" aria-label="Permalink to &quot;4.1 磁盘损坏&quot;">​</a></h2><p>当磁盘损坏时，只需更换新磁盘，minio会自动修复，具体步骤如下：</p><h3 id="_4-1-1-卸载损坏的磁盘" tabindex="-1">4.1.1 卸载损坏的磁盘 <a class="header-anchor" href="#_4-1-1-卸载损坏的磁盘" aria-label="Permalink to &quot;4.1.1 卸载损坏的磁盘&quot;">​</a></h3><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;"># 假设损坏的磁盘是/dev/sdb</span></span>
<span class="line"><span style="color:#e1e4e8;">umount /dev/sdb</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;"># 假设损坏的磁盘是/dev/sdb</span></span>
<span class="line"><span style="color:#24292e;">umount /dev/sdb</span></span></code></pre></div><ul><li>换上新的磁盘，格式化并挂载</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;"># 根据实际情况修改命令</span></span>
<span class="line"><span style="color:#B392F0;">mkfs.xfs</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/dev/sdb</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-L</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">MINIO-DISK1</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># vim /etc/fstab</span></span>
<span class="line"><span style="color:#E1E4E8;">LABEL</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">MINIO-DISK1</span><span style="color:#E1E4E8;">      </span><span style="color:#B392F0;">/data/minio-data-1</span><span style="color:#E1E4E8;">     </span><span style="color:#9ECBFF;">xfs</span><span style="color:#E1E4E8;">     </span><span style="color:#9ECBFF;">defaults,noatime</span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">0</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 挂载</span></span>
<span class="line"><span style="color:#B392F0;">mount</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-a</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;"># 根据实际情况修改命令</span></span>
<span class="line"><span style="color:#6F42C1;">mkfs.xfs</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/dev/sdb</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-L</span><span style="color:#24292E;"> </span><span style="color:#032F62;">MINIO-DISK1</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># vim /etc/fstab</span></span>
<span class="line"><span style="color:#24292E;">LABEL</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">MINIO-DISK1</span><span style="color:#24292E;">      </span><span style="color:#6F42C1;">/data/minio-data-1</span><span style="color:#24292E;">     </span><span style="color:#032F62;">xfs</span><span style="color:#24292E;">     </span><span style="color:#032F62;">defaults,noatime</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">0</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 挂载</span></span>
<span class="line"><span style="color:#6F42C1;">mount</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-a</span></span></code></pre></div><h3 id="_4-1-2-观察过程" tabindex="-1">4.1.2 观察过程 <a class="header-anchor" href="#_4-1-2-观察过程" aria-label="Permalink to &quot;4.1.2 观察过程&quot;">​</a></h3><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">mc admin console</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">mc admin console</span></span></code></pre></div><blockquote><p>minio会自动发现新的磁盘并修复数据</p></blockquote><ul><li>修复</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">mc</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">admin</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">heal</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">mc</span><span style="color:#24292E;"> </span><span style="color:#032F62;">admin</span><span style="color:#24292E;"> </span><span style="color:#032F62;">heal</span></span></code></pre></div><h2 id="_4-2-节点损坏" tabindex="-1">4.2 节点损坏 <a class="header-anchor" href="#_4-2-节点损坏" aria-label="Permalink to &quot;4.2 节点损坏&quot;">​</a></h2><p>节点损坏是指整个服务器损坏无法使用，只需给该节点装好系统，将节点加入原k8s集群，然后按照修复磁盘的步骤修复即可</p><h1 id="_5-升级" tabindex="-1">5. 升级 <a class="header-anchor" href="#_5-升级" aria-label="Permalink to &quot;5. 升级&quot;">​</a></h1><h2 id="_5-1-升级minio" tabindex="-1">5.1 升级minio <a class="header-anchor" href="#_5-1-升级minio" aria-label="Permalink to &quot;5.1 升级minio&quot;">​</a></h2><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">minio</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">tenant</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">upgrade</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">minio-tenant-1</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#E1E4E8;">--namespace </span><span style="color:#9ECBFF;">minio-tenant-1</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#E1E4E8;">--image </span><span style="color:#9ECBFF;">minio/minio:RELEASE.2023-04-20T17-56-55Z</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">minio</span><span style="color:#24292E;"> </span><span style="color:#032F62;">tenant</span><span style="color:#24292E;"> </span><span style="color:#032F62;">upgrade</span><span style="color:#24292E;"> </span><span style="color:#032F62;">minio-tenant-1</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#24292E;">--namespace </span><span style="color:#032F62;">minio-tenant-1</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#24292E;">--image </span><span style="color:#032F62;">minio/minio:RELEASE.2023-04-20T17-56-55Z</span></span></code></pre></div><blockquote><p>RELEASE.2023-04-20T17-56-55Z 根据版本进行选择</p></blockquote>`,58),e=[o];function t(c,r,i,y,E,d){return a(),n("div",null,e)}const m=s(p,[["render",t]]);export{F as __pageData,m as default};
