import{_ as s,o as n,c as e,R as a}from"./chunks/framework.zUbWieqp.js";const b=JSON.parse('{"title":"1. kubelet配置文件","description":"","frontmatter":{},"headers":[],"relativePath":"guide/container/k8s/binary/6-kubelet-conf.md","filePath":"guide/container/k8s/binary/6-kubelet-conf.md","lastUpdated":1730888659000}'),o={name:"guide/container/k8s/binary/6-kubelet-conf.md"},l=a(`<h1 id="_1-kubelet配置文件" tabindex="-1">1. kubelet配置文件 <a class="header-anchor" href="#_1-kubelet配置文件" aria-label="Permalink to &quot;1. kubelet配置文件&quot;">​</a></h1><h2 id="_1-1-启动参数" tabindex="-1">1.1 启动参数 <a class="header-anchor" href="#_1-1-启动参数" aria-label="Permalink to &quot;1.1 启动参数&quot;">​</a></h2><p><a href="https://kubernetes.io/docs/reference/command-line-tools-reference/kubelet/" target="_blank" rel="noreferrer">https://kubernetes.io/docs/reference/command-line-tools-reference/kubelet/</a></p><p>比如ack配置：</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">[root@iZj6c9xktnoxcwok6asqa9Z kubelet.service.d]# cat 10-kubeadm.conf</span></span>
<span class="line"><span style="color:#E1E4E8;">[Service]</span></span>
<span class="line"><span style="color:#E1E4E8;">EnvironmentFile</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">-/etc/kubernetes/kubelet-customized-args.conf</span></span>
<span class="line"><span style="color:#E1E4E8;">Environment</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&quot;KUBELET_KUBECONFIG_ARGS=--bootstrap-kubeconfig=/etc/kubernetes/bootstrap-kubelet.conf --kubeconfig=/etc/kubernetes/kubelet.conf&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">Environment</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&quot;KUBELET_SYSTEM_PODS_ARGS=--max-pods 23 --pod-max-pids 16384 --pod-manifest-path=/etc/kubernetes/manifests&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">Environment</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&quot;KUBELET_NETWORK_ARGS=--network-plugin=cni --cni-conf-dir=/etc/cni/net.d --cni-bin-dir=/opt/cni/bin --dynamic-config-dir=/etc/kubernetes/kubelet-config --v=3&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">Environment</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&quot;KUBELET_DNS_ARGS=--enable-controller-attach-detach=true --cluster-dns=192.168.0.10         --pod-infra-container-image=registry-vpc.cn-hongkong.aliyuncs.com/acs/pause:3.2</span></span>
<span class="line"><span style="color:#9ECBFF;">--enable-load-reader --cluster-domain=demo.local --cloud-provider=external         --hostname-override=cn-hongkong.172.31.34.242 --provider-id=cn-hongkong.i-j6c9xktnoxcwok6asqa9&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">Environment</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&quot;KUBELET_AUTHZ_ARGS=--authorization-mode=Webhook --authentication-token-webhook=true --anonymous-auth=false --client-ca-file=/etc/kubernetes/pki/ca.crt&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">Environment</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&quot;KUBELET_CGROUP_ARGS=--cgroup-driver=systemd&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">Environment</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&quot;KUBELET_CERTIFICATE_ARGS=--tls-cipher-suites=TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_R</span></span>
<span class="line"><span style="color:#9ECBFF;">SA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_RSA_WITH_AES_256_GCM_SHA384,TLS_RSA_WITH_AES_128_GCM_SHA256 --tls-cert-file=/v</span></span>
<span class="line"><span style="color:#9ECBFF;">ar/lib/kubelet/pki/kubelet.crt --tls-private-key-file=/var/lib/kubelet/pki/kubelet.key --rotate-certificates=true --cert-dir=/var/lib/kubelet/pki&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">ExecStart</span><span style="color:#F97583;">=</span></span>
<span class="line"><span style="color:#E1E4E8;">ExecStart</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">/usr/bin/kubelet</span><span style="color:#E1E4E8;"> $KUBELET_KUBECONFIG_ARGS $KUBELET_SYSTEM_PODS_ARGS $KUBELET_NETWORK_ARGS $KUBELET_DNS_ARGS $KUBELET_AUTHZ_ARGS $KUBELET_CGROUP_ARGS $KUBELET_CERTIFICATE_ARGS $</span></span>
<span class="line"><span style="color:#B392F0;">KUBELET_EXTRA_ARGS</span><span style="color:#E1E4E8;"> $KUBELET_CUSTOMIZED_ARGS</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">[root@iZj6c9xktnoxcwok6asqa9Z kubelet.service.d]# cat 10-kubeadm.conf</span></span>
<span class="line"><span style="color:#24292E;">[Service]</span></span>
<span class="line"><span style="color:#24292E;">EnvironmentFile</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">-/etc/kubernetes/kubelet-customized-args.conf</span></span>
<span class="line"><span style="color:#24292E;">Environment</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&quot;KUBELET_KUBECONFIG_ARGS=--bootstrap-kubeconfig=/etc/kubernetes/bootstrap-kubelet.conf --kubeconfig=/etc/kubernetes/kubelet.conf&quot;</span></span>
<span class="line"><span style="color:#24292E;">Environment</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&quot;KUBELET_SYSTEM_PODS_ARGS=--max-pods 23 --pod-max-pids 16384 --pod-manifest-path=/etc/kubernetes/manifests&quot;</span></span>
<span class="line"><span style="color:#24292E;">Environment</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&quot;KUBELET_NETWORK_ARGS=--network-plugin=cni --cni-conf-dir=/etc/cni/net.d --cni-bin-dir=/opt/cni/bin --dynamic-config-dir=/etc/kubernetes/kubelet-config --v=3&quot;</span></span>
<span class="line"><span style="color:#24292E;">Environment</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&quot;KUBELET_DNS_ARGS=--enable-controller-attach-detach=true --cluster-dns=192.168.0.10         --pod-infra-container-image=registry-vpc.cn-hongkong.aliyuncs.com/acs/pause:3.2</span></span>
<span class="line"><span style="color:#032F62;">--enable-load-reader --cluster-domain=demo.local --cloud-provider=external         --hostname-override=cn-hongkong.172.31.34.242 --provider-id=cn-hongkong.i-j6c9xktnoxcwok6asqa9&quot;</span></span>
<span class="line"><span style="color:#24292E;">Environment</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&quot;KUBELET_AUTHZ_ARGS=--authorization-mode=Webhook --authentication-token-webhook=true --anonymous-auth=false --client-ca-file=/etc/kubernetes/pki/ca.crt&quot;</span></span>
<span class="line"><span style="color:#24292E;">Environment</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&quot;KUBELET_CGROUP_ARGS=--cgroup-driver=systemd&quot;</span></span>
<span class="line"><span style="color:#24292E;">Environment</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&quot;KUBELET_CERTIFICATE_ARGS=--tls-cipher-suites=TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_R</span></span>
<span class="line"><span style="color:#032F62;">SA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,TLS_RSA_WITH_AES_256_GCM_SHA384,TLS_RSA_WITH_AES_128_GCM_SHA256 --tls-cert-file=/v</span></span>
<span class="line"><span style="color:#032F62;">ar/lib/kubelet/pki/kubelet.crt --tls-private-key-file=/var/lib/kubelet/pki/kubelet.key --rotate-certificates=true --cert-dir=/var/lib/kubelet/pki&quot;</span></span>
<span class="line"><span style="color:#24292E;">ExecStart</span><span style="color:#D73A49;">=</span></span>
<span class="line"><span style="color:#24292E;">ExecStart</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">/usr/bin/kubelet</span><span style="color:#24292E;"> $KUBELET_KUBECONFIG_ARGS $KUBELET_SYSTEM_PODS_ARGS $KUBELET_NETWORK_ARGS $KUBELET_DNS_ARGS $KUBELET_AUTHZ_ARGS $KUBELET_CGROUP_ARGS $KUBELET_CERTIFICATE_ARGS $</span></span>
<span class="line"><span style="color:#6F42C1;">KUBELET_EXTRA_ARGS</span><span style="color:#24292E;"> $KUBELET_CUSTOMIZED_ARGS</span></span></code></pre></div><h2 id="_1-2-生成config-yaml" tabindex="-1">1.2 生成config.yaml <a class="header-anchor" href="#_1-2-生成config-yaml" aria-label="Permalink to &quot;1.2 生成config.yaml&quot;">​</a></h2><p>具体config.yaml配置文件，结构可参考官方文档</p><p><a href="https://kubernetes.io/zh/docs/reference/config-api/kubelet-config.v1beta1/" target="_blank" rel="noreferrer">https://kubernetes.io/zh/docs/reference/config-api/kubelet-config.v1beta1/</a></p><p><a href="https://kubernetes.io/docs/reference/config-api/kubelet-config.v1beta1/" target="_blank" rel="noreferrer">https://kubernetes.io/docs/reference/config-api/kubelet-config.v1beta1/</a></p><p><a href="https://kubernetes.io/zh-cn/docs/tasks/administer-cluster/kubelet-config-file/" target="_blank" rel="noreferrer">https://kubernetes.io/zh-cn/docs/tasks/administer-cluster/kubelet-config-file/</a></p><h2 id="_1-3-查看默认" tabindex="-1">1.3 查看默认 <a class="header-anchor" href="#_1-3-查看默认" aria-label="Permalink to &quot;1.3 查看默认&quot;">​</a></h2><p><a href="https://kubernetes.io/zh-cn/docs/tasks/administer-cluster/kubelet-config-file/" target="_blank" rel="noreferrer">https://kubernetes.io/zh-cn/docs/tasks/administer-cluster/kubelet-config-file/</a></p><ul><li>启动代理</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">#在终端中使用 kubectl proxy 启动代理服务器</span></span>
<span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">proxy</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">curl</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-X</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">GET</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">http://127.0.0.1:8001/api/v1/nodes/</span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">node-nam</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span><span style="color:#9ECBFF;">/proxy/configz</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">jq</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">或者，进入容器进行操作</span></span>
<span class="line"><span style="color:#B392F0;">curl</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-sk</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">https://kubernetes.default.svc/api/v1/nodes/</span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">node-nam</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span><span style="color:#9ECBFF;">/proxy/configz</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">jq</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-r</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">#在终端中使用 kubectl proxy 启动代理服务器</span></span>
<span class="line"><span style="color:#6F42C1;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">proxy</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">curl</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-X</span><span style="color:#24292E;"> </span><span style="color:#032F62;">GET</span><span style="color:#24292E;"> </span><span style="color:#032F62;">http://127.0.0.1:8001/api/v1/nodes/</span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">node-nam</span><span style="color:#24292E;">e</span><span style="color:#D73A49;">&gt;</span><span style="color:#032F62;">/proxy/configz</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">jq</span><span style="color:#24292E;"> </span><span style="color:#032F62;">.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">或者，进入容器进行操作</span></span>
<span class="line"><span style="color:#6F42C1;">curl</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-sk</span><span style="color:#24292E;"> </span><span style="color:#032F62;">https://kubernetes.default.svc/api/v1/nodes/</span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">node-nam</span><span style="color:#24292E;">e</span><span style="color:#D73A49;">&gt;</span><span style="color:#032F62;">/proxy/configz</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">jq</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-r</span></span></code></pre></div><h2 id="_1-4-configmap集中管理kubelet" tabindex="-1">1.4 ConfigMap集中管理kubelet <a class="header-anchor" href="#_1-4-configmap集中管理kubelet" aria-label="Permalink to &quot;1.4 ConfigMap集中管理kubelet&quot;">​</a></h2><p><a href="https://kubernetes.io/zh/docs/setup/production-environment/tools/kubeadm/kubelet-integration/" target="_blank" rel="noreferrer">https://kubernetes.io/zh/docs/setup/production-environment/tools/kubeadm/kubelet-integration/</a></p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">#生成默认</span></span>
<span class="line"><span style="color:#B392F0;">kubeadm</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">config</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">print</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">init-defaults</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--component-configs</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">#生成默认</span></span>
<span class="line"><span style="color:#6F42C1;">kubeadm</span><span style="color:#24292E;"> </span><span style="color:#032F62;">config</span><span style="color:#24292E;"> </span><span style="color:#032F62;">print</span><span style="color:#24292E;"> </span><span style="color:#032F62;">init-defaults</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--component-configs</span></span></code></pre></div><h1 id="_2-kube-proxy配置文件" tabindex="-1">2. kube-proxy配置文件 <a class="header-anchor" href="#_2-kube-proxy配置文件" aria-label="Permalink to &quot;2. kube-proxy配置文件&quot;">​</a></h1><p><a href="https://github.com/kubernetes/kube-proxy" target="_blank" rel="noreferrer">https://github.com/kubernetes/kube-proxy</a></p><p><a href="https://godoc.org/k8s.io/kube-proxy/config/v1alpha1#KubeProxyConfiguration" target="_blank" rel="noreferrer">https://godoc.org/k8s.io/kube-proxy/config/v1alpha1#KubeProxyConfiguration</a></p><p><a href="https://kubernetes.io/zh/docs/reference/config-api/kube-proxy-config.v1alpha1/" target="_blank" rel="noreferrer">https://kubernetes.io/zh/docs/reference/config-api/kube-proxy-config.v1alpha1/</a></p>`,21),t=[l];function p(r,c,i,E,u,y){return n(),e("div",null,t)}const k=s(o,[["render",p]]);export{b as __pageData,k as default};
