import{_ as s,o as n,c as a,R as l}from"./chunks/framework.zUbWieqp.js";const C=JSON.parse('{"title":"1.Registry","description":"","frontmatter":{},"headers":[],"relativePath":"guide/container/harbor/1_registry.md","filePath":"guide/container/harbor/1_registry.md","lastUpdated":1701229860000}'),p={name:"guide/container/harbor/1_registry.md"},o=l(`<h1 id="_1-registry" tabindex="-1">1.Registry <a class="header-anchor" href="#_1-registry" aria-label="Permalink to &quot;1.Registry&quot;">​</a></h1><p>官方文档：<a href="https://docs.docker.com/registry/" target="_blank" rel="noreferrer">https://docs.docker.com/registry/</a></p><p><a href="https://docs.docker.com/registry/spec/api/" target="_blank" rel="noreferrer">https://docs.docker.com/registry/spec/api/</a></p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">* 有时候使用 Docker Hub 这样的公共仓库可能不方便，用户可以创建一个本地仓库供私人使用。</span></span>
<span class="line"><span style="color:#e1e4e8;">* docker-registry是官方提供的工具，可以用于构建私有的镜像仓库。</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">* 有时候使用 Docker Hub 这样的公共仓库可能不方便，用户可以创建一个本地仓库供私人使用。</span></span>
<span class="line"><span style="color:#24292e;">* docker-registry是官方提供的工具，可以用于构建私有的镜像仓库。</span></span></code></pre></div><p><strong>注：</strong></p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">* 随着docker使用的镜像越来越多，就需要有一个保存镜像的地方，这就是仓库。</span></span>
<span class="line"><span style="color:#e1e4e8;">* 目前常用的两种仓库：</span></span>
<span class="line"><span style="color:#e1e4e8;"> 公共仓库和私有仓库。最方便的就是使用公共仓库上传和下载，</span></span>
<span class="line"><span style="color:#e1e4e8;"> 下载公共仓库的镜像是不需要注册的，但是上传时，是需要注册的。</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">* 私有仓库最常用的就是registry、Harbor两种，那接下来详细介绍如何创建私有仓库。</span></span>
<span class="line"><span style="color:#e1e4e8;">* 今天说的Registry仓库，是通过一个容器给我们提供的服务，是比较简</span></span>
<span class="line"><span style="color:#e1e4e8;">   易的私有仓库，以后在企业中还会有功能更加完善的Harbor仓库。</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">* 随着docker使用的镜像越来越多，就需要有一个保存镜像的地方，这就是仓库。</span></span>
<span class="line"><span style="color:#24292e;">* 目前常用的两种仓库：</span></span>
<span class="line"><span style="color:#24292e;"> 公共仓库和私有仓库。最方便的就是使用公共仓库上传和下载，</span></span>
<span class="line"><span style="color:#24292e;"> 下载公共仓库的镜像是不需要注册的，但是上传时，是需要注册的。</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">* 私有仓库最常用的就是registry、Harbor两种，那接下来详细介绍如何创建私有仓库。</span></span>
<span class="line"><span style="color:#24292e;">* 今天说的Registry仓库，是通过一个容器给我们提供的服务，是比较简</span></span>
<span class="line"><span style="color:#24292e;">   易的私有仓库，以后在企业中还会有功能更加完善的Harbor仓库。</span></span></code></pre></div><h2 id="环境" tabindex="-1">环境： <a class="header-anchor" href="#环境" aria-label="Permalink to &quot;环境：&quot;">​</a></h2><table><thead><tr><th>ip</th><th>info</th></tr></thead><tbody><tr><td>k8s1(192.168.49.143)</td><td>server</td></tr><tr><td>k8s2()</td><td>client</td></tr></tbody></table><h1 id="_2-下载" tabindex="-1">2.下载 <a class="header-anchor" href="#_2-下载" aria-label="Permalink to &quot;2.下载&quot;">​</a></h1><p>[root@k8s1 ~]# docker pull registry:2</p><h2 id="启动" tabindex="-1">启动 <a class="header-anchor" href="#启动" aria-label="Permalink to &quot;启动&quot;">​</a></h2><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">#启动</span></span>
<span class="line"><span style="color:#E1E4E8;">[root@k8s1 </span><span style="color:#F97583;">~</span><span style="color:#E1E4E8;">]#docker run -itd --name registry --restart=always  -p 5000:5000 -v /registry:/var/lib/registry   -e REGISTRY_STORAGE_DELETE_ENABLED=true registry:2</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">//创建一个registry容器来运行registry服务；</span></span>
<span class="line"><span style="color:#B392F0;">//-p：端口映射（前面是宿主机端口：后面是容器暴露的端口）；</span></span>
<span class="line"><span style="color:#B392F0;">//-v：挂载目录（前面是宿主机的目录：后面的是容器的目录）自动创建宿主机的目录；</span></span>
<span class="line"><span style="color:#B392F0;">//--restart</span><span style="color:#E1E4E8;">=always：随docker服务的启动而启动</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#查看</span></span>
<span class="line"><span style="color:#E1E4E8;">[root@k8s1 </span><span style="color:#F97583;">~</span><span style="color:#E1E4E8;">]# netstat -anlp</span><span style="color:#F97583;">|</span><span style="color:#B392F0;">grep</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5000</span></span>
<span class="line"><span style="color:#B392F0;">tcp</span><span style="color:#E1E4E8;">        </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">      </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0.0</span><span style="color:#9ECBFF;">.0.0:5000</span><span style="color:#E1E4E8;">            </span><span style="color:#79B8FF;">0.0</span><span style="color:#9ECBFF;">.0.0:</span><span style="color:#79B8FF;">*</span><span style="color:#E1E4E8;">               </span><span style="color:#9ECBFF;">LISTEN</span><span style="color:#E1E4E8;">      </span><span style="color:#79B8FF;">3762</span><span style="color:#9ECBFF;">/docker-proxy</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">#启动</span></span>
<span class="line"><span style="color:#24292E;">[root@k8s1 </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]#docker run -itd --name registry --restart=always  -p 5000:5000 -v /registry:/var/lib/registry   -e REGISTRY_STORAGE_DELETE_ENABLED=true registry:2</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">//创建一个registry容器来运行registry服务；</span></span>
<span class="line"><span style="color:#6F42C1;">//-p：端口映射（前面是宿主机端口：后面是容器暴露的端口）；</span></span>
<span class="line"><span style="color:#6F42C1;">//-v：挂载目录（前面是宿主机的目录：后面的是容器的目录）自动创建宿主机的目录；</span></span>
<span class="line"><span style="color:#6F42C1;">//--restart</span><span style="color:#24292E;">=always：随docker服务的启动而启动</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#查看</span></span>
<span class="line"><span style="color:#24292E;">[root@k8s1 </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# netstat -anlp</span><span style="color:#D73A49;">|</span><span style="color:#6F42C1;">grep</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5000</span></span>
<span class="line"><span style="color:#6F42C1;">tcp</span><span style="color:#24292E;">        </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">      </span><span style="color:#005CC5;">0</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0.0</span><span style="color:#032F62;">.0.0:5000</span><span style="color:#24292E;">            </span><span style="color:#005CC5;">0.0</span><span style="color:#032F62;">.0.0:</span><span style="color:#005CC5;">*</span><span style="color:#24292E;">               </span><span style="color:#032F62;">LISTEN</span><span style="color:#24292E;">      </span><span style="color:#005CC5;">3762</span><span style="color:#032F62;">/docker-proxy</span></span></code></pre></div><h2 id="tag" tabindex="-1">tag <a class="header-anchor" href="#tag" aria-label="Permalink to &quot;tag&quot;">​</a></h2><p>命名：registry_url/css/name:version</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">[root@k8s1 </span><span style="color:#F97583;">~</span><span style="color:#E1E4E8;">]# docker tag hello-world:latest 192.168.49.143:5000/hello-world</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">//更改镜像名称</span></span>
<span class="line"><span style="color:#B392F0;">注：私有仓库镜像的命名规则：ip:5000/XXX（宿主机的IP:5000端口/镜像名称）</span></span>
<span class="line"><span style="color:#B392F0;">//相当于是cp一份镜像</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">[root@k8s1 </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# docker tag hello-world:latest 192.168.49.143:5000/hello-world</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">//更改镜像名称</span></span>
<span class="line"><span style="color:#6F42C1;">注：私有仓库镜像的命名规则：ip:5000/XXX（宿主机的IP:5000端口/镜像名称）</span></span>
<span class="line"><span style="color:#6F42C1;">//相当于是cp一份镜像</span></span></code></pre></div><h2 id="修改启动" tabindex="-1">修改启动 <a class="header-anchor" href="#修改启动" aria-label="Permalink to &quot;修改启动&quot;">​</a></h2><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">[root@k8s1 </span><span style="color:#F97583;">~</span><span style="color:#E1E4E8;">]# vim /usr/lib/systemd/system/docker.service</span></span>
<span class="line"><span style="color:#E1E4E8;">ExecStart</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">/usr/bin/dockerd</span><span style="color:#E1E4E8;">    --insecure-registry</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">ip:5000</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">[root@k8s1 </span><span style="color:#F97583;">~</span><span style="color:#E1E4E8;">]# systemctl daemon-reload</span></span>
<span class="line"><span style="color:#E1E4E8;">[root@k8s1 </span><span style="color:#F97583;">~</span><span style="color:#E1E4E8;">]# systemctl restart docker</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">[root@k8s1 </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# vim /usr/lib/systemd/system/docker.service</span></span>
<span class="line"><span style="color:#24292E;">ExecStart</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">/usr/bin/dockerd</span><span style="color:#24292E;">    --insecure-registry</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">ip:5000</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">[root@k8s1 </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# systemctl daemon-reload</span></span>
<span class="line"><span style="color:#24292E;">[root@k8s1 </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# systemctl restart docker</span></span></code></pre></div><h2 id="查看仓库中镜像" tabindex="-1">查看仓库中镜像 <a class="header-anchor" href="#查看仓库中镜像" aria-label="Permalink to &quot;查看仓库中镜像&quot;">​</a></h2><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">[root@k8s1 </span><span style="color:#F97583;">~</span><span style="color:#E1E4E8;">]# curl 192.168.49.143:5000/v2/_catalog       </span></span>
<span class="line"><span style="color:#E1E4E8;">{</span><span style="color:#B392F0;">&quot;repositories&quot;</span><span style="color:#79B8FF;">:</span><span style="color:#E1E4E8;">[]}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">[root@k8s1 </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# curl 192.168.49.143:5000/v2/_catalog       </span></span>
<span class="line"><span style="color:#24292E;">{</span><span style="color:#6F42C1;">&quot;repositories&quot;</span><span style="color:#005CC5;">:</span><span style="color:#24292E;">[]}</span></span></code></pre></div><h2 id="上传" tabindex="-1">上传 <a class="header-anchor" href="#上传" aria-label="Permalink to &quot;上传&quot;">​</a></h2><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">[root@k8s1 </span><span style="color:#F97583;">~</span><span style="color:#E1E4E8;">]# docker push 192.168.49.143:5000/hello-world:latest</span></span>
<span class="line"><span style="color:#B392F0;">The</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">push</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">refers</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">to</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">repository</span><span style="color:#E1E4E8;"> [192.168.49.143:5000/hello-world]</span></span>
<span class="line"><span style="color:#B392F0;">f22b99068db9:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Pushed</span><span style="color:#E1E4E8;"> </span></span>
<span class="line"><span style="color:#B392F0;">latest:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">digest:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">sha256:1b26826f602946860c279fce658f31050cff2c596583af237d971f4629b57792</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">size:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">525</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#查看</span></span>
<span class="line"><span style="color:#E1E4E8;">[root@k8s1 </span><span style="color:#F97583;">~</span><span style="color:#E1E4E8;">]# curl 127.0.0.1:5000/v2/_catalog</span></span>
<span class="line"><span style="color:#E1E4E8;">{</span><span style="color:#B392F0;">&quot;repositories&quot;</span><span style="color:#79B8FF;">:</span><span style="color:#E1E4E8;">[</span><span style="color:#B392F0;">&quot;hello-world&quot;</span><span style="color:#B392F0;">]}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#查看镜像的详细信息</span></span>
<span class="line"><span style="color:#B392F0;">方法：GET</span><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">/v2/</span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">nam</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span><span style="color:#9ECBFF;">/tags/list</span></span>
<span class="line"><span style="color:#B392F0;">--</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">name</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">为镜像名字</span></span>
<span class="line"><span style="color:#E1E4E8;">[root@k8s1 </span><span style="color:#F97583;">~</span><span style="color:#E1E4E8;">]# curl 127.0.0.1:5000/v2/hello-world/tags/list</span></span>
<span class="line"><span style="color:#E1E4E8;">{</span><span style="color:#B392F0;">&quot;name&quot;</span><span style="color:#79B8FF;">:</span><span style="color:#B392F0;">&quot;hello-world&quot;</span><span style="color:#B392F0;">,</span><span style="color:#B392F0;">&quot;tags&quot;</span><span style="color:#79B8FF;">:</span><span style="color:#E1E4E8;">[</span><span style="color:#B392F0;">&quot;latest&quot;</span><span style="color:#B392F0;">]}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#获取镜像信息</span></span>
<span class="line"><span style="color:#B392F0;">方法：GET</span><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">/v2/</span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">nam</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span><span style="color:#9ECBFF;">/manifests/</span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">referenc</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span></span>
<span class="line"><span style="color:#B392F0;">其中&lt;name&gt;为镜像名，&lt;reference&gt;可以是</span><span style="color:#B392F0;">&quot;tag&quot;</span><span style="color:#B392F0;">或</span><span style="color:#B392F0;">&quot;digest&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#删除镜像</span></span>
<span class="line"><span style="color:#B392F0;">方法：DELETE</span><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">/v2/</span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">nam</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span><span style="color:#9ECBFF;">/manifests/</span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">referenc</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span></span>
<span class="line"><span style="color:#B392F0;">其中&lt;name&gt;为镜像名，&lt;reference&gt;只能是</span><span style="color:#B392F0;">&quot;digest&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">--</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">获取digest</span></span>
<span class="line"><span style="color:#E1E4E8;">[root@k8s1 </span><span style="color:#F97583;">~</span><span style="color:#E1E4E8;">]# curl --header </span><span style="color:#9ECBFF;">&quot;Accept: application/vnd.docker.distribution.manifest.v2+json&quot;</span><span style="color:#E1E4E8;"> -I  127.0.0.1:5000/v2/hello-world/manifests/latest </span></span>
<span class="line"><span style="color:#B392F0;">HTTP/1.1</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">200</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">OK</span></span>
<span class="line"><span style="color:#B392F0;">Content-Length:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">525</span></span>
<span class="line"><span style="color:#B392F0;">Content-Type:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">application/vnd.docker.distribution.manifest.v2+json</span></span>
<span class="line"><span style="color:#B392F0;">Docker-Content-Digest:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">sha256:1b26826f602946860c279fce658f31050cff2c596583af237d971f4629b57792</span></span>
<span class="line"><span style="color:#B392F0;">Docker-Distribution-Api-Version:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">registry/2.0</span></span>
<span class="line"><span style="color:#B392F0;">Etag:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;sha256:1b26826f602946860c279fce658f31050cff2c596583af237d971f4629b57792&quot;</span></span>
<span class="line"><span style="color:#B392F0;">X-Content-Type-Options:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">nosniff</span></span>
<span class="line"><span style="color:#B392F0;">Date:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Sun,</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">25</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Apr</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2021</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">07</span><span style="color:#9ECBFF;">:16:34</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">GMT</span></span>
<span class="line"><span style="color:#6A737D;">#或者通过</span></span>
<span class="line"><span style="color:#E1E4E8;">[root@k8s1 </span><span style="color:#F97583;">~</span><span style="color:#E1E4E8;">]# docker images --digests</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#执行删除</span></span>
<span class="line"><span style="color:#E1E4E8;">[root@k8s1 </span><span style="color:#F97583;">~</span><span style="color:#E1E4E8;">]# curl -X DELETE http://192.168.49.143:5000/v2/hello-world/manifests/sha256:1b26826f602946860c279fce658f31050cff2c596583af237d971f4629b57792</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">[root@k8s1 </span><span style="color:#F97583;">~</span><span style="color:#E1E4E8;">]# curl http://192.168.49.143:5000/v2/_catalog</span></span>
<span class="line"><span style="color:#E1E4E8;">{</span><span style="color:#B392F0;">&quot;repositories&quot;</span><span style="color:#79B8FF;">:</span><span style="color:#E1E4E8;">[</span><span style="color:#B392F0;">&quot;hello-world&quot;</span><span style="color:#B392F0;">]}</span></span>
<span class="line"><span style="color:#6A737D;">#这里说明虽然删除了manifests,但是image依然可以看到；并没有被删除；</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">[root@k8s1 </span><span style="color:#F97583;">~</span><span style="color:#E1E4E8;">]# curl -X DELETE http://192.168.49.143:5000/v2/hello-world/manifests/sha256:1b26826f602946860c279fce658f31050cff2c596583af237d971f4629b57792</span></span>
<span class="line"><span style="color:#E1E4E8;">{</span><span style="color:#B392F0;">&quot;errors&quot;</span><span style="color:#79B8FF;">:</span><span style="color:#E1E4E8;">[{&quot;</span><span style="color:#B392F0;">code</span><span style="color:#B392F0;">&quot;:&quot;</span><span style="color:#B392F0;">MANIFEST_UNKNOWN</span><span style="color:#B392F0;">&quot;,&quot;</span><span style="color:#B392F0;">message</span><span style="color:#B392F0;">&quot;:&quot;</span><span style="color:#B392F0;">manifest</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">unknown&quot;}]}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#9ECBFF;">#查看是否存在</span></span>
<span class="line"><span style="color:#9ECBFF;">[root@k8s1 ~]# curl --header &quot;Accept:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">application/vnd.docker.distribution.manifest.v2+json&quot;   -I   -X HEAD http://192.168.49.143:5000/v2/hello-world/manifests/latest</span></span>
<span class="line"><span style="color:#9ECBFF;">HTTP/1.1 404 Not Found</span></span>
<span class="line"><span style="color:#9ECBFF;">Content-Type: application/json; charset=utf-8</span></span>
<span class="line"><span style="color:#9ECBFF;">Docker-Distribution-Api-Version: registry/2.0</span></span>
<span class="line"><span style="color:#9ECBFF;">X-Content-Type-Options: nosniff</span></span>
<span class="line"><span style="color:#9ECBFF;">Date: Sun, 25 Apr 2021 07:37:20 GMT</span></span>
<span class="line"><span style="color:#9ECBFF;">Content-Length: 96</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#9ECBFF;">#尝试pull</span></span>
<span class="line"><span style="color:#9ECBFF;">[root@k8s2 ~]# docker pull 192.168.49.143:5000/hello-world</span></span>
<span class="line"><span style="color:#9ECBFF;">Using default tag: latest</span></span>
<span class="line"><span style="color:#9ECBFF;">Error response from daemon: manifest for 192.168.49.143:5000/hello-world:latest not found: manifest unknown: manifest unknown</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">[root@k8s1 </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# docker push 192.168.49.143:5000/hello-world:latest</span></span>
<span class="line"><span style="color:#6F42C1;">The</span><span style="color:#24292E;"> </span><span style="color:#032F62;">push</span><span style="color:#24292E;"> </span><span style="color:#032F62;">refers</span><span style="color:#24292E;"> </span><span style="color:#032F62;">to</span><span style="color:#24292E;"> </span><span style="color:#032F62;">repository</span><span style="color:#24292E;"> [192.168.49.143:5000/hello-world]</span></span>
<span class="line"><span style="color:#6F42C1;">f22b99068db9:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Pushed</span><span style="color:#24292E;"> </span></span>
<span class="line"><span style="color:#6F42C1;">latest:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">digest:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">sha256:1b26826f602946860c279fce658f31050cff2c596583af237d971f4629b57792</span><span style="color:#24292E;"> </span><span style="color:#032F62;">size:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">525</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#查看</span></span>
<span class="line"><span style="color:#24292E;">[root@k8s1 </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# curl 127.0.0.1:5000/v2/_catalog</span></span>
<span class="line"><span style="color:#24292E;">{</span><span style="color:#6F42C1;">&quot;repositories&quot;</span><span style="color:#005CC5;">:</span><span style="color:#24292E;">[</span><span style="color:#6F42C1;">&quot;hello-world&quot;</span><span style="color:#6F42C1;">]}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#查看镜像的详细信息</span></span>
<span class="line"><span style="color:#6F42C1;">方法：GET</span><span style="color:#24292E;">  </span><span style="color:#032F62;">/v2/</span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">nam</span><span style="color:#24292E;">e</span><span style="color:#D73A49;">&gt;</span><span style="color:#032F62;">/tags/list</span></span>
<span class="line"><span style="color:#6F42C1;">--</span><span style="color:#24292E;"> </span><span style="color:#032F62;">name</span><span style="color:#24292E;"> </span><span style="color:#032F62;">为镜像名字</span></span>
<span class="line"><span style="color:#24292E;">[root@k8s1 </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# curl 127.0.0.1:5000/v2/hello-world/tags/list</span></span>
<span class="line"><span style="color:#24292E;">{</span><span style="color:#6F42C1;">&quot;name&quot;</span><span style="color:#005CC5;">:</span><span style="color:#6F42C1;">&quot;hello-world&quot;</span><span style="color:#6F42C1;">,</span><span style="color:#6F42C1;">&quot;tags&quot;</span><span style="color:#005CC5;">:</span><span style="color:#24292E;">[</span><span style="color:#6F42C1;">&quot;latest&quot;</span><span style="color:#6F42C1;">]}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#获取镜像信息</span></span>
<span class="line"><span style="color:#6F42C1;">方法：GET</span><span style="color:#24292E;">  </span><span style="color:#032F62;">/v2/</span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">nam</span><span style="color:#24292E;">e</span><span style="color:#D73A49;">&gt;</span><span style="color:#032F62;">/manifests/</span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">referenc</span><span style="color:#24292E;">e</span><span style="color:#D73A49;">&gt;</span></span>
<span class="line"><span style="color:#6F42C1;">其中&lt;name&gt;为镜像名，&lt;reference&gt;可以是</span><span style="color:#6F42C1;">&quot;tag&quot;</span><span style="color:#6F42C1;">或</span><span style="color:#6F42C1;">&quot;digest&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#删除镜像</span></span>
<span class="line"><span style="color:#6F42C1;">方法：DELETE</span><span style="color:#24292E;">  </span><span style="color:#032F62;">/v2/</span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">nam</span><span style="color:#24292E;">e</span><span style="color:#D73A49;">&gt;</span><span style="color:#032F62;">/manifests/</span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">referenc</span><span style="color:#24292E;">e</span><span style="color:#D73A49;">&gt;</span></span>
<span class="line"><span style="color:#6F42C1;">其中&lt;name&gt;为镜像名，&lt;reference&gt;只能是</span><span style="color:#6F42C1;">&quot;digest&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">--</span><span style="color:#24292E;"> </span><span style="color:#032F62;">获取digest</span></span>
<span class="line"><span style="color:#24292E;">[root@k8s1 </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# curl --header </span><span style="color:#032F62;">&quot;Accept: application/vnd.docker.distribution.manifest.v2+json&quot;</span><span style="color:#24292E;"> -I  127.0.0.1:5000/v2/hello-world/manifests/latest </span></span>
<span class="line"><span style="color:#6F42C1;">HTTP/1.1</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">200</span><span style="color:#24292E;"> </span><span style="color:#032F62;">OK</span></span>
<span class="line"><span style="color:#6F42C1;">Content-Length:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">525</span></span>
<span class="line"><span style="color:#6F42C1;">Content-Type:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">application/vnd.docker.distribution.manifest.v2+json</span></span>
<span class="line"><span style="color:#6F42C1;">Docker-Content-Digest:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">sha256:1b26826f602946860c279fce658f31050cff2c596583af237d971f4629b57792</span></span>
<span class="line"><span style="color:#6F42C1;">Docker-Distribution-Api-Version:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">registry/2.0</span></span>
<span class="line"><span style="color:#6F42C1;">Etag:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;sha256:1b26826f602946860c279fce658f31050cff2c596583af237d971f4629b57792&quot;</span></span>
<span class="line"><span style="color:#6F42C1;">X-Content-Type-Options:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">nosniff</span></span>
<span class="line"><span style="color:#6F42C1;">Date:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Sun,</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">25</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Apr</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2021</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">07</span><span style="color:#032F62;">:16:34</span><span style="color:#24292E;"> </span><span style="color:#032F62;">GMT</span></span>
<span class="line"><span style="color:#6A737D;">#或者通过</span></span>
<span class="line"><span style="color:#24292E;">[root@k8s1 </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# docker images --digests</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#执行删除</span></span>
<span class="line"><span style="color:#24292E;">[root@k8s1 </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# curl -X DELETE http://192.168.49.143:5000/v2/hello-world/manifests/sha256:1b26826f602946860c279fce658f31050cff2c596583af237d971f4629b57792</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">[root@k8s1 </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# curl http://192.168.49.143:5000/v2/_catalog</span></span>
<span class="line"><span style="color:#24292E;">{</span><span style="color:#6F42C1;">&quot;repositories&quot;</span><span style="color:#005CC5;">:</span><span style="color:#24292E;">[</span><span style="color:#6F42C1;">&quot;hello-world&quot;</span><span style="color:#6F42C1;">]}</span></span>
<span class="line"><span style="color:#6A737D;">#这里说明虽然删除了manifests,但是image依然可以看到；并没有被删除；</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">[root@k8s1 </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# curl -X DELETE http://192.168.49.143:5000/v2/hello-world/manifests/sha256:1b26826f602946860c279fce658f31050cff2c596583af237d971f4629b57792</span></span>
<span class="line"><span style="color:#24292E;">{</span><span style="color:#6F42C1;">&quot;errors&quot;</span><span style="color:#005CC5;">:</span><span style="color:#24292E;">[{&quot;</span><span style="color:#6F42C1;">code</span><span style="color:#6F42C1;">&quot;:&quot;</span><span style="color:#6F42C1;">MANIFEST_UNKNOWN</span><span style="color:#6F42C1;">&quot;,&quot;</span><span style="color:#6F42C1;">message</span><span style="color:#6F42C1;">&quot;:&quot;</span><span style="color:#6F42C1;">manifest</span><span style="color:#24292E;"> </span><span style="color:#032F62;">unknown&quot;}]}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#032F62;">#查看是否存在</span></span>
<span class="line"><span style="color:#032F62;">[root@k8s1 ~]# curl --header &quot;Accept:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">application/vnd.docker.distribution.manifest.v2+json&quot;   -I   -X HEAD http://192.168.49.143:5000/v2/hello-world/manifests/latest</span></span>
<span class="line"><span style="color:#032F62;">HTTP/1.1 404 Not Found</span></span>
<span class="line"><span style="color:#032F62;">Content-Type: application/json; charset=utf-8</span></span>
<span class="line"><span style="color:#032F62;">Docker-Distribution-Api-Version: registry/2.0</span></span>
<span class="line"><span style="color:#032F62;">X-Content-Type-Options: nosniff</span></span>
<span class="line"><span style="color:#032F62;">Date: Sun, 25 Apr 2021 07:37:20 GMT</span></span>
<span class="line"><span style="color:#032F62;">Content-Length: 96</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#032F62;">#尝试pull</span></span>
<span class="line"><span style="color:#032F62;">[root@k8s2 ~]# docker pull 192.168.49.143:5000/hello-world</span></span>
<span class="line"><span style="color:#032F62;">Using default tag: latest</span></span>
<span class="line"><span style="color:#032F62;">Error response from daemon: manifest for 192.168.49.143:5000/hello-world:latest not found: manifest unknown: manifest unknown</span></span></code></pre></div><blockquote><p><strong>从这个过程中，可以知道：</strong> <strong>A. 删除manifests文件并不会删除image 的各个layer层；所以不会释放layer占用的空间</strong></p><p><strong>B. 删除manifests会导致pull操作失效，因为pull操作需要manifests这个文件；</strong></p><p><strong>C. 通过REST API的方式依然可以看到丢失了manifests文件的image</strong></p></blockquote><h2 id="释放空间" tabindex="-1">释放空间 <a class="header-anchor" href="#释放空间" aria-label="Permalink to &quot;释放空间&quot;">​</a></h2><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">[root@k8s1 v2]# pwd</span></span>
<span class="line"><span style="color:#B392F0;">/registry/docker/registry/v2</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#删除registry之后的空间大小，此时并没有释放空间</span></span>
<span class="line"><span style="color:#E1E4E8;">[root@k8s1 v2]#  du -hsx </span><span style="color:#F97583;">*</span></span>
<span class="line"><span style="color:#B392F0;">16K</span><span style="color:#E1E4E8;">	</span><span style="color:#9ECBFF;">blobs</span></span>
<span class="line"><span style="color:#B392F0;">12K</span><span style="color:#E1E4E8;">	</span><span style="color:#9ECBFF;">repositories</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#进入容器</span></span>
<span class="line"><span style="color:#E1E4E8;">[root@k8s1 v2]# docker ps </span></span>
<span class="line"><span style="color:#B392F0;">CONTAINER</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">ID</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">IMAGE</span><span style="color:#E1E4E8;">        </span><span style="color:#9ECBFF;">COMMAND</span><span style="color:#E1E4E8;">                  </span><span style="color:#9ECBFF;">CREATED</span><span style="color:#E1E4E8;">          </span><span style="color:#9ECBFF;">STATUS</span><span style="color:#E1E4E8;">          </span><span style="color:#9ECBFF;">PORTS</span><span style="color:#E1E4E8;">                                       </span><span style="color:#9ECBFF;">NAMES</span></span>
<span class="line"><span style="color:#B392F0;">9f1ebb04a807</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">registry:2</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">&quot;/entrypoint.sh /etc…&quot;</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">minutes</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">ago</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">Up</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">minutes</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">0.0</span><span style="color:#9ECBFF;">.0.0:5000</span><span style="color:#E1E4E8;">-</span><span style="color:#F97583;">&gt;</span><span style="color:#9ECBFF;">5000/tcp,</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">:::5000</span><span style="color:#E1E4E8;">-</span><span style="color:#F97583;">&gt;</span><span style="color:#9ECBFF;">5000/tcp</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">registry</span></span>
<span class="line"><span style="color:#E1E4E8;">[root@k8s1 v2]# docker exec -it 9f1ebb04a807 /bin/sh</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#执行registry garbage-collect 命令</span></span>
<span class="line"><span style="color:#B392F0;">/</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># registry garbage-collect </span></span>
<span class="line"><span style="color:#B392F0;">configuration</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">error:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">configuration</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">path</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">unspecified</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">Usage:</span><span style="color:#E1E4E8;"> </span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">registry</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">garbage-collect</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">confi</span><span style="color:#E1E4E8;">g</span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;"> [flags]</span></span>
<span class="line"><span style="color:#B392F0;">Flags:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">-m,</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--delete-untagged=false:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">delete</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">manifests</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">that</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">are</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">not</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">currently</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">referenced</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">via</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">tag</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">-d,</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--dry-run=false:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">do</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">everything</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">except</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">remove</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">the</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">blobs</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">-h,</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--help=false:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">help</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">for</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">garbage-collect</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">Additional</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">help</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">topics:</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">/</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># cat /etc/docker/registry/config.yml</span></span>
<span class="line"><span style="color:#B392F0;">version:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0.1</span></span>
<span class="line"><span style="color:#B392F0;">log:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">fields:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">service:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">registry</span></span>
<span class="line"><span style="color:#B392F0;">storage:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">cache:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">blobdescriptor:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">inmemory</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">filesystem:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">rootdirectory:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/var/lib/registry</span></span>
<span class="line"><span style="color:#B392F0;">http:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">addr:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">:5000</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">headers:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">X-Content-Type-Options:</span><span style="color:#E1E4E8;"> [nosniff]</span></span>
<span class="line"><span style="color:#B392F0;">health:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">storagedriver:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">enabled:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">true</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">interval:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">10</span><span style="color:#9ECBFF;">s</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">threshold:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">3</span></span>
<span class="line"><span style="color:#B392F0;">/</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;">#registry garbage-collect /etc/docker/registry/config.yml</span></span>
<span class="line"><span style="color:#B392F0;">hello-world</span></span>
<span class="line"><span style="color:#B392F0;">0</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">blobs</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">marked,</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">4</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">blobs</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">and</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">manifests</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">eligible</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">for</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">deletion</span></span>
<span class="line"><span style="color:#B392F0;">blob</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">eligible</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">for</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">deletion:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">sha256:d1165f2212346b2bab48cb01c1e39ee8ad1be46b87873d9ca7a4e434980a7726</span></span>
<span class="line"><span style="color:#B392F0;">。。。。</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">[root@k8s1 v2]# du -hxs </span><span style="color:#F97583;">*</span></span>
<span class="line"><span style="color:#B392F0;">0</span><span style="color:#E1E4E8;">	</span><span style="color:#9ECBFF;">blobs</span></span>
<span class="line"><span style="color:#B392F0;">12K</span><span style="color:#E1E4E8;">	</span><span style="color:#9ECBFF;">repositories</span></span>
<span class="line"><span style="color:#6A737D;">#至此结束</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">[root@k8s1 v2]# pwd</span></span>
<span class="line"><span style="color:#6F42C1;">/registry/docker/registry/v2</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#删除registry之后的空间大小，此时并没有释放空间</span></span>
<span class="line"><span style="color:#24292E;">[root@k8s1 v2]#  du -hsx </span><span style="color:#D73A49;">*</span></span>
<span class="line"><span style="color:#6F42C1;">16K</span><span style="color:#24292E;">	</span><span style="color:#032F62;">blobs</span></span>
<span class="line"><span style="color:#6F42C1;">12K</span><span style="color:#24292E;">	</span><span style="color:#032F62;">repositories</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#进入容器</span></span>
<span class="line"><span style="color:#24292E;">[root@k8s1 v2]# docker ps </span></span>
<span class="line"><span style="color:#6F42C1;">CONTAINER</span><span style="color:#24292E;"> </span><span style="color:#032F62;">ID</span><span style="color:#24292E;">   </span><span style="color:#032F62;">IMAGE</span><span style="color:#24292E;">        </span><span style="color:#032F62;">COMMAND</span><span style="color:#24292E;">                  </span><span style="color:#032F62;">CREATED</span><span style="color:#24292E;">          </span><span style="color:#032F62;">STATUS</span><span style="color:#24292E;">          </span><span style="color:#032F62;">PORTS</span><span style="color:#24292E;">                                       </span><span style="color:#032F62;">NAMES</span></span>
<span class="line"><span style="color:#6F42C1;">9f1ebb04a807</span><span style="color:#24292E;">   </span><span style="color:#032F62;">registry:2</span><span style="color:#24292E;">   </span><span style="color:#032F62;">&quot;/entrypoint.sh /etc…&quot;</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#032F62;">minutes</span><span style="color:#24292E;"> </span><span style="color:#032F62;">ago</span><span style="color:#24292E;">   </span><span style="color:#032F62;">Up</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#032F62;">minutes</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">0.0</span><span style="color:#032F62;">.0.0:5000</span><span style="color:#24292E;">-</span><span style="color:#D73A49;">&gt;</span><span style="color:#032F62;">5000/tcp,</span><span style="color:#24292E;"> </span><span style="color:#032F62;">:::5000</span><span style="color:#24292E;">-</span><span style="color:#D73A49;">&gt;</span><span style="color:#032F62;">5000/tcp</span><span style="color:#24292E;">   </span><span style="color:#032F62;">registry</span></span>
<span class="line"><span style="color:#24292E;">[root@k8s1 v2]# docker exec -it 9f1ebb04a807 /bin/sh</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#执行registry garbage-collect 命令</span></span>
<span class="line"><span style="color:#6F42C1;">/</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># registry garbage-collect </span></span>
<span class="line"><span style="color:#6F42C1;">configuration</span><span style="color:#24292E;"> </span><span style="color:#032F62;">error:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">configuration</span><span style="color:#24292E;"> </span><span style="color:#032F62;">path</span><span style="color:#24292E;"> </span><span style="color:#032F62;">unspecified</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">Usage:</span><span style="color:#24292E;"> </span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">registry</span><span style="color:#24292E;"> </span><span style="color:#032F62;">garbage-collect</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">confi</span><span style="color:#24292E;">g</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;"> [flags]</span></span>
<span class="line"><span style="color:#6F42C1;">Flags:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">-m,</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--delete-untagged=false:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">delete</span><span style="color:#24292E;"> </span><span style="color:#032F62;">manifests</span><span style="color:#24292E;"> </span><span style="color:#032F62;">that</span><span style="color:#24292E;"> </span><span style="color:#032F62;">are</span><span style="color:#24292E;"> </span><span style="color:#032F62;">not</span><span style="color:#24292E;"> </span><span style="color:#032F62;">currently</span><span style="color:#24292E;"> </span><span style="color:#032F62;">referenced</span><span style="color:#24292E;"> </span><span style="color:#032F62;">via</span><span style="color:#24292E;"> </span><span style="color:#032F62;">tag</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">-d,</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--dry-run=false:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">do</span><span style="color:#24292E;"> </span><span style="color:#032F62;">everything</span><span style="color:#24292E;"> </span><span style="color:#032F62;">except</span><span style="color:#24292E;"> </span><span style="color:#032F62;">remove</span><span style="color:#24292E;"> </span><span style="color:#032F62;">the</span><span style="color:#24292E;"> </span><span style="color:#032F62;">blobs</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">-h,</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--help=false:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">help</span><span style="color:#24292E;"> </span><span style="color:#032F62;">for</span><span style="color:#24292E;"> </span><span style="color:#032F62;">garbage-collect</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">Additional</span><span style="color:#24292E;"> </span><span style="color:#032F62;">help</span><span style="color:#24292E;"> </span><span style="color:#032F62;">topics:</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">/</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># cat /etc/docker/registry/config.yml</span></span>
<span class="line"><span style="color:#6F42C1;">version:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0.1</span></span>
<span class="line"><span style="color:#6F42C1;">log:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">fields:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">service:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">registry</span></span>
<span class="line"><span style="color:#6F42C1;">storage:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">cache:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">blobdescriptor:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">inmemory</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">filesystem:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">rootdirectory:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/var/lib/registry</span></span>
<span class="line"><span style="color:#6F42C1;">http:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">addr:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">:5000</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">headers:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">X-Content-Type-Options:</span><span style="color:#24292E;"> [nosniff]</span></span>
<span class="line"><span style="color:#6F42C1;">health:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">storagedriver:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">enabled:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">true</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">interval:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">10</span><span style="color:#032F62;">s</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">threshold:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">3</span></span>
<span class="line"><span style="color:#6F42C1;">/</span><span style="color:#24292E;"> </span><span style="color:#6A737D;">#registry garbage-collect /etc/docker/registry/config.yml</span></span>
<span class="line"><span style="color:#6F42C1;">hello-world</span></span>
<span class="line"><span style="color:#6F42C1;">0</span><span style="color:#24292E;"> </span><span style="color:#032F62;">blobs</span><span style="color:#24292E;"> </span><span style="color:#032F62;">marked,</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">4</span><span style="color:#24292E;"> </span><span style="color:#032F62;">blobs</span><span style="color:#24292E;"> </span><span style="color:#032F62;">and</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0</span><span style="color:#24292E;"> </span><span style="color:#032F62;">manifests</span><span style="color:#24292E;"> </span><span style="color:#032F62;">eligible</span><span style="color:#24292E;"> </span><span style="color:#032F62;">for</span><span style="color:#24292E;"> </span><span style="color:#032F62;">deletion</span></span>
<span class="line"><span style="color:#6F42C1;">blob</span><span style="color:#24292E;"> </span><span style="color:#032F62;">eligible</span><span style="color:#24292E;"> </span><span style="color:#032F62;">for</span><span style="color:#24292E;"> </span><span style="color:#032F62;">deletion:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">sha256:d1165f2212346b2bab48cb01c1e39ee8ad1be46b87873d9ca7a4e434980a7726</span></span>
<span class="line"><span style="color:#6F42C1;">。。。。</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">[root@k8s1 v2]# du -hxs </span><span style="color:#D73A49;">*</span></span>
<span class="line"><span style="color:#6F42C1;">0</span><span style="color:#24292E;">	</span><span style="color:#032F62;">blobs</span></span>
<span class="line"><span style="color:#6F42C1;">12K</span><span style="color:#24292E;">	</span><span style="color:#032F62;">repositories</span></span>
<span class="line"><span style="color:#6A737D;">#至此结束</span></span></code></pre></div><blockquote><p>[!TIP]</p><p><strong>1.首先删除image的manifests文件，这个过程需要获得image的digests ID， 而要正确获得该ID， 需要添加特殊的请求头： --header &quot;Accept: application/vnd.docker.distribution.manifest.v2+json&quot; ， 该步骤可以导致pull 操作失效;</strong></p><p><strong>2.需要删除对应的blobs, 这个可以通过: registry garbage-collect CONFIG-FILE 来完成；可以清理掉layer占用的空间问题；</strong></p><p><strong>3.需要删除对应的repository, 这个必须手动删除才可以</strong></p></blockquote><h2 id="client" tabindex="-1">client <a class="header-anchor" href="#client" aria-label="Permalink to &quot;client&quot;">​</a></h2><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">[root@k8s2 </span><span style="color:#F97583;">~</span><span style="color:#E1E4E8;">]# curl 192.168.49.143:5000/v2/_catalog</span></span>
<span class="line"><span style="color:#E1E4E8;">{</span><span style="color:#B392F0;">&quot;repositories&quot;</span><span style="color:#79B8FF;">:</span><span style="color:#E1E4E8;">[</span><span style="color:#B392F0;">&quot;hello-world&quot;</span><span style="color:#B392F0;">]}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">[root@k8s2 </span><span style="color:#F97583;">~</span><span style="color:#E1E4E8;">]# docker pull 192.168.49.143:5000/hello-world</span></span>
<span class="line"><span style="color:#B392F0;">Using</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">default</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">tag:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">latest</span></span>
<span class="line"><span style="color:#B392F0;">latest:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Pulling</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">from</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">hello-world</span></span>
<span class="line"><span style="color:#B392F0;">b8dfde127a29:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Pull</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">complete</span><span style="color:#E1E4E8;"> </span></span>
<span class="line"><span style="color:#B392F0;">Digest:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">sha256:1b26826f602946860c279fce658f31050cff2c596583af237d971f4629b57792</span></span>
<span class="line"><span style="color:#B392F0;">Status:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Downloaded</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">newer</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">image</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">for</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">192.168</span><span style="color:#9ECBFF;">.49.143:5000/hello-world:latest</span></span>
<span class="line"><span style="color:#B392F0;">192.168.49.143:5000/hello-world:latest</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">[root@k8s2 </span><span style="color:#F97583;">~</span><span style="color:#E1E4E8;">]# docker images;</span></span>
<span class="line"><span style="color:#B392F0;">REPOSITORY</span><span style="color:#E1E4E8;">                        </span><span style="color:#9ECBFF;">TAG</span><span style="color:#E1E4E8;">       </span><span style="color:#9ECBFF;">IMAGE</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">ID</span><span style="color:#E1E4E8;">       </span><span style="color:#9ECBFF;">CREATED</span><span style="color:#E1E4E8;">       </span><span style="color:#9ECBFF;">SIZE</span></span>
<span class="line"><span style="color:#B392F0;">192.168.49.143:5000/hello-world</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">latest</span><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">d1165f221234</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">7</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">weeks</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">ago</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">13.3</span><span style="color:#9ECBFF;">kB</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">[root@k8s2 </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# curl 192.168.49.143:5000/v2/_catalog</span></span>
<span class="line"><span style="color:#24292E;">{</span><span style="color:#6F42C1;">&quot;repositories&quot;</span><span style="color:#005CC5;">:</span><span style="color:#24292E;">[</span><span style="color:#6F42C1;">&quot;hello-world&quot;</span><span style="color:#6F42C1;">]}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">[root@k8s2 </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# docker pull 192.168.49.143:5000/hello-world</span></span>
<span class="line"><span style="color:#6F42C1;">Using</span><span style="color:#24292E;"> </span><span style="color:#032F62;">default</span><span style="color:#24292E;"> </span><span style="color:#032F62;">tag:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">latest</span></span>
<span class="line"><span style="color:#6F42C1;">latest:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Pulling</span><span style="color:#24292E;"> </span><span style="color:#032F62;">from</span><span style="color:#24292E;"> </span><span style="color:#032F62;">hello-world</span></span>
<span class="line"><span style="color:#6F42C1;">b8dfde127a29:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Pull</span><span style="color:#24292E;"> </span><span style="color:#032F62;">complete</span><span style="color:#24292E;"> </span></span>
<span class="line"><span style="color:#6F42C1;">Digest:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">sha256:1b26826f602946860c279fce658f31050cff2c596583af237d971f4629b57792</span></span>
<span class="line"><span style="color:#6F42C1;">Status:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Downloaded</span><span style="color:#24292E;"> </span><span style="color:#032F62;">newer</span><span style="color:#24292E;"> </span><span style="color:#032F62;">image</span><span style="color:#24292E;"> </span><span style="color:#032F62;">for</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">192.168</span><span style="color:#032F62;">.49.143:5000/hello-world:latest</span></span>
<span class="line"><span style="color:#6F42C1;">192.168.49.143:5000/hello-world:latest</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">[root@k8s2 </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# docker images;</span></span>
<span class="line"><span style="color:#6F42C1;">REPOSITORY</span><span style="color:#24292E;">                        </span><span style="color:#032F62;">TAG</span><span style="color:#24292E;">       </span><span style="color:#032F62;">IMAGE</span><span style="color:#24292E;"> </span><span style="color:#032F62;">ID</span><span style="color:#24292E;">       </span><span style="color:#032F62;">CREATED</span><span style="color:#24292E;">       </span><span style="color:#032F62;">SIZE</span></span>
<span class="line"><span style="color:#6F42C1;">192.168.49.143:5000/hello-world</span><span style="color:#24292E;">   </span><span style="color:#032F62;">latest</span><span style="color:#24292E;">    </span><span style="color:#032F62;">d1165f221234</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">7</span><span style="color:#24292E;"> </span><span style="color:#032F62;">weeks</span><span style="color:#24292E;"> </span><span style="color:#032F62;">ago</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">13.3</span><span style="color:#032F62;">kB</span></span></code></pre></div><h1 id="_3-用户认证" tabindex="-1">3.用户认证 <a class="header-anchor" href="#_3-用户认证" aria-label="Permalink to &quot;3.用户认证&quot;">​</a></h1><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"></span>
<span class="line"><span style="color:#B392F0;">对用户名和密码，进行base64编码。</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">格式：echo</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-n</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;用户名：密码&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">base64</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">(</span><span style="color:#B392F0;">1</span><span style="color:#E1E4E8;">)携带认证信息发起请求</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">格式：curl</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-v</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-H</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;Authorization: Basic 认证信息&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-X</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">GET</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">https://docker.[yun.ccb.com/v2/]</span><span style="color:#E1E4E8;">(</span><span style="color:#B392F0;">https://docker.yun.ccb.com/v2/</span><span style="color:#E1E4E8;">)</span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">nam</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span><span style="color:#9ECBFF;">/tags/list</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">https://blog.51cto.com/u_14306186/2514802</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"></span>
<span class="line"><span style="color:#6F42C1;">对用户名和密码，进行base64编码。</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">格式：echo</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-n</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;用户名：密码&quot;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">base64</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">(</span><span style="color:#6F42C1;">1</span><span style="color:#24292E;">)携带认证信息发起请求</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">格式：curl</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-v</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-H</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;Authorization: Basic 认证信息&quot;</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-X</span><span style="color:#24292E;"> </span><span style="color:#032F62;">GET</span><span style="color:#24292E;"> </span><span style="color:#032F62;">https://docker.[yun.ccb.com/v2/]</span><span style="color:#24292E;">(</span><span style="color:#6F42C1;">https://docker.yun.ccb.com/v2/</span><span style="color:#24292E;">)</span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">nam</span><span style="color:#24292E;">e</span><span style="color:#D73A49;">&gt;</span><span style="color:#032F62;">/tags/list</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">https://blog.51cto.com/u_14306186/2514802</span></span></code></pre></div>`,29),e=[o];function t(c,r,y,E,i,F){return n(),a("div",null,e)}const g=s(p,[["render",t]]);export{C as __pageData,g as default};
