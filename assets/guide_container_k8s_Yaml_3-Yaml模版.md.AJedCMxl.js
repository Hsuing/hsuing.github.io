import{_ as s,o as n,c as a,R as l}from"./chunks/framework.zUbWieqp.js";const D=JSON.parse('{"title":"1. pod","description":"","frontmatter":{},"headers":[],"relativePath":"guide/container/k8s/Yaml/3-Yaml模版.md","filePath":"guide/container/k8s/Yaml/3-Yaml模版.md","lastUpdated":1720533756000}'),p={name:"guide/container/k8s/Yaml/3-Yaml模版.md"},o=l(`<h1 id="_1-pod" tabindex="-1">1. pod <a class="header-anchor" href="#_1-pod" aria-label="Permalink to &quot;1. pod&quot;">​</a></h1><p>实际生产环境中很少直接创建pod资源，基本都是通过资源控制器对pod进行管理</p><h2 id="_1-1-yaml模板" tabindex="-1">1.1 yaml模板 <a class="header-anchor" href="#_1-1-yaml模板" aria-label="Permalink to &quot;1.1 yaml模板&quot;">​</a></h2><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#85E89D;">apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">v1</span><span style="color:#E1E4E8;">      </span><span style="color:#6A737D;">#必填，版本号</span></span>
<span class="line"><span style="color:#85E89D;">kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Pod</span><span style="color:#E1E4E8;">     </span><span style="color:#6A737D;">#必填，资源类型</span></span>
<span class="line"><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">:       </span><span style="color:#6A737D;">#必填，元数据</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&lt;name&gt;-Deployment</span><span style="color:#E1E4E8;">     </span><span style="color:#6A737D;">#必填，资源名称</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">namespace</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&lt;namespace&gt;</span><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">#Pod所属的命名空间</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">labels</span><span style="color:#E1E4E8;">:      </span><span style="color:#6A737D;">#自定义标签</span></span>
<span class="line"><span style="color:#E1E4E8;">  - </span><span style="color:#85E89D;">key</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&lt;value&gt;</span><span style="color:#E1E4E8;">     </span><span style="color:#6A737D;">#自定义标签名字&lt;key: value&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">annotations</span><span style="color:#E1E4E8;">:        </span><span style="color:#6A737D;">#自定义注解列表  </span></span>
<span class="line"><span style="color:#E1E4E8;">  - </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&lt;string&gt;</span><span style="color:#E1E4E8;">        </span><span style="color:#6A737D;">#自定义注解名字  </span></span>
<span class="line"><span style="color:#85E89D;">spec</span><span style="color:#E1E4E8;">:         </span><span style="color:#6A737D;">#必填，部署的详细定义</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">containers</span><span style="color:#E1E4E8;">:      </span><span style="color:#6A737D;">#必填，定义容器列表</span></span>
<span class="line"><span style="color:#E1E4E8;">  - </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&lt;name&gt;</span><span style="color:#E1E4E8;">     </span><span style="color:#6A737D;">#必填，容器名称</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">image</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&lt;image-name&gt;</span><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">#必填，容器的镜像名称</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">imagePullPolicy</span><span style="color:#E1E4E8;">: [</span><span style="color:#9ECBFF;">Always | Never | IfNotPresent</span><span style="color:#E1E4E8;">] </span><span style="color:#6A737D;">#获取镜像的策略 Alawys表示下载镜像 IfnotPresent表示优先使用本地镜像，否则下载镜像，Nerver表示仅使用本地镜像</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">command</span><span style="color:#E1E4E8;">: [</span><span style="color:#9ECBFF;">array</span><span style="color:#E1E4E8;">]    </span><span style="color:#6A737D;">#容器的启动命令列表，如不指定，使用打包时使用的启动命令</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">args</span><span style="color:#E1E4E8;">: [</span><span style="color:#9ECBFF;">string</span><span style="color:#E1E4E8;">]     </span><span style="color:#6A737D;">#容器的启动命令参数列表</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">workingDir</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">string</span><span style="color:#E1E4E8;">     </span><span style="color:#6A737D;">#选填，容器的工作目录</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">env</span><span style="color:#E1E4E8;">:       </span><span style="color:#6A737D;">#容器运行前需设置的环境变量列表</span></span>
<span class="line"><span style="color:#E1E4E8;">    - </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">string</span><span style="color:#E1E4E8;">     </span><span style="color:#6A737D;">#环境变量名称</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">value</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">string</span><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">#环境变量的值</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">ports</span><span style="color:#E1E4E8;">:       </span><span style="color:#6A737D;">#需要暴露的端口库号列表</span></span>
<span class="line"><span style="color:#E1E4E8;">    - </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">string</span><span style="color:#E1E4E8;">     </span><span style="color:#6A737D;">#端口号名称</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">containerPort</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">int</span><span style="color:#E1E4E8;">   </span><span style="color:#6A737D;">#容器需要监听的端口号</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">hostPort</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">int</span><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">#容器所在主机需要监听的端口号，默认与Container相同</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">protocol</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">string</span><span style="color:#E1E4E8;">     </span><span style="color:#6A737D;">#端口协议，支持TCP和UDP，默认TCP</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">resources</span><span style="color:#E1E4E8;">:       </span><span style="color:#6A737D;">#建议填写，资源限制和请求的设置</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">limits</span><span style="color:#E1E4E8;">:      </span><span style="color:#6A737D;">#资源限制的设置</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">cpu</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">string</span><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">#Cpu的限制，单位为core数，将用于docker run --cpu-shares参数</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">memory</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">string</span><span style="color:#E1E4E8;">     </span><span style="color:#6A737D;">#内存限制，单位可以为Mib/Gib，将用于docker run --memory参数</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">requests</span><span style="color:#E1E4E8;">:      </span><span style="color:#6A737D;">#资源请求的设置</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">cpu</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">string</span><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">#Cpu请求，容器启动的初始可用数量</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">memory</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">string</span><span style="color:#E1E4E8;">     </span><span style="color:#6A737D;">#内存请求，容器启动的初始可用数量</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">volumeMounts</span><span style="color:#E1E4E8;">:    </span><span style="color:#6A737D;">#挂载到容器内部的存储卷配置</span></span>
<span class="line"><span style="color:#E1E4E8;">    - </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">string</span><span style="color:#E1E4E8;">     </span><span style="color:#6A737D;">#引用pod定义的共享存储卷的名称，需用volumes[]部分定义的的卷名</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">mountPath</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">string</span><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">#存储卷在容器内mount的绝对路径，应少于512字符</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">readOnly</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">boolean</span><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">#是否为只读模式</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">livenessProbe</span><span style="color:#E1E4E8;">:     </span><span style="color:#6A737D;">#建议填写，对Pod内个容器健康检查的设置，当探测无响应几次后将自动重启该容器，检查方法有exec、httpGet和tcpSocket，对一个容器只需设置其中一种方法即可</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">exec</span><span style="color:#E1E4E8;">:      </span><span style="color:#6A737D;">#对Pod容器内检查方式设置为exec方式</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">command</span><span style="color:#E1E4E8;">: [</span><span style="color:#9ECBFF;">string</span><span style="color:#E1E4E8;">]  </span><span style="color:#6A737D;">#exec方式需要制定的命令或脚本</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">httpGet</span><span style="color:#E1E4E8;">:       </span><span style="color:#6A737D;">#对Pod内个容器健康检查方法设置为HttpGet，需要制定Path、port</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">path</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">string</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">port</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">number</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">host</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">string</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">scheme</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">string</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">HttpHeaders</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">        - </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">string</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#85E89D;">value</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">string</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">tcpSocket</span><span style="color:#E1E4E8;">:     </span><span style="color:#6A737D;">#对Pod内个容器健康检查方式设置为tcpSocket方式</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">port</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">number</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">initialDelaySeconds</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;">#容器启动完成后首次探测的时间，单位为秒</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">timeoutSeconds</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">   </span><span style="color:#6A737D;">#对容器健康检查探测等待响应的超时时间，单位秒，默认1秒</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">periodSeconds</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">#对容器监控检查的定期探测时间设置，单位秒，默认10秒一次</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">successThreshold</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;">#处于失败状态时，探测操作至少连续多少次的成功才被认为是通过检测，显示为#success属性，默认值为1</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">failureThreshold</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;">#处于成功状态时，探测操作至少连续多少次的失败才被视为是检测不通过，显示为#failure属性，默认值为3</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">imagePullSecrets</span><span style="color:#E1E4E8;">:    </span><span style="color:#6A737D;">#Pull镜像时使用的secret名称，以key：secretkey格式指定</span></span>
<span class="line"><span style="color:#E1E4E8;">    - </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">string</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">hostNetwork</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">false</span><span style="color:#E1E4E8;">      </span><span style="color:#6A737D;">#是否使用主机网络模式，默认为false，如果设置为true，表示使用宿主机网络</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">volumes</span><span style="color:#E1E4E8;">:       </span><span style="color:#6A737D;">#在该pod上定义共享存储卷列表</span></span>
<span class="line"><span style="color:#E1E4E8;">  - </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">string</span><span style="color:#E1E4E8;">     </span><span style="color:#6A737D;">#共享存储卷名称 （volumes类型有很多种）</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">emptyDir</span><span style="color:#E1E4E8;">: {}     </span><span style="color:#6A737D;">#类型为emtyDir的存储卷，与Pod同生命周期的一个临时目录。为空值</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">hostPath</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">string</span><span style="color:#E1E4E8;">     </span><span style="color:#6A737D;">#类型为hostPath的存储卷，表示挂载Pod所在宿主机的目录</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">path</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">string</span><span style="color:#E1E4E8;">     </span><span style="color:#6A737D;">#Pod所在宿主机的目录，将被用于同期中mount的目录</span></span>
<span class="line"><span style="color:#E1E4E8;">  - </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">string</span><span style="color:#E1E4E8;">     </span><span style="color:#6A737D;">#共享存储卷名称</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">secret</span><span style="color:#E1E4E8;">:      </span><span style="color:#6A737D;">#类型为secret的存储卷，挂载集群与定义的secre对象到容器内部</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">scretname</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">string</span><span style="color:#E1E4E8;">  </span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">items</span><span style="color:#E1E4E8;">:     </span></span>
<span class="line"><span style="color:#E1E4E8;">      - </span><span style="color:#85E89D;">key</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">string</span><span style="color:#E1E4E8;">     </span><span style="color:#6A737D;">#选择secrets定义的某个key</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">path</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">string</span><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">#文件内容路径</span></span>
<span class="line"><span style="color:#E1E4E8;">  - </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">string</span><span style="color:#E1E4E8;">     </span><span style="color:#6A737D;">#共享存储卷名称</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">configMap</span><span style="color:#E1E4E8;">:     </span><span style="color:#6A737D;">#类型为configMap的存储卷，挂载预定义的configMap对象到容器内部</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">string</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">items</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      - </span><span style="color:#85E89D;">key</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">string</span><span style="color:#E1E4E8;">     </span><span style="color:#6A737D;">#选择configmap定义的某个key</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">path</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">string</span><span style="color:#E1E4E8;">     </span><span style="color:#6A737D;">#文件内容路径</span></span>
<span class="line"><span style="color:#E1E4E8;">  - </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">string</span><span style="color:#E1E4E8;">     </span><span style="color:#6A737D;">#共享存储卷名称</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">persistentVolumeClaim</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">claimName</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">string</span><span style="color:#E1E4E8;">     </span><span style="color:#6A737D;">#类型为PVC的持久化存储卷</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">affinity</span><span style="color:#E1E4E8;">: </span><span style="color:#6A737D;"># 亲和调度</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">nodeAffinity</span><span style="color:#E1E4E8;">: </span><span style="color:#6A737D;"># 节点亲和调度</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">requiredDuringSchedulingIgnoredDuringExecution</span><span style="color:#E1E4E8;">: </span><span style="color:#6A737D;">#硬亲和调度 或preferredDuringSchedulingIgnoredDuringExecution 软亲和调度</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">nodeSelectorTerms</span><span style="color:#E1E4E8;">: </span><span style="color:#6A737D;"># 选择条件</span></span>
<span class="line"><span style="color:#E1E4E8;">          - </span><span style="color:#85E89D;">matchExpressions</span><span style="color:#E1E4E8;">: </span><span style="color:#6A737D;"># 匹配规则</span></span>
<span class="line"><span style="color:#E1E4E8;">              - </span><span style="color:#85E89D;">key</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">key</span></span>
<span class="line"><span style="color:#E1E4E8;">                </span><span style="color:#85E89D;">operator</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">In</span></span>
<span class="line"><span style="color:#E1E4E8;">                </span><span style="color:#85E89D;">values</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">                  - </span><span style="color:#9ECBFF;">values</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">nodeSelector</span><span style="color:#E1E4E8;">:  </span><span style="color:#6A737D;">#设置NodeSelector表示将该Pod调度到包含这个label的node上</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">string</span><span style="color:#E1E4E8;">     </span><span style="color:#6A737D;">#自定义标签名字&lt;key: value&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">restartPolicy</span><span style="color:#E1E4E8;">: [</span><span style="color:#9ECBFF;">Always | Never | OnFailure</span><span style="color:#E1E4E8;">] </span><span style="color:#6A737D;">#Pod的重启策略，Always表示一旦不管以何种方式终止运行，kubelet都将重启，OnFailure表示只有Pod以非0退出码退出才重启，Nerver表示不再重启该Pod</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#22863A;">apiVersion</span><span style="color:#24292E;">: </span><span style="color:#032F62;">v1</span><span style="color:#24292E;">      </span><span style="color:#6A737D;">#必填，版本号</span></span>
<span class="line"><span style="color:#22863A;">kind</span><span style="color:#24292E;">: </span><span style="color:#032F62;">Pod</span><span style="color:#24292E;">     </span><span style="color:#6A737D;">#必填，资源类型</span></span>
<span class="line"><span style="color:#22863A;">metadata</span><span style="color:#24292E;">:       </span><span style="color:#6A737D;">#必填，元数据</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&lt;name&gt;-Deployment</span><span style="color:#24292E;">     </span><span style="color:#6A737D;">#必填，资源名称</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">namespace</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&lt;namespace&gt;</span><span style="color:#24292E;">    </span><span style="color:#6A737D;">#Pod所属的命名空间</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">labels</span><span style="color:#24292E;">:      </span><span style="color:#6A737D;">#自定义标签</span></span>
<span class="line"><span style="color:#24292E;">  - </span><span style="color:#22863A;">key</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&lt;value&gt;</span><span style="color:#24292E;">     </span><span style="color:#6A737D;">#自定义标签名字&lt;key: value&gt;</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">annotations</span><span style="color:#24292E;">:        </span><span style="color:#6A737D;">#自定义注解列表  </span></span>
<span class="line"><span style="color:#24292E;">  - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&lt;string&gt;</span><span style="color:#24292E;">        </span><span style="color:#6A737D;">#自定义注解名字  </span></span>
<span class="line"><span style="color:#22863A;">spec</span><span style="color:#24292E;">:         </span><span style="color:#6A737D;">#必填，部署的详细定义</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">containers</span><span style="color:#24292E;">:      </span><span style="color:#6A737D;">#必填，定义容器列表</span></span>
<span class="line"><span style="color:#24292E;">  - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&lt;name&gt;</span><span style="color:#24292E;">     </span><span style="color:#6A737D;">#必填，容器名称</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">image</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&lt;image-name&gt;</span><span style="color:#24292E;">    </span><span style="color:#6A737D;">#必填，容器的镜像名称</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">imagePullPolicy</span><span style="color:#24292E;">: [</span><span style="color:#032F62;">Always | Never | IfNotPresent</span><span style="color:#24292E;">] </span><span style="color:#6A737D;">#获取镜像的策略 Alawys表示下载镜像 IfnotPresent表示优先使用本地镜像，否则下载镜像，Nerver表示仅使用本地镜像</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">command</span><span style="color:#24292E;">: [</span><span style="color:#032F62;">array</span><span style="color:#24292E;">]    </span><span style="color:#6A737D;">#容器的启动命令列表，如不指定，使用打包时使用的启动命令</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">args</span><span style="color:#24292E;">: [</span><span style="color:#032F62;">string</span><span style="color:#24292E;">]     </span><span style="color:#6A737D;">#容器的启动命令参数列表</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">workingDir</span><span style="color:#24292E;">: </span><span style="color:#032F62;">string</span><span style="color:#24292E;">     </span><span style="color:#6A737D;">#选填，容器的工作目录</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">env</span><span style="color:#24292E;">:       </span><span style="color:#6A737D;">#容器运行前需设置的环境变量列表</span></span>
<span class="line"><span style="color:#24292E;">    - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">string</span><span style="color:#24292E;">     </span><span style="color:#6A737D;">#环境变量名称</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">value</span><span style="color:#24292E;">: </span><span style="color:#032F62;">string</span><span style="color:#24292E;">    </span><span style="color:#6A737D;">#环境变量的值</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">ports</span><span style="color:#24292E;">:       </span><span style="color:#6A737D;">#需要暴露的端口库号列表</span></span>
<span class="line"><span style="color:#24292E;">    - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">string</span><span style="color:#24292E;">     </span><span style="color:#6A737D;">#端口号名称</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">containerPort</span><span style="color:#24292E;">: </span><span style="color:#032F62;">int</span><span style="color:#24292E;">   </span><span style="color:#6A737D;">#容器需要监听的端口号</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">hostPort</span><span style="color:#24292E;">: </span><span style="color:#032F62;">int</span><span style="color:#24292E;">    </span><span style="color:#6A737D;">#容器所在主机需要监听的端口号，默认与Container相同</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">protocol</span><span style="color:#24292E;">: </span><span style="color:#032F62;">string</span><span style="color:#24292E;">     </span><span style="color:#6A737D;">#端口协议，支持TCP和UDP，默认TCP</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">resources</span><span style="color:#24292E;">:       </span><span style="color:#6A737D;">#建议填写，资源限制和请求的设置</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">limits</span><span style="color:#24292E;">:      </span><span style="color:#6A737D;">#资源限制的设置</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">cpu</span><span style="color:#24292E;">: </span><span style="color:#032F62;">string</span><span style="color:#24292E;">    </span><span style="color:#6A737D;">#Cpu的限制，单位为core数，将用于docker run --cpu-shares参数</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">memory</span><span style="color:#24292E;">: </span><span style="color:#032F62;">string</span><span style="color:#24292E;">     </span><span style="color:#6A737D;">#内存限制，单位可以为Mib/Gib，将用于docker run --memory参数</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">requests</span><span style="color:#24292E;">:      </span><span style="color:#6A737D;">#资源请求的设置</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">cpu</span><span style="color:#24292E;">: </span><span style="color:#032F62;">string</span><span style="color:#24292E;">    </span><span style="color:#6A737D;">#Cpu请求，容器启动的初始可用数量</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">memory</span><span style="color:#24292E;">: </span><span style="color:#032F62;">string</span><span style="color:#24292E;">     </span><span style="color:#6A737D;">#内存请求，容器启动的初始可用数量</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">volumeMounts</span><span style="color:#24292E;">:    </span><span style="color:#6A737D;">#挂载到容器内部的存储卷配置</span></span>
<span class="line"><span style="color:#24292E;">    - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">string</span><span style="color:#24292E;">     </span><span style="color:#6A737D;">#引用pod定义的共享存储卷的名称，需用volumes[]部分定义的的卷名</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">mountPath</span><span style="color:#24292E;">: </span><span style="color:#032F62;">string</span><span style="color:#24292E;">    </span><span style="color:#6A737D;">#存储卷在容器内mount的绝对路径，应少于512字符</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">readOnly</span><span style="color:#24292E;">: </span><span style="color:#032F62;">boolean</span><span style="color:#24292E;">    </span><span style="color:#6A737D;">#是否为只读模式</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">livenessProbe</span><span style="color:#24292E;">:     </span><span style="color:#6A737D;">#建议填写，对Pod内个容器健康检查的设置，当探测无响应几次后将自动重启该容器，检查方法有exec、httpGet和tcpSocket，对一个容器只需设置其中一种方法即可</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">exec</span><span style="color:#24292E;">:      </span><span style="color:#6A737D;">#对Pod容器内检查方式设置为exec方式</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">command</span><span style="color:#24292E;">: [</span><span style="color:#032F62;">string</span><span style="color:#24292E;">]  </span><span style="color:#6A737D;">#exec方式需要制定的命令或脚本</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">httpGet</span><span style="color:#24292E;">:       </span><span style="color:#6A737D;">#对Pod内个容器健康检查方法设置为HttpGet，需要制定Path、port</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">path</span><span style="color:#24292E;">: </span><span style="color:#032F62;">string</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">port</span><span style="color:#24292E;">: </span><span style="color:#032F62;">number</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">host</span><span style="color:#24292E;">: </span><span style="color:#032F62;">string</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">scheme</span><span style="color:#24292E;">: </span><span style="color:#032F62;">string</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">HttpHeaders</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">        - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">string</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#22863A;">value</span><span style="color:#24292E;">: </span><span style="color:#032F62;">string</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">tcpSocket</span><span style="color:#24292E;">:     </span><span style="color:#6A737D;">#对Pod内个容器健康检查方式设置为tcpSocket方式</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">port</span><span style="color:#24292E;">: </span><span style="color:#032F62;">number</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">initialDelaySeconds</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">  </span><span style="color:#6A737D;">#容器启动完成后首次探测的时间，单位为秒</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">timeoutSeconds</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">   </span><span style="color:#6A737D;">#对容器健康检查探测等待响应的超时时间，单位秒，默认1秒</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">periodSeconds</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">    </span><span style="color:#6A737D;">#对容器监控检查的定期探测时间设置，单位秒，默认10秒一次</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">successThreshold</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">0</span><span style="color:#24292E;"> </span><span style="color:#6A737D;">#处于失败状态时，探测操作至少连续多少次的成功才被认为是通过检测，显示为#success属性，默认值为1</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">failureThreshold</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">0</span><span style="color:#24292E;"> </span><span style="color:#6A737D;">#处于成功状态时，探测操作至少连续多少次的失败才被视为是检测不通过，显示为#failure属性，默认值为3</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">imagePullSecrets</span><span style="color:#24292E;">:    </span><span style="color:#6A737D;">#Pull镜像时使用的secret名称，以key：secretkey格式指定</span></span>
<span class="line"><span style="color:#24292E;">    - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">string</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">hostNetwork</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">false</span><span style="color:#24292E;">      </span><span style="color:#6A737D;">#是否使用主机网络模式，默认为false，如果设置为true，表示使用宿主机网络</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">volumes</span><span style="color:#24292E;">:       </span><span style="color:#6A737D;">#在该pod上定义共享存储卷列表</span></span>
<span class="line"><span style="color:#24292E;">  - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">string</span><span style="color:#24292E;">     </span><span style="color:#6A737D;">#共享存储卷名称 （volumes类型有很多种）</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">emptyDir</span><span style="color:#24292E;">: {}     </span><span style="color:#6A737D;">#类型为emtyDir的存储卷，与Pod同生命周期的一个临时目录。为空值</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">hostPath</span><span style="color:#24292E;">: </span><span style="color:#032F62;">string</span><span style="color:#24292E;">     </span><span style="color:#6A737D;">#类型为hostPath的存储卷，表示挂载Pod所在宿主机的目录</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">path</span><span style="color:#24292E;">: </span><span style="color:#032F62;">string</span><span style="color:#24292E;">     </span><span style="color:#6A737D;">#Pod所在宿主机的目录，将被用于同期中mount的目录</span></span>
<span class="line"><span style="color:#24292E;">  - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">string</span><span style="color:#24292E;">     </span><span style="color:#6A737D;">#共享存储卷名称</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">secret</span><span style="color:#24292E;">:      </span><span style="color:#6A737D;">#类型为secret的存储卷，挂载集群与定义的secre对象到容器内部</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">scretname</span><span style="color:#24292E;">: </span><span style="color:#032F62;">string</span><span style="color:#24292E;">  </span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">items</span><span style="color:#24292E;">:     </span></span>
<span class="line"><span style="color:#24292E;">      - </span><span style="color:#22863A;">key</span><span style="color:#24292E;">: </span><span style="color:#032F62;">string</span><span style="color:#24292E;">     </span><span style="color:#6A737D;">#选择secrets定义的某个key</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">path</span><span style="color:#24292E;">: </span><span style="color:#032F62;">string</span><span style="color:#24292E;">    </span><span style="color:#6A737D;">#文件内容路径</span></span>
<span class="line"><span style="color:#24292E;">  - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">string</span><span style="color:#24292E;">     </span><span style="color:#6A737D;">#共享存储卷名称</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">configMap</span><span style="color:#24292E;">:     </span><span style="color:#6A737D;">#类型为configMap的存储卷，挂载预定义的configMap对象到容器内部</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">string</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">items</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      - </span><span style="color:#22863A;">key</span><span style="color:#24292E;">: </span><span style="color:#032F62;">string</span><span style="color:#24292E;">     </span><span style="color:#6A737D;">#选择configmap定义的某个key</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">path</span><span style="color:#24292E;">: </span><span style="color:#032F62;">string</span><span style="color:#24292E;">     </span><span style="color:#6A737D;">#文件内容路径</span></span>
<span class="line"><span style="color:#24292E;">  - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">string</span><span style="color:#24292E;">     </span><span style="color:#6A737D;">#共享存储卷名称</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">persistentVolumeClaim</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">claimName</span><span style="color:#24292E;">: </span><span style="color:#032F62;">string</span><span style="color:#24292E;">     </span><span style="color:#6A737D;">#类型为PVC的持久化存储卷</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">affinity</span><span style="color:#24292E;">: </span><span style="color:#6A737D;"># 亲和调度</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">nodeAffinity</span><span style="color:#24292E;">: </span><span style="color:#6A737D;"># 节点亲和调度</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">requiredDuringSchedulingIgnoredDuringExecution</span><span style="color:#24292E;">: </span><span style="color:#6A737D;">#硬亲和调度 或preferredDuringSchedulingIgnoredDuringExecution 软亲和调度</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">nodeSelectorTerms</span><span style="color:#24292E;">: </span><span style="color:#6A737D;"># 选择条件</span></span>
<span class="line"><span style="color:#24292E;">          - </span><span style="color:#22863A;">matchExpressions</span><span style="color:#24292E;">: </span><span style="color:#6A737D;"># 匹配规则</span></span>
<span class="line"><span style="color:#24292E;">              - </span><span style="color:#22863A;">key</span><span style="color:#24292E;">: </span><span style="color:#032F62;">key</span></span>
<span class="line"><span style="color:#24292E;">                </span><span style="color:#22863A;">operator</span><span style="color:#24292E;">: </span><span style="color:#032F62;">In</span></span>
<span class="line"><span style="color:#24292E;">                </span><span style="color:#22863A;">values</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">                  - </span><span style="color:#032F62;">values</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">nodeSelector</span><span style="color:#24292E;">:  </span><span style="color:#6A737D;">#设置NodeSelector表示将该Pod调度到包含这个label的node上</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">string</span><span style="color:#24292E;">     </span><span style="color:#6A737D;">#自定义标签名字&lt;key: value&gt;</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">restartPolicy</span><span style="color:#24292E;">: [</span><span style="color:#032F62;">Always | Never | OnFailure</span><span style="color:#24292E;">] </span><span style="color:#6A737D;">#Pod的重启策略，Always表示一旦不管以何种方式终止运行，kubelet都将重启，OnFailure表示只有Pod以非0退出码退出才重启，Nerver表示不再重启该Pod</span></span></code></pre></div><ul><li>简单例子</li></ul><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#85E89D;">apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">v1</span></span>
<span class="line"><span style="color:#85E89D;">kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Pod</span></span>
<span class="line"><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">busybox-pod</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">namespace</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">test</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">labels</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">busybox-pod</span></span>
<span class="line"><span style="color:#85E89D;">spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">containers</span><span style="color:#E1E4E8;">: </span></span>
<span class="line"><span style="color:#E1E4E8;">  - </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">busybox</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">image</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">busybox:latest</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">imagePullPolicy</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">IfNotPresent</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">command</span><span style="color:#E1E4E8;">: [</span><span style="color:#9ECBFF;">&quot;/bin/sh&quot;</span><span style="color:#E1E4E8;">,</span><span style="color:#9ECBFF;">&quot;-c&quot;</span><span style="color:#E1E4E8;">,</span><span style="color:#9ECBFF;">&quot;while true;do echo hello;sleep 1;done&quot;</span><span style="color:#E1E4E8;">]</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">restartPolicy</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Always</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#22863A;">apiVersion</span><span style="color:#24292E;">: </span><span style="color:#032F62;">v1</span></span>
<span class="line"><span style="color:#22863A;">kind</span><span style="color:#24292E;">: </span><span style="color:#032F62;">Pod</span></span>
<span class="line"><span style="color:#22863A;">metadata</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">busybox-pod</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">namespace</span><span style="color:#24292E;">: </span><span style="color:#032F62;">test</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">labels</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">busybox-pod</span></span>
<span class="line"><span style="color:#22863A;">spec</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">containers</span><span style="color:#24292E;">: </span></span>
<span class="line"><span style="color:#24292E;">  - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">busybox</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">image</span><span style="color:#24292E;">: </span><span style="color:#032F62;">busybox:latest</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">imagePullPolicy</span><span style="color:#24292E;">: </span><span style="color:#032F62;">IfNotPresent</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">command</span><span style="color:#24292E;">: [</span><span style="color:#032F62;">&quot;/bin/sh&quot;</span><span style="color:#24292E;">,</span><span style="color:#032F62;">&quot;-c&quot;</span><span style="color:#24292E;">,</span><span style="color:#032F62;">&quot;while true;do echo hello;sleep 1;done&quot;</span><span style="color:#24292E;">]</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">restartPolicy</span><span style="color:#24292E;">: </span><span style="color:#032F62;">Always</span></span></code></pre></div><h1 id="_2-资源控制器" tabindex="-1">2. 资源控制器 <a class="header-anchor" href="#_2-资源控制器" aria-label="Permalink to &quot;2. 资源控制器&quot;">​</a></h1><h2 id="_2-1-deployment" tabindex="-1">2.1 Deployment <a class="header-anchor" href="#_2-1-deployment" aria-label="Permalink to &quot;2.1 Deployment&quot;">​</a></h2><ul><li>yaml模板</li></ul><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#85E89D;">apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">apps/v1</span><span style="color:#E1E4E8;">      </span><span style="color:#6A737D;">#必填，版本号</span></span>
<span class="line"><span style="color:#85E89D;">kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Depolyment</span><span style="color:#E1E4E8;">     </span><span style="color:#6A737D;">#必填，资源类型</span></span>
<span class="line"><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">:       </span><span style="color:#6A737D;">#必填，元数据</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&lt;name&gt;-deploy</span><span style="color:#E1E4E8;">     </span><span style="color:#6A737D;">#必填，资源名称</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">namespace</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&lt;namespace&gt;</span><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">#Pod所属的命名空间</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">labels</span><span style="color:#E1E4E8;">:      </span><span style="color:#6A737D;">#自定义标签</span></span>
<span class="line"><span style="color:#E1E4E8;">    - </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">string</span><span style="color:#E1E4E8;">     </span><span style="color:#6A737D;">#自定义标签名字&lt;key: value&gt;</span></span>
<span class="line"><span style="color:#85E89D;">spec</span><span style="color:#E1E4E8;">:         </span><span style="color:#6A737D;">#必填，部署的详细定义</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">selector</span><span style="color:#E1E4E8;">: </span><span style="color:#6A737D;">#必填，标签选择</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">matchLabels</span><span style="color:#E1E4E8;">: </span><span style="color:#6A737D;">#必填，标签匹配</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&lt;name&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;">#必填，通过此标签匹配对应pod&lt;key: value&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">replicas</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&lt;number&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;">#必填，副本数量</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">minReadySeconds</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">int</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;">#新创建的Pod状态为Ready持续的时间</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">revisionHistoryLimit</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">int</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;">#保留的历史版本个数，默认是10</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">minAvailable</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">int</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;">#Pod自愿中断的场景中，至少要保证可用的Pod对象数量或比例，要阻止任何Pod对象发生自愿中断，可将其设置为100%。</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">maxUnavailable</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">int</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;">#Pod自愿中断的场景中，最多可转换为不可用状态的Pod对象数量或比例，0值意味着不允许Pod对象进行自愿中断；此字段与minAvailable互斥</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">strategy</span><span style="color:#E1E4E8;">: </span><span style="color:#6A737D;">#版本更新控制</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">type</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">RollingUpdate</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;">#更新策略，滚动更新（也可以是Recreate 重建更新）</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">rollingUpdate</span><span style="color:#E1E4E8;">: </span><span style="color:#6A737D;">#滚动更新配置</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">maxSurge</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">int</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;">#升级期间存在的总Pod对象数量最多不超过多少（百分比）</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">maxUnavailable</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">int</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;">#升级期间正常可用的Pod副本数（包括新旧版本）不低于多少（百分比）</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">template</span><span style="color:#E1E4E8;">: </span><span style="color:#6A737D;">#必填，应用容器模版定义</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">: </span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">labels</span><span style="color:#E1E4E8;">: </span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&lt;name&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;">#必填，与上面matchLabels的标签相同</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">spec</span><span style="color:#E1E4E8;">: </span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">containers</span><span style="color:#E1E4E8;">: </span><span style="color:#6A737D;">#此处参考pod的containers</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#22863A;">apiVersion</span><span style="color:#24292E;">: </span><span style="color:#032F62;">apps/v1</span><span style="color:#24292E;">      </span><span style="color:#6A737D;">#必填，版本号</span></span>
<span class="line"><span style="color:#22863A;">kind</span><span style="color:#24292E;">: </span><span style="color:#032F62;">Depolyment</span><span style="color:#24292E;">     </span><span style="color:#6A737D;">#必填，资源类型</span></span>
<span class="line"><span style="color:#22863A;">metadata</span><span style="color:#24292E;">:       </span><span style="color:#6A737D;">#必填，元数据</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&lt;name&gt;-deploy</span><span style="color:#24292E;">     </span><span style="color:#6A737D;">#必填，资源名称</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">namespace</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&lt;namespace&gt;</span><span style="color:#24292E;">    </span><span style="color:#6A737D;">#Pod所属的命名空间</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">labels</span><span style="color:#24292E;">:      </span><span style="color:#6A737D;">#自定义标签</span></span>
<span class="line"><span style="color:#24292E;">    - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">string</span><span style="color:#24292E;">     </span><span style="color:#6A737D;">#自定义标签名字&lt;key: value&gt;</span></span>
<span class="line"><span style="color:#22863A;">spec</span><span style="color:#24292E;">:         </span><span style="color:#6A737D;">#必填，部署的详细定义</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">selector</span><span style="color:#24292E;">: </span><span style="color:#6A737D;">#必填，标签选择</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">matchLabels</span><span style="color:#24292E;">: </span><span style="color:#6A737D;">#必填，标签匹配</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&lt;name&gt;</span><span style="color:#24292E;"> </span><span style="color:#6A737D;">#必填，通过此标签匹配对应pod&lt;key: value&gt;</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">replicas</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&lt;number&gt;</span><span style="color:#24292E;"> </span><span style="color:#6A737D;">#必填，副本数量</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">minReadySeconds</span><span style="color:#24292E;">: </span><span style="color:#032F62;">int</span><span style="color:#24292E;"> </span><span style="color:#6A737D;">#新创建的Pod状态为Ready持续的时间</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">revisionHistoryLimit</span><span style="color:#24292E;">: </span><span style="color:#032F62;">int</span><span style="color:#24292E;"> </span><span style="color:#6A737D;">#保留的历史版本个数，默认是10</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">minAvailable</span><span style="color:#24292E;">: </span><span style="color:#032F62;">int</span><span style="color:#24292E;"> </span><span style="color:#6A737D;">#Pod自愿中断的场景中，至少要保证可用的Pod对象数量或比例，要阻止任何Pod对象发生自愿中断，可将其设置为100%。</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">maxUnavailable</span><span style="color:#24292E;">: </span><span style="color:#032F62;">int</span><span style="color:#24292E;"> </span><span style="color:#6A737D;">#Pod自愿中断的场景中，最多可转换为不可用状态的Pod对象数量或比例，0值意味着不允许Pod对象进行自愿中断；此字段与minAvailable互斥</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">strategy</span><span style="color:#24292E;">: </span><span style="color:#6A737D;">#版本更新控制</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">type</span><span style="color:#24292E;">: </span><span style="color:#032F62;">RollingUpdate</span><span style="color:#24292E;"> </span><span style="color:#6A737D;">#更新策略，滚动更新（也可以是Recreate 重建更新）</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">rollingUpdate</span><span style="color:#24292E;">: </span><span style="color:#6A737D;">#滚动更新配置</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">maxSurge</span><span style="color:#24292E;">: </span><span style="color:#032F62;">int</span><span style="color:#24292E;"> </span><span style="color:#6A737D;">#升级期间存在的总Pod对象数量最多不超过多少（百分比）</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">maxUnavailable</span><span style="color:#24292E;">: </span><span style="color:#032F62;">int</span><span style="color:#24292E;"> </span><span style="color:#6A737D;">#升级期间正常可用的Pod副本数（包括新旧版本）不低于多少（百分比）</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">template</span><span style="color:#24292E;">: </span><span style="color:#6A737D;">#必填，应用容器模版定义</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">metadata</span><span style="color:#24292E;">: </span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">labels</span><span style="color:#24292E;">: </span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&lt;name&gt;</span><span style="color:#24292E;"> </span><span style="color:#6A737D;">#必填，与上面matchLabels的标签相同</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">spec</span><span style="color:#24292E;">: </span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">containers</span><span style="color:#24292E;">: </span><span style="color:#6A737D;">#此处参考pod的containers</span></span></code></pre></div><ul><li>yaml示例</li></ul><blockquote><p>建议生产环境为资源添加limit和liveness</p></blockquote><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#85E89D;">apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">apps/v1</span></span>
<span class="line"><span style="color:#85E89D;">kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Deployment</span></span>
<span class="line"><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">namespace</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">test</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">grafana-alert-deploy</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">labels</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">grafana-alert-deploy</span></span>
<span class="line"><span style="color:#85E89D;">spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">replicas</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">2</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">selector</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">matchLabels</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">grafanaAlert</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">template</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">labels</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">grafanaAlert</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">containers</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      - </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">grafana-alert</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">image</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">grafana_alert:cm_v2</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">imagePullPolicy</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">IfNotPresent</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">command</span><span style="color:#E1E4E8;">: [</span><span style="color:#9ECBFF;">&quot;python3.8&quot;</span><span style="color:#E1E4E8;">,</span><span style="color:#9ECBFF;">&quot;-u&quot;</span><span style="color:#E1E4E8;">,</span><span style="color:#9ECBFF;">&quot;-m&quot;</span><span style="color:#E1E4E8;">,</span><span style="color:#9ECBFF;">&quot;flask&quot;</span><span style="color:#E1E4E8;">,</span><span style="color:#9ECBFF;">&quot;run&quot;</span><span style="color:#E1E4E8;">,</span><span style="color:#9ECBFF;">&quot;-h&quot;</span><span style="color:#E1E4E8;">,</span><span style="color:#9ECBFF;">&quot;0.0.0.0&quot;</span><span style="color:#E1E4E8;">,</span><span style="color:#9ECBFF;">&quot;-p&quot;</span><span style="color:#E1E4E8;">,</span><span style="color:#9ECBFF;">&quot;9999&quot;</span><span style="color:#E1E4E8;">]</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">ports</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">        - </span><span style="color:#85E89D;">containerPort</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">9999</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#85E89D;">protocol</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">TCP</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">volumeMounts</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">        - </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">grafana-alert-log</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#85E89D;">mountPath</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">/opt/grafanaAlert/log</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">readinessProbe</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#85E89D;">tcpSocket</span><span style="color:#E1E4E8;">: </span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#85E89D;">port</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">9999</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">livenessProbe</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#85E89D;">tcpSocket</span><span style="color:#E1E4E8;">: </span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#85E89D;">port</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">9999</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">resources</span><span style="color:#E1E4E8;">:    </span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#85E89D;">limits</span><span style="color:#E1E4E8;">:   </span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#85E89D;">cpu</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">1</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#85E89D;">memory</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">100Mi</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#85E89D;">requests</span><span style="color:#E1E4E8;">:     </span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#85E89D;">cpu</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">100m</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#85E89D;">memory</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">10Mi</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">volumes</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      - </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">grafana-alert-log</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">hostPath</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#85E89D;">path</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">/var/log/grafana-alert</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#85E89D;">type</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Directory</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">affinity</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">nodeAffinity</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#85E89D;">requiredDuringSchedulingIgnoredDuringExecution</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#85E89D;">nodeSelectorTerms</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">              - </span><span style="color:#85E89D;">matchExpressions</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">                  - </span><span style="color:#85E89D;">key</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">role</span></span>
<span class="line"><span style="color:#E1E4E8;">                    </span><span style="color:#85E89D;">operator</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">In</span></span>
<span class="line"><span style="color:#E1E4E8;">                    </span><span style="color:#85E89D;">values</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">                      - </span><span style="color:#9ECBFF;">removable</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">dnsPolicy</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">ClusterFirst</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">restartPolicy</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Always</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#22863A;">apiVersion</span><span style="color:#24292E;">: </span><span style="color:#032F62;">apps/v1</span></span>
<span class="line"><span style="color:#22863A;">kind</span><span style="color:#24292E;">: </span><span style="color:#032F62;">Deployment</span></span>
<span class="line"><span style="color:#22863A;">metadata</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">namespace</span><span style="color:#24292E;">: </span><span style="color:#032F62;">test</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">grafana-alert-deploy</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">labels</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">grafana-alert-deploy</span></span>
<span class="line"><span style="color:#22863A;">spec</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">replicas</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">2</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">selector</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">matchLabels</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">grafanaAlert</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">template</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">metadata</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">labels</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">grafanaAlert</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">spec</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">containers</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">grafana-alert</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">image</span><span style="color:#24292E;">: </span><span style="color:#032F62;">grafana_alert:cm_v2</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">imagePullPolicy</span><span style="color:#24292E;">: </span><span style="color:#032F62;">IfNotPresent</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">command</span><span style="color:#24292E;">: [</span><span style="color:#032F62;">&quot;python3.8&quot;</span><span style="color:#24292E;">,</span><span style="color:#032F62;">&quot;-u&quot;</span><span style="color:#24292E;">,</span><span style="color:#032F62;">&quot;-m&quot;</span><span style="color:#24292E;">,</span><span style="color:#032F62;">&quot;flask&quot;</span><span style="color:#24292E;">,</span><span style="color:#032F62;">&quot;run&quot;</span><span style="color:#24292E;">,</span><span style="color:#032F62;">&quot;-h&quot;</span><span style="color:#24292E;">,</span><span style="color:#032F62;">&quot;0.0.0.0&quot;</span><span style="color:#24292E;">,</span><span style="color:#032F62;">&quot;-p&quot;</span><span style="color:#24292E;">,</span><span style="color:#032F62;">&quot;9999&quot;</span><span style="color:#24292E;">]</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">ports</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">        - </span><span style="color:#22863A;">containerPort</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">9999</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#22863A;">protocol</span><span style="color:#24292E;">: </span><span style="color:#032F62;">TCP</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">volumeMounts</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">        - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">grafana-alert-log</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#22863A;">mountPath</span><span style="color:#24292E;">: </span><span style="color:#032F62;">/opt/grafanaAlert/log</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">readinessProbe</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#22863A;">tcpSocket</span><span style="color:#24292E;">: </span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#22863A;">port</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">9999</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">livenessProbe</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#22863A;">tcpSocket</span><span style="color:#24292E;">: </span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#22863A;">port</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">9999</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">resources</span><span style="color:#24292E;">:    </span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#22863A;">limits</span><span style="color:#24292E;">:   </span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#22863A;">cpu</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">1</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#22863A;">memory</span><span style="color:#24292E;">: </span><span style="color:#032F62;">100Mi</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#22863A;">requests</span><span style="color:#24292E;">:     </span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#22863A;">cpu</span><span style="color:#24292E;">: </span><span style="color:#032F62;">100m</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#22863A;">memory</span><span style="color:#24292E;">: </span><span style="color:#032F62;">10Mi</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">volumes</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">grafana-alert-log</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">hostPath</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#22863A;">path</span><span style="color:#24292E;">: </span><span style="color:#032F62;">/var/log/grafana-alert</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#22863A;">type</span><span style="color:#24292E;">: </span><span style="color:#032F62;">Directory</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">affinity</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">nodeAffinity</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#22863A;">requiredDuringSchedulingIgnoredDuringExecution</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#22863A;">nodeSelectorTerms</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">              - </span><span style="color:#22863A;">matchExpressions</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">                  - </span><span style="color:#22863A;">key</span><span style="color:#24292E;">: </span><span style="color:#032F62;">role</span></span>
<span class="line"><span style="color:#24292E;">                    </span><span style="color:#22863A;">operator</span><span style="color:#24292E;">: </span><span style="color:#032F62;">In</span></span>
<span class="line"><span style="color:#24292E;">                    </span><span style="color:#22863A;">values</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">                      - </span><span style="color:#032F62;">removable</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">dnsPolicy</span><span style="color:#24292E;">: </span><span style="color:#032F62;">ClusterFirst</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">restartPolicy</span><span style="color:#24292E;">: </span><span style="color:#032F62;">Always</span></span></code></pre></div><h2 id="_2-2-daemonset" tabindex="-1">2.2 DaemonSet <a class="header-anchor" href="#_2-2-daemonset" aria-label="Permalink to &quot;2.2 DaemonSet&quot;">​</a></h2><blockquote><p>DaemonSet除了不用设置replicas，其他的与Deployment一致</p></blockquote><ul><li>yaml模板</li></ul><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#85E89D;">apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">apps/v1</span><span style="color:#E1E4E8;">      </span><span style="color:#6A737D;">#必填，版本号</span></span>
<span class="line"><span style="color:#85E89D;">kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">DaemonSet</span><span style="color:#E1E4E8;">     </span><span style="color:#6A737D;">#必填，资源类型</span></span>
<span class="line"><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">:       </span><span style="color:#6A737D;">#必填，元数据</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&lt;name&gt;-ds</span><span style="color:#E1E4E8;">     </span><span style="color:#6A737D;">#必填，资源名称</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">namespace</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&lt;namespace&gt;</span><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">#Pod所属的命名空间</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">labels</span><span style="color:#E1E4E8;">:      </span><span style="color:#6A737D;">#自定义标签</span></span>
<span class="line"><span style="color:#E1E4E8;">    - </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">string</span><span style="color:#E1E4E8;">     </span><span style="color:#6A737D;">#自定义标签名字&lt;key: value&gt;</span></span>
<span class="line"><span style="color:#85E89D;">spec</span><span style="color:#E1E4E8;">:         </span><span style="color:#6A737D;">#必填，部署的详细定义</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">selector</span><span style="color:#E1E4E8;">: </span><span style="color:#6A737D;">#必填，标签选择</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">matchLabels</span><span style="color:#E1E4E8;">: </span><span style="color:#6A737D;">#必填，标签匹配</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&lt;name&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;">#必填，通过此标签匹配对应pod&lt;key: value&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">template</span><span style="color:#E1E4E8;">: </span><span style="color:#6A737D;">#必填，应用容器模版定义</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">: </span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">labels</span><span style="color:#E1E4E8;">: </span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&lt;name&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;">#必填，与上面matchLabels的标签相同</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">spec</span><span style="color:#E1E4E8;">: </span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">containers</span><span style="color:#E1E4E8;">: </span><span style="color:#6A737D;">#此处参考pod的containers</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#22863A;">apiVersion</span><span style="color:#24292E;">: </span><span style="color:#032F62;">apps/v1</span><span style="color:#24292E;">      </span><span style="color:#6A737D;">#必填，版本号</span></span>
<span class="line"><span style="color:#22863A;">kind</span><span style="color:#24292E;">: </span><span style="color:#032F62;">DaemonSet</span><span style="color:#24292E;">     </span><span style="color:#6A737D;">#必填，资源类型</span></span>
<span class="line"><span style="color:#22863A;">metadata</span><span style="color:#24292E;">:       </span><span style="color:#6A737D;">#必填，元数据</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&lt;name&gt;-ds</span><span style="color:#24292E;">     </span><span style="color:#6A737D;">#必填，资源名称</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">namespace</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&lt;namespace&gt;</span><span style="color:#24292E;">    </span><span style="color:#6A737D;">#Pod所属的命名空间</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">labels</span><span style="color:#24292E;">:      </span><span style="color:#6A737D;">#自定义标签</span></span>
<span class="line"><span style="color:#24292E;">    - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">string</span><span style="color:#24292E;">     </span><span style="color:#6A737D;">#自定义标签名字&lt;key: value&gt;</span></span>
<span class="line"><span style="color:#22863A;">spec</span><span style="color:#24292E;">:         </span><span style="color:#6A737D;">#必填，部署的详细定义</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">selector</span><span style="color:#24292E;">: </span><span style="color:#6A737D;">#必填，标签选择</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">matchLabels</span><span style="color:#24292E;">: </span><span style="color:#6A737D;">#必填，标签匹配</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&lt;name&gt;</span><span style="color:#24292E;"> </span><span style="color:#6A737D;">#必填，通过此标签匹配对应pod&lt;key: value&gt;</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">template</span><span style="color:#24292E;">: </span><span style="color:#6A737D;">#必填，应用容器模版定义</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">metadata</span><span style="color:#24292E;">: </span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">labels</span><span style="color:#24292E;">: </span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&lt;name&gt;</span><span style="color:#24292E;"> </span><span style="color:#6A737D;">#必填，与上面matchLabels的标签相同</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">spec</span><span style="color:#24292E;">: </span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">containers</span><span style="color:#24292E;">: </span><span style="color:#6A737D;">#此处参考pod的containers</span></span></code></pre></div><ul><li>yaml示例：</li></ul><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#85E89D;">apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">apps/v1</span></span>
<span class="line"><span style="color:#85E89D;">kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">DaemonSet</span></span>
<span class="line"><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">labels</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">app</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">node-exporter-ds</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">node-exporter-ds</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">namespace</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">test</span></span>
<span class="line"><span style="color:#85E89D;">spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">selector</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">matchLabels</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">app</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">node-exporter</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">template</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">labels</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">app</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">node-exporter</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">containers</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      - </span><span style="color:#85E89D;">args</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">        - </span><span style="color:#9ECBFF;">--web.listen-address=127.0.0.1:9100</span></span>
<span class="line"><span style="color:#E1E4E8;">        - </span><span style="color:#9ECBFF;">--path.procfs=/host/proc</span></span>
<span class="line"><span style="color:#E1E4E8;">        - </span><span style="color:#9ECBFF;">--path.sysfs=/host/sys</span></span>
<span class="line"><span style="color:#E1E4E8;">        - </span><span style="color:#9ECBFF;">--path.rootfs=/host/root</span></span>
<span class="line"><span style="color:#E1E4E8;">        - </span><span style="color:#9ECBFF;">--collector.filesystem.ignored-mount-points=^/(dev|proc|sys|var/lib/docker/.+)($|/)</span></span>
<span class="line"><span style="color:#E1E4E8;">        - </span><span style="color:#9ECBFF;">--collector.filesystem.ignored-fs-types=^(autofs|binfmt_misc|cgroup|configfs|debugfs|devpts|devtmpfs|fusectl|hugetlbfs|mqueue|overlay|proc|procfs|pstore|rpc_pipefs|securityfs|sysfs|tracefs)$</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">image</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">prometheus/node-exporter:v0.18.1</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">node-exporter</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">resources</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#85E89D;">limits</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#85E89D;">cpu</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">250m</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#85E89D;">memory</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">180Mi</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#85E89D;">requests</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#85E89D;">cpu</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">102m</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#85E89D;">memory</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">180Mi</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">volumeMounts</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">        - </span><span style="color:#85E89D;">mountPath</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">/host/proc</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">proc</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#85E89D;">readOnly</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">false</span></span>
<span class="line"><span style="color:#E1E4E8;">        - </span><span style="color:#85E89D;">mountPath</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">/host/sys</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">sys</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#85E89D;">readOnly</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">false</span></span>
<span class="line"><span style="color:#E1E4E8;">        - </span><span style="color:#85E89D;">mountPath</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">/host/root</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#85E89D;">mountPropagation</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">HostToContainer</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">root</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#85E89D;">readOnly</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">true</span></span>
<span class="line"><span style="color:#E1E4E8;">      - </span><span style="color:#85E89D;">args</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">        - </span><span style="color:#9ECBFF;">--logtostderr</span></span>
<span class="line"><span style="color:#E1E4E8;">        - </span><span style="color:#9ECBFF;">--secure-listen-address=$(IP):9100</span></span>
<span class="line"><span style="color:#E1E4E8;">        - </span><span style="color:#9ECBFF;">--tls-cipher-suites=TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_RSA_WITH_AES_128_CBC_SHA256,TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA256,TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA256</span></span>
<span class="line"><span style="color:#E1E4E8;">        - </span><span style="color:#9ECBFF;">--upstream=http://127.0.0.1:9100/</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">env</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">        - </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">IP</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#85E89D;">valueFrom</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#85E89D;">fieldRef</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">              </span><span style="color:#85E89D;">fieldPath</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">status.podIP</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">image</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">172.16.140.21/prometheus/kube-rbac-proxy:v0.4.1</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">kube-rbac-proxy</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">ports</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">        - </span><span style="color:#85E89D;">containerPort</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">9100</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#85E89D;">hostPort</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">9100</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">https</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">resources</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#85E89D;">limits</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#85E89D;">cpu</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">20m</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#85E89D;">memory</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">60Mi</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#85E89D;">requests</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#85E89D;">cpu</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">10m</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#85E89D;">memory</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">20Mi</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">hostNetwork</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">true</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">hostPID</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">true</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">nodeSelector</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">kubernetes.io/os</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">linux</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">securityContext</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">runAsNonRoot</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">true</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">runAsUser</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">65534</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">serviceAccountName</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">node-exporter</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">tolerations</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      - </span><span style="color:#85E89D;">operator</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Exists</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">volumes</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      - </span><span style="color:#85E89D;">hostPath</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#85E89D;">path</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">/proc</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">proc</span></span>
<span class="line"><span style="color:#E1E4E8;">      - </span><span style="color:#85E89D;">hostPath</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#85E89D;">path</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">/sys</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">sys</span></span>
<span class="line"><span style="color:#E1E4E8;">      - </span><span style="color:#85E89D;">hostPath</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#85E89D;">path</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">/</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">root</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#22863A;">apiVersion</span><span style="color:#24292E;">: </span><span style="color:#032F62;">apps/v1</span></span>
<span class="line"><span style="color:#22863A;">kind</span><span style="color:#24292E;">: </span><span style="color:#032F62;">DaemonSet</span></span>
<span class="line"><span style="color:#22863A;">metadata</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">labels</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">app</span><span style="color:#24292E;">: </span><span style="color:#032F62;">node-exporter-ds</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">node-exporter-ds</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">namespace</span><span style="color:#24292E;">: </span><span style="color:#032F62;">test</span></span>
<span class="line"><span style="color:#22863A;">spec</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">selector</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">matchLabels</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">app</span><span style="color:#24292E;">: </span><span style="color:#032F62;">node-exporter</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">template</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">metadata</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">labels</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">app</span><span style="color:#24292E;">: </span><span style="color:#032F62;">node-exporter</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">spec</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">containers</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      - </span><span style="color:#22863A;">args</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">        - </span><span style="color:#032F62;">--web.listen-address=127.0.0.1:9100</span></span>
<span class="line"><span style="color:#24292E;">        - </span><span style="color:#032F62;">--path.procfs=/host/proc</span></span>
<span class="line"><span style="color:#24292E;">        - </span><span style="color:#032F62;">--path.sysfs=/host/sys</span></span>
<span class="line"><span style="color:#24292E;">        - </span><span style="color:#032F62;">--path.rootfs=/host/root</span></span>
<span class="line"><span style="color:#24292E;">        - </span><span style="color:#032F62;">--collector.filesystem.ignored-mount-points=^/(dev|proc|sys|var/lib/docker/.+)($|/)</span></span>
<span class="line"><span style="color:#24292E;">        - </span><span style="color:#032F62;">--collector.filesystem.ignored-fs-types=^(autofs|binfmt_misc|cgroup|configfs|debugfs|devpts|devtmpfs|fusectl|hugetlbfs|mqueue|overlay|proc|procfs|pstore|rpc_pipefs|securityfs|sysfs|tracefs)$</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">image</span><span style="color:#24292E;">: </span><span style="color:#032F62;">prometheus/node-exporter:v0.18.1</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">node-exporter</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">resources</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#22863A;">limits</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#22863A;">cpu</span><span style="color:#24292E;">: </span><span style="color:#032F62;">250m</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#22863A;">memory</span><span style="color:#24292E;">: </span><span style="color:#032F62;">180Mi</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#22863A;">requests</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#22863A;">cpu</span><span style="color:#24292E;">: </span><span style="color:#032F62;">102m</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#22863A;">memory</span><span style="color:#24292E;">: </span><span style="color:#032F62;">180Mi</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">volumeMounts</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">        - </span><span style="color:#22863A;">mountPath</span><span style="color:#24292E;">: </span><span style="color:#032F62;">/host/proc</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">proc</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#22863A;">readOnly</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">false</span></span>
<span class="line"><span style="color:#24292E;">        - </span><span style="color:#22863A;">mountPath</span><span style="color:#24292E;">: </span><span style="color:#032F62;">/host/sys</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">sys</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#22863A;">readOnly</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">false</span></span>
<span class="line"><span style="color:#24292E;">        - </span><span style="color:#22863A;">mountPath</span><span style="color:#24292E;">: </span><span style="color:#032F62;">/host/root</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#22863A;">mountPropagation</span><span style="color:#24292E;">: </span><span style="color:#032F62;">HostToContainer</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">root</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#22863A;">readOnly</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">true</span></span>
<span class="line"><span style="color:#24292E;">      - </span><span style="color:#22863A;">args</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">        - </span><span style="color:#032F62;">--logtostderr</span></span>
<span class="line"><span style="color:#24292E;">        - </span><span style="color:#032F62;">--secure-listen-address=$(IP):9100</span></span>
<span class="line"><span style="color:#24292E;">        - </span><span style="color:#032F62;">--tls-cipher-suites=TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_RSA_WITH_AES_128_CBC_SHA256,TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA256,TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA256</span></span>
<span class="line"><span style="color:#24292E;">        - </span><span style="color:#032F62;">--upstream=http://127.0.0.1:9100/</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">env</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">        - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">IP</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#22863A;">valueFrom</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#22863A;">fieldRef</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">              </span><span style="color:#22863A;">fieldPath</span><span style="color:#24292E;">: </span><span style="color:#032F62;">status.podIP</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">image</span><span style="color:#24292E;">: </span><span style="color:#032F62;">172.16.140.21/prometheus/kube-rbac-proxy:v0.4.1</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">kube-rbac-proxy</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">ports</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">        - </span><span style="color:#22863A;">containerPort</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">9100</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#22863A;">hostPort</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">9100</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">https</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">resources</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#22863A;">limits</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#22863A;">cpu</span><span style="color:#24292E;">: </span><span style="color:#032F62;">20m</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#22863A;">memory</span><span style="color:#24292E;">: </span><span style="color:#032F62;">60Mi</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#22863A;">requests</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#22863A;">cpu</span><span style="color:#24292E;">: </span><span style="color:#032F62;">10m</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#22863A;">memory</span><span style="color:#24292E;">: </span><span style="color:#032F62;">20Mi</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">hostNetwork</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">true</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">hostPID</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">true</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">nodeSelector</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">kubernetes.io/os</span><span style="color:#24292E;">: </span><span style="color:#032F62;">linux</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">securityContext</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">runAsNonRoot</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">true</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">runAsUser</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">65534</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">serviceAccountName</span><span style="color:#24292E;">: </span><span style="color:#032F62;">node-exporter</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">tolerations</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      - </span><span style="color:#22863A;">operator</span><span style="color:#24292E;">: </span><span style="color:#032F62;">Exists</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">volumes</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      - </span><span style="color:#22863A;">hostPath</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#22863A;">path</span><span style="color:#24292E;">: </span><span style="color:#032F62;">/proc</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">proc</span></span>
<span class="line"><span style="color:#24292E;">      - </span><span style="color:#22863A;">hostPath</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#22863A;">path</span><span style="color:#24292E;">: </span><span style="color:#032F62;">/sys</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">sys</span></span>
<span class="line"><span style="color:#24292E;">      - </span><span style="color:#22863A;">hostPath</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#22863A;">path</span><span style="color:#24292E;">: </span><span style="color:#032F62;">/</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">root</span></span></code></pre></div><h2 id="_2-3-job" tabindex="-1">2.3 Job <a class="header-anchor" href="#_2-3-job" aria-label="Permalink to &quot;2.3 Job&quot;">​</a></h2><ul><li>yaml模板</li></ul><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#85E89D;">apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">batch/v1</span><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;">#必填，版本号</span></span>
<span class="line"><span style="color:#85E89D;">kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Job</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># 必填，资源类型</span></span>
<span class="line"><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">: </span><span style="color:#6A737D;"># 必填，元数据</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&lt;name&gt;-job</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># 必填，资源名称</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">namespace</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">test</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># pod所属的命名空间</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">labels</span><span style="color:#E1E4E8;">: </span><span style="color:#6A737D;"># 自定义标签</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">string</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;">#自定义标签名字&lt;key: value&gt;</span></span>
<span class="line"><span style="color:#85E89D;">spec</span><span style="color:#E1E4E8;">: </span><span style="color:#6A737D;"># 必填，部署的详细定义</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">completions</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">int</span><span style="color:#E1E4E8;"> # </span><span style="color:#85E89D;">资源重复作业数，默认值</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">	</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">parallelism</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">int</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># 资源并行作业数，默认值: 1</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">backoffLimit</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">int</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># 资源失败重试次数，默认值：6</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">activeDeadlineSecond</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">int</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># 资源作业超时时间，默认0 永不超时</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">ttlSecondsAfterFinished</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">int</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># 任务执行完，多少秒自动删除，默认300</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">template</span><span style="color:#E1E4E8;">: </span><span style="color:#6A737D;"># 必填，应用容器模板定义</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">containers</span><span style="color:#E1E4E8;">: </span><span style="color:#6A737D;">#此处参考pod的containers</span></span>
<span class="line"><span style="color:#E1E4E8;">      - </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">busybox</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">image</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">busybox:latest</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">imagePullPolicy</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">IfNotPresent</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">command</span><span style="color:#E1E4E8;">: [</span><span style="color:#9ECBFF;">&quot;echo&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&quot;hello world&quot;</span><span style="color:#E1E4E8;">]</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">restartPolicy</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Never</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># job类型资源重启策略必须为Never或者OnFailure</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#22863A;">apiVersion</span><span style="color:#24292E;">: </span><span style="color:#032F62;">batch/v1</span><span style="color:#24292E;">  </span><span style="color:#6A737D;">#必填，版本号</span></span>
<span class="line"><span style="color:#22863A;">kind</span><span style="color:#24292E;">: </span><span style="color:#032F62;">Job</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 必填，资源类型</span></span>
<span class="line"><span style="color:#22863A;">metadata</span><span style="color:#24292E;">: </span><span style="color:#6A737D;"># 必填，元数据</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&lt;name&gt;-job</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 必填，资源名称</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">namespace</span><span style="color:#24292E;">: </span><span style="color:#032F62;">test</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># pod所属的命名空间</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">labels</span><span style="color:#24292E;">: </span><span style="color:#6A737D;"># 自定义标签</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">string</span><span style="color:#24292E;"> </span><span style="color:#6A737D;">#自定义标签名字&lt;key: value&gt;</span></span>
<span class="line"><span style="color:#22863A;">spec</span><span style="color:#24292E;">: </span><span style="color:#6A737D;"># 必填，部署的详细定义</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">completions</span><span style="color:#24292E;">: </span><span style="color:#032F62;">int</span><span style="color:#24292E;"> # </span><span style="color:#22863A;">资源重复作业数，默认值</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">1</span><span style="color:#24292E;">	</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">parallelism</span><span style="color:#24292E;">: </span><span style="color:#032F62;">int</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 资源并行作业数，默认值: 1</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">backoffLimit</span><span style="color:#24292E;">: </span><span style="color:#032F62;">int</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 资源失败重试次数，默认值：6</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">activeDeadlineSecond</span><span style="color:#24292E;">: </span><span style="color:#032F62;">int</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 资源作业超时时间，默认0 永不超时</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">ttlSecondsAfterFinished</span><span style="color:#24292E;">: </span><span style="color:#032F62;">int</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 任务执行完，多少秒自动删除，默认300</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">template</span><span style="color:#24292E;">: </span><span style="color:#6A737D;"># 必填，应用容器模板定义</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">spec</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">containers</span><span style="color:#24292E;">: </span><span style="color:#6A737D;">#此处参考pod的containers</span></span>
<span class="line"><span style="color:#24292E;">      - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">busybox</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">image</span><span style="color:#24292E;">: </span><span style="color:#032F62;">busybox:latest</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">imagePullPolicy</span><span style="color:#24292E;">: </span><span style="color:#032F62;">IfNotPresent</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">command</span><span style="color:#24292E;">: [</span><span style="color:#032F62;">&quot;echo&quot;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;hello world&quot;</span><span style="color:#24292E;">]</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">restartPolicy</span><span style="color:#24292E;">: </span><span style="color:#032F62;">Never</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># job类型资源重启策略必须为Never或者OnFailure</span></span></code></pre></div><ul><li>yaml示例</li></ul><p>以busybox镜像启动，输出hello world举例。记得将重启策略设置为Never或者OnFailure</p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#85E89D;">apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">batch/v1</span></span>
<span class="line"><span style="color:#85E89D;">kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Job</span></span>
<span class="line"><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">hello-job</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">namespace</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">test</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">labels</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">hello-job</span></span>
<span class="line"><span style="color:#85E89D;">spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">template</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">containers</span><span style="color:#E1E4E8;">: </span></span>
<span class="line"><span style="color:#E1E4E8;">      - </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">busybox</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">image</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">busybox:latest</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">imagePullPolicy</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">IfNotPresent</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">command</span><span style="color:#E1E4E8;">: [</span><span style="color:#9ECBFF;">&quot;echo&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&quot;hello world&quot;</span><span style="color:#E1E4E8;">]</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">restartPolicy</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Never</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#22863A;">apiVersion</span><span style="color:#24292E;">: </span><span style="color:#032F62;">batch/v1</span></span>
<span class="line"><span style="color:#22863A;">kind</span><span style="color:#24292E;">: </span><span style="color:#032F62;">Job</span></span>
<span class="line"><span style="color:#22863A;">metadata</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">hello-job</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">namespace</span><span style="color:#24292E;">: </span><span style="color:#032F62;">test</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">labels</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">hello-job</span></span>
<span class="line"><span style="color:#22863A;">spec</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">template</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">spec</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">containers</span><span style="color:#24292E;">: </span></span>
<span class="line"><span style="color:#24292E;">      - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">busybox</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">image</span><span style="color:#24292E;">: </span><span style="color:#032F62;">busybox:latest</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">imagePullPolicy</span><span style="color:#24292E;">: </span><span style="color:#032F62;">IfNotPresent</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">command</span><span style="color:#24292E;">: [</span><span style="color:#032F62;">&quot;echo&quot;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;hello world&quot;</span><span style="color:#24292E;">]</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">restartPolicy</span><span style="color:#24292E;">: </span><span style="color:#032F62;">Never</span></span></code></pre></div><h2 id="_2-4-cronjob" tabindex="-1">2.4 CronJob <a class="header-anchor" href="#_2-4-cronjob" aria-label="Permalink to &quot;2.4 CronJob&quot;">​</a></h2><ul><li>yaml模板</li></ul><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#85E89D;">apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">batch/v1</span><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;">#必填，版本号</span></span>
<span class="line"><span style="color:#85E89D;">kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Job</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># 必填，资源类型</span></span>
<span class="line"><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">: </span><span style="color:#6A737D;"># 必填，元数据</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&lt;name&gt;-cj</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># 必填，资源名称</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">namespace</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">test</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># pod所属的命名空间</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">labels</span><span style="color:#E1E4E8;">: </span><span style="color:#6A737D;"># 自定义标签</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">string</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;">#自定义标签名字&lt;key: value&gt;</span></span>
<span class="line"><span style="color:#85E89D;">spec</span><span style="color:#E1E4E8;">: </span><span style="color:#6A737D;"># 必填，部署的详细定义</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">schedule</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;* * * * *&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># 必填，运行时间点</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">concurrencyPolicy</span><span style="color:#E1E4E8;">: [</span><span style="color:#9ECBFF;">Allow 允许|Forbid 禁止|Replace 替换</span><span style="color:#E1E4E8;">] </span><span style="color:#6A737D;"># 并发执行策略，默认允许</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">failedJobHistoryLimit</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">int</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># 为失败的任务执行保留的历史记录数，默认为1</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">successfulJobsHistoryLimit</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">int</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># 为成功的任务执行保留的历史记录数，默认为3。</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">startingDeadlineSeconds</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">int</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># 因各种原因缺乏执行作业的时间点所导致的启动作业错误的超时时长，会被记入错误历史记录。</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">suspend</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">boolean</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># 是否挂起后续的任务执行，默认为false，对运行中的作业不会产生影响。</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">jobTemplate</span><span style="color:#E1E4E8;">: </span><span style="color:#6A737D;"># 控制器模板，与template类似</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">metedata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">labels</span><span style="color:#E1E4E8;">: </span><span style="color:#6A737D;"># 自定义标签</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">string</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;">#自定义标签名字&lt;key: value&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">template</span><span style="color:#E1E4E8;">: </span><span style="color:#6A737D;"># 必填，应用容器模板定义</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#85E89D;">containers</span><span style="color:#E1E4E8;">: </span><span style="color:#6A737D;">#此处参考pod的containers</span></span>
<span class="line"><span style="color:#E1E4E8;">          - </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">busybox</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#85E89D;">image</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">busybox:latest</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#85E89D;">imagePullPolicy</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">IfNotPresent</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#85E89D;">command</span><span style="color:#E1E4E8;">: [</span><span style="color:#9ECBFF;">&quot;echo&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&quot;hello world&quot;</span><span style="color:#E1E4E8;">]</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#85E89D;">restartPolicy</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Never</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># job类型资源重启策略必须为Never或者OnFailure</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#22863A;">apiVersion</span><span style="color:#24292E;">: </span><span style="color:#032F62;">batch/v1</span><span style="color:#24292E;">  </span><span style="color:#6A737D;">#必填，版本号</span></span>
<span class="line"><span style="color:#22863A;">kind</span><span style="color:#24292E;">: </span><span style="color:#032F62;">Job</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 必填，资源类型</span></span>
<span class="line"><span style="color:#22863A;">metadata</span><span style="color:#24292E;">: </span><span style="color:#6A737D;"># 必填，元数据</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&lt;name&gt;-cj</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 必填，资源名称</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">namespace</span><span style="color:#24292E;">: </span><span style="color:#032F62;">test</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># pod所属的命名空间</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">labels</span><span style="color:#24292E;">: </span><span style="color:#6A737D;"># 自定义标签</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">string</span><span style="color:#24292E;"> </span><span style="color:#6A737D;">#自定义标签名字&lt;key: value&gt;</span></span>
<span class="line"><span style="color:#22863A;">spec</span><span style="color:#24292E;">: </span><span style="color:#6A737D;"># 必填，部署的详细定义</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">schedule</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;* * * * *&quot;</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 必填，运行时间点</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">concurrencyPolicy</span><span style="color:#24292E;">: [</span><span style="color:#032F62;">Allow 允许|Forbid 禁止|Replace 替换</span><span style="color:#24292E;">] </span><span style="color:#6A737D;"># 并发执行策略，默认允许</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">failedJobHistoryLimit</span><span style="color:#24292E;">: </span><span style="color:#032F62;">int</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 为失败的任务执行保留的历史记录数，默认为1</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">successfulJobsHistoryLimit</span><span style="color:#24292E;">: </span><span style="color:#032F62;">int</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 为成功的任务执行保留的历史记录数，默认为3。</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">startingDeadlineSeconds</span><span style="color:#24292E;">: </span><span style="color:#032F62;">int</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 因各种原因缺乏执行作业的时间点所导致的启动作业错误的超时时长，会被记入错误历史记录。</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">suspend</span><span style="color:#24292E;">: </span><span style="color:#032F62;">boolean</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 是否挂起后续的任务执行，默认为false，对运行中的作业不会产生影响。</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">jobTemplate</span><span style="color:#24292E;">: </span><span style="color:#6A737D;"># 控制器模板，与template类似</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">metedata</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">labels</span><span style="color:#24292E;">: </span><span style="color:#6A737D;"># 自定义标签</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">string</span><span style="color:#24292E;"> </span><span style="color:#6A737D;">#自定义标签名字&lt;key: value&gt;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">spec</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">template</span><span style="color:#24292E;">: </span><span style="color:#6A737D;"># 必填，应用容器模板定义</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">spec</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#22863A;">containers</span><span style="color:#24292E;">: </span><span style="color:#6A737D;">#此处参考pod的containers</span></span>
<span class="line"><span style="color:#24292E;">          - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">busybox</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#22863A;">image</span><span style="color:#24292E;">: </span><span style="color:#032F62;">busybox:latest</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#22863A;">imagePullPolicy</span><span style="color:#24292E;">: </span><span style="color:#032F62;">IfNotPresent</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#22863A;">command</span><span style="color:#24292E;">: [</span><span style="color:#032F62;">&quot;echo&quot;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;hello world&quot;</span><span style="color:#24292E;">]</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#22863A;">restartPolicy</span><span style="color:#24292E;">: </span><span style="color:#032F62;">Never</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># job类型资源重启策略必须为Never或者OnFailure</span></span></code></pre></div><ul><li>yaml示例：以busybox镜像启动，输出hello world举例。记得将重启策略设置为Never或者OnFailure</li></ul><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#85E89D;">apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">batch/v1beta1</span></span>
<span class="line"><span style="color:#85E89D;">kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">CronJob</span></span>
<span class="line"><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">hello-cj</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">namespace</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">test</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">labels</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">app</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">hello-cronjob</span></span>
<span class="line"><span style="color:#85E89D;">spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">schedule</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;*/2 * * * *&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">jobTemplate</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">labels</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">app</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">hello-cronjob</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">template</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#85E89D;">containers</span><span style="color:#E1E4E8;">: </span></span>
<span class="line"><span style="color:#E1E4E8;">          - </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">busybox</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#85E89D;">image</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">busybox:latest</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#85E89D;">imagePullPolicy</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">IfNotPresent</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#85E89D;">command</span><span style="color:#E1E4E8;">: [</span><span style="color:#9ECBFF;">&quot;echo&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&quot;hello world&quot;</span><span style="color:#E1E4E8;">]</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#85E89D;">restartPolicy</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Never</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#22863A;">apiVersion</span><span style="color:#24292E;">: </span><span style="color:#032F62;">batch/v1beta1</span></span>
<span class="line"><span style="color:#22863A;">kind</span><span style="color:#24292E;">: </span><span style="color:#032F62;">CronJob</span></span>
<span class="line"><span style="color:#22863A;">metadata</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">hello-cj</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">namespace</span><span style="color:#24292E;">: </span><span style="color:#032F62;">test</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">labels</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">app</span><span style="color:#24292E;">: </span><span style="color:#032F62;">hello-cronjob</span></span>
<span class="line"><span style="color:#22863A;">spec</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">schedule</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;*/2 * * * *&quot;</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">jobTemplate</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">metadata</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">labels</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">app</span><span style="color:#24292E;">: </span><span style="color:#032F62;">hello-cronjob</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">spec</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">template</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">spec</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#22863A;">containers</span><span style="color:#24292E;">: </span></span>
<span class="line"><span style="color:#24292E;">          - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">busybox</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#22863A;">image</span><span style="color:#24292E;">: </span><span style="color:#032F62;">busybox:latest</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#22863A;">imagePullPolicy</span><span style="color:#24292E;">: </span><span style="color:#032F62;">IfNotPresent</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#22863A;">command</span><span style="color:#24292E;">: [</span><span style="color:#032F62;">&quot;echo&quot;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;hello world&quot;</span><span style="color:#24292E;">]</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#22863A;">restartPolicy</span><span style="color:#24292E;">: </span><span style="color:#032F62;">Never</span></span></code></pre></div><h2 id="_2-5-statefulset" tabindex="-1">2.5 StatefulSet <a class="header-anchor" href="#_2-5-statefulset" aria-label="Permalink to &quot;2.5 StatefulSet&quot;">​</a></h2><blockquote><p>创建StatefulSet资源之前，先要保证集群中存在StorageClass，并使用headless service暴露服务 StatefulSet相较于Deployment，多了volumeClaimTemplates字段，即pvc存储的配置信息</p></blockquote><ul><li>yaml模板</li></ul><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#85E89D;">apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">apps/v1</span><span style="color:#E1E4E8;">      </span><span style="color:#6A737D;">#必填，版本号</span></span>
<span class="line"><span style="color:#85E89D;">kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">StatefulSet</span><span style="color:#E1E4E8;">     </span><span style="color:#6A737D;">#必填，资源类型</span></span>
<span class="line"><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">:       </span><span style="color:#6A737D;">#必填，元数据</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&lt;name&gt;-sts</span><span style="color:#E1E4E8;">     </span><span style="color:#6A737D;">#必填，资源名称</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">namespace</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&lt;namespace&gt;</span><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">#Pod所属的命名空间</span></span>
<span class="line"><span style="color:#85E89D;">spec</span><span style="color:#E1E4E8;">:         </span><span style="color:#6A737D;">#必填，部署的详细定义</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">selector</span><span style="color:#E1E4E8;">: </span><span style="color:#6A737D;">#必填，标签选择</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">matchLabels</span><span style="color:#E1E4E8;">: </span><span style="color:#6A737D;">#必填，标签匹配</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">key</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&lt;value&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;">#必填，通过此标签匹配对应pod&lt;key: value&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">serviceName</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">string</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># Headless Service资源名称</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">replicas</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">int</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># 副本数量</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">template</span><span style="color:#E1E4E8;">: </span><span style="color:#6A737D;">#必填，应用容器模版定义</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">: </span><span style="color:#6A737D;">#必填，元数据</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">labels</span><span style="color:#E1E4E8;">:  </span><span style="color:#6A737D;"># 标签</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">key</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&lt;value&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;">#必填，与上面matchLabels的标签相同</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">spec</span><span style="color:#E1E4E8;">: </span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">containers</span><span style="color:#E1E4E8;">: </span><span style="color:#6A737D;">#此处参考pod的containers</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">volumeClaimTemplates</span><span style="color:#E1E4E8;">: </span><span style="color:#6A737D;">#必填，+pvc模板</span></span>
<span class="line"><span style="color:#E1E4E8;">    - </span><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">:       </span><span style="color:#6A737D;">#必填，元数据</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&lt;name&gt;-depolyment</span><span style="color:#E1E4E8;">     </span><span style="color:#6A737D;">#必填，资源名称</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">accessModes</span><span style="color:#E1E4E8;">: [ </span><span style="color:#9ECBFF;">&quot;ReadWriteOnce | ReadOnlyMany | ReadWriteMany&quot;</span><span style="color:#E1E4E8;"> ] </span><span style="color:#6A737D;">#必填，访问模式</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">storageClassName</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">strint</span><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;">#存储类名，改为集群中已存在的</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">resources</span><span style="color:#E1E4E8;">: </span><span style="color:#6A737D;"># 存储卷需要占用的资源量最小值</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#85E89D;">requests</span><span style="color:#E1E4E8;">: </span><span style="color:#6A737D;"># 请求空间大小</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#85E89D;">storage</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">1Gi</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># 空间大小值</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#22863A;">apiVersion</span><span style="color:#24292E;">: </span><span style="color:#032F62;">apps/v1</span><span style="color:#24292E;">      </span><span style="color:#6A737D;">#必填，版本号</span></span>
<span class="line"><span style="color:#22863A;">kind</span><span style="color:#24292E;">: </span><span style="color:#032F62;">StatefulSet</span><span style="color:#24292E;">     </span><span style="color:#6A737D;">#必填，资源类型</span></span>
<span class="line"><span style="color:#22863A;">metadata</span><span style="color:#24292E;">:       </span><span style="color:#6A737D;">#必填，元数据</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&lt;name&gt;-sts</span><span style="color:#24292E;">     </span><span style="color:#6A737D;">#必填，资源名称</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">namespace</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&lt;namespace&gt;</span><span style="color:#24292E;">    </span><span style="color:#6A737D;">#Pod所属的命名空间</span></span>
<span class="line"><span style="color:#22863A;">spec</span><span style="color:#24292E;">:         </span><span style="color:#6A737D;">#必填，部署的详细定义</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">selector</span><span style="color:#24292E;">: </span><span style="color:#6A737D;">#必填，标签选择</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">matchLabels</span><span style="color:#24292E;">: </span><span style="color:#6A737D;">#必填，标签匹配</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">key</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&lt;value&gt;</span><span style="color:#24292E;"> </span><span style="color:#6A737D;">#必填，通过此标签匹配对应pod&lt;key: value&gt;</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">serviceName</span><span style="color:#24292E;">: </span><span style="color:#032F62;">string</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># Headless Service资源名称</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">replicas</span><span style="color:#24292E;">: </span><span style="color:#032F62;">int</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 副本数量</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">template</span><span style="color:#24292E;">: </span><span style="color:#6A737D;">#必填，应用容器模版定义</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">metadata</span><span style="color:#24292E;">: </span><span style="color:#6A737D;">#必填，元数据</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">labels</span><span style="color:#24292E;">:  </span><span style="color:#6A737D;"># 标签</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">key</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&lt;value&gt;</span><span style="color:#24292E;"> </span><span style="color:#6A737D;">#必填，与上面matchLabels的标签相同</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">spec</span><span style="color:#24292E;">: </span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">containers</span><span style="color:#24292E;">: </span><span style="color:#6A737D;">#此处参考pod的containers</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">volumeClaimTemplates</span><span style="color:#24292E;">: </span><span style="color:#6A737D;">#必填，+pvc模板</span></span>
<span class="line"><span style="color:#24292E;">    - </span><span style="color:#22863A;">metadata</span><span style="color:#24292E;">:       </span><span style="color:#6A737D;">#必填，元数据</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&lt;name&gt;-depolyment</span><span style="color:#24292E;">     </span><span style="color:#6A737D;">#必填，资源名称</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">spec</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">accessModes</span><span style="color:#24292E;">: [ </span><span style="color:#032F62;">&quot;ReadWriteOnce | ReadOnlyMany | ReadWriteMany&quot;</span><span style="color:#24292E;"> ] </span><span style="color:#6A737D;">#必填，访问模式</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">storageClassName</span><span style="color:#24292E;">: </span><span style="color:#032F62;">strint</span><span style="color:#24292E;">  </span><span style="color:#6A737D;">#存储类名，改为集群中已存在的</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">resources</span><span style="color:#24292E;">: </span><span style="color:#6A737D;"># 存储卷需要占用的资源量最小值</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#22863A;">requests</span><span style="color:#24292E;">: </span><span style="color:#6A737D;"># 请求空间大小</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#22863A;">storage</span><span style="color:#24292E;">: </span><span style="color:#032F62;">1Gi</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 空间大小值</span></span></code></pre></div><ul><li>yaml示例：以nginx服务使用nfs共享存储为例</li></ul><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">#先定义了一个名为myapp-svc的Headless Service资源，用于为关联到的每个Pod资源创建DNS资源记录。</span></span>
<span class="line"><span style="color:#85E89D;">apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">v1</span></span>
<span class="line"><span style="color:#85E89D;">kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Service</span></span>
<span class="line"><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">myapp-svc</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">labels</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">app</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">myapp-svc</span></span>
<span class="line"><span style="color:#85E89D;">spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">ports</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  - </span><span style="color:#85E89D;">port</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">80</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">web</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">clusterIP</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">None</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">selector</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">app</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">myapp-pod</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">---</span></span>
<span class="line"><span style="color:#6A737D;"># 定义多个使用NFS存储后端的PV，空间大小为2GB，仅支持单路的读写操作。</span></span>
<span class="line"><span style="color:#85E89D;">apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">v1</span></span>
<span class="line"><span style="color:#85E89D;">kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">PersistentVolume</span></span>
<span class="line"><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">nfs-pv</span></span>
<span class="line"><span style="color:#85E89D;">spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">capacity</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">storage</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">2Gi</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">accessModes</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    - </span><span style="color:#9ECBFF;">ReadWriteOnce</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">persistentVolumeReclaimPolicy</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Recycle</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">storageClassName</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">nfs</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">nfs</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">path</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">/nfs/data1</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">server</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">172.17.0.2</span></span>
<span class="line"><span style="color:#B392F0;">---</span></span>
<span class="line"><span style="color:#6A737D;"># 定义了一个名为myapp的StatefulSet资源，它通过Pod模板创建了两个Pod资源副本，并基于volumeClaimTemplates（存储卷申请模板）向nfs存储类请求动态供给PV，从而为每个Pod资源提供大小为1GB的专用存储卷。</span></span>
<span class="line"><span style="color:#85E89D;">apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">apps/v1</span></span>
<span class="line"><span style="color:#85E89D;">kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">StatefulSet</span></span>
<span class="line"><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">myapp-sts</span></span>
<span class="line"><span style="color:#85E89D;">spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">selector</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">matchLabels</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">app</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">myapp-pod</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">serviceName</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">myapp-svc</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">replicas</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">2</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">template</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">labels</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">app</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">myapp-pod</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">containers</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      - </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">nginx</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">image</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">k8s.gcr.io/nginx-slim:0.8</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">ports</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">        - </span><span style="color:#85E89D;">containerPort</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">80</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">web</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">volumeMounts</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">        - </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">myapp-data</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#85E89D;">mountPath</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">/usr/share/nginx/html</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">volumeClaimTemplates</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  - </span><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">myapp-data</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">accessModes</span><span style="color:#E1E4E8;">: [ </span><span style="color:#9ECBFF;">&quot;ReadWriteOnce&quot;</span><span style="color:#E1E4E8;"> ]</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">storageClassName</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;nfs&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">resources</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">requests</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#85E89D;">storage</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">1Gi</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">#先定义了一个名为myapp-svc的Headless Service资源，用于为关联到的每个Pod资源创建DNS资源记录。</span></span>
<span class="line"><span style="color:#22863A;">apiVersion</span><span style="color:#24292E;">: </span><span style="color:#032F62;">v1</span></span>
<span class="line"><span style="color:#22863A;">kind</span><span style="color:#24292E;">: </span><span style="color:#032F62;">Service</span></span>
<span class="line"><span style="color:#22863A;">metadata</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">myapp-svc</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">labels</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">app</span><span style="color:#24292E;">: </span><span style="color:#032F62;">myapp-svc</span></span>
<span class="line"><span style="color:#22863A;">spec</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">ports</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  - </span><span style="color:#22863A;">port</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">80</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">web</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">clusterIP</span><span style="color:#24292E;">: </span><span style="color:#032F62;">None</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">selector</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">app</span><span style="color:#24292E;">: </span><span style="color:#032F62;">myapp-pod</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">---</span></span>
<span class="line"><span style="color:#6A737D;"># 定义多个使用NFS存储后端的PV，空间大小为2GB，仅支持单路的读写操作。</span></span>
<span class="line"><span style="color:#22863A;">apiVersion</span><span style="color:#24292E;">: </span><span style="color:#032F62;">v1</span></span>
<span class="line"><span style="color:#22863A;">kind</span><span style="color:#24292E;">: </span><span style="color:#032F62;">PersistentVolume</span></span>
<span class="line"><span style="color:#22863A;">metadata</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">nfs-pv</span></span>
<span class="line"><span style="color:#22863A;">spec</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">capacity</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">storage</span><span style="color:#24292E;">: </span><span style="color:#032F62;">2Gi</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">accessModes</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    - </span><span style="color:#032F62;">ReadWriteOnce</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">persistentVolumeReclaimPolicy</span><span style="color:#24292E;">: </span><span style="color:#032F62;">Recycle</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">storageClassName</span><span style="color:#24292E;">: </span><span style="color:#032F62;">nfs</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">nfs</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">path</span><span style="color:#24292E;">: </span><span style="color:#032F62;">/nfs/data1</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">server</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">172.17.0.2</span></span>
<span class="line"><span style="color:#6F42C1;">---</span></span>
<span class="line"><span style="color:#6A737D;"># 定义了一个名为myapp的StatefulSet资源，它通过Pod模板创建了两个Pod资源副本，并基于volumeClaimTemplates（存储卷申请模板）向nfs存储类请求动态供给PV，从而为每个Pod资源提供大小为1GB的专用存储卷。</span></span>
<span class="line"><span style="color:#22863A;">apiVersion</span><span style="color:#24292E;">: </span><span style="color:#032F62;">apps/v1</span></span>
<span class="line"><span style="color:#22863A;">kind</span><span style="color:#24292E;">: </span><span style="color:#032F62;">StatefulSet</span></span>
<span class="line"><span style="color:#22863A;">metadata</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">myapp-sts</span></span>
<span class="line"><span style="color:#22863A;">spec</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">selector</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">matchLabels</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">app</span><span style="color:#24292E;">: </span><span style="color:#032F62;">myapp-pod</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">serviceName</span><span style="color:#24292E;">: </span><span style="color:#032F62;">myapp-svc</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">replicas</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">2</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">template</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">metadata</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">labels</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">app</span><span style="color:#24292E;">: </span><span style="color:#032F62;">myapp-pod</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">spec</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">containers</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">nginx</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">image</span><span style="color:#24292E;">: </span><span style="color:#032F62;">k8s.gcr.io/nginx-slim:0.8</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">ports</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">        - </span><span style="color:#22863A;">containerPort</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">80</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">web</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">volumeMounts</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">        - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">myapp-data</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#22863A;">mountPath</span><span style="color:#24292E;">: </span><span style="color:#032F62;">/usr/share/nginx/html</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">volumeClaimTemplates</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  - </span><span style="color:#22863A;">metadata</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">myapp-data</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">spec</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">accessModes</span><span style="color:#24292E;">: [ </span><span style="color:#032F62;">&quot;ReadWriteOnce&quot;</span><span style="color:#24292E;"> ]</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">storageClassName</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;nfs&quot;</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">resources</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">requests</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#22863A;">storage</span><span style="color:#24292E;">: </span><span style="color:#032F62;">1Gi</span></span></code></pre></div><h1 id="_3-服务与暴露" tabindex="-1">3. 服务与暴露 <a class="header-anchor" href="#_3-服务与暴露" aria-label="Permalink to &quot;3. 服务与暴露&quot;">​</a></h1><h2 id="_3-1-service-clusterip" tabindex="-1">3.1 Service-ClusterIP <a class="header-anchor" href="#_3-1-service-clusterip" aria-label="Permalink to &quot;3.1 Service-ClusterIP&quot;">​</a></h2><ul><li>yaml模板</li></ul><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#85E89D;">apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">v1</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># 必填，版本号</span></span>
<span class="line"><span style="color:#85E89D;">kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Service</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># 必填，资源类型</span></span>
<span class="line"><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">: </span><span style="color:#6A737D;"># 必填，元数据</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&lt;name&gt;-svc</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># 必填，资源名称</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">namespace</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">test</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># 资源命名空间</span></span>
<span class="line"><span style="color:#85E89D;">spec</span><span style="color:#E1E4E8;">: </span><span style="color:#6A737D;"># 必填，资源详细定义</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">type</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">ClusterIP</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># 资源类型，默认ClusterIP</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">selector</span><span style="color:#E1E4E8;">: </span><span style="color:#6A737D;"># 必填，标签选择</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">key</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&lt;value&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># 必填，通过此标签匹配对应的资源</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">ports</span><span style="color:#E1E4E8;">: </span><span style="color:#6A737D;"># 必填，服务暴露端端口列表</span></span>
<span class="line"><span style="color:#E1E4E8;">  - </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">string</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># 服务暴露名称</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">port</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">int</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># 必填，服务监听端口号</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">targetPort</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">int</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># 必填，服务转发后端Pod端口号</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">protocol</span><span style="color:#E1E4E8;">: [</span><span style="color:#9ECBFF;">TCP | UDP</span><span style="color:#E1E4E8;">] </span><span style="color:#6A737D;"># 端口协议</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">sessionAffinity</span><span style="color:#E1E4E8;">: [</span><span style="color:#9ECBFF;">None | ClientIP</span><span style="color:#E1E4E8;">] </span><span style="color:#6A737D;"># 要使用的粘性会话的类型,默认none不使用。ClientIP：基于客户端IP地址识别客户端身份，把来自同一个源IP地址的请求始终调度至同一个Pod对象。</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">sessionAffinityConfig</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">int</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># 会话保持的时长</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#22863A;">apiVersion</span><span style="color:#24292E;">: </span><span style="color:#032F62;">v1</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 必填，版本号</span></span>
<span class="line"><span style="color:#22863A;">kind</span><span style="color:#24292E;">: </span><span style="color:#032F62;">Service</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 必填，资源类型</span></span>
<span class="line"><span style="color:#22863A;">metadata</span><span style="color:#24292E;">: </span><span style="color:#6A737D;"># 必填，元数据</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&lt;name&gt;-svc</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 必填，资源名称</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">namespace</span><span style="color:#24292E;">: </span><span style="color:#032F62;">test</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 资源命名空间</span></span>
<span class="line"><span style="color:#22863A;">spec</span><span style="color:#24292E;">: </span><span style="color:#6A737D;"># 必填，资源详细定义</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">type</span><span style="color:#24292E;">: </span><span style="color:#032F62;">ClusterIP</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 资源类型，默认ClusterIP</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">selector</span><span style="color:#24292E;">: </span><span style="color:#6A737D;"># 必填，标签选择</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">key</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&lt;value&gt;</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 必填，通过此标签匹配对应的资源</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">ports</span><span style="color:#24292E;">: </span><span style="color:#6A737D;"># 必填，服务暴露端端口列表</span></span>
<span class="line"><span style="color:#24292E;">  - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">string</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 服务暴露名称</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">port</span><span style="color:#24292E;">: </span><span style="color:#032F62;">int</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 必填，服务监听端口号</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">targetPort</span><span style="color:#24292E;">: </span><span style="color:#032F62;">int</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 必填，服务转发后端Pod端口号</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">protocol</span><span style="color:#24292E;">: [</span><span style="color:#032F62;">TCP | UDP</span><span style="color:#24292E;">] </span><span style="color:#6A737D;"># 端口协议</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">sessionAffinity</span><span style="color:#24292E;">: [</span><span style="color:#032F62;">None | ClientIP</span><span style="color:#24292E;">] </span><span style="color:#6A737D;"># 要使用的粘性会话的类型,默认none不使用。ClientIP：基于客户端IP地址识别客户端身份，把来自同一个源IP地址的请求始终调度至同一个Pod对象。</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">sessionAffinityConfig</span><span style="color:#24292E;">: </span><span style="color:#032F62;">int</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 会话保持的时长</span></span></code></pre></div><ul><li>yaml示例：使用ClusterIP方式，将myapp的80端口暴露出去</li></ul><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#85E89D;">apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">v1</span></span>
<span class="line"><span style="color:#85E89D;">kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Service</span></span>
<span class="line"><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">myapp-svc</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">namespace</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">test</span></span>
<span class="line"><span style="color:#85E89D;">spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">type</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">ClusterIP</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">selector</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">app</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">myapp</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">ports</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  - </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">http</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">port</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">80</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">targetPort</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">80</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#22863A;">apiVersion</span><span style="color:#24292E;">: </span><span style="color:#032F62;">v1</span></span>
<span class="line"><span style="color:#22863A;">kind</span><span style="color:#24292E;">: </span><span style="color:#032F62;">Service</span></span>
<span class="line"><span style="color:#22863A;">metadata</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">myapp-svc</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">namespace</span><span style="color:#24292E;">: </span><span style="color:#032F62;">test</span></span>
<span class="line"><span style="color:#22863A;">spec</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">type</span><span style="color:#24292E;">: </span><span style="color:#032F62;">ClusterIP</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">selector</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">app</span><span style="color:#24292E;">: </span><span style="color:#032F62;">myapp</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">ports</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">http</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">port</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">80</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">targetPort</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">80</span></span></code></pre></div><h2 id="_3-2-service-nodeport" tabindex="-1">3.2 Service-NodePort <a class="header-anchor" href="#_3-2-service-nodeport" aria-label="Permalink to &quot;3.2 Service-NodePort&quot;">​</a></h2><ul><li>yaml模板</li></ul><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#85E89D;">apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">v1</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># 必填，版本号</span></span>
<span class="line"><span style="color:#85E89D;">kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Service</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># 必填，资源类型</span></span>
<span class="line"><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">: </span><span style="color:#6A737D;"># 必填，元数据</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&lt;name&gt;-svc</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># 必填，资源名称</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">namespace</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">test</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># 资源命名空间</span></span>
<span class="line"><span style="color:#85E89D;">spec</span><span style="color:#E1E4E8;">: </span><span style="color:#6A737D;"># 必填，资源详细定义</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">type</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">NodePort</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># 必填，资源类型</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">selector</span><span style="color:#E1E4E8;">: </span><span style="color:#6A737D;"># 必填，标签选择</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">key</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&lt;value&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># 必填，通过此标签匹配对应的资源</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">ports</span><span style="color:#E1E4E8;">: </span><span style="color:#6A737D;"># 必填，服务暴露端端口列表</span></span>
<span class="line"><span style="color:#E1E4E8;">  - </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">string</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># 服务暴露名称</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">port</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">int</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># 必填，服务监听端口号</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">targetPort</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">int</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># 必填，服务转发后端Pod端口号</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">nodePort</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">int 必填，指定映射物理机端口号</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">protocol</span><span style="color:#E1E4E8;">: [</span><span style="color:#9ECBFF;">TCP | UDP</span><span style="color:#E1E4E8;">] </span><span style="color:#6A737D;"># 端口协议</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">sessionAffinity</span><span style="color:#E1E4E8;">: [</span><span style="color:#9ECBFF;">None | ClientIP</span><span style="color:#E1E4E8;">] </span><span style="color:#6A737D;"># 要使用的粘性会话的类型,默认none不使用。ClientIP：基于客户端IP地址识别客户端身份，把来自同一个源IP地址的请求始终调度至同一个Pod对象。</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">sessionAffinityConfig</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">int</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># 会话保持的时长</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#22863A;">apiVersion</span><span style="color:#24292E;">: </span><span style="color:#032F62;">v1</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 必填，版本号</span></span>
<span class="line"><span style="color:#22863A;">kind</span><span style="color:#24292E;">: </span><span style="color:#032F62;">Service</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 必填，资源类型</span></span>
<span class="line"><span style="color:#22863A;">metadata</span><span style="color:#24292E;">: </span><span style="color:#6A737D;"># 必填，元数据</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&lt;name&gt;-svc</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 必填，资源名称</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">namespace</span><span style="color:#24292E;">: </span><span style="color:#032F62;">test</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 资源命名空间</span></span>
<span class="line"><span style="color:#22863A;">spec</span><span style="color:#24292E;">: </span><span style="color:#6A737D;"># 必填，资源详细定义</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">type</span><span style="color:#24292E;">: </span><span style="color:#032F62;">NodePort</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 必填，资源类型</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">selector</span><span style="color:#24292E;">: </span><span style="color:#6A737D;"># 必填，标签选择</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">key</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&lt;value&gt;</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 必填，通过此标签匹配对应的资源</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">ports</span><span style="color:#24292E;">: </span><span style="color:#6A737D;"># 必填，服务暴露端端口列表</span></span>
<span class="line"><span style="color:#24292E;">  - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">string</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 服务暴露名称</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">port</span><span style="color:#24292E;">: </span><span style="color:#032F62;">int</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 必填，服务监听端口号</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">targetPort</span><span style="color:#24292E;">: </span><span style="color:#032F62;">int</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 必填，服务转发后端Pod端口号</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">nodePort</span><span style="color:#24292E;">: </span><span style="color:#032F62;">int 必填，指定映射物理机端口号</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">protocol</span><span style="color:#24292E;">: [</span><span style="color:#032F62;">TCP | UDP</span><span style="color:#24292E;">] </span><span style="color:#6A737D;"># 端口协议</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">sessionAffinity</span><span style="color:#24292E;">: [</span><span style="color:#032F62;">None | ClientIP</span><span style="color:#24292E;">] </span><span style="color:#6A737D;"># 要使用的粘性会话的类型,默认none不使用。ClientIP：基于客户端IP地址识别客户端身份，把来自同一个源IP地址的请求始终调度至同一个Pod对象。</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">sessionAffinityConfig</span><span style="color:#24292E;">: </span><span style="color:#032F62;">int</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 会话保持的时长</span></span></code></pre></div><ul><li>yaml示例：使用NodePort方式，将myapp的80端口映射到物理机30001端口</li></ul><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#85E89D;">apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">v1</span></span>
<span class="line"><span style="color:#85E89D;">kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Service</span></span>
<span class="line"><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">myapp-svc</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">namespace</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">test</span></span>
<span class="line"><span style="color:#85E89D;">spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">type</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">NodePort</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">selector</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">app</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">myapp</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">ports</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  - </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">http</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">port</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">80</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">targetPort</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">80</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">nodePort</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">30001</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#22863A;">apiVersion</span><span style="color:#24292E;">: </span><span style="color:#032F62;">v1</span></span>
<span class="line"><span style="color:#22863A;">kind</span><span style="color:#24292E;">: </span><span style="color:#032F62;">Service</span></span>
<span class="line"><span style="color:#22863A;">metadata</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">myapp-svc</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">namespace</span><span style="color:#24292E;">: </span><span style="color:#032F62;">test</span></span>
<span class="line"><span style="color:#22863A;">spec</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">type</span><span style="color:#24292E;">: </span><span style="color:#032F62;">NodePort</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">selector</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">app</span><span style="color:#24292E;">: </span><span style="color:#032F62;">myapp</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">ports</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">http</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">port</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">80</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">targetPort</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">80</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">nodePort</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">30001</span></span></code></pre></div><h2 id="_3-3-service-headless" tabindex="-1">3.3 Service-headless <a class="header-anchor" href="#_3-3-service-headless" aria-label="Permalink to &quot;3.3 Service-headless&quot;">​</a></h2><ul><li>yaml模板</li></ul><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#85E89D;">apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">v1</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># 必填，版本号</span></span>
<span class="line"><span style="color:#85E89D;">kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Service</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># 必填，资源类型</span></span>
<span class="line"><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">: </span><span style="color:#6A737D;"># 必填，元数据</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&lt;name&gt;-svc</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># 必填，资源名称</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">namespace</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">test</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># 资源命名空间</span></span>
<span class="line"><span style="color:#85E89D;">spec</span><span style="color:#E1E4E8;">: </span><span style="color:#6A737D;"># 必填，资源详细定义</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">clusterIP</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">None</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># 必填，指定clusterIp为none，使用headless</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">selector</span><span style="color:#E1E4E8;">: </span><span style="color:#6A737D;"># 必填，标签选择</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">key</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&lt;value&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># 必填，通过此标签匹配对应的资源</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">ports</span><span style="color:#E1E4E8;">: </span><span style="color:#6A737D;"># 必填，服务暴露端端口列表</span></span>
<span class="line"><span style="color:#E1E4E8;">  - </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">string</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># 服务暴露名称</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">port</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">int</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># 必填，服务监听端口号</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">targetPort</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">int</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># 必填，服务转发后端Pod端口号</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">protocol</span><span style="color:#E1E4E8;">: [</span><span style="color:#9ECBFF;">TCP | UDP</span><span style="color:#E1E4E8;">] </span><span style="color:#6A737D;"># 端口协议</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">sessionAffinity</span><span style="color:#E1E4E8;">: [</span><span style="color:#9ECBFF;">None | ClientIP</span><span style="color:#E1E4E8;">] </span><span style="color:#6A737D;"># 要使用的粘性会话的类型,默认none不使用。ClientIP：基于客户端IP地址识别客户端身份，把来自同一个源IP地址的请求始终调度至同一个Pod对象。</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">sessionAffinityConfig</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">int</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># 会话保持的时长</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#22863A;">apiVersion</span><span style="color:#24292E;">: </span><span style="color:#032F62;">v1</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 必填，版本号</span></span>
<span class="line"><span style="color:#22863A;">kind</span><span style="color:#24292E;">: </span><span style="color:#032F62;">Service</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 必填，资源类型</span></span>
<span class="line"><span style="color:#22863A;">metadata</span><span style="color:#24292E;">: </span><span style="color:#6A737D;"># 必填，元数据</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&lt;name&gt;-svc</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 必填，资源名称</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">namespace</span><span style="color:#24292E;">: </span><span style="color:#032F62;">test</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 资源命名空间</span></span>
<span class="line"><span style="color:#22863A;">spec</span><span style="color:#24292E;">: </span><span style="color:#6A737D;"># 必填，资源详细定义</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">clusterIP</span><span style="color:#24292E;">: </span><span style="color:#032F62;">None</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 必填，指定clusterIp为none，使用headless</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">selector</span><span style="color:#24292E;">: </span><span style="color:#6A737D;"># 必填，标签选择</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">key</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&lt;value&gt;</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 必填，通过此标签匹配对应的资源</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">ports</span><span style="color:#24292E;">: </span><span style="color:#6A737D;"># 必填，服务暴露端端口列表</span></span>
<span class="line"><span style="color:#24292E;">  - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">string</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 服务暴露名称</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">port</span><span style="color:#24292E;">: </span><span style="color:#032F62;">int</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 必填，服务监听端口号</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">targetPort</span><span style="color:#24292E;">: </span><span style="color:#032F62;">int</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 必填，服务转发后端Pod端口号</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">protocol</span><span style="color:#24292E;">: [</span><span style="color:#032F62;">TCP | UDP</span><span style="color:#24292E;">] </span><span style="color:#6A737D;"># 端口协议</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">sessionAffinity</span><span style="color:#24292E;">: [</span><span style="color:#032F62;">None | ClientIP</span><span style="color:#24292E;">] </span><span style="color:#6A737D;"># 要使用的粘性会话的类型,默认none不使用。ClientIP：基于客户端IP地址识别客户端身份，把来自同一个源IP地址的请求始终调度至同一个Pod对象。</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">sessionAffinityConfig</span><span style="color:#24292E;">: </span><span style="color:#032F62;">int</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 会话保持的时长</span></span></code></pre></div><ul><li>yaml示例：使用headless方式，将myapp的80端口服务暴露出去</li></ul><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#85E89D;">apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">v1</span></span>
<span class="line"><span style="color:#85E89D;">kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Service</span></span>
<span class="line"><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">myapp-svc</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">namespace</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">test</span></span>
<span class="line"><span style="color:#85E89D;">spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">clusterIP</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">None</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">selector</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">app</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">myapp</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">ports</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  - </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">http</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">port</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">80</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">targetPort</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">80</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#22863A;">apiVersion</span><span style="color:#24292E;">: </span><span style="color:#032F62;">v1</span></span>
<span class="line"><span style="color:#22863A;">kind</span><span style="color:#24292E;">: </span><span style="color:#032F62;">Service</span></span>
<span class="line"><span style="color:#22863A;">metadata</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">myapp-svc</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">namespace</span><span style="color:#24292E;">: </span><span style="color:#032F62;">test</span></span>
<span class="line"><span style="color:#22863A;">spec</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">clusterIP</span><span style="color:#24292E;">: </span><span style="color:#032F62;">None</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">selector</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">app</span><span style="color:#24292E;">: </span><span style="color:#032F62;">myapp</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">ports</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">http</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">port</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">80</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">targetPort</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">80</span></span></code></pre></div><h2 id="_3-4-ingress-k8s-ingress" tabindex="-1">3.4 Ingress(k8s-ingress) <a class="header-anchor" href="#_3-4-ingress-k8s-ingress" aria-label="Permalink to &quot;3.4 Ingress(k8s-ingress)&quot;">​</a></h2><ul><li>yaml模板</li></ul><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#85E89D;">apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">networking.k8s.io/v1</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># 必填，版本号</span></span>
<span class="line"><span style="color:#85E89D;">kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Ingress</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># 必填，资源类型</span></span>
<span class="line"><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">: </span><span style="color:#6A737D;"># 必填，元数据</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&lt;name&gt;-ingress</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># 必填，资源名称</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">labels</span><span style="color:#E1E4E8;">: </span><span style="color:#6A737D;"># 自定义标签</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">string</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;">#自定义标签名字&lt;key: value&gt;</span></span>
<span class="line"><span style="color:#85E89D;">spec</span><span style="color:#E1E4E8;">: </span><span style="color:#6A737D;"># 必填，资源详细定义</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">tls</span><span style="color:#E1E4E8;">: </span><span style="color:#6A737D;"># tls配置</span></span>
<span class="line"><span style="color:#E1E4E8;">  - </span><span style="color:#85E89D;">hosts</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    - </span><span style="color:#9ECBFF;">myapp.test.com</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;">#访问地址</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">secretName</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">string</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># tls证书名称</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">rules</span><span style="color:#E1E4E8;">: </span><span style="color:#6A737D;"># 定义当前Infress资源转发规则列表</span></span>
<span class="line"><span style="color:#E1E4E8;">  - </span><span style="color:#85E89D;">host</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">myapp.test.com</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">http</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">paths</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      - </span><span style="color:#85E89D;">pathType</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Prefix</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># 指定应如何匹配Ingress路径</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">path</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;/&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># 转发路径</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">backend</span><span style="color:#E1E4E8;">: </span><span style="color:#6A737D;"># 转发后端</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#85E89D;">service</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">string</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># 转发后端名称</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#85E89D;">port</span><span style="color:#E1E4E8;">: </span></span>
<span class="line"><span style="color:#E1E4E8;">              </span><span style="color:#85E89D;">number</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">int</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># 转发后端端口</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#22863A;">apiVersion</span><span style="color:#24292E;">: </span><span style="color:#032F62;">networking.k8s.io/v1</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 必填，版本号</span></span>
<span class="line"><span style="color:#22863A;">kind</span><span style="color:#24292E;">: </span><span style="color:#032F62;">Ingress</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 必填，资源类型</span></span>
<span class="line"><span style="color:#22863A;">metadata</span><span style="color:#24292E;">: </span><span style="color:#6A737D;"># 必填，元数据</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&lt;name&gt;-ingress</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 必填，资源名称</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">labels</span><span style="color:#24292E;">: </span><span style="color:#6A737D;"># 自定义标签</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">string</span><span style="color:#24292E;"> </span><span style="color:#6A737D;">#自定义标签名字&lt;key: value&gt;</span></span>
<span class="line"><span style="color:#22863A;">spec</span><span style="color:#24292E;">: </span><span style="color:#6A737D;"># 必填，资源详细定义</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">tls</span><span style="color:#24292E;">: </span><span style="color:#6A737D;"># tls配置</span></span>
<span class="line"><span style="color:#24292E;">  - </span><span style="color:#22863A;">hosts</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    - </span><span style="color:#032F62;">myapp.test.com</span><span style="color:#24292E;"> </span><span style="color:#6A737D;">#访问地址</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">secretName</span><span style="color:#24292E;">: </span><span style="color:#032F62;">string</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># tls证书名称</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">rules</span><span style="color:#24292E;">: </span><span style="color:#6A737D;"># 定义当前Infress资源转发规则列表</span></span>
<span class="line"><span style="color:#24292E;">  - </span><span style="color:#22863A;">host</span><span style="color:#24292E;">: </span><span style="color:#032F62;">myapp.test.com</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">http</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">paths</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      - </span><span style="color:#22863A;">pathType</span><span style="color:#24292E;">: </span><span style="color:#032F62;">Prefix</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 指定应如何匹配Ingress路径</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">path</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;/&quot;</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 转发路径</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">backend</span><span style="color:#24292E;">: </span><span style="color:#6A737D;"># 转发后端</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#22863A;">service</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">string</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 转发后端名称</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#22863A;">port</span><span style="color:#24292E;">: </span></span>
<span class="line"><span style="color:#24292E;">              </span><span style="color:#22863A;">number</span><span style="color:#24292E;">: </span><span style="color:#032F62;">int</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 转发后端端口</span></span></code></pre></div><ul><li>示例</li></ul><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#85E89D;">apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">networking.k8s.io/v1</span></span>
<span class="line"><span style="color:#85E89D;">kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Ingress</span></span>
<span class="line"><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">myapp-ingress</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">labels</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">myapp-ingress</span></span>
<span class="line"><span style="color:#85E89D;">spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">tls</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  - </span><span style="color:#85E89D;">hosts</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    - </span><span style="color:#9ECBFF;">myapp.test.com</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">secretName</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">myapp-tls-secret</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">rules</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  - </span><span style="color:#85E89D;">host</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">myapp.test.com</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">http</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">paths</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      - </span><span style="color:#85E89D;">pathType</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Prefix</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">path</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;/&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">backend</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#85E89D;">service</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">myapp-svc</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#85E89D;">port</span><span style="color:#E1E4E8;">: </span></span>
<span class="line"><span style="color:#E1E4E8;">              </span><span style="color:#85E89D;">number</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">80</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#22863A;">apiVersion</span><span style="color:#24292E;">: </span><span style="color:#032F62;">networking.k8s.io/v1</span></span>
<span class="line"><span style="color:#22863A;">kind</span><span style="color:#24292E;">: </span><span style="color:#032F62;">Ingress</span></span>
<span class="line"><span style="color:#22863A;">metadata</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">myapp-ingress</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">labels</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">myapp-ingress</span></span>
<span class="line"><span style="color:#22863A;">spec</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">tls</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  - </span><span style="color:#22863A;">hosts</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    - </span><span style="color:#032F62;">myapp.test.com</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">secretName</span><span style="color:#24292E;">: </span><span style="color:#032F62;">myapp-tls-secret</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">rules</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  - </span><span style="color:#22863A;">host</span><span style="color:#24292E;">: </span><span style="color:#032F62;">myapp.test.com</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">http</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">paths</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      - </span><span style="color:#22863A;">pathType</span><span style="color:#24292E;">: </span><span style="color:#032F62;">Prefix</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">path</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;/&quot;</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">backend</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#22863A;">service</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">myapp-svc</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#22863A;">port</span><span style="color:#24292E;">: </span></span>
<span class="line"><span style="color:#24292E;">              </span><span style="color:#22863A;">number</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">80</span></span></code></pre></div><h1 id="_4-存储" tabindex="-1">4. 存储 <a class="header-anchor" href="#_4-存储" aria-label="Permalink to &quot;4. 存储&quot;">​</a></h1><h2 id="_4-1-persistentvolume" tabindex="-1">4.1 PersistentVolume <a class="header-anchor" href="#_4-1-persistentvolume" aria-label="Permalink to &quot;4.1 PersistentVolume&quot;">​</a></h2><ul><li>yaml模板</li></ul><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#85E89D;">apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">v1</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># 必填，版本号</span></span>
<span class="line"><span style="color:#85E89D;">kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">PersistentVolume</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># 必填，资源类型</span></span>
<span class="line"><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">: </span><span style="color:#6A737D;"># 必填，元数据</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&lt;name&gt;-pv</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># 必填，资源名称</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">labels</span><span style="color:#E1E4E8;">: </span><span style="color:#6A737D;"># 资源标签</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">key</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">value</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;">#资源标签键值对 </span></span>
<span class="line"><span style="color:#85E89D;">spec</span><span style="color:#E1E4E8;">: </span><span style="color:#6A737D;"># 必填，资源详细定义</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">capacity</span><span style="color:#E1E4E8;">: </span><span style="color:#6A737D;"># 必填，当前PV的容量</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">storage</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&lt;int&gt;Gi</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># 必填，pv容量大小值，单位Ki，Mi，Gi</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">accessModes</span><span style="color:#E1E4E8;">: </span><span style="color:#6A737D;"># 必填，访问模式</span></span>
<span class="line"><span style="color:#E1E4E8;">    - </span><span style="color:#9ECBFF;">ReadWriteMany</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># ReadWriteOnce 仅可被单个节点读写挂载，ReadOnlyMany 可被多个节点同时只读挂载，ReadWriteMany 可被多个节点同时读写挂载</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">persistentVolumeReclaimPolicy</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Recycle</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># 必填，PV空间被释放时的处理机制。Retain：保持不动，由管理员随后手动回收。Recycle：空间回收，即删除存储卷目录下的所有文件（包括子目录和隐藏文件）。Delete：删除存储卷，仅部分云端存储系统支持</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">storageClassName</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">string</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># 当前PV所属的StorageClass的名称；默认为空值，即不属于任何StorageClass。</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">mountOptions</span><span style="color:#E1E4E8;">: </span><span style="color:#6A737D;"># 挂载选项组成的列表</span></span>
<span class="line"><span style="color:#E1E4E8;">    - </span><span style="color:#9ECBFF;">hard</span></span>
<span class="line"><span style="color:#E1E4E8;">    - </span><span style="color:#9ECBFF;">nfsvers=4.1</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">nfs</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">path</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">path</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># nfs共享目录</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">server</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">XXX.XXX.XXX.XXX</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># nfs服务器地址</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">volumeMode</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Filesystem</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># 卷模型，用于指定此卷可被用作文件系统还是裸格式的块设备；默认为Filesystem。</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#22863A;">apiVersion</span><span style="color:#24292E;">: </span><span style="color:#032F62;">v1</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 必填，版本号</span></span>
<span class="line"><span style="color:#22863A;">kind</span><span style="color:#24292E;">: </span><span style="color:#032F62;">PersistentVolume</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 必填，资源类型</span></span>
<span class="line"><span style="color:#22863A;">metadata</span><span style="color:#24292E;">: </span><span style="color:#6A737D;"># 必填，元数据</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&lt;name&gt;-pv</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 必填，资源名称</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">labels</span><span style="color:#24292E;">: </span><span style="color:#6A737D;"># 资源标签</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">key</span><span style="color:#24292E;">: </span><span style="color:#032F62;">value</span><span style="color:#24292E;"> </span><span style="color:#6A737D;">#资源标签键值对 </span></span>
<span class="line"><span style="color:#22863A;">spec</span><span style="color:#24292E;">: </span><span style="color:#6A737D;"># 必填，资源详细定义</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">capacity</span><span style="color:#24292E;">: </span><span style="color:#6A737D;"># 必填，当前PV的容量</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">storage</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&lt;int&gt;Gi</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 必填，pv容量大小值，单位Ki，Mi，Gi</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">accessModes</span><span style="color:#24292E;">: </span><span style="color:#6A737D;"># 必填，访问模式</span></span>
<span class="line"><span style="color:#24292E;">    - </span><span style="color:#032F62;">ReadWriteMany</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># ReadWriteOnce 仅可被单个节点读写挂载，ReadOnlyMany 可被多个节点同时只读挂载，ReadWriteMany 可被多个节点同时读写挂载</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">persistentVolumeReclaimPolicy</span><span style="color:#24292E;">: </span><span style="color:#032F62;">Recycle</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 必填，PV空间被释放时的处理机制。Retain：保持不动，由管理员随后手动回收。Recycle：空间回收，即删除存储卷目录下的所有文件（包括子目录和隐藏文件）。Delete：删除存储卷，仅部分云端存储系统支持</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">storageClassName</span><span style="color:#24292E;">: </span><span style="color:#032F62;">string</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 当前PV所属的StorageClass的名称；默认为空值，即不属于任何StorageClass。</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">mountOptions</span><span style="color:#24292E;">: </span><span style="color:#6A737D;"># 挂载选项组成的列表</span></span>
<span class="line"><span style="color:#24292E;">    - </span><span style="color:#032F62;">hard</span></span>
<span class="line"><span style="color:#24292E;">    - </span><span style="color:#032F62;">nfsvers=4.1</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">nfs</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">path</span><span style="color:#24292E;">: </span><span style="color:#032F62;">path</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># nfs共享目录</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">server</span><span style="color:#24292E;">: </span><span style="color:#032F62;">XXX.XXX.XXX.XXX</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># nfs服务器地址</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">volumeMode</span><span style="color:#24292E;">: </span><span style="color:#032F62;">Filesystem</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 卷模型，用于指定此卷可被用作文件系统还是裸格式的块设备；默认为Filesystem。</span></span></code></pre></div><ul><li>yaml示例：一个使用NFS存储后端的PV，空间大小为5GB，支持多路的读写操作</li></ul><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#85E89D;">apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">v1</span></span>
<span class="line"><span style="color:#85E89D;">kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">PersistentVolume</span></span>
<span class="line"><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">nfs-pv</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">labels</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">release</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">stable</span></span>
<span class="line"><span style="color:#85E89D;">spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">capacity</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">storage</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">5Gi</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">accessModes</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    - </span><span style="color:#9ECBFF;">ReadWriteMany</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">persistentVolumeReclaimPolicy</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Recycle</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">storageClassName</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">nfs</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">mountOptions</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    - </span><span style="color:#9ECBFF;">hard</span></span>
<span class="line"><span style="color:#E1E4E8;">    - </span><span style="color:#9ECBFF;">nfsvers=4.1</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">nfs</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">path</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">/nfs</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">server</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">172.17.0.2</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#22863A;">apiVersion</span><span style="color:#24292E;">: </span><span style="color:#032F62;">v1</span></span>
<span class="line"><span style="color:#22863A;">kind</span><span style="color:#24292E;">: </span><span style="color:#032F62;">PersistentVolume</span></span>
<span class="line"><span style="color:#22863A;">metadata</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">nfs-pv</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">labels</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">release</span><span style="color:#24292E;">: </span><span style="color:#032F62;">stable</span></span>
<span class="line"><span style="color:#22863A;">spec</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">capacity</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">storage</span><span style="color:#24292E;">: </span><span style="color:#032F62;">5Gi</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">accessModes</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    - </span><span style="color:#032F62;">ReadWriteMany</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">persistentVolumeReclaimPolicy</span><span style="color:#24292E;">: </span><span style="color:#032F62;">Recycle</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">storageClassName</span><span style="color:#24292E;">: </span><span style="color:#032F62;">nfs</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">mountOptions</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    - </span><span style="color:#032F62;">hard</span></span>
<span class="line"><span style="color:#24292E;">    - </span><span style="color:#032F62;">nfsvers=4.1</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">nfs</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">path</span><span style="color:#24292E;">: </span><span style="color:#032F62;">/nfs</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">server</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">172.17.0.2</span></span></code></pre></div><h2 id="_4-2-persistentvolumeclaim" tabindex="-1">4.2 PersistentVolumeClaim <a class="header-anchor" href="#_4-2-persistentvolumeclaim" aria-label="Permalink to &quot;4.2 PersistentVolumeClaim&quot;">​</a></h2><ul><li>yaml模板</li></ul><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#85E89D;">apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">v1</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># 必填，版本号</span></span>
<span class="line"><span style="color:#85E89D;">kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">PersistentVolumeClaim</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># 必填，资源类型</span></span>
<span class="line"><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">: </span><span style="color:#6A737D;"># 必填，元数据</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&lt;name&gt;-pvc</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># 必填，资源名称</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">namespace</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">test</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># 资源命名空间</span></span>
<span class="line"><span style="color:#85E89D;">spec</span><span style="color:#E1E4E8;">: </span><span style="color:#6A737D;"># 必填，资源详细定义</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">accessModes</span><span style="color:#E1E4E8;">: </span><span style="color:#6A737D;"># 必填，访问模式</span></span>
<span class="line"><span style="color:#E1E4E8;">    - </span><span style="color:#9ECBFF;">ReadWriteMany</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># ReadWriteOnce 仅可被单个节点读写挂载，ReadOnlyMany 可被多个节点同时只读挂载，ReadWriteMany 可被多个节点同时读写挂载</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">storageClassName</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">string</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># 必填，所依赖的存储类的名称。</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">volumeMode</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Filesystem</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># 卷模型，用于指定此卷可被用作文件系统还是裸格式的块设备；默认为Filesystem。</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">resources</span><span style="color:#E1E4E8;">: </span><span style="color:#6A737D;"># 必填，当前PVC存储卷需要占用的资源量最小值 </span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">requests</span><span style="color:#E1E4E8;">: </span><span style="color:#6A737D;"># 必填，pvc请求空间大小</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">storage</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">5Gi</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># 必填，空间大小值如1Gi</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">selector</span><span style="color:#E1E4E8;">: </span><span style="color:#6A737D;"># 绑定时对PV应用的标签选择器，用于挑选要绑定的PV</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">matchLabels</span><span style="color:#E1E4E8;">: </span><span style="color:#6A737D;"># 标签选择器</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">release</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">stable</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># key-value标签</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#22863A;">apiVersion</span><span style="color:#24292E;">: </span><span style="color:#032F62;">v1</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 必填，版本号</span></span>
<span class="line"><span style="color:#22863A;">kind</span><span style="color:#24292E;">: </span><span style="color:#032F62;">PersistentVolumeClaim</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 必填，资源类型</span></span>
<span class="line"><span style="color:#22863A;">metadata</span><span style="color:#24292E;">: </span><span style="color:#6A737D;"># 必填，元数据</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&lt;name&gt;-pvc</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 必填，资源名称</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">namespace</span><span style="color:#24292E;">: </span><span style="color:#032F62;">test</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 资源命名空间</span></span>
<span class="line"><span style="color:#22863A;">spec</span><span style="color:#24292E;">: </span><span style="color:#6A737D;"># 必填，资源详细定义</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">accessModes</span><span style="color:#24292E;">: </span><span style="color:#6A737D;"># 必填，访问模式</span></span>
<span class="line"><span style="color:#24292E;">    - </span><span style="color:#032F62;">ReadWriteMany</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># ReadWriteOnce 仅可被单个节点读写挂载，ReadOnlyMany 可被多个节点同时只读挂载，ReadWriteMany 可被多个节点同时读写挂载</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">storageClassName</span><span style="color:#24292E;">: </span><span style="color:#032F62;">string</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 必填，所依赖的存储类的名称。</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">volumeMode</span><span style="color:#24292E;">: </span><span style="color:#032F62;">Filesystem</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 卷模型，用于指定此卷可被用作文件系统还是裸格式的块设备；默认为Filesystem。</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">resources</span><span style="color:#24292E;">: </span><span style="color:#6A737D;"># 必填，当前PVC存储卷需要占用的资源量最小值 </span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">requests</span><span style="color:#24292E;">: </span><span style="color:#6A737D;"># 必填，pvc请求空间大小</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">storage</span><span style="color:#24292E;">: </span><span style="color:#032F62;">5Gi</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 必填，空间大小值如1Gi</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">selector</span><span style="color:#24292E;">: </span><span style="color:#6A737D;"># 绑定时对PV应用的标签选择器，用于挑选要绑定的PV</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">matchLabels</span><span style="color:#24292E;">: </span><span style="color:#6A737D;"># 标签选择器</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">release</span><span style="color:#24292E;">: </span><span style="color:#032F62;">stable</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># key-value标签</span></span></code></pre></div><ul><li>yaml示例：一个使用NFS存储后端的PVC，绑定release为stable且storageClassName为nfs的pv</li></ul><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#85E89D;">apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">v1</span></span>
<span class="line"><span style="color:#85E89D;">kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">PersistentVolumeClaim</span></span>
<span class="line"><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">nfs-pvc</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">namespace</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">test</span></span>
<span class="line"><span style="color:#85E89D;">spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">resources</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">requests</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">storage</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">5Gi</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">storageClassName</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">nfs</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">accessModes</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    - </span><span style="color:#9ECBFF;">ReadWriteOnce</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">selector</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">matchLabels</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">release</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">stable</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#22863A;">apiVersion</span><span style="color:#24292E;">: </span><span style="color:#032F62;">v1</span></span>
<span class="line"><span style="color:#22863A;">kind</span><span style="color:#24292E;">: </span><span style="color:#032F62;">PersistentVolumeClaim</span></span>
<span class="line"><span style="color:#22863A;">metadata</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">nfs-pvc</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">namespace</span><span style="color:#24292E;">: </span><span style="color:#032F62;">test</span></span>
<span class="line"><span style="color:#22863A;">spec</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">resources</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">requests</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">storage</span><span style="color:#24292E;">: </span><span style="color:#032F62;">5Gi</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">storageClassName</span><span style="color:#24292E;">: </span><span style="color:#032F62;">nfs</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">accessModes</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    - </span><span style="color:#032F62;">ReadWriteOnce</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">selector</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">matchLabels</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">release</span><span style="color:#24292E;">: </span><span style="color:#032F62;">stable</span></span></code></pre></div><h2 id="_4-3-storageclass" tabindex="-1">4.3 StorageClass <a class="header-anchor" href="#_4-3-storageclass" aria-label="Permalink to &quot;4.3 StorageClass&quot;">​</a></h2><blockquote><p>创建StorageClass之前，先要在集群创建ClusterRole、RoleBinding和ClusterRoleBinding</p></blockquote><ul><li>yaml模板</li></ul><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#85E89D;">apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">storage.k8s.io/v1</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># 必填，版本号</span></span>
<span class="line"><span style="color:#85E89D;">kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">StorageClass</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># 必填，资源类型</span></span>
<span class="line"><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">: </span><span style="color:#6A737D;"># 必填，元数据</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&lt;name&gt;-sc</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># 必填，资源名称</span></span>
<span class="line"><span style="color:#85E89D;">provisioner</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">string</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># 必填，这里的名称要和provisioner配置文件中的环境变量PROVISIONER_NAME保持一致</span></span>
<span class="line"><span style="color:#85E89D;">parameters</span><span style="color:#E1E4E8;">: </span><span style="color:#6A737D;"># 存储类参数</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#22863A;">apiVersion</span><span style="color:#24292E;">: </span><span style="color:#032F62;">storage.k8s.io/v1</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 必填，版本号</span></span>
<span class="line"><span style="color:#22863A;">kind</span><span style="color:#24292E;">: </span><span style="color:#032F62;">StorageClass</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 必填，资源类型</span></span>
<span class="line"><span style="color:#22863A;">metadata</span><span style="color:#24292E;">: </span><span style="color:#6A737D;"># 必填，元数据</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&lt;name&gt;-sc</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 必填，资源名称</span></span>
<span class="line"><span style="color:#22863A;">provisioner</span><span style="color:#24292E;">: </span><span style="color:#032F62;">string</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 必填，这里的名称要和provisioner配置文件中的环境变量PROVISIONER_NAME保持一致</span></span>
<span class="line"><span style="color:#22863A;">parameters</span><span style="color:#24292E;">: </span><span style="color:#6A737D;"># 存储类参数</span></span></code></pre></div><ul><li>yaml示例：以nfs共享存储为例</li></ul><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#85E89D;">apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">storage.k8s.io/v1</span><span style="color:#E1E4E8;"> </span></span>
<span class="line"><span style="color:#85E89D;">kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">StorageClass</span></span>
<span class="line"><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">nfs-sc</span></span>
<span class="line"><span style="color:#85E89D;">provisioner</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">nfs-storage</span></span>
<span class="line"><span style="color:#85E89D;">parameters</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">archiveOnDelete</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;false&quot;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#22863A;">apiVersion</span><span style="color:#24292E;">: </span><span style="color:#032F62;">storage.k8s.io/v1</span><span style="color:#24292E;"> </span></span>
<span class="line"><span style="color:#22863A;">kind</span><span style="color:#24292E;">: </span><span style="color:#032F62;">StorageClass</span></span>
<span class="line"><span style="color:#22863A;">metadata</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">nfs-sc</span></span>
<span class="line"><span style="color:#22863A;">provisioner</span><span style="color:#24292E;">: </span><span style="color:#032F62;">nfs-storage</span></span>
<span class="line"><span style="color:#22863A;">parameters</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">archiveOnDelete</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;false&quot;</span></span></code></pre></div><h1 id="_5-配置信息" tabindex="-1">5. 配置信息 <a class="header-anchor" href="#_5-配置信息" aria-label="Permalink to &quot;5. 配置信息&quot;">​</a></h1><h2 id="_5-1-configmap" tabindex="-1">5.1 ConfigMap <a class="header-anchor" href="#_5-1-configmap" aria-label="Permalink to &quot;5.1 ConfigMap&quot;">​</a></h2><ul><li>yaml模板</li></ul><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#85E89D;">apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">v1</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># 必填，版本号</span></span>
<span class="line"><span style="color:#85E89D;">kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">ConfigMap</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># 必填，资源类型</span></span>
<span class="line"><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">: </span><span style="color:#6A737D;"># 必填，元数据</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&lt;name&gt;-cm</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># 必填，资源名称</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">namespace</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">string</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># 资源命名空间</span></span>
<span class="line"><span style="color:#85E89D;">data</span><span style="color:#E1E4E8;">: </span><span style="color:#6A737D;"># 必填，保存的数据信息</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">key</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">value</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># 数据信息</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#22863A;">apiVersion</span><span style="color:#24292E;">: </span><span style="color:#032F62;">v1</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 必填，版本号</span></span>
<span class="line"><span style="color:#22863A;">kind</span><span style="color:#24292E;">: </span><span style="color:#032F62;">ConfigMap</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 必填，资源类型</span></span>
<span class="line"><span style="color:#22863A;">metadata</span><span style="color:#24292E;">: </span><span style="color:#6A737D;"># 必填，元数据</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&lt;name&gt;-cm</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 必填，资源名称</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">namespace</span><span style="color:#24292E;">: </span><span style="color:#032F62;">string</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 资源命名空间</span></span>
<span class="line"><span style="color:#22863A;">data</span><span style="color:#24292E;">: </span><span style="color:#6A737D;"># 必填，保存的数据信息</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">key</span><span style="color:#24292E;">: </span><span style="color:#032F62;">value</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 数据信息</span></span></code></pre></div><ul><li>yaml示例：创建configmap，保存两组信息：log_level为INFO，log_file为/var/log/test.log</li></ul><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#85E89D;">apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">v1</span></span>
<span class="line"><span style="color:#85E89D;">kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">ConfigMap</span></span>
<span class="line"><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">myapp-cm</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">namespace</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">test</span></span>
<span class="line"><span style="color:#85E89D;">data</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">log_level</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">INFO</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">log_file</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">/var/log/test.log</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#22863A;">apiVersion</span><span style="color:#24292E;">: </span><span style="color:#032F62;">v1</span></span>
<span class="line"><span style="color:#22863A;">kind</span><span style="color:#24292E;">: </span><span style="color:#032F62;">ConfigMap</span></span>
<span class="line"><span style="color:#22863A;">metadata</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">myapp-cm</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">namespace</span><span style="color:#24292E;">: </span><span style="color:#032F62;">test</span></span>
<span class="line"><span style="color:#22863A;">data</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">log_level</span><span style="color:#24292E;">: </span><span style="color:#032F62;">INFO</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">log_file</span><span style="color:#24292E;">: </span><span style="color:#032F62;">/var/log/test.log</span></span></code></pre></div><h2 id="_5-2-secret" tabindex="-1">5.2 Secret <a class="header-anchor" href="#_5-2-secret" aria-label="Permalink to &quot;5.2 Secret&quot;">​</a></h2><ul><li>yaml模板</li></ul><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#85E89D;">apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">v1</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># 必填，版本号</span></span>
<span class="line"><span style="color:#85E89D;">kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Secret</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># 必填，资源类型</span></span>
<span class="line"><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">: </span><span style="color:#6A737D;"># 必填，元数据</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&lt;name&gt;-cm</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># 必填，资源名称</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">namespace</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">string</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># 资源命名空间</span></span>
<span class="line"><span style="color:#85E89D;">type</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Opaque</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># 必填，secret数据类型标识。Opaque：base64 编码格式的 Secret，用来存储密码、密钥等。kubernetes.io/dockerconfigjson：用来存储私有docker registry的认证信息。kubernetes.io/service-account-token：用于被serviceaccount引用，serviceaccout 创建时Kubernetes会默认创建对应的secret</span></span>
<span class="line"><span style="color:#85E89D;">data</span><span style="color:#E1E4E8;">: </span><span style="color:#6A737D;"># 必填，保存的数据信息</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">key</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">value</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># 数据信息</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#22863A;">apiVersion</span><span style="color:#24292E;">: </span><span style="color:#032F62;">v1</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 必填，版本号</span></span>
<span class="line"><span style="color:#22863A;">kind</span><span style="color:#24292E;">: </span><span style="color:#032F62;">Secret</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 必填，资源类型</span></span>
<span class="line"><span style="color:#22863A;">metadata</span><span style="color:#24292E;">: </span><span style="color:#6A737D;"># 必填，元数据</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&lt;name&gt;-cm</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 必填，资源名称</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">namespace</span><span style="color:#24292E;">: </span><span style="color:#032F62;">string</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 资源命名空间</span></span>
<span class="line"><span style="color:#22863A;">type</span><span style="color:#24292E;">: </span><span style="color:#032F62;">Opaque</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 必填，secret数据类型标识。Opaque：base64 编码格式的 Secret，用来存储密码、密钥等。kubernetes.io/dockerconfigjson：用来存储私有docker registry的认证信息。kubernetes.io/service-account-token：用于被serviceaccount引用，serviceaccout 创建时Kubernetes会默认创建对应的secret</span></span>
<span class="line"><span style="color:#22863A;">data</span><span style="color:#24292E;">: </span><span style="color:#6A737D;"># 必填，保存的数据信息</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">key</span><span style="color:#24292E;">: </span><span style="color:#032F62;">value</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 数据信息</span></span></code></pre></div><ul><li>yaml示例</li></ul><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#85E89D;">apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">v1</span></span>
<span class="line"><span style="color:#85E89D;">kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Secret</span></span>
<span class="line"><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">password-secret</span></span>
<span class="line"><span style="color:#85E89D;">type</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Opaque</span></span>
<span class="line"><span style="color:#85E89D;">data</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">password</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">MTIzLmNvbQ==</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#22863A;">apiVersion</span><span style="color:#24292E;">: </span><span style="color:#032F62;">v1</span></span>
<span class="line"><span style="color:#22863A;">kind</span><span style="color:#24292E;">: </span><span style="color:#032F62;">Secret</span></span>
<span class="line"><span style="color:#22863A;">metadata</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">password-secret</span></span>
<span class="line"><span style="color:#22863A;">type</span><span style="color:#24292E;">: </span><span style="color:#032F62;">Opaque</span></span>
<span class="line"><span style="color:#22863A;">data</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">password</span><span style="color:#24292E;">: </span><span style="color:#032F62;">MTIzLmNvbQ==</span></span></code></pre></div>`,85),e=[o];function c(t,r,E,y,i,F){return n(),a("div",null,e)}const m=s(p,[["render",c]]);export{D as __pageData,m as default};
