import{_ as s,o as a,c as n,R as l}from"./chunks/framework.zUbWieqp.js";const d=JSON.parse('{"title":"","description":"","frontmatter":{},"headers":[],"relativePath":"guide/Database/SqlServer/AG/win.md","filePath":"guide/Database/SqlServer/AG/win.md","lastUpdated":1720533756000}'),p={name:"guide/Database/SqlServer/AG/win.md"},o=l(`<h2 id="_1-查看延迟" tabindex="-1">1.查看延迟 <a class="header-anchor" href="#_1-查看延迟" aria-label="Permalink to &quot;1.查看延迟&quot;">​</a></h2><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">--.查看ag延迟</span></span>
<span class="line"><span style="color:#F97583;">SELECT</span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">ar</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">replica_server_name</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">AS</span><span style="color:#E1E4E8;"> [副本名称] ,</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#79B8FF;">DB_NAME</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">dbr</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">database_id</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">AS</span><span style="color:#E1E4E8;"> [数据库名称] ,</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#79B8FF;">ISNULL</span><span style="color:#E1E4E8;">(</span><span style="color:#F97583;">CASE</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">dbr</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">redo_rate</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">WHEN</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">THEN</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">1</span></span>
<span class="line"><span style="color:#E1E4E8;">               </span><span style="color:#F97583;">ELSE</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">CAST</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">dbr</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">redo_queue_size</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">AS</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">FLOAT</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">dbr</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">redo_rate</span></span>
<span class="line"><span style="color:#E1E4E8;">               </span><span style="color:#F97583;">END</span><span style="color:#E1E4E8;">, </span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">AS</span><span style="color:#E1E4E8;"> [Redo延迟(秒)] ,</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#79B8FF;">ISNULL</span><span style="color:#E1E4E8;">(</span><span style="color:#F97583;">CASE</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">dbr</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">log_send_rate</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">WHEN</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">THEN</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">1</span></span>
<span class="line"><span style="color:#E1E4E8;">               </span><span style="color:#F97583;">ELSE</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">CAST</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">dbr</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">log_send_queue_size</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">AS</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">FLOAT</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">dbr</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">log_send_rate</span></span>
<span class="line"><span style="color:#E1E4E8;">               </span><span style="color:#F97583;">END</span><span style="color:#E1E4E8;">, </span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">AS</span><span style="color:#E1E4E8;"> [Log传送延迟(秒)] ,</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#79B8FF;">dbr</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">redo_queue_size</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">AS</span><span style="color:#E1E4E8;"> [Redo等待队列(KB)] ,</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#79B8FF;">dbr</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">redo_rate</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">AS</span><span style="color:#E1E4E8;"> [Redo速率(KB/S)] ,</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#79B8FF;">dbr</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">log_send_queue_size</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">AS</span><span style="color:#E1E4E8;"> [Log传送等待队列(KB)] ,</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#79B8FF;">dbr</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">log_send_rate</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">AS</span><span style="color:#E1E4E8;"> [Log传送速率(KB\\S)]</span></span>
<span class="line"><span style="color:#F97583;">FROM</span><span style="color:#E1E4E8;">    [master].</span><span style="color:#79B8FF;">sys</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">availability_replicas</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">AS</span><span style="color:#E1E4E8;"> AR</span></span>
<span class="line"><span style="color:#F97583;">INNER JOIN</span><span style="color:#E1E4E8;"> [master].</span><span style="color:#79B8FF;">sys</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">dm_hadr_database_replica_states</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">AS</span><span style="color:#E1E4E8;"> dbr </span><span style="color:#F97583;">ON</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">ar</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">replica_id</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">dbr</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">replica_id</span></span>
<span class="line"><span style="color:#F97583;">WHERE</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">dbr</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">redo_queue_size</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">IS NOT NULL</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">--.查看ag延迟</span></span>
<span class="line"><span style="color:#D73A49;">SELECT</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">ar</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">replica_server_name</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">AS</span><span style="color:#24292E;"> [副本名称] ,</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#005CC5;">DB_NAME</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">dbr</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">database_id</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">AS</span><span style="color:#24292E;"> [数据库名称] ,</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#005CC5;">ISNULL</span><span style="color:#24292E;">(</span><span style="color:#D73A49;">CASE</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">dbr</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">redo_rate</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">WHEN</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">THEN</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">1</span></span>
<span class="line"><span style="color:#24292E;">               </span><span style="color:#D73A49;">ELSE</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">CAST</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">dbr</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">redo_queue_size</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">AS</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">FLOAT</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">/</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">dbr</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">redo_rate</span></span>
<span class="line"><span style="color:#24292E;">               </span><span style="color:#D73A49;">END</span><span style="color:#24292E;">, </span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">1</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">AS</span><span style="color:#24292E;"> [Redo延迟(秒)] ,</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#005CC5;">ISNULL</span><span style="color:#24292E;">(</span><span style="color:#D73A49;">CASE</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">dbr</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">log_send_rate</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">WHEN</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">THEN</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">1</span></span>
<span class="line"><span style="color:#24292E;">               </span><span style="color:#D73A49;">ELSE</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">CAST</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">dbr</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">log_send_queue_size</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">AS</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">FLOAT</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">/</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">dbr</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">log_send_rate</span></span>
<span class="line"><span style="color:#24292E;">               </span><span style="color:#D73A49;">END</span><span style="color:#24292E;">, </span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">1</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">AS</span><span style="color:#24292E;"> [Log传送延迟(秒)] ,</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#005CC5;">dbr</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">redo_queue_size</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">AS</span><span style="color:#24292E;"> [Redo等待队列(KB)] ,</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#005CC5;">dbr</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">redo_rate</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">AS</span><span style="color:#24292E;"> [Redo速率(KB/S)] ,</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#005CC5;">dbr</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">log_send_queue_size</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">AS</span><span style="color:#24292E;"> [Log传送等待队列(KB)] ,</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#005CC5;">dbr</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">log_send_rate</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">AS</span><span style="color:#24292E;"> [Log传送速率(KB\\S)]</span></span>
<span class="line"><span style="color:#D73A49;">FROM</span><span style="color:#24292E;">    [master].</span><span style="color:#005CC5;">sys</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">availability_replicas</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">AS</span><span style="color:#24292E;"> AR</span></span>
<span class="line"><span style="color:#D73A49;">INNER JOIN</span><span style="color:#24292E;"> [master].</span><span style="color:#005CC5;">sys</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">dm_hadr_database_replica_states</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">AS</span><span style="color:#24292E;"> dbr </span><span style="color:#D73A49;">ON</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">ar</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">replica_id</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">dbr</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">replica_id</span></span>
<span class="line"><span style="color:#D73A49;">WHERE</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">dbr</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">redo_queue_size</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">IS NOT NULL</span></span></code></pre></div><p><a href="https://www.yisu.com/zixun/571235.html" target="_blank" rel="noreferrer">https://www.yisu.com/zixun/571235.html</a></p><p><a href="https://www.cnblogs.com/Amaranthus/tag/AlwaysOn%20Availability%20Groups/" target="_blank" rel="noreferrer">https://www.cnblogs.com/Amaranthus/tag/AlwaysOn Availability Groups/</a></p>`,4),e=[o];function r(t,c,E,y,F,i){return a(),n("div",null,e)}const _=s(p,[["render",r]]);export{d as __pageData,_ as default};
