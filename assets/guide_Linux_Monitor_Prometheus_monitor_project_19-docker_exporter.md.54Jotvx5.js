import{_ as s,o as a,c as n,R as e}from"./chunks/framework.zUbWieqp.js";const u=JSON.parse('{"title":"1. Docker容器监控","description":"","frontmatter":{},"headers":[],"relativePath":"guide/Linux/Monitor/Prometheus/monitor_project/19-docker_exporter.md","filePath":"guide/Linux/Monitor/Prometheus/monitor_project/19-docker_exporter.md","lastUpdated":1739960402000}'),o={name:"guide/Linux/Monitor/Prometheus/monitor_project/19-docker_exporter.md"},l=e(`<h1 id="_1-docker容器监控" tabindex="-1">1. Docker容器监控 <a class="header-anchor" href="#_1-docker容器监控" aria-label="Permalink to &quot;1. Docker容器监控&quot;">​</a></h1><h2 id="_1-1-cadvisor工具" tabindex="-1">1.1 CAdvisor工具 <a class="header-anchor" href="#_1-1-cadvisor工具" aria-label="Permalink to &quot;1.1 CAdvisor工具&quot;">​</a></h2><p>CAdvisor为Google开源的一款用于监控和展示容器运行状态的可视化工具。CAdvisor可直接运行在主机上，它不仅可以搜集到机器上所有运行的容器信息，还提供查询界面和http接口，方便如Prometheus等监控系统进行数据的获取。</p><h1 id="_2-cadvisor部署" tabindex="-1">2. CAdvisor部署 <a class="header-anchor" href="#_2-cadvisor部署" aria-label="Permalink to &quot;2. CAdvisor部署&quot;">​</a></h1><h2 id="_2-1-启动" tabindex="-1">2.1 启动 <a class="header-anchor" href="#_2-1-启动" aria-label="Permalink to &quot;2.1 启动&quot;">​</a></h2><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">docker</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">run</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">--volume=/:/rootfs:ro</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">--volume=/var/run:/var/run:rw</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">--volume=/sys:/sys:ro</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">--volume=/var/lib/docker/:/var/lib/docker:ro</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">--volume=/dev/disk/:/dev/disk:ro</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">--publish=8080:8080</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">--detach=true</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">--name=cadvisor</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">--privileged=true</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">google/cadvisor:latest</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">docker</span><span style="color:#24292E;"> </span><span style="color:#032F62;">run</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#005CC5;">--volume=/:/rootfs:ro</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#005CC5;">--volume=/var/run:/var/run:rw</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#005CC5;">--volume=/sys:/sys:ro</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#005CC5;">--volume=/var/lib/docker/:/var/lib/docker:ro</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#005CC5;">--volume=/dev/disk/:/dev/disk:ro</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#005CC5;">--publish=8080:8080</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#005CC5;">--detach=true</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#005CC5;">--name=cadvisor</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#005CC5;">--privileged=true</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#032F62;">google/cadvisor:latest</span></span></code></pre></div><h2 id="_2-2-配置prometheus" tabindex="-1">2.2 配置prometheus <a class="header-anchor" href="#_2-2-配置prometheus" aria-label="Permalink to &quot;2.2 配置prometheus&quot;">​</a></h2><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">-</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">job_name:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;docker&#39;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">static_configs:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">-</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">targets:</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#B392F0;">-</span><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">&#39;192.168.214.108:8080&#39;</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#B392F0;">labels:</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#B392F0;">group:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">docker</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">-</span><span style="color:#24292E;"> </span><span style="color:#032F62;">job_name:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;docker&#39;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">static_configs:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">-</span><span style="color:#24292E;"> </span><span style="color:#032F62;">targets:</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#6F42C1;">-</span><span style="color:#24292E;">  </span><span style="color:#032F62;">&#39;192.168.214.108:8080&#39;</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#6F42C1;">labels:</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6F42C1;">group:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">docker</span></span></code></pre></div><h1 id="_3-cadvisor指标" tabindex="-1">3. CAdvisor指标 <a class="header-anchor" href="#_3-cadvisor指标" aria-label="Permalink to &quot;3. CAdvisor指标&quot;">​</a></h1><p>以下是比较常用到的一些容器指标：</p><ul><li>CPU指标</li></ul><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">container_cpu_load_average_10s       #最近10秒容器的CPU平均负载情况</span></span>
<span class="line"><span style="color:#e1e4e8;">container_cpu_usage_seconds_total    #容器的CPU累积占用时间</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">container_cpu_load_average_10s       #最近10秒容器的CPU平均负载情况</span></span>
<span class="line"><span style="color:#24292e;">container_cpu_usage_seconds_total    #容器的CPU累积占用时间</span></span></code></pre></div><ul><li>内存指标</li></ul><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">container_memory_max_usage_bytes     #容器的最大内存使用量（单位:字节）</span></span>
<span class="line"><span style="color:#e1e4e8;">container_memory_usage_bytes        #容器的当前内存使用量（单位：字节）</span></span>
<span class="line"><span style="color:#e1e4e8;">container_spec_memory_limit_bytes    #容器的可使用最大内存数量（单位：字节）</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">container_memory_max_usage_bytes     #容器的最大内存使用量（单位:字节）</span></span>
<span class="line"><span style="color:#24292e;">container_memory_usage_bytes        #容器的当前内存使用量（单位：字节）</span></span>
<span class="line"><span style="color:#24292e;">container_spec_memory_limit_bytes    #容器的可使用最大内存数量（单位：字节）</span></span></code></pre></div><ul><li>网络指标</li></ul><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">container_network_receive_bytes_total   #容器网络累积接收字节数据总量（单位：字节）</span></span>
<span class="line"><span style="color:#e1e4e8;">container_network_transmit_bytes_total  #容器网络累积传输数据总量（单位：字节）</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">container_network_receive_bytes_total   #容器网络累积接收字节数据总量（单位：字节）</span></span>
<span class="line"><span style="color:#24292e;">container_network_transmit_bytes_total  #容器网络累积传输数据总量（单位：字节）</span></span></code></pre></div><table><thead><tr><th>指标名称</th><th>类型</th><th>含义</th></tr></thead><tbody><tr><td>container_cpu_load_average_10s</td><td>gauge</td><td>过去10秒容器CPU的平均负载</td></tr><tr><td>container_cpu_usage_seconds_total</td><td>counter</td><td>容器在每个CPU内核上的累积占用时间 (单位：秒)</td></tr><tr><td>container_cpu_system_seconds_total</td><td>counter</td><td>System CPU累积占用时间（单位：秒）</td></tr><tr><td>container_cpu_user_seconds_total</td><td>counter</td><td>User CPU累积占用时间（单位：秒）</td></tr><tr><td>container_fs_usage_bytes</td><td>gauge</td><td>容器中文件系统的使用量(单位：字节)</td></tr><tr><td>container_fs_limit_bytes</td><td>gauge</td><td>容器可以使用的文件系统总量(单位：字节)</td></tr><tr><td>container_fs_reads_bytes_total</td><td>counter</td><td>容器累积读取数据的总量(单位：字节)</td></tr><tr><td>container_fs_writes_bytes_total</td><td>counter</td><td>容器累积写入数据的总量(单位：字节)</td></tr><tr><td>container_memory_max_usage_bytes</td><td>gauge</td><td>容器的最大内存使用量（单位：字节）</td></tr><tr><td>container_memory_usage_bytes</td><td>gauge</td><td>容器当前的内存使用量（单位：字节</td></tr><tr><td>container_spec_memory_limit_bytes</td><td>gauge</td><td>容器的内存使用量限制</td></tr><tr><td>machine_memory_bytes</td><td>gauge</td><td>当前主机的内存总量</td></tr><tr><td>container_network_receive_bytes_total</td><td>counter</td><td>容器网络累积接收数据总量（单位：字节）</td></tr><tr><td>container_network_transmit_bytes_total</td><td>counter</td><td>容器网络累积传输数据总量（单位：字节）</td></tr></tbody></table><h1 id="_4-配置prometheus" tabindex="-1">4. 配置prometheus <a class="header-anchor" href="#_4-配置prometheus" aria-label="Permalink to &quot;4. 配置prometheus&quot;">​</a></h1><p>修改/etc/prometheus/prometheus.yml，将cAdvisor添加监控数据采集任务目标当中：</p><div class="language-yml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yml</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">- </span><span style="color:#85E89D;">job_name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;docker-cadvisor&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">static_configs</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  -  </span><span style="color:#85E89D;">targets</span><span style="color:#E1E4E8;">: [</span><span style="color:#9ECBFF;">&quot;127.0.0.1:8080&quot;</span><span style="color:#E1E4E8;">]</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">- </span><span style="color:#22863A;">job_name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;docker-cadvisor&quot;</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">static_configs</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  -  </span><span style="color:#22863A;">targets</span><span style="color:#24292E;">: [</span><span style="color:#032F62;">&quot;127.0.0.1:8080&quot;</span><span style="color:#24292E;">]</span></span></code></pre></div>`,20),t=[l];function p(r,c,i,d,y,E){return a(),n("div",null,t)}const h=s(o,[["render",p]]);export{u as __pageData,h as default};
