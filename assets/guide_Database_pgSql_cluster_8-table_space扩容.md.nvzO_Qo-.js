import{_ as s,o as a,c as n,R as p}from"./chunks/framework.zUbWieqp.js";const g=JSON.parse('{"title":"1.PostgreSQL在线扩容","description":"","frontmatter":{},"headers":[],"relativePath":"guide/Database/pgSql/cluster/8-table_space扩容.md","filePath":"guide/Database/pgSql/cluster/8-table_space扩容.md","lastUpdated":1711535325000}'),l={name:"guide/Database/pgSql/cluster/8-table_space扩容.md"},o=p(`<h1 id="_1-postgresql在线扩容" tabindex="-1">1.PostgreSQL在线扩容 <a class="header-anchor" href="#_1-postgresql在线扩容" aria-label="Permalink to &quot;1.PostgreSQL在线扩容&quot;">​</a></h1><blockquote><p>[!WARNING]</p><p>第一种：懒汉模式 直接使用系统默认表空间pg_default,不需要知道表空间的概念</p></blockquote><blockquote><p>[!WARNING]</p><p>第二种：悲观模式 用户预先创建好文件系统目录，创建自定义表空间，再创建数据库，建库使用自定义表空间，以后使用过程中直接创建表无需关注表空间，无感知。这也是推荐比较良好的使用习惯</p></blockquote><blockquote><p>[!WARNING]</p><p>第三种：乐观模式 不够用或者出问题再扩容 不管是使用默认表空间或者自定义表空间也有可能会出现空间满的情况，这时可以在现有库对新表指定新的表空间来满足使用</p></blockquote><h2 id="演示" tabindex="-1">演示： <a class="header-anchor" href="#演示" aria-label="Permalink to &quot;演示：&quot;">​</a></h2><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">postgres@postgres</span><span style="color:#F97583;">=&gt;select</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">oid</span><span style="color:#E1E4E8;">,spcname </span><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> pg_tablespace ;</span></span>
<span class="line"><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">oid</span><span style="color:#E1E4E8;">  |  spcname   </span></span>
<span class="line"><span style="color:#6A737D;">------+------------</span></span>
<span class="line"><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">1663</span><span style="color:#E1E4E8;"> | pg_default</span></span>
<span class="line"><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">1664</span><span style="color:#E1E4E8;"> | pg_global</span></span>
<span class="line"><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">2</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">rows</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">-- 初始化后默认有三个数据库，template0和template1，一般不能直接使用</span></span>
<span class="line"><span style="color:#6A737D;">-- 另一个postgres数据库oid为13593</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">postgres@postgres</span><span style="color:#F97583;">=&gt;select</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">oid</span><span style="color:#E1E4E8;">,datname </span><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> pg_database ;</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">oid</span><span style="color:#E1E4E8;">  |  datname  </span></span>
<span class="line"><span style="color:#6A737D;">-------+-----------</span></span>
<span class="line"><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">13447</span><span style="color:#E1E4E8;"> | postgres</span></span>
<span class="line"><span style="color:#E1E4E8;">     </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;"> | template1</span></span>
<span class="line"><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">13446</span><span style="color:#E1E4E8;"> | template0</span></span>
<span class="line"><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">4</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">rows</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">-- 第一种：postgres数据库创建数据表t</span></span>
<span class="line"><span style="color:#E1E4E8;">postgres@postgres</span><span style="color:#F97583;">=&gt;create</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">table</span><span style="color:#E1E4E8;"> t(id </span><span style="color:#F97583;">int</span><span style="color:#E1E4E8;">,info </span><span style="color:#F97583;">text</span><span style="color:#E1E4E8;">) ;</span></span>
<span class="line"><span style="color:#F97583;">CREATE</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">TABLE</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">postgres@postgres</span><span style="color:#F97583;">=&gt;select</span><span style="color:#E1E4E8;"> to_regclass(</span><span style="color:#9ECBFF;">&#39;t&#39;</span><span style="color:#E1E4E8;">)::</span><span style="color:#F97583;">oid</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;"> to_regclass </span></span>
<span class="line"><span style="color:#6A737D;">-------------</span></span>
<span class="line"><span style="color:#E1E4E8;">       </span><span style="color:#79B8FF;">17726</span></span>
<span class="line"><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">row</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">--查看文件存储位置</span></span>
<span class="line"><span style="color:#E1E4E8;">postgres@postgres</span><span style="color:#F97583;">=&gt;select</span><span style="color:#E1E4E8;"> pg_relation_filepath(</span><span style="color:#9ECBFF;">&#39;t&#39;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;"> pg_relation_filepath </span></span>
<span class="line"><span style="color:#6A737D;">----------------------</span></span>
<span class="line"><span style="color:#E1E4E8;"> base</span><span style="color:#F97583;">/</span><span style="color:#79B8FF;">13447</span><span style="color:#F97583;">/</span><span style="color:#79B8FF;">17726</span></span>
<span class="line"><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">row</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#6A737D;">-- base为$PGDATA下的目录，默认表空间pg_default放在此目录下</span></span>
<span class="line"><span style="color:#6A737D;">-- 13447代表数据库postgres</span></span>
<span class="line"><span style="color:#6A737D;">-- 17726是上面t表的oid</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">-- 创建表空间名字</span></span>
<span class="line"><span style="color:#E1E4E8;">postgres@postgres</span><span style="color:#F97583;">=&gt;create</span><span style="color:#E1E4E8;"> tablespace my_tablespace </span><span style="color:#F97583;">owner</span><span style="color:#E1E4E8;"> postgres </span><span style="color:#F97583;">location</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;/home/ptgres/kongjian&#39;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#F97583;">CREATE</span><span style="color:#E1E4E8;"> TABLESPACE</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">-- 新建数据库test,并指定表空间</span></span>
<span class="line"><span style="color:#E1E4E8;">postgres@postgres</span><span style="color:#F97583;">=&gt;create</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">database</span><span style="color:#E1E4E8;"> test </span><span style="color:#F97583;">owner=</span><span style="color:#E1E4E8;">test tablespace</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">my_tablespace;</span></span>
<span class="line"><span style="color:#F97583;">CREATE</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">DATABASE</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">-- 查看数据库，可以看到test数据库的oid为 17734</span></span>
<span class="line"><span style="color:#E1E4E8;">postgres@postgres</span><span style="color:#F97583;">=&gt;select</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">oid</span><span style="color:#E1E4E8;">,datname </span><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> pg_database ;</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">oid</span><span style="color:#E1E4E8;">  |  datname  </span></span>
<span class="line"><span style="color:#6A737D;">-------+-----------</span></span>
<span class="line"><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">13447</span><span style="color:#E1E4E8;"> | postgres</span></span>
<span class="line"><span style="color:#E1E4E8;">     </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;"> | template1</span></span>
<span class="line"><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">13446</span><span style="color:#E1E4E8;"> | template0</span></span>
<span class="line"><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">17734</span><span style="color:#E1E4E8;"> | test</span></span>
<span class="line"><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">5</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">rows</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">-- 第二种：test数据库使用test用户创建数据表t</span></span>
<span class="line"><span style="color:#E1E4E8;">test</span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">create</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">table</span><span style="color:#E1E4E8;"> t(id </span><span style="color:#F97583;">int</span><span style="color:#E1E4E8;">,info </span><span style="color:#F97583;">text</span><span style="color:#E1E4E8;">) ;</span></span>
<span class="line"><span style="color:#E1E4E8;">test</span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">select</span><span style="color:#E1E4E8;"> to_regclass(</span><span style="color:#9ECBFF;">&#39;t&#39;</span><span style="color:#E1E4E8;">)::</span><span style="color:#F97583;">oid</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;"> to_regclass </span></span>
<span class="line"><span style="color:#6A737D;">-------------</span></span>
<span class="line"><span style="color:#E1E4E8;">       </span><span style="color:#79B8FF;">24694</span></span>
<span class="line"><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">row</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">--查看文件存储位置</span></span>
<span class="line"><span style="color:#E1E4E8;">test</span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">select</span><span style="color:#E1E4E8;"> pg_relation_filepath(</span><span style="color:#9ECBFF;">&#39;t&#39;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">            pg_relation_filepath             </span></span>
<span class="line"><span style="color:#6A737D;">---------------------------------------------</span></span>
<span class="line"><span style="color:#E1E4E8;"> pg_tblspc</span><span style="color:#F97583;">/</span><span style="color:#79B8FF;">24692</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">PG_12_201909212</span><span style="color:#F97583;">/</span><span style="color:#79B8FF;">24693</span><span style="color:#F97583;">/</span><span style="color:#79B8FF;">24694</span></span>
<span class="line"><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">row</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#6A737D;">-- pg_tblspc下为符号链接</span></span>
<span class="line"><span style="color:#6A737D;">-- 24692是自定义表空间my_tablespace的oid</span></span>
<span class="line"><span style="color:#6A737D;">-- PG_12_201909212是一个特定命名，12是主版本号，201909212是目录版本号</span></span>
<span class="line"><span style="color:#6A737D;">-- 24693是test数据库的oid</span></span>
<span class="line"><span style="color:#6A737D;">-- 24694是t表的oid</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">$ ls </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">l pg_tblspc</span><span style="color:#F97583;">/</span></span>
<span class="line"><span style="color:#E1E4E8;">lrwxrwxrwx. </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;"> postgres dba </span><span style="color:#79B8FF;">17</span><span style="color:#E1E4E8;"> Jan  </span><span style="color:#79B8FF;">7</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">14</span><span style="color:#E1E4E8;">:</span><span style="color:#79B8FF;">07</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">24692</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">-&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">opt</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">mytablespace</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">-- 第三种：postgres数据库创建数据表t2，同时指定表空间</span></span>
<span class="line"><span style="color:#E1E4E8;">postgres</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"># </span><span style="color:#F97583;">create</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">table</span><span style="color:#E1E4E8;"> t2 (id </span><span style="color:#F97583;">int</span><span style="color:#E1E4E8;">,info </span><span style="color:#F97583;">text</span><span style="color:#E1E4E8;">) tablespace my_tablespace ;</span></span>
<span class="line"><span style="color:#E1E4E8;">postgres</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"># </span><span style="color:#F97583;">select</span><span style="color:#E1E4E8;"> pg_relation_filepath(</span><span style="color:#9ECBFF;">&#39;t2&#39;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">            pg_relation_filepath             </span></span>
<span class="line"><span style="color:#6A737D;">---------------------------------------------</span></span>
<span class="line"><span style="color:#E1E4E8;"> pg_tblspc</span><span style="color:#F97583;">/</span><span style="color:#79B8FF;">24692</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">PG_12_201909212</span><span style="color:#F97583;">/</span><span style="color:#79B8FF;">13593</span><span style="color:#F97583;">/</span><span style="color:#79B8FF;">24700</span></span>
<span class="line"><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">row</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#6A737D;">-- 24692是自定义表空间my_tablespace的oid</span></span>
<span class="line"><span style="color:#6A737D;">-- 13593是postgres数据库的oid</span></span>
<span class="line"><span style="color:#6A737D;">-- 24700是t2表的oid</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">postgres@postgres</span><span style="color:#D73A49;">=&gt;select</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">oid</span><span style="color:#24292E;">,spcname </span><span style="color:#D73A49;">from</span><span style="color:#24292E;"> pg_tablespace ;</span></span>
<span class="line"><span style="color:#24292E;"> </span><span style="color:#D73A49;">oid</span><span style="color:#24292E;">  |  spcname   </span></span>
<span class="line"><span style="color:#6A737D;">------+------------</span></span>
<span class="line"><span style="color:#24292E;"> </span><span style="color:#005CC5;">1663</span><span style="color:#24292E;"> | pg_default</span></span>
<span class="line"><span style="color:#24292E;"> </span><span style="color:#005CC5;">1664</span><span style="color:#24292E;"> | pg_global</span></span>
<span class="line"><span style="color:#24292E;">(</span><span style="color:#005CC5;">2</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">rows</span><span style="color:#24292E;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">-- 初始化后默认有三个数据库，template0和template1，一般不能直接使用</span></span>
<span class="line"><span style="color:#6A737D;">-- 另一个postgres数据库oid为13593</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">postgres@postgres</span><span style="color:#D73A49;">=&gt;select</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">oid</span><span style="color:#24292E;">,datname </span><span style="color:#D73A49;">from</span><span style="color:#24292E;"> pg_database ;</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">oid</span><span style="color:#24292E;">  |  datname  </span></span>
<span class="line"><span style="color:#6A737D;">-------+-----------</span></span>
<span class="line"><span style="color:#24292E;"> </span><span style="color:#005CC5;">13447</span><span style="color:#24292E;"> | postgres</span></span>
<span class="line"><span style="color:#24292E;">     </span><span style="color:#005CC5;">1</span><span style="color:#24292E;"> | template1</span></span>
<span class="line"><span style="color:#24292E;"> </span><span style="color:#005CC5;">13446</span><span style="color:#24292E;"> | template0</span></span>
<span class="line"><span style="color:#24292E;">(</span><span style="color:#005CC5;">4</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">rows</span><span style="color:#24292E;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">-- 第一种：postgres数据库创建数据表t</span></span>
<span class="line"><span style="color:#24292E;">postgres@postgres</span><span style="color:#D73A49;">=&gt;create</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">table</span><span style="color:#24292E;"> t(id </span><span style="color:#D73A49;">int</span><span style="color:#24292E;">,info </span><span style="color:#D73A49;">text</span><span style="color:#24292E;">) ;</span></span>
<span class="line"><span style="color:#D73A49;">CREATE</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">TABLE</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">postgres@postgres</span><span style="color:#D73A49;">=&gt;select</span><span style="color:#24292E;"> to_regclass(</span><span style="color:#032F62;">&#39;t&#39;</span><span style="color:#24292E;">)::</span><span style="color:#D73A49;">oid</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;"> to_regclass </span></span>
<span class="line"><span style="color:#6A737D;">-------------</span></span>
<span class="line"><span style="color:#24292E;">       </span><span style="color:#005CC5;">17726</span></span>
<span class="line"><span style="color:#24292E;">(</span><span style="color:#005CC5;">1</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">row</span><span style="color:#24292E;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">--查看文件存储位置</span></span>
<span class="line"><span style="color:#24292E;">postgres@postgres</span><span style="color:#D73A49;">=&gt;select</span><span style="color:#24292E;"> pg_relation_filepath(</span><span style="color:#032F62;">&#39;t&#39;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;"> pg_relation_filepath </span></span>
<span class="line"><span style="color:#6A737D;">----------------------</span></span>
<span class="line"><span style="color:#24292E;"> base</span><span style="color:#D73A49;">/</span><span style="color:#005CC5;">13447</span><span style="color:#D73A49;">/</span><span style="color:#005CC5;">17726</span></span>
<span class="line"><span style="color:#24292E;">(</span><span style="color:#005CC5;">1</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">row</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#6A737D;">-- base为$PGDATA下的目录，默认表空间pg_default放在此目录下</span></span>
<span class="line"><span style="color:#6A737D;">-- 13447代表数据库postgres</span></span>
<span class="line"><span style="color:#6A737D;">-- 17726是上面t表的oid</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">-- 创建表空间名字</span></span>
<span class="line"><span style="color:#24292E;">postgres@postgres</span><span style="color:#D73A49;">=&gt;create</span><span style="color:#24292E;"> tablespace my_tablespace </span><span style="color:#D73A49;">owner</span><span style="color:#24292E;"> postgres </span><span style="color:#D73A49;">location</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;/home/ptgres/kongjian&#39;</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#D73A49;">CREATE</span><span style="color:#24292E;"> TABLESPACE</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">-- 新建数据库test,并指定表空间</span></span>
<span class="line"><span style="color:#24292E;">postgres@postgres</span><span style="color:#D73A49;">=&gt;create</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">database</span><span style="color:#24292E;"> test </span><span style="color:#D73A49;">owner=</span><span style="color:#24292E;">test tablespace</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">my_tablespace;</span></span>
<span class="line"><span style="color:#D73A49;">CREATE</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">DATABASE</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">-- 查看数据库，可以看到test数据库的oid为 17734</span></span>
<span class="line"><span style="color:#24292E;">postgres@postgres</span><span style="color:#D73A49;">=&gt;select</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">oid</span><span style="color:#24292E;">,datname </span><span style="color:#D73A49;">from</span><span style="color:#24292E;"> pg_database ;</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">oid</span><span style="color:#24292E;">  |  datname  </span></span>
<span class="line"><span style="color:#6A737D;">-------+-----------</span></span>
<span class="line"><span style="color:#24292E;"> </span><span style="color:#005CC5;">13447</span><span style="color:#24292E;"> | postgres</span></span>
<span class="line"><span style="color:#24292E;">     </span><span style="color:#005CC5;">1</span><span style="color:#24292E;"> | template1</span></span>
<span class="line"><span style="color:#24292E;"> </span><span style="color:#005CC5;">13446</span><span style="color:#24292E;"> | template0</span></span>
<span class="line"><span style="color:#24292E;"> </span><span style="color:#005CC5;">17734</span><span style="color:#24292E;"> | test</span></span>
<span class="line"><span style="color:#24292E;">(</span><span style="color:#005CC5;">5</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">rows</span><span style="color:#24292E;">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">-- 第二种：test数据库使用test用户创建数据表t</span></span>
<span class="line"><span style="color:#24292E;">test</span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;">  </span><span style="color:#D73A49;">create</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">table</span><span style="color:#24292E;"> t(id </span><span style="color:#D73A49;">int</span><span style="color:#24292E;">,info </span><span style="color:#D73A49;">text</span><span style="color:#24292E;">) ;</span></span>
<span class="line"><span style="color:#24292E;">test</span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;">  </span><span style="color:#D73A49;">select</span><span style="color:#24292E;"> to_regclass(</span><span style="color:#032F62;">&#39;t&#39;</span><span style="color:#24292E;">)::</span><span style="color:#D73A49;">oid</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;"> to_regclass </span></span>
<span class="line"><span style="color:#6A737D;">-------------</span></span>
<span class="line"><span style="color:#24292E;">       </span><span style="color:#005CC5;">24694</span></span>
<span class="line"><span style="color:#24292E;">(</span><span style="color:#005CC5;">1</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">row</span><span style="color:#24292E;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">--查看文件存储位置</span></span>
<span class="line"><span style="color:#24292E;">test</span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">select</span><span style="color:#24292E;"> pg_relation_filepath(</span><span style="color:#032F62;">&#39;t&#39;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">            pg_relation_filepath             </span></span>
<span class="line"><span style="color:#6A737D;">---------------------------------------------</span></span>
<span class="line"><span style="color:#24292E;"> pg_tblspc</span><span style="color:#D73A49;">/</span><span style="color:#005CC5;">24692</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">PG_12_201909212</span><span style="color:#D73A49;">/</span><span style="color:#005CC5;">24693</span><span style="color:#D73A49;">/</span><span style="color:#005CC5;">24694</span></span>
<span class="line"><span style="color:#24292E;">(</span><span style="color:#005CC5;">1</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">row</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#6A737D;">-- pg_tblspc下为符号链接</span></span>
<span class="line"><span style="color:#6A737D;">-- 24692是自定义表空间my_tablespace的oid</span></span>
<span class="line"><span style="color:#6A737D;">-- PG_12_201909212是一个特定命名，12是主版本号，201909212是目录版本号</span></span>
<span class="line"><span style="color:#6A737D;">-- 24693是test数据库的oid</span></span>
<span class="line"><span style="color:#6A737D;">-- 24694是t表的oid</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">$ ls </span><span style="color:#D73A49;">-</span><span style="color:#24292E;">l pg_tblspc</span><span style="color:#D73A49;">/</span></span>
<span class="line"><span style="color:#24292E;">lrwxrwxrwx. </span><span style="color:#005CC5;">1</span><span style="color:#24292E;"> postgres dba </span><span style="color:#005CC5;">17</span><span style="color:#24292E;"> Jan  </span><span style="color:#005CC5;">7</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">14</span><span style="color:#24292E;">:</span><span style="color:#005CC5;">07</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">24692</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">-&gt;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">/</span><span style="color:#24292E;">opt</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">mytablespace</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">-- 第三种：postgres数据库创建数据表t2，同时指定表空间</span></span>
<span class="line"><span style="color:#24292E;">postgres</span><span style="color:#D73A49;">=</span><span style="color:#24292E;"># </span><span style="color:#D73A49;">create</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">table</span><span style="color:#24292E;"> t2 (id </span><span style="color:#D73A49;">int</span><span style="color:#24292E;">,info </span><span style="color:#D73A49;">text</span><span style="color:#24292E;">) tablespace my_tablespace ;</span></span>
<span class="line"><span style="color:#24292E;">postgres</span><span style="color:#D73A49;">=</span><span style="color:#24292E;"># </span><span style="color:#D73A49;">select</span><span style="color:#24292E;"> pg_relation_filepath(</span><span style="color:#032F62;">&#39;t2&#39;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">            pg_relation_filepath             </span></span>
<span class="line"><span style="color:#6A737D;">---------------------------------------------</span></span>
<span class="line"><span style="color:#24292E;"> pg_tblspc</span><span style="color:#D73A49;">/</span><span style="color:#005CC5;">24692</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">PG_12_201909212</span><span style="color:#D73A49;">/</span><span style="color:#005CC5;">13593</span><span style="color:#D73A49;">/</span><span style="color:#005CC5;">24700</span></span>
<span class="line"><span style="color:#24292E;">(</span><span style="color:#005CC5;">1</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">row</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#6A737D;">-- 24692是自定义表空间my_tablespace的oid</span></span>
<span class="line"><span style="color:#6A737D;">-- 13593是postgres数据库的oid</span></span>
<span class="line"><span style="color:#6A737D;">-- 24700是t2表的oid</span></span></code></pre></div><h2 id="扩容" tabindex="-1">扩容： <a class="header-anchor" href="#扩容" aria-label="Permalink to &quot;扩容：&quot;">​</a></h2><h3 id="_1-查看表空间" tabindex="-1">1.查看表空间 <a class="header-anchor" href="#_1-查看表空间" aria-label="Permalink to &quot;1.查看表空间&quot;">​</a></h3><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">postgres</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"># \\db</span><span style="color:#F97583;">+</span></span>
<span class="line"><span style="color:#E1E4E8;">                                  List of tablespaces</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">Name</span><span style="color:#E1E4E8;">    |  </span><span style="color:#F97583;">Owner</span><span style="color:#E1E4E8;">   | </span><span style="color:#F97583;">Location</span><span style="color:#E1E4E8;"> | Access privileges | Options |  </span><span style="color:#F97583;">Size</span><span style="color:#E1E4E8;">   | </span><span style="color:#F97583;">Description</span><span style="color:#E1E4E8;"> </span></span>
<span class="line"><span style="color:#6A737D;">------------+----------+----------+-------------------+---------+---------+-------------</span></span>
<span class="line"><span style="color:#E1E4E8;"> pg_default | postgres |          |                   |         | </span><span style="color:#79B8FF;">1088</span><span style="color:#E1E4E8;"> MB | </span></span>
<span class="line"><span style="color:#E1E4E8;"> pg_global  | postgres |          |                   |         | </span><span style="color:#79B8FF;">2167</span><span style="color:#E1E4E8;"> kB | </span></span>
<span class="line"><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">2</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">rows</span><span style="color:#E1E4E8;">)</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">postgres</span><span style="color:#D73A49;">=</span><span style="color:#24292E;"># \\db</span><span style="color:#D73A49;">+</span></span>
<span class="line"><span style="color:#24292E;">                                  List of tablespaces</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">Name</span><span style="color:#24292E;">    |  </span><span style="color:#D73A49;">Owner</span><span style="color:#24292E;">   | </span><span style="color:#D73A49;">Location</span><span style="color:#24292E;"> | Access privileges | Options |  </span><span style="color:#D73A49;">Size</span><span style="color:#24292E;">   | </span><span style="color:#D73A49;">Description</span><span style="color:#24292E;"> </span></span>
<span class="line"><span style="color:#6A737D;">------------+----------+----------+-------------------+---------+---------+-------------</span></span>
<span class="line"><span style="color:#24292E;"> pg_default | postgres |          |                   |         | </span><span style="color:#005CC5;">1088</span><span style="color:#24292E;"> MB | </span></span>
<span class="line"><span style="color:#24292E;"> pg_global  | postgres |          |                   |         | </span><span style="color:#005CC5;">2167</span><span style="color:#24292E;"> kB | </span></span>
<span class="line"><span style="color:#24292E;">(</span><span style="color:#005CC5;">2</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">rows</span><span style="color:#24292E;">)</span></span></code></pre></div><p>可以看到这里没有自定义表空间，默认使用pg_default 表空间</p><h3 id="_2-创建演示数据库和用户" tabindex="-1">2.创建演示数据库和用户 <a class="header-anchor" href="#_2-创建演示数据库和用户" aria-label="Permalink to &quot;2.创建演示数据库和用户&quot;">​</a></h3><p>使用新的数据库app,并且owner为app用户来进行演示</p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">postgres@postgres</span><span style="color:#F97583;">=&gt;create</span><span style="color:#E1E4E8;"> user app </span><span style="color:#F97583;">password</span><span style="color:#9ECBFF;">&#39;XXX123456&#39;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#F97583;">CREATE</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">ROLE</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">postgres@postgres</span><span style="color:#F97583;">=&gt;create</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">database</span><span style="color:#E1E4E8;"> app </span><span style="color:#F97583;">owner</span><span style="color:#E1E4E8;"> app;</span></span>
<span class="line"><span style="color:#F97583;">CREATE</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">DATABASE</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">postgres@postgres</span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;">\\c app app</span></span>
<span class="line"><span style="color:#E1E4E8;">You are </span><span style="color:#F97583;">now</span><span style="color:#E1E4E8;"> connected </span><span style="color:#F97583;">to</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">database</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;app&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> user </span><span style="color:#9ECBFF;">&quot;app&quot;</span><span style="color:#E1E4E8;">.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">app@app</span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">create</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">schema</span><span style="color:#E1E4E8;"> app authorization app;</span></span>
<span class="line"><span style="color:#F97583;">CREATE</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">SCHEMA</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">app@app</span><span style="color:#F97583;">=&gt;create</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">table</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">public</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">t1</span><span style="color:#E1E4E8;">(id </span><span style="color:#F97583;">int</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#F97583;">CREATE</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">TABLE</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">app@app</span><span style="color:#F97583;">=&gt;create</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">table</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">app</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">t2</span><span style="color:#E1E4E8;">(id </span><span style="color:#F97583;">int</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#F97583;">CREATE</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">TABLE</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">postgres@postgres</span><span style="color:#D73A49;">=&gt;create</span><span style="color:#24292E;"> user app </span><span style="color:#D73A49;">password</span><span style="color:#032F62;">&#39;XXX123456&#39;</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#D73A49;">CREATE</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">ROLE</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">postgres@postgres</span><span style="color:#D73A49;">=&gt;create</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">database</span><span style="color:#24292E;"> app </span><span style="color:#D73A49;">owner</span><span style="color:#24292E;"> app;</span></span>
<span class="line"><span style="color:#D73A49;">CREATE</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">DATABASE</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">postgres@postgres</span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;">\\c app app</span></span>
<span class="line"><span style="color:#24292E;">You are </span><span style="color:#D73A49;">now</span><span style="color:#24292E;"> connected </span><span style="color:#D73A49;">to</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">database</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;app&quot;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> user </span><span style="color:#032F62;">&quot;app&quot;</span><span style="color:#24292E;">.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">app@app</span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">create</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">schema</span><span style="color:#24292E;"> app authorization app;</span></span>
<span class="line"><span style="color:#D73A49;">CREATE</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">SCHEMA</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">app@app</span><span style="color:#D73A49;">=&gt;create</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">table</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">public</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">t1</span><span style="color:#24292E;">(id </span><span style="color:#D73A49;">int</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#D73A49;">CREATE</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">TABLE</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">app@app</span><span style="color:#D73A49;">=&gt;create</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">table</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">app</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">t2</span><span style="color:#24292E;">(id </span><span style="color:#D73A49;">int</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#D73A49;">CREATE</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">TABLE</span></span></code></pre></div><h3 id="_3-新建表空间" tabindex="-1">3.新建表空间 <a class="header-anchor" href="#_3-新建表空间" aria-label="Permalink to &quot;3.新建表空间&quot;">​</a></h3><p>创建表空间需要超级用户权限</p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">postgres@postgres</span><span style="color:#F97583;">=&gt;create</span><span style="color:#E1E4E8;"> tablespace tbl_app </span><span style="color:#F97583;">owner</span><span style="color:#E1E4E8;"> app </span><span style="color:#F97583;">location</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;/home/ptgres/kongjian&#39;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#F97583;">CREATE</span><span style="color:#E1E4E8;"> TABLESPACE</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">postgres@postgres</span><span style="color:#D73A49;">=&gt;create</span><span style="color:#24292E;"> tablespace tbl_app </span><span style="color:#D73A49;">owner</span><span style="color:#24292E;"> app </span><span style="color:#D73A49;">location</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;/home/ptgres/kongjian&#39;</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#D73A49;">CREATE</span><span style="color:#24292E;"> TABLESPACE</span></span></code></pre></div><h3 id="_4-数据库app使用新表空间作为默认表空间" tabindex="-1">4.数据库app使用新表空间作为默认表空间 <a class="header-anchor" href="#_4-数据库app使用新表空间作为默认表空间" aria-label="Permalink to &quot;4.数据库app使用新表空间作为默认表空间&quot;">​</a></h3><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">postgres@postgres</span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;">\\c app app</span></span>
<span class="line"><span style="color:#E1E4E8;">You are </span><span style="color:#F97583;">now</span><span style="color:#E1E4E8;"> connected </span><span style="color:#F97583;">to</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">database</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;app&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> user </span><span style="color:#9ECBFF;">&quot;app&quot;</span><span style="color:#E1E4E8;">.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">app@app</span><span style="color:#F97583;">=&gt;alter</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">database</span><span style="color:#E1E4E8;"> app </span><span style="color:#F97583;">set</span><span style="color:#E1E4E8;"> default_tablespace </span><span style="color:#F97583;">to</span><span style="color:#E1E4E8;"> tbl_app;</span></span>
<span class="line"><span style="color:#F97583;">ALTER</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">DATABASE</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">postgres@postgres</span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;">\\c app app</span></span>
<span class="line"><span style="color:#24292E;">You are </span><span style="color:#D73A49;">now</span><span style="color:#24292E;"> connected </span><span style="color:#D73A49;">to</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">database</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;app&quot;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> user </span><span style="color:#032F62;">&quot;app&quot;</span><span style="color:#24292E;">.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">app@app</span><span style="color:#D73A49;">=&gt;alter</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">database</span><span style="color:#24292E;"> app </span><span style="color:#D73A49;">set</span><span style="color:#24292E;"> default_tablespace </span><span style="color:#D73A49;">to</span><span style="color:#24292E;"> tbl_app;</span></span>
<span class="line"><span style="color:#D73A49;">ALTER</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">DATABASE</span></span></code></pre></div><h3 id="_5-修改用户app默认表空间为tbl-app" tabindex="-1">5.修改用户app默认表空间为tbl_app <a class="header-anchor" href="#_5-修改用户app默认表空间为tbl-app" aria-label="Permalink to &quot;5.修改用户app默认表空间为tbl_app&quot;">​</a></h3><p>先恢复下上面的配置</p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">app@app</span><span style="color:#F97583;">=&gt;drop</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">table</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">public</span><span style="color:#E1E4E8;">.t3;</span></span>
<span class="line"><span style="color:#F97583;">DROP</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">TABLE</span></span>
<span class="line"><span style="color:#E1E4E8;">app@app</span><span style="color:#F97583;">=&gt;drop</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">table</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">app</span><span style="color:#E1E4E8;">.t4;</span></span>
<span class="line"><span style="color:#F97583;">DROP</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">TABLE</span></span>
<span class="line"><span style="color:#E1E4E8;">app@app</span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">alter</span><span style="color:#E1E4E8;"> user app </span><span style="color:#F97583;">set</span><span style="color:#E1E4E8;"> default_tablespace </span><span style="color:#F97583;">to</span><span style="color:#E1E4E8;"> tbl_app;</span></span>
<span class="line"><span style="color:#F97583;">ALTER</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">ROLE</span></span>
<span class="line"><span style="color:#E1E4E8;">app@app</span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;">\\q</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">-- 退出psql再重新连接</span></span>
<span class="line"><span style="color:#E1E4E8;">postgres@postgres</span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;">\\c app app</span></span>
<span class="line"><span style="color:#E1E4E8;">You are </span><span style="color:#F97583;">now</span><span style="color:#E1E4E8;"> connected </span><span style="color:#F97583;">to</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">database</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;app&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> user </span><span style="color:#9ECBFF;">&quot;app&quot;</span><span style="color:#E1E4E8;">.</span></span>
<span class="line"><span style="color:#E1E4E8;">app@app</span><span style="color:#F97583;">=&gt;create</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">table</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">public</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">t5</span><span style="color:#E1E4E8;">(id </span><span style="color:#F97583;">int</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#F97583;">CREATE</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">TABLE</span></span>
<span class="line"><span style="color:#E1E4E8;">app@app</span><span style="color:#F97583;">=&gt;create</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">table</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">app</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">t6</span><span style="color:#E1E4E8;">(id </span><span style="color:#F97583;">int</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#F97583;">CREATE</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">TABLE</span></span>
<span class="line"><span style="color:#E1E4E8;">app@app</span><span style="color:#F97583;">=&gt;select</span><span style="color:#E1E4E8;"> pg_relation_filepath(</span><span style="color:#9ECBFF;">&#39;t5&#39;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">            pg_relation_filepath             </span></span>
<span class="line"><span style="color:#6A737D;">---------------------------------------------</span></span>
<span class="line"><span style="color:#E1E4E8;"> pg_tblspc</span><span style="color:#F97583;">/</span><span style="color:#79B8FF;">17744</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">PG_12_201909212</span><span style="color:#F97583;">/</span><span style="color:#79B8FF;">17736</span><span style="color:#F97583;">/</span><span style="color:#79B8FF;">17751</span></span>
<span class="line"><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">row</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">app@app</span><span style="color:#F97583;">=&gt;select</span><span style="color:#E1E4E8;"> pg_relation_filepath(</span><span style="color:#9ECBFF;">&#39;app.t6&#39;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">            pg_relation_filepath             </span></span>
<span class="line"><span style="color:#6A737D;">---------------------------------------------</span></span>
<span class="line"><span style="color:#E1E4E8;"> pg_tblspc</span><span style="color:#F97583;">/</span><span style="color:#79B8FF;">17744</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">PG_12_201909212</span><span style="color:#F97583;">/</span><span style="color:#79B8FF;">17736</span><span style="color:#F97583;">/</span><span style="color:#79B8FF;">17754</span></span>
<span class="line"><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">row</span><span style="color:#E1E4E8;">)</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">app@app</span><span style="color:#D73A49;">=&gt;drop</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">table</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">public</span><span style="color:#24292E;">.t3;</span></span>
<span class="line"><span style="color:#D73A49;">DROP</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">TABLE</span></span>
<span class="line"><span style="color:#24292E;">app@app</span><span style="color:#D73A49;">=&gt;drop</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">table</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">app</span><span style="color:#24292E;">.t4;</span></span>
<span class="line"><span style="color:#D73A49;">DROP</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">TABLE</span></span>
<span class="line"><span style="color:#24292E;">app@app</span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">alter</span><span style="color:#24292E;"> user app </span><span style="color:#D73A49;">set</span><span style="color:#24292E;"> default_tablespace </span><span style="color:#D73A49;">to</span><span style="color:#24292E;"> tbl_app;</span></span>
<span class="line"><span style="color:#D73A49;">ALTER</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">ROLE</span></span>
<span class="line"><span style="color:#24292E;">app@app</span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;">\\q</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">-- 退出psql再重新连接</span></span>
<span class="line"><span style="color:#24292E;">postgres@postgres</span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;">\\c app app</span></span>
<span class="line"><span style="color:#24292E;">You are </span><span style="color:#D73A49;">now</span><span style="color:#24292E;"> connected </span><span style="color:#D73A49;">to</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">database</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;app&quot;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> user </span><span style="color:#032F62;">&quot;app&quot;</span><span style="color:#24292E;">.</span></span>
<span class="line"><span style="color:#24292E;">app@app</span><span style="color:#D73A49;">=&gt;create</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">table</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">public</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">t5</span><span style="color:#24292E;">(id </span><span style="color:#D73A49;">int</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#D73A49;">CREATE</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">TABLE</span></span>
<span class="line"><span style="color:#24292E;">app@app</span><span style="color:#D73A49;">=&gt;create</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">table</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">app</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">t6</span><span style="color:#24292E;">(id </span><span style="color:#D73A49;">int</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#D73A49;">CREATE</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">TABLE</span></span>
<span class="line"><span style="color:#24292E;">app@app</span><span style="color:#D73A49;">=&gt;select</span><span style="color:#24292E;"> pg_relation_filepath(</span><span style="color:#032F62;">&#39;t5&#39;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">            pg_relation_filepath             </span></span>
<span class="line"><span style="color:#6A737D;">---------------------------------------------</span></span>
<span class="line"><span style="color:#24292E;"> pg_tblspc</span><span style="color:#D73A49;">/</span><span style="color:#005CC5;">17744</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">PG_12_201909212</span><span style="color:#D73A49;">/</span><span style="color:#005CC5;">17736</span><span style="color:#D73A49;">/</span><span style="color:#005CC5;">17751</span></span>
<span class="line"><span style="color:#24292E;">(</span><span style="color:#005CC5;">1</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">row</span><span style="color:#24292E;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">app@app</span><span style="color:#D73A49;">=&gt;select</span><span style="color:#24292E;"> pg_relation_filepath(</span><span style="color:#032F62;">&#39;app.t6&#39;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">            pg_relation_filepath             </span></span>
<span class="line"><span style="color:#6A737D;">---------------------------------------------</span></span>
<span class="line"><span style="color:#24292E;"> pg_tblspc</span><span style="color:#D73A49;">/</span><span style="color:#005CC5;">17744</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">PG_12_201909212</span><span style="color:#D73A49;">/</span><span style="color:#005CC5;">17736</span><span style="color:#D73A49;">/</span><span style="color:#005CC5;">17754</span></span>
<span class="line"><span style="color:#24292E;">(</span><span style="color:#005CC5;">1</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">row</span><span style="color:#24292E;">)</span></span></code></pre></div><p>如果要迁移数据表的表空间，会锁表，要注意对业务的影响。</p><p>新建表修改database级别或者user级别(一般还是database级别)的默认表空间，只需配置一次，原有的数据表存储不改变，这种方式是推荐的</p>`,23),e=[o];function t(c,r,E,y,i,F){return a(),n("div",null,e)}const D=s(l,[["render",t]]);export{g as __pageData,D as default};
