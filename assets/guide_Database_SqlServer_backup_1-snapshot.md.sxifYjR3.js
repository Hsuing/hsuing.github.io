import{_ as s,o as a,c as n,R as l}from"./chunks/framework.zUbWieqp.js";const h=JSON.parse('{"title":"1.快照说明","description":"","frontmatter":{},"headers":[],"relativePath":"guide/Database/SqlServer/backup/1-snapshot.md","filePath":"guide/Database/SqlServer/backup/1-snapshot.md","lastUpdated":1729160572000}'),p={name:"guide/Database/SqlServer/backup/1-snapshot.md"},o=l(`<p><a href="https://learn.microsoft.com/zh-cn/sql/relational-databases/databases/database-snapshots-sql-server?view=sql-server-ver16" target="_blank" rel="noreferrer">https://learn.microsoft.com/zh-cn/sql/relational-databases/databases/database-snapshots-sql-server?view=sql-server-ver16</a></p><h1 id="_1-快照说明" tabindex="-1">1.快照说明 <a class="header-anchor" href="#_1-快照说明" aria-label="Permalink to &quot;1.快照说明&quot;">​</a></h1><p>数据库快照是已有数据库的只读静态视图</p><h2 id="_1-1限制" tabindex="-1">1.1限制 <a class="header-anchor" href="#_1-1限制" aria-label="Permalink to &quot;1.1限制&quot;">​</a></h2><p>SQL Server企业版才支持数据库快照</p><p>数据库快照必须与源数据库在相同的服务器实例上创建和保留</p><p>不能对源数据库进行删除、分离或还原</p><p>源数据库文件不可以被删除</p><p>由于源数据库的I/O增加，可能对性能造成负面影响</p><h2 id="_1-2创建" tabindex="-1">1.2创建 <a class="header-anchor" href="#_1-2创建" aria-label="Permalink to &quot;1.2创建&quot;">​</a></h2><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">CREATE</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">DATABASE</span><span style="color:#E1E4E8;"> [数据库快照名]</span></span>
<span class="line"><span style="color:#F97583;">ON</span></span>
<span class="line"><span style="color:#E1E4E8;">(</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">NAME</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> [源数据库文件逻辑名1],</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">FILENAME</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;数据库快照文件要放在的位置.ss&#39;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">),</span></span>
<span class="line"><span style="color:#E1E4E8;">(</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">NAME</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> [源数据库文件逻辑名2],</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">FILENAME</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;数据库快照文件要放在的位置.ss&#39;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">)...</span></span>
<span class="line"><span style="color:#F97583;">AS</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">SNAPSHOT</span><span style="color:#E1E4E8;"> OF [源数据库名];</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">CREATE</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">DATABASE</span><span style="color:#24292E;"> [数据库快照名]</span></span>
<span class="line"><span style="color:#D73A49;">ON</span></span>
<span class="line"><span style="color:#24292E;">(</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">NAME</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> [源数据库文件逻辑名1],</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">FILENAME</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;数据库快照文件要放在的位置.ss&#39;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">),</span></span>
<span class="line"><span style="color:#24292E;">(</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">NAME</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> [源数据库文件逻辑名2],</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">FILENAME</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;数据库快照文件要放在的位置.ss&#39;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">)...</span></span>
<span class="line"><span style="color:#D73A49;">AS</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">SNAPSHOT</span><span style="color:#24292E;"> OF [源数据库名];</span></span></code></pre></div><blockquote><p>注意：如果源数据库有多个文件，必须在脚本中一一指出</p></blockquote><h2 id="_1-3还原" tabindex="-1">1.3还原 <a class="header-anchor" href="#_1-3还原" aria-label="Permalink to &quot;1.3还原&quot;">​</a></h2><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">USE</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">master</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#F97583;">RESTORE</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">DATABASE</span><span style="color:#E1E4E8;"> [数据库名] </span><span style="color:#F97583;">FROM</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">DATABASE_SNAPSHOT</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;数据库快照名&#39;</span><span style="color:#E1E4E8;">;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">USE</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">master</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#D73A49;">RESTORE</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">DATABASE</span><span style="color:#24292E;"> [数据库名] </span><span style="color:#D73A49;">FROM</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">DATABASE_SNAPSHOT</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;数据库快照名&#39;</span><span style="color:#24292E;">;</span></span></code></pre></div><blockquote><p>注意：必须切换到master或其他数据库，才可以进行快照恢复</p></blockquote><h2 id="_1-3删除" tabindex="-1">1.3删除 <a class="header-anchor" href="#_1-3删除" aria-label="Permalink to &quot;1.3删除&quot;">​</a></h2><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">DROP</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">DATABASE</span><span style="color:#E1E4E8;"> [数据库快照名];</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">DROP</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">DATABASE</span><span style="color:#24292E;"> [数据库快照名];</span></span></code></pre></div>`,17),e=[o];function t(c,r,E,y,i,d){return a(),n("div",null,e)}const _=s(p,[["render",t]]);export{h as __pageData,_ as default};
