import{_ as s,o as a,c as e,R as n}from"./chunks/framework.zUbWieqp.js";const u=JSON.parse('{"title":"","description":"","frontmatter":{},"headers":[],"relativePath":"guide/Database/pgSql/usermanager/1_userman.md","filePath":"guide/Database/pgSql/usermanager/1_userman.md","lastUpdated":1712022000000}'),t={name:"guide/Database/pgSql/usermanager/1_userman.md"},l=n(`<ul><li>pg_12.2</li></ul><h2 id="_1-创建只读用户" tabindex="-1">1.创建只读用户 <a class="header-anchor" href="#_1-创建只读用户" aria-label="Permalink to &quot;1.创建只读用户&quot;">​</a></h2><p>创建用户及指定密码：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">CREATE USER readonly WITH ENCRYPTED PASSWORD &#39;ropass&#39;;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">CREATE USER readonly WITH ENCRYPTED PASSWORD &#39;ropass&#39;;</span></span></code></pre></div><p>设置用户默认事务只读：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">alter user readonly set default_transaction_read_only=on;</span></span>
<span class="line"><span style="color:#e1e4e8;">alter user user_name with password &#39;&#39;;</span></span>
<span class="line"><span style="color:#e1e4e8;">alter user user_name with CONNECTION LIMIT  20;#连接数限制</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">alter user readonly set default_transaction_read_only=on;</span></span>
<span class="line"><span style="color:#24292e;">alter user user_name with password &#39;&#39;;</span></span>
<span class="line"><span style="color:#24292e;">alter user user_name with CONNECTION LIMIT  20;#连接数限制</span></span></code></pre></div><p>赋予用户权限，查看public模式下所有表：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">GRANT USAGE ON SCHEMA public to readonly;</span></span>
<span class="line"><span style="color:#e1e4e8;">ALTER DEFAULT PRIVILEGES IN SCHEMA public GRANT SELECT ON TABLES TO readonly;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">GRANT USAGE ON SCHEMA public to readonly;</span></span>
<span class="line"><span style="color:#24292e;">ALTER DEFAULT PRIVILEGES IN SCHEMA public GRANT SELECT ON TABLES TO readonly;</span></span></code></pre></div><p>赋予用户连接数据库权限：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">GRANT CONNECT ON DATABASE database_name to username;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">GRANT CONNECT ON DATABASE database_name to username;</span></span></code></pre></div><p>切换到指定数据库：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">\\c foo</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">\\c foo</span></span></code></pre></div><p>赋予用户表、序列查看权限：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">GRANT USAGE ON SCHEMA public to username;</span></span>
<span class="line"><span style="color:#e1e4e8;">GRANT SELECT ON ALL SEQUENCES IN SCHEMA public TO username;</span></span>
<span class="line"><span style="color:#e1e4e8;">GRANT SELECT ON ALL TABLES IN SCHEMA public TO username;</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">#弊端，每次有新的表添加，的重新赋值</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">GRANT USAGE ON SCHEMA public to username;</span></span>
<span class="line"><span style="color:#24292e;">GRANT SELECT ON ALL SEQUENCES IN SCHEMA public TO username;</span></span>
<span class="line"><span style="color:#24292e;">GRANT SELECT ON ALL TABLES IN SCHEMA public TO username;</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">#弊端，每次有新的表添加，的重新赋值</span></span></code></pre></div><h2 id="_2-查询" tabindex="-1">2.查询 <a class="header-anchor" href="#_2-查询" aria-label="Permalink to &quot;2.查询&quot;">​</a></h2><h3 id="_1、查看某用户的表权限" tabindex="-1">1、查看某用户的表权限 <a class="header-anchor" href="#_1、查看某用户的表权限" aria-label="Permalink to &quot;1、查看某用户的表权限&quot;">​</a></h3><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">postgres=# \\c usercenter</span></span>
<span class="line"><span style="color:#e1e4e8;">usercenter=# select * from information_schema.table_privileges where grantee=&#39;user_name&#39;;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">postgres=# \\c usercenter</span></span>
<span class="line"><span style="color:#24292e;">usercenter=# select * from information_schema.table_privileges where grantee=&#39;user_name&#39;;</span></span></code></pre></div><h3 id="_2、查看usage权限表" tabindex="-1">2、查看usage权限表 <a class="header-anchor" href="#_2、查看usage权限表" aria-label="Permalink to &quot;2、查看usage权限表&quot;">​</a></h3><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">select * from information_schema.usage_privileges where grantee=&#39;user_name&#39;;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">select * from information_schema.usage_privileges where grantee=&#39;user_name&#39;;</span></span></code></pre></div><h3 id="_3、查看存储过程函数相关权限表" tabindex="-1">3、查看存储过程函数相关权限表 <a class="header-anchor" href="#_3、查看存储过程函数相关权限表" aria-label="Permalink to &quot;3、查看存储过程函数相关权限表&quot;">​</a></h3><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">select * from information_schema.routine_privileges where grantee=&#39;user_name&#39;;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">select * from information_schema.routine_privileges where grantee=&#39;user_name&#39;;</span></span></code></pre></div><h3 id="_4、查看当前用户能够访问的数据类型" tabindex="-1">4、查看当前用户能够访问的数据类型 <a class="header-anchor" href="#_4、查看当前用户能够访问的数据类型" aria-label="Permalink to &quot;4、查看当前用户能够访问的数据类型&quot;">​</a></h3><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">select * from information_schema.data_type_privileges ;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">select * from information_schema.data_type_privileges ;</span></span></code></pre></div><h3 id="_5、查看系统有多少用户" tabindex="-1">5、查看系统有多少用户 <a class="header-anchor" href="#_5、查看系统有多少用户" aria-label="Permalink to &quot;5、查看系统有多少用户&quot;">​</a></h3><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">select * from pg_user;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">select * from pg_user;</span></span></code></pre></div><p><img src="https://nnaigos.oss-cn-hangzhou.aliyuncs.com/imgs/202404011536928.png" alt="image-20240401153555377"></p><h2 id="_2-角色" tabindex="-1">2.角色 <a class="header-anchor" href="#_2-角色" aria-label="Permalink to &quot;2.角色&quot;">​</a></h2><h3 id="_2-1查看角色" tabindex="-1">2.1查看角色 <a class="header-anchor" href="#_2-1查看角色" aria-label="Permalink to &quot;2.1查看角色&quot;">​</a></h3><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">select * from pg_roles;</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">pg_database_owner	f	t	f	f	f	f	-1	********</span></span>
<span class="line"><span style="color:#e1e4e8;">pg_read_all_data	f	t	f	f	f	f	-1	********</span></span>
<span class="line"><span style="color:#e1e4e8;">pg_write_all_data	f	t	f	f	f	f	-1	********</span></span>
<span class="line"><span style="color:#e1e4e8;">pg_monitor	f	t	f	f	f	f	-1	********</span></span>
<span class="line"><span style="color:#e1e4e8;">pg_read_all_settings	f	t	f	f	f	f	-1	********</span></span>
<span class="line"><span style="color:#e1e4e8;">pg_read_all_stats	f	t	f	f	f	f	-1	********</span></span>
<span class="line"><span style="color:#e1e4e8;">pg_stat_scan_tables	f	t	f	f	f	f	-1	********</span></span>
<span class="line"><span style="color:#e1e4e8;">pg_read_server_files	f	t	f	f	f	f	-1	********</span></span>
<span class="line"><span style="color:#e1e4e8;">pg_write_server_files	f	t	f	f	f	f	-1	********</span></span>
<span class="line"><span style="color:#e1e4e8;">pg_execute_server_program	f	t	f	f	f	f	-1	********</span></span>
<span class="line"><span style="color:#e1e4e8;">pg_signal_backend	f	t	f	f	f	f	-1	********</span></span>
<span class="line"><span style="color:#e1e4e8;">pg_checkpoint	f	t	f	f	f	f	-1	********</span></span>
<span class="line"><span style="color:#e1e4e8;">pg_use_reserved_connections	f	t	f	f	f	f	-1	********</span></span>
<span class="line"><span style="color:#e1e4e8;">pg_create_subscription	f	t	f	f	f	f	-1	********</span></span>
<span class="line"><span style="color:#e1e4e8;">postgres	t	t	t	t	t	t	-1	********</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">select * from pg_roles;</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">pg_database_owner	f	t	f	f	f	f	-1	********</span></span>
<span class="line"><span style="color:#24292e;">pg_read_all_data	f	t	f	f	f	f	-1	********</span></span>
<span class="line"><span style="color:#24292e;">pg_write_all_data	f	t	f	f	f	f	-1	********</span></span>
<span class="line"><span style="color:#24292e;">pg_monitor	f	t	f	f	f	f	-1	********</span></span>
<span class="line"><span style="color:#24292e;">pg_read_all_settings	f	t	f	f	f	f	-1	********</span></span>
<span class="line"><span style="color:#24292e;">pg_read_all_stats	f	t	f	f	f	f	-1	********</span></span>
<span class="line"><span style="color:#24292e;">pg_stat_scan_tables	f	t	f	f	f	f	-1	********</span></span>
<span class="line"><span style="color:#24292e;">pg_read_server_files	f	t	f	f	f	f	-1	********</span></span>
<span class="line"><span style="color:#24292e;">pg_write_server_files	f	t	f	f	f	f	-1	********</span></span>
<span class="line"><span style="color:#24292e;">pg_execute_server_program	f	t	f	f	f	f	-1	********</span></span>
<span class="line"><span style="color:#24292e;">pg_signal_backend	f	t	f	f	f	f	-1	********</span></span>
<span class="line"><span style="color:#24292e;">pg_checkpoint	f	t	f	f	f	f	-1	********</span></span>
<span class="line"><span style="color:#24292e;">pg_use_reserved_connections	f	t	f	f	f	f	-1	********</span></span>
<span class="line"><span style="color:#24292e;">pg_create_subscription	f	t	f	f	f	f	-1	********</span></span>
<span class="line"><span style="color:#24292e;">postgres	t	t	t	t	t	t	-1	********</span></span></code></pre></div><ul><li>查看角色的命令</li></ul><p>\\du role_name</p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">postgres</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"># \\du pg_database_owner </span></span>
<span class="line"><span style="color:#E1E4E8;">          List of roles</span></span>
<span class="line"><span style="color:#E1E4E8;">     </span><span style="color:#F97583;">Role</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">name</span><span style="color:#E1E4E8;">     |  Attributes  </span></span>
<span class="line"><span style="color:#6A737D;">-------------------+--------------</span></span>
<span class="line"><span style="color:#E1E4E8;"> pg_database_owner | Cannot </span><span style="color:#F97583;">login</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">postgres</span><span style="color:#D73A49;">=</span><span style="color:#24292E;"># \\du pg_database_owner </span></span>
<span class="line"><span style="color:#24292E;">          List of roles</span></span>
<span class="line"><span style="color:#24292E;">     </span><span style="color:#D73A49;">Role</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">name</span><span style="color:#24292E;">     |  Attributes  </span></span>
<span class="line"><span style="color:#6A737D;">-------------------+--------------</span></span>
<span class="line"><span style="color:#24292E;"> pg_database_owner | Cannot </span><span style="color:#D73A49;">login</span></span></code></pre></div>`,32),p=[l];function o(c,r,i,d,f,g){return a(),e("div",null,p)}const h=s(t,[["render",o]]);export{u as __pageData,h as default};
