import{_ as s,o as a,c as n,R as l}from"./chunks/framework.zUbWieqp.js";const C=JSON.parse('{"title":"1. ckPart备份","description":"","frontmatter":{},"headers":[],"relativePath":"guide/Linux/Logs/Clickhouse/3-backup.md","filePath":"guide/Linux/Logs/Clickhouse/3-backup.md","lastUpdated":1730975389000}'),p={name:"guide/Linux/Logs/Clickhouse/3-backup.md"},o=l(`<h1 id="_1-ckpart备份" tabindex="-1">1. ckPart备份 <a class="header-anchor" href="#_1-ckpart备份" aria-label="Permalink to &quot;1. ckPart备份&quot;">​</a></h1><h2 id="_1-1-介绍" tabindex="-1">1.1 介绍 <a class="header-anchor" href="#_1-1-介绍" aria-label="Permalink to &quot;1.1 介绍&quot;">​</a></h2><p><a href="https://clickhouse.com/docs/zh/operations/backup" target="_blank" rel="noreferrer">官当</a></p><p>来自官方介绍，尽管 <a href="https://clickhouse.com/docs/zh/engines/table-engines/mergetree-family/replication" target="_blank" rel="noreferrer">副本</a> 可以提供针对硬件的错误防护, 但是它不能预防人为操作失误: 数据的意外删除, 错误表的删除或者错误集群上表的删除, 以及导致错误数据处理或者数据损坏的软件bug. 在很多案例中，这类意外可能会影响所有的副本. ClickHouse 有内置的保护措施可以预防一些错误 — 例如, 默认情况下 <a href="https://clickhouse.com/docs/zh/operations/server-configuration-parameters/settings#max-table-size-to-drop" target="_blank" rel="noreferrer">不能人工删除使用带有MergeTree引擎且包含超过50Gb数据的表</a>. 但是，这些保护措施不能覆盖所有可能情况，并且这些措施可以被绕过。</p><h2 id="_1-2-原理" tabindex="-1">1.2 原理 <a class="header-anchor" href="#_1-2-原理" aria-label="Permalink to &quot;1.2 原理&quot;">​</a></h2><p>手工备份，是使用CK的<code>ALTER TABLE ... FREEZE PARTITION ...</code>命令来实现，是利用硬链接到一个目录(<code>/var/lib/clickhouse/shadow</code>)，恢复时从 <code>/var/lib/clickhouse/bakcup</code> 寻找指定的名称进行恢复</p><p>需要注意的是 <code>手工备份和恢复</code> 都不会涉及到表结构，只单纯的备份和恢复数据，因此相关表结构需要 另外存档和自行创建。</p><h2 id="_1-3-备份-表级别" tabindex="-1">1.3 备份-表级别 <a class="header-anchor" href="#_1-3-备份-表级别" aria-label="Permalink to &quot;1.3 备份-表级别&quot;">​</a></h2><ul><li>创建目录</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">#根据自己的路径修改</span></span>
<span class="line"><span style="color:#B392F0;">mkdir</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/var/lib/clickhouse/{shadow,bakcup}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#修改权限</span></span>
<span class="line"><span style="color:#B392F0;">chown</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-R</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">clickhouse.</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">bakcup</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">shadow</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#查看</span></span>
<span class="line"><span style="color:#6A737D;"># ls -ld bakcup shadow</span></span>
<span class="line"><span style="color:#B392F0;">drwxr-xr-x</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">clickhouse</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">clickhouse</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">6</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">11</span><span style="color:#9ECBFF;">?</span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">6</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">15</span><span style="color:#9ECBFF;">:45</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">bakcup</span></span>
<span class="line"><span style="color:#B392F0;">drwxr-xr-x</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">clickhouse</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">clickhouse</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">6</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">11</span><span style="color:#9ECBFF;">?</span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">6</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">15</span><span style="color:#9ECBFF;">:45</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">shadow</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">#根据自己的路径修改</span></span>
<span class="line"><span style="color:#6F42C1;">mkdir</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/var/lib/clickhouse/{shadow,bakcup}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#修改权限</span></span>
<span class="line"><span style="color:#6F42C1;">chown</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-R</span><span style="color:#24292E;"> </span><span style="color:#032F62;">clickhouse.</span><span style="color:#24292E;"> </span><span style="color:#032F62;">bakcup</span><span style="color:#24292E;"> </span><span style="color:#032F62;">shadow</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#查看</span></span>
<span class="line"><span style="color:#6A737D;"># ls -ld bakcup shadow</span></span>
<span class="line"><span style="color:#6F42C1;">drwxr-xr-x</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2</span><span style="color:#24292E;"> </span><span style="color:#032F62;">clickhouse</span><span style="color:#24292E;"> </span><span style="color:#032F62;">clickhouse</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">6</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">11</span><span style="color:#032F62;">?</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">6</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">15</span><span style="color:#032F62;">:45</span><span style="color:#24292E;"> </span><span style="color:#032F62;">bakcup</span></span>
<span class="line"><span style="color:#6F42C1;">drwxr-xr-x</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2</span><span style="color:#24292E;"> </span><span style="color:#032F62;">clickhouse</span><span style="color:#24292E;"> </span><span style="color:#032F62;">clickhouse</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">6</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">11</span><span style="color:#032F62;">?</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">6</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">15</span><span style="color:#032F62;">:45</span><span style="color:#24292E;"> </span><span style="color:#032F62;">shadow</span></span></code></pre></div><ul><li>备份</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">#登录数据库</span></span>
<span class="line"><span style="color:#E1E4E8;">[root@kubeadm-master01 </span><span style="color:#79B8FF;">20241105</span><span style="color:#E1E4E8;">_11_13_1]# clickhouse-client -udefault --password 123456</span></span>
<span class="line"><span style="color:#B392F0;">ClickHouse</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">client</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">version</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23.12</span><span style="color:#9ECBFF;">.6.19</span><span style="color:#E1E4E8;"> (official </span><span style="color:#9ECBFF;">build</span><span style="color:#E1E4E8;">).</span></span>
<span class="line"><span style="color:#B392F0;">Connecting</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">to</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">localhost:9000</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">as</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">user</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">default.</span></span>
<span class="line"><span style="color:#B392F0;">Connected</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">to</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">ClickHouse</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">server</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">version</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23.12</span><span style="color:#9ECBFF;">.6.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#查看数据库</span></span>
<span class="line"><span style="color:#B392F0;">ch_accesslog</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">:</span><span style="color:#E1E4E8;">) show databases;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">SHOW</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">DATABASES</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">Query</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">id:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">57347</span><span style="color:#9ECBFF;">c65-6138-4c53-b7c6-1761ddcdd2b7</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">┌─name───────────────┐</span></span>
<span class="line"><span style="color:#B392F0;">│</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">INFORMATION_SCHEMA</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">│</span></span>
<span class="line"><span style="color:#B392F0;">│</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">default</span><span style="color:#E1E4E8;">            </span><span style="color:#9ECBFF;">│</span></span>
<span class="line"><span style="color:#B392F0;">│</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">information_schema</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">│</span></span>
<span class="line"><span style="color:#B392F0;">│</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">nginxlogs</span><span style="color:#E1E4E8;">          </span><span style="color:#9ECBFF;">│</span></span>
<span class="line"><span style="color:#B392F0;">│</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">system</span><span style="color:#E1E4E8;">             </span><span style="color:#9ECBFF;">│</span></span>
<span class="line"><span style="color:#B392F0;">└────────────────────┘</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#对nginxlogs进行备份，进入到nginxlogs数据库中</span></span>
<span class="line"><span style="color:#B392F0;">ch_accesslog</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">:</span><span style="color:#E1E4E8;">) use nginxlogs</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">USE</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">nginxlogs</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#查看有哪些表</span></span>
<span class="line"><span style="color:#B392F0;">ch_accesslog</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">:</span><span style="color:#E1E4E8;">) show tables;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">SHOW</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">TABLES</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">Query</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">id:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">37989</span><span style="color:#9ECBFF;">ea7-7477-49f5-9c8f-9da7bca2dbc7</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">┌─name─────────┐</span></span>
<span class="line"><span style="color:#B392F0;">│</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">nginx_access</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">│</span></span>
<span class="line"><span style="color:#B392F0;">└──────────────┘</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#执行备份命令，ALTER TABLE ... FREEZE PARTITION ...</span></span>
<span class="line"><span style="color:#B392F0;">ch_accesslog</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">:</span><span style="color:#E1E4E8;">) alter table nginx_access freeze;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">ALTER</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">TABLE</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">nginx_access</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">FREEZE</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">Query</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">id:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">500155</span><span style="color:#9ECBFF;">af-7662-4e14-8316-caf0b0f71479</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">Ok.</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">#登录数据库</span></span>
<span class="line"><span style="color:#24292E;">[root@kubeadm-master01 </span><span style="color:#005CC5;">20241105</span><span style="color:#24292E;">_11_13_1]# clickhouse-client -udefault --password 123456</span></span>
<span class="line"><span style="color:#6F42C1;">ClickHouse</span><span style="color:#24292E;"> </span><span style="color:#032F62;">client</span><span style="color:#24292E;"> </span><span style="color:#032F62;">version</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23.12</span><span style="color:#032F62;">.6.19</span><span style="color:#24292E;"> (official </span><span style="color:#032F62;">build</span><span style="color:#24292E;">).</span></span>
<span class="line"><span style="color:#6F42C1;">Connecting</span><span style="color:#24292E;"> </span><span style="color:#032F62;">to</span><span style="color:#24292E;"> </span><span style="color:#032F62;">localhost:9000</span><span style="color:#24292E;"> </span><span style="color:#032F62;">as</span><span style="color:#24292E;"> </span><span style="color:#032F62;">user</span><span style="color:#24292E;"> </span><span style="color:#032F62;">default.</span></span>
<span class="line"><span style="color:#6F42C1;">Connected</span><span style="color:#24292E;"> </span><span style="color:#032F62;">to</span><span style="color:#24292E;"> </span><span style="color:#032F62;">ClickHouse</span><span style="color:#24292E;"> </span><span style="color:#032F62;">server</span><span style="color:#24292E;"> </span><span style="color:#032F62;">version</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23.12</span><span style="color:#032F62;">.6.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#查看数据库</span></span>
<span class="line"><span style="color:#6F42C1;">ch_accesslog</span><span style="color:#24292E;"> </span><span style="color:#032F62;">:</span><span style="color:#24292E;">) show databases;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">SHOW</span><span style="color:#24292E;"> </span><span style="color:#032F62;">DATABASES</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">Query</span><span style="color:#24292E;"> </span><span style="color:#032F62;">id:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">57347</span><span style="color:#032F62;">c65-6138-4c53-b7c6-1761ddcdd2b7</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">┌─name───────────────┐</span></span>
<span class="line"><span style="color:#6F42C1;">│</span><span style="color:#24292E;"> </span><span style="color:#032F62;">INFORMATION_SCHEMA</span><span style="color:#24292E;"> </span><span style="color:#032F62;">│</span></span>
<span class="line"><span style="color:#6F42C1;">│</span><span style="color:#24292E;"> </span><span style="color:#032F62;">default</span><span style="color:#24292E;">            </span><span style="color:#032F62;">│</span></span>
<span class="line"><span style="color:#6F42C1;">│</span><span style="color:#24292E;"> </span><span style="color:#032F62;">information_schema</span><span style="color:#24292E;"> </span><span style="color:#032F62;">│</span></span>
<span class="line"><span style="color:#6F42C1;">│</span><span style="color:#24292E;"> </span><span style="color:#032F62;">nginxlogs</span><span style="color:#24292E;">          </span><span style="color:#032F62;">│</span></span>
<span class="line"><span style="color:#6F42C1;">│</span><span style="color:#24292E;"> </span><span style="color:#032F62;">system</span><span style="color:#24292E;">             </span><span style="color:#032F62;">│</span></span>
<span class="line"><span style="color:#6F42C1;">└────────────────────┘</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#对nginxlogs进行备份，进入到nginxlogs数据库中</span></span>
<span class="line"><span style="color:#6F42C1;">ch_accesslog</span><span style="color:#24292E;"> </span><span style="color:#032F62;">:</span><span style="color:#24292E;">) use nginxlogs</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">USE</span><span style="color:#24292E;"> </span><span style="color:#032F62;">nginxlogs</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#查看有哪些表</span></span>
<span class="line"><span style="color:#6F42C1;">ch_accesslog</span><span style="color:#24292E;"> </span><span style="color:#032F62;">:</span><span style="color:#24292E;">) show tables;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">SHOW</span><span style="color:#24292E;"> </span><span style="color:#032F62;">TABLES</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">Query</span><span style="color:#24292E;"> </span><span style="color:#032F62;">id:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">37989</span><span style="color:#032F62;">ea7-7477-49f5-9c8f-9da7bca2dbc7</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">┌─name─────────┐</span></span>
<span class="line"><span style="color:#6F42C1;">│</span><span style="color:#24292E;"> </span><span style="color:#032F62;">nginx_access</span><span style="color:#24292E;"> </span><span style="color:#032F62;">│</span></span>
<span class="line"><span style="color:#6F42C1;">└──────────────┘</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#执行备份命令，ALTER TABLE ... FREEZE PARTITION ...</span></span>
<span class="line"><span style="color:#6F42C1;">ch_accesslog</span><span style="color:#24292E;"> </span><span style="color:#032F62;">:</span><span style="color:#24292E;">) alter table nginx_access freeze;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">ALTER</span><span style="color:#24292E;"> </span><span style="color:#032F62;">TABLE</span><span style="color:#24292E;"> </span><span style="color:#032F62;">nginx_access</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">FREEZE</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">Query</span><span style="color:#24292E;"> </span><span style="color:#032F62;">id:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">500155</span><span style="color:#032F62;">af-7662-4e14-8316-caf0b0f71479</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">Ok.</span></span></code></pre></div><blockquote><p>不交互执行sql命令</p><p>echo &#39;alter table tableName freeze&#39; | clickhouse-client -u xxxx --password xxxx -d dataName</p></blockquote><h1 id="_2-ckbackup备份" tabindex="-1">2. ckBACKUP备份 <a class="header-anchor" href="#_2-ckbackup备份" aria-label="Permalink to &quot;2. ckBACKUP备份&quot;">​</a></h1><p><a href="https://clickhouse.ac.cn/docs/en/operations/backup" target="_blank" rel="noreferrer">官当</a></p><h2 id="_2-1-备份到本地" tabindex="-1">2.1 备份到本地 <a class="header-anchor" href="#_2-1-备份到本地" aria-label="Permalink to &quot;2.1 备份到本地&quot;">​</a></h2><h1 id="_3-clickhouse-backup" tabindex="-1">3.clickhouse-backup <a class="header-anchor" href="#_3-clickhouse-backup" aria-label="Permalink to &quot;3.clickhouse-backup&quot;">​</a></h1><p><a href="https://github.com/Altinity/clickhouse-backup/releases" target="_blank" rel="noreferrer">官方推荐工具</a></p><h2 id="_3-1介绍" tabindex="-1">3.1介绍 <a class="header-anchor" href="#_3-1介绍" aria-label="Permalink to &quot;3.1介绍&quot;">​</a></h2><p><strong>clickhouse-backup</strong>是一个由Altinity开发的开源项目，专为ClickHouse数据库提供高效、可靠的全量和增量备份解决方案。它利用了ClickHouse原生的API接口，支持多种云和非云存储类型，如AWS、GCS、Azure、腾讯COS、FTP、SFTP等，对于不同数据量的ClickHouse数据库，clickhouse-backup都能提供有效的备份和恢复解决方案。无论是小到几GB的数据库，还是大到几十TB甚至上百TB的数据库，clickhouse-backup都能通过其高效的备份和恢复机制，确保数据的安全性和可用性。</p><h3 id="_1-为什么用它" tabindex="-1">1.为什么用它？ <a class="header-anchor" href="#_1-为什么用它" aria-label="Permalink to &quot;1.为什么用它？&quot;">​</a></h3><ol><li>高效性 <ul><li><strong>全量备份</strong>：clickhouse-backup可以生成ClickHouse数据的完整副本，以文件系统或云存储的形式保存。</li><li><strong>增量备份</strong>：基于上一次的全量或增量备份，只备份自上次备份以来发生改变的数据，极大地减少了存储空间需求。</li></ul></li><li>灵活性 <ul><li>支持从本地或远程存储恢复到ClickHouse，可选择特定时间点的数据进行恢复。</li><li>通过CRON表达式设置自动备份计划，无需手动操作。</li><li>支持多节点同步备份，确保集群数据的一致性。</li></ul></li><li>安全性 <ul><li>支持SSL加密传输，保障备份过程中数据的安全。</li></ul></li><li>易用性 <ul><li>使用Go语言编写，易于部署和集成，并且有着丰富的命令行选项供用户灵活配置。</li><li>支持多种操作系统，如Linux、macOS、Windows。</li></ul></li><li>可扩展性 <ul><li>可以根据自身需求编写插件，实现自定义的存储后端或者备份策略。</li></ul></li></ol><h2 id="_3-2-部署" tabindex="-1">3.2 部署 <a class="header-anchor" href="#_3-2-部署" aria-label="Permalink to &quot;3.2 部署&quot;">​</a></h2><h3 id="_1-下载" tabindex="-1">1.下载 <a class="header-anchor" href="#_1-下载" aria-label="Permalink to &quot;1.下载&quot;">​</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">wget</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">https://github.com/Altinity/clickhouse-backup/releases/download/v2.6.3/clickhouse-backup-linux-amd64.tar.gz</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#直接解压即可</span></span>
<span class="line"><span style="color:#B392F0;">tar</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">zxvf</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">clickhouse-backup-linux-amd64.tar.gz</span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">--strip-components=3</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-C</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/usr/local/bin/</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#查看版本</span></span>
<span class="line"><span style="color:#E1E4E8;">[root@kubeadm-master01 </span><span style="color:#F97583;">~</span><span style="color:#E1E4E8;">]# clickhouse-backup --version</span></span>
<span class="line"><span style="color:#B392F0;">Version:</span><span style="color:#E1E4E8;">	 </span><span style="color:#79B8FF;">2.6</span><span style="color:#9ECBFF;">.3</span></span>
<span class="line"><span style="color:#B392F0;">Git</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Commit:</span><span style="color:#E1E4E8;">	 </span><span style="color:#9ECBFF;">e039c604807c52cbbce56582a0d22073338d1e3f</span></span>
<span class="line"><span style="color:#B392F0;">Build</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Date:</span><span style="color:#E1E4E8;">	 </span><span style="color:#79B8FF;">2024</span><span style="color:#9ECBFF;">-11-04</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">wget</span><span style="color:#24292E;"> </span><span style="color:#032F62;">https://github.com/Altinity/clickhouse-backup/releases/download/v2.6.3/clickhouse-backup-linux-amd64.tar.gz</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#直接解压即可</span></span>
<span class="line"><span style="color:#6F42C1;">tar</span><span style="color:#24292E;"> </span><span style="color:#032F62;">zxvf</span><span style="color:#24292E;"> </span><span style="color:#032F62;">clickhouse-backup-linux-amd64.tar.gz</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">--strip-components=3</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-C</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/usr/local/bin/</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#查看版本</span></span>
<span class="line"><span style="color:#24292E;">[root@kubeadm-master01 </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# clickhouse-backup --version</span></span>
<span class="line"><span style="color:#6F42C1;">Version:</span><span style="color:#24292E;">	 </span><span style="color:#005CC5;">2.6</span><span style="color:#032F62;">.3</span></span>
<span class="line"><span style="color:#6F42C1;">Git</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Commit:</span><span style="color:#24292E;">	 </span><span style="color:#032F62;">e039c604807c52cbbce56582a0d22073338d1e3f</span></span>
<span class="line"><span style="color:#6F42C1;">Build</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Date:</span><span style="color:#24292E;">	 </span><span style="color:#005CC5;">2024</span><span style="color:#032F62;">-11-04</span></span></code></pre></div><h3 id="_2-查看默认配置" tabindex="-1">2.查看默认配置 <a class="header-anchor" href="#_2-查看默认配置" aria-label="Permalink to &quot;2.查看默认配置&quot;">​</a></h3><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#9ECBFF;">clickhouse-backup default-config</span></span>
<span class="line"></span>
<span class="line"><span style="color:#85E89D;">general</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">remote_storage</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">none</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">max_file_size</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">0</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">backups_to_keep_local</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">0</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">backups_to_keep_remote</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">0</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">log_level</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">info</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">allow_empty_backups</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">false</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">download_concurrency</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">1</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">upload_concurrency</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">1</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">upload_max_bytes_per_second</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">0</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">download_max_bytes_per_second</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">0</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">object_disk_server_side_copy_concurrency</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">32</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">allow_object_disk_streaming</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">false</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">use_resumable_state</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">true</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">restore_schema_on_cluster</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">upload_by_part</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">true</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">download_by_part</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">true</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">restore_database_mapping</span><span style="color:#E1E4E8;">: {}</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">restore_table_mapping</span><span style="color:#E1E4E8;">: {}</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">retries_on_failure</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">3</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">retries_pause</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">5s</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">watch_interval</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">1h</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">full_interval</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">24h</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">watch_backup_name_template</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">shard{shard}-{type}-{time:20060102150405}</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">sharded_operation_mode</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">cpu_nice_priority</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">15</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">io_nice_priority</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">idle</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">rbac_backup_always</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">true</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">rbac_conflict_resolution</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">recreate</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">retriesduration</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">5s</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">watchduration</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">1h0m0s</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">fullduration</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">24h0m0s</span></span>
<span class="line"><span style="color:#85E89D;">clickhouse</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">username</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">default</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">password</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">host</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">localhost</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">port</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">9000</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">disk_mapping</span><span style="color:#E1E4E8;">: {}</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">skip_tables</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">        - </span><span style="color:#9ECBFF;">system.*</span></span>
<span class="line"><span style="color:#E1E4E8;">        - </span><span style="color:#9ECBFF;">INFORMATION_SCHEMA.*</span></span>
<span class="line"><span style="color:#E1E4E8;">        - </span><span style="color:#9ECBFF;">information_schema.*</span></span>
<span class="line"><span style="color:#E1E4E8;">        - </span><span style="color:#9ECBFF;">_temporary_and_external_tables.*</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">skip_table_engines</span><span style="color:#E1E4E8;">: []</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">timeout</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">30m</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">freeze_by_part</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">false</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">freeze_by_part_where</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">use_embedded_backup_restore</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">false</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">embedded_backup_disk</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">backup_mutations</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">true</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">restore_as_attach</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">false</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">check_parts_columns</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">true</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">secure</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">false</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">skip_verify</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">false</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">sync_replicated_tables</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">false</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">log_sql_queries</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">true</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">config_dir</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">/etc/clickhouse-server/</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">restart_command</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">exec:systemctl restart clickhouse-server</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">ignore_not_exists_error_during_freeze</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">true</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">check_replicas_before_attach</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">true</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">default_replica_path</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">/clickhouse/tables/{cluster}/{shard}/{database}/{table}</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">default_replica_name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&#39;{replica}&#39;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">tls_key</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">tls_cert</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">tls_ca</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">max_connections</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">1</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">debug</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">false</span></span>
<span class="line"><span style="color:#85E89D;">s3</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">access_key</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">secret_key</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">bucket</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">endpoint</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">region</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">us-east-1</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">acl</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">private</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">assume_role_arn</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">force_path_style</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">false</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">path</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">object_disk_path</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">disable_ssl</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">false</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">compression_level</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">1</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">compression_format</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">tar</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">sse</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">sse_kms_key_id</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">sse_customer_algorithm</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">sse_customer_key</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">sse_customer_key_md5</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">sse_kms_encryption_context</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">disable_cert_verification</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">false</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">use_custom_storage_class</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">false</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">storage_class</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">STANDARD</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">custom_storage_class_map</span><span style="color:#E1E4E8;">: {}</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">concurrency</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">2</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">part_size</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">0</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">max_parts_count</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">4000</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">allow_multipart_download</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">false</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">object_labels</span><span style="color:#E1E4E8;">: {}</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">request_payer</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">check_sum_algorithm</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">debug</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">false</span></span>
<span class="line"><span style="color:#85E89D;">gcs</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">credentials_file</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">credentials_json</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">credentials_json_encoded</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">embedded_access_key</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">embedded_secret_key</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">skip_credentials</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">false</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">bucket</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">path</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">object_disk_path</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">compression_level</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">1</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">compression_format</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">tar</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">debug</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">false</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">force_http</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">false</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">endpoint</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">storage_class</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">STANDARD</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">object_labels</span><span style="color:#E1E4E8;">: {}</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">custom_storage_class_map</span><span style="color:#E1E4E8;">: {}</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">client_pool_size</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">32</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">chunk_size</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">0</span></span>
<span class="line"><span style="color:#85E89D;">cos</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">url</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">timeout</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">2m</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">secret_id</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">secret_key</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">path</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">object_disk_path</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">compression_format</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">tar</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">compression_level</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">1</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">debug</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">false</span></span>
<span class="line"><span style="color:#85E89D;">api</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">listen</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">localhost:7171</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">enable_metrics</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">true</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">enable_pprof</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">false</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">username</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">password</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">secure</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">false</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">certificate_file</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">private_key_file</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">ca_cert_file</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">ca_key_file</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">create_integration_tables</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">false</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">integration_tables_host</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">allow_parallel</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">false</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">complete_resumable_after_restart</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">true</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">watch_is_main_process</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">false</span></span>
<span class="line"><span style="color:#85E89D;">ftp</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">address</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">timeout</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">2m</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">username</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">password</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">tls</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">false</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">skip_tls_verify</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">false</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">path</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">object_disk_path</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">compression_format</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">tar</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">compression_level</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">1</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">concurrency</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">3</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">debug</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">false</span></span>
<span class="line"><span style="color:#85E89D;">sftp</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">address</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">port</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">22</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">username</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">password</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">key</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">path</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">object_disk_path</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">compression_format</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">tar</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">compression_level</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">1</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">concurrency</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">3</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">debug</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">false</span></span>
<span class="line"><span style="color:#85E89D;">azblob</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">endpoint_schema</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">https</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">endpoint_suffix</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">core.windows.net</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">account_name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">account_key</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">sas</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">use_managed_identity</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">false</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">container</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">path</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">object_disk_path</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">compression_level</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">1</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">compression_format</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">tar</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">sse_key</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">buffer_size</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">0</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">buffer_count</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">3</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">max_parts_count</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">256</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">timeout</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">4h</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">debug</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">false</span></span>
<span class="line"><span style="color:#85E89D;">custom</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">upload_command</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">download_command</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">list_command</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">delete_command</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">command_timeout</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">4h</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">commandtimeoutduration</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">4h0m0s</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#032F62;">clickhouse-backup default-config</span></span>
<span class="line"></span>
<span class="line"><span style="color:#22863A;">general</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">remote_storage</span><span style="color:#24292E;">: </span><span style="color:#032F62;">none</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">max_file_size</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">0</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">backups_to_keep_local</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">0</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">backups_to_keep_remote</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">0</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">log_level</span><span style="color:#24292E;">: </span><span style="color:#032F62;">info</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">allow_empty_backups</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">false</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">download_concurrency</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">1</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">upload_concurrency</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">1</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">upload_max_bytes_per_second</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">0</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">download_max_bytes_per_second</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">0</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">object_disk_server_side_copy_concurrency</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">32</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">allow_object_disk_streaming</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">false</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">use_resumable_state</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">true</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">restore_schema_on_cluster</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;&quot;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">upload_by_part</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">true</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">download_by_part</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">true</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">restore_database_mapping</span><span style="color:#24292E;">: {}</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">restore_table_mapping</span><span style="color:#24292E;">: {}</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">retries_on_failure</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">3</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">retries_pause</span><span style="color:#24292E;">: </span><span style="color:#032F62;">5s</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">watch_interval</span><span style="color:#24292E;">: </span><span style="color:#032F62;">1h</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">full_interval</span><span style="color:#24292E;">: </span><span style="color:#032F62;">24h</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">watch_backup_name_template</span><span style="color:#24292E;">: </span><span style="color:#032F62;">shard{shard}-{type}-{time:20060102150405}</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">sharded_operation_mode</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;&quot;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">cpu_nice_priority</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">15</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">io_nice_priority</span><span style="color:#24292E;">: </span><span style="color:#032F62;">idle</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">rbac_backup_always</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">true</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">rbac_conflict_resolution</span><span style="color:#24292E;">: </span><span style="color:#032F62;">recreate</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">retriesduration</span><span style="color:#24292E;">: </span><span style="color:#032F62;">5s</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">watchduration</span><span style="color:#24292E;">: </span><span style="color:#032F62;">1h0m0s</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">fullduration</span><span style="color:#24292E;">: </span><span style="color:#032F62;">24h0m0s</span></span>
<span class="line"><span style="color:#22863A;">clickhouse</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">username</span><span style="color:#24292E;">: </span><span style="color:#032F62;">default</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">password</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;&quot;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">host</span><span style="color:#24292E;">: </span><span style="color:#032F62;">localhost</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">port</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">9000</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">disk_mapping</span><span style="color:#24292E;">: {}</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">skip_tables</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">        - </span><span style="color:#032F62;">system.*</span></span>
<span class="line"><span style="color:#24292E;">        - </span><span style="color:#032F62;">INFORMATION_SCHEMA.*</span></span>
<span class="line"><span style="color:#24292E;">        - </span><span style="color:#032F62;">information_schema.*</span></span>
<span class="line"><span style="color:#24292E;">        - </span><span style="color:#032F62;">_temporary_and_external_tables.*</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">skip_table_engines</span><span style="color:#24292E;">: []</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">timeout</span><span style="color:#24292E;">: </span><span style="color:#032F62;">30m</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">freeze_by_part</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">false</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">freeze_by_part_where</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;&quot;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">use_embedded_backup_restore</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">false</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">embedded_backup_disk</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;&quot;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">backup_mutations</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">true</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">restore_as_attach</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">false</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">check_parts_columns</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">true</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">secure</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">false</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">skip_verify</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">false</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">sync_replicated_tables</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">false</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">log_sql_queries</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">true</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">config_dir</span><span style="color:#24292E;">: </span><span style="color:#032F62;">/etc/clickhouse-server/</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">restart_command</span><span style="color:#24292E;">: </span><span style="color:#032F62;">exec:systemctl restart clickhouse-server</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">ignore_not_exists_error_during_freeze</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">true</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">check_replicas_before_attach</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">true</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">default_replica_path</span><span style="color:#24292E;">: </span><span style="color:#032F62;">/clickhouse/tables/{cluster}/{shard}/{database}/{table}</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">default_replica_name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&#39;{replica}&#39;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">tls_key</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;&quot;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">tls_cert</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;&quot;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">tls_ca</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;&quot;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">max_connections</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">1</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">debug</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">false</span></span>
<span class="line"><span style="color:#22863A;">s3</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">access_key</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;&quot;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">secret_key</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;&quot;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">bucket</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;&quot;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">endpoint</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;&quot;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">region</span><span style="color:#24292E;">: </span><span style="color:#032F62;">us-east-1</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">acl</span><span style="color:#24292E;">: </span><span style="color:#032F62;">private</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">assume_role_arn</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;&quot;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">force_path_style</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">false</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">path</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;&quot;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">object_disk_path</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;&quot;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">disable_ssl</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">false</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">compression_level</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">1</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">compression_format</span><span style="color:#24292E;">: </span><span style="color:#032F62;">tar</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">sse</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;&quot;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">sse_kms_key_id</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;&quot;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">sse_customer_algorithm</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;&quot;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">sse_customer_key</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;&quot;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">sse_customer_key_md5</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;&quot;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">sse_kms_encryption_context</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;&quot;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">disable_cert_verification</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">false</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">use_custom_storage_class</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">false</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">storage_class</span><span style="color:#24292E;">: </span><span style="color:#032F62;">STANDARD</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">custom_storage_class_map</span><span style="color:#24292E;">: {}</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">concurrency</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">2</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">part_size</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">0</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">max_parts_count</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">4000</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">allow_multipart_download</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">false</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">object_labels</span><span style="color:#24292E;">: {}</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">request_payer</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;&quot;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">check_sum_algorithm</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;&quot;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">debug</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">false</span></span>
<span class="line"><span style="color:#22863A;">gcs</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">credentials_file</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;&quot;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">credentials_json</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;&quot;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">credentials_json_encoded</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;&quot;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">embedded_access_key</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;&quot;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">embedded_secret_key</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;&quot;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">skip_credentials</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">false</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">bucket</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;&quot;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">path</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;&quot;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">object_disk_path</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;&quot;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">compression_level</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">1</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">compression_format</span><span style="color:#24292E;">: </span><span style="color:#032F62;">tar</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">debug</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">false</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">force_http</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">false</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">endpoint</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;&quot;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">storage_class</span><span style="color:#24292E;">: </span><span style="color:#032F62;">STANDARD</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">object_labels</span><span style="color:#24292E;">: {}</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">custom_storage_class_map</span><span style="color:#24292E;">: {}</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">client_pool_size</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">32</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">chunk_size</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">0</span></span>
<span class="line"><span style="color:#22863A;">cos</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">url</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;&quot;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">timeout</span><span style="color:#24292E;">: </span><span style="color:#032F62;">2m</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">secret_id</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;&quot;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">secret_key</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;&quot;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">path</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;&quot;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">object_disk_path</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;&quot;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">compression_format</span><span style="color:#24292E;">: </span><span style="color:#032F62;">tar</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">compression_level</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">1</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">debug</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">false</span></span>
<span class="line"><span style="color:#22863A;">api</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">listen</span><span style="color:#24292E;">: </span><span style="color:#032F62;">localhost:7171</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">enable_metrics</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">true</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">enable_pprof</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">false</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">username</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;&quot;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">password</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;&quot;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">secure</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">false</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">certificate_file</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;&quot;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">private_key_file</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;&quot;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">ca_cert_file</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;&quot;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">ca_key_file</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;&quot;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">create_integration_tables</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">false</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">integration_tables_host</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;&quot;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">allow_parallel</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">false</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">complete_resumable_after_restart</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">true</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">watch_is_main_process</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">false</span></span>
<span class="line"><span style="color:#22863A;">ftp</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">address</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;&quot;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">timeout</span><span style="color:#24292E;">: </span><span style="color:#032F62;">2m</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">username</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;&quot;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">password</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;&quot;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">tls</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">false</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">skip_tls_verify</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">false</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">path</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;&quot;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">object_disk_path</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;&quot;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">compression_format</span><span style="color:#24292E;">: </span><span style="color:#032F62;">tar</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">compression_level</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">1</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">concurrency</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">3</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">debug</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">false</span></span>
<span class="line"><span style="color:#22863A;">sftp</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">address</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;&quot;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">port</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">22</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">username</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;&quot;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">password</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;&quot;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">key</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;&quot;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">path</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;&quot;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">object_disk_path</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;&quot;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">compression_format</span><span style="color:#24292E;">: </span><span style="color:#032F62;">tar</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">compression_level</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">1</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">concurrency</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">3</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">debug</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">false</span></span>
<span class="line"><span style="color:#22863A;">azblob</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">endpoint_schema</span><span style="color:#24292E;">: </span><span style="color:#032F62;">https</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">endpoint_suffix</span><span style="color:#24292E;">: </span><span style="color:#032F62;">core.windows.net</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">account_name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;&quot;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">account_key</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;&quot;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">sas</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;&quot;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">use_managed_identity</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">false</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">container</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;&quot;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">path</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;&quot;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">object_disk_path</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;&quot;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">compression_level</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">1</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">compression_format</span><span style="color:#24292E;">: </span><span style="color:#032F62;">tar</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">sse_key</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;&quot;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">buffer_size</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">0</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">buffer_count</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">3</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">max_parts_count</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">256</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">timeout</span><span style="color:#24292E;">: </span><span style="color:#032F62;">4h</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">debug</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">false</span></span>
<span class="line"><span style="color:#22863A;">custom</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">upload_command</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;&quot;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">download_command</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;&quot;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">list_command</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;&quot;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">delete_command</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;&quot;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">command_timeout</span><span style="color:#24292E;">: </span><span style="color:#032F62;">4h</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">commandtimeoutduration</span><span style="color:#24292E;">: </span><span style="color:#032F62;">4h0m0s</span></span></code></pre></div><h3 id="_3-创建配置文件" tabindex="-1">3.创建配置文件 <a class="header-anchor" href="#_3-创建配置文件" aria-label="Permalink to &quot;3.创建配置文件&quot;">​</a></h3><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#9ECBFF;">mkdir -p /etc/clickhouse-backup/</span></span>
<span class="line"></span>
<span class="line"><span style="color:#9ECBFF;">cd /etc/clickhouse-backup/</span></span>
<span class="line"></span>
<span class="line"><span style="color:#9ECBFF;">cat &gt; config.yml &lt;&lt;EOF</span></span>
<span class="line"><span style="color:#85E89D;">general</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">remote_storage</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">none</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">backups_to_keep_local</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">7</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># 本地备份保留个数，默认0表示不自动做备份清理</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">backups_to_keep_remote</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">31</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># 远程备份保留个数</span></span>
<span class="line"><span style="color:#85E89D;">clickhouse</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">username</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">default</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">password</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;123456&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">host</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">10.103.236.200</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;">#根据自己环境修改</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">port</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">9000</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># 这个与jdbc链接里的端口没关系，就是9000</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">data_path</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;/var/lib/clickhouse&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;">#clickhouse的数据的实际存储位置</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">skip_tables</span><span style="color:#E1E4E8;">: </span><span style="color:#6A737D;"># 不需要备份的库</span></span>
<span class="line"><span style="color:#E1E4E8;">  - </span><span style="color:#9ECBFF;">system.*</span></span>
<span class="line"><span style="color:#E1E4E8;">  - </span><span style="color:#9ECBFF;">default.*</span></span>
<span class="line"><span style="color:#E1E4E8;">  - </span><span style="color:#9ECBFF;">INFORMATION_SCHEMA.*</span></span>
<span class="line"><span style="color:#E1E4E8;">  - </span><span style="color:#9ECBFF;">information_schema.*</span></span>
<span class="line"><span style="color:#9ECBFF;">EOF</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#032F62;">mkdir -p /etc/clickhouse-backup/</span></span>
<span class="line"></span>
<span class="line"><span style="color:#032F62;">cd /etc/clickhouse-backup/</span></span>
<span class="line"></span>
<span class="line"><span style="color:#032F62;">cat &gt; config.yml &lt;&lt;EOF</span></span>
<span class="line"><span style="color:#22863A;">general</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">remote_storage</span><span style="color:#24292E;">: </span><span style="color:#032F62;">none</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">backups_to_keep_local</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">7</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 本地备份保留个数，默认0表示不自动做备份清理</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">backups_to_keep_remote</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">31</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 远程备份保留个数</span></span>
<span class="line"><span style="color:#22863A;">clickhouse</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">username</span><span style="color:#24292E;">: </span><span style="color:#032F62;">default</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">password</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;123456&quot;</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">host</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">10.103.236.200</span><span style="color:#24292E;"> </span><span style="color:#6A737D;">#根据自己环境修改</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">port</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">9000</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 这个与jdbc链接里的端口没关系，就是9000</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">data_path</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;/var/lib/clickhouse&quot;</span><span style="color:#24292E;"> </span><span style="color:#6A737D;">#clickhouse的数据的实际存储位置</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">skip_tables</span><span style="color:#24292E;">: </span><span style="color:#6A737D;"># 不需要备份的库</span></span>
<span class="line"><span style="color:#24292E;">  - </span><span style="color:#032F62;">system.*</span></span>
<span class="line"><span style="color:#24292E;">  - </span><span style="color:#032F62;">default.*</span></span>
<span class="line"><span style="color:#24292E;">  - </span><span style="color:#032F62;">INFORMATION_SCHEMA.*</span></span>
<span class="line"><span style="color:#24292E;">  - </span><span style="color:#032F62;">information_schema.*</span></span>
<span class="line"><span style="color:#032F62;">EOF</span></span></code></pre></div><div class="warning custom-block"><p class="custom-block-title">💡 说明</p><p>默认去/etc/clickhouse-backup/config.xml 找，如果不是在这个目录下，需要通过--config指定</p><p>clickhouse-backup create my_backup --config /path/config.xml</p><p><strong>默认备份文件备份到数据目录下的backup目录下</strong></p></div><h3 id="_4-帮助" tabindex="-1">4.帮助 <a class="header-anchor" href="#_4-帮助" aria-label="Permalink to &quot;4.帮助&quot;">​</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">[root@kubeadm-master01 clickhouse-backup]# clickhouse-backup --help</span></span>
<span class="line"><span style="color:#B392F0;">NAME:</span></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#B392F0;">clickhouse-backup</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">-</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Tool</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">for</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">easy</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">backup</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">of</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">ClickHouse</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">with</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">cloud</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">support</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">USAGE:</span></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#B392F0;">clickhouse-backup</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">comman</span><span style="color:#E1E4E8;">d</span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;"> [-t, </span><span style="color:#79B8FF;">--tables=</span><span style="color:#F97583;">&lt;</span><span style="color:#79B8FF;">db</span><span style="color:#F97583;">&gt;</span><span style="color:#79B8FF;">.</span><span style="color:#F97583;">&lt;</span><span style="color:#79B8FF;">table</span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;">] </span><span style="color:#F97583;">&lt;</span><span style="color:#E1E4E8;">backup_name</span><span style="color:#F97583;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">VERSION:</span></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#B392F0;">2.6.3</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">DESCRIPTION:</span></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#B392F0;">Run</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">as</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;root&#39;</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">or</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;clickhouse&#39;</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">user</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">COMMANDS:</span></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#B392F0;">tables</span><span style="color:#E1E4E8;">               </span><span style="color:#9ECBFF;">List</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">of</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">tables,</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">exclude</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">skip_tables</span></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#B392F0;">create</span><span style="color:#E1E4E8;">               </span><span style="color:#9ECBFF;">Create</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">new</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">backup</span></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#B392F0;">create_remote</span><span style="color:#E1E4E8;">        </span><span style="color:#9ECBFF;">Create</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">and</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">upload</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">new</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">backup</span></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#B392F0;">upload</span><span style="color:#E1E4E8;">               </span><span style="color:#9ECBFF;">Upload</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">backup</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">to</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">remote</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">storage</span></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#B392F0;">list</span><span style="color:#E1E4E8;">                 </span><span style="color:#9ECBFF;">List</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">of</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">backups</span></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#B392F0;">download</span><span style="color:#E1E4E8;">             </span><span style="color:#9ECBFF;">Download</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">backup</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">from</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">remote</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">storage</span></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#B392F0;">restore</span><span style="color:#E1E4E8;">              </span><span style="color:#9ECBFF;">Create</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">schema</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">and</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">restore</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">data</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">from</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">backup</span></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#B392F0;">restore_remote</span><span style="color:#E1E4E8;">       </span><span style="color:#9ECBFF;">Download</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">and</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">restore</span></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#B392F0;">delete</span><span style="color:#E1E4E8;">               </span><span style="color:#9ECBFF;">Delete</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">specific</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">backup</span></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#B392F0;">default-config</span><span style="color:#E1E4E8;">       </span><span style="color:#9ECBFF;">Print</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">default</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">config</span></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">print</span><span style="color:#E1E4E8;">-config         </span><span style="color:#9ECBFF;">Print</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">current</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">config</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">merged</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">with</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">environment</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">variables</span></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#B392F0;">clean</span><span style="color:#E1E4E8;">                </span><span style="color:#9ECBFF;">Remove</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">data</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">in</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;shadow&#39;</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">folder</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">from</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">all</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;path&#39;</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">folders</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">available</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">from</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;system.disks&#39;</span></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#B392F0;">clean_remote_broken</span><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">Remove</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">all</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">broken</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">remote</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">backups</span></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#B392F0;">watch</span><span style="color:#E1E4E8;">                </span><span style="color:#9ECBFF;">Run</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">infinite</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">loop</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">which</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">create</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">full</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">+</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">incremental</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">backup</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">sequence</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">to</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">allow</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">efficient</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">backup</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">sequences</span></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#B392F0;">server</span><span style="color:#E1E4E8;">               </span><span style="color:#9ECBFF;">Run</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">API</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">server</span></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#B392F0;">help,</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">h</span><span style="color:#E1E4E8;">              </span><span style="color:#9ECBFF;">Shows</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">a</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">list</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">of</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">commands</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">or</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">help</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">for</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">one</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">command</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">[root@kubeadm-master01 clickhouse-backup]# clickhouse-backup --help</span></span>
<span class="line"><span style="color:#6F42C1;">NAME:</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#6F42C1;">clickhouse-backup</span><span style="color:#24292E;"> </span><span style="color:#032F62;">-</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Tool</span><span style="color:#24292E;"> </span><span style="color:#032F62;">for</span><span style="color:#24292E;"> </span><span style="color:#032F62;">easy</span><span style="color:#24292E;"> </span><span style="color:#032F62;">backup</span><span style="color:#24292E;"> </span><span style="color:#032F62;">of</span><span style="color:#24292E;"> </span><span style="color:#032F62;">ClickHouse</span><span style="color:#24292E;"> </span><span style="color:#032F62;">with</span><span style="color:#24292E;"> </span><span style="color:#032F62;">cloud</span><span style="color:#24292E;"> </span><span style="color:#032F62;">support</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">USAGE:</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#6F42C1;">clickhouse-backup</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">comman</span><span style="color:#24292E;">d</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;"> [-t, </span><span style="color:#005CC5;">--tables=</span><span style="color:#D73A49;">&lt;</span><span style="color:#005CC5;">db</span><span style="color:#D73A49;">&gt;</span><span style="color:#005CC5;">.</span><span style="color:#D73A49;">&lt;</span><span style="color:#005CC5;">table</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;">] </span><span style="color:#D73A49;">&lt;</span><span style="color:#24292E;">backup_name</span><span style="color:#D73A49;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">VERSION:</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#6F42C1;">2.6.3</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">DESCRIPTION:</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#6F42C1;">Run</span><span style="color:#24292E;"> </span><span style="color:#032F62;">as</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;root&#39;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">or</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;clickhouse&#39;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">user</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">COMMANDS:</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#6F42C1;">tables</span><span style="color:#24292E;">               </span><span style="color:#032F62;">List</span><span style="color:#24292E;"> </span><span style="color:#032F62;">of</span><span style="color:#24292E;"> </span><span style="color:#032F62;">tables,</span><span style="color:#24292E;"> </span><span style="color:#032F62;">exclude</span><span style="color:#24292E;"> </span><span style="color:#032F62;">skip_tables</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#6F42C1;">create</span><span style="color:#24292E;">               </span><span style="color:#032F62;">Create</span><span style="color:#24292E;"> </span><span style="color:#032F62;">new</span><span style="color:#24292E;"> </span><span style="color:#032F62;">backup</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#6F42C1;">create_remote</span><span style="color:#24292E;">        </span><span style="color:#032F62;">Create</span><span style="color:#24292E;"> </span><span style="color:#032F62;">and</span><span style="color:#24292E;"> </span><span style="color:#032F62;">upload</span><span style="color:#24292E;"> </span><span style="color:#032F62;">new</span><span style="color:#24292E;"> </span><span style="color:#032F62;">backup</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#6F42C1;">upload</span><span style="color:#24292E;">               </span><span style="color:#032F62;">Upload</span><span style="color:#24292E;"> </span><span style="color:#032F62;">backup</span><span style="color:#24292E;"> </span><span style="color:#032F62;">to</span><span style="color:#24292E;"> </span><span style="color:#032F62;">remote</span><span style="color:#24292E;"> </span><span style="color:#032F62;">storage</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#6F42C1;">list</span><span style="color:#24292E;">                 </span><span style="color:#032F62;">List</span><span style="color:#24292E;"> </span><span style="color:#032F62;">of</span><span style="color:#24292E;"> </span><span style="color:#032F62;">backups</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#6F42C1;">download</span><span style="color:#24292E;">             </span><span style="color:#032F62;">Download</span><span style="color:#24292E;"> </span><span style="color:#032F62;">backup</span><span style="color:#24292E;"> </span><span style="color:#032F62;">from</span><span style="color:#24292E;"> </span><span style="color:#032F62;">remote</span><span style="color:#24292E;"> </span><span style="color:#032F62;">storage</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#6F42C1;">restore</span><span style="color:#24292E;">              </span><span style="color:#032F62;">Create</span><span style="color:#24292E;"> </span><span style="color:#032F62;">schema</span><span style="color:#24292E;"> </span><span style="color:#032F62;">and</span><span style="color:#24292E;"> </span><span style="color:#032F62;">restore</span><span style="color:#24292E;"> </span><span style="color:#032F62;">data</span><span style="color:#24292E;"> </span><span style="color:#032F62;">from</span><span style="color:#24292E;"> </span><span style="color:#032F62;">backup</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#6F42C1;">restore_remote</span><span style="color:#24292E;">       </span><span style="color:#032F62;">Download</span><span style="color:#24292E;"> </span><span style="color:#032F62;">and</span><span style="color:#24292E;"> </span><span style="color:#032F62;">restore</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#6F42C1;">delete</span><span style="color:#24292E;">               </span><span style="color:#032F62;">Delete</span><span style="color:#24292E;"> </span><span style="color:#032F62;">specific</span><span style="color:#24292E;"> </span><span style="color:#032F62;">backup</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#6F42C1;">default-config</span><span style="color:#24292E;">       </span><span style="color:#032F62;">Print</span><span style="color:#24292E;"> </span><span style="color:#032F62;">default</span><span style="color:#24292E;"> </span><span style="color:#032F62;">config</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#005CC5;">print</span><span style="color:#24292E;">-config         </span><span style="color:#032F62;">Print</span><span style="color:#24292E;"> </span><span style="color:#032F62;">current</span><span style="color:#24292E;"> </span><span style="color:#032F62;">config</span><span style="color:#24292E;"> </span><span style="color:#032F62;">merged</span><span style="color:#24292E;"> </span><span style="color:#032F62;">with</span><span style="color:#24292E;"> </span><span style="color:#032F62;">environment</span><span style="color:#24292E;"> </span><span style="color:#032F62;">variables</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#6F42C1;">clean</span><span style="color:#24292E;">                </span><span style="color:#032F62;">Remove</span><span style="color:#24292E;"> </span><span style="color:#032F62;">data</span><span style="color:#24292E;"> </span><span style="color:#032F62;">in</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;shadow&#39;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">folder</span><span style="color:#24292E;"> </span><span style="color:#032F62;">from</span><span style="color:#24292E;"> </span><span style="color:#032F62;">all</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;path&#39;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">folders</span><span style="color:#24292E;"> </span><span style="color:#032F62;">available</span><span style="color:#24292E;"> </span><span style="color:#032F62;">from</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;system.disks&#39;</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#6F42C1;">clean_remote_broken</span><span style="color:#24292E;">  </span><span style="color:#032F62;">Remove</span><span style="color:#24292E;"> </span><span style="color:#032F62;">all</span><span style="color:#24292E;"> </span><span style="color:#032F62;">broken</span><span style="color:#24292E;"> </span><span style="color:#032F62;">remote</span><span style="color:#24292E;"> </span><span style="color:#032F62;">backups</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#6F42C1;">watch</span><span style="color:#24292E;">                </span><span style="color:#032F62;">Run</span><span style="color:#24292E;"> </span><span style="color:#032F62;">infinite</span><span style="color:#24292E;"> </span><span style="color:#032F62;">loop</span><span style="color:#24292E;"> </span><span style="color:#032F62;">which</span><span style="color:#24292E;"> </span><span style="color:#032F62;">create</span><span style="color:#24292E;"> </span><span style="color:#032F62;">full</span><span style="color:#24292E;"> </span><span style="color:#032F62;">+</span><span style="color:#24292E;"> </span><span style="color:#032F62;">incremental</span><span style="color:#24292E;"> </span><span style="color:#032F62;">backup</span><span style="color:#24292E;"> </span><span style="color:#032F62;">sequence</span><span style="color:#24292E;"> </span><span style="color:#032F62;">to</span><span style="color:#24292E;"> </span><span style="color:#032F62;">allow</span><span style="color:#24292E;"> </span><span style="color:#032F62;">efficient</span><span style="color:#24292E;"> </span><span style="color:#032F62;">backup</span><span style="color:#24292E;"> </span><span style="color:#032F62;">sequences</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#6F42C1;">server</span><span style="color:#24292E;">               </span><span style="color:#032F62;">Run</span><span style="color:#24292E;"> </span><span style="color:#032F62;">API</span><span style="color:#24292E;"> </span><span style="color:#032F62;">server</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#6F42C1;">help,</span><span style="color:#24292E;"> </span><span style="color:#032F62;">h</span><span style="color:#24292E;">              </span><span style="color:#032F62;">Shows</span><span style="color:#24292E;"> </span><span style="color:#032F62;">a</span><span style="color:#24292E;"> </span><span style="color:#032F62;">list</span><span style="color:#24292E;"> </span><span style="color:#032F62;">of</span><span style="color:#24292E;"> </span><span style="color:#032F62;">commands</span><span style="color:#24292E;"> </span><span style="color:#032F62;">or</span><span style="color:#24292E;"> </span><span style="color:#032F62;">help</span><span style="color:#24292E;"> </span><span style="color:#032F62;">for</span><span style="color:#24292E;"> </span><span style="color:#032F62;">one</span><span style="color:#24292E;"> </span><span style="color:#032F62;">command</span></span></code></pre></div><h2 id="_3-3-备份" tabindex="-1">3.3 备份 <a class="header-anchor" href="#_3-3-备份" aria-label="Permalink to &quot;3.3 备份&quot;">​</a></h2><ul><li>准备数据</li></ul><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">#创建库</span></span>
<span class="line"><span style="color:#F97583;">create</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">database</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">if</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">not</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">exists</span><span style="color:#E1E4E8;"> test;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">#创建表</span></span>
<span class="line"><span style="color:#F97583;">create</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">table</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">if</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">not</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">exists</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">test</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">t_order</span></span>
<span class="line"><span style="color:#E1E4E8;">(</span></span>
<span class="line"><span style="color:#E1E4E8;">  id Int64 COMMENT </span><span style="color:#9ECBFF;">&#39;订单id&#39;</span><span style="color:#E1E4E8;">, </span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">datetime</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">DateTime</span><span style="color:#E1E4E8;"> COMMENT </span><span style="color:#9ECBFF;">&#39;订单日期&#39;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">name</span><span style="color:#E1E4E8;"> String COMMENT </span><span style="color:#9ECBFF;">&#39;手办名称&#39;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">  price Decimal32(</span><span style="color:#79B8FF;">2</span><span style="color:#E1E4E8;">) COMMENT </span><span style="color:#9ECBFF;">&#39;手办价格&#39;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">  user_id Int64 COMMENT </span><span style="color:#9ECBFF;">&#39;用户id&#39;</span></span>
<span class="line"><span style="color:#E1E4E8;">) engine </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> MergeTree </span></span>
<span class="line"><span style="color:#F97583;">partition</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">by</span><span style="color:#E1E4E8;"> toYYYYMM(</span><span style="color:#F97583;">datetime</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#F97583;">order by</span><span style="color:#E1E4E8;"> id ;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">#插入数据</span></span>
<span class="line"><span style="color:#F97583;">insert into</span><span style="color:#E1E4E8;"> t_order </span><span style="color:#F97583;">values</span><span style="color:#E1E4E8;"> (</span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&#39;2022-03-08 12:40:00&#39;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&#39;张&#39;</span><span style="color:#E1E4E8;">, </span><span style="color:#79B8FF;">999</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">99</span><span style="color:#E1E4E8;">, </span><span style="color:#79B8FF;">202203080001</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#F97583;">insert into</span><span style="color:#E1E4E8;"> t_order </span><span style="color:#F97583;">values</span><span style="color:#E1E4E8;"> (</span><span style="color:#79B8FF;">2</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&#39;2023-03-08 12:44:00&#39;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&#39;李&#39;</span><span style="color:#E1E4E8;">, </span><span style="color:#79B8FF;">1111</span><span style="color:#E1E4E8;">, </span><span style="color:#79B8FF;">202303080002</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#F97583;">insert into</span><span style="color:#E1E4E8;"> t_order </span><span style="color:#F97583;">values</span><span style="color:#E1E4E8;"> (</span><span style="color:#79B8FF;">3</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&#39;2022-03-08 12:45:00&#39;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&#39;黄&#39;</span><span style="color:#E1E4E8;">, </span><span style="color:#79B8FF;">8989</span><span style="color:#E1E4E8;">, </span><span style="color:#79B8FF;">202203080001</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">#用全库备份先预留一份，再进行下面操作：</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">#删除数据</span></span>
<span class="line"><span style="color:#F97583;">alter</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">table</span><span style="color:#E1E4E8;"> t_order </span><span style="color:#F97583;">delete</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">where</span><span style="color:#E1E4E8;"> id </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">#清空表</span></span>
<span class="line"><span style="color:#F97583;">truncate</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">table</span><span style="color:#E1E4E8;"> t_order;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">#删除表</span></span>
<span class="line"><span style="color:#F97583;">drop</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">table</span><span style="color:#E1E4E8;"> t_order;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">#删除库</span></span>
<span class="line"><span style="color:#F97583;">drop</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">database</span><span style="color:#E1E4E8;"> test;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">#创建库</span></span>
<span class="line"><span style="color:#D73A49;">create</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">database</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">if</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">not</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">exists</span><span style="color:#24292E;"> test;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">#创建表</span></span>
<span class="line"><span style="color:#D73A49;">create</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">table</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">if</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">not</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">exists</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">test</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">t_order</span></span>
<span class="line"><span style="color:#24292E;">(</span></span>
<span class="line"><span style="color:#24292E;">  id Int64 COMMENT </span><span style="color:#032F62;">&#39;订单id&#39;</span><span style="color:#24292E;">, </span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">datetime</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">DateTime</span><span style="color:#24292E;"> COMMENT </span><span style="color:#032F62;">&#39;订单日期&#39;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">name</span><span style="color:#24292E;"> String COMMENT </span><span style="color:#032F62;">&#39;手办名称&#39;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">  price Decimal32(</span><span style="color:#005CC5;">2</span><span style="color:#24292E;">) COMMENT </span><span style="color:#032F62;">&#39;手办价格&#39;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">  user_id Int64 COMMENT </span><span style="color:#032F62;">&#39;用户id&#39;</span></span>
<span class="line"><span style="color:#24292E;">) engine </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> MergeTree </span></span>
<span class="line"><span style="color:#D73A49;">partition</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">by</span><span style="color:#24292E;"> toYYYYMM(</span><span style="color:#D73A49;">datetime</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#D73A49;">order by</span><span style="color:#24292E;"> id ;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">#插入数据</span></span>
<span class="line"><span style="color:#D73A49;">insert into</span><span style="color:#24292E;"> t_order </span><span style="color:#D73A49;">values</span><span style="color:#24292E;"> (</span><span style="color:#005CC5;">1</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&#39;2022-03-08 12:40:00&#39;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&#39;张&#39;</span><span style="color:#24292E;">, </span><span style="color:#005CC5;">999</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">99</span><span style="color:#24292E;">, </span><span style="color:#005CC5;">202203080001</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#D73A49;">insert into</span><span style="color:#24292E;"> t_order </span><span style="color:#D73A49;">values</span><span style="color:#24292E;"> (</span><span style="color:#005CC5;">2</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&#39;2023-03-08 12:44:00&#39;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&#39;李&#39;</span><span style="color:#24292E;">, </span><span style="color:#005CC5;">1111</span><span style="color:#24292E;">, </span><span style="color:#005CC5;">202303080002</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#D73A49;">insert into</span><span style="color:#24292E;"> t_order </span><span style="color:#D73A49;">values</span><span style="color:#24292E;"> (</span><span style="color:#005CC5;">3</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&#39;2022-03-08 12:45:00&#39;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&#39;黄&#39;</span><span style="color:#24292E;">, </span><span style="color:#005CC5;">8989</span><span style="color:#24292E;">, </span><span style="color:#005CC5;">202203080001</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">#用全库备份先预留一份，再进行下面操作：</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">#删除数据</span></span>
<span class="line"><span style="color:#D73A49;">alter</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">table</span><span style="color:#24292E;"> t_order </span><span style="color:#D73A49;">delete</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">where</span><span style="color:#24292E;"> id </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2</span><span style="color:#24292E;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">#清空表</span></span>
<span class="line"><span style="color:#D73A49;">truncate</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">table</span><span style="color:#24292E;"> t_order;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">#删除表</span></span>
<span class="line"><span style="color:#D73A49;">drop</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">table</span><span style="color:#24292E;"> t_order;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">#删除库</span></span>
<span class="line"><span style="color:#D73A49;">drop</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">database</span><span style="color:#24292E;"> test;</span></span></code></pre></div><h3 id="_1-单表备份" tabindex="-1">1.单表备份 <a class="header-anchor" href="#_1-单表备份" aria-label="Permalink to &quot;1.单表备份&quot;">​</a></h3><ul><li>语法</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">clickhouse-backup</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">create</span><span style="color:#E1E4E8;"> [-t, </span><span style="color:#79B8FF;">--tables=</span><span style="color:#F97583;">&lt;</span><span style="color:#79B8FF;">db</span><span style="color:#F97583;">&gt;</span><span style="color:#79B8FF;">.</span><span style="color:#F97583;">&lt;</span><span style="color:#79B8FF;">table</span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;">] </span><span style="color:#F97583;">&lt;</span><span style="color:#E1E4E8;">backup_name</span><span style="color:#F97583;">&gt;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">clickhouse-backup</span><span style="color:#24292E;"> </span><span style="color:#032F62;">create</span><span style="color:#24292E;"> [-t, </span><span style="color:#005CC5;">--tables=</span><span style="color:#D73A49;">&lt;</span><span style="color:#005CC5;">db</span><span style="color:#D73A49;">&gt;</span><span style="color:#005CC5;">.</span><span style="color:#D73A49;">&lt;</span><span style="color:#005CC5;">table</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;">] </span><span style="color:#D73A49;">&lt;</span><span style="color:#24292E;">backup_name</span><span style="color:#D73A49;">&gt;</span></span></code></pre></div><ul><li>查看有多少表</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">[root@kubeadm-master01 clickhouse-backup]# clickhouse-backup tables</span></span>
<span class="line"><span style="color:#B392F0;">2024-11-07</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">11</span><span style="color:#9ECBFF;">:26:02.669</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">INF</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pkg/clickhouse/clickhouse.go:128</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">clickhouse</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">connection</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">prepared:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">tcp://10.103.236.200:9000</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">run</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">ping</span></span>
<span class="line"><span style="color:#B392F0;">。。。。。</span></span>
<span class="line"><span style="color:#B392F0;">nginxlogs.nginx_access</span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">4.06</span><span style="color:#9ECBFF;">KiB</span><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">default</span><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">full</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">2024-11-07</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">11</span><span style="color:#9ECBFF;">:26:02.714</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">INF</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pkg/clickhouse/clickhouse.go:325</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">clickhouse</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">connection</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">closed</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">[root@kubeadm-master01 clickhouse-backup]# clickhouse-backup tables</span></span>
<span class="line"><span style="color:#6F42C1;">2024-11-07</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">11</span><span style="color:#032F62;">:26:02.669</span><span style="color:#24292E;"> </span><span style="color:#032F62;">INF</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pkg/clickhouse/clickhouse.go:128</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">clickhouse</span><span style="color:#24292E;"> </span><span style="color:#032F62;">connection</span><span style="color:#24292E;"> </span><span style="color:#032F62;">prepared:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">tcp://10.103.236.200:9000</span><span style="color:#24292E;"> </span><span style="color:#032F62;">run</span><span style="color:#24292E;"> </span><span style="color:#032F62;">ping</span></span>
<span class="line"><span style="color:#6F42C1;">。。。。。</span></span>
<span class="line"><span style="color:#6F42C1;">nginxlogs.nginx_access</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">4.06</span><span style="color:#032F62;">KiB</span><span style="color:#24292E;">  </span><span style="color:#032F62;">default</span><span style="color:#24292E;">  </span><span style="color:#032F62;">full</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">2024-11-07</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">11</span><span style="color:#032F62;">:26:02.714</span><span style="color:#24292E;"> </span><span style="color:#032F62;">INF</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pkg/clickhouse/clickhouse.go:325</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">clickhouse</span><span style="color:#24292E;"> </span><span style="color:#032F62;">connection</span><span style="color:#24292E;"> </span><span style="color:#032F62;">closed</span></span></code></pre></div><ul><li>备份nginx_access表</li></ul><p><strong>备份名称默认为时间戳，可手动指定备份名称</strong></p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">clickhouse-backup</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">create</span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">-t</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">nginxlogs.nginx_access</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">nginxlogs_nginx_access_data_bak_202411</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#查看</span></span>
<span class="line"><span style="color:#E1E4E8;">[root@kubeadm-master01 clickhouse-backup]# ls /var/lib/clickhouse/backup/</span></span>
<span class="line"><span style="color:#B392F0;">nginxlogs_nginx_access_data_bak_202411</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#目录包含</span></span>
<span class="line"><span style="color:#E1E4E8;">[root@kubeadm-master01 clickhouse-backup]# ls /var/lib/clickhouse/backup/nginxlogs_nginx_access_data_bak_202411/</span></span>
<span class="line"><span style="color:#B392F0;">metadata</span><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">metadata.json</span><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">shadow</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">clickhouse-backup</span><span style="color:#24292E;"> </span><span style="color:#032F62;">create</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">-t</span><span style="color:#24292E;"> </span><span style="color:#032F62;">nginxlogs.nginx_access</span><span style="color:#24292E;"> </span><span style="color:#032F62;">nginxlogs_nginx_access_data_bak_202411</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#查看</span></span>
<span class="line"><span style="color:#24292E;">[root@kubeadm-master01 clickhouse-backup]# ls /var/lib/clickhouse/backup/</span></span>
<span class="line"><span style="color:#6F42C1;">nginxlogs_nginx_access_data_bak_202411</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#目录包含</span></span>
<span class="line"><span style="color:#24292E;">[root@kubeadm-master01 clickhouse-backup]# ls /var/lib/clickhouse/backup/nginxlogs_nginx_access_data_bak_202411/</span></span>
<span class="line"><span style="color:#6F42C1;">metadata</span><span style="color:#24292E;">  </span><span style="color:#032F62;">metadata.json</span><span style="color:#24292E;">  </span><span style="color:#032F62;">shadow</span></span></code></pre></div><blockquote><p><strong>备份存储在中 $data_path/backup 下(默认在/var/lib/clickhouse/backup)</strong></p></blockquote><div class="warning custom-block"><p class="custom-block-title">💡 说明</p><ul><li><strong>metadata目录: 包含重新创建所需的DDL SQL</strong></li><li><strong>shadow目录: 包含作为ALTER TABLE … FREEZE操作结果的数据。</strong></li><li><strong>metadata.json文件：备份的库表等信息</strong></li></ul></div><h3 id="_2-多表备份" tabindex="-1">2.多表备份 <a class="header-anchor" href="#_2-多表备份" aria-label="Permalink to &quot;2.多表备份&quot;">​</a></h3><p><strong>两个表用&quot;,&quot;隔开</strong></p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">clickhouse-backup</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">create</span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">-t</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">nginxlogs.nginx_access,</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">nginxlogs.nginx_access</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">nginxlogs_nginx_access_data_bak_202411</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">clickhouse-backup</span><span style="color:#24292E;"> </span><span style="color:#032F62;">create</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">-t</span><span style="color:#24292E;"> </span><span style="color:#032F62;">nginxlogs.nginx_access,</span><span style="color:#24292E;"> </span><span style="color:#032F62;">nginxlogs.nginx_access</span><span style="color:#24292E;"> </span><span style="color:#032F62;">nginxlogs_nginx_access_data_bak_202411</span></span></code></pre></div><h3 id="_3-全库备份" tabindex="-1">3.全库备份 <a class="header-anchor" href="#_3-全库备份" aria-label="Permalink to &quot;3.全库备份&quot;">​</a></h3><ul><li>备份</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">$</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">clickhouse-backup</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">create</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">bak202411</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">$</span><span style="color:#24292E;"> </span><span style="color:#032F62;">clickhouse-backup</span><span style="color:#24292E;"> </span><span style="color:#032F62;">create</span><span style="color:#24292E;"> </span><span style="color:#032F62;">bak202411</span></span></code></pre></div><ul><li>查看</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">$</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">clickhouse-backup</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">list</span></span>
<span class="line"><span style="color:#B392F0;">2024-11-07</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">11</span><span style="color:#9ECBFF;">:49:12.884</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">INF</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pkg/clickhouse/clickhouse.go:128</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">clickhouse</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">connection</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">prepared:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">tcp://10.103.236.200:9000</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">run</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">ping</span></span>
<span class="line"><span style="color:#B392F0;">。。。。</span></span>
<span class="line"><span style="color:#B392F0;">nginxlogs_nginx_access_data_bak_202411</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">7.15</span><span style="color:#9ECBFF;">KiB</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">07</span><span style="color:#9ECBFF;">/11/2024</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">03</span><span style="color:#9ECBFF;">:42:07</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">local</span><span style="color:#E1E4E8;">      </span><span style="color:#9ECBFF;">regular</span></span>
<span class="line"><span style="color:#B392F0;">bak202411</span><span style="color:#E1E4E8;">                                </span><span style="color:#79B8FF;">7.15</span><span style="color:#9ECBFF;">KiB</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">07</span><span style="color:#9ECBFF;">/11/2024</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">03</span><span style="color:#9ECBFF;">:48:14</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">local</span><span style="color:#E1E4E8;">      </span><span style="color:#9ECBFF;">regular</span></span>
<span class="line"><span style="color:#B392F0;">2024-11-07</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">11</span><span style="color:#9ECBFF;">:49:12.952</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">INF</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pkg/clickhouse/clickhouse.go:325</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">clickhouse</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">connection</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">closed</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">$</span><span style="color:#24292E;"> </span><span style="color:#032F62;">clickhouse-backup</span><span style="color:#24292E;"> </span><span style="color:#032F62;">list</span></span>
<span class="line"><span style="color:#6F42C1;">2024-11-07</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">11</span><span style="color:#032F62;">:49:12.884</span><span style="color:#24292E;"> </span><span style="color:#032F62;">INF</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pkg/clickhouse/clickhouse.go:128</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">clickhouse</span><span style="color:#24292E;"> </span><span style="color:#032F62;">connection</span><span style="color:#24292E;"> </span><span style="color:#032F62;">prepared:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">tcp://10.103.236.200:9000</span><span style="color:#24292E;"> </span><span style="color:#032F62;">run</span><span style="color:#24292E;"> </span><span style="color:#032F62;">ping</span></span>
<span class="line"><span style="color:#6F42C1;">。。。。</span></span>
<span class="line"><span style="color:#6F42C1;">nginxlogs_nginx_access_data_bak_202411</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">7.15</span><span style="color:#032F62;">KiB</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">07</span><span style="color:#032F62;">/11/2024</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">03</span><span style="color:#032F62;">:42:07</span><span style="color:#24292E;">   </span><span style="color:#032F62;">local</span><span style="color:#24292E;">      </span><span style="color:#032F62;">regular</span></span>
<span class="line"><span style="color:#6F42C1;">bak202411</span><span style="color:#24292E;">                                </span><span style="color:#005CC5;">7.15</span><span style="color:#032F62;">KiB</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">07</span><span style="color:#032F62;">/11/2024</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">03</span><span style="color:#032F62;">:48:14</span><span style="color:#24292E;">   </span><span style="color:#032F62;">local</span><span style="color:#24292E;">      </span><span style="color:#032F62;">regular</span></span>
<span class="line"><span style="color:#6F42C1;">2024-11-07</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">11</span><span style="color:#032F62;">:49:12.952</span><span style="color:#24292E;"> </span><span style="color:#032F62;">INF</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pkg/clickhouse/clickhouse.go:325</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">clickhouse</span><span style="color:#24292E;"> </span><span style="color:#032F62;">connection</span><span style="color:#24292E;"> </span><span style="color:#032F62;">closed</span></span></code></pre></div><h2 id="_3-4-恢复备份" tabindex="-1">3.4 恢复备份 <a class="header-anchor" href="#_3-4-恢复备份" aria-label="Permalink to &quot;3.4 恢复备份&quot;">​</a></h2><ul><li>语法</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">$</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">clickhouse-backup</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">restore</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">备份名</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">--table</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">只恢复特定表，可以用正则（如还原指定数据库：--table=dbname.</span><span style="color:#79B8FF;">*</span><span style="color:#9ECBFF;">）</span></span>
<span class="line"><span style="color:#B392F0;">--schema</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">只还原表结构</span></span>
<span class="line"><span style="color:#B392F0;">--data</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">只还原数据</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">$</span><span style="color:#24292E;"> </span><span style="color:#032F62;">clickhouse-backup</span><span style="color:#24292E;"> </span><span style="color:#032F62;">restore</span><span style="color:#24292E;"> </span><span style="color:#032F62;">备份名</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">--table</span><span style="color:#24292E;"> </span><span style="color:#032F62;">只恢复特定表，可以用正则（如还原指定数据库：--table=dbname.</span><span style="color:#005CC5;">*</span><span style="color:#032F62;">）</span></span>
<span class="line"><span style="color:#6F42C1;">--schema</span><span style="color:#24292E;"> </span><span style="color:#032F62;">只还原表结构</span></span>
<span class="line"><span style="color:#6F42C1;">--data</span><span style="color:#24292E;"> </span><span style="color:#032F62;">只还原数据</span></span></code></pre></div><h3 id="_1-单表恢复" tabindex="-1">1.单表恢复 <a class="header-anchor" href="#_1-单表恢复" aria-label="Permalink to &quot;1.单表恢复&quot;">​</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">#删除先前备份的表</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#查看</span></span>
<span class="line"><span style="color:#B392F0;">$</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">clickhouse-backup</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">list</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#恢复</span></span>
<span class="line"><span style="color:#B392F0;">$</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">clickhouse-backup</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">restore</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">nginxlogs_nginx_access_data_bak_202411</span></span>
<span class="line"><span style="color:#B392F0;">会报错</span></span>
<span class="line"><span style="color:#E1E4E8;"> error</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&quot;can&#39;t create table \`</span><span style="color:#B392F0;">nginxlogs</span><span style="color:#9ECBFF;">\`.\`</span><span style="color:#B392F0;">nginx_access</span><span style="color:#9ECBFF;">\`: code: 57, message: Directory for table data store/72a/72ad70a1-093a-4254-9098-14d5735fc0d3/ already exists after 1 times, please check your schema dependencies&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;"> </span></span>
<span class="line"><span style="color:#6A737D;">#解决方式</span></span>
<span class="line"><span style="color:#B392F0;">UUID</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;e8c3a343-758d-4e9a-a8c3-a343758dce9a’,这一整个删除掉,重新执行clickhouse-backup restore 备份名</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">#删除先前备份的表</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#查看</span></span>
<span class="line"><span style="color:#6F42C1;">$</span><span style="color:#24292E;"> </span><span style="color:#032F62;">clickhouse-backup</span><span style="color:#24292E;"> </span><span style="color:#032F62;">list</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#恢复</span></span>
<span class="line"><span style="color:#6F42C1;">$</span><span style="color:#24292E;"> </span><span style="color:#032F62;">clickhouse-backup</span><span style="color:#24292E;"> </span><span style="color:#032F62;">restore</span><span style="color:#24292E;"> </span><span style="color:#032F62;">nginxlogs_nginx_access_data_bak_202411</span></span>
<span class="line"><span style="color:#6F42C1;">会报错</span></span>
<span class="line"><span style="color:#24292E;"> error</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&quot;can&#39;t create table \`</span><span style="color:#6F42C1;">nginxlogs</span><span style="color:#032F62;">\`.\`</span><span style="color:#6F42C1;">nginx_access</span><span style="color:#032F62;">\`: code: 57, message: Directory for table data store/72a/72ad70a1-093a-4254-9098-14d5735fc0d3/ already exists after 1 times, please check your schema dependencies&quot;</span></span>
<span class="line"><span style="color:#24292E;"> </span></span>
<span class="line"><span style="color:#6A737D;">#解决方式</span></span>
<span class="line"><span style="color:#6F42C1;">UUID</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;e8c3a343-758d-4e9a-a8c3-a343758dce9a’,这一整个删除掉,重新执行clickhouse-backup restore 备份名</span></span></code></pre></div><h3 id="_2-全库恢复" tabindex="-1">2.全库恢复 <a class="header-anchor" href="#_2-全库恢复" aria-label="Permalink to &quot;2.全库恢复&quot;">​</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">##需要保证原来的库完全被删除，否则可能会报错,默认会去/var/lib/clickhouse/backup路径下去找备份文件夹</span></span>
<span class="line"><span style="color:#B392F0;">clickhouse-backup</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">restore</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/var/lib/clickhouse/backup/备份名</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">##需要保证原来的库完全被删除，否则可能会报错,默认会去/var/lib/clickhouse/backup路径下去找备份文件夹</span></span>
<span class="line"><span style="color:#6F42C1;">clickhouse-backup</span><span style="color:#24292E;"> </span><span style="color:#032F62;">restore</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/var/lib/clickhouse/backup/备份名</span></span></code></pre></div><div class="warning custom-block"><p class="custom-block-title">💡 说明</p><p>如果遇到报错，<strong>Directory for table data store/e8c/e8c3a343-758d-4e9a-a8c3-a343758dce9a/ already exists after 1 times</strong>，参考单表恢复的解决方案即可。</p></div><h3 id="_3-只恢复表结构" tabindex="-1">3.只恢复表结构 <a class="header-anchor" href="#_3-只恢复表结构" aria-label="Permalink to &quot;3.只恢复表结构&quot;">​</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">#使用 --schema 恢复表的表结构</span></span>
<span class="line"><span style="color:#B392F0;">clickhouse-backup</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">restore</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">备份名</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--table</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">库名.表名</span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">--schema</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">#使用 --schema 恢复表的表结构</span></span>
<span class="line"><span style="color:#6F42C1;">clickhouse-backup</span><span style="color:#24292E;"> </span><span style="color:#032F62;">restore</span><span style="color:#24292E;"> </span><span style="color:#032F62;">备份名</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--table</span><span style="color:#24292E;"> </span><span style="color:#032F62;">库名.表名</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">--schema</span></span></code></pre></div><h3 id="_4-只恢复数据" tabindex="-1">4.只恢复数据 <a class="header-anchor" href="#_4-只恢复数据" aria-label="Permalink to &quot;4.只恢复数据&quot;">​</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">#用 --data 恢复表中数据（注意:由于是ATTACH PARTITION操作，如果执行2次的话，数据会翻倍）</span></span>
<span class="line"><span style="color:#B392F0;">clickhouse-backup</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">restore</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">备份名</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--table</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">库名.表名</span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">--data</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">#用 --data 恢复表中数据（注意:由于是ATTACH PARTITION操作，如果执行2次的话，数据会翻倍）</span></span>
<span class="line"><span style="color:#6F42C1;">clickhouse-backup</span><span style="color:#24292E;"> </span><span style="color:#032F62;">restore</span><span style="color:#24292E;"> </span><span style="color:#032F62;">备份名</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--table</span><span style="color:#24292E;"> </span><span style="color:#032F62;">库名.表名</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">--data</span></span></code></pre></div><h2 id="_3-5-删除备份" tabindex="-1">3.5 删除备份 <a class="header-anchor" href="#_3-5-删除备份" aria-label="Permalink to &quot;3.5 删除备份&quot;">​</a></h2><ul><li>查看备份</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">$</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">clickhouse-backup</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">list</span></span>
<span class="line"><span style="color:#B392F0;">2024-11-07</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">11</span><span style="color:#9ECBFF;">:49:12.884</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">INF</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pkg/clickhouse/clickhouse.go:128</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">clickhouse</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">connection</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">prepared:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">tcp://10.103.236.200:9000</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">run</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">ping</span></span>
<span class="line"><span style="color:#B392F0;">。。。。</span></span>
<span class="line"><span style="color:#B392F0;">nginxlogs_nginx_access_data_bak_202411</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">7.15</span><span style="color:#9ECBFF;">KiB</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">07</span><span style="color:#9ECBFF;">/11/2024</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">03</span><span style="color:#9ECBFF;">:42:07</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">local</span><span style="color:#E1E4E8;">      </span><span style="color:#9ECBFF;">regular</span></span>
<span class="line"><span style="color:#B392F0;">bak202411</span><span style="color:#E1E4E8;">                                </span><span style="color:#79B8FF;">7.15</span><span style="color:#9ECBFF;">KiB</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">07</span><span style="color:#9ECBFF;">/11/2024</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">03</span><span style="color:#9ECBFF;">:48:14</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">local</span><span style="color:#E1E4E8;">      </span><span style="color:#9ECBFF;">regular</span></span>
<span class="line"><span style="color:#B392F0;">2024-11-07</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">11</span><span style="color:#9ECBFF;">:49:12.952</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">INF</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pkg/clickhouse/clickhouse.go:325</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">clickhouse</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">connection</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">closed</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">$</span><span style="color:#24292E;"> </span><span style="color:#032F62;">clickhouse-backup</span><span style="color:#24292E;"> </span><span style="color:#032F62;">list</span></span>
<span class="line"><span style="color:#6F42C1;">2024-11-07</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">11</span><span style="color:#032F62;">:49:12.884</span><span style="color:#24292E;"> </span><span style="color:#032F62;">INF</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pkg/clickhouse/clickhouse.go:128</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">clickhouse</span><span style="color:#24292E;"> </span><span style="color:#032F62;">connection</span><span style="color:#24292E;"> </span><span style="color:#032F62;">prepared:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">tcp://10.103.236.200:9000</span><span style="color:#24292E;"> </span><span style="color:#032F62;">run</span><span style="color:#24292E;"> </span><span style="color:#032F62;">ping</span></span>
<span class="line"><span style="color:#6F42C1;">。。。。</span></span>
<span class="line"><span style="color:#6F42C1;">nginxlogs_nginx_access_data_bak_202411</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">7.15</span><span style="color:#032F62;">KiB</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">07</span><span style="color:#032F62;">/11/2024</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">03</span><span style="color:#032F62;">:42:07</span><span style="color:#24292E;">   </span><span style="color:#032F62;">local</span><span style="color:#24292E;">      </span><span style="color:#032F62;">regular</span></span>
<span class="line"><span style="color:#6F42C1;">bak202411</span><span style="color:#24292E;">                                </span><span style="color:#005CC5;">7.15</span><span style="color:#032F62;">KiB</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">07</span><span style="color:#032F62;">/11/2024</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">03</span><span style="color:#032F62;">:48:14</span><span style="color:#24292E;">   </span><span style="color:#032F62;">local</span><span style="color:#24292E;">      </span><span style="color:#032F62;">regular</span></span>
<span class="line"><span style="color:#6F42C1;">2024-11-07</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">11</span><span style="color:#032F62;">:49:12.952</span><span style="color:#24292E;"> </span><span style="color:#032F62;">INF</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pkg/clickhouse/clickhouse.go:325</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">clickhouse</span><span style="color:#24292E;"> </span><span style="color:#032F62;">connection</span><span style="color:#24292E;"> </span><span style="color:#032F62;">closed</span></span></code></pre></div><ul><li>删除</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">#删除nginxlogs_nginx_access_data_bak_202411</span></span>
<span class="line"><span style="color:#B392F0;">$</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">clickhouse-backup</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">delete</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">local</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">nginxlogs_nginx_access_data_bak_202411</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">#删除nginxlogs_nginx_access_data_bak_202411</span></span>
<span class="line"><span style="color:#6F42C1;">$</span><span style="color:#24292E;"> </span><span style="color:#032F62;">clickhouse-backup</span><span style="color:#24292E;"> </span><span style="color:#032F62;">delete</span><span style="color:#24292E;"> </span><span style="color:#032F62;">local</span><span style="color:#24292E;"> </span><span style="color:#032F62;">nginxlogs_nginx_access_data_bak_202411</span></span></code></pre></div><ul><li><h3 id="删除shadow下的临时备份文件" tabindex="-1">删除shadow下的临时备份文件 <a class="header-anchor" href="#删除shadow下的临时备份文件" aria-label="Permalink to &quot;删除shadow下的临时备份文件&quot;">​</a></h3></li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">$</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">clickhouse-backup</span><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">clean</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">$</span><span style="color:#24292E;"> </span><span style="color:#032F62;">clickhouse-backup</span><span style="color:#24292E;">  </span><span style="color:#032F62;">clean</span></span></code></pre></div><h2 id="_3-6-远程备份" tabindex="-1">3.6 远程备份 <a class="header-anchor" href="#_3-6-远程备份" aria-label="Permalink to &quot;3.6 远程备份&quot;">​</a></h2><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">#创建远程备份</span></span>
<span class="line"><span style="color:#B392F0;">$</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">clickhouse-backup</span><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">update</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#下载远程备份到本地</span></span>
<span class="line"><span style="color:#B392F0;">$</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">clickhouse-backup</span><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">download</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#恢复远程备份</span></span>
<span class="line"><span style="color:#B392F0;">$</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">clickhouse-backup</span><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">restore_remote</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">#创建远程备份</span></span>
<span class="line"><span style="color:#6F42C1;">$</span><span style="color:#24292E;"> </span><span style="color:#032F62;">clickhouse-backup</span><span style="color:#24292E;">  </span><span style="color:#032F62;">update</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#下载远程备份到本地</span></span>
<span class="line"><span style="color:#6F42C1;">$</span><span style="color:#24292E;"> </span><span style="color:#032F62;">clickhouse-backup</span><span style="color:#24292E;">  </span><span style="color:#032F62;">download</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#恢复远程备份</span></span>
<span class="line"><span style="color:#6F42C1;">$</span><span style="color:#24292E;"> </span><span style="color:#032F62;">clickhouse-backup</span><span style="color:#24292E;">  </span><span style="color:#032F62;">restore_remote</span></span></code></pre></div>`,74),e=[o];function c(t,r,E,y,i,F){return a(),n("div",null,e)}const d=s(p,[["render",c]]);export{C as __pageData,d as default};
