import{_ as s,o as a,c as l,R as e}from"./chunks/framework.zUbWieqp.js";const h=JSON.parse('{"title":"1. 升级前的准备工作和检查清单","description":"","frontmatter":{},"headers":[],"relativePath":"guide/container/k8s/cloud_k8s/aws/4-eks_self_update.md","filePath":"guide/container/k8s/cloud_k8s/aws/4-eks_self_update.md","lastUpdated":1755172914000}'),o={name:"guide/container/k8s/cloud_k8s/aws/4-eks_self_update.md"},n=e(`<h1 id="_1-升级前的准备工作和检查清单" tabindex="-1">1. 升级前的准备工作和检查清单 <a class="header-anchor" href="#_1-升级前的准备工作和检查清单" aria-label="Permalink to &quot;1. 升级前的准备工作和检查清单&quot;">​</a></h1><p>EKS 不允许跨版本升级，在升级 EKS 集群之前需要做兼容性的检查：</p><h2 id="_1-1版本兼容性检查" tabindex="-1">1. 1版本兼容性检查 <a class="header-anchor" href="#_1-1版本兼容性检查" aria-label="Permalink to &quot;1. 1版本兼容性检查&quot;">​</a></h2><ul><li><p>确认目标 EKS 版本：查看 AWS <a href="https://docs.aws.amazon.com/eks/latest/userguide/kubernetes-versions-standard.html" target="_blank" rel="noreferrer">文档</a>，了解最新的 EKS 版本及其功能。</p></li><li><p>检查应用程序兼容性：确保您的应用程序和使用的 Kubernetes API 与目标版本兼容。</p></li><li><p>检查插件兼容性：确保所有使用的 EKS 插件（如 CoreDNS、kube-proxy）与目标版本兼容。</p></li></ul><h2 id="_1-2-集群健康检查" tabindex="-1">1.2. 集群健康检查 <a class="header-anchor" href="#_1-2-集群健康检查" aria-label="Permalink to &quot;1.2. 集群健康检查&quot;">​</a></h2><ul><li>运行 <code>kubectl get nodes</code> 确保所有节点都处于 Ready 状态。</li><li>使用 <code>kubectl get pods --all-namespaces </code>检查所有 Pod 的状态。</li><li>检查集群指标，确保 CPU、内存和网络使用正常。</li></ul><p><strong>3. 备份关键数据</strong></p><ul><li>备份 etcd 数据：虽然 EKS 管理 etcd，但建议在升级前进行额外的备份，可以使用开源工具 <a href="https://velero.io/" target="_blank" rel="noreferrer">Velero</a>。</li><li>备份持久卷数据：如果使用 EBS 卷，考虑创建快照。</li></ul><p><strong>4. 更新 AWS CLI 和 kubectl</strong></p><ul><li><a href="https://docs.aws.amazon.com/eks/latest/userguide/install-awscli.html" target="_blank" rel="noreferrer">更新 AWS CLI</a> 到最新版本</li><li><a href="https://docs.aws.amazon.com/eks/latest/userguide/install-kubectl.html" target="_blank" rel="noreferrer">更新 kubectl</a> 以匹配目标 EKS 版本</li></ul><p><strong>5. 检查 IAM 权限</strong></p><p>确保用于升级的 IAM 用户或角色具有必要的权限，包括<code> eks:UpdateClusterVersion。</code></p><p><strong>6. 规划维护窗口</strong></p><ul><li><p>选择一个对业务影响最小的时间窗口进行升级。</p></li><li><p>通知所有相关团队升级计划和可能的影响。</p></li></ul><p><strong>7. 准备回滚计划</strong></p><ul><li>制定详细的回滚计划，包括如何恢复到之前的版本。</li><li>确保团队成员熟悉回滚程序。</li></ul><h1 id="_2-控制平面升级的具体步骤" tabindex="-1">2. 控制平面升级的具体步骤 <a class="header-anchor" href="#_2-控制平面升级的具体步骤" aria-label="Permalink to &quot;2. 控制平面升级的具体步骤&quot;">​</a></h1><h2 id="_2-1-检查当前版本" tabindex="-1">2.1 检查当前版本 <a class="header-anchor" href="#_2-1-检查当前版本" aria-label="Permalink to &quot;2.1 检查当前版本&quot;">​</a></h2><p>检查当前的 EKS 集群版本：</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">aws</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">eks</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">describe-cluster</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--name</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">your-cluster-name</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--query</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">cluster.version</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">aws</span><span style="color:#24292E;"> </span><span style="color:#032F62;">eks</span><span style="color:#24292E;"> </span><span style="color:#032F62;">describe-cluster</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--name</span><span style="color:#24292E;"> </span><span style="color:#032F62;">your-cluster-name</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--query</span><span style="color:#24292E;"> </span><span style="color:#032F62;">cluster.version</span></span></code></pre></div><h2 id="_2-2-启动升级过程" tabindex="-1">2.2 启动升级过程 <a class="header-anchor" href="#_2-2-启动升级过程" aria-label="Permalink to &quot;2.2 启动升级过程&quot;">​</a></h2><p>AWS CLI 启动升级过程：</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">aws</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">eks</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">update-cluster-version</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--name</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">your-cluster-name</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--kubernetes-version</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">1</span><span style="color:#9ECBFF;">.XX</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">aws</span><span style="color:#24292E;"> </span><span style="color:#032F62;">eks</span><span style="color:#24292E;"> </span><span style="color:#032F62;">update-cluster-version</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--name</span><span style="color:#24292E;"> </span><span style="color:#032F62;">your-cluster-name</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--kubernetes-version</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1</span><span style="color:#032F62;">.XX</span></span></code></pre></div><blockquote><p>其中，1.XX 是你想升级到的 Kubernetes 版本。</p></blockquote><h2 id="_2-3-监控升级进度" tabindex="-1">2.3 监控升级进度 <a class="header-anchor" href="#_2-3-监控升级进度" aria-label="Permalink to &quot;2.3 监控升级进度&quot;">​</a></h2><p>升级过程可能需要 20-30 分钟。你可以使用以下命令监控升级状态：</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">aws</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">eks</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">describe-update</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--name</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">your-cluster-name</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--update-id</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">your-update-id</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">aws</span><span style="color:#24292E;"> </span><span style="color:#032F62;">eks</span><span style="color:#24292E;"> </span><span style="color:#032F62;">describe-update</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--name</span><span style="color:#24292E;"> </span><span style="color:#032F62;">your-cluster-name</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--update-id</span><span style="color:#24292E;"> </span><span style="color:#032F62;">your-update-id</span></span></code></pre></div><blockquote><p>update-id 是在启动升级时返回的 ID。</p></blockquote><h2 id="_2-4-验证控制平面升级" tabindex="-1">2.4 验证控制平面升级 <a class="header-anchor" href="#_2-4-验证控制平面升级" aria-label="Permalink to &quot;2.4 验证控制平面升级&quot;">​</a></h2><p>升级完成后，再次检查集群版本以确认升级成功：</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">aws</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">eks</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">describe-cluster</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--name</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">your-cluster-name</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--query</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">cluster.version</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">aws</span><span style="color:#24292E;"> </span><span style="color:#032F62;">eks</span><span style="color:#24292E;"> </span><span style="color:#032F62;">describe-cluster</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--name</span><span style="color:#24292E;"> </span><span style="color:#032F62;">your-cluster-name</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--query</span><span style="color:#24292E;"> </span><span style="color:#032F62;">cluster.version</span></span></code></pre></div><h2 id="_2-5-升级附加组件" tabindex="-1">2.5 升级附加组件 <a class="header-anchor" href="#_2-5-升级附加组件" aria-label="Permalink to &quot;2.5 升级附加组件&quot;">​</a></h2><p>Amazon EKS 不会自动更新附加组件。要更新现有集群的附加组件，必须启动更新。启动更新后，Amazon EKS 会为您更新附加组件。在更新某个附加组件之前，请查看该附加组件的最新文档，您需要确保所有 EKS 插件都已更新到与新版本兼容的版本，对于托管的附加组件，可以按照以下步骤进行升级。更详细的内容可以参考附加组件升级<a href="https://docs.aws.amazon.com/zh_cn/eks/latest/userguide/updating-an-add-on.html" target="_blank" rel="noreferrer">文档</a>。 对于第三方的附加组件，需要通过其官方渠道进一步获取其版本的兼容性说明。</p><h3 id="_2-5-1-查看附加组件" tabindex="-1">2.5.1 查看附加组件 <a class="header-anchor" href="#_2-5-1-查看附加组件" aria-label="Permalink to &quot;2.5.1 查看附加组件&quot;">​</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">aws</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">eks</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">list-addons</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--cluster-name</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">your-cluster-name</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">aws</span><span style="color:#24292E;"> </span><span style="color:#032F62;">eks</span><span style="color:#24292E;"> </span><span style="color:#032F62;">list-addons</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--cluster-name</span><span style="color:#24292E;"> </span><span style="color:#032F62;">your-cluster-name</span></span></code></pre></div><h3 id="_2-5-2-升级附加组件" tabindex="-1">2.5.2 升级附加组件 <a class="header-anchor" href="#_2-5-2-升级附加组件" aria-label="Permalink to &quot;2.5.2 升级附加组件&quot;">​</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">aws</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">eks</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">update-addon</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--cluster-name</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">your-cluster-name</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--addon-name</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">addon-name</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--addon-version</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">version</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">aws</span><span style="color:#24292E;"> </span><span style="color:#032F62;">eks</span><span style="color:#24292E;"> </span><span style="color:#032F62;">update-addon</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--cluster-name</span><span style="color:#24292E;"> </span><span style="color:#032F62;">your-cluster-name</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--addon-name</span><span style="color:#24292E;"> </span><span style="color:#032F62;">addon-name</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--addon-version</span><span style="color:#24292E;"> </span><span style="color:#032F62;">version</span></span></code></pre></div><h1 id="_3-工作节点升级的方法" tabindex="-1">3. 工作节点升级的方法 <a class="header-anchor" href="#_3-工作节点升级的方法" aria-label="Permalink to &quot;3. 工作节点升级的方法&quot;">​</a></h1><h2 id="_3-1-托管节点组升级" tabindex="-1">3.1 托管节点组升级 <a class="header-anchor" href="#_3-1-托管节点组升级" aria-label="Permalink to &quot;3.1 托管节点组升级&quot;">​</a></h2><p>如果你使用的是 EKS 托管的节点组，<a href="https://docs.aws.amazon.com/zh_cn/eks/latest/userguide/update-managed-node-group.html" target="_blank" rel="noreferrer">升级过程</a>如下。注意托管节点组升级后，整个过程由后台自动控制，无法干预</p><h3 id="检查当前节点组版本" tabindex="-1">检查当前节点组版本 <a class="header-anchor" href="#检查当前节点组版本" aria-label="Permalink to &quot;检查当前节点组版本&quot;">​</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">aws</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">eks</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">describe-nodegroup</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--cluster-name</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">your-cluster-name</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--nodegroup-name</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">your-nodegroup-name</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">aws</span><span style="color:#24292E;"> </span><span style="color:#032F62;">eks</span><span style="color:#24292E;"> </span><span style="color:#032F62;">describe-nodegroup</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--cluster-name</span><span style="color:#24292E;"> </span><span style="color:#032F62;">your-cluster-name</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--nodegroup-name</span><span style="color:#24292E;"> </span><span style="color:#032F62;">your-nodegroup-name</span></span></code></pre></div><h3 id="更新节点组" tabindex="-1">更新节点组 <a class="header-anchor" href="#更新节点组" aria-label="Permalink to &quot;更新节点组&quot;">​</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">aws</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">eks</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">update-nodegroup-version</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--cluster-name</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">your-cluster-name</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--nodegroup-name</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">your-nodegroup-name</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">aws</span><span style="color:#24292E;"> </span><span style="color:#032F62;">eks</span><span style="color:#24292E;"> </span><span style="color:#032F62;">update-nodegroup-version</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--cluster-name</span><span style="color:#24292E;"> </span><span style="color:#032F62;">your-cluster-name</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--nodegroup-name</span><span style="color:#24292E;"> </span><span style="color:#032F62;">your-nodegroup-name</span></span></code></pre></div><h3 id="监控升级进度" tabindex="-1">监控升级进度 <a class="header-anchor" href="#监控升级进度" aria-label="Permalink to &quot;监控升级进度&quot;">​</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">aws</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">eks</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">describe-update</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--name</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">your-cluster-name</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--update-id</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">your-update-id</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">aws</span><span style="color:#24292E;"> </span><span style="color:#032F62;">eks</span><span style="color:#24292E;"> </span><span style="color:#032F62;">describe-update</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--name</span><span style="color:#24292E;"> </span><span style="color:#032F62;">your-cluster-name</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--update-id</span><span style="color:#24292E;"> </span><span style="color:#032F62;">your-update-id</span></span></code></pre></div><blockquote><p>背后执行过程</p><ul><li>Amazon EKS 为与您的节点组关联的 EC2 Auto Scaling 组创建新的 Amazon EC2 启动模板版本。新模板使用目标 AMI 进行升级。</li><li>EC2 Auto Scaling 组升级为使用最新的启动模板和新的 AMI。</li><li>EC2 Auto Scaling 组的最大大小和预期大小会递增，确保与现有 EC2 实例一起创建新的 EC2 实例。</li><li>EC2 Auto Scaling 组启动具有新 AMI 的新实例，以满足节点组增加后的预期大小。</li><li>Amazon EKS 检查节点组中的节点是否有 eks.amazonaws.com/nodegroup-image 标签。Amazon EKS 封锁节点组中未标有最新 AMI ID 的所有节点。这样可以防止之前失败升级中升级过的节点被封锁。</li><li>Amazon EKS 随机选择节点组中的节点，并向 EC2 Auto Scaling 组发送终止信号。然后，Amazon EKS 发送一个信号来耗尽节点中的 Pod。节点被清空后，会被终止。 此步骤将重复执行，直到所有节点均使用新 AMI 版本。</li><li>EC2 Auto Scaling 组的最大大小和预期大小将递减 1，以返回到升级前的值。</li></ul><p>更新策略有两个选项：</p><ul><li><strong>滚动更新</strong> – 此选项将对您的集群遵循 PodDisruptionBudgets。如果由于 PodDisruptionBudgets 问题，Amazon EKS 无法正常耗尽此节点组上运行的 Pod，则更新将失败。</li><li><strong>强制更新</strong> – 此选项不遵循 PodDisruptionBudgets。它将强制节点重新启动。</li></ul><p><a href="https://docs.aws.amazon.com/eks/latest/userguide/managed-node-update-behavior.html" target="_blank" rel="noreferrer">托管式节点更新</a></p></blockquote><h2 id="_3-2-非托管节点组升级" tabindex="-1">3.2 非托管节点组升级 <a class="header-anchor" href="#_3-2-非托管节点组升级" aria-label="Permalink to &quot;3.2 非托管节点组升级&quot;">​</a></h2><p>对于非托管节点，升级过程需要更多的手动操作，也提供了更多的灵活性和操作空间。非托管节点组的升级通过新建节点组的方式提供升级。在此过程中，需要注意的是新节点组的子网、安全组、IAM Role、userdata、标签、污点等需与旧节点组兼容。</p><ol><li>创建新的节点组。</li><li>给旧的节点打上污点。</li><li>逐步驱逐 Pod 到新的节点，注意这一部可以批量操作也可以一个个节点操作，前提是保证业务应用的可用性。</li><li>同时检查应用的健康性，确保整个迁移顺利完成。</li><li>完成检查后可以缩容旧的的节点组，可以将节点组下线或者保留。</li></ol><h2 id="_3-3-升级过程中的监控" tabindex="-1">3.3 升级过程中的监控 <a class="header-anchor" href="#_3-3-升级过程中的监控" aria-label="Permalink to &quot;3.3 升级过程中的监控&quot;">​</a></h2><h3 id="监控集群健康" tabindex="-1">监控集群健康 <a class="header-anchor" href="#监控集群健康" aria-label="Permalink to &quot;监控集群健康&quot;">​</a></h3><ul><li>使用 kubectl get nodes 和 kubectl get pods --all-namespaces 定期检查节点和 Pod 状态。</li><li>监控关键指标如 CPU 使用率、内存使用率和网络流量。</li><li>使用 AWS CloudWatch 监控 EKS 控制平面指标。</li></ul><h3 id="检查系统组件" tabindex="-1">检查系统组件 <a class="header-anchor" href="#检查系统组件" aria-label="Permalink to &quot;检查系统组件&quot;">​</a></h3><p>确保核心组件正常运行：</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">get</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pods</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-n</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">kube-system</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">get</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pods</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-n</span><span style="color:#24292E;"> </span><span style="color:#032F62;">kube-system</span></span></code></pre></div><p>特别关注 CoreDNS、kube-proxy 和 aws-node 等关键组件</p><h3 id="检查日志" tabindex="-1">检查日志 <a class="header-anchor" href="#检查日志" aria-label="Permalink to &quot;检查日志&quot;">​</a></h3><p>检查控制平面和工作节点的日志：</p><ul><li>对于控制平面，查看 CloudWatch Logs。</li><li>对于工作节点，使用 kubectl logs 或直接在节点上查看 /var/log/ 下的日志。</li></ul><h3 id="常见问题及解决方法" tabindex="-1">常见问题及解决方法 <a class="header-anchor" href="#常见问题及解决方法" aria-label="Permalink to &quot;常见问题及解决方法&quot;">​</a></h3><ul><li>节点未加入集群：检查安全组设置和 IAM 角色。</li><li>Pod 无法调度：检查资源限制和节点亲和性设置。</li><li>网络问题：验证 CNI 插件配置和 VPC 设置。</li></ul><h1 id="_4-验证集群版本" tabindex="-1">4. 验证集群版本 <a class="header-anchor" href="#_4-验证集群版本" aria-label="Permalink to &quot;4. 验证集群版本&quot;">​</a></h1><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">version</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--short</span></span>
<span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">get</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">nodes</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">version</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--short</span></span>
<span class="line"><span style="color:#6F42C1;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">get</span><span style="color:#24292E;"> </span><span style="color:#032F62;">nodes</span></span></code></pre></div><p>之后清理旧的资源</p>`,65),p=[n];function t(r,c,i,d,y,E){return a(),l("div",null,p)}const F=s(o,[["render",t]]);export{h as __pageData,F as default};
