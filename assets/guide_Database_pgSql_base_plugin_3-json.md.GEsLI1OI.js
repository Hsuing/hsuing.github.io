import{_ as s,o as n,c as a,R as o}from"./chunks/framework.zUbWieqp.js";const i=JSON.parse('{"title":"1,json","description":"","frontmatter":{},"headers":[],"relativePath":"guide/Database/pgSql/base/plugin/3-json.md","filePath":"guide/Database/pgSql/base/plugin/3-json.md","lastUpdated":1711694969000}'),p={name:"guide/Database/pgSql/base/plugin/3-json.md"},l=o(`<h1 id="_1-json" tabindex="-1">1,json <a class="header-anchor" href="#_1-json" aria-label="Permalink to &quot;1,json&quot;">​</a></h1><p>Json与Jsonb</p><blockquote><p>[!WARNING]</p><p>PG里json是文本方式存储; PG里jsonb是二进制存储，存储时会删除空格以及重复的键值对(保留后插入的键值); PG里jsonb存储时已经解析好了结构，也支持索引，所有键值对已排好序; PG里jsonb的操作有丰富的原生函数，以jsonb开头</p></blockquote><p>Jsquery</p><blockquote><p>[!WARNING]</p><p>JsQuery是PG里的一个扩展，支持json的查询，使用GIN索引; <a href="https://github.com/postgrespro/jsquery" target="_blank" rel="noreferrer">https://github.com/postgrespro/jsquery</a></p></blockquote><p>SQL/JSON Path Language</p><blockquote><p>[!WARNING]</p><p>PG12支持，基于Json元素的复杂SQL查询; <a href="https://www.postgresql.org/docs/12/functions-json.html#FUNCTIONS-SQLJSON-PATH" target="_blank" rel="noreferrer">https://www.postgresql.org/docs/12/functions-json.html#FUNCTIONS-SQLJSON-PATH</a></p></blockquote><p>如何选择？</p><p>PG12直接用的Json Path特性，原生的函数支持非常丰富; PG12以下版本有复杂的json查询可以使用Jsquery扩展</p><h2 id="_1-使用json数据类型" tabindex="-1">1. 使用json数据类型 <a class="header-anchor" href="#_1-使用json数据类型" aria-label="Permalink to &quot;1. 使用json数据类型&quot;">​</a></h2><p>使用json数据类型的好处是结构比较灵活，同时PG里也有很多相关的函数和操作符。 适合场景：比如大屏数据监控展示，监控指标可灵活增删，指标项内容也可以随时扩充，结合ajax异步刷新，中间应用层无感</p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">postgres</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"># </span><span style="color:#F97583;">create</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">table</span><span style="color:#E1E4E8;"> test_json(id </span><span style="color:#F97583;">int</span><span style="color:#E1E4E8;">,info </span><span style="color:#F97583;">json</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#F97583;">CREATE</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">TABLE</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">插入一条数据</span></span>
<span class="line"><span style="color:#E1E4E8;">postgres</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"># </span><span style="color:#F97583;">insert into</span><span style="color:#E1E4E8;"> test_json </span></span>
<span class="line"><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">values</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">,</span><span style="color:#9ECBFF;">&#39;{&quot;name&quot;:&quot;jerome&quot;,&quot;familyName&quot;:&quot;peng&quot;,&quot;company&quot;:&quot;enmotech&quot;}&#39;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#F97583;">INSERT</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">1</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">查询第一条记录里json类型里的某一个key的value值</span></span>
<span class="line"><span style="color:#E1E4E8;">postgres</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"># </span><span style="color:#F97583;">select</span><span style="color:#E1E4E8;"> info </span><span style="color:#F97583;">-&gt;&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;company&#39;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> test_json </span><span style="color:#F97583;">where</span><span style="color:#E1E4E8;"> id</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;"> ;</span></span>
<span class="line"><span style="color:#E1E4E8;"> ?column? </span></span>
<span class="line"><span style="color:#6A737D;">----------</span></span>
<span class="line"><span style="color:#E1E4E8;"> enmotech</span></span>
<span class="line"><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">row</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">返回json对象用 </span><span style="color:#F97583;">-&gt;&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">返回文本值用 </span><span style="color:#F97583;">-&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">按路径查询</span></span>
<span class="line"><span style="color:#9ECBFF;">&#39;{&quot;a&quot;: {&quot;b&quot;:{&quot;c&quot;: &quot;foo&quot;}}}&#39;</span><span style="color:#E1E4E8;">::</span><span style="color:#F97583;">json</span><span style="color:#E1E4E8;"> #</span><span style="color:#F97583;">&gt;&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;{a,b}&#39;</span></span>
<span class="line"><span style="color:#E1E4E8;">postgres</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"># </span><span style="color:#F97583;">select</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;{&quot;a&quot;: {&quot;b&quot;:{&quot;c&quot;: &quot;foo&quot;}}}&#39;</span><span style="color:#E1E4E8;">::</span><span style="color:#F97583;">json</span><span style="color:#E1E4E8;"> #</span><span style="color:#F97583;">&gt;&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;{a,b}&#39;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">   ?column?   </span></span>
<span class="line"><span style="color:#6A737D;">--------------</span></span>
<span class="line"><span style="color:#E1E4E8;"> {</span><span style="color:#9ECBFF;">&quot;c&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;foo&quot;</span><span style="color:#E1E4E8;">}</span></span>
<span class="line"><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">row</span><span style="color:#E1E4E8;">)</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">postgres</span><span style="color:#D73A49;">=</span><span style="color:#24292E;"># </span><span style="color:#D73A49;">create</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">table</span><span style="color:#24292E;"> test_json(id </span><span style="color:#D73A49;">int</span><span style="color:#24292E;">,info </span><span style="color:#D73A49;">json</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#D73A49;">CREATE</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">TABLE</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">插入一条数据</span></span>
<span class="line"><span style="color:#24292E;">postgres</span><span style="color:#D73A49;">=</span><span style="color:#24292E;"># </span><span style="color:#D73A49;">insert into</span><span style="color:#24292E;"> test_json </span></span>
<span class="line"><span style="color:#24292E;"> </span><span style="color:#D73A49;">values</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">1</span><span style="color:#24292E;">,</span><span style="color:#032F62;">&#39;{&quot;name&quot;:&quot;jerome&quot;,&quot;familyName&quot;:&quot;peng&quot;,&quot;company&quot;:&quot;enmotech&quot;}&#39;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#D73A49;">INSERT</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">查询第一条记录里json类型里的某一个key的value值</span></span>
<span class="line"><span style="color:#24292E;">postgres</span><span style="color:#D73A49;">=</span><span style="color:#24292E;"># </span><span style="color:#D73A49;">select</span><span style="color:#24292E;"> info </span><span style="color:#D73A49;">-&gt;&gt;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;company&#39;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">from</span><span style="color:#24292E;"> test_json </span><span style="color:#D73A49;">where</span><span style="color:#24292E;"> id</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">1</span><span style="color:#24292E;"> ;</span></span>
<span class="line"><span style="color:#24292E;"> ?column? </span></span>
<span class="line"><span style="color:#6A737D;">----------</span></span>
<span class="line"><span style="color:#24292E;"> enmotech</span></span>
<span class="line"><span style="color:#24292E;">(</span><span style="color:#005CC5;">1</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">row</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">返回json对象用 </span><span style="color:#D73A49;">-&gt;&gt;</span></span>
<span class="line"><span style="color:#24292E;">返回文本值用 </span><span style="color:#D73A49;">-&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">按路径查询</span></span>
<span class="line"><span style="color:#032F62;">&#39;{&quot;a&quot;: {&quot;b&quot;:{&quot;c&quot;: &quot;foo&quot;}}}&#39;</span><span style="color:#24292E;">::</span><span style="color:#D73A49;">json</span><span style="color:#24292E;"> #</span><span style="color:#D73A49;">&gt;&gt;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;{a,b}&#39;</span></span>
<span class="line"><span style="color:#24292E;">postgres</span><span style="color:#D73A49;">=</span><span style="color:#24292E;"># </span><span style="color:#D73A49;">select</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;{&quot;a&quot;: {&quot;b&quot;:{&quot;c&quot;: &quot;foo&quot;}}}&#39;</span><span style="color:#24292E;">::</span><span style="color:#D73A49;">json</span><span style="color:#24292E;"> #</span><span style="color:#D73A49;">&gt;&gt;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;{a,b}&#39;</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">   ?column?   </span></span>
<span class="line"><span style="color:#6A737D;">--------------</span></span>
<span class="line"><span style="color:#24292E;"> {</span><span style="color:#032F62;">&quot;c&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;foo&quot;</span><span style="color:#24292E;">}</span></span>
<span class="line"><span style="color:#24292E;">(</span><span style="color:#005CC5;">1</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">row</span><span style="color:#24292E;">)</span></span></code></pre></div><h2 id="_2-使用jsonb数据类型" tabindex="-1">2. 使用jsonb数据类型 <a class="header-anchor" href="#_2-使用jsonb数据类型" aria-label="Permalink to &quot;2. 使用jsonb数据类型&quot;">​</a></h2><p>使用jsonb数据类型的好处是后续处理快（插入时慢，需要做解析），但不保证插入时的键值顺序，插入解析时做了去除空格、重复键删除的处理</p><p>某些场景不适合使用jsonb而应该用json，例如对所有键值对做Hash，传输后做验证需要保证键的顺序</p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">postgres</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"># </span><span style="color:#F97583;">create</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">table</span><span style="color:#E1E4E8;"> test_jsonb(id </span><span style="color:#F97583;">int</span><span style="color:#E1E4E8;">,info jsonb);</span></span>
<span class="line"><span style="color:#F97583;">CREATE</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">TABLE</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">插入一条数据</span></span>
<span class="line"><span style="color:#E1E4E8;">postgres</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"># </span><span style="color:#F97583;">insert into</span><span style="color:#E1E4E8;"> test_jsonb </span></span>
<span class="line"><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">values</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">,</span><span style="color:#9ECBFF;">&#39;{&quot;company&quot;:&quot;enmotech&quot;,  &quot;name&quot;:&quot;jerome&quot;,&quot;name&quot;:&quot;peng&quot;,&quot;career&quot;:&quot;a dba&quot;}&#39;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#F97583;">INSERT</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">1</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">下面查询结果可以看到jsonb类型做了优化处理</span></span>
<span class="line"><span style="color:#E1E4E8;">删除了空格和重复键，同时做了排序(先根据键的长度排序，再根据键排序)</span></span>
<span class="line"><span style="color:#E1E4E8;">postgres</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"># </span><span style="color:#F97583;">select</span><span style="color:#E1E4E8;"> info </span><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> test_jsonb;</span></span>
<span class="line"><span style="color:#E1E4E8;">                            info                            </span></span>
<span class="line"><span style="color:#6A737D;">------------------------------------------------------------</span></span>
<span class="line"><span style="color:#E1E4E8;"> {</span><span style="color:#9ECBFF;">&quot;name&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;peng&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&quot;career&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;a dba&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&quot;company&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;enmotech&quot;</span><span style="color:#E1E4E8;">}</span></span>
<span class="line"><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">row</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">包含查询</span></span>
<span class="line"><span style="color:#E1E4E8;">postgres</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"># </span><span style="color:#F97583;">select</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> test_jsonb </span></span>
<span class="line"><span style="color:#F97583;">where</span><span style="color:#E1E4E8;"> info @</span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;{&quot;company&quot;:&quot;enmotech&quot;}&#39;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;"> id |                            info                            </span></span>
<span class="line"><span style="color:#6A737D;">----+------------------------------------------------------------</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;"> | {</span><span style="color:#9ECBFF;">&quot;name&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;peng&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&quot;career&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;a dba&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&quot;company&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;enmotech&quot;</span><span style="color:#E1E4E8;">}</span></span>
<span class="line"><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">row</span><span style="color:#E1E4E8;">)</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">postgres</span><span style="color:#D73A49;">=</span><span style="color:#24292E;"># </span><span style="color:#D73A49;">create</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">table</span><span style="color:#24292E;"> test_jsonb(id </span><span style="color:#D73A49;">int</span><span style="color:#24292E;">,info jsonb);</span></span>
<span class="line"><span style="color:#D73A49;">CREATE</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">TABLE</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">插入一条数据</span></span>
<span class="line"><span style="color:#24292E;">postgres</span><span style="color:#D73A49;">=</span><span style="color:#24292E;"># </span><span style="color:#D73A49;">insert into</span><span style="color:#24292E;"> test_jsonb </span></span>
<span class="line"><span style="color:#24292E;"> </span><span style="color:#D73A49;">values</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">1</span><span style="color:#24292E;">,</span><span style="color:#032F62;">&#39;{&quot;company&quot;:&quot;enmotech&quot;,  &quot;name&quot;:&quot;jerome&quot;,&quot;name&quot;:&quot;peng&quot;,&quot;career&quot;:&quot;a dba&quot;}&#39;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#D73A49;">INSERT</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">下面查询结果可以看到jsonb类型做了优化处理</span></span>
<span class="line"><span style="color:#24292E;">删除了空格和重复键，同时做了排序(先根据键的长度排序，再根据键排序)</span></span>
<span class="line"><span style="color:#24292E;">postgres</span><span style="color:#D73A49;">=</span><span style="color:#24292E;"># </span><span style="color:#D73A49;">select</span><span style="color:#24292E;"> info </span><span style="color:#D73A49;">from</span><span style="color:#24292E;"> test_jsonb;</span></span>
<span class="line"><span style="color:#24292E;">                            info                            </span></span>
<span class="line"><span style="color:#6A737D;">------------------------------------------------------------</span></span>
<span class="line"><span style="color:#24292E;"> {</span><span style="color:#032F62;">&quot;name&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;peng&quot;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;career&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;a dba&quot;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;company&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;enmotech&quot;</span><span style="color:#24292E;">}</span></span>
<span class="line"><span style="color:#24292E;">(</span><span style="color:#005CC5;">1</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">row</span><span style="color:#24292E;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">包含查询</span></span>
<span class="line"><span style="color:#24292E;">postgres</span><span style="color:#D73A49;">=</span><span style="color:#24292E;"># </span><span style="color:#D73A49;">select</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">*</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">from</span><span style="color:#24292E;"> test_jsonb </span></span>
<span class="line"><span style="color:#D73A49;">where</span><span style="color:#24292E;"> info @</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;{&quot;company&quot;:&quot;enmotech&quot;}&#39;</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;"> id |                            info                            </span></span>
<span class="line"><span style="color:#6A737D;">----+------------------------------------------------------------</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#005CC5;">1</span><span style="color:#24292E;"> | {</span><span style="color:#032F62;">&quot;name&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;peng&quot;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;career&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;a dba&quot;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;company&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;enmotech&quot;</span><span style="color:#24292E;">}</span></span>
<span class="line"><span style="color:#24292E;">(</span><span style="color:#005CC5;">1</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">row</span><span style="color:#24292E;">)</span></span></code></pre></div><h2 id="_3-使用json-path" tabindex="-1">3. 使用json path <a class="header-anchor" href="#_3-使用json-path" aria-label="Permalink to &quot;3. 使用json path&quot;">​</a></h2><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">postgres</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"># </span><span style="color:#F97583;">create</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">table</span><span style="color:#E1E4E8;"> test_jsonpath(id </span><span style="color:#F97583;">int</span><span style="color:#E1E4E8;">,info jsonb);</span></span>
<span class="line"><span style="color:#F97583;">CREATE</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">TABLE</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">insert into</span><span style="color:#E1E4E8;"> test_jsonpath</span></span>
<span class="line"><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">values</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">,</span><span style="color:#9ECBFF;">&#39;{&quot;a1&quot;:&quot;eggs&quot;}&#39;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#F97583;">insert into</span><span style="color:#E1E4E8;"> test_jsonpath</span></span>
<span class="line"><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">values</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">2</span><span style="color:#E1E4E8;">,</span><span style="color:#9ECBFF;">&#39;{&quot;a1&quot;:&quot;egg&quot;}&#39;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#F97583;">insert into</span><span style="color:#E1E4E8;"> test_jsonpath</span></span>
<span class="line"><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">values</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">3</span><span style="color:#E1E4E8;">,</span><span style="color:#9ECBFF;">&#39;{&quot;a1&quot;:&quot;abc&quot;,&quot;b1&quot;:&quot;eggs&quot;}&#39;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#F97583;">insert into</span><span style="color:#E1E4E8;"> test_jsonpath</span></span>
<span class="line"><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">values</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">4</span><span style="color:#E1E4E8;">,</span><span style="color:#9ECBFF;">&#39;{&quot;a1&quot;:&quot;abc&quot;,&quot;b1&quot;:&quot;egg&quot;}&#39;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#F97583;">insert into</span><span style="color:#E1E4E8;"> test_jsonpath</span></span>
<span class="line"><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">values</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">5</span><span style="color:#E1E4E8;">,</span><span style="color:#9ECBFF;">&#39;{&quot;a1&quot;:{&quot;a2&quot;: &quot;eggs&quot;}}&#39;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#F97583;">insert into</span><span style="color:#E1E4E8;"> test_jsonpath</span></span>
<span class="line"><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">values</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">6</span><span style="color:#E1E4E8;">,</span><span style="color:#9ECBFF;">&#39;{&quot;a1&quot;:{&quot;a2&quot;: &quot;egg&quot;}}&#39;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#F97583;">insert into</span><span style="color:#E1E4E8;"> test_jsonpath</span></span>
<span class="line"><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">values</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">7</span><span style="color:#E1E4E8;">,</span><span style="color:#9ECBFF;">&#39;{&quot;a1&quot;:{&quot;a2&quot;: [&quot;eg&quot;,&quot;eggs&quot;]}}&#39;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#F97583;">insert into</span><span style="color:#E1E4E8;"> test_jsonpath</span></span>
<span class="line"><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">values</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">8</span><span style="color:#E1E4E8;">,</span><span style="color:#9ECBFF;">&#39;{&quot;a1&quot;:{&quot;a2&quot;: [&quot;eg&quot;,&quot;egg&quot;,&quot;gg&quot;]}}&#39;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">上面设计id为偶数的行包含全匹配关键字egg </span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">顶层关键字全匹配</span></span>
<span class="line"><span style="color:#E1E4E8;">postgres</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"># </span><span style="color:#F97583;">select</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> test_jsonpath </span></span>
<span class="line"><span style="color:#F97583;">where</span><span style="color:#E1E4E8;"> info @? </span><span style="color:#9ECBFF;">&#39;$ ? (@.* == &quot;egg&quot;)&#39;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;"> id |            info            </span></span>
<span class="line"><span style="color:#6A737D;">----+----------------------------</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">2</span><span style="color:#E1E4E8;"> | {</span><span style="color:#9ECBFF;">&quot;a1&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;egg&quot;</span><span style="color:#E1E4E8;">}</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">4</span><span style="color:#E1E4E8;"> | {</span><span style="color:#9ECBFF;">&quot;a1&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;abc&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&quot;b1&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;egg&quot;</span><span style="color:#E1E4E8;">}</span></span>
<span class="line"><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">2</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">rows</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">顶层关键字模糊查询</span></span>
<span class="line"><span style="color:#E1E4E8;">postgres</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"># </span><span style="color:#F97583;">select</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> test_jsonpath </span></span>
<span class="line"><span style="color:#F97583;">where</span><span style="color:#E1E4E8;"> info @? </span><span style="color:#9ECBFF;">&#39;$ ? (@.* like_regex &quot;egg&quot;)&#39;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;"> id |            info             </span></span>
<span class="line"><span style="color:#6A737D;">----+-----------------------------</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;"> | {</span><span style="color:#9ECBFF;">&quot;a1&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;eggs&quot;</span><span style="color:#E1E4E8;">}</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">2</span><span style="color:#E1E4E8;"> | {</span><span style="color:#9ECBFF;">&quot;a1&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;egg&quot;</span><span style="color:#E1E4E8;">}</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">3</span><span style="color:#E1E4E8;"> | {</span><span style="color:#9ECBFF;">&quot;a1&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;abc&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&quot;b1&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;eggs&quot;</span><span style="color:#E1E4E8;">}</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">4</span><span style="color:#E1E4E8;"> | {</span><span style="color:#9ECBFF;">&quot;a1&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;abc&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&quot;b1&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;egg&quot;</span><span style="color:#E1E4E8;">}</span></span>
<span class="line"><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">4</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">rows</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">顶层匹配及所有层级关键字全匹配</span></span>
<span class="line"><span style="color:#E1E4E8;">postgres</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"># </span><span style="color:#F97583;">select</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> test_jsonpath </span></span>
<span class="line"><span style="color:#F97583;">where</span><span style="color:#E1E4E8;"> info @? </span><span style="color:#9ECBFF;">&#39;$ ? (@.** == &quot;egg&quot;)&#39;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;"> id |                info                 </span></span>
<span class="line"><span style="color:#6A737D;">----+-------------------------------------</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">2</span><span style="color:#E1E4E8;"> | {</span><span style="color:#9ECBFF;">&quot;a1&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;egg&quot;</span><span style="color:#E1E4E8;">}</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">4</span><span style="color:#E1E4E8;"> | {</span><span style="color:#9ECBFF;">&quot;a1&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;abc&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&quot;b1&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;egg&quot;</span><span style="color:#E1E4E8;">}</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">6</span><span style="color:#E1E4E8;"> | {</span><span style="color:#9ECBFF;">&quot;a1&quot;</span><span style="color:#E1E4E8;">: {</span><span style="color:#9ECBFF;">&quot;a2&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;egg&quot;</span><span style="color:#E1E4E8;">}}</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">8</span><span style="color:#E1E4E8;"> | {</span><span style="color:#9ECBFF;">&quot;a1&quot;</span><span style="color:#E1E4E8;">: {</span><span style="color:#9ECBFF;">&quot;a2&quot;</span><span style="color:#E1E4E8;">: [&quot;eg&quot;, &quot;egg&quot;, &quot;gg&quot;]}}</span></span>
<span class="line"><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">4</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">rows</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">或者使用下面的函数</span></span>
<span class="line"><span style="color:#F97583;">select</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> test_jsonpath</span></span>
<span class="line"><span style="color:#F97583;">where</span><span style="color:#E1E4E8;"> jsonb_path_exists(info, </span><span style="color:#9ECBFF;">&#39;$ ? (@.** == &quot;egg&quot;)&#39;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">模糊查询</span></span>
<span class="line"><span style="color:#E1E4E8;">postgres</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"># </span><span style="color:#F97583;">select</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> test_jsonpath</span></span>
<span class="line"><span style="color:#F97583;">where</span><span style="color:#E1E4E8;"> jsonb_path_exists(info, </span><span style="color:#9ECBFF;">&#39;$ ? (@.** like_regex &quot;eggs&quot;)&#39;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;"> id |              info              </span></span>
<span class="line"><span style="color:#6A737D;">----+--------------------------------</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;"> | {</span><span style="color:#9ECBFF;">&quot;a1&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;eggs&quot;</span><span style="color:#E1E4E8;">}</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">3</span><span style="color:#E1E4E8;"> | {</span><span style="color:#9ECBFF;">&quot;a1&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;abc&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&quot;b1&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;eggs&quot;</span><span style="color:#E1E4E8;">}</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">5</span><span style="color:#E1E4E8;"> | {</span><span style="color:#9ECBFF;">&quot;a1&quot;</span><span style="color:#E1E4E8;">: {</span><span style="color:#9ECBFF;">&quot;a2&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;eggs&quot;</span><span style="color:#E1E4E8;">}}</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">7</span><span style="color:#E1E4E8;"> | {</span><span style="color:#9ECBFF;">&quot;a1&quot;</span><span style="color:#E1E4E8;">: {</span><span style="color:#9ECBFF;">&quot;a2&quot;</span><span style="color:#E1E4E8;">: [&quot;eg&quot;, &quot;eggs&quot;]}}</span></span>
<span class="line"><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">4</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">rows</span><span style="color:#E1E4E8;">)</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">postgres</span><span style="color:#D73A49;">=</span><span style="color:#24292E;"># </span><span style="color:#D73A49;">create</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">table</span><span style="color:#24292E;"> test_jsonpath(id </span><span style="color:#D73A49;">int</span><span style="color:#24292E;">,info jsonb);</span></span>
<span class="line"><span style="color:#D73A49;">CREATE</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">TABLE</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">insert into</span><span style="color:#24292E;"> test_jsonpath</span></span>
<span class="line"><span style="color:#24292E;"> </span><span style="color:#D73A49;">values</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">1</span><span style="color:#24292E;">,</span><span style="color:#032F62;">&#39;{&quot;a1&quot;:&quot;eggs&quot;}&#39;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#D73A49;">insert into</span><span style="color:#24292E;"> test_jsonpath</span></span>
<span class="line"><span style="color:#24292E;"> </span><span style="color:#D73A49;">values</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">2</span><span style="color:#24292E;">,</span><span style="color:#032F62;">&#39;{&quot;a1&quot;:&quot;egg&quot;}&#39;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#D73A49;">insert into</span><span style="color:#24292E;"> test_jsonpath</span></span>
<span class="line"><span style="color:#24292E;"> </span><span style="color:#D73A49;">values</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">3</span><span style="color:#24292E;">,</span><span style="color:#032F62;">&#39;{&quot;a1&quot;:&quot;abc&quot;,&quot;b1&quot;:&quot;eggs&quot;}&#39;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#D73A49;">insert into</span><span style="color:#24292E;"> test_jsonpath</span></span>
<span class="line"><span style="color:#24292E;"> </span><span style="color:#D73A49;">values</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">4</span><span style="color:#24292E;">,</span><span style="color:#032F62;">&#39;{&quot;a1&quot;:&quot;abc&quot;,&quot;b1&quot;:&quot;egg&quot;}&#39;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#D73A49;">insert into</span><span style="color:#24292E;"> test_jsonpath</span></span>
<span class="line"><span style="color:#24292E;"> </span><span style="color:#D73A49;">values</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">5</span><span style="color:#24292E;">,</span><span style="color:#032F62;">&#39;{&quot;a1&quot;:{&quot;a2&quot;: &quot;eggs&quot;}}&#39;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#D73A49;">insert into</span><span style="color:#24292E;"> test_jsonpath</span></span>
<span class="line"><span style="color:#24292E;"> </span><span style="color:#D73A49;">values</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">6</span><span style="color:#24292E;">,</span><span style="color:#032F62;">&#39;{&quot;a1&quot;:{&quot;a2&quot;: &quot;egg&quot;}}&#39;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#D73A49;">insert into</span><span style="color:#24292E;"> test_jsonpath</span></span>
<span class="line"><span style="color:#24292E;"> </span><span style="color:#D73A49;">values</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">7</span><span style="color:#24292E;">,</span><span style="color:#032F62;">&#39;{&quot;a1&quot;:{&quot;a2&quot;: [&quot;eg&quot;,&quot;eggs&quot;]}}&#39;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#D73A49;">insert into</span><span style="color:#24292E;"> test_jsonpath</span></span>
<span class="line"><span style="color:#24292E;"> </span><span style="color:#D73A49;">values</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">8</span><span style="color:#24292E;">,</span><span style="color:#032F62;">&#39;{&quot;a1&quot;:{&quot;a2&quot;: [&quot;eg&quot;,&quot;egg&quot;,&quot;gg&quot;]}}&#39;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">上面设计id为偶数的行包含全匹配关键字egg </span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">顶层关键字全匹配</span></span>
<span class="line"><span style="color:#24292E;">postgres</span><span style="color:#D73A49;">=</span><span style="color:#24292E;"># </span><span style="color:#D73A49;">select</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">*</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">from</span><span style="color:#24292E;"> test_jsonpath </span></span>
<span class="line"><span style="color:#D73A49;">where</span><span style="color:#24292E;"> info @? </span><span style="color:#032F62;">&#39;$ ? (@.* == &quot;egg&quot;)&#39;</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;"> id |            info            </span></span>
<span class="line"><span style="color:#6A737D;">----+----------------------------</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#005CC5;">2</span><span style="color:#24292E;"> | {</span><span style="color:#032F62;">&quot;a1&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;egg&quot;</span><span style="color:#24292E;">}</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#005CC5;">4</span><span style="color:#24292E;"> | {</span><span style="color:#032F62;">&quot;a1&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;abc&quot;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;b1&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;egg&quot;</span><span style="color:#24292E;">}</span></span>
<span class="line"><span style="color:#24292E;">(</span><span style="color:#005CC5;">2</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">rows</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">顶层关键字模糊查询</span></span>
<span class="line"><span style="color:#24292E;">postgres</span><span style="color:#D73A49;">=</span><span style="color:#24292E;"># </span><span style="color:#D73A49;">select</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">*</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">from</span><span style="color:#24292E;"> test_jsonpath </span></span>
<span class="line"><span style="color:#D73A49;">where</span><span style="color:#24292E;"> info @? </span><span style="color:#032F62;">&#39;$ ? (@.* like_regex &quot;egg&quot;)&#39;</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;"> id |            info             </span></span>
<span class="line"><span style="color:#6A737D;">----+-----------------------------</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#005CC5;">1</span><span style="color:#24292E;"> | {</span><span style="color:#032F62;">&quot;a1&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;eggs&quot;</span><span style="color:#24292E;">}</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#005CC5;">2</span><span style="color:#24292E;"> | {</span><span style="color:#032F62;">&quot;a1&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;egg&quot;</span><span style="color:#24292E;">}</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#005CC5;">3</span><span style="color:#24292E;"> | {</span><span style="color:#032F62;">&quot;a1&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;abc&quot;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;b1&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;eggs&quot;</span><span style="color:#24292E;">}</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#005CC5;">4</span><span style="color:#24292E;"> | {</span><span style="color:#032F62;">&quot;a1&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;abc&quot;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;b1&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;egg&quot;</span><span style="color:#24292E;">}</span></span>
<span class="line"><span style="color:#24292E;">(</span><span style="color:#005CC5;">4</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">rows</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">顶层匹配及所有层级关键字全匹配</span></span>
<span class="line"><span style="color:#24292E;">postgres</span><span style="color:#D73A49;">=</span><span style="color:#24292E;"># </span><span style="color:#D73A49;">select</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">*</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">from</span><span style="color:#24292E;"> test_jsonpath </span></span>
<span class="line"><span style="color:#D73A49;">where</span><span style="color:#24292E;"> info @? </span><span style="color:#032F62;">&#39;$ ? (@.** == &quot;egg&quot;)&#39;</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;"> id |                info                 </span></span>
<span class="line"><span style="color:#6A737D;">----+-------------------------------------</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#005CC5;">2</span><span style="color:#24292E;"> | {</span><span style="color:#032F62;">&quot;a1&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;egg&quot;</span><span style="color:#24292E;">}</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#005CC5;">4</span><span style="color:#24292E;"> | {</span><span style="color:#032F62;">&quot;a1&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;abc&quot;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;b1&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;egg&quot;</span><span style="color:#24292E;">}</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#005CC5;">6</span><span style="color:#24292E;"> | {</span><span style="color:#032F62;">&quot;a1&quot;</span><span style="color:#24292E;">: {</span><span style="color:#032F62;">&quot;a2&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;egg&quot;</span><span style="color:#24292E;">}}</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#005CC5;">8</span><span style="color:#24292E;"> | {</span><span style="color:#032F62;">&quot;a1&quot;</span><span style="color:#24292E;">: {</span><span style="color:#032F62;">&quot;a2&quot;</span><span style="color:#24292E;">: [&quot;eg&quot;, &quot;egg&quot;, &quot;gg&quot;]}}</span></span>
<span class="line"><span style="color:#24292E;">(</span><span style="color:#005CC5;">4</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">rows</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">或者使用下面的函数</span></span>
<span class="line"><span style="color:#D73A49;">select</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">*</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">from</span><span style="color:#24292E;"> test_jsonpath</span></span>
<span class="line"><span style="color:#D73A49;">where</span><span style="color:#24292E;"> jsonb_path_exists(info, </span><span style="color:#032F62;">&#39;$ ? (@.** == &quot;egg&quot;)&#39;</span><span style="color:#24292E;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">模糊查询</span></span>
<span class="line"><span style="color:#24292E;">postgres</span><span style="color:#D73A49;">=</span><span style="color:#24292E;"># </span><span style="color:#D73A49;">select</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">*</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">from</span><span style="color:#24292E;"> test_jsonpath</span></span>
<span class="line"><span style="color:#D73A49;">where</span><span style="color:#24292E;"> jsonb_path_exists(info, </span><span style="color:#032F62;">&#39;$ ? (@.** like_regex &quot;eggs&quot;)&#39;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;"> id |              info              </span></span>
<span class="line"><span style="color:#6A737D;">----+--------------------------------</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#005CC5;">1</span><span style="color:#24292E;"> | {</span><span style="color:#032F62;">&quot;a1&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;eggs&quot;</span><span style="color:#24292E;">}</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#005CC5;">3</span><span style="color:#24292E;"> | {</span><span style="color:#032F62;">&quot;a1&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;abc&quot;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;b1&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;eggs&quot;</span><span style="color:#24292E;">}</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#005CC5;">5</span><span style="color:#24292E;"> | {</span><span style="color:#032F62;">&quot;a1&quot;</span><span style="color:#24292E;">: {</span><span style="color:#032F62;">&quot;a2&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;eggs&quot;</span><span style="color:#24292E;">}}</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#005CC5;">7</span><span style="color:#24292E;"> | {</span><span style="color:#032F62;">&quot;a1&quot;</span><span style="color:#24292E;">: {</span><span style="color:#032F62;">&quot;a2&quot;</span><span style="color:#24292E;">: [&quot;eg&quot;, &quot;eggs&quot;]}}</span></span>
<span class="line"><span style="color:#24292E;">(</span><span style="color:#005CC5;">4</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">rows</span><span style="color:#24292E;">)</span></span></code></pre></div><h2 id="_4-使用jsquery" tabindex="-1">4. 使用jsquery <a class="header-anchor" href="#_4-使用jsquery" aria-label="Permalink to &quot;4. 使用jsquery&quot;">​</a></h2><p>PG12以下，9.4及以上版本可以安装jsquery扩展进行复杂查询</p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">$ git clone https:</span><span style="color:#F97583;">//</span><span style="color:#79B8FF;">github</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">com</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">postgrespro</span><span style="color:#F97583;">/</span><span style="color:#79B8FF;">jsquery</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">git</span></span>
<span class="line"><span style="color:#E1E4E8;">$ cd jsquery</span></span>
<span class="line"><span style="color:#E1E4E8;">$ make USE_PGXS</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;"> PG_CONFIG</span><span style="color:#F97583;">=/</span><span style="color:#E1E4E8;">opt</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">pgsql</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">bin</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">pg_config</span></span>
<span class="line"><span style="color:#E1E4E8;">$ make USE_PGXS</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;"> PG_CONFIG</span><span style="color:#F97583;">=/</span><span style="color:#E1E4E8;">opt</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">pgsql</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">bin</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">pg_config install</span></span>
<span class="line"><span style="color:#E1E4E8;">$ psql</span></span>
<span class="line"><span style="color:#E1E4E8;">postgres</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"># </span><span style="color:#F97583;">create</span><span style="color:#E1E4E8;"> extension jsquery ;</span></span>
<span class="line"><span style="color:#F97583;">CREATE</span><span style="color:#E1E4E8;"> EXTENSION</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">上面的查询使用jsquery</span></span>
<span class="line"><span style="color:#E1E4E8;">postgres</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"># </span><span style="color:#F97583;">select</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> test_jsonpath</span></span>
<span class="line"><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">where</span><span style="color:#E1E4E8;"> info @@ </span><span style="color:#9ECBFF;">&#39;* = &quot;egg&quot;&#39;</span><span style="color:#E1E4E8;">::jsquery;</span></span>
<span class="line"><span style="color:#E1E4E8;"> id |                info                 </span></span>
<span class="line"><span style="color:#6A737D;">----+-------------------------------------</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">2</span><span style="color:#E1E4E8;"> | {</span><span style="color:#9ECBFF;">&quot;a1&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;egg&quot;</span><span style="color:#E1E4E8;">}</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">4</span><span style="color:#E1E4E8;"> | {</span><span style="color:#9ECBFF;">&quot;a1&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;abc&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&quot;b1&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;egg&quot;</span><span style="color:#E1E4E8;">}</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">6</span><span style="color:#E1E4E8;"> | {</span><span style="color:#9ECBFF;">&quot;a1&quot;</span><span style="color:#E1E4E8;">: {</span><span style="color:#9ECBFF;">&quot;a2&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;egg&quot;</span><span style="color:#E1E4E8;">}}</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">8</span><span style="color:#E1E4E8;"> | {</span><span style="color:#9ECBFF;">&quot;a1&quot;</span><span style="color:#E1E4E8;">: {</span><span style="color:#9ECBFF;">&quot;a2&quot;</span><span style="color:#E1E4E8;">: [&quot;eg&quot;, &quot;egg&quot;, &quot;gg&quot;]}}</span></span>
<span class="line"><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">4</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">rows</span><span style="color:#E1E4E8;">)</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">$ git clone https:</span><span style="color:#D73A49;">//</span><span style="color:#005CC5;">github</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">com</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">postgrespro</span><span style="color:#D73A49;">/</span><span style="color:#005CC5;">jsquery</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">git</span></span>
<span class="line"><span style="color:#24292E;">$ cd jsquery</span></span>
<span class="line"><span style="color:#24292E;">$ make USE_PGXS</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">1</span><span style="color:#24292E;"> PG_CONFIG</span><span style="color:#D73A49;">=/</span><span style="color:#24292E;">opt</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">pgsql</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">bin</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">pg_config</span></span>
<span class="line"><span style="color:#24292E;">$ make USE_PGXS</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">1</span><span style="color:#24292E;"> PG_CONFIG</span><span style="color:#D73A49;">=/</span><span style="color:#24292E;">opt</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">pgsql</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">bin</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">pg_config install</span></span>
<span class="line"><span style="color:#24292E;">$ psql</span></span>
<span class="line"><span style="color:#24292E;">postgres</span><span style="color:#D73A49;">=</span><span style="color:#24292E;"># </span><span style="color:#D73A49;">create</span><span style="color:#24292E;"> extension jsquery ;</span></span>
<span class="line"><span style="color:#D73A49;">CREATE</span><span style="color:#24292E;"> EXTENSION</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">上面的查询使用jsquery</span></span>
<span class="line"><span style="color:#24292E;">postgres</span><span style="color:#D73A49;">=</span><span style="color:#24292E;"># </span><span style="color:#D73A49;">select</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">*</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">from</span><span style="color:#24292E;"> test_jsonpath</span></span>
<span class="line"><span style="color:#24292E;"> </span><span style="color:#D73A49;">where</span><span style="color:#24292E;"> info @@ </span><span style="color:#032F62;">&#39;* = &quot;egg&quot;&#39;</span><span style="color:#24292E;">::jsquery;</span></span>
<span class="line"><span style="color:#24292E;"> id |                info                 </span></span>
<span class="line"><span style="color:#6A737D;">----+-------------------------------------</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#005CC5;">2</span><span style="color:#24292E;"> | {</span><span style="color:#032F62;">&quot;a1&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;egg&quot;</span><span style="color:#24292E;">}</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#005CC5;">4</span><span style="color:#24292E;"> | {</span><span style="color:#032F62;">&quot;a1&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;abc&quot;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;b1&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;egg&quot;</span><span style="color:#24292E;">}</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#005CC5;">6</span><span style="color:#24292E;"> | {</span><span style="color:#032F62;">&quot;a1&quot;</span><span style="color:#24292E;">: {</span><span style="color:#032F62;">&quot;a2&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;egg&quot;</span><span style="color:#24292E;">}}</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#005CC5;">8</span><span style="color:#24292E;"> | {</span><span style="color:#032F62;">&quot;a1&quot;</span><span style="color:#24292E;">: {</span><span style="color:#032F62;">&quot;a2&quot;</span><span style="color:#24292E;">: [&quot;eg&quot;, &quot;egg&quot;, &quot;gg&quot;]}}</span></span>
<span class="line"><span style="color:#24292E;">(</span><span style="color:#005CC5;">4</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">rows</span><span style="color:#24292E;">)</span></span></code></pre></div>`,21),t=[l];function e(c,E,r,y,u,q){return n(),a("div",null,t)}const g=s(p,[["render",e]]);export{i as __pageData,g as default};
