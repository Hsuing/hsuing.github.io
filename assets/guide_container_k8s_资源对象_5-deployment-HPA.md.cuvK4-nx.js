import{_ as s,o as n,c as a,R as l}from"./chunks/framework.zUbWieqp.js";const C=JSON.parse('{"title":"1.Deployment动态扩容","description":"","frontmatter":{},"headers":[],"relativePath":"guide/container/k8s/资源对象/5-deployment-HPA.md","filePath":"guide/container/k8s/资源对象/5-deployment-HPA.md","lastUpdated":1721309786000}'),p={name:"guide/container/k8s/资源对象/5-deployment-HPA.md"},o=l(`<p>文档，<a href="https://kubernetes.io/zh-cn/docs/tasks/run-application/horizontal-pod-autoscale/" target="_blank" rel="noreferrer">https://kubernetes.io/zh-cn/docs/tasks/run-application/horizontal-pod-autoscale/</a></p><h1 id="_1-deployment动态扩容" tabindex="-1">1.Deployment动态扩容 <a class="header-anchor" href="#_1-deployment动态扩容" aria-label="Permalink to &quot;1.Deployment动态扩容&quot;">​</a></h1><h2 id="_1-1-什么是hpa" tabindex="-1">1.1 什么是HPA <a class="header-anchor" href="#_1-1-什么是hpa" aria-label="Permalink to &quot;1.1 什么是HPA&quot;">​</a></h2><p><code>Horizontal Pod Autoscaler</code>（HPA，Pod水平自动伸缩），根据平均 CPU 利用率、平均内存利用率或你指定的任何其他自定义指标自动调整 Deployment 、ReplicaSet 或 StatefulSet 或其他类似资源，实现部署的自动扩展和缩减，让部署的规模接近于实际服务的负载。<code>HPA不适用于无法缩放的对象，例如DaemonSet</code></p><p><img src="https://nnaigos.oss-cn-hangzhou.aliyuncs.com/imgs/202404301733314.png" alt="image-20240430173337404"></p><p>实际生产中，一般使用这四类指标：</p><ul><li>Resource metrics——CPU核 和 内存利用率指标。</li><li>Pod metrics——例如网络利用率和流量。</li><li>Object metrics——特定对象的指标，比如Ingress, 可以按每秒使用请求数来扩展容器</li><li>Custom metrics——自定义监控，比如通过定义服务响应时间，当响应时间达到一定指标时自动扩容</li></ul><h2 id="_1-2-为什么要用" tabindex="-1">1.2 为什么要用 <a class="header-anchor" href="#_1-2-为什么要用" aria-label="Permalink to &quot;1.2 为什么要用&quot;">​</a></h2><p>​ 虽然通过 <code>kubectl scale</code> 命令可以实现扩缩容功能，但是这个操作需要运维人员手工进行干预，不仅可能处理不及时，而且还可能误操作导致生产事故。如果我们能够根据系统当前的运行状态自动进行扩缩容，比如当检测到某个应用负载过高时自动对其扩容，这样就可以给运维人员带来极大的方便。为此，Kubernetes 提供了一种新的资源对象：<a href="https://kubernetes.io/docs/tasks/run-application/horizontal-pod-autoscale/" target="_blank" rel="noreferrer">Horizontal Pod Autoscaling</a>（Pod 水平自动伸缩，简称 HPA），HPA 通过监控 Pod 的负载变化来确定是否需要调整 Pod 的副本数量，从而实现动态扩缩容</p><h2 id="_1-3-自动扩缩容算法" tabindex="-1">1.3 ⾃动扩缩容算法 <a class="header-anchor" href="#_1-3-自动扩缩容算法" aria-label="Permalink to &quot;1.3 ⾃动扩缩容算法&quot;">​</a></h2><p>算法：副本数 = [当前副本数 * (当前指标 / 期望指标)]</p><p><code>当前指标</code>：当前Pod已经达到了百分之多少的压⼒；</p><p><code>期望指标</code>：当Pod达到期望的指标百分⽐时就要进⾏扩容；</p><p>如，当前副本为1，当前当前指标值250%，⽽期望的指标值是50%，则副本数会翻5倍，因为 1 * (250%/50%) = 5</p><h2 id="_1-4-安装metricserver" tabindex="-1">1.4 安装MetricServer <a class="header-anchor" href="#_1-4-安装metricserver" aria-label="Permalink to &quot;1.4 安装MetricServer&quot;">​</a></h2><p>为了实现动态扩缩容，首先我们需要对 Kubernetes 集群的负载情况进行监控，Kubernetes 从 v1.8 开始提出了 <a href="https://kubernetes.io/docs/tasks/debug/debug-cluster/resource-metrics-pipeline/#metrics-api" target="_blank" rel="noreferrer">Metrics API</a> 的概念来解决这个问题</p><ul><li>下载指定yaml文件</li></ul><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">#基于k8s-1.24</span></span>
<span class="line"><span style="color:#B392F0;">wget</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">https://github.com/kubernetes-sigs/metrics-server/releases/download/metrics-server-helm-chart-3.8.2/components.yaml</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#下载最新</span></span>
<span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">apply</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-f</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">https://github.com/kubernetes-sigs/metrics-server/releases/latest/download/components.yaml</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">#基于k8s-1.24</span></span>
<span class="line"><span style="color:#6F42C1;">wget</span><span style="color:#24292E;"> </span><span style="color:#032F62;">https://github.com/kubernetes-sigs/metrics-server/releases/download/metrics-server-helm-chart-3.8.2/components.yaml</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#下载最新</span></span>
<span class="line"><span style="color:#6F42C1;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">apply</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-f</span><span style="color:#24292E;"> </span><span style="color:#032F62;">https://github.com/kubernetes-sigs/metrics-server/releases/latest/download/components.yaml</span></span></code></pre></div><ul><li>修改配置文件</li></ul><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">...</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">template</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">labels</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">k8s-app</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">metrics-server</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">containers</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      - </span><span style="color:#85E89D;">args</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">        - </span><span style="color:#9ECBFF;">--cert-dir=/tmp</span></span>
<span class="line"><span style="color:#E1E4E8;">        - </span><span style="color:#9ECBFF;">--secure-port=4443</span></span>
<span class="line"><span style="color:#E1E4E8;">        - </span><span style="color:#9ECBFF;">--kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname</span></span>
<span class="line"><span style="color:#E1E4E8;">        - </span><span style="color:#9ECBFF;">--kubelet-use-node-status-port</span></span>
<span class="line"><span style="color:#E1E4E8;">        - </span><span style="color:#9ECBFF;">--kubelet-insecure-tls</span><span style="color:#E1E4E8;">                    </span><span style="color:#6A737D;">#   加上该启动参数，不加可能会报错</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">image</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">registry.aliyuncs.com/google_containers/metrics-server:v0.6.1</span><span style="color:#E1E4E8;">   </span><span style="color:#6A737D;"># 镜像地址根据情况修改</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">imagePullPolicy</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">IfNotPresent</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">...</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">template</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">metadata</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">labels</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">k8s-app</span><span style="color:#24292E;">: </span><span style="color:#032F62;">metrics-server</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">spec</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">containers</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      - </span><span style="color:#22863A;">args</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">        - </span><span style="color:#032F62;">--cert-dir=/tmp</span></span>
<span class="line"><span style="color:#24292E;">        - </span><span style="color:#032F62;">--secure-port=4443</span></span>
<span class="line"><span style="color:#24292E;">        - </span><span style="color:#032F62;">--kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname</span></span>
<span class="line"><span style="color:#24292E;">        - </span><span style="color:#032F62;">--kubelet-use-node-status-port</span></span>
<span class="line"><span style="color:#24292E;">        - </span><span style="color:#032F62;">--kubelet-insecure-tls</span><span style="color:#24292E;">                    </span><span style="color:#6A737D;">#   加上该启动参数，不加可能会报错</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">image</span><span style="color:#24292E;">: </span><span style="color:#032F62;">registry.aliyuncs.com/google_containers/metrics-server:v0.6.1</span><span style="color:#24292E;">   </span><span style="color:#6A737D;"># 镜像地址根据情况修改</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">imagePullPolicy</span><span style="color:#24292E;">: </span><span style="color:#032F62;">IfNotPresent</span></span></code></pre></div><ul><li>安装</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">apply</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-f</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">components.yaml</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#查看</span></span>
<span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">get</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pod</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-n</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">kube-system</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">grep</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">metrics-server</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 查看node和pod资源使用情况</span></span>
<span class="line"><span style="color:#E1E4E8;">[root@kube-master </span><span style="color:#F97583;">~</span><span style="color:#E1E4E8;">]# kubectl top nodes</span></span>
<span class="line"><span style="color:#B392F0;">NAME</span><span style="color:#E1E4E8;">           </span><span style="color:#9ECBFF;">CPU</span><span style="color:#E1E4E8;">(</span><span style="color:#B392F0;">cores</span><span style="color:#E1E4E8;">)   </span><span style="color:#9ECBFF;">CPU%</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">MEMORY</span><span style="color:#E1E4E8;">(</span><span style="color:#B392F0;">bytes</span><span style="color:#E1E4E8;">)   </span><span style="color:#9ECBFF;">MEMORY%</span></span>
<span class="line"><span style="color:#B392F0;">k8s-master01</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">296</span><span style="color:#9ECBFF;">m</span><span style="color:#E1E4E8;">         </span><span style="color:#79B8FF;">14</span><span style="color:#9ECBFF;">%</span><span style="color:#E1E4E8;">    </span><span style="color:#79B8FF;">1297</span><span style="color:#9ECBFF;">Mi</span><span style="color:#E1E4E8;">          </span><span style="color:#79B8FF;">70</span><span style="color:#9ECBFF;">%</span></span>
<span class="line"><span style="color:#B392F0;">kube-node01</span><span style="color:#E1E4E8;">    </span><span style="color:#79B8FF;">320</span><span style="color:#9ECBFF;">m</span><span style="color:#E1E4E8;">         </span><span style="color:#79B8FF;">8</span><span style="color:#9ECBFF;">%</span><span style="color:#E1E4E8;">     </span><span style="color:#79B8FF;">1674</span><span style="color:#9ECBFF;">Mi</span><span style="color:#E1E4E8;">          </span><span style="color:#79B8FF;">61</span><span style="color:#9ECBFF;">%</span></span>
<span class="line"><span style="color:#B392F0;">kube-node02</span><span style="color:#E1E4E8;">    </span><span style="color:#79B8FF;">234</span><span style="color:#9ECBFF;">m</span><span style="color:#E1E4E8;">         </span><span style="color:#79B8FF;">11</span><span style="color:#9ECBFF;">%</span><span style="color:#E1E4E8;">    </span><span style="color:#79B8FF;">1415</span><span style="color:#9ECBFF;">Mi</span><span style="color:#E1E4E8;">          </span><span style="color:#79B8FF;">49</span><span style="color:#9ECBFF;">%</span></span>
<span class="line"><span style="color:#B392F0;">kube-node03</span><span style="color:#E1E4E8;">    </span><span style="color:#79B8FF;">227</span><span style="color:#9ECBFF;">m</span><span style="color:#E1E4E8;">         </span><span style="color:#79B8FF;">11</span><span style="color:#9ECBFF;">%</span><span style="color:#E1E4E8;">    </span><span style="color:#79B8FF;">1478</span><span style="color:#9ECBFF;">Mi</span><span style="color:#E1E4E8;">          </span><span style="color:#79B8FF;">52</span><span style="color:#9ECBFF;">%</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">[root@kube-master </span><span style="color:#F97583;">~</span><span style="color:#E1E4E8;">]# kubectl top pods</span></span>
<span class="line"><span style="color:#B392F0;">NAME</span><span style="color:#E1E4E8;">                                      </span><span style="color:#9ECBFF;">CPU</span><span style="color:#E1E4E8;">(</span><span style="color:#B392F0;">cores</span><span style="color:#E1E4E8;">)   </span><span style="color:#9ECBFF;">MEMORY</span><span style="color:#E1E4E8;">(</span><span style="color:#B392F0;">bytes</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#B392F0;">app-prod-97dfb4bf-h59vq</span><span style="color:#E1E4E8;">                   </span><span style="color:#79B8FF;">1</span><span style="color:#9ECBFF;">m</span><span style="color:#E1E4E8;">           </span><span style="color:#79B8FF;">26</span><span style="color:#9ECBFF;">Mi</span></span>
<span class="line"><span style="color:#B392F0;">app-prod-tcp-7bdfd5577c-tb8ls</span><span style="color:#E1E4E8;">             </span><span style="color:#79B8FF;">1</span><span style="color:#9ECBFF;">m</span><span style="color:#E1E4E8;">           </span><span style="color:#79B8FF;">18</span><span style="color:#9ECBFF;">Mi</span></span>
<span class="line"><span style="color:#B392F0;">custom-nginx-errors-6df8ddcc64-ztqnz</span><span style="color:#E1E4E8;">      </span><span style="color:#79B8FF;">0</span><span style="color:#9ECBFF;">m</span><span style="color:#E1E4E8;">           </span><span style="color:#79B8FF;">11</span><span style="color:#9ECBFF;">Mi</span></span>
<span class="line"><span style="color:#B392F0;">demo-6d4fc77748-dmg94</span><span style="color:#E1E4E8;">                     </span><span style="color:#79B8FF;">1</span><span style="color:#9ECBFF;">m</span><span style="color:#E1E4E8;">           </span><span style="color:#79B8FF;">22</span><span style="color:#9ECBFF;">Mi</span></span>
<span class="line"><span style="color:#B392F0;">demo-6d4fc77748-fbvg6</span><span style="color:#E1E4E8;">                     </span><span style="color:#79B8FF;">1</span><span style="color:#9ECBFF;">m</span><span style="color:#E1E4E8;">           </span><span style="color:#79B8FF;">17</span><span style="color:#9ECBFF;">Mi</span></span>
<span class="line"><span style="color:#B392F0;">nfs-client-provisioner-7f5bc48c68-8wld4</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">3</span><span style="color:#9ECBFF;">m</span><span style="color:#E1E4E8;">           </span><span style="color:#79B8FF;">20</span><span style="color:#9ECBFF;">Mi</span></span>
<span class="line"><span style="color:#B392F0;">old-demo-687c6ccd99-2rzwr</span><span style="color:#E1E4E8;">                 </span><span style="color:#79B8FF;">1</span><span style="color:#9ECBFF;">m</span><span style="color:#E1E4E8;">           </span><span style="color:#79B8FF;">26</span><span style="color:#9ECBFF;">Mi</span></span>
<span class="line"><span style="color:#B392F0;">old-demo-687c6ccd99-rv9fz</span><span style="color:#E1E4E8;">                 </span><span style="color:#79B8FF;">1</span><span style="color:#9ECBFF;">m</span><span style="color:#E1E4E8;">           </span><span style="color:#79B8FF;">17</span><span style="color:#9ECBFF;">Mi</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">apply</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-f</span><span style="color:#24292E;"> </span><span style="color:#032F62;">components.yaml</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#查看</span></span>
<span class="line"><span style="color:#6F42C1;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">get</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pod</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-n</span><span style="color:#24292E;"> </span><span style="color:#032F62;">kube-system</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">grep</span><span style="color:#24292E;"> </span><span style="color:#032F62;">metrics-server</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 查看node和pod资源使用情况</span></span>
<span class="line"><span style="color:#24292E;">[root@kube-master </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# kubectl top nodes</span></span>
<span class="line"><span style="color:#6F42C1;">NAME</span><span style="color:#24292E;">           </span><span style="color:#032F62;">CPU</span><span style="color:#24292E;">(</span><span style="color:#6F42C1;">cores</span><span style="color:#24292E;">)   </span><span style="color:#032F62;">CPU%</span><span style="color:#24292E;">   </span><span style="color:#032F62;">MEMORY</span><span style="color:#24292E;">(</span><span style="color:#6F42C1;">bytes</span><span style="color:#24292E;">)   </span><span style="color:#032F62;">MEMORY%</span></span>
<span class="line"><span style="color:#6F42C1;">k8s-master01</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">296</span><span style="color:#032F62;">m</span><span style="color:#24292E;">         </span><span style="color:#005CC5;">14</span><span style="color:#032F62;">%</span><span style="color:#24292E;">    </span><span style="color:#005CC5;">1297</span><span style="color:#032F62;">Mi</span><span style="color:#24292E;">          </span><span style="color:#005CC5;">70</span><span style="color:#032F62;">%</span></span>
<span class="line"><span style="color:#6F42C1;">kube-node01</span><span style="color:#24292E;">    </span><span style="color:#005CC5;">320</span><span style="color:#032F62;">m</span><span style="color:#24292E;">         </span><span style="color:#005CC5;">8</span><span style="color:#032F62;">%</span><span style="color:#24292E;">     </span><span style="color:#005CC5;">1674</span><span style="color:#032F62;">Mi</span><span style="color:#24292E;">          </span><span style="color:#005CC5;">61</span><span style="color:#032F62;">%</span></span>
<span class="line"><span style="color:#6F42C1;">kube-node02</span><span style="color:#24292E;">    </span><span style="color:#005CC5;">234</span><span style="color:#032F62;">m</span><span style="color:#24292E;">         </span><span style="color:#005CC5;">11</span><span style="color:#032F62;">%</span><span style="color:#24292E;">    </span><span style="color:#005CC5;">1415</span><span style="color:#032F62;">Mi</span><span style="color:#24292E;">          </span><span style="color:#005CC5;">49</span><span style="color:#032F62;">%</span></span>
<span class="line"><span style="color:#6F42C1;">kube-node03</span><span style="color:#24292E;">    </span><span style="color:#005CC5;">227</span><span style="color:#032F62;">m</span><span style="color:#24292E;">         </span><span style="color:#005CC5;">11</span><span style="color:#032F62;">%</span><span style="color:#24292E;">    </span><span style="color:#005CC5;">1478</span><span style="color:#032F62;">Mi</span><span style="color:#24292E;">          </span><span style="color:#005CC5;">52</span><span style="color:#032F62;">%</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">[root@kube-master </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# kubectl top pods</span></span>
<span class="line"><span style="color:#6F42C1;">NAME</span><span style="color:#24292E;">                                      </span><span style="color:#032F62;">CPU</span><span style="color:#24292E;">(</span><span style="color:#6F42C1;">cores</span><span style="color:#24292E;">)   </span><span style="color:#032F62;">MEMORY</span><span style="color:#24292E;">(</span><span style="color:#6F42C1;">bytes</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#6F42C1;">app-prod-97dfb4bf-h59vq</span><span style="color:#24292E;">                   </span><span style="color:#005CC5;">1</span><span style="color:#032F62;">m</span><span style="color:#24292E;">           </span><span style="color:#005CC5;">26</span><span style="color:#032F62;">Mi</span></span>
<span class="line"><span style="color:#6F42C1;">app-prod-tcp-7bdfd5577c-tb8ls</span><span style="color:#24292E;">             </span><span style="color:#005CC5;">1</span><span style="color:#032F62;">m</span><span style="color:#24292E;">           </span><span style="color:#005CC5;">18</span><span style="color:#032F62;">Mi</span></span>
<span class="line"><span style="color:#6F42C1;">custom-nginx-errors-6df8ddcc64-ztqnz</span><span style="color:#24292E;">      </span><span style="color:#005CC5;">0</span><span style="color:#032F62;">m</span><span style="color:#24292E;">           </span><span style="color:#005CC5;">11</span><span style="color:#032F62;">Mi</span></span>
<span class="line"><span style="color:#6F42C1;">demo-6d4fc77748-dmg94</span><span style="color:#24292E;">                     </span><span style="color:#005CC5;">1</span><span style="color:#032F62;">m</span><span style="color:#24292E;">           </span><span style="color:#005CC5;">22</span><span style="color:#032F62;">Mi</span></span>
<span class="line"><span style="color:#6F42C1;">demo-6d4fc77748-fbvg6</span><span style="color:#24292E;">                     </span><span style="color:#005CC5;">1</span><span style="color:#032F62;">m</span><span style="color:#24292E;">           </span><span style="color:#005CC5;">17</span><span style="color:#032F62;">Mi</span></span>
<span class="line"><span style="color:#6F42C1;">nfs-client-provisioner-7f5bc48c68-8wld4</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">3</span><span style="color:#032F62;">m</span><span style="color:#24292E;">           </span><span style="color:#005CC5;">20</span><span style="color:#032F62;">Mi</span></span>
<span class="line"><span style="color:#6F42C1;">old-demo-687c6ccd99-2rzwr</span><span style="color:#24292E;">                 </span><span style="color:#005CC5;">1</span><span style="color:#032F62;">m</span><span style="color:#24292E;">           </span><span style="color:#005CC5;">26</span><span style="color:#032F62;">Mi</span></span>
<span class="line"><span style="color:#6F42C1;">old-demo-687c6ccd99-rv9fz</span><span style="color:#24292E;">                 </span><span style="color:#005CC5;">1</span><span style="color:#032F62;">m</span><span style="color:#24292E;">           </span><span style="color:#005CC5;">17</span><span style="color:#032F62;">Mi</span></span></code></pre></div><h1 id="_2-案例" tabindex="-1">2.案例 <a class="header-anchor" href="#_2-案例" aria-label="Permalink to &quot;2.案例&quot;">​</a></h1><p>目前，HPA 有两个正式版本：v1 和 v2，v2 又有两个 beta 版本，v2beta1 和 v2beta2，这两个 beta 版本在最新的 Kubernetes 版本中都已经废弃。<a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.25/#horizontalpodautoscaler-v1-autoscaling" target="_blank" rel="noreferrer">HPA v1 版本</a> 只支持基于 CPU 的自动扩缩容，如果要使用基于内存的自动扩缩容，必须使用 <a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.25/#horizontalpodautoscaler-v2-autoscaling" target="_blank" rel="noreferrer">HPA v2 版本</a></p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#85E89D;">apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">autoscaling/v2</span></span>
<span class="line"><span style="color:#85E89D;">kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">HorizontalPodAutoscaler</span></span>
<span class="line"><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">hap-nginx</span></span>
<span class="line"><span style="color:#85E89D;">spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">maxReplicas</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">10</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># 最大扩容到10个节点（pod）</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">minReplicas</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># 最小扩容1个节点（pod）</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">metrics</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  - </span><span style="color:#85E89D;">resource</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">cpu</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">target</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">averageUtilization</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">40</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># CPU 平局资源使用率达到40%就开始扩容，低于40%就是缩容</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#6A737D;"># 设置内存</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#6A737D;"># AverageValue：40</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">type</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Utilization</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">type</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Resource</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">scaleTargetRef</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">apps/v1</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Deployment</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">hap-nginx</span></span>
<span class="line"><span style="color:#B392F0;">---</span></span>
<span class="line"><span style="color:#85E89D;">apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">v1</span></span>
<span class="line"><span style="color:#85E89D;">kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Service</span></span>
<span class="line"><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">hap-nginx</span></span>
<span class="line"><span style="color:#85E89D;">spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">type</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">NodePort</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">ports</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    - </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;http&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">port</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">80</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">targetPort</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">80</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">nodePort</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">30080</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">selector</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">service</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">hap-nginx</span></span>
<span class="line"><span style="color:#B392F0;">---</span></span>
<span class="line"><span style="color:#85E89D;">apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">apps/v1</span></span>
<span class="line"><span style="color:#85E89D;">kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Deployment</span></span>
<span class="line"><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">hap-nginx</span></span>
<span class="line"><span style="color:#85E89D;">spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">replicas</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">1</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">selector</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">matchLabels</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">service</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">hap-nginx</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">template</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">labels</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">service</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">hap-nginx</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">containers</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">        - </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">hap-nginx</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#85E89D;">image</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">nginx:latest</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#85E89D;">resources</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#85E89D;">requests</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">              </span><span style="color:#85E89D;">cpu</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">100m</span></span>
<span class="line"><span style="color:#E1E4E8;">              </span><span style="color:#85E89D;">memory</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">100Mi</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#85E89D;">limits</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">              </span><span style="color:#85E89D;">cpu</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">200m</span></span>
<span class="line"><span style="color:#E1E4E8;">              </span><span style="color:#85E89D;">memory</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">200Mi</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#22863A;">apiVersion</span><span style="color:#24292E;">: </span><span style="color:#032F62;">autoscaling/v2</span></span>
<span class="line"><span style="color:#22863A;">kind</span><span style="color:#24292E;">: </span><span style="color:#032F62;">HorizontalPodAutoscaler</span></span>
<span class="line"><span style="color:#22863A;">metadata</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">hap-nginx</span></span>
<span class="line"><span style="color:#22863A;">spec</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">maxReplicas</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">10</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 最大扩容到10个节点（pod）</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">minReplicas</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">1</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 最小扩容1个节点（pod）</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">metrics</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  - </span><span style="color:#22863A;">resource</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">cpu</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">target</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">averageUtilization</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">40</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># CPU 平局资源使用率达到40%就开始扩容，低于40%就是缩容</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6A737D;"># 设置内存</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6A737D;"># AverageValue：40</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">type</span><span style="color:#24292E;">: </span><span style="color:#032F62;">Utilization</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">type</span><span style="color:#24292E;">: </span><span style="color:#032F62;">Resource</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">scaleTargetRef</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">apiVersion</span><span style="color:#24292E;">: </span><span style="color:#032F62;">apps/v1</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">kind</span><span style="color:#24292E;">: </span><span style="color:#032F62;">Deployment</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">hap-nginx</span></span>
<span class="line"><span style="color:#6F42C1;">---</span></span>
<span class="line"><span style="color:#22863A;">apiVersion</span><span style="color:#24292E;">: </span><span style="color:#032F62;">v1</span></span>
<span class="line"><span style="color:#22863A;">kind</span><span style="color:#24292E;">: </span><span style="color:#032F62;">Service</span></span>
<span class="line"><span style="color:#22863A;">metadata</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">hap-nginx</span></span>
<span class="line"><span style="color:#22863A;">spec</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">type</span><span style="color:#24292E;">: </span><span style="color:#032F62;">NodePort</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">ports</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;http&quot;</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">port</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">80</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">targetPort</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">80</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">nodePort</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">30080</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">selector</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">service</span><span style="color:#24292E;">: </span><span style="color:#032F62;">hap-nginx</span></span>
<span class="line"><span style="color:#6F42C1;">---</span></span>
<span class="line"><span style="color:#22863A;">apiVersion</span><span style="color:#24292E;">: </span><span style="color:#032F62;">apps/v1</span></span>
<span class="line"><span style="color:#22863A;">kind</span><span style="color:#24292E;">: </span><span style="color:#032F62;">Deployment</span></span>
<span class="line"><span style="color:#22863A;">metadata</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">hap-nginx</span></span>
<span class="line"><span style="color:#22863A;">spec</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">replicas</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">1</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">selector</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">matchLabels</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">service</span><span style="color:#24292E;">: </span><span style="color:#032F62;">hap-nginx</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">template</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">metadata</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">labels</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">service</span><span style="color:#24292E;">: </span><span style="color:#032F62;">hap-nginx</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">spec</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">containers</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">        - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">hap-nginx</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#22863A;">image</span><span style="color:#24292E;">: </span><span style="color:#032F62;">nginx:latest</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#22863A;">resources</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#22863A;">requests</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">              </span><span style="color:#22863A;">cpu</span><span style="color:#24292E;">: </span><span style="color:#032F62;">100m</span></span>
<span class="line"><span style="color:#24292E;">              </span><span style="color:#22863A;">memory</span><span style="color:#24292E;">: </span><span style="color:#032F62;">100Mi</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#22863A;">limits</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">              </span><span style="color:#22863A;">cpu</span><span style="color:#24292E;">: </span><span style="color:#032F62;">200m</span></span>
<span class="line"><span style="color:#24292E;">              </span><span style="color:#22863A;">memory</span><span style="color:#24292E;">: </span><span style="color:#032F62;">200Mi</span></span></code></pre></div><p>主要参数解释如下：</p><ul><li>scaleTargetRef：目标作用对象，可以是Deployment、ReplicationController或ReplicaSet。</li><li>minReplicas和maxReplicas：Pod副本数量的最小值和最大值，系统将在这个范围内进行自动扩缩容操作，并维持每个Pod的内存使用率为40%，这个值就是上面设置的阈值averageUtilization。</li><li>metrics：目标指标值。在metrics中通过参数type定义指标的类型；通过参数target定义相应的指标目标值，系统将在指标数据达到目标值时（考虑容忍度的区间，见前面算法部分的说明）触发扩缩容操作。</li><li>对于CPU使用率，在target参数中设置averageUtilization定义目标平均CPU使用率。</li><li>对于内存资源，在target参数中设置AverageValue定义目标平均内存使用值</li></ul><h2 id="_2-1-ab压力测试" tabindex="-1">2.1 ab压力测试 <a class="header-anchor" href="#_2-1-ab压力测试" aria-label="Permalink to &quot;2.1 ab压力测试&quot;">​</a></h2><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">yum</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">install</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">httpd</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-y</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">ab</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-n</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">100000</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-c</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">800</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">http://local-168-182-112:30080/</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#-c：并发数</span></span>
<span class="line"><span style="color:#6A737D;">#-n：总请求数</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">yum</span><span style="color:#24292E;"> </span><span style="color:#032F62;">install</span><span style="color:#24292E;"> </span><span style="color:#032F62;">httpd</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-y</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">ab</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-n</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">100000</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-c</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">800</span><span style="color:#24292E;"> </span><span style="color:#032F62;">http://local-168-182-112:30080/</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#-c：并发数</span></span>
<span class="line"><span style="color:#6A737D;">#-n：总请求数</span></span></code></pre></div><ul><li>查看 pod</li></ul><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">get</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pods</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-w</span><span style="color:#F97583;">|</span><span style="color:#B392F0;">grep</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">hap</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">get</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pods</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-w</span><span style="color:#D73A49;">|</span><span style="color:#6F42C1;">grep</span><span style="color:#24292E;"> </span><span style="color:#032F62;">hap</span></span></code></pre></div>`,31),e=[o];function c(t,r,E,y,i,F){return n(),a("div",null,e)}const m=s(p,[["render",c]]);export{C as __pageData,m as default};
