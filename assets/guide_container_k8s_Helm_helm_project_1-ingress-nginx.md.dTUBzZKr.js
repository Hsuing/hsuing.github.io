import{_ as s,o as n,c as a,R as l}from"./chunks/framework.zUbWieqp.js";const d=JSON.parse('{"title":"1. Helm部署Ingress","description":"","frontmatter":{},"headers":[],"relativePath":"guide/container/k8s/Helm/helm_project/1-ingress-nginx.md","filePath":"guide/container/k8s/Helm/helm_project/1-ingress-nginx.md","lastUpdated":1729503684000}'),p={name:"guide/container/k8s/Helm/helm_project/1-ingress-nginx.md"},o=l(`<h1 id="_1-helm部署ingress" tabindex="-1">1. Helm部署Ingress <a class="header-anchor" href="#_1-helm部署ingress" aria-label="Permalink to &quot;1. Helm部署Ingress&quot;">​</a></h1><p>ingress-nginx部署两个副本数，使用pod反亲和。将两个pod调度到不同的节点上</p><p>或者采用daemonset方式部署、</p><ul><li>环境</li></ul><p>kubernetes-1.29.x</p><p>containerd-1.7</p><p>ingress-nginx-4.11.2</p><h2 id="_1-0-nginx-ingress三种模式" tabindex="-1">1.0 nginx-ingress三种模式 <a class="header-anchor" href="#_1-0-nginx-ingress三种模式" aria-label="Permalink to &quot;1.0 nginx-ingress三种模式&quot;">​</a></h2><h3 id="deployment-loadbalancer" tabindex="-1">Deployment+LoadBalancer <a class="header-anchor" href="#deployment-loadbalancer" aria-label="Permalink to &quot;Deployment+LoadBalancer&quot;">​</a></h3><p>采用deployment进行部署nginx-ingress-controller，需要创建一个type:LoadBalancer的service进行关联nginx-ingress-controller这组pod。通常是在使用公有云进行创建负载均衡器并绑定公网地址。只要将域名解析指向该地址，即可实现集群服务的对外访问。</p><h3 id="deployment-nodeport" tabindex="-1">Deployment+NodePort <a class="header-anchor" href="#deployment-nodeport" aria-label="Permalink to &quot;Deployment+NodePort&quot;">​</a></h3><p>采用deployment进行部署nginx-ingress-controller，需要创建一个type:NodePort的service进行关联nginx-ingress-controller这组pod。ingress暴露在集群节点ip的特定端口上。由于nodeport暴露的端口是随机端口，一般会在前面再搭建一套负载均衡器来转发请求。改方式一般用于宿主机是相对固定的环境ip地址不变的场景。</p><h3 id="daemonset-hostnetwork" tabindex="-1">DaemonSet+HostNetwork <a class="header-anchor" href="#daemonset-hostnetwork" aria-label="Permalink to &quot;DaemonSet+HostNetwork&quot;">​</a></h3><p>用DaemonSet 结合nodeselector来部署ingress-controller到特定的Node上。然后使用HostNetwork直接把该pod与宿主机node的网络打通，直接使用宿主机的80/443端口就能访问服务。该方式整个请求链路最简单，性能相对nodeport模式更好。缺点是由于直接利用宿主机节点的网络和端口，一个node只能部署一个ingress-controller pod。比较适合大并发的生产环境使用</p><h2 id="_1-1-部署ingress" tabindex="-1">1.1 部署ingress <a class="header-anchor" href="#_1-1-部署ingress" aria-label="Permalink to &quot;1.1 部署ingress&quot;">​</a></h2><h3 id="_1-下载chart包" tabindex="-1">1.下载chart包 <a class="header-anchor" href="#_1-下载chart包" aria-label="Permalink to &quot;1.下载chart包&quot;">​</a></h3><p>版本对应关系，<a href="https://github.com/kubernetes/ingress-nginx?tab=readme-ov-file#supported-versions-table" target="_blank" rel="noreferrer">https://github.com/kubernetes/ingress-nginx?tab=readme-ov-file#supported-versions-table</a></p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">#添加官网源</span></span>
<span class="line"><span style="color:#B392F0;">helm</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">repo</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">add</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">ingress-nginx</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">https://kubernetes.github.io/ingress-nginx</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 配置helm微软源地址（国内使用下面两个任意其中一个都可以）</span></span>
<span class="line"><span style="color:#B392F0;">helm</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">repo</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">add</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">stable</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">http://mirror.azure.cn/kubernetes/charts</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 配置helm阿里源地址</span></span>
<span class="line"><span style="color:#B392F0;">helm</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">repo</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">add</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">aliyun</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">https://kubernetes.oss-cn-hangzhou.aliyuncs.com/charts</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#更新源</span></span>
<span class="line"><span style="color:#B392F0;">helm</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">repo</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">update</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#查看</span></span>
<span class="line"><span style="color:#B392F0;">helm</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">repo</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">list</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#查找</span></span>
<span class="line"><span style="color:#B392F0;">helm</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">search</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">repo</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">ingress-nginx/ingress-nginx</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 查看chart信息</span></span>
<span class="line"><span style="color:#B392F0;">helm</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">show</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">chart</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">ingress-nginx/ingress-nginx</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--version</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">4.11</span><span style="color:#9ECBFF;">.3</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#指定版本</span></span>
<span class="line"><span style="color:#B392F0;">helm</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pull</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">ingress-nginx/ingress-nginx --untar --untardir /root/helm_project/ingress-nginx --version</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">4.11</span><span style="color:#9ECBFF;">.3</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#在线安装</span></span>
<span class="line"><span style="color:#B392F0;">helm</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">install</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">ingress-nginx</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">ingress-nginx/ingress-nginx</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--version</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">4.11</span><span style="color:#9ECBFF;">.3</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-f</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">ingress-nginx-value.yml</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-n</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">ingress-nginx</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">#添加官网源</span></span>
<span class="line"><span style="color:#6F42C1;">helm</span><span style="color:#24292E;"> </span><span style="color:#032F62;">repo</span><span style="color:#24292E;"> </span><span style="color:#032F62;">add</span><span style="color:#24292E;"> </span><span style="color:#032F62;">ingress-nginx</span><span style="color:#24292E;"> </span><span style="color:#032F62;">https://kubernetes.github.io/ingress-nginx</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 配置helm微软源地址（国内使用下面两个任意其中一个都可以）</span></span>
<span class="line"><span style="color:#6F42C1;">helm</span><span style="color:#24292E;"> </span><span style="color:#032F62;">repo</span><span style="color:#24292E;"> </span><span style="color:#032F62;">add</span><span style="color:#24292E;"> </span><span style="color:#032F62;">stable</span><span style="color:#24292E;"> </span><span style="color:#032F62;">http://mirror.azure.cn/kubernetes/charts</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 配置helm阿里源地址</span></span>
<span class="line"><span style="color:#6F42C1;">helm</span><span style="color:#24292E;"> </span><span style="color:#032F62;">repo</span><span style="color:#24292E;"> </span><span style="color:#032F62;">add</span><span style="color:#24292E;"> </span><span style="color:#032F62;">aliyun</span><span style="color:#24292E;"> </span><span style="color:#032F62;">https://kubernetes.oss-cn-hangzhou.aliyuncs.com/charts</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#更新源</span></span>
<span class="line"><span style="color:#6F42C1;">helm</span><span style="color:#24292E;"> </span><span style="color:#032F62;">repo</span><span style="color:#24292E;"> </span><span style="color:#032F62;">update</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#查看</span></span>
<span class="line"><span style="color:#6F42C1;">helm</span><span style="color:#24292E;"> </span><span style="color:#032F62;">repo</span><span style="color:#24292E;"> </span><span style="color:#032F62;">list</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#查找</span></span>
<span class="line"><span style="color:#6F42C1;">helm</span><span style="color:#24292E;"> </span><span style="color:#032F62;">search</span><span style="color:#24292E;"> </span><span style="color:#032F62;">repo</span><span style="color:#24292E;"> </span><span style="color:#032F62;">ingress-nginx/ingress-nginx</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 查看chart信息</span></span>
<span class="line"><span style="color:#6F42C1;">helm</span><span style="color:#24292E;"> </span><span style="color:#032F62;">show</span><span style="color:#24292E;"> </span><span style="color:#032F62;">chart</span><span style="color:#24292E;"> </span><span style="color:#032F62;">ingress-nginx/ingress-nginx</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--version</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">4.11</span><span style="color:#032F62;">.3</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#指定版本</span></span>
<span class="line"><span style="color:#6F42C1;">helm</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pull</span><span style="color:#24292E;"> </span><span style="color:#032F62;">ingress-nginx/ingress-nginx --untar --untardir /root/helm_project/ingress-nginx --version</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">4.11</span><span style="color:#032F62;">.3</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#在线安装</span></span>
<span class="line"><span style="color:#6F42C1;">helm</span><span style="color:#24292E;"> </span><span style="color:#032F62;">install</span><span style="color:#24292E;"> </span><span style="color:#032F62;">ingress-nginx</span><span style="color:#24292E;"> </span><span style="color:#032F62;">ingress-nginx/ingress-nginx</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--version</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">4.11</span><span style="color:#032F62;">.3</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-f</span><span style="color:#24292E;"> </span><span style="color:#032F62;">ingress-nginx-value.yml</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-n</span><span style="color:#24292E;"> </span><span style="color:#032F62;">ingress-nginx</span></span></code></pre></div><h3 id="_2-创建自定义values" tabindex="-1">2.创建自定义values <a class="header-anchor" href="#_2-创建自定义values" aria-label="Permalink to &quot;2.创建自定义values&quot;">​</a></h3><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#9ECBFF;">vim /root/helm_project/ingress-nginx/ingress-nginx-value.yaml</span></span>
<span class="line"><span style="color:#85E89D;">controller</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Deployment</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># 部署模式</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;"># 副本数</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">replicaCount</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">2</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;"># 开启ssl</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">extraArgs</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">enable-ssl-passthrough</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;true&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">hostNetwork</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">true</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># 使⽤主机网络</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">dnsPolicy</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">ClusterFirstWithHostNet</span><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;"># 优先使⽤集群内的DNS解析服务</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span></span>
<span class="line"><span style="color:#E1E4E8;">  </span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">image</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">registry</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">registry.cn-zhangjiakou.aliyuncs.com</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">image</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">hsuing/ingress-nginx</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">tag</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;v1.11.3&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">digest</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&#39;&#39;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">pullPolicy</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">ifNotPresent</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;"># pod反亲和</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">podAntiAffinity</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">requiredDuringSchedulingIgnoredDuringExecution</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    - </span><span style="color:#85E89D;">labelSelector</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">matchExpressions</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">        - </span><span style="color:#85E89D;">key</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">app.kubernetes.io/component</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#85E89D;">operator</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">In</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#85E89D;">values</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">          - </span><span style="color:#9ECBFF;">ingress-controller</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">topologyKey</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">kubernetes.io/hostname</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;"># 标签选择器</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">nodeSelector</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">ingress-nginx</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">ingress-controller</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;"># service配置</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">service</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">type</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">LoadBalancer</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">externalTrafficPolicy</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Cluster</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;"># 配置metrics采集</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">metrics</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">enabled</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">true</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">port</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">10254</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;"># 优雅推出</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">lifecycle</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">preStop</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">exec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">command</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">          - </span><span style="color:#9ECBFF;">/wait-shutdown</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">admissionWebhooks</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">enabled</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">true</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">patch</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">enabled</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">true</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">image</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">registry</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">registry.cn-zhangjiakou.aliyuncs.com</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">image</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">hsuing/kube-webhook-certgen</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">tag</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&#39;v1.4.4&#39;</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">digest</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&#39;&#39;</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">pullPolicy</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">ifNotPresent</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">tolerations</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">        - </span><span style="color:#85E89D;">key</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">node-role.kubernetes.io/control-plane</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#85E89D;">operator</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Exists</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#85E89D;">effect</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">NoSchedule</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">affinity</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">nodeAffinity</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#85E89D;">requiredDuringSchedulingIgnoredDuringExecution</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#85E89D;">nodeSelectorTerms</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">              - </span><span style="color:#85E89D;">matchExpressions</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">                  - </span><span style="color:#85E89D;">key</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">node-role.kubernetes.io/control-plane</span></span>
<span class="line"><span style="color:#E1E4E8;">                    </span><span style="color:#85E89D;">operator</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Exists</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#032F62;">vim /root/helm_project/ingress-nginx/ingress-nginx-value.yaml</span></span>
<span class="line"><span style="color:#22863A;">controller</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">kind</span><span style="color:#24292E;">: </span><span style="color:#032F62;">Deployment</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 部署模式</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6A737D;"># 副本数</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">replicaCount</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">2</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6A737D;"># 开启ssl</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">extraArgs</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">enable-ssl-passthrough</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;true&quot;</span></span>
<span class="line"><span style="color:#24292E;">  </span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">hostNetwork</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">true</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 使⽤主机网络</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">dnsPolicy</span><span style="color:#24292E;">: </span><span style="color:#032F62;">ClusterFirstWithHostNet</span><span style="color:#24292E;">  </span><span style="color:#6A737D;"># 优先使⽤集群内的DNS解析服务</span></span>
<span class="line"><span style="color:#24292E;">  </span></span>
<span class="line"><span style="color:#24292E;">  </span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">image</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">registry</span><span style="color:#24292E;">: </span><span style="color:#032F62;">registry.cn-zhangjiakou.aliyuncs.com</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">image</span><span style="color:#24292E;">: </span><span style="color:#032F62;">hsuing/ingress-nginx</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">tag</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;v1.11.3&quot;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">digest</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&#39;&#39;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">pullPolicy</span><span style="color:#24292E;">: </span><span style="color:#032F62;">ifNotPresent</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6A737D;"># pod反亲和</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">podAntiAffinity</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">requiredDuringSchedulingIgnoredDuringExecution</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    - </span><span style="color:#22863A;">labelSelector</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">matchExpressions</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">        - </span><span style="color:#22863A;">key</span><span style="color:#24292E;">: </span><span style="color:#032F62;">app.kubernetes.io/component</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#22863A;">operator</span><span style="color:#24292E;">: </span><span style="color:#032F62;">In</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#22863A;">values</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">          - </span><span style="color:#032F62;">ingress-controller</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">topologyKey</span><span style="color:#24292E;">: </span><span style="color:#032F62;">kubernetes.io/hostname</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6A737D;"># 标签选择器</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">nodeSelector</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">ingress-nginx</span><span style="color:#24292E;">: </span><span style="color:#032F62;">ingress-controller</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6A737D;"># service配置</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">service</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">type</span><span style="color:#24292E;">: </span><span style="color:#032F62;">LoadBalancer</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">externalTrafficPolicy</span><span style="color:#24292E;">: </span><span style="color:#032F62;">Cluster</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6A737D;"># 配置metrics采集</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">metrics</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">enabled</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">true</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">port</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">10254</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6A737D;"># 优雅推出</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">lifecycle</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">preStop</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">exec</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">command</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">          - </span><span style="color:#032F62;">/wait-shutdown</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">admissionWebhooks</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">enabled</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">true</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">patch</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">enabled</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">true</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">image</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">registry</span><span style="color:#24292E;">: </span><span style="color:#032F62;">registry.cn-zhangjiakou.aliyuncs.com</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">image</span><span style="color:#24292E;">: </span><span style="color:#032F62;">hsuing/kube-webhook-certgen</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">tag</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&#39;v1.4.4&#39;</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">digest</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&#39;&#39;</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">pullPolicy</span><span style="color:#24292E;">: </span><span style="color:#032F62;">ifNotPresent</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">tolerations</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">        - </span><span style="color:#22863A;">key</span><span style="color:#24292E;">: </span><span style="color:#032F62;">node-role.kubernetes.io/control-plane</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#22863A;">operator</span><span style="color:#24292E;">: </span><span style="color:#032F62;">Exists</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#22863A;">effect</span><span style="color:#24292E;">: </span><span style="color:#032F62;">NoSchedule</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">affinity</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">nodeAffinity</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#22863A;">requiredDuringSchedulingIgnoredDuringExecution</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#22863A;">nodeSelectorTerms</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">              - </span><span style="color:#22863A;">matchExpressions</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">                  - </span><span style="color:#22863A;">key</span><span style="color:#24292E;">: </span><span style="color:#032F62;">node-role.kubernetes.io/control-plane</span></span>
<span class="line"><span style="color:#24292E;">                    </span><span style="color:#22863A;">operator</span><span style="color:#24292E;">: </span><span style="color:#032F62;">Exists</span></span></code></pre></div><p>解释：</p><p><a href="https://kubernetes.io/zh-cn/docs/concepts/scheduling-eviction/assign-pod-node/" target="_blank" rel="noreferrer">https://kubernetes.io/zh-cn/docs/concepts/scheduling-eviction/assign-pod-node/</a></p><h4 id="_1-controller" tabindex="-1">1. controller <a class="header-anchor" href="#_1-controller" aria-label="Permalink to &quot;1. controller&quot;">​</a></h4><ul><li><code>kind: Deployment</code><ul><li>指定 Ingress NGINX Controller 的工作负载类型为 <code>Deployment</code>，用于管理和升级 Pod</li></ul></li><li><code>replicaCount: 3</code><ul><li>设置 3 个控制器 Pod 副本以实现高可用性；这意味着在集群中将会有 3 个 Ingress NGINX Controller 实例，这些实例将分布在不同的节点上，以确保服务的可用性</li></ul></li></ul><h4 id="_2-affinity" tabindex="-1">2. affinity <a class="header-anchor" href="#_2-affinity" aria-label="Permalink to &quot;2. affinity&quot;">​</a></h4><ul><li><code>podAntiAffinity</code><ul><li>这个配置项确保每个 Ingress NGINX Controller Pod 不会被调度到同一个节点上，从而实现更高的容错能力</li><li><code>requiredDuringSchedulingIgnoredDuringExecution</code><ul><li>强制性调度规则，要求在 Pod 调度时必须满足此条件；确保不同的 Pod 不会调度到同一个节点上</li></ul></li><li><code>labelSelector</code><ul><li>用于选择具有特定标签的 Pod；这里，指定 <code>app.kubernetes.io/name=ingress-nginx</code>，也就是所有带有 <code>ingress-nginx</code> 标签的 Pod 不会被调度到同一个节点上</li></ul></li><li><code>topologyKey: &quot;kubernetes.io/hostname&quot;</code><ul><li>指定 Pod 之间的调度反亲和性以 <code>hostname</code> 为基础，也就是说，Pod 不会被调度到同一个主机上，以确保各个实例的分布式部署</li></ul></li></ul></li></ul><h4 id="_3-service" tabindex="-1">3. service <a class="header-anchor" href="#_3-service" aria-label="Permalink to &quot;3. service&quot;">​</a></h4><ul><li><code>type: LoadBalancer</code><ul><li>将 Ingress NGINX 服务的类型设置为 <code>LoadBalancer</code>，集群将为 Ingress NGINX Controller 自动配置一个外部负载均衡器，从而使外部流量能够访问集群内部的服务</li></ul></li></ul><h4 id="_4-admissionwebhooks" tabindex="-1">4. admissionWebhooks <a class="header-anchor" href="#_4-admissionwebhooks" aria-label="Permalink to &quot;4. admissionWebhooks&quot;">​</a></h4><ul><li><code>enabled: true</code><ul><li>启用 Admission Webhooks，这是 Kubernetes 中的一种机制，用于在资源（如 Pod）被创建、更新或删除时进行验证和修改；Ingress NGINX Controller 的 Admission Webhooks 主要用于处理证书和其它配置的自动化管理</li><li><code>patch</code><ul><li>这个字段下的配置专门为 Admission Webhooks 的 Patch Pod 配置调度策略</li><li><code>tolerations</code><ul><li><code>key: node-role.kubernetes.io/control-plane</code> 容忍控制平面节点上的污点，即使节点有 <code>NoSchedule</code> 污点，Pod 仍然可以调度到控制平面节点</li></ul></li><li><code>affinity</code><ul><li><code>requiredDuringSchedulingIgnoredDuringExecution</code><ul><li>强制性调度规则，要求 Admission Webhooks 的 Patch Pod，必须调度到带有 <code>node-role.kubernetes.io/control-plane</code> 标签的控制平面节点上</li></ul></li></ul></li></ul></li></ul></li></ul><blockquote><p>这份文件确保 Ingress NGINX Controller 的高可用性和稳定性，通过多副本部署、反亲和性调度策略以及云环境中的负载均衡来实现这一目标。Admission Webhooks 的配置则保证了 Kubernetes 集群中敏感资源的自动管理</p></blockquote><h3 id="_3-打标签" tabindex="-1">3.打标签 <a class="header-anchor" href="#_3-打标签" aria-label="Permalink to &quot;3.打标签&quot;">​</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;"> kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">label</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">node</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">kube-node-01</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">ingress-nginx=ingress-controller</span></span>
<span class="line"><span style="color:#B392F0;"> </span></span>
<span class="line"><span style="color:#B392F0;"> kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">label</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">node</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">kube-node-02</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">ingress-nginx=ingress-controller</span></span>
<span class="line"><span style="color:#B392F0;"> </span></span>
<span class="line"><span style="color:#B392F0;"> kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">label</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">node</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">kube-master-01</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">node-role.kubernetes.io/control-plane=ingress-nginx</span></span>
<span class="line"><span style="color:#B392F0;"> #查看</span></span>
<span class="line"><span style="color:#B392F0;"> kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">get</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">nodes</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--show-labels</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;"> kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">label</span><span style="color:#24292E;"> </span><span style="color:#032F62;">node</span><span style="color:#24292E;"> </span><span style="color:#032F62;">kube-node-01</span><span style="color:#24292E;"> </span><span style="color:#032F62;">ingress-nginx=ingress-controller</span></span>
<span class="line"><span style="color:#6F42C1;"> </span></span>
<span class="line"><span style="color:#6F42C1;"> kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">label</span><span style="color:#24292E;"> </span><span style="color:#032F62;">node</span><span style="color:#24292E;"> </span><span style="color:#032F62;">kube-node-02</span><span style="color:#24292E;"> </span><span style="color:#032F62;">ingress-nginx=ingress-controller</span></span>
<span class="line"><span style="color:#6F42C1;"> </span></span>
<span class="line"><span style="color:#6F42C1;"> kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">label</span><span style="color:#24292E;"> </span><span style="color:#032F62;">node</span><span style="color:#24292E;"> </span><span style="color:#032F62;">kube-master-01</span><span style="color:#24292E;"> </span><span style="color:#032F62;">node-role.kubernetes.io/control-plane=ingress-nginx</span></span>
<span class="line"><span style="color:#6F42C1;"> #查看</span></span>
<span class="line"><span style="color:#6F42C1;"> kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">get</span><span style="color:#24292E;"> </span><span style="color:#032F62;">nodes</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--show-labels</span></span></code></pre></div><h3 id="_4-部署" tabindex="-1">4.部署 <a class="header-anchor" href="#_4-部署" aria-label="Permalink to &quot;4.部署&quot;">​</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">#创建ns</span></span>
<span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">create</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">ns</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">ingress-nginx</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">helm</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">install</span><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">ingress-nginx</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-f</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/root/helm_project/ingress-nginx/ingress-nginx-value.yaml</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/root/helm_project/ingress-nginx</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-ningress-nginx</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#如果修改了变量，</span></span>
<span class="line"><span style="color:#B392F0;">helm</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">upgrade</span><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">ingress-nginx</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-f</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/root/helm_project/ingress-nginx/ingress-nginx-value.yaml</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/root/helm_project/ingress-nginx</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-ningress-nginx</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">#创建ns</span></span>
<span class="line"><span style="color:#6F42C1;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">create</span><span style="color:#24292E;"> </span><span style="color:#032F62;">ns</span><span style="color:#24292E;"> </span><span style="color:#032F62;">ingress-nginx</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">helm</span><span style="color:#24292E;"> </span><span style="color:#032F62;">install</span><span style="color:#24292E;">  </span><span style="color:#032F62;">ingress-nginx</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-f</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/root/helm_project/ingress-nginx/ingress-nginx-value.yaml</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/root/helm_project/ingress-nginx</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-ningress-nginx</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#如果修改了变量，</span></span>
<span class="line"><span style="color:#6F42C1;">helm</span><span style="color:#24292E;"> </span><span style="color:#032F62;">upgrade</span><span style="color:#24292E;">  </span><span style="color:#032F62;">ingress-nginx</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-f</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/root/helm_project/ingress-nginx/ingress-nginx-value.yaml</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/root/helm_project/ingress-nginx</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-ningress-nginx</span></span></code></pre></div><ul><li>查看values</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">helm</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">get</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">values</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">ingress-nginx</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-a</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-ningress-nginx</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">helm</span><span style="color:#24292E;"> </span><span style="color:#032F62;">get</span><span style="color:#24292E;"> </span><span style="color:#032F62;">values</span><span style="color:#24292E;"> </span><span style="color:#032F62;">ingress-nginx</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-a</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-ningress-nginx</span></span></code></pre></div><blockquote><p>openelb-0.6安装有问题，nginx获取不到ip</p></blockquote><ul><li>查看ingress状态</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">[root@kube-master-01 helm_project]# kg all -ningress-nginx</span></span>
<span class="line"><span style="color:#B392F0;">NAME</span><span style="color:#E1E4E8;">                                            </span><span style="color:#9ECBFF;">READY</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">STATUS</span><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">RESTARTS</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">AGE</span></span>
<span class="line"><span style="color:#B392F0;">pod/ingress-nginx-controller-5b88878bf4-swz6f</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">1</span><span style="color:#9ECBFF;">/1</span><span style="color:#E1E4E8;">     </span><span style="color:#9ECBFF;">Running</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">          </span><span style="color:#79B8FF;">35</span><span style="color:#9ECBFF;">m</span></span>
<span class="line"><span style="color:#B392F0;">pod/ingress-nginx-controller-5b88878bf4-z2spz</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">1</span><span style="color:#9ECBFF;">/1</span><span style="color:#E1E4E8;">     </span><span style="color:#9ECBFF;">Running</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">          </span><span style="color:#79B8FF;">35</span><span style="color:#9ECBFF;">m</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">NAME</span><span style="color:#E1E4E8;">                                         </span><span style="color:#9ECBFF;">TYPE</span><span style="color:#E1E4E8;">           </span><span style="color:#9ECBFF;">CLUSTER-IP</span><span style="color:#E1E4E8;">        </span><span style="color:#9ECBFF;">EXTERNAL-IP</span><span style="color:#E1E4E8;">     </span><span style="color:#9ECBFF;">PORT</span><span style="color:#E1E4E8;">(</span><span style="color:#B392F0;">S</span><span style="color:#E1E4E8;">)     </span><span style="color:#9ECBFF;">AGE</span></span>
<span class="line"><span style="color:#B392F0;">service/ingress-nginx-controller</span><span style="color:#E1E4E8;">             </span><span style="color:#9ECBFF;">LoadBalancer</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">192.168</span><span style="color:#9ECBFF;">.142.60</span><span style="color:#E1E4E8;">    </span><span style="color:#79B8FF;">10.103</span><span style="color:#9ECBFF;">.236.70</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">80</span><span style="color:#9ECBFF;">:32057/TCP,443:58699/TCP</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">35</span><span style="color:#9ECBFF;">m</span></span>
<span class="line"><span style="color:#B392F0;">service/ingress-nginx-controller-admission</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">ClusterIP</span><span style="color:#E1E4E8;">      </span><span style="color:#79B8FF;">192.168</span><span style="color:#9ECBFF;">.105.131</span><span style="color:#E1E4E8;">   </span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">non</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;">          </span><span style="color:#79B8FF;">443</span><span style="color:#9ECBFF;">/TCP</span><span style="color:#E1E4E8;">     </span><span style="color:#79B8FF;">35</span><span style="color:#9ECBFF;">m</span></span>
<span class="line"><span style="color:#B392F0;">service/ingress-nginx-controller-metrics</span><span style="color:#E1E4E8;">     </span><span style="color:#9ECBFF;">ClusterIP</span><span style="color:#E1E4E8;">      </span><span style="color:#79B8FF;">192.168</span><span style="color:#9ECBFF;">.12.140</span><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">non</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;">          </span><span style="color:#79B8FF;">10254</span><span style="color:#9ECBFF;">/TCP</span><span style="color:#E1E4E8;">     </span><span style="color:#79B8FF;">35</span><span style="color:#9ECBFF;">m</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">NAME</span><span style="color:#E1E4E8;">                                       </span><span style="color:#9ECBFF;">READY</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">UP-TO-DATE</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">AVAILABLE</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">AGE</span></span>
<span class="line"><span style="color:#B392F0;">deployment.apps/ingress-nginx-controller</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">2</span><span style="color:#9ECBFF;">/2</span><span style="color:#E1E4E8;">     </span><span style="color:#79B8FF;">2</span><span style="color:#E1E4E8;">            </span><span style="color:#79B8FF;">2</span><span style="color:#E1E4E8;">           </span><span style="color:#79B8FF;">35</span><span style="color:#9ECBFF;">m</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">NAME</span><span style="color:#E1E4E8;">                                                  </span><span style="color:#9ECBFF;">DESIRED</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">CURRENT</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">READY</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">AGE</span></span>
<span class="line"><span style="color:#B392F0;">replicaset.apps/ingress-nginx-controller-5b88878bf4</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">2</span><span style="color:#E1E4E8;">         </span><span style="color:#79B8FF;">2</span><span style="color:#E1E4E8;">         </span><span style="color:#79B8FF;">2</span><span style="color:#E1E4E8;">       </span><span style="color:#79B8FF;">35</span><span style="color:#9ECBFF;">m</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">[root@kube-master-01 helm_project]# kg all -ningress-nginx</span></span>
<span class="line"><span style="color:#6F42C1;">NAME</span><span style="color:#24292E;">                                            </span><span style="color:#032F62;">READY</span><span style="color:#24292E;">   </span><span style="color:#032F62;">STATUS</span><span style="color:#24292E;">    </span><span style="color:#032F62;">RESTARTS</span><span style="color:#24292E;">   </span><span style="color:#032F62;">AGE</span></span>
<span class="line"><span style="color:#6F42C1;">pod/ingress-nginx-controller-5b88878bf4-swz6f</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">1</span><span style="color:#032F62;">/1</span><span style="color:#24292E;">     </span><span style="color:#032F62;">Running</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">          </span><span style="color:#005CC5;">35</span><span style="color:#032F62;">m</span></span>
<span class="line"><span style="color:#6F42C1;">pod/ingress-nginx-controller-5b88878bf4-z2spz</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">1</span><span style="color:#032F62;">/1</span><span style="color:#24292E;">     </span><span style="color:#032F62;">Running</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">          </span><span style="color:#005CC5;">35</span><span style="color:#032F62;">m</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">NAME</span><span style="color:#24292E;">                                         </span><span style="color:#032F62;">TYPE</span><span style="color:#24292E;">           </span><span style="color:#032F62;">CLUSTER-IP</span><span style="color:#24292E;">        </span><span style="color:#032F62;">EXTERNAL-IP</span><span style="color:#24292E;">     </span><span style="color:#032F62;">PORT</span><span style="color:#24292E;">(</span><span style="color:#6F42C1;">S</span><span style="color:#24292E;">)     </span><span style="color:#032F62;">AGE</span></span>
<span class="line"><span style="color:#6F42C1;">service/ingress-nginx-controller</span><span style="color:#24292E;">             </span><span style="color:#032F62;">LoadBalancer</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">192.168</span><span style="color:#032F62;">.142.60</span><span style="color:#24292E;">    </span><span style="color:#005CC5;">10.103</span><span style="color:#032F62;">.236.70</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">80</span><span style="color:#032F62;">:32057/TCP,443:58699/TCP</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">35</span><span style="color:#032F62;">m</span></span>
<span class="line"><span style="color:#6F42C1;">service/ingress-nginx-controller-admission</span><span style="color:#24292E;">   </span><span style="color:#032F62;">ClusterIP</span><span style="color:#24292E;">      </span><span style="color:#005CC5;">192.168</span><span style="color:#032F62;">.105.131</span><span style="color:#24292E;">   </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">non</span><span style="color:#24292E;">e</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;">          </span><span style="color:#005CC5;">443</span><span style="color:#032F62;">/TCP</span><span style="color:#24292E;">     </span><span style="color:#005CC5;">35</span><span style="color:#032F62;">m</span></span>
<span class="line"><span style="color:#6F42C1;">service/ingress-nginx-controller-metrics</span><span style="color:#24292E;">     </span><span style="color:#032F62;">ClusterIP</span><span style="color:#24292E;">      </span><span style="color:#005CC5;">192.168</span><span style="color:#032F62;">.12.140</span><span style="color:#24292E;">    </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">non</span><span style="color:#24292E;">e</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;">          </span><span style="color:#005CC5;">10254</span><span style="color:#032F62;">/TCP</span><span style="color:#24292E;">     </span><span style="color:#005CC5;">35</span><span style="color:#032F62;">m</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">NAME</span><span style="color:#24292E;">                                       </span><span style="color:#032F62;">READY</span><span style="color:#24292E;">   </span><span style="color:#032F62;">UP-TO-DATE</span><span style="color:#24292E;">   </span><span style="color:#032F62;">AVAILABLE</span><span style="color:#24292E;">   </span><span style="color:#032F62;">AGE</span></span>
<span class="line"><span style="color:#6F42C1;">deployment.apps/ingress-nginx-controller</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">2</span><span style="color:#032F62;">/2</span><span style="color:#24292E;">     </span><span style="color:#005CC5;">2</span><span style="color:#24292E;">            </span><span style="color:#005CC5;">2</span><span style="color:#24292E;">           </span><span style="color:#005CC5;">35</span><span style="color:#032F62;">m</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">NAME</span><span style="color:#24292E;">                                                  </span><span style="color:#032F62;">DESIRED</span><span style="color:#24292E;">   </span><span style="color:#032F62;">CURRENT</span><span style="color:#24292E;">   </span><span style="color:#032F62;">READY</span><span style="color:#24292E;">   </span><span style="color:#032F62;">AGE</span></span>
<span class="line"><span style="color:#6F42C1;">replicaset.apps/ingress-nginx-controller-5b88878bf4</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">2</span><span style="color:#24292E;">         </span><span style="color:#005CC5;">2</span><span style="color:#24292E;">         </span><span style="color:#005CC5;">2</span><span style="color:#24292E;">       </span><span style="color:#005CC5;">35</span><span style="color:#032F62;">m</span></span></code></pre></div><h2 id="_1-2-验证ingress" tabindex="-1">1.2 验证ingress <a class="header-anchor" href="#_1-2-验证ingress" aria-label="Permalink to &quot;1.2 验证ingress&quot;">​</a></h2><h3 id="_1-创建yaml文件" tabindex="-1">1.创建yaml文件 <a class="header-anchor" href="#_1-创建yaml文件" aria-label="Permalink to &quot;1.创建yaml文件&quot;">​</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">create</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">deployment</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">demoapp</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--image=registry.cn-zhangjiakou.aliyuncs.com/hsuing/demoapp:v1</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--replicas=2</span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">--dry-run=client</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-oyaml</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">1</span><span style="color:#9ECBFF;">.demoapp-deployment.yaml</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">apply</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-f</span><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">demoapp-deployment.yaml</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">[root@kube-master-01 helm_project]#  kubectl get pods  -o wide --show-labels -l app=demoapp</span></span>
<span class="line"><span style="color:#B392F0;">NAME</span><span style="color:#E1E4E8;">                       </span><span style="color:#9ECBFF;">READY</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">STATUS</span><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">RESTARTS</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">AGE</span><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">IP</span><span style="color:#E1E4E8;">             </span><span style="color:#9ECBFF;">NODE</span><span style="color:#E1E4E8;">           </span><span style="color:#9ECBFF;">NOMINATED</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">NODE</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">READINESS</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">GATES</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">LABELS</span></span>
<span class="line"><span style="color:#B392F0;">demoapp-7cc687d895-8xltm</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">1</span><span style="color:#9ECBFF;">/1</span><span style="color:#E1E4E8;">     </span><span style="color:#9ECBFF;">Running</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">          </span><span style="color:#79B8FF;">113</span><span style="color:#9ECBFF;">s</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">172.25</span><span style="color:#9ECBFF;">.241.5</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">kube-node-02</span><span style="color:#E1E4E8;">   </span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">non</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;">           </span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">non</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;">          </span><span style="color:#9ECBFF;">app=demoapp,pod-template-hash=</span><span style="color:#79B8FF;">7</span><span style="color:#9ECBFF;">cc687d895</span></span>
<span class="line"><span style="color:#B392F0;">demoapp-7cc687d895-ptr24</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">1</span><span style="color:#9ECBFF;">/1</span><span style="color:#E1E4E8;">     </span><span style="color:#9ECBFF;">Running</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">          </span><span style="color:#79B8FF;">113</span><span style="color:#9ECBFF;">s</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">172.18</span><span style="color:#9ECBFF;">.10.94</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">kube-node-01</span><span style="color:#E1E4E8;">   </span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">non</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;">           </span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">non</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;">          </span><span style="color:#9ECBFF;">app=demoapp,pod-template-hash=</span><span style="color:#79B8FF;">7</span><span style="color:#9ECBFF;">cc687d895</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">create</span><span style="color:#24292E;"> </span><span style="color:#032F62;">deployment</span><span style="color:#24292E;"> </span><span style="color:#032F62;">demoapp</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--image=registry.cn-zhangjiakou.aliyuncs.com/hsuing/demoapp:v1</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--replicas=2</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">--dry-run=client</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-oyaml</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1</span><span style="color:#032F62;">.demoapp-deployment.yaml</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">apply</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-f</span><span style="color:#24292E;">  </span><span style="color:#032F62;">demoapp-deployment.yaml</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">[root@kube-master-01 helm_project]#  kubectl get pods  -o wide --show-labels -l app=demoapp</span></span>
<span class="line"><span style="color:#6F42C1;">NAME</span><span style="color:#24292E;">                       </span><span style="color:#032F62;">READY</span><span style="color:#24292E;">   </span><span style="color:#032F62;">STATUS</span><span style="color:#24292E;">    </span><span style="color:#032F62;">RESTARTS</span><span style="color:#24292E;">   </span><span style="color:#032F62;">AGE</span><span style="color:#24292E;">    </span><span style="color:#032F62;">IP</span><span style="color:#24292E;">             </span><span style="color:#032F62;">NODE</span><span style="color:#24292E;">           </span><span style="color:#032F62;">NOMINATED</span><span style="color:#24292E;"> </span><span style="color:#032F62;">NODE</span><span style="color:#24292E;">   </span><span style="color:#032F62;">READINESS</span><span style="color:#24292E;"> </span><span style="color:#032F62;">GATES</span><span style="color:#24292E;">   </span><span style="color:#032F62;">LABELS</span></span>
<span class="line"><span style="color:#6F42C1;">demoapp-7cc687d895-8xltm</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">1</span><span style="color:#032F62;">/1</span><span style="color:#24292E;">     </span><span style="color:#032F62;">Running</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">          </span><span style="color:#005CC5;">113</span><span style="color:#032F62;">s</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">172.25</span><span style="color:#032F62;">.241.5</span><span style="color:#24292E;">   </span><span style="color:#032F62;">kube-node-02</span><span style="color:#24292E;">   </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">non</span><span style="color:#24292E;">e</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;">           </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">non</span><span style="color:#24292E;">e</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;">          </span><span style="color:#032F62;">app=demoapp,pod-template-hash=</span><span style="color:#005CC5;">7</span><span style="color:#032F62;">cc687d895</span></span>
<span class="line"><span style="color:#6F42C1;">demoapp-7cc687d895-ptr24</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">1</span><span style="color:#032F62;">/1</span><span style="color:#24292E;">     </span><span style="color:#032F62;">Running</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">          </span><span style="color:#005CC5;">113</span><span style="color:#032F62;">s</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">172.18</span><span style="color:#032F62;">.10.94</span><span style="color:#24292E;">   </span><span style="color:#032F62;">kube-node-01</span><span style="color:#24292E;">   </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">non</span><span style="color:#24292E;">e</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;">           </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">non</span><span style="color:#24292E;">e</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;">          </span><span style="color:#032F62;">app=demoapp,pod-template-hash=</span><span style="color:#005CC5;">7</span><span style="color:#032F62;">cc687d895</span></span></code></pre></div><h3 id="_2-创建service对象" tabindex="-1">2.创建service对象 <a class="header-anchor" href="#_2-创建service对象" aria-label="Permalink to &quot;2.创建service对象&quot;">​</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">create</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">service</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">clusterip</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">demoapp-svc</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--tcp=80:80</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--dry-run=client</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-oyaml</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2</span><span style="color:#9ECBFF;">.demoapp-service.yaml</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">apply</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-f</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2</span><span style="color:#9ECBFF;">.demoapp-service.yaml</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#查看svc</span></span>
<span class="line"><span style="color:#E1E4E8;">[root@kube-master-01 helm_project]# kg svc</span></span>
<span class="line"><span style="color:#B392F0;">NAME</span><span style="color:#E1E4E8;">          </span><span style="color:#9ECBFF;">TYPE</span><span style="color:#E1E4E8;">        </span><span style="color:#9ECBFF;">CLUSTER-IP</span><span style="color:#E1E4E8;">       </span><span style="color:#9ECBFF;">EXTERNAL-IP</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">PORT</span><span style="color:#E1E4E8;">(</span><span style="color:#B392F0;">S</span><span style="color:#E1E4E8;">)   </span><span style="color:#9ECBFF;">AGE</span></span>
<span class="line"><span style="color:#B392F0;">demoapp-svc</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">ClusterIP</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">192.168</span><span style="color:#9ECBFF;">.1.234</span><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">non</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;">        </span><span style="color:#79B8FF;">80</span><span style="color:#9ECBFF;">/TCP</span><span style="color:#E1E4E8;">    </span><span style="color:#79B8FF;">45</span><span style="color:#9ECBFF;">s</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#访问</span></span>
<span class="line"><span style="color:#E1E4E8;">[root@kube-master-01 helm_project]# curl 192.168.1.234</span></span>
<span class="line"><span style="color:#B392F0;">hsuing</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">demoapp</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">v1.1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">!!</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">ClientIP:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">172.18</span><span style="color:#9ECBFF;">.201.64,</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">PodName:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">demoapp-7cc687d895-8xltm,</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">PodIP:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">172.25</span><span style="color:#9ECBFF;">.241.5!</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">create</span><span style="color:#24292E;"> </span><span style="color:#032F62;">service</span><span style="color:#24292E;"> </span><span style="color:#032F62;">clusterip</span><span style="color:#24292E;"> </span><span style="color:#032F62;">demoapp-svc</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--tcp=80:80</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--dry-run=client</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-oyaml</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2</span><span style="color:#032F62;">.demoapp-service.yaml</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">apply</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-f</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2</span><span style="color:#032F62;">.demoapp-service.yaml</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#查看svc</span></span>
<span class="line"><span style="color:#24292E;">[root@kube-master-01 helm_project]# kg svc</span></span>
<span class="line"><span style="color:#6F42C1;">NAME</span><span style="color:#24292E;">          </span><span style="color:#032F62;">TYPE</span><span style="color:#24292E;">        </span><span style="color:#032F62;">CLUSTER-IP</span><span style="color:#24292E;">       </span><span style="color:#032F62;">EXTERNAL-IP</span><span style="color:#24292E;">   </span><span style="color:#032F62;">PORT</span><span style="color:#24292E;">(</span><span style="color:#6F42C1;">S</span><span style="color:#24292E;">)   </span><span style="color:#032F62;">AGE</span></span>
<span class="line"><span style="color:#6F42C1;">demoapp-svc</span><span style="color:#24292E;">   </span><span style="color:#032F62;">ClusterIP</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">192.168</span><span style="color:#032F62;">.1.234</span><span style="color:#24292E;">    </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">non</span><span style="color:#24292E;">e</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;">        </span><span style="color:#005CC5;">80</span><span style="color:#032F62;">/TCP</span><span style="color:#24292E;">    </span><span style="color:#005CC5;">45</span><span style="color:#032F62;">s</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#访问</span></span>
<span class="line"><span style="color:#24292E;">[root@kube-master-01 helm_project]# curl 192.168.1.234</span></span>
<span class="line"><span style="color:#6F42C1;">hsuing</span><span style="color:#24292E;"> </span><span style="color:#032F62;">demoapp</span><span style="color:#24292E;"> </span><span style="color:#032F62;">v1.1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">!!</span><span style="color:#24292E;"> </span><span style="color:#032F62;">ClientIP:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">172.18</span><span style="color:#032F62;">.201.64,</span><span style="color:#24292E;"> </span><span style="color:#032F62;">PodName:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">demoapp-7cc687d895-8xltm,</span><span style="color:#24292E;"> </span><span style="color:#032F62;">PodIP:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">172.25</span><span style="color:#032F62;">.241.5!</span></span></code></pre></div><h3 id="_3-创建ingress" tabindex="-1">3.创建ingress <a class="header-anchor" href="#_3-创建ingress" aria-label="Permalink to &quot;3.创建ingress&quot;">​</a></h3><p>为demoapp-service创建ingress</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">create</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">ingress</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">demoapp</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--rule=</span><span style="color:#9ECBFF;">&#39;demoapp.han.net/*&#39;</span><span style="color:#79B8FF;">=demoapp-svc:80</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--class=nginx</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--dry-run=client</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-o</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">yaml</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">demoapp-ingress.yaml</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#创建</span></span>
<span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">apply</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-f</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">demoapp-ingress.yaml</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#查看ingress,大约几秒钟之后，就自动从 OpenELB 那边取到 IP </span></span>
<span class="line"><span style="color:#E1E4E8;">[root@kube-master-01 helm_project]# kubectl get ingress</span></span>
<span class="line"><span style="color:#B392F0;">NAME</span><span style="color:#E1E4E8;">      </span><span style="color:#9ECBFF;">CLASS</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">HOSTS</span><span style="color:#E1E4E8;">             </span><span style="color:#9ECBFF;">ADDRESS</span><span style="color:#E1E4E8;">         </span><span style="color:#9ECBFF;">PORTS</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">AGE</span></span>
<span class="line"><span style="color:#B392F0;">demoapp</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">nginx</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">demoapp.han.net</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">10.103</span><span style="color:#9ECBFF;">.236.70</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">80</span><span style="color:#E1E4E8;">      </span><span style="color:#79B8FF;">9</span><span style="color:#9ECBFF;">s</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">create</span><span style="color:#24292E;"> </span><span style="color:#032F62;">ingress</span><span style="color:#24292E;"> </span><span style="color:#032F62;">demoapp</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--rule=</span><span style="color:#032F62;">&#39;demoapp.han.net/*&#39;</span><span style="color:#005CC5;">=demoapp-svc:80</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--class=nginx</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--dry-run=client</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-o</span><span style="color:#24292E;"> </span><span style="color:#032F62;">yaml</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">demoapp-ingress.yaml</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#创建</span></span>
<span class="line"><span style="color:#6F42C1;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">apply</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-f</span><span style="color:#24292E;"> </span><span style="color:#032F62;">demoapp-ingress.yaml</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#查看ingress,大约几秒钟之后，就自动从 OpenELB 那边取到 IP </span></span>
<span class="line"><span style="color:#24292E;">[root@kube-master-01 helm_project]# kubectl get ingress</span></span>
<span class="line"><span style="color:#6F42C1;">NAME</span><span style="color:#24292E;">      </span><span style="color:#032F62;">CLASS</span><span style="color:#24292E;">   </span><span style="color:#032F62;">HOSTS</span><span style="color:#24292E;">             </span><span style="color:#032F62;">ADDRESS</span><span style="color:#24292E;">         </span><span style="color:#032F62;">PORTS</span><span style="color:#24292E;">   </span><span style="color:#032F62;">AGE</span></span>
<span class="line"><span style="color:#6F42C1;">demoapp</span><span style="color:#24292E;">   </span><span style="color:#032F62;">nginx</span><span style="color:#24292E;">   </span><span style="color:#032F62;">demoapp.han.net</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">10.103</span><span style="color:#032F62;">.236.70</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">80</span><span style="color:#24292E;">      </span><span style="color:#005CC5;">9</span><span style="color:#032F62;">s</span></span></code></pre></div><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">从旧 Pod 故障，到新 Pod 正常运行，这个过程大约经历了 6 分钟；</span></span>
<span class="line"><span style="color:#e1e4e8;">这个时间的长短，取决于节点的健康检查周期，节点失效确认时间 --node-monitor-grace-period，</span></span>
<span class="line"><span style="color:#e1e4e8;">以及 Pod 驱逐超时时间 --pod-eviction-timeout</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">从旧 Pod 故障，到新 Pod 正常运行，这个过程大约经历了 6 分钟；</span></span>
<span class="line"><span style="color:#24292e;">这个时间的长短，取决于节点的健康检查周期，节点失效确认时间 --node-monitor-grace-period，</span></span>
<span class="line"><span style="color:#24292e;">以及 Pod 驱逐超时时间 --pod-eviction-timeout</span></span></code></pre></div><h2 id="_1-3-修改ingress-nginx配置" tabindex="-1">1.3 修改ingress-nginx配置 <a class="header-anchor" href="#_1-3-修改ingress-nginx配置" aria-label="Permalink to &quot;1.3 修改ingress-nginx配置&quot;">​</a></h2><p><a href="https://kubernetes.github.io/ingress-nginx/user-guide/nginx-configuration/configmap" target="_blank" rel="noreferrer">https://kubernetes.github.io/ingress-nginx/user-guide/nginx-configuration/configmap</a></p><p><a href="http://nginx.org/en/docs/ngx_core_module.html#worker_rlimit_nofile" target="_blank" rel="noreferrer">http://nginx.org/en/docs/ngx_core_module.html#worker_rlimit_nofile</a></p><p><a href="http://nginx.org/en/docs/ngx_core_module.html#worker_processes" target="_blank" rel="noreferrer">http://nginx.org/en/docs/ngx_core_module.html#worker_processes</a></p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#9ECBFF;">vim /root/helm_project/ingress-nginx/ingress-nginx-value.yaml</span></span>
<span class="line"><span style="color:#85E89D;">controller</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Deployment</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># 部署模式</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">config</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">#允许注解</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">allow-snippet-annotations</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;true&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">keep-alive-requests</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;10000&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">upstream-keepalive-connections</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;200&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">max-worker-connections</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;65536&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">max-worker-open-files</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;655350&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">worker-cpu-affinity</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;auto&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">worker-processes</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;auto&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">server-tokens</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;false&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">#全 局 禁 用 308重 定 向</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">ssl-redirect</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;false&quot;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#032F62;">vim /root/helm_project/ingress-nginx/ingress-nginx-value.yaml</span></span>
<span class="line"><span style="color:#22863A;">controller</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">kind</span><span style="color:#24292E;">: </span><span style="color:#032F62;">Deployment</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 部署模式</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">config</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">#允许注解</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">allow-snippet-annotations</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;true&quot;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">keep-alive-requests</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;10000&quot;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">upstream-keepalive-connections</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;200&quot;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">max-worker-connections</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;65536&quot;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">max-worker-open-files</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;655350&quot;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">worker-cpu-affinity</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;auto&quot;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">worker-processes</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;auto&quot;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">server-tokens</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;false&quot;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">#全 局 禁 用 308重 定 向</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">ssl-redirect</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;false&quot;</span></span></code></pre></div><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">server-name-hash-bucket-size: &quot;128&quot; </span></span>
<span class="line"><span style="color:#e1e4e8;"> client-body-timeout: &quot;60&quot; </span></span>
<span class="line"><span style="color:#e1e4e8;"> client-header-buffer-size: &quot;8k&quot; </span></span>
<span class="line"><span style="color:#e1e4e8;"> large-client-header-buffers: &quot;4 32k&quot; </span></span>
<span class="line"><span style="color:#e1e4e8;"> proxy-body-size: &quot;256m&quot; </span></span>
<span class="line"><span style="color:#e1e4e8;"> client-body-buffer-size: &quot;128k&quot; </span></span>
<span class="line"><span style="color:#e1e4e8;"> http2-max-concurrent-streams: &quot;64&quot; </span></span>
<span class="line"><span style="color:#e1e4e8;"> http2-max-field-size: &quot;16k&quot; </span></span>
<span class="line"><span style="color:#e1e4e8;"> keep-alive: &quot;30&quot; </span></span>
<span class="line"><span style="color:#e1e4e8;"> proxy-connect-timeout: &quot;15&quot; </span></span>
<span class="line"><span style="color:#e1e4e8;"> proxy-send-timeout: &quot;60&quot; </span></span>
<span class="line"><span style="color:#e1e4e8;"> proxy-read-timeout: &quot;60&quot; </span></span>
<span class="line"><span style="color:#e1e4e8;"> proxy-buffer-size: &quot;128k&quot; </span></span>
<span class="line"><span style="color:#e1e4e8;"> proxy-buffers-number: &quot;32&quot; </span></span>
<span class="line"><span style="color:#e1e4e8;"> proxy-headers-hash-max-size: &quot;51200&quot; </span></span>
<span class="line"><span style="color:#e1e4e8;"> proxy-headers-hash-bucket-size: &quot;6400&quot; </span></span>
<span class="line"><span style="color:#e1e4e8;"> proxy-next-upstream: &quot;error timeout http_500 http_502 http_503 http_504&quot; </span></span>
<span class="line"><span style="color:#e1e4e8;"> use-gzip: &quot;true&quot; </span></span>
<span class="line"><span style="color:#e1e4e8;"> gzip-min-length: &quot;1000&quot; </span></span>
<span class="line"><span style="color:#e1e4e8;"> gzip-level: &quot;1&quot; </span></span>
<span class="line"><span style="color:#e1e4e8;"> gzip-types: &quot;text/plain application/x-javascript text/css application/xml application/json&quot; </span></span>
<span class="line"><span style="color:#e1e4e8;"> ssl-protocols: &quot;TLSv1 TLSv1.1 TLSv1.2&quot; </span></span>
<span class="line"><span style="color:#e1e4e8;"> ssl-ciphers: &quot;ECDHE-RSA-AES128-GCM-SHA256:AES256+EECDH:AES256+EDH&quot; </span></span>
<span class="line"><span style="color:#e1e4e8;"> ssl-buffer-size: &quot;16k&quot; </span></span>
<span class="line"><span style="color:#e1e4e8;"> ssl-session-cache: &quot;true&quot; </span></span>
<span class="line"><span style="color:#e1e4e8;"> ssl-session-timeout: &quot;5m&quot; </span></span>
<span class="line"><span style="color:#e1e4e8;"> ssl-dh-param: &quot;/etc/nginx/pem/dhparam.pem&quot; </span></span>
<span class="line"><span style="color:#e1e4e8;"> log-format-upstream:</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">server-name-hash-bucket-size: &quot;128&quot; </span></span>
<span class="line"><span style="color:#24292e;"> client-body-timeout: &quot;60&quot; </span></span>
<span class="line"><span style="color:#24292e;"> client-header-buffer-size: &quot;8k&quot; </span></span>
<span class="line"><span style="color:#24292e;"> large-client-header-buffers: &quot;4 32k&quot; </span></span>
<span class="line"><span style="color:#24292e;"> proxy-body-size: &quot;256m&quot; </span></span>
<span class="line"><span style="color:#24292e;"> client-body-buffer-size: &quot;128k&quot; </span></span>
<span class="line"><span style="color:#24292e;"> http2-max-concurrent-streams: &quot;64&quot; </span></span>
<span class="line"><span style="color:#24292e;"> http2-max-field-size: &quot;16k&quot; </span></span>
<span class="line"><span style="color:#24292e;"> keep-alive: &quot;30&quot; </span></span>
<span class="line"><span style="color:#24292e;"> proxy-connect-timeout: &quot;15&quot; </span></span>
<span class="line"><span style="color:#24292e;"> proxy-send-timeout: &quot;60&quot; </span></span>
<span class="line"><span style="color:#24292e;"> proxy-read-timeout: &quot;60&quot; </span></span>
<span class="line"><span style="color:#24292e;"> proxy-buffer-size: &quot;128k&quot; </span></span>
<span class="line"><span style="color:#24292e;"> proxy-buffers-number: &quot;32&quot; </span></span>
<span class="line"><span style="color:#24292e;"> proxy-headers-hash-max-size: &quot;51200&quot; </span></span>
<span class="line"><span style="color:#24292e;"> proxy-headers-hash-bucket-size: &quot;6400&quot; </span></span>
<span class="line"><span style="color:#24292e;"> proxy-next-upstream: &quot;error timeout http_500 http_502 http_503 http_504&quot; </span></span>
<span class="line"><span style="color:#24292e;"> use-gzip: &quot;true&quot; </span></span>
<span class="line"><span style="color:#24292e;"> gzip-min-length: &quot;1000&quot; </span></span>
<span class="line"><span style="color:#24292e;"> gzip-level: &quot;1&quot; </span></span>
<span class="line"><span style="color:#24292e;"> gzip-types: &quot;text/plain application/x-javascript text/css application/xml application/json&quot; </span></span>
<span class="line"><span style="color:#24292e;"> ssl-protocols: &quot;TLSv1 TLSv1.1 TLSv1.2&quot; </span></span>
<span class="line"><span style="color:#24292e;"> ssl-ciphers: &quot;ECDHE-RSA-AES128-GCM-SHA256:AES256+EECDH:AES256+EDH&quot; </span></span>
<span class="line"><span style="color:#24292e;"> ssl-buffer-size: &quot;16k&quot; </span></span>
<span class="line"><span style="color:#24292e;"> ssl-session-cache: &quot;true&quot; </span></span>
<span class="line"><span style="color:#24292e;"> ssl-session-timeout: &quot;5m&quot; </span></span>
<span class="line"><span style="color:#24292e;"> ssl-dh-param: &quot;/etc/nginx/pem/dhparam.pem&quot; </span></span>
<span class="line"><span style="color:#24292e;"> log-format-upstream:</span></span></code></pre></div>`,55),e=[o];function t(c,r,y,E,i,F){return n(),a("div",null,e)}const g=s(p,[["render",t]]);export{d as __pageData,g as default};
