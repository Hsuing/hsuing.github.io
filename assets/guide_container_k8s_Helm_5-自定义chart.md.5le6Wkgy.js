import{_ as s,o as a,c as n,R as l}from"./chunks/framework.zUbWieqp.js";const h=JSON.parse('{"title":"","description":"","frontmatter":{},"headers":[],"relativePath":"guide/container/k8s/Helm/5-自定义chart.md","filePath":"guide/container/k8s/Helm/5-自定义chart.md","lastUpdated":1722236838000}'),p={name:"guide/container/k8s/Helm/5-自定义chart.md"},o=l(`<h2 id="_1-手动发布helm" tabindex="-1">1. 手动发布Helm <a class="header-anchor" href="#_1-手动发布helm" aria-label="Permalink to &quot;1. 手动发布Helm&quot;">​</a></h2><h3 id="_1-1-创建" tabindex="-1">1.1 创建 <a class="header-anchor" href="#_1-1-创建" aria-label="Permalink to &quot;1.1 创建&quot;">​</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">helm</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">create</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">demo</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">helm</span><span style="color:#24292E;"> </span><span style="color:#032F62;">create</span><span style="color:#24292E;"> </span><span style="color:#032F62;">demo</span></span></code></pre></div><ul><li>查看目录结构</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">[root@kube-master demo]# tree -L 2</span></span>
<span class="line"><span style="color:#79B8FF;">.</span></span>
<span class="line"><span style="color:#B392F0;">├──</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">charts</span></span>
<span class="line"><span style="color:#B392F0;">├──</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Chart.yaml</span></span>
<span class="line"><span style="color:#B392F0;">├──</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">templates</span></span>
<span class="line"><span style="color:#B392F0;">│  </span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">├──</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">deployment.yaml</span></span>
<span class="line"><span style="color:#B392F0;">│  </span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">├──</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">_helpers.tpl</span></span>
<span class="line"><span style="color:#B392F0;">│  </span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">├──</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">hpa.yaml</span></span>
<span class="line"><span style="color:#B392F0;">│  </span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">├──</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">ingress.yaml</span></span>
<span class="line"><span style="color:#B392F0;">│  </span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">├──</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">NOTES.txt</span></span>
<span class="line"><span style="color:#B392F0;">│  </span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">├──</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">serviceaccount.yaml</span></span>
<span class="line"><span style="color:#B392F0;">│  </span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">├──</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">service.yaml</span></span>
<span class="line"><span style="color:#B392F0;">│  </span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">└──</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">tests</span></span>
<span class="line"><span style="color:#B392F0;">└──</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">values.yaml</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">3</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">directories,</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">9</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">files</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">[root@kube-master demo]# tree -L 2</span></span>
<span class="line"><span style="color:#005CC5;">.</span></span>
<span class="line"><span style="color:#6F42C1;">├──</span><span style="color:#24292E;"> </span><span style="color:#032F62;">charts</span></span>
<span class="line"><span style="color:#6F42C1;">├──</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Chart.yaml</span></span>
<span class="line"><span style="color:#6F42C1;">├──</span><span style="color:#24292E;"> </span><span style="color:#032F62;">templates</span></span>
<span class="line"><span style="color:#6F42C1;">│  </span><span style="color:#24292E;"> </span><span style="color:#032F62;">├──</span><span style="color:#24292E;"> </span><span style="color:#032F62;">deployment.yaml</span></span>
<span class="line"><span style="color:#6F42C1;">│  </span><span style="color:#24292E;"> </span><span style="color:#032F62;">├──</span><span style="color:#24292E;"> </span><span style="color:#032F62;">_helpers.tpl</span></span>
<span class="line"><span style="color:#6F42C1;">│  </span><span style="color:#24292E;"> </span><span style="color:#032F62;">├──</span><span style="color:#24292E;"> </span><span style="color:#032F62;">hpa.yaml</span></span>
<span class="line"><span style="color:#6F42C1;">│  </span><span style="color:#24292E;"> </span><span style="color:#032F62;">├──</span><span style="color:#24292E;"> </span><span style="color:#032F62;">ingress.yaml</span></span>
<span class="line"><span style="color:#6F42C1;">│  </span><span style="color:#24292E;"> </span><span style="color:#032F62;">├──</span><span style="color:#24292E;"> </span><span style="color:#032F62;">NOTES.txt</span></span>
<span class="line"><span style="color:#6F42C1;">│  </span><span style="color:#24292E;"> </span><span style="color:#032F62;">├──</span><span style="color:#24292E;"> </span><span style="color:#032F62;">serviceaccount.yaml</span></span>
<span class="line"><span style="color:#6F42C1;">│  </span><span style="color:#24292E;"> </span><span style="color:#032F62;">├──</span><span style="color:#24292E;"> </span><span style="color:#032F62;">service.yaml</span></span>
<span class="line"><span style="color:#6F42C1;">│  </span><span style="color:#24292E;"> </span><span style="color:#032F62;">└──</span><span style="color:#24292E;"> </span><span style="color:#032F62;">tests</span></span>
<span class="line"><span style="color:#6F42C1;">└──</span><span style="color:#24292E;"> </span><span style="color:#032F62;">values.yaml</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">3</span><span style="color:#24292E;"> </span><span style="color:#032F62;">directories,</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">9</span><span style="color:#24292E;"> </span><span style="color:#032F62;">files</span></span></code></pre></div><ul><li>修改配置文件</li></ul><ol><li>编辑自描述文件 Chart.yaml , 修改version和appVersion信息</li></ol><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#85E89D;">apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">v2</span></span>
<span class="line"><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">demo</span></span>
<span class="line"><span style="color:#85E89D;">description</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">A Helm chart for Kubernetes</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># A chart can be either an &#39;application&#39; or a &#39;library&#39; chart.</span></span>
<span class="line"><span style="color:#6A737D;">#</span></span>
<span class="line"><span style="color:#6A737D;"># Application charts are a collection of templates that can be packaged into versioned archives</span></span>
<span class="line"><span style="color:#6A737D;"># to be deployed.</span></span>
<span class="line"><span style="color:#6A737D;">#</span></span>
<span class="line"><span style="color:#6A737D;"># Library charts provide useful utilities or functions for the chart developer. They&#39;re included as</span></span>
<span class="line"><span style="color:#6A737D;"># a dependency of application charts to inject those utilities and functions into the rendering</span></span>
<span class="line"><span style="color:#6A737D;"># pipeline. Library charts do not define any templates and therefore cannot be deployed.</span></span>
<span class="line"><span style="color:#85E89D;">type</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">application</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># This is the chart version. This version number should be incremented each time you make changes</span></span>
<span class="line"><span style="color:#6A737D;"># to the chart and its templates, including the app version.</span></span>
<span class="line"><span style="color:#6A737D;"># Versions are expected to follow Semantic Versioning (https://semver.org/)</span></span>
<span class="line"><span style="color:#85E89D;">version</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">1.0.0</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># 修改 项目版本号</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># This is the version number of the application being deployed. This version number should be</span></span>
<span class="line"><span style="color:#6A737D;"># incremented each time you make changes to the application. Versions are not expected to</span></span>
<span class="line"><span style="color:#6A737D;"># follow Semantic Versioning. They should reflect the version the application is using.</span></span>
<span class="line"><span style="color:#6A737D;"># It is recommended to use it with quotes.</span></span>
<span class="line"><span style="color:#85E89D;">appVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;v1&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># 修改 镜像版本</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#22863A;">apiVersion</span><span style="color:#24292E;">: </span><span style="color:#032F62;">v2</span></span>
<span class="line"><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">demo</span></span>
<span class="line"><span style="color:#22863A;">description</span><span style="color:#24292E;">: </span><span style="color:#032F62;">A Helm chart for Kubernetes</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># A chart can be either an &#39;application&#39; or a &#39;library&#39; chart.</span></span>
<span class="line"><span style="color:#6A737D;">#</span></span>
<span class="line"><span style="color:#6A737D;"># Application charts are a collection of templates that can be packaged into versioned archives</span></span>
<span class="line"><span style="color:#6A737D;"># to be deployed.</span></span>
<span class="line"><span style="color:#6A737D;">#</span></span>
<span class="line"><span style="color:#6A737D;"># Library charts provide useful utilities or functions for the chart developer. They&#39;re included as</span></span>
<span class="line"><span style="color:#6A737D;"># a dependency of application charts to inject those utilities and functions into the rendering</span></span>
<span class="line"><span style="color:#6A737D;"># pipeline. Library charts do not define any templates and therefore cannot be deployed.</span></span>
<span class="line"><span style="color:#22863A;">type</span><span style="color:#24292E;">: </span><span style="color:#032F62;">application</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># This is the chart version. This version number should be incremented each time you make changes</span></span>
<span class="line"><span style="color:#6A737D;"># to the chart and its templates, including the app version.</span></span>
<span class="line"><span style="color:#6A737D;"># Versions are expected to follow Semantic Versioning (https://semver.org/)</span></span>
<span class="line"><span style="color:#22863A;">version</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">1.0.0</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 修改 项目版本号</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># This is the version number of the application being deployed. This version number should be</span></span>
<span class="line"><span style="color:#6A737D;"># incremented each time you make changes to the application. Versions are not expected to</span></span>
<span class="line"><span style="color:#6A737D;"># follow Semantic Versioning. They should reflect the version the application is using.</span></span>
<span class="line"><span style="color:#6A737D;"># It is recommended to use it with quotes.</span></span>
<span class="line"><span style="color:#22863A;">appVersion</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;v1&quot;</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 修改 镜像版本</span></span></code></pre></div><ol start="2"><li>编辑values.yaml配置文件</li></ol><p>修改副本数和镜像</p><p><img src="https://nnaigos.oss-cn-hangzhou.aliyuncs.com/imgs/202407161743010.png" alt="image-20240716174336009"></p><h3 id="_1-2-打包chart" tabindex="-1">1.2 打包Chart <a class="header-anchor" href="#_1-2-打包chart" aria-label="Permalink to &quot;1.2 打包Chart&quot;">​</a></h3><ul><li>检查语法是否正确</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">helm</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">lint</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">demo</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">helm</span><span style="color:#24292E;"> </span><span style="color:#032F62;">lint</span><span style="color:#24292E;"> </span><span style="color:#032F62;">demo</span></span></code></pre></div><ul><li>打包自定义的chart</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">[root@kube-master helm]# helm package demo</span></span>
<span class="line"><span style="color:#B392F0;">Successfully</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">packaged</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">chart</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">and</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">saved</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">it</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">to:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/root/helm/demo-0.1.0.tgz</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">[root@kube-master helm]# helm package demo</span></span>
<span class="line"><span style="color:#6F42C1;">Successfully</span><span style="color:#24292E;"> </span><span style="color:#032F62;">packaged</span><span style="color:#24292E;"> </span><span style="color:#032F62;">chart</span><span style="color:#24292E;"> </span><span style="color:#032F62;">and</span><span style="color:#24292E;"> </span><span style="color:#032F62;">saved</span><span style="color:#24292E;"> </span><span style="color:#032F62;">it</span><span style="color:#24292E;"> </span><span style="color:#032F62;">to:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/root/helm/demo-0.1.0.tgz</span></span></code></pre></div><h3 id="_1-3-发布chart" tabindex="-1">1.3 发布Chart <a class="header-anchor" href="#_1-3-发布chart" aria-label="Permalink to &quot;1.3 发布Chart&quot;">​</a></h3><p>将打包好的Chart发布到一个Helm Repository中。可以使用helm repo add命令添加一个Repository，然后使用helm push命令将Chart推送到Repository中</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">helm repo add myrepo https://example.com/charts</span></span>
<span class="line"><span style="color:#e1e4e8;">helm push nginx-helm-1.0.0.tgz myrepo</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">helm repo add myrepo https://example.com/charts</span></span>
<span class="line"><span style="color:#24292e;">helm push nginx-helm-1.0.0.tgz myrepo</span></span></code></pre></div><h3 id="_1-4-安装release" tabindex="-1">1.4 安装Release <a class="header-anchor" href="#_1-4-安装release" aria-label="Permalink to &quot;1.4 安装Release&quot;">​</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">[root@kube-master helm]# helm  install demo demo-0.1.0.tgz</span></span>
<span class="line"><span style="color:#B392F0;">NAME:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">demo</span></span>
<span class="line"><span style="color:#B392F0;">LAST</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">DEPLOYED:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Tue</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Jul</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">16</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">17</span><span style="color:#9ECBFF;">:46:20</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2024</span></span>
<span class="line"><span style="color:#B392F0;">NAMESPACE:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">default</span></span>
<span class="line"><span style="color:#B392F0;">STATUS:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">deployed</span></span>
<span class="line"><span style="color:#B392F0;">REVISION:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">1</span></span>
<span class="line"><span style="color:#B392F0;">NOTES:</span></span>
<span class="line"><span style="color:#B392F0;">1.</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Get</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">the</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">application</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">URL</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">by</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">running</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">these</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">commands:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">export</span><span style="color:#E1E4E8;"> POD_NAME</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">$(</span><span style="color:#B392F0;">kubectl</span><span style="color:#9ECBFF;"> get pods </span><span style="color:#79B8FF;">--namespace</span><span style="color:#9ECBFF;"> default </span><span style="color:#79B8FF;">-l</span><span style="color:#9ECBFF;"> &quot;app.kubernetes.io/name=demo,app.kubernetes.io/instance=demo&quot; </span><span style="color:#79B8FF;">-o</span><span style="color:#9ECBFF;"> jsonpath=&quot;{.items[0].metadata.name}&quot;)</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">export</span><span style="color:#E1E4E8;"> CONTAINER_PORT</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">$(</span><span style="color:#B392F0;">kubectl</span><span style="color:#9ECBFF;"> get pod </span><span style="color:#79B8FF;">--namespace</span><span style="color:#9ECBFF;"> default </span><span style="color:#E1E4E8;">$POD_NAME</span><span style="color:#9ECBFF;"> </span><span style="color:#79B8FF;">-o</span><span style="color:#9ECBFF;"> jsonpath=&quot;{.spec.containers[0].ports[0].containerPort}&quot;)</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">echo</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;Visit http://127.0.0.1:8080 to use your application&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--namespace</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">default</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">port-forward</span><span style="color:#E1E4E8;"> $POD_NAME </span><span style="color:#79B8FF;">8080</span><span style="color:#9ECBFF;">:</span><span style="color:#E1E4E8;">$CONTAINER_PORT</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">[root@kube-master helm]# helm  install demo demo-0.1.0.tgz</span></span>
<span class="line"><span style="color:#6F42C1;">NAME:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">demo</span></span>
<span class="line"><span style="color:#6F42C1;">LAST</span><span style="color:#24292E;"> </span><span style="color:#032F62;">DEPLOYED:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Tue</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Jul</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">16</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">17</span><span style="color:#032F62;">:46:20</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2024</span></span>
<span class="line"><span style="color:#6F42C1;">NAMESPACE:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">default</span></span>
<span class="line"><span style="color:#6F42C1;">STATUS:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">deployed</span></span>
<span class="line"><span style="color:#6F42C1;">REVISION:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1</span></span>
<span class="line"><span style="color:#6F42C1;">NOTES:</span></span>
<span class="line"><span style="color:#6F42C1;">1.</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Get</span><span style="color:#24292E;"> </span><span style="color:#032F62;">the</span><span style="color:#24292E;"> </span><span style="color:#032F62;">application</span><span style="color:#24292E;"> </span><span style="color:#032F62;">URL</span><span style="color:#24292E;"> </span><span style="color:#032F62;">by</span><span style="color:#24292E;"> </span><span style="color:#032F62;">running</span><span style="color:#24292E;"> </span><span style="color:#032F62;">these</span><span style="color:#24292E;"> </span><span style="color:#032F62;">commands:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">export</span><span style="color:#24292E;"> POD_NAME</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">$(</span><span style="color:#6F42C1;">kubectl</span><span style="color:#032F62;"> get pods </span><span style="color:#005CC5;">--namespace</span><span style="color:#032F62;"> default </span><span style="color:#005CC5;">-l</span><span style="color:#032F62;"> &quot;app.kubernetes.io/name=demo,app.kubernetes.io/instance=demo&quot; </span><span style="color:#005CC5;">-o</span><span style="color:#032F62;"> jsonpath=&quot;{.items[0].metadata.name}&quot;)</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">export</span><span style="color:#24292E;"> CONTAINER_PORT</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">$(</span><span style="color:#6F42C1;">kubectl</span><span style="color:#032F62;"> get pod </span><span style="color:#005CC5;">--namespace</span><span style="color:#032F62;"> default </span><span style="color:#24292E;">$POD_NAME</span><span style="color:#032F62;"> </span><span style="color:#005CC5;">-o</span><span style="color:#032F62;"> jsonpath=&quot;{.spec.containers[0].ports[0].containerPort}&quot;)</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#005CC5;">echo</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;Visit http://127.0.0.1:8080 to use your application&quot;</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--namespace</span><span style="color:#24292E;"> </span><span style="color:#032F62;">default</span><span style="color:#24292E;"> </span><span style="color:#032F62;">port-forward</span><span style="color:#24292E;"> $POD_NAME </span><span style="color:#005CC5;">8080</span><span style="color:#032F62;">:</span><span style="color:#24292E;">$CONTAINER_PORT</span></span></code></pre></div><ul><li>查看pod</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">[root@kube-master helm]# kubectl get pod</span></span>
<span class="line"><span style="color:#B392F0;">NAME</span><span style="color:#E1E4E8;">                                      </span><span style="color:#9ECBFF;">READY</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">STATUS</span><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">RESTARTS</span><span style="color:#E1E4E8;">      </span><span style="color:#9ECBFF;">AGE</span></span>
<span class="line"><span style="color:#B392F0;">demo-857bf7c87b-l9lkv</span><span style="color:#E1E4E8;">                     </span><span style="color:#79B8FF;">1</span><span style="color:#9ECBFF;">/1</span><span style="color:#E1E4E8;">     </span><span style="color:#9ECBFF;">Running</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">             </span><span style="color:#79B8FF;">17</span><span style="color:#9ECBFF;">s</span></span>
<span class="line"><span style="color:#B392F0;">demo-857bf7c87b-mrx7x</span><span style="color:#E1E4E8;">                     </span><span style="color:#79B8FF;">1</span><span style="color:#9ECBFF;">/1</span><span style="color:#E1E4E8;">     </span><span style="color:#9ECBFF;">Running</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">             </span><span style="color:#79B8FF;">17</span><span style="color:#9ECBFF;">s</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">[root@kube-master helm]# kubectl get pod</span></span>
<span class="line"><span style="color:#6F42C1;">NAME</span><span style="color:#24292E;">                                      </span><span style="color:#032F62;">READY</span><span style="color:#24292E;">   </span><span style="color:#032F62;">STATUS</span><span style="color:#24292E;">    </span><span style="color:#032F62;">RESTARTS</span><span style="color:#24292E;">      </span><span style="color:#032F62;">AGE</span></span>
<span class="line"><span style="color:#6F42C1;">demo-857bf7c87b-l9lkv</span><span style="color:#24292E;">                     </span><span style="color:#005CC5;">1</span><span style="color:#032F62;">/1</span><span style="color:#24292E;">     </span><span style="color:#032F62;">Running</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">             </span><span style="color:#005CC5;">17</span><span style="color:#032F62;">s</span></span>
<span class="line"><span style="color:#6F42C1;">demo-857bf7c87b-mrx7x</span><span style="color:#24292E;">                     </span><span style="color:#005CC5;">1</span><span style="color:#032F62;">/1</span><span style="color:#24292E;">     </span><span style="color:#032F62;">Running</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">             </span><span style="color:#005CC5;">17</span><span style="color:#032F62;">s</span></span></code></pre></div><h3 id="_1-5-管理release" tabindex="-1">1.5 管理Release <a class="header-anchor" href="#_1-5-管理release" aria-label="Permalink to &quot;1.5 管理Release&quot;">​</a></h3><h4 id="更新" tabindex="-1">更新 <a class="header-anchor" href="#更新" aria-label="Permalink to &quot;更新&quot;">​</a></h4><ol><li>编辑自描述文件 Chart.yaml , 修改version和appVersion信息</li><li>重新打包</li></ol><ul><li>检查语法</li></ul><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">helm lint demo</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">helm lint demo</span></span></code></pre></div><ul><li>打包</li></ul><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">helm package demo</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">helm package demo</span></span></code></pre></div><ol start="3"><li>更新chart</li></ol><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">helm</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">upgrade</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">demo</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">demo-2.0.0.tgz</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">helm</span><span style="color:#24292E;"> </span><span style="color:#032F62;">upgrade</span><span style="color:#24292E;"> </span><span style="color:#032F62;">demo</span><span style="color:#24292E;"> </span><span style="color:#032F62;">demo-2.0.0.tgz</span></span></code></pre></div><h4 id="回滚" tabindex="-1">回滚 <a class="header-anchor" href="#回滚" aria-label="Permalink to &quot;回滚&quot;">​</a></h4><ul><li>查看当前版本</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">[root@kube-master helm]# helm list</span></span>
<span class="line"><span style="color:#B392F0;">NAME</span><span style="color:#E1E4E8;">	</span><span style="color:#9ECBFF;">NAMESPACE</span><span style="color:#E1E4E8;">	</span><span style="color:#9ECBFF;">REVISION</span><span style="color:#E1E4E8;">	</span><span style="color:#9ECBFF;">UPDATED</span><span style="color:#E1E4E8;">                               	</span><span style="color:#9ECBFF;">STATUS</span><span style="color:#E1E4E8;">  	</span><span style="color:#9ECBFF;">CHART</span><span style="color:#E1E4E8;">     	</span><span style="color:#9ECBFF;">APP</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">VERSION</span></span>
<span class="line"><span style="color:#B392F0;">demo</span><span style="color:#E1E4E8;">	</span><span style="color:#9ECBFF;">default</span><span style="color:#E1E4E8;">  	</span><span style="color:#79B8FF;">2</span><span style="color:#E1E4E8;">       	</span><span style="color:#79B8FF;">2024</span><span style="color:#9ECBFF;">-07-16</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">18</span><span style="color:#9ECBFF;">:04:14.47907591</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">+0800</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">CST</span><span style="color:#E1E4E8;">	</span><span style="color:#9ECBFF;">deployed</span><span style="color:#E1E4E8;">	</span><span style="color:#9ECBFF;">demo-2.0.0</span><span style="color:#E1E4E8;">	</span><span style="color:#9ECBFF;">v2</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">[root@kube-master helm]# helm list</span></span>
<span class="line"><span style="color:#6F42C1;">NAME</span><span style="color:#24292E;">	</span><span style="color:#032F62;">NAMESPACE</span><span style="color:#24292E;">	</span><span style="color:#032F62;">REVISION</span><span style="color:#24292E;">	</span><span style="color:#032F62;">UPDATED</span><span style="color:#24292E;">                               	</span><span style="color:#032F62;">STATUS</span><span style="color:#24292E;">  	</span><span style="color:#032F62;">CHART</span><span style="color:#24292E;">     	</span><span style="color:#032F62;">APP</span><span style="color:#24292E;"> </span><span style="color:#032F62;">VERSION</span></span>
<span class="line"><span style="color:#6F42C1;">demo</span><span style="color:#24292E;">	</span><span style="color:#032F62;">default</span><span style="color:#24292E;">  	</span><span style="color:#005CC5;">2</span><span style="color:#24292E;">       	</span><span style="color:#005CC5;">2024</span><span style="color:#032F62;">-07-16</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">18</span><span style="color:#032F62;">:04:14.47907591</span><span style="color:#24292E;"> </span><span style="color:#032F62;">+0800</span><span style="color:#24292E;"> </span><span style="color:#032F62;">CST</span><span style="color:#24292E;">	</span><span style="color:#032F62;">deployed</span><span style="color:#24292E;">	</span><span style="color:#032F62;">demo-2.0.0</span><span style="color:#24292E;">	</span><span style="color:#032F62;">v2</span></span></code></pre></div><ul><li>查看历史版本</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">[root@kube-master helm]# helm history demo</span></span>
<span class="line"><span style="color:#B392F0;">REVISION</span><span style="color:#E1E4E8;">	</span><span style="color:#9ECBFF;">UPDATED</span><span style="color:#E1E4E8;">                 	</span><span style="color:#9ECBFF;">STATUS</span><span style="color:#E1E4E8;">    	</span><span style="color:#9ECBFF;">CHART</span><span style="color:#E1E4E8;">     	</span><span style="color:#9ECBFF;">APP</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">VERSION</span><span style="color:#E1E4E8;">	</span><span style="color:#9ECBFF;">DESCRIPTION</span></span>
<span class="line"><span style="color:#B392F0;">1</span><span style="color:#E1E4E8;">       	</span><span style="color:#9ECBFF;">Tue</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Jul</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">16</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">18</span><span style="color:#9ECBFF;">:03:50</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2024</span><span style="color:#E1E4E8;">	</span><span style="color:#9ECBFF;">superseded</span><span style="color:#E1E4E8;">	</span><span style="color:#9ECBFF;">demo-1.0.0</span><span style="color:#E1E4E8;">	</span><span style="color:#9ECBFF;">v1</span><span style="color:#E1E4E8;">         	</span><span style="color:#9ECBFF;">Install</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">complete</span></span>
<span class="line"><span style="color:#B392F0;">2</span><span style="color:#E1E4E8;">       	</span><span style="color:#9ECBFF;">Tue</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Jul</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">16</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">18</span><span style="color:#9ECBFF;">:04:14</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2024</span><span style="color:#E1E4E8;">	</span><span style="color:#9ECBFF;">deployed</span><span style="color:#E1E4E8;">  	</span><span style="color:#9ECBFF;">demo-2.0.0</span><span style="color:#E1E4E8;">	</span><span style="color:#9ECBFF;">v2</span><span style="color:#E1E4E8;">         	</span><span style="color:#9ECBFF;">Upgrade</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">complete</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">[root@kube-master helm]# helm history demo</span></span>
<span class="line"><span style="color:#6F42C1;">REVISION</span><span style="color:#24292E;">	</span><span style="color:#032F62;">UPDATED</span><span style="color:#24292E;">                 	</span><span style="color:#032F62;">STATUS</span><span style="color:#24292E;">    	</span><span style="color:#032F62;">CHART</span><span style="color:#24292E;">     	</span><span style="color:#032F62;">APP</span><span style="color:#24292E;"> </span><span style="color:#032F62;">VERSION</span><span style="color:#24292E;">	</span><span style="color:#032F62;">DESCRIPTION</span></span>
<span class="line"><span style="color:#6F42C1;">1</span><span style="color:#24292E;">       	</span><span style="color:#032F62;">Tue</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Jul</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">16</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">18</span><span style="color:#032F62;">:03:50</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2024</span><span style="color:#24292E;">	</span><span style="color:#032F62;">superseded</span><span style="color:#24292E;">	</span><span style="color:#032F62;">demo-1.0.0</span><span style="color:#24292E;">	</span><span style="color:#032F62;">v1</span><span style="color:#24292E;">         	</span><span style="color:#032F62;">Install</span><span style="color:#24292E;"> </span><span style="color:#032F62;">complete</span></span>
<span class="line"><span style="color:#6F42C1;">2</span><span style="color:#24292E;">       	</span><span style="color:#032F62;">Tue</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Jul</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">16</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">18</span><span style="color:#032F62;">:04:14</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2024</span><span style="color:#24292E;">	</span><span style="color:#032F62;">deployed</span><span style="color:#24292E;">  	</span><span style="color:#032F62;">demo-2.0.0</span><span style="color:#24292E;">	</span><span style="color:#032F62;">v2</span><span style="color:#24292E;">         	</span><span style="color:#032F62;">Upgrade</span><span style="color:#24292E;"> </span><span style="color:#032F62;">complete</span></span></code></pre></div><ul><li>回滚指定版本</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">[root@kube-master helm]# helm rollback demo 1</span></span>
<span class="line"><span style="color:#B392F0;">Rollback</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">was</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">a</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">success!</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Happy</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Helming!</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">[root@kube-master helm]# helm rollback demo 1</span></span>
<span class="line"><span style="color:#6F42C1;">Rollback</span><span style="color:#24292E;"> </span><span style="color:#032F62;">was</span><span style="color:#24292E;"> </span><span style="color:#032F62;">a</span><span style="color:#24292E;"> </span><span style="color:#032F62;">success!</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Happy</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Helming!</span></span></code></pre></div><h2 id="_2-案例" tabindex="-1">2. 案例 <a class="header-anchor" href="#_2-案例" aria-label="Permalink to &quot;2. 案例&quot;">​</a></h2><p>安装mysql</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">helm</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">show</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">values</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">stable/mysql</span></span>
<span class="line"><span style="color:#E1E4E8;"> </span></span>
<span class="line"><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;">#下载</span></span>
<span class="line"><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">helm</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pull</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">stable/mysql</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--untar</span></span>
<span class="line"><span style="color:#E1E4E8;"> </span></span>
<span class="line"><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;">#在线安装</span></span>
<span class="line"><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">helm</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">install</span><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">chart_name</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">stable/mysql</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;"> </span><span style="color:#6F42C1;">helm</span><span style="color:#24292E;"> </span><span style="color:#032F62;">show</span><span style="color:#24292E;"> </span><span style="color:#032F62;">values</span><span style="color:#24292E;"> </span><span style="color:#032F62;">stable/mysql</span></span>
<span class="line"><span style="color:#24292E;"> </span></span>
<span class="line"><span style="color:#24292E;"> </span><span style="color:#6A737D;">#下载</span></span>
<span class="line"><span style="color:#24292E;"> </span><span style="color:#6F42C1;">helm</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pull</span><span style="color:#24292E;"> </span><span style="color:#032F62;">stable/mysql</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--untar</span></span>
<span class="line"><span style="color:#24292E;"> </span></span>
<span class="line"><span style="color:#24292E;"> </span><span style="color:#6A737D;">#在线安装</span></span>
<span class="line"><span style="color:#24292E;"> </span><span style="color:#6F42C1;">helm</span><span style="color:#24292E;"> </span><span style="color:#032F62;">install</span><span style="color:#24292E;">  </span><span style="color:#032F62;">chart_name</span><span style="color:#24292E;"> </span><span style="color:#032F62;">stable/mysql</span></span></code></pre></div>`,42),e=[o];function t(c,r,y,E,i,F){return a(),n("div",null,e)}const C=s(p,[["render",t]]);export{h as __pageData,C as default};
