import{_ as s,o as a,c as n,R as l}from"./chunks/framework.zUbWieqp.js";const h=JSON.parse('{"title":"1.PostgreSQL  pg_hba.conf","description":"","frontmatter":{},"headers":[],"relativePath":"guide/Database/pgSql/usermanager/2-security.md","filePath":"guide/Database/pgSql/usermanager/2-security.md","lastUpdated":1711535325000}'),p={name:"guide/Database/pgSql/usermanager/2-security.md"},o=l(`<h1 id="_1-postgresql-pg-hba-conf" tabindex="-1">1.PostgreSQL pg_hba.conf <a class="header-anchor" href="#_1-postgresql-pg-hba-conf" aria-label="Permalink to &quot;1.PostgreSQL  pg_hba.conf&quot;">​</a></h1><p>该文件用于控制访问安全性，管理客户端对于PostgreSQL服务器的访问权限，</p><p>内容包括：</p><p>​ 允许哪些用户连接到哪个数据库，允许哪些IP或者哪个网段的IP连接到本服务器，以及指定连接时使用的身份验证模式</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">$</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">cat</span><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">/data/pgdata/data/pg_hba.conf.bak</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># TYPE  DATABASE        USER            ADDRESS                 METHOD</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">local</span><span style="color:#E1E4E8;">      </span><span style="color:#9ECBFF;">database</span><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">user</span><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">auth-method</span><span style="color:#E1E4E8;">  [auth-options]</span></span>
<span class="line"><span style="color:#B392F0;">host</span><span style="color:#E1E4E8;">       </span><span style="color:#9ECBFF;">database</span><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">user</span><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">address</span><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">auth-method</span><span style="color:#E1E4E8;">  [auth-options]</span></span>
<span class="line"><span style="color:#B392F0;">hostssl</span><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">database</span><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">user</span><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">address</span><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">auth-method</span><span style="color:#E1E4E8;">  [auth-options]</span></span>
<span class="line"><span style="color:#B392F0;">hostnossl</span><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">database</span><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">user</span><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">address</span><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">auth-method</span><span style="color:#E1E4E8;">  [auth-options]</span></span>
<span class="line"><span style="color:#B392F0;">host</span><span style="color:#E1E4E8;">       </span><span style="color:#9ECBFF;">database</span><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">user</span><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">IP-address</span><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">IP-mask</span><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">auth-method</span><span style="color:#E1E4E8;">  [auth-options]</span></span>
<span class="line"><span style="color:#B392F0;">hostssl</span><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">database</span><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">user</span><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">IP-address</span><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">IP-mask</span><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">auth-method</span><span style="color:#E1E4E8;">  [auth-options]</span></span>
<span class="line"><span style="color:#B392F0;">hostnossl</span><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">database</span><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">user</span><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">IP-address</span><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">IP-mask</span><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">auth-method</span><span style="color:#E1E4E8;">  [auth-options]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># &quot;local&quot; is for Unix domain socket connections only</span></span>
<span class="line"><span style="color:#F97583;">local</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">all</span><span style="color:#E1E4E8;">             </span><span style="color:#9ECBFF;">all</span><span style="color:#E1E4E8;">                                     </span><span style="color:#9ECBFF;">trust</span></span>
<span class="line"><span style="color:#6A737D;"># IPv4 local connections:</span></span>
<span class="line"><span style="color:#B392F0;">host</span><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">all</span><span style="color:#E1E4E8;">             </span><span style="color:#9ECBFF;">all</span><span style="color:#E1E4E8;">             </span><span style="color:#79B8FF;">127.0</span><span style="color:#9ECBFF;">.0.1/32</span><span style="color:#E1E4E8;">            </span><span style="color:#9ECBFF;">trust</span></span>
<span class="line"><span style="color:#6A737D;"># IPv6 local connections:</span></span>
<span class="line"><span style="color:#B392F0;">host</span><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">all</span><span style="color:#E1E4E8;">             </span><span style="color:#9ECBFF;">all</span><span style="color:#E1E4E8;">             </span><span style="color:#9ECBFF;">::1/128</span><span style="color:#E1E4E8;">                 </span><span style="color:#9ECBFF;">trust</span></span>
<span class="line"><span style="color:#6A737D;"># Allow replication connections from localhost, by a user with the</span></span>
<span class="line"><span style="color:#6A737D;"># replication privilege.</span></span>
<span class="line"><span style="color:#F97583;">local</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">replication</span><span style="color:#E1E4E8;">     </span><span style="color:#9ECBFF;">all</span><span style="color:#E1E4E8;">                                     </span><span style="color:#9ECBFF;">trust</span></span>
<span class="line"><span style="color:#B392F0;">host</span><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">replication</span><span style="color:#E1E4E8;">     </span><span style="color:#9ECBFF;">all</span><span style="color:#E1E4E8;">             </span><span style="color:#79B8FF;">127.0</span><span style="color:#9ECBFF;">.0.1/32</span><span style="color:#E1E4E8;">            </span><span style="color:#9ECBFF;">trust</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">$</span><span style="color:#24292E;"> </span><span style="color:#032F62;">cat</span><span style="color:#24292E;">  </span><span style="color:#032F62;">/data/pgdata/data/pg_hba.conf.bak</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># TYPE  DATABASE        USER            ADDRESS                 METHOD</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">local</span><span style="color:#24292E;">      </span><span style="color:#032F62;">database</span><span style="color:#24292E;">  </span><span style="color:#032F62;">user</span><span style="color:#24292E;">  </span><span style="color:#032F62;">auth-method</span><span style="color:#24292E;">  [auth-options]</span></span>
<span class="line"><span style="color:#6F42C1;">host</span><span style="color:#24292E;">       </span><span style="color:#032F62;">database</span><span style="color:#24292E;">  </span><span style="color:#032F62;">user</span><span style="color:#24292E;">  </span><span style="color:#032F62;">address</span><span style="color:#24292E;">  </span><span style="color:#032F62;">auth-method</span><span style="color:#24292E;">  [auth-options]</span></span>
<span class="line"><span style="color:#6F42C1;">hostssl</span><span style="color:#24292E;">    </span><span style="color:#032F62;">database</span><span style="color:#24292E;">  </span><span style="color:#032F62;">user</span><span style="color:#24292E;">  </span><span style="color:#032F62;">address</span><span style="color:#24292E;">  </span><span style="color:#032F62;">auth-method</span><span style="color:#24292E;">  [auth-options]</span></span>
<span class="line"><span style="color:#6F42C1;">hostnossl</span><span style="color:#24292E;">  </span><span style="color:#032F62;">database</span><span style="color:#24292E;">  </span><span style="color:#032F62;">user</span><span style="color:#24292E;">  </span><span style="color:#032F62;">address</span><span style="color:#24292E;">  </span><span style="color:#032F62;">auth-method</span><span style="color:#24292E;">  [auth-options]</span></span>
<span class="line"><span style="color:#6F42C1;">host</span><span style="color:#24292E;">       </span><span style="color:#032F62;">database</span><span style="color:#24292E;">  </span><span style="color:#032F62;">user</span><span style="color:#24292E;">  </span><span style="color:#032F62;">IP-address</span><span style="color:#24292E;">  </span><span style="color:#032F62;">IP-mask</span><span style="color:#24292E;">  </span><span style="color:#032F62;">auth-method</span><span style="color:#24292E;">  [auth-options]</span></span>
<span class="line"><span style="color:#6F42C1;">hostssl</span><span style="color:#24292E;">    </span><span style="color:#032F62;">database</span><span style="color:#24292E;">  </span><span style="color:#032F62;">user</span><span style="color:#24292E;">  </span><span style="color:#032F62;">IP-address</span><span style="color:#24292E;">  </span><span style="color:#032F62;">IP-mask</span><span style="color:#24292E;">  </span><span style="color:#032F62;">auth-method</span><span style="color:#24292E;">  [auth-options]</span></span>
<span class="line"><span style="color:#6F42C1;">hostnossl</span><span style="color:#24292E;">  </span><span style="color:#032F62;">database</span><span style="color:#24292E;">  </span><span style="color:#032F62;">user</span><span style="color:#24292E;">  </span><span style="color:#032F62;">IP-address</span><span style="color:#24292E;">  </span><span style="color:#032F62;">IP-mask</span><span style="color:#24292E;">  </span><span style="color:#032F62;">auth-method</span><span style="color:#24292E;">  [auth-options]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># &quot;local&quot; is for Unix domain socket connections only</span></span>
<span class="line"><span style="color:#D73A49;">local</span><span style="color:#24292E;">   </span><span style="color:#032F62;">all</span><span style="color:#24292E;">             </span><span style="color:#032F62;">all</span><span style="color:#24292E;">                                     </span><span style="color:#032F62;">trust</span></span>
<span class="line"><span style="color:#6A737D;"># IPv4 local connections:</span></span>
<span class="line"><span style="color:#6F42C1;">host</span><span style="color:#24292E;">    </span><span style="color:#032F62;">all</span><span style="color:#24292E;">             </span><span style="color:#032F62;">all</span><span style="color:#24292E;">             </span><span style="color:#005CC5;">127.0</span><span style="color:#032F62;">.0.1/32</span><span style="color:#24292E;">            </span><span style="color:#032F62;">trust</span></span>
<span class="line"><span style="color:#6A737D;"># IPv6 local connections:</span></span>
<span class="line"><span style="color:#6F42C1;">host</span><span style="color:#24292E;">    </span><span style="color:#032F62;">all</span><span style="color:#24292E;">             </span><span style="color:#032F62;">all</span><span style="color:#24292E;">             </span><span style="color:#032F62;">::1/128</span><span style="color:#24292E;">                 </span><span style="color:#032F62;">trust</span></span>
<span class="line"><span style="color:#6A737D;"># Allow replication connections from localhost, by a user with the</span></span>
<span class="line"><span style="color:#6A737D;"># replication privilege.</span></span>
<span class="line"><span style="color:#D73A49;">local</span><span style="color:#24292E;">   </span><span style="color:#032F62;">replication</span><span style="color:#24292E;">     </span><span style="color:#032F62;">all</span><span style="color:#24292E;">                                     </span><span style="color:#032F62;">trust</span></span>
<span class="line"><span style="color:#6F42C1;">host</span><span style="color:#24292E;">    </span><span style="color:#032F62;">replication</span><span style="color:#24292E;">     </span><span style="color:#032F62;">all</span><span style="color:#24292E;">             </span><span style="color:#005CC5;">127.0</span><span style="color:#032F62;">.0.1/32</span><span style="color:#24292E;">            </span><span style="color:#032F62;">trust</span></span></code></pre></div><h2 id="_1-1type" tabindex="-1">1.1TYPE <a class="header-anchor" href="#_1-1type" aria-label="Permalink to &quot;1.1TYPE&quot;">​</a></h2><p>定义了多种连接PostgreSQL的方式，一般分为：</p><table><thead><tr><th>type</th><th>描述</th></tr></thead><tbody><tr><td>local</td><td>匹配使用Unix域套接字的连接，如果没有此类型的记录，则不允许使用Unix域套接字连接</td></tr><tr><td>host</td><td>匹配使用TCP/IP进行的连接，主机记录匹配SSL或非SSL连接，需要配置listen_addresses</td></tr><tr><td>hostssl</td><td>匹配使用TCP/IP进行的连接，仅限于使用SSL加密进行连接，需要配置ssl参数</td></tr><tr><td>hostnossl</td><td>匹配通过TCP/IP进行的连接，不使用SSL的连接</td></tr><tr><td>database</td><td>匹配的数据库名称，all指定它匹配所有数据库。如果请求的数据库与请求的用户具有相同的名称则可以使用samerole值。复制（replication）不指定数据库，多个数据库可以用逗号分隔</td></tr><tr><td>user</td><td>匹配的数据库用户名，值all指定它匹配所有用户。 可以通过用逗号分隔来提供多个用户名</td></tr><tr><td>address</td><td>匹配的客户端计算机地址，可以包含主机名，IP地址范围。如：172.20.143.89/32、172.20.143.0/24、10.6.0.0/16、:: 1/128。 0.0.0.0/0表示所有IPv4地址，:: 0/0表示所有IPv6地址。要指定单个主机，请使用掩码长度32（对于IPv4）或128（对于IPv6）。all以匹配任何IP地址</td></tr><tr><td>IP-address、IP-mask</td><td>这两个字段可用作IP地址/掩码长度，如：127.0.0.1 255.255.255.255</td></tr><tr><td>auth-method</td><td>指定连接与此记录匹配时要使用的身份验证方法：trust、reject、scram-sha-256、md5、password、gss、sspi、ident、peer、ldap、radius、cert、pam、bsd</td></tr><tr><td></td><td></td></tr></tbody></table><h2 id="_1-2method" tabindex="-1">1.2METHOD <a class="header-anchor" href="#_1-2method" aria-label="Permalink to &quot;1.2METHOD&quot;">​</a></h2><p>身份验证模式一般分为：ident、trust、md5、password、peer、reject。其中ident和peer模式仅适用于Linux、Unix和Max，不适用于Windows</p><table><thead><tr><th>模式</th><th>描述</th></tr></thead><tbody><tr><td>trust</td><td>该模式可以不用密码直接连接数据库，不安全</td></tr><tr><td>md5</td><td>该模式很常用，要求连接发起者携带用md5算法加密的密码</td></tr><tr><td>password</td><td>该模式是使用明文密码进行身份验证，也不安全，不推荐</td></tr><tr><td>ident</td><td>该模式下系统会将请求发起者的操作系统用户映射为PostgesSQL数据库内部用户，并以该内部用户的权限登录，且此时无需提供登录密码。操作系统用户与数据库内部用户之间的映射关系会记录在pg_ident.conf文件中</td></tr><tr><td>peer</td><td>该模式使用连接发起端的操作系统名进行身份验证。仅限于Linux、BSD、Mac OS X和Solaris，并且仅可用于本地服务器发起的连接</td></tr><tr><td>reject</td><td>该模式表示拒绝所有请求</td></tr><tr><td>radius</td><td>使用RADIUS服务器进行身份验证</td></tr><tr><td>cert</td><td>使用SSL客户端证书进行身份验证</td></tr><tr><td>pam</td><td>使用操作系统提供的可插入身份验证模块（PAM）服务进行身份验证</td></tr><tr><td>bsd</td><td>使用操作系统提供的BSD身份验证服务进行身份验证</td></tr><tr><td>ldap</td><td>使用LDAP服务器进行身份验证</td></tr><tr><td>gss</td><td>使用GSSAPI对用户进行身份验证，这仅适用于TCP / IP连接</td></tr><tr><td>sspi</td><td>使用SSPI对用户进行身份验证，这仅适用于Windows</td></tr><tr><td>scram-sha-256</td><td>执行SCRAM-SHA-256身份验证以验证用户的密码</td></tr><tr><td></td><td></td></tr></tbody></table><p>注意，常见错误就是把规则放错，例如若将0.0.0.0/0 reject规则放到127.0.0.1/32 trust前面，那么所有本地用户都无法连接，即使下面有规则允许也不行</p><p><strong>例子</strong></p><p>1、允许IP为10.0.8.100的username以密码方式访问数据库dbname</p><p>host dbname username 10.0.8.100/32 md5</p><p>2、允许IP为10.1.1.0~10.1.1.255网段的用户以密码方式登录数据库</p><p>host all all 10.1.1.0/24 md5</p><p>3、允许IP为192.168.1.0的用户可以不使用密码直接登录数据库</p><p>host all all 192.168.1.0/32 trust</p><p>4、指定整个网段</p><p>host test pgtest 0.0.0.0/0 md5</p><p><strong>auth-options</strong>：在auth-method字段之后，可以存在name = value形式的字段，用于指定认证方法的选项。 例子：</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;"># TYPE  DATABASE    USER   ADDRESS   METHOD</span></span>
<span class="line"><span style="color:#F97583;">local</span><span style="color:#E1E4E8;">          </span><span style="color:#9ECBFF;">all</span><span style="color:#E1E4E8;">               </span><span style="color:#9ECBFF;">all</span><span style="color:#E1E4E8;">                         </span><span style="color:#9ECBFF;">trust</span></span>
<span class="line"><span style="color:#B392F0;">--在本地允许任何用户无密码登录</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">local</span><span style="color:#E1E4E8;">          </span><span style="color:#9ECBFF;">all</span><span style="color:#E1E4E8;">                </span><span style="color:#9ECBFF;">all</span><span style="color:#E1E4E8;">                        </span><span style="color:#9ECBFF;">peer</span></span>
<span class="line"><span style="color:#B392F0;">--操作系统的登录用户和pg的用户是否一致，一致则可以登录</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">local</span><span style="color:#E1E4E8;">          </span><span style="color:#9ECBFF;">all</span><span style="color:#E1E4E8;">                </span><span style="color:#9ECBFF;">all</span><span style="color:#E1E4E8;">                        </span><span style="color:#9ECBFF;">ident</span></span>
<span class="line"><span style="color:#B392F0;">--操作系统的登录用户和pg的用户是否一致，一致则可以登录</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">host</span><span style="color:#E1E4E8;">          </span><span style="color:#9ECBFF;">all</span><span style="color:#E1E4E8;">                </span><span style="color:#9ECBFF;">all</span><span style="color:#E1E4E8;">    </span><span style="color:#79B8FF;">192.168</span><span style="color:#9ECBFF;">.163.0/24</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">md5</span></span>
<span class="line"><span style="color:#B392F0;">--指定客户端IP访问通过md5身份验证进行登录</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">host</span><span style="color:#E1E4E8;">          </span><span style="color:#9ECBFF;">all</span><span style="color:#E1E4E8;">                </span><span style="color:#9ECBFF;">all</span><span style="color:#E1E4E8;">     </span><span style="color:#79B8FF;">192.168</span><span style="color:#9ECBFF;">.163.132/32</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">password</span></span>
<span class="line"><span style="color:#B392F0;">--指定客户端IP通过passwotd身份验证进行登录</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">host</span><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">all</span><span style="color:#E1E4E8;">             </span><span style="color:#9ECBFF;">all</span><span style="color:#E1E4E8;">     </span><span style="color:#79B8FF;">192.168</span><span style="color:#9ECBFF;">.54.1/32</span><span style="color:#E1E4E8;">         </span><span style="color:#9ECBFF;">reject</span></span>
<span class="line"><span style="color:#B392F0;">host</span><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">all</span><span style="color:#E1E4E8;">             </span><span style="color:#9ECBFF;">all</span><span style="color:#E1E4E8;">     </span><span style="color:#79B8FF;">192.168</span><span style="color:#9ECBFF;">.0.0/16</span><span style="color:#E1E4E8;">           </span><span style="color:#9ECBFF;">ident</span><span style="color:#E1E4E8;">  </span></span>
<span class="line"><span style="color:#B392F0;">host</span><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">all</span><span style="color:#E1E4E8;">             </span><span style="color:#9ECBFF;">all</span><span style="color:#E1E4E8;">     </span><span style="color:#79B8FF;">127.0</span><span style="color:#9ECBFF;">.0.1</span><span style="color:#E1E4E8;">       </span><span style="color:#79B8FF;">255.255</span><span style="color:#9ECBFF;">.255.255</span><span style="color:#E1E4E8;">     </span><span style="color:#9ECBFF;">trust</span></span>
<span class="line"><span style="color:#79B8FF;">...</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;"># TYPE  DATABASE    USER   ADDRESS   METHOD</span></span>
<span class="line"><span style="color:#D73A49;">local</span><span style="color:#24292E;">          </span><span style="color:#032F62;">all</span><span style="color:#24292E;">               </span><span style="color:#032F62;">all</span><span style="color:#24292E;">                         </span><span style="color:#032F62;">trust</span></span>
<span class="line"><span style="color:#6F42C1;">--在本地允许任何用户无密码登录</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">local</span><span style="color:#24292E;">          </span><span style="color:#032F62;">all</span><span style="color:#24292E;">                </span><span style="color:#032F62;">all</span><span style="color:#24292E;">                        </span><span style="color:#032F62;">peer</span></span>
<span class="line"><span style="color:#6F42C1;">--操作系统的登录用户和pg的用户是否一致，一致则可以登录</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">local</span><span style="color:#24292E;">          </span><span style="color:#032F62;">all</span><span style="color:#24292E;">                </span><span style="color:#032F62;">all</span><span style="color:#24292E;">                        </span><span style="color:#032F62;">ident</span></span>
<span class="line"><span style="color:#6F42C1;">--操作系统的登录用户和pg的用户是否一致，一致则可以登录</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">host</span><span style="color:#24292E;">          </span><span style="color:#032F62;">all</span><span style="color:#24292E;">                </span><span style="color:#032F62;">all</span><span style="color:#24292E;">    </span><span style="color:#005CC5;">192.168</span><span style="color:#032F62;">.163.0/24</span><span style="color:#24292E;">   </span><span style="color:#032F62;">md5</span></span>
<span class="line"><span style="color:#6F42C1;">--指定客户端IP访问通过md5身份验证进行登录</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">host</span><span style="color:#24292E;">          </span><span style="color:#032F62;">all</span><span style="color:#24292E;">                </span><span style="color:#032F62;">all</span><span style="color:#24292E;">     </span><span style="color:#005CC5;">192.168</span><span style="color:#032F62;">.163.132/32</span><span style="color:#24292E;">   </span><span style="color:#032F62;">password</span></span>
<span class="line"><span style="color:#6F42C1;">--指定客户端IP通过passwotd身份验证进行登录</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">host</span><span style="color:#24292E;">    </span><span style="color:#032F62;">all</span><span style="color:#24292E;">             </span><span style="color:#032F62;">all</span><span style="color:#24292E;">     </span><span style="color:#005CC5;">192.168</span><span style="color:#032F62;">.54.1/32</span><span style="color:#24292E;">         </span><span style="color:#032F62;">reject</span></span>
<span class="line"><span style="color:#6F42C1;">host</span><span style="color:#24292E;">    </span><span style="color:#032F62;">all</span><span style="color:#24292E;">             </span><span style="color:#032F62;">all</span><span style="color:#24292E;">     </span><span style="color:#005CC5;">192.168</span><span style="color:#032F62;">.0.0/16</span><span style="color:#24292E;">           </span><span style="color:#032F62;">ident</span><span style="color:#24292E;">  </span></span>
<span class="line"><span style="color:#6F42C1;">host</span><span style="color:#24292E;">    </span><span style="color:#032F62;">all</span><span style="color:#24292E;">             </span><span style="color:#032F62;">all</span><span style="color:#24292E;">     </span><span style="color:#005CC5;">127.0</span><span style="color:#032F62;">.0.1</span><span style="color:#24292E;">       </span><span style="color:#005CC5;">255.255</span><span style="color:#032F62;">.255.255</span><span style="color:#24292E;">     </span><span style="color:#032F62;">trust</span></span>
<span class="line"><span style="color:#005CC5;">...</span></span></code></pre></div><p>设置完之后可以通过查看表来查看hba</p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">zjy</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"># </span><span style="color:#F97583;">select</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> pg_hba_file_rules;</span></span>
<span class="line"><span style="color:#E1E4E8;"> line_number | </span><span style="color:#F97583;">type</span><span style="color:#E1E4E8;">  |   </span><span style="color:#F97583;">database</span><span style="color:#E1E4E8;">    | user_name |    </span><span style="color:#F97583;">address</span><span style="color:#E1E4E8;">    |                 netmask                 | auth_method | options | error </span></span>
<span class="line"><span style="color:#6A737D;">-------------+-------+---------------+-----------+---------------+-----------------------------------------+-------------+---------+-------</span></span>
<span class="line"><span style="color:#E1E4E8;">| host  | {all}         | {all}     | </span><span style="color:#79B8FF;">192</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">168</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">163</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;"> | </span><span style="color:#79B8FF;">255</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">255</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">255</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">                           | md5         |         | </span></span>
<span class="line"><span style="color:#E1E4E8;">| </span><span style="color:#F97583;">local</span><span style="color:#E1E4E8;"> | {all}         | {all}     |               |                                         | peer        |         | </span></span>
<span class="line"><span style="color:#E1E4E8;">| host  | {all}         | {all}     | </span><span style="color:#79B8FF;">127</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">     | </span><span style="color:#79B8FF;">255</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">255</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">255</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">255</span><span style="color:#E1E4E8;">                         | md5         |         | </span></span>
<span class="line"><span style="color:#E1E4E8;">| host  | {all}         | {all}     | ::</span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">           | ffff:ffff:ffff:ffff:ffff:ffff:ffff:ffff | md5         |         | </span></span>
<span class="line"><span style="color:#E1E4E8;">| </span><span style="color:#F97583;">local</span><span style="color:#E1E4E8;"> | {replication} | {all}     |               |                                         | peer        |         | </span></span>
<span class="line"><span style="color:#E1E4E8;">| host  | {replication} | {all}     | </span><span style="color:#79B8FF;">127</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">     | </span><span style="color:#79B8FF;">255</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">255</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">255</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">255</span><span style="color:#E1E4E8;">                         | md5         |         | </span></span>
<span class="line"><span style="color:#E1E4E8;">| host  | {replication} | {all}     | ::</span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">           | ffff:ffff:ffff:ffff:ffff:ffff:ffff:ffff | md5         |         |</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">-- 查看hba文件</span></span>
<span class="line"><span style="color:#E1E4E8;">postgres@postgres</span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;">SHOW hba_file;</span></span>
<span class="line"><span style="color:#E1E4E8;">           hba_file            </span></span>
<span class="line"><span style="color:#6A737D;">-------------------------------</span></span>
<span class="line"><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">/data/</span><span style="color:#E1E4E8;">pgdata</span><span style="color:#F97583;">/data/</span><span style="color:#79B8FF;">pg_hba</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">conf</span></span>
<span class="line"><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">row</span><span style="color:#E1E4E8;">)</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">zjy</span><span style="color:#D73A49;">=</span><span style="color:#24292E;"># </span><span style="color:#D73A49;">select</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">*</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">from</span><span style="color:#24292E;"> pg_hba_file_rules;</span></span>
<span class="line"><span style="color:#24292E;"> line_number | </span><span style="color:#D73A49;">type</span><span style="color:#24292E;">  |   </span><span style="color:#D73A49;">database</span><span style="color:#24292E;">    | user_name |    </span><span style="color:#D73A49;">address</span><span style="color:#24292E;">    |                 netmask                 | auth_method | options | error </span></span>
<span class="line"><span style="color:#6A737D;">-------------+-------+---------------+-----------+---------------+-----------------------------------------+-------------+---------+-------</span></span>
<span class="line"><span style="color:#24292E;">| host  | {all}         | {all}     | </span><span style="color:#005CC5;">192</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">168</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">163</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">0</span><span style="color:#24292E;"> | </span><span style="color:#005CC5;">255</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">255</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">255</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">0</span><span style="color:#24292E;">                           | md5         |         | </span></span>
<span class="line"><span style="color:#24292E;">| </span><span style="color:#D73A49;">local</span><span style="color:#24292E;"> | {all}         | {all}     |               |                                         | peer        |         | </span></span>
<span class="line"><span style="color:#24292E;">| host  | {all}         | {all}     | </span><span style="color:#005CC5;">127</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">0</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">0</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">1</span><span style="color:#24292E;">     | </span><span style="color:#005CC5;">255</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">255</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">255</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">255</span><span style="color:#24292E;">                         | md5         |         | </span></span>
<span class="line"><span style="color:#24292E;">| host  | {all}         | {all}     | ::</span><span style="color:#005CC5;">1</span><span style="color:#24292E;">           | ffff:ffff:ffff:ffff:ffff:ffff:ffff:ffff | md5         |         | </span></span>
<span class="line"><span style="color:#24292E;">| </span><span style="color:#D73A49;">local</span><span style="color:#24292E;"> | {replication} | {all}     |               |                                         | peer        |         | </span></span>
<span class="line"><span style="color:#24292E;">| host  | {replication} | {all}     | </span><span style="color:#005CC5;">127</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">0</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">0</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">1</span><span style="color:#24292E;">     | </span><span style="color:#005CC5;">255</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">255</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">255</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">255</span><span style="color:#24292E;">                         | md5         |         | </span></span>
<span class="line"><span style="color:#24292E;">| host  | {replication} | {all}     | ::</span><span style="color:#005CC5;">1</span><span style="color:#24292E;">           | ffff:ffff:ffff:ffff:ffff:ffff:ffff:ffff | md5         |         |</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">-- 查看hba文件</span></span>
<span class="line"><span style="color:#24292E;">postgres@postgres</span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;">SHOW hba_file;</span></span>
<span class="line"><span style="color:#24292E;">           hba_file            </span></span>
<span class="line"><span style="color:#6A737D;">-------------------------------</span></span>
<span class="line"><span style="color:#24292E;"> </span><span style="color:#D73A49;">/data/</span><span style="color:#24292E;">pgdata</span><span style="color:#D73A49;">/data/</span><span style="color:#005CC5;">pg_hba</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">conf</span></span>
<span class="line"><span style="color:#24292E;">(</span><span style="color:#005CC5;">1</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">row</span><span style="color:#24292E;">)</span></span></code></pre></div><p>修改完pg_hba.conf文件之后，需要重新加载配置，不用重启数据库</p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">postgres</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"># </span><span style="color:#F97583;">select</span><span style="color:#E1E4E8;"> pg_reload_conf();</span></span>
<span class="line"><span style="color:#E1E4E8;"> pg_reload_conf </span></span>
<span class="line"><span style="color:#6A737D;">----------------</span></span>
<span class="line"><span style="color:#E1E4E8;"> t</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">postgres</span><span style="color:#D73A49;">=</span><span style="color:#24292E;"># </span><span style="color:#D73A49;">select</span><span style="color:#24292E;"> pg_reload_conf();</span></span>
<span class="line"><span style="color:#24292E;"> pg_reload_conf </span></span>
<span class="line"><span style="color:#6A737D;">----------------</span></span>
<span class="line"><span style="color:#24292E;"> t</span></span></code></pre></div><p><code>许多配置文件修改后需要重启postgres服务才能生效，但有的只需执行一下重新加载即可生效。重新加载并不会中断连接</code></p><p>命令：<strong>pg_ctl reload -D your_data_directory_here</strong></p><p>如果是在linux以服务的形式安装的，那么执行：</p><p>命令：<strong>service postgresql-9.5 reload</strong></p><p>另外一种加载配置文件的方法是以超级用户登录到任何一个数据库后执行：</p><p>命令：<strong>select pg_reload_conf();</strong></p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;"># TYPE DATABASE    USER      ADDRESS         METHOD</span></span>
<span class="line"><span style="color:#e1e4e8;">host postgres all 0.0.0.0/0 reject</span></span>
<span class="line"><span style="color:#e1e4e8;">host template0 all 0.0.0.0/0 reject</span></span>
<span class="line"><span style="color:#e1e4e8;">host template1 all 0.0.0.0/0 reject</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;"># TYPE DATABASE    USER      ADDRESS         METHOD</span></span>
<span class="line"><span style="color:#24292e;">host postgres all 0.0.0.0/0 reject</span></span>
<span class="line"><span style="color:#24292e;">host template0 all 0.0.0.0/0 reject</span></span>
<span class="line"><span style="color:#24292e;">host template1 all 0.0.0.0/0 reject</span></span></code></pre></div><h1 id="_2-pg-ident-conf" tabindex="-1">2.pg_ident.conf <a class="header-anchor" href="#_2-pg-ident-conf" aria-label="Permalink to &quot;2.pg_ident.conf&quot;">​</a></h1><p><a href="https://www.postgresql.org/docs/12/auth-username-maps.html" target="_blank" rel="noreferrer">https://www.postgresql.org/docs/12/auth-username-maps.html</a></p><p>pg_ident.conf的格式</p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;"># MAPNAME    </span><span style="color:#F97583;">SYSTEM-</span><span style="color:#E1E4E8;">USERNAME    PG</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">USERNAME</span></span>
<span class="line"><span style="color:#E1E4E8;">usermap      username           dbuser</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;"># MAPNAME    </span><span style="color:#D73A49;">SYSTEM-</span><span style="color:#24292E;">USERNAME    PG</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">USERNAME</span></span>
<span class="line"><span style="color:#24292E;">usermap      username           dbuser</span></span></code></pre></div><p>usermap为映射名，要在pg_hba.conf中用到，多个映射可以共用同一个映射名，</p><p>username为操作系统用户名，</p><p>dbuser为映射到的数据库用户</p><p>例：操作系统用户userhg，使用数据库用户highgo连接数据库，而操作系统用户usergp，使用数据库用户gpadmin连接数据库</p><p>pg_ident.conf</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;"># MAPNAME    SYSTEM-USERNAME    PG-USERNAME</span></span>
<span class="line"><span style="color:#e1e4e8;">maphg　　　　userhg　　　　　　　　highgo</span></span>
<span class="line"><span style="color:#e1e4e8;">maphg　　　　usergp　　　　　　　　gpadmin</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;"># MAPNAME    SYSTEM-USERNAME    PG-USERNAME</span></span>
<span class="line"><span style="color:#24292e;">maphg　　　　userhg　　　　　　　　highgo</span></span>
<span class="line"><span style="color:#24292e;">maphg　　　　usergp　　　　　　　　gpadmin</span></span></code></pre></div><p>pg_hba.conf如下：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;"># TYPE  DATABASE  USER  CIDR-ADDRESS  METHOD</span></span>
<span class="line"><span style="color:#e1e4e8;">local    all      all                 ident  map=maphg</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;"># TYPE  DATABASE  USER  CIDR-ADDRESS  METHOD</span></span>
<span class="line"><span style="color:#24292e;">local    all      all                 ident  map=maphg</span></span></code></pre></div><p>map为pg_hba.conf的auth-options项，map=mapzy指示该认证条件使用mapzy映射。指定映射后原本的同名操作系统用户就不能连接数据库</p><h1 id="_3-postgresql安全加固" tabindex="-1">3,PostgreSQL安全加固 <a class="header-anchor" href="#_3-postgresql安全加固" aria-label="Permalink to &quot;3,PostgreSQL安全加固&quot;">​</a></h1><h2 id="_1-限制用户连接数" tabindex="-1">1.限制用户连接数 <a class="header-anchor" href="#_1-限制用户连接数" aria-label="Permalink to &quot;1.限制用户连接数&quot;">​</a></h2><p>max_connections根据应用并发量设置合理的值，对普通数据库用户设置限制连接数，并设置少量的保留超级用户登录连接数</p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">postgres</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"># </span><span style="color:#F97583;">create</span><span style="color:#E1E4E8;"> user app1 connection </span><span style="color:#F97583;">limit</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#F97583;">CREATE</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">ROLE</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">postgres</span><span style="color:#D73A49;">=</span><span style="color:#24292E;"># </span><span style="color:#D73A49;">create</span><span style="color:#24292E;"> user app1 connection </span><span style="color:#D73A49;">limit</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#D73A49;">CREATE</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">ROLE</span></span></code></pre></div><h2 id="_2-修改默认端口" tabindex="-1">2.修改默认端口 <a class="header-anchor" href="#_2-修改默认端口" aria-label="Permalink to &quot;2.修改默认端口&quot;">​</a></h2><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">postgres</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"># </span><span style="color:#F97583;">select</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> current_setting(</span><span style="color:#9ECBFF;">&#39;port&#39;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;"> current_setting </span></span>
<span class="line"><span style="color:#6A737D;">-----------------</span></span>
<span class="line"><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">6000</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">postgres</span><span style="color:#D73A49;">=</span><span style="color:#24292E;"># </span><span style="color:#D73A49;">select</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">*</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">from</span><span style="color:#24292E;"> current_setting(</span><span style="color:#032F62;">&#39;port&#39;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;"> current_setting </span></span>
<span class="line"><span style="color:#6A737D;">-----------------</span></span>
<span class="line"><span style="color:#24292E;"> </span><span style="color:#005CC5;">6000</span></span></code></pre></div><h2 id="_3-不使用默认postgres数据库" tabindex="-1">3.不使用默认postgres数据库 <a class="header-anchor" href="#_3-不使用默认postgres数据库" aria-label="Permalink to &quot;3.不使用默认postgres数据库&quot;">​</a></h2><p>建议1：新建数据库后删除默认的postgres数据库</p><p>建议2：保留一个干净无污染的数据库以便发生故障时连接</p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">postgres</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"># </span><span style="color:#F97583;">create</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">database</span><span style="color:#E1E4E8;"> my_app_db </span><span style="color:#F97583;">owner</span><span style="color:#E1E4E8;"> app1;</span></span>
<span class="line"><span style="color:#F97583;">CREATE</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">DATABASE</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">postgres</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"># \\c my_app_db</span></span>
<span class="line"><span style="color:#E1E4E8;">You are </span><span style="color:#F97583;">now</span><span style="color:#E1E4E8;"> connected </span><span style="color:#F97583;">to</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">database</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;my_app_db&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> user </span><span style="color:#9ECBFF;">&quot;postgres&quot;</span><span style="color:#E1E4E8;">.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">my_app_db</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"># </span><span style="color:#F97583;">drop</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">database</span><span style="color:#E1E4E8;"> postgres;</span></span>
<span class="line"><span style="color:#F97583;">DROP</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">DATABASE</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">postgres</span><span style="color:#D73A49;">=</span><span style="color:#24292E;"># </span><span style="color:#D73A49;">create</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">database</span><span style="color:#24292E;"> my_app_db </span><span style="color:#D73A49;">owner</span><span style="color:#24292E;"> app1;</span></span>
<span class="line"><span style="color:#D73A49;">CREATE</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">DATABASE</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">postgres</span><span style="color:#D73A49;">=</span><span style="color:#24292E;"># \\c my_app_db</span></span>
<span class="line"><span style="color:#24292E;">You are </span><span style="color:#D73A49;">now</span><span style="color:#24292E;"> connected </span><span style="color:#D73A49;">to</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">database</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;my_app_db&quot;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> user </span><span style="color:#032F62;">&quot;postgres&quot;</span><span style="color:#24292E;">.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">my_app_db</span><span style="color:#D73A49;">=</span><span style="color:#24292E;"># </span><span style="color:#D73A49;">drop</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">database</span><span style="color:#24292E;"> postgres;</span></span>
<span class="line"><span style="color:#D73A49;">DROP</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">DATABASE</span></span></code></pre></div><h2 id="_4-自定义超级用户" tabindex="-1">4.自定义超级用户 <a class="header-anchor" href="#_4-自定义超级用户" aria-label="Permalink to &quot;4.自定义超级用户&quot;">​</a></h2><p>建议删除默认超级用户postgres，新建不同名称超级用户，也可再initdb时使用-U指定</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">$ initdb -D /opt/data6000/ -U admin -W</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">$ initdb -D /opt/data6000/ -U admin -W</span></span></code></pre></div><h2 id="_5-修改监听地址" tabindex="-1">5.修改监听地址 <a class="header-anchor" href="#_5-修改监听地址" aria-label="Permalink to &quot;5.修改监听地址&quot;">​</a></h2><p>根据业务场景设置，比如设置为localhost或服务器IP</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">#listen_addresses = &#39;localhost&#39; </span></span>
<span class="line"><span style="color:#e1e4e8;">#listen_addresses = &#39;192.168.99.100&#39; </span></span>
<span class="line"><span style="color:#e1e4e8;">#listen_addresses = &#39;192.168.99.100,192.168.99.200&#39;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">#listen_addresses = &#39;localhost&#39; </span></span>
<span class="line"><span style="color:#24292e;">#listen_addresses = &#39;192.168.99.100&#39; </span></span>
<span class="line"><span style="color:#24292e;">#listen_addresses = &#39;192.168.99.100,192.168.99.200&#39;</span></span></code></pre></div><h2 id="_6-配置客户端认证" tabindex="-1">6.配置客户端认证 <a class="header-anchor" href="#_6-配置客户端认证" aria-label="Permalink to &quot;6.配置客户端认证&quot;">​</a></h2><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;"># 服务端本地数据库用户免密登录</span></span>
<span class="line"><span style="color:#F97583;">local</span><span style="color:#E1E4E8;">      </span><span style="color:#9ECBFF;">all</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">all</span><span style="color:#E1E4E8;">       </span><span style="color:#9ECBFF;">trust</span><span style="color:#E1E4E8;">   </span></span>
<span class="line"><span style="color:#6A737D;"># 拒绝超级用户从网络登录   </span></span>
<span class="line"><span style="color:#B392F0;">host</span><span style="color:#E1E4E8;">      </span><span style="color:#9ECBFF;">all</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">postgres</span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">0.0</span><span style="color:#9ECBFF;">.0.0/0</span><span style="color:#E1E4E8;">     </span><span style="color:#9ECBFF;">reject</span></span>
<span class="line"><span style="color:#6A737D;"># 其它用户密码验证登陆  </span></span>
<span class="line"><span style="color:#B392F0;">host</span><span style="color:#E1E4E8;">      </span><span style="color:#9ECBFF;">all</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">all</span><span style="color:#E1E4E8;">      </span><span style="color:#79B8FF;">0.0</span><span style="color:#9ECBFF;">.0.0/0</span><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">scram-sha-256</span><span style="color:#E1E4E8;"> </span></span>
<span class="line"><span style="color:#6A737D;"># 流复制用户密码验证登录</span></span>
<span class="line"><span style="color:#B392F0;">host</span><span style="color:#E1E4E8;">      </span><span style="color:#9ECBFF;">replication</span><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">replica</span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">192.168</span><span style="color:#9ECBFF;">.99.101/32</span><span style="color:#E1E4E8;">     </span><span style="color:#9ECBFF;">md5</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;"># 服务端本地数据库用户免密登录</span></span>
<span class="line"><span style="color:#D73A49;">local</span><span style="color:#24292E;">      </span><span style="color:#032F62;">all</span><span style="color:#24292E;">   </span><span style="color:#032F62;">all</span><span style="color:#24292E;">       </span><span style="color:#032F62;">trust</span><span style="color:#24292E;">   </span></span>
<span class="line"><span style="color:#6A737D;"># 拒绝超级用户从网络登录   </span></span>
<span class="line"><span style="color:#6F42C1;">host</span><span style="color:#24292E;">      </span><span style="color:#032F62;">all</span><span style="color:#24292E;">   </span><span style="color:#032F62;">postgres</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">0.0</span><span style="color:#032F62;">.0.0/0</span><span style="color:#24292E;">     </span><span style="color:#032F62;">reject</span></span>
<span class="line"><span style="color:#6A737D;"># 其它用户密码验证登陆  </span></span>
<span class="line"><span style="color:#6F42C1;">host</span><span style="color:#24292E;">      </span><span style="color:#032F62;">all</span><span style="color:#24292E;">   </span><span style="color:#032F62;">all</span><span style="color:#24292E;">      </span><span style="color:#005CC5;">0.0</span><span style="color:#032F62;">.0.0/0</span><span style="color:#24292E;">  </span><span style="color:#032F62;">scram-sha-256</span><span style="color:#24292E;"> </span></span>
<span class="line"><span style="color:#6A737D;"># 流复制用户密码验证登录</span></span>
<span class="line"><span style="color:#6F42C1;">host</span><span style="color:#24292E;">      </span><span style="color:#032F62;">replication</span><span style="color:#24292E;">  </span><span style="color:#032F62;">replica</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">192.168</span><span style="color:#032F62;">.99.101/32</span><span style="color:#24292E;">     </span><span style="color:#032F62;">md5</span></span></code></pre></div><h2 id="_7-设置socket访问方式" tabindex="-1">7.设置socket访问方式 <a class="header-anchor" href="#_7-设置socket访问方式" aria-label="Permalink to &quot;7.设置socket访问方式&quot;">​</a></h2><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">unix_socket_directories</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&#39;$PGDATA&#39;</span></span>
<span class="line"><span style="color:#E1E4E8;">unix_socket_group</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&#39;&#39;</span></span>
<span class="line"><span style="color:#E1E4E8;">unix_socket_permissions</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&#39;0700&#39;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">unix_socket_directories</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&#39;$PGDATA&#39;</span></span>
<span class="line"><span style="color:#24292E;">unix_socket_group</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&#39;&#39;</span></span>
<span class="line"><span style="color:#24292E;">unix_socket_permissions</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&#39;0700&#39;</span></span></code></pre></div><h2 id="_8-使用pgpass文件" tabindex="-1">8.使用pgpass文件 <a class="header-anchor" href="#_8-使用pgpass文件" aria-label="Permalink to &quot;8.使用pgpass文件&quot;">​</a></h2><p>linux和window都建议使用pgpass文件</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">Linux</span></span>
<span class="line"><span style="color:#B392F0;">$</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">cat</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">.pgpass</span><span style="color:#E1E4E8;"> </span></span>
<span class="line"><span style="color:#B392F0;">192.168.99.200:5432:postgres:postgres:admin</span></span>
<span class="line"><span style="color:#B392F0;">192.168.99.227:6432:*:app1:yourPassword</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">win10</span></span>
<span class="line"><span style="color:#B392F0;">C:\\Users\\pcsuc\\AppData\\Roaming\\postgresql\\pgpass.conf</span></span>
<span class="line"><span style="color:#B392F0;">localhost:5432:*:postgres:admin</span></span>
<span class="line"><span style="color:#B392F0;">192.168.99.227:6432:*:app1:yourPassword</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">Linux</span></span>
<span class="line"><span style="color:#6F42C1;">$</span><span style="color:#24292E;"> </span><span style="color:#032F62;">cat</span><span style="color:#24292E;"> </span><span style="color:#032F62;">.pgpass</span><span style="color:#24292E;"> </span></span>
<span class="line"><span style="color:#6F42C1;">192.168.99.200:5432:postgres:postgres:admin</span></span>
<span class="line"><span style="color:#6F42C1;">192.168.99.227:6432:*:app1:yourPassword</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">win10</span></span>
<span class="line"><span style="color:#6F42C1;">C:\\Users\\pcsuc\\AppData\\Roaming\\postgresql\\pgpass.conf</span></span>
<span class="line"><span style="color:#6F42C1;">localhost:5432:*:postgres:admin</span></span>
<span class="line"><span style="color:#6F42C1;">192.168.99.227:6432:*:app1:yourPassword</span></span></code></pre></div><h2 id="_9-安全创建用户" tabindex="-1">9.安全创建用户 <a class="header-anchor" href="#_9-安全创建用户" aria-label="Permalink to &quot;9.安全创建用户&quot;">​</a></h2><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">$</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">createuser</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">user_app1</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--no-superuser</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-p6000</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-Upostgres</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--pwprompt</span></span>
<span class="line"><span style="color:#B392F0;">Enter</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">password</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">for</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">new</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">role:</span><span style="color:#E1E4E8;"> </span></span>
<span class="line"><span style="color:#B392F0;">Enter</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">it</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">again:</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">$</span><span style="color:#24292E;"> </span><span style="color:#032F62;">createuser</span><span style="color:#24292E;"> </span><span style="color:#032F62;">user_app1</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--no-superuser</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-p6000</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-Upostgres</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--pwprompt</span></span>
<span class="line"><span style="color:#6F42C1;">Enter</span><span style="color:#24292E;"> </span><span style="color:#032F62;">password</span><span style="color:#24292E;"> </span><span style="color:#032F62;">for</span><span style="color:#24292E;"> </span><span style="color:#032F62;">new</span><span style="color:#24292E;"> </span><span style="color:#032F62;">role:</span><span style="color:#24292E;"> </span></span>
<span class="line"><span style="color:#6F42C1;">Enter</span><span style="color:#24292E;"> </span><span style="color:#032F62;">it</span><span style="color:#24292E;"> </span><span style="color:#032F62;">again:</span></span></code></pre></div><h2 id="_10-用户密码安全策略" tabindex="-1">10.用户密码安全策略 <a class="header-anchor" href="#_10-用户密码安全策略" aria-label="Permalink to &quot;10.用户密码安全策略&quot;">​</a></h2><h3 id="_1-简单密码策略" tabindex="-1">1.简单密码策略 <a class="header-anchor" href="#_1-简单密码策略" aria-label="Permalink to &quot;1.简单密码策略&quot;">​</a></h3><p>PostgreSQL提供了一个插件passwordcheck可以满足简单的密码复杂度测验，防止使用过短，或者与包含用户名的密码</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">$</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">vi</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">postgresql.conf</span></span>
<span class="line"><span style="color:#6A737D;">#安装扩展</span></span>
<span class="line"><span style="color:#B392F0;">shared_preload_libraries</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;passwordcheck&#39;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">$</span><span style="color:#24292E;"> </span><span style="color:#032F62;">vi</span><span style="color:#24292E;"> </span><span style="color:#032F62;">postgresql.conf</span></span>
<span class="line"><span style="color:#6A737D;">#安装扩展</span></span>
<span class="line"><span style="color:#6F42C1;">shared_preload_libraries</span><span style="color:#24292E;"> </span><span style="color:#032F62;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;passwordcheck&#39;</span></span></code></pre></div><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">--测试SQL</span></span>
<span class="line"><span style="color:#F97583;">CREATE</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">USER</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">regress_user1</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">-- ok</span></span>
<span class="line"><span style="color:#F97583;">ALTER</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">USER</span><span style="color:#E1E4E8;"> regress_user1 </span><span style="color:#F97583;">PASSWORD</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;a_nice_long_password&#39;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">-- error: too short</span></span>
<span class="line"><span style="color:#F97583;">ALTER</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">USER</span><span style="color:#E1E4E8;"> regress_user1 </span><span style="color:#F97583;">PASSWORD</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;tooshrt&#39;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">ERROR:  </span><span style="color:#F97583;">password</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">is</span><span style="color:#E1E4E8;"> too short</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">-- error: contains user name</span></span>
<span class="line"><span style="color:#F97583;">ALTER</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">USER</span><span style="color:#E1E4E8;"> regress_user1 </span><span style="color:#F97583;">PASSWORD</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;xyzregress_user1&#39;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">ERROR:  </span><span style="color:#F97583;">password</span><span style="color:#E1E4E8;"> must </span><span style="color:#F97583;">not</span><span style="color:#E1E4E8;"> contain user </span><span style="color:#F97583;">name</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">-- error: contains only letters</span></span>
<span class="line"><span style="color:#F97583;">ALTER</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">USER</span><span style="color:#E1E4E8;"> regress_user1 </span><span style="color:#F97583;">PASSWORD</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;alessnicelongpassword&#39;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">ERROR:  </span><span style="color:#F97583;">password</span><span style="color:#E1E4E8;"> must contain </span><span style="color:#F97583;">both</span><span style="color:#E1E4E8;"> letters </span><span style="color:#F97583;">and</span><span style="color:#E1E4E8;"> nonletters</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">-- encrypted ok (password is &quot;secret&quot;)</span></span>
<span class="line"><span style="color:#F97583;">ALTER</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">USER</span><span style="color:#E1E4E8;"> regress_user1 </span><span style="color:#F97583;">PASSWORD</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;md51a44d829a20a23eac686d9f0d258af13&#39;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">-- error: password is user name</span></span>
<span class="line"><span style="color:#F97583;">ALTER</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">USER</span><span style="color:#E1E4E8;"> regress_user1 </span><span style="color:#F97583;">PASSWORD</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;md5e589150ae7d28f93333afae92b36ef48&#39;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">ERROR:  </span><span style="color:#F97583;">password</span><span style="color:#E1E4E8;"> must </span><span style="color:#F97583;">not</span><span style="color:#E1E4E8;"> equal user </span><span style="color:#F97583;">name</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">DROP</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">USER</span><span style="color:#E1E4E8;"> regress_user1;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">--测试SQL</span></span>
<span class="line"><span style="color:#D73A49;">CREATE</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">USER</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">regress_user1</span><span style="color:#24292E;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">-- ok</span></span>
<span class="line"><span style="color:#D73A49;">ALTER</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">USER</span><span style="color:#24292E;"> regress_user1 </span><span style="color:#D73A49;">PASSWORD</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;a_nice_long_password&#39;</span><span style="color:#24292E;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">-- error: too short</span></span>
<span class="line"><span style="color:#D73A49;">ALTER</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">USER</span><span style="color:#24292E;"> regress_user1 </span><span style="color:#D73A49;">PASSWORD</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;tooshrt&#39;</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">ERROR:  </span><span style="color:#D73A49;">password</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">is</span><span style="color:#24292E;"> too short</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">-- error: contains user name</span></span>
<span class="line"><span style="color:#D73A49;">ALTER</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">USER</span><span style="color:#24292E;"> regress_user1 </span><span style="color:#D73A49;">PASSWORD</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;xyzregress_user1&#39;</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">ERROR:  </span><span style="color:#D73A49;">password</span><span style="color:#24292E;"> must </span><span style="color:#D73A49;">not</span><span style="color:#24292E;"> contain user </span><span style="color:#D73A49;">name</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">-- error: contains only letters</span></span>
<span class="line"><span style="color:#D73A49;">ALTER</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">USER</span><span style="color:#24292E;"> regress_user1 </span><span style="color:#D73A49;">PASSWORD</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;alessnicelongpassword&#39;</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">ERROR:  </span><span style="color:#D73A49;">password</span><span style="color:#24292E;"> must contain </span><span style="color:#D73A49;">both</span><span style="color:#24292E;"> letters </span><span style="color:#D73A49;">and</span><span style="color:#24292E;"> nonletters</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">-- encrypted ok (password is &quot;secret&quot;)</span></span>
<span class="line"><span style="color:#D73A49;">ALTER</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">USER</span><span style="color:#24292E;"> regress_user1 </span><span style="color:#D73A49;">PASSWORD</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;md51a44d829a20a23eac686d9f0d258af13&#39;</span><span style="color:#24292E;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">-- error: password is user name</span></span>
<span class="line"><span style="color:#D73A49;">ALTER</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">USER</span><span style="color:#24292E;"> regress_user1 </span><span style="color:#D73A49;">PASSWORD</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;md5e589150ae7d28f93333afae92b36ef48&#39;</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">ERROR:  </span><span style="color:#D73A49;">password</span><span style="color:#24292E;"> must </span><span style="color:#D73A49;">not</span><span style="color:#24292E;"> equal user </span><span style="color:#D73A49;">name</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">DROP</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">USER</span><span style="color:#24292E;"> regress_user1;</span></span></code></pre></div><h3 id="_2-自定义配置复杂策略" tabindex="-1">2.自定义配置复杂策略 <a class="header-anchor" href="#_2-自定义配置复杂策略" aria-label="Permalink to &quot;2.自定义配置复杂策略&quot;">​</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">2.1修改passwordcheck.c源文件</span></span>
<span class="line"><span style="color:#B392F0;">参考例子</span></span>
<span class="line"><span style="color:#B392F0;">https://github.com/Luckyness/passwordcheck/blob/master/passwordcheck.c</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">2.2重新编译</span></span>
<span class="line"><span style="color:#B392F0;">$</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">gmake</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">clean</span></span>
<span class="line"><span style="color:#B392F0;">$</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">gmake</span></span>
<span class="line"><span style="color:#B392F0;">$</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">gmake</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">install</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">2.3配置重启服务</span></span>
<span class="line"><span style="color:#B392F0;">$</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">vi</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">postgresql.conf</span></span>
<span class="line"><span style="color:#B392F0;">shared_preload_libraries</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;passwordcheck&#39;</span></span>
<span class="line"><span style="color:#B392F0;">passwordcheck.level</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;true&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">2.4测试</span></span>
<span class="line"><span style="color:#E1E4E8;">postgres</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">#</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">alter</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">role</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">postgres</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">encrypted</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">password</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;abcde123&#39;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#B392F0;">2020-02-12</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">16</span><span style="color:#9ECBFF;">:45:11.210</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">CST</span><span style="color:#E1E4E8;"> [4763] ERROR:  password must contain both letters and number and specialchar</span></span>
<span class="line"><span style="color:#B392F0;">2020-02-12</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">16</span><span style="color:#9ECBFF;">:45:11.210</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">CST</span><span style="color:#E1E4E8;"> [4763] STATEMENT:  alter role postgres encrypted password </span><span style="color:#9ECBFF;">&#39;abcde123&#39;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#B392F0;">ERROR:</span><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">password</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">must</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">contain</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">both</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">letters</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">and</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">number</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">and</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">specialchar</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">2.1修改passwordcheck.c源文件</span></span>
<span class="line"><span style="color:#6F42C1;">参考例子</span></span>
<span class="line"><span style="color:#6F42C1;">https://github.com/Luckyness/passwordcheck/blob/master/passwordcheck.c</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">2.2重新编译</span></span>
<span class="line"><span style="color:#6F42C1;">$</span><span style="color:#24292E;"> </span><span style="color:#032F62;">gmake</span><span style="color:#24292E;"> </span><span style="color:#032F62;">clean</span></span>
<span class="line"><span style="color:#6F42C1;">$</span><span style="color:#24292E;"> </span><span style="color:#032F62;">gmake</span></span>
<span class="line"><span style="color:#6F42C1;">$</span><span style="color:#24292E;"> </span><span style="color:#032F62;">gmake</span><span style="color:#24292E;"> </span><span style="color:#032F62;">install</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">2.3配置重启服务</span></span>
<span class="line"><span style="color:#6F42C1;">$</span><span style="color:#24292E;"> </span><span style="color:#032F62;">vi</span><span style="color:#24292E;"> </span><span style="color:#032F62;">postgresql.conf</span></span>
<span class="line"><span style="color:#6F42C1;">shared_preload_libraries</span><span style="color:#24292E;"> </span><span style="color:#032F62;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;passwordcheck&#39;</span></span>
<span class="line"><span style="color:#6F42C1;">passwordcheck.level</span><span style="color:#24292E;"> </span><span style="color:#032F62;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;true&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">2.4测试</span></span>
<span class="line"><span style="color:#24292E;">postgres</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">#</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">alter</span><span style="color:#24292E;"> </span><span style="color:#032F62;">role</span><span style="color:#24292E;"> </span><span style="color:#032F62;">postgres</span><span style="color:#24292E;"> </span><span style="color:#032F62;">encrypted</span><span style="color:#24292E;"> </span><span style="color:#032F62;">password</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;abcde123&#39;</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#6F42C1;">2020-02-12</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">16</span><span style="color:#032F62;">:45:11.210</span><span style="color:#24292E;"> </span><span style="color:#032F62;">CST</span><span style="color:#24292E;"> [4763] ERROR:  password must contain both letters and number and specialchar</span></span>
<span class="line"><span style="color:#6F42C1;">2020-02-12</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">16</span><span style="color:#032F62;">:45:11.210</span><span style="color:#24292E;"> </span><span style="color:#032F62;">CST</span><span style="color:#24292E;"> [4763] STATEMENT:  alter role postgres encrypted password </span><span style="color:#032F62;">&#39;abcde123&#39;</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#6F42C1;">ERROR:</span><span style="color:#24292E;">  </span><span style="color:#032F62;">password</span><span style="color:#24292E;"> </span><span style="color:#032F62;">must</span><span style="color:#24292E;"> </span><span style="color:#032F62;">contain</span><span style="color:#24292E;"> </span><span style="color:#032F62;">both</span><span style="color:#24292E;"> </span><span style="color:#032F62;">letters</span><span style="color:#24292E;"> </span><span style="color:#032F62;">and</span><span style="color:#24292E;"> </span><span style="color:#032F62;">number</span><span style="color:#24292E;"> </span><span style="color:#032F62;">and</span><span style="color:#24292E;"> </span><span style="color:#032F62;">specialchar</span></span></code></pre></div><h3 id="_3-密码验证失败延迟" tabindex="-1">3.密码验证失败延迟 <a class="header-anchor" href="#_3-密码验证失败延迟" aria-label="Permalink to &quot;3.密码验证失败延迟&quot;">​</a></h3><p>主要用于防止暴力破解，验证失败后，延迟一个时间窗口才能继续验证</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">3.1安装</span></span>
<span class="line"><span style="color:#B392F0;">$</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">cd</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/opt/postgresql-12.1/contrib/auth_delay/</span></span>
<span class="line"><span style="color:#B392F0;">$</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">gmake</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">clean</span></span>
<span class="line"><span style="color:#B392F0;">$</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">gmake</span><span style="color:#E1E4E8;"> </span></span>
<span class="line"><span style="color:#B392F0;">$</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">gmake</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">install</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">3.2配置</span></span>
<span class="line"><span style="color:#B392F0;">$</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">vi</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">postgresql.conf</span></span>
<span class="line"><span style="color:#B392F0;">shared_preload_libraries</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;auth_delay,passwordcheck&#39;</span></span>
<span class="line"><span style="color:#B392F0;">auth_delay.milliseconds</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5000</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">3.3测试</span></span>
<span class="line"><span style="color:#B392F0;">$</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/opt/pgsql/bin/psql</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-h127.0.0.1</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-Uregress_user1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">postgres</span></span>
<span class="line"><span style="color:#B392F0;">Password</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">for</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">user</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">regress_user1:</span></span>
<span class="line"><span style="color:#B392F0;">密码输入错误后,</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">需要等待5秒返回认证失败.</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">防止暴力破解密码</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">3.1安装</span></span>
<span class="line"><span style="color:#6F42C1;">$</span><span style="color:#24292E;"> </span><span style="color:#032F62;">cd</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/opt/postgresql-12.1/contrib/auth_delay/</span></span>
<span class="line"><span style="color:#6F42C1;">$</span><span style="color:#24292E;"> </span><span style="color:#032F62;">gmake</span><span style="color:#24292E;"> </span><span style="color:#032F62;">clean</span></span>
<span class="line"><span style="color:#6F42C1;">$</span><span style="color:#24292E;"> </span><span style="color:#032F62;">gmake</span><span style="color:#24292E;"> </span></span>
<span class="line"><span style="color:#6F42C1;">$</span><span style="color:#24292E;"> </span><span style="color:#032F62;">gmake</span><span style="color:#24292E;"> </span><span style="color:#032F62;">install</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">3.2配置</span></span>
<span class="line"><span style="color:#6F42C1;">$</span><span style="color:#24292E;"> </span><span style="color:#032F62;">vi</span><span style="color:#24292E;"> </span><span style="color:#032F62;">postgresql.conf</span></span>
<span class="line"><span style="color:#6F42C1;">shared_preload_libraries</span><span style="color:#24292E;"> </span><span style="color:#032F62;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;auth_delay,passwordcheck&#39;</span></span>
<span class="line"><span style="color:#6F42C1;">auth_delay.milliseconds</span><span style="color:#24292E;"> </span><span style="color:#032F62;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5000</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">3.3测试</span></span>
<span class="line"><span style="color:#6F42C1;">$</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/opt/pgsql/bin/psql</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-h127.0.0.1</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-Uregress_user1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">postgres</span></span>
<span class="line"><span style="color:#6F42C1;">Password</span><span style="color:#24292E;"> </span><span style="color:#032F62;">for</span><span style="color:#24292E;"> </span><span style="color:#032F62;">user</span><span style="color:#24292E;"> </span><span style="color:#032F62;">regress_user1:</span></span>
<span class="line"><span style="color:#6F42C1;">密码输入错误后,</span><span style="color:#24292E;"> </span><span style="color:#032F62;">需要等待5秒返回认证失败.</span><span style="color:#24292E;"> </span><span style="color:#032F62;">防止暴力破解密码</span></span></code></pre></div><h3 id="_4-密码有效期" tabindex="-1">4.密码有效期 <a class="header-anchor" href="#_4-密码有效期" aria-label="Permalink to &quot;4.密码有效期&quot;">​</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">4.1</span><span style="color:#E1E4E8;">	</span><span style="color:#9ECBFF;">配置</span></span>
<span class="line"><span style="color:#E1E4E8;">postgres</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">#</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">alter</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">role</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">postgres</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">valid</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">until</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;2020-03-01&#39;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#B392F0;">4.2</span><span style="color:#E1E4E8;">	</span><span style="color:#9ECBFF;">查看用户密码到期时间</span></span>
<span class="line"><span style="color:#E1E4E8;">postgres</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">#</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">\\du+</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">postgres</span></span>
<span class="line"><span style="color:#E1E4E8;">                                          </span><span style="color:#B392F0;">List</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">of</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">roles</span></span>
<span class="line"><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Role</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">name</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">                         </span><span style="color:#B392F0;">Attributes</span><span style="color:#E1E4E8;">                         </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Member</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">of</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Description</span><span style="color:#E1E4E8;"> </span></span>
<span class="line"><span style="color:#B392F0;">-----------+------------------------------------------------------------+-----------+-------------</span></span>
<span class="line"><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">postgres</span><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Superuser,</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Create</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">role,</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Create</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">DB,</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Replication,</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Bypass</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">RLS+</span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> {}        </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span></span>
<span class="line"><span style="color:#E1E4E8;">           </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Password</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">valid</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">until</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2020</span><span style="color:#9ECBFF;">-03-01</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">00</span><span style="color:#9ECBFF;">:00:00+08</span><span style="color:#E1E4E8;">                </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">           </span><span style="color:#F97583;">|</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">4.1</span><span style="color:#24292E;">	</span><span style="color:#032F62;">配置</span></span>
<span class="line"><span style="color:#24292E;">postgres</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">#</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">alter</span><span style="color:#24292E;"> </span><span style="color:#032F62;">role</span><span style="color:#24292E;"> </span><span style="color:#032F62;">postgres</span><span style="color:#24292E;"> </span><span style="color:#032F62;">valid</span><span style="color:#24292E;"> </span><span style="color:#032F62;">until</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;2020-03-01&#39;</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#6F42C1;">4.2</span><span style="color:#24292E;">	</span><span style="color:#032F62;">查看用户密码到期时间</span></span>
<span class="line"><span style="color:#24292E;">postgres</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">#</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">\\du+</span><span style="color:#24292E;"> </span><span style="color:#032F62;">postgres</span></span>
<span class="line"><span style="color:#24292E;">                                          </span><span style="color:#6F42C1;">List</span><span style="color:#24292E;"> </span><span style="color:#032F62;">of</span><span style="color:#24292E;"> </span><span style="color:#032F62;">roles</span></span>
<span class="line"><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Role</span><span style="color:#24292E;"> </span><span style="color:#032F62;">name</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">                         </span><span style="color:#6F42C1;">Attributes</span><span style="color:#24292E;">                         </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Member</span><span style="color:#24292E;"> </span><span style="color:#032F62;">of</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Description</span><span style="color:#24292E;"> </span></span>
<span class="line"><span style="color:#6F42C1;">-----------+------------------------------------------------------------+-----------+-------------</span></span>
<span class="line"><span style="color:#24292E;"> </span><span style="color:#6F42C1;">postgres</span><span style="color:#24292E;">  </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Superuser,</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Create</span><span style="color:#24292E;"> </span><span style="color:#032F62;">role,</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Create</span><span style="color:#24292E;"> </span><span style="color:#032F62;">DB,</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Replication,</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Bypass</span><span style="color:#24292E;"> </span><span style="color:#032F62;">RLS+</span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> {}        </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span></span>
<span class="line"><span style="color:#24292E;">           </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Password</span><span style="color:#24292E;"> </span><span style="color:#032F62;">valid</span><span style="color:#24292E;"> </span><span style="color:#032F62;">until</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2020</span><span style="color:#032F62;">-03-01</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">00</span><span style="color:#032F62;">:00:00+08</span><span style="color:#24292E;">                </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">           </span><span style="color:#D73A49;">|</span></span></code></pre></div><h2 id="_11-权限配置" tabindex="-1">11.权限配置 <a class="header-anchor" href="#_11-权限配置" aria-label="Permalink to &quot;11.权限配置&quot;">​</a></h2>`,85),e=[o];function t(c,r,E,y,i,F){return a(),n("div",null,e)}const C=s(p,[["render",t]]);export{h as __pageData,C as default};
