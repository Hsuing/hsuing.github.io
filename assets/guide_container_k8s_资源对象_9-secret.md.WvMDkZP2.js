import{_ as s,o as a,c as n,R as l}from"./chunks/framework.zUbWieqp.js";const u=JSON.parse('{"title":"1. Secret基本概念","description":"","frontmatter":{},"headers":[],"relativePath":"guide/container/k8s/资源对象/9-secret.md","filePath":"guide/container/k8s/资源对象/9-secret.md","lastUpdated":1730111076000}'),p={name:"guide/container/k8s/资源对象/9-secret.md"},o=l(`<p>官方文档,<a href="https://kubernetes.io/docs/concepts/configuration/secret/" target="_blank" rel="noreferrer">https://kubernetes.io/docs/concepts/configuration/secret/</a></p><h1 id="_1-secret基本概念" tabindex="-1">1. Secret基本概念 <a class="header-anchor" href="#_1-secret基本概念" aria-label="Permalink to &quot;1. Secret基本概念&quot;">​</a></h1><h2 id="_1-1-什么是secret" tabindex="-1">1.1 什么是Secret <a class="header-anchor" href="#_1-1-什么是secret" aria-label="Permalink to &quot;1.1 什么是Secret&quot;">​</a></h2><p>Secret 资源的功能类似于 ConfigMap，但它专用于存放敏感数据，例如密码、数字证书、私钥、令牌 和 SSH key 等。</p><p>Secret 对象存储数据的方式及使用方式类似于 ConfigMap 对象，<code>相同的是，都以键值方式存储数据</code>，在 Pod 资源中通过环境变量或存储卷进行数据访问。不同的是，Secret 对象仅会被分发至调用了对象的 Pod 资源所在的<code>工作节点</code>，且只能由节点将其存储于内存中。另外，Secret 对象的数据的存储及打印格式为 Base64 编码的字符串，因此用户创建 Secret 对象时也要提供此编码格式的数据。在容器中以环境变量或存储卷的方式访问时，它们会被自动解码为明文格式。</p><p>需要注意的是，在 Master 节点上，Secret 对象以非加密的格式存储于 etcd 中，因此管理员必须加以精心管控以确保敏感数据的机密性，必须确保 etcd 集群节点间以及与 API Server 的安全通信，etcd 服务的访问授权，还包括用户访问 API Server 时的授权，因为拥有创建 Pod 资源的用户都可以使用 Secret 资源并能够通过 Pod 的容器访问其数据。</p><h2 id="_1-2-为何需要secret" tabindex="-1">1.2 为何需要Secret <a class="header-anchor" href="#_1-2-为何需要secret" aria-label="Permalink to &quot;1.2 为何需要Secret&quot;">​</a></h2><p>前面我们通过<code>ConfigMap</code>来实现应用与配置的解耦，但是解耦不仅仅只有配置文件，还应该有默认口令（例如MySQL、Redis服务访问的口令），用于SSL通信时的数字证书，用于认证的令牌和ssh key等，但这些敏感数据不适合存储在ConfigMap中，而是要用另一种被称为Secret的资源。将敏感数据存储在<code>Secret</code>中比明文存储在ConfigMap或Pod配置清单中更加安全。</p><h2 id="_1-3-secret资源类别" tabindex="-1">1.3 Secret资源类别 <a class="header-anchor" href="#_1-3-secret资源类别" aria-label="Permalink to &quot;1.3 Secret资源类别&quot;">​</a></h2><p>Secret类似于ConfigMap资源，创建Secret对象也支持命令行、文件、目录等多种方式的数据源，而根据其存储格式及用途的不同，Secret对象还会划分为如下3种类别。</p><ul><li><code>docker-registry</code>：用于认证Docker Registry的Secret，以便于用户能使用私有容器镜像。</li><li><code>generic</code>：基于本地文件、目录或命令行创建的Secret，一般用于存储密码、秘钥、等信息。</li><li><code>tls</code>：基于指定的公钥和私钥对来创建TLSSecret，专用于TLS通信</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">[root@kube-master secret]# kubectl create secret</span></span>
<span class="line"><span style="color:#B392F0;">Create</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">a</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">secret</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">using</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">specified</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">subcommand.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">Available</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Commands:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">docker-registry</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">创建一个给</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Docker</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">registry</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">使用的</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">secret</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">generic</span><span style="color:#E1E4E8;">         </span><span style="color:#9ECBFF;">Create</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">a</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">secret</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">from</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">a</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">local</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">file,</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">directory,</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">or</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">literal</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">value</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">tls</span><span style="color:#E1E4E8;">             </span><span style="color:#9ECBFF;">创建一个</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">TLS</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">secret</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">Usage:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">create</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">secret</span><span style="color:#E1E4E8;"> [flags] [options]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">Use</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;kubectl &lt;command&gt; --help&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">for</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">more</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">information</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">about</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">a</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">given</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">command.</span></span>
<span class="line"><span style="color:#B392F0;">Use</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;kubectl options&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">for</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">a</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">list</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">of</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">global</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">command-line</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">options</span><span style="color:#E1E4E8;"> (applies </span><span style="color:#9ECBFF;">to</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">all</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">commands</span><span style="color:#E1E4E8;">).</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">[root@kube-master secret]# kubectl create secret</span></span>
<span class="line"><span style="color:#6F42C1;">Create</span><span style="color:#24292E;"> </span><span style="color:#032F62;">a</span><span style="color:#24292E;"> </span><span style="color:#032F62;">secret</span><span style="color:#24292E;"> </span><span style="color:#032F62;">using</span><span style="color:#24292E;"> </span><span style="color:#032F62;">specified</span><span style="color:#24292E;"> </span><span style="color:#032F62;">subcommand.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">Available</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Commands:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">docker-registry</span><span style="color:#24292E;"> </span><span style="color:#032F62;">创建一个给</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Docker</span><span style="color:#24292E;"> </span><span style="color:#032F62;">registry</span><span style="color:#24292E;"> </span><span style="color:#032F62;">使用的</span><span style="color:#24292E;"> </span><span style="color:#032F62;">secret</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">generic</span><span style="color:#24292E;">         </span><span style="color:#032F62;">Create</span><span style="color:#24292E;"> </span><span style="color:#032F62;">a</span><span style="color:#24292E;"> </span><span style="color:#032F62;">secret</span><span style="color:#24292E;"> </span><span style="color:#032F62;">from</span><span style="color:#24292E;"> </span><span style="color:#032F62;">a</span><span style="color:#24292E;"> </span><span style="color:#032F62;">local</span><span style="color:#24292E;"> </span><span style="color:#032F62;">file,</span><span style="color:#24292E;"> </span><span style="color:#032F62;">directory,</span><span style="color:#24292E;"> </span><span style="color:#032F62;">or</span><span style="color:#24292E;"> </span><span style="color:#032F62;">literal</span><span style="color:#24292E;"> </span><span style="color:#032F62;">value</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">tls</span><span style="color:#24292E;">             </span><span style="color:#032F62;">创建一个</span><span style="color:#24292E;"> </span><span style="color:#032F62;">TLS</span><span style="color:#24292E;"> </span><span style="color:#032F62;">secret</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">Usage:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">create</span><span style="color:#24292E;"> </span><span style="color:#032F62;">secret</span><span style="color:#24292E;"> [flags] [options]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">Use</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;kubectl &lt;command&gt; --help&quot;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">for</span><span style="color:#24292E;"> </span><span style="color:#032F62;">more</span><span style="color:#24292E;"> </span><span style="color:#032F62;">information</span><span style="color:#24292E;"> </span><span style="color:#032F62;">about</span><span style="color:#24292E;"> </span><span style="color:#032F62;">a</span><span style="color:#24292E;"> </span><span style="color:#032F62;">given</span><span style="color:#24292E;"> </span><span style="color:#032F62;">command.</span></span>
<span class="line"><span style="color:#6F42C1;">Use</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;kubectl options&quot;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">for</span><span style="color:#24292E;"> </span><span style="color:#032F62;">a</span><span style="color:#24292E;"> </span><span style="color:#032F62;">list</span><span style="color:#24292E;"> </span><span style="color:#032F62;">of</span><span style="color:#24292E;"> </span><span style="color:#032F62;">global</span><span style="color:#24292E;"> </span><span style="color:#032F62;">command-line</span><span style="color:#24292E;"> </span><span style="color:#032F62;">options</span><span style="color:#24292E;"> (applies </span><span style="color:#032F62;">to</span><span style="color:#24292E;"> </span><span style="color:#032F62;">all</span><span style="color:#24292E;"> </span><span style="color:#032F62;">commands</span><span style="color:#24292E;">).</span></span></code></pre></div><h2 id="_1-4-secret类型组成" tabindex="-1">1.4 Secret类型组成 <a class="header-anchor" href="#_1-4-secret类型组成" aria-label="Permalink to &quot;1.4 Secret类型组成&quot;">​</a></h2><ul><li>Opaque: 自定义数据内容：base64编码，用来存储密码、密钥、信息、证书等数据。</li><li>kubernetes.io/tls: 用于为 SSL 通信模式存储证书和私钥文件，命令式创建时类型表示为 tls。</li><li>kubernetes.io/dockerconfigjson: 用来存储 Docker 镜像仓库的认证信息，类型标识为 docker-registry。</li><li>kubernetes.io/servcie-account-token: Servcie Account 的认证信息，可在创建 Service Account 时由 Kubernetes 自动创建。</li></ul><div class="warning custom-block"><p class="custom-block-title">💡 说明</p><p>base64<code></code>编码并非加密机制，其编码的数据可使用 <code>&quot;base64 --decode&quot;</code> 一类的命令进行解码</p></div><h2 id="_1-5-secret配置文件" tabindex="-1">1.5 Secret配置文件 <a class="header-anchor" href="#_1-5-secret配置文件" aria-label="Permalink to &quot;1.5 Secret配置文件&quot;">​</a></h2><ul><li>与ConfigMap类似，区别在于Secret主要存储敏感数据，所有的数据要经过base64编码。</li><li>应用场景：凭据</li><li>kubectl create secret 支持三种数据类型： <ul><li>docker-registry（kubernetes.io/dockerconfigjson）：存储镜像仓库认证信息</li><li>generic（Opaque）：存储密码、密钥等</li><li>tls（kubernetes.io/tls）：存储TLS证书</li></ul></li></ul><p><img src="https://nnaigos.oss-cn-hangzhou.aliyuncs.com/imgs/202408070937979.png" alt="image"></p><h1 id="_2-创建secrets" tabindex="-1">2. 创建Secrets <a class="header-anchor" href="#_2-创建secrets" aria-label="Permalink to &quot;2. 创建Secrets&quot;">​</a></h1><p><strong>帮助</strong></p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">explain</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">secret</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">explain</span><span style="color:#24292E;"> </span><span style="color:#032F62;">secret</span></span></code></pre></div><h2 id="_2-1-基于命令创建secret" tabindex="-1">2.1 基于命令创建Secret <a class="header-anchor" href="#_2-1-基于命令创建secret" aria-label="Permalink to &quot;2.1 基于命令创建Secret&quot;">​</a></h2><ul><li>帮助文档</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">create</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">secret</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--help</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">create</span><span style="color:#24292E;"> </span><span style="color:#032F62;">secret</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--help</span></span></code></pre></div><p>使用Secret为容器中运行的服务提供用于认证的用户名和密码是一种常见的应用场景，像MySQL镜像就支持通过环境变量来设置管理员用户的默认密码。</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">[root@kube-master secret]# kubectl create secret generic mysql-auth-secret --from-literal=username=root --from-literal=password=ikubernetes</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">generic</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">---</span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">The</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">name</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">of</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">the</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">API</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">generator</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">to</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">use.</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">[root@kube-master secret]# kubectl create secret generic mysql-auth-secret --from-literal=username=root --from-literal=password=ikubernetes</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">generic</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">---</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">The</span><span style="color:#24292E;"> </span><span style="color:#032F62;">name</span><span style="color:#24292E;"> </span><span style="color:#032F62;">of</span><span style="color:#24292E;"> </span><span style="color:#032F62;">the</span><span style="color:#24292E;"> </span><span style="color:#032F62;">API</span><span style="color:#24292E;"> </span><span style="color:#032F62;">generator</span><span style="color:#24292E;"> </span><span style="color:#032F62;">to</span><span style="color:#24292E;"> </span><span style="color:#032F62;">use.</span></span></code></pre></div><ul><li>查看</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">[root@kube-master secret]# kubectl get secrets mysql-auth-secret</span></span>
<span class="line"><span style="color:#B392F0;">NAME</span><span style="color:#E1E4E8;">                </span><span style="color:#9ECBFF;">TYPE</span><span style="color:#E1E4E8;">     </span><span style="color:#9ECBFF;">DATA</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">AGE</span></span>
<span class="line"><span style="color:#B392F0;">mysql-auth-secret</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">Opaque</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">2</span><span style="color:#E1E4E8;">      </span><span style="color:#79B8FF;">29</span><span style="color:#9ECBFF;">m</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#查看内容</span></span>
<span class="line"><span style="color:#E1E4E8;">[root@kube-master secret]# kubectl get secrets mysql-auth-secret -oyaml</span></span>
<span class="line"><span style="color:#B392F0;">apiVersion:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">v1</span></span>
<span class="line"><span style="color:#B392F0;">data:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">password:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">aWt1YmVybmV0ZXM=</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">username:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">cm9vdA==</span></span>
<span class="line"><span style="color:#B392F0;">kind:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Secret</span></span>
<span class="line"><span style="color:#B392F0;">metadata:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">creationTimestamp:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;2024-05-29T07:23:46Z&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">name:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">mysql-auth-secret</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">namespace:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">default</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">resourceVersion:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;1660181&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">uid:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">f454b6d5-4aab-42fe-9bee-c44f91b17877</span></span>
<span class="line"><span style="color:#79B8FF;">type</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Opaque</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#解密</span></span>
<span class="line"><span style="color:#79B8FF;">echo</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">aWt1YmVybmV0ZXM=</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">base64</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-d</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">[root@kube-master secret]# kubectl get secrets mysql-auth-secret</span></span>
<span class="line"><span style="color:#6F42C1;">NAME</span><span style="color:#24292E;">                </span><span style="color:#032F62;">TYPE</span><span style="color:#24292E;">     </span><span style="color:#032F62;">DATA</span><span style="color:#24292E;">   </span><span style="color:#032F62;">AGE</span></span>
<span class="line"><span style="color:#6F42C1;">mysql-auth-secret</span><span style="color:#24292E;">   </span><span style="color:#032F62;">Opaque</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">2</span><span style="color:#24292E;">      </span><span style="color:#005CC5;">29</span><span style="color:#032F62;">m</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#查看内容</span></span>
<span class="line"><span style="color:#24292E;">[root@kube-master secret]# kubectl get secrets mysql-auth-secret -oyaml</span></span>
<span class="line"><span style="color:#6F42C1;">apiVersion:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">v1</span></span>
<span class="line"><span style="color:#6F42C1;">data:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">password:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">aWt1YmVybmV0ZXM=</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">username:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">cm9vdA==</span></span>
<span class="line"><span style="color:#6F42C1;">kind:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Secret</span></span>
<span class="line"><span style="color:#6F42C1;">metadata:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">creationTimestamp:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;2024-05-29T07:23:46Z&quot;</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">name:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">mysql-auth-secret</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">namespace:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">default</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">resourceVersion:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;1660181&quot;</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">uid:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">f454b6d5-4aab-42fe-9bee-c44f91b17877</span></span>
<span class="line"><span style="color:#005CC5;">type</span><span style="color:#24292E;">: </span><span style="color:#032F62;">Opaque</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#解密</span></span>
<span class="line"><span style="color:#005CC5;">echo</span><span style="color:#24292E;"> </span><span style="color:#032F62;">aWt1YmVybmV0ZXM=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">base64</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-d</span></span></code></pre></div><h2 id="_2-2-基于文件创建secret" tabindex="-1">2.2 基于⽂件创建Secret <a class="header-anchor" href="#_2-2-基于文件创建secret" aria-label="Permalink to &quot;2.2 基于⽂件创建Secret&quot;">​</a></h2><p><code>Secret</code>中包含Pod访问数据库所需的用户凭证，除了通过命令行创建，也可以通过文件方式创建；将用户名存储在文件<code>./username.txt</code>中，将密码存储在文件<code>./password.txt</code>中。</p><p>1.准备文件</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">[root@kube-master secret]# echo echo -n </span><span style="color:#9ECBFF;">&#39;han&#39;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;"> ./username.txt</span></span>
<span class="line"><span style="color:#E1E4E8;">[root@kube-master secret]# echo -n </span><span style="color:#9ECBFF;">&#39;123456&#39;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;"> ./password.txt</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">[root@kube-master secret]# echo echo -n </span><span style="color:#032F62;">&#39;han&#39;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;"> ./username.txt</span></span>
<span class="line"><span style="color:#24292E;">[root@kube-master secret]# echo -n </span><span style="color:#032F62;">&#39;123456&#39;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;"> ./password.txt</span></span></code></pre></div><p>2.通过kubectl create secret 命令将这些⽂件打包成⼀个Secret 对象</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">[root@kube-master secret]# kubectl create secret generic mysql-auth-secrets --from-file=./username.txt --from-file=./password.txt</span></span>
<span class="line"><span style="color:#B392F0;">secret/mysql-auth-secrets</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">created</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#查看</span></span>
<span class="line"><span style="color:#E1E4E8;">[root@kube-master secret]# kubectl get secrets</span></span>
<span class="line"><span style="color:#B392F0;">NAME</span><span style="color:#E1E4E8;">                  </span><span style="color:#9ECBFF;">TYPE</span><span style="color:#E1E4E8;">                                  </span><span style="color:#9ECBFF;">DATA</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">AGE</span></span>
<span class="line"><span style="color:#B392F0;">mysql-auth-secrets</span><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">Opaque</span><span style="color:#E1E4E8;">                                </span><span style="color:#79B8FF;">2</span><span style="color:#E1E4E8;">      </span><span style="color:#79B8FF;">50</span><span style="color:#9ECBFF;">s</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">[root@kube-master secret]# kubectl create secret generic mysql-auth-secrets --from-file=./username.txt --from-file=./password.txt</span></span>
<span class="line"><span style="color:#6F42C1;">secret/mysql-auth-secrets</span><span style="color:#24292E;"> </span><span style="color:#032F62;">created</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#查看</span></span>
<span class="line"><span style="color:#24292E;">[root@kube-master secret]# kubectl get secrets</span></span>
<span class="line"><span style="color:#6F42C1;">NAME</span><span style="color:#24292E;">                  </span><span style="color:#032F62;">TYPE</span><span style="color:#24292E;">                                  </span><span style="color:#032F62;">DATA</span><span style="color:#24292E;">   </span><span style="color:#032F62;">AGE</span></span>
<span class="line"><span style="color:#6F42C1;">mysql-auth-secrets</span><span style="color:#24292E;">    </span><span style="color:#032F62;">Opaque</span><span style="color:#24292E;">                                </span><span style="color:#005CC5;">2</span><span style="color:#24292E;">      </span><span style="color:#005CC5;">50</span><span style="color:#032F62;">s</span></span></code></pre></div><h2 id="_2-3-基于tls-secret" tabindex="-1">2.3 基于TLS Secret <a class="header-anchor" href="#_2-3-基于tls-secret" aria-label="Permalink to &quot;2.3 基于TLS Secret&quot;">​</a></h2><p>为Nginx应⽤创建SSL虚拟主机时，需要先通过Secret对象向容器注⼊服务器证书，以供nginx进程加载使⽤</p><ul><li>帮助文档</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">create</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">tls</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--help</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">create</span><span style="color:#24292E;"> </span><span style="color:#032F62;">tls</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--help</span></span></code></pre></div><p>1.准备⼀个⾃签证书</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">#生成key</span></span>
<span class="line"><span style="color:#B392F0;">openssl</span><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">genrsa</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-out</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">nginx.key</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2048</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#生成crt</span></span>
<span class="line"><span style="color:#B392F0;">openssl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">req</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-new</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-x509</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-key</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">nginx.key</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-out</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">nginx.crt</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-subj</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;/C=CN/ST=BJ/L=BJ/O=DevOps/CN=book.ikubernetes.net&quot;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">#生成key</span></span>
<span class="line"><span style="color:#6F42C1;">openssl</span><span style="color:#24292E;">  </span><span style="color:#032F62;">genrsa</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-out</span><span style="color:#24292E;"> </span><span style="color:#032F62;">nginx.key</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2048</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#生成crt</span></span>
<span class="line"><span style="color:#6F42C1;">openssl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">req</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-new</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-x509</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-key</span><span style="color:#24292E;"> </span><span style="color:#032F62;">nginx.key</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-out</span><span style="color:#24292E;"> </span><span style="color:#032F62;">nginx.crt</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-subj</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;/C=CN/ST=BJ/L=BJ/O=DevOps/CN=book.ikubernetes.net&quot;</span></span></code></pre></div><p>2.创建tls类型的secret资源</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">[root@kube-master secret]# kubectl create secret tls nginx-tls-secret --key=nginx.key --cert=nginx.crt</span></span>
<span class="line"><span style="color:#B392F0;">secret/nginx-tls-secret</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">created</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">[root@kube-master secret]# kubectl create secret tls nginx-tls-secret --key=nginx.key --cert=nginx.crt</span></span>
<span class="line"><span style="color:#6F42C1;">secret/nginx-tls-secret</span><span style="color:#24292E;"> </span><span style="color:#032F62;">created</span></span></code></pre></div><p>3.查看</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">[root@kube-master secret]# kubectl get secrets nginx-tls-secret -oyaml</span></span>
<span class="line"><span style="color:#B392F0;">apiVersion:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">v1</span></span>
<span class="line"><span style="color:#B392F0;">data:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">tls.crt:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">......</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">tls.key:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">......</span></span>
<span class="line"><span style="color:#B392F0;">kind:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Secret</span></span>
<span class="line"><span style="color:#B392F0;">metadata:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">creationTimestamp:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;2024-05-30T07:21:11Z&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">name:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">nginx-tls-secret</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">namespace:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">default</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">resourceVersion:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;1729408&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">uid:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">7</span><span style="color:#9ECBFF;">dca0a90-822f-43e9-95f1-be1a7f6346c0</span></span>
<span class="line"><span style="color:#79B8FF;">type</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">kubernetes.io/tls</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">[root@kube-master secret]# kubectl get secrets nginx-tls-secret -oyaml</span></span>
<span class="line"><span style="color:#6F42C1;">apiVersion:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">v1</span></span>
<span class="line"><span style="color:#6F42C1;">data:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">tls.crt:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">......</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">tls.key:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">......</span></span>
<span class="line"><span style="color:#6F42C1;">kind:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Secret</span></span>
<span class="line"><span style="color:#6F42C1;">metadata:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">creationTimestamp:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;2024-05-30T07:21:11Z&quot;</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">name:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">nginx-tls-secret</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">namespace:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">default</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">resourceVersion:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;1729408&quot;</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">uid:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">7</span><span style="color:#032F62;">dca0a90-822f-43e9-95f1-be1a7f6346c0</span></span>
<span class="line"><span style="color:#005CC5;">type</span><span style="color:#24292E;">: </span><span style="color:#032F62;">kubernetes.io/tls</span></span></code></pre></div><div class="warning custom-block"><p class="custom-block-title">💡 说明</p><p>⽆论⽤户提供的证书是什么名称，最终都会转为tls.key私钥 tls.crt公钥</p></div><h2 id="_2-4-基于清单式创建" tabindex="-1">2.4 基于清单式创建 <a class="header-anchor" href="#_2-4-基于清单式创建" aria-label="Permalink to &quot;2.4 基于清单式创建&quot;">​</a></h2><p>Secret 资源是标准的 Kubernetes API 对象，除了标准的 apiVersion、kind 和 metadata 字段，它可用的其他字段具体如下：</p><ul><li><code>data &lt;map[string]string&gt;</code>: &quot;key:value&quot; 格式的数据，通常是敏感信息，数据格式需是以 Base64 格式编码的字符串，因此需要用户事先先完成编码。</li><li><code>stringData &lt;map[string]string&gt;</code>: 以明文格式（非 Base64 编码）定义的 &quot;key:value&quot; 数据；无须用户事先对数据进行 Base64 编码，而是在创建为 Secret 对象时自动进行编码并保存于 data 字段中，stringData 字段中明文不会被 API Server 输出，不过若是使用 &quot;kubectl apply&quot; 命令进行的创建，那么注解信息中还是可能会直接输出这些信息的。</li><li><code>type &lt;string&gt;</code>: 仅是为了便于编程方式处理 Secret 数据而提供的类型标识。</li></ul><h3 id="明文" tabindex="-1">明文 <a class="header-anchor" href="#明文" aria-label="Permalink to &quot;明文&quot;">​</a></h3><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">[</span><span style="color:#9ECBFF;">root@kube-master secret</span><span style="color:#E1E4E8;">]# </span><span style="color:#9ECBFF;">cat redis-demo.yaml</span></span>
<span class="line"><span style="color:#85E89D;">apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">v1</span></span>
<span class="line"><span style="color:#85E89D;">kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Secret</span></span>
<span class="line"><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">secret-demo</span></span>
<span class="line"><span style="color:#85E89D;">stringData</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">username</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">redis</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">password</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">redis@123</span></span>
<span class="line"><span style="color:#85E89D;">type</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Opaque</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">[</span><span style="color:#032F62;">root@kube-master secret</span><span style="color:#24292E;">]# </span><span style="color:#032F62;">cat redis-demo.yaml</span></span>
<span class="line"><span style="color:#22863A;">apiVersion</span><span style="color:#24292E;">: </span><span style="color:#032F62;">v1</span></span>
<span class="line"><span style="color:#22863A;">kind</span><span style="color:#24292E;">: </span><span style="color:#032F62;">Secret</span></span>
<span class="line"><span style="color:#22863A;">metadata</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">secret-demo</span></span>
<span class="line"><span style="color:#22863A;">stringData</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">username</span><span style="color:#24292E;">: </span><span style="color:#032F62;">redis</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">password</span><span style="color:#24292E;">: </span><span style="color:#032F62;">redis@123</span></span>
<span class="line"><span style="color:#22863A;">type</span><span style="color:#24292E;">: </span><span style="color:#032F62;">Opaque</span></span></code></pre></div><h3 id="加密" tabindex="-1">加密 <a class="header-anchor" href="#加密" aria-label="Permalink to &quot;加密&quot;">​</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">[root@kube-master secret]# echo -n </span><span style="color:#9ECBFF;">&quot;admin&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">base64</span></span>
<span class="line"><span style="color:#E1E4E8;">YWRtaW4</span><span style="color:#F97583;">=</span></span>
<span class="line"><span style="color:#E1E4E8;">[root@kube-master secret]# echo -n </span><span style="color:#9ECBFF;">&quot;123456&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">base64</span></span>
<span class="line"><span style="color:#B392F0;">MTIzNDU2</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">[root@kube-master secret]# echo -n </span><span style="color:#032F62;">&quot;admin&quot;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">base64</span></span>
<span class="line"><span style="color:#24292E;">YWRtaW4</span><span style="color:#D73A49;">=</span></span>
<span class="line"><span style="color:#24292E;">[root@kube-master secret]# echo -n </span><span style="color:#032F62;">&quot;123456&quot;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">base64</span></span>
<span class="line"><span style="color:#6F42C1;">MTIzNDU2</span></span></code></pre></div><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">[</span><span style="color:#9ECBFF;">root@kube-master secret</span><span style="color:#E1E4E8;">]# </span><span style="color:#9ECBFF;">cat secret-demo.yaml</span></span>
<span class="line"><span style="color:#85E89D;">apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">v1</span></span>
<span class="line"><span style="color:#85E89D;">kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Secret</span></span>
<span class="line"><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">secre-hello</span></span>
<span class="line"><span style="color:#85E89D;">data</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">user</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">YWRtaW4=</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">password</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">MTIzNDU2</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">[</span><span style="color:#032F62;">root@kube-master secret</span><span style="color:#24292E;">]# </span><span style="color:#032F62;">cat secret-demo.yaml</span></span>
<span class="line"><span style="color:#22863A;">apiVersion</span><span style="color:#24292E;">: </span><span style="color:#032F62;">v1</span></span>
<span class="line"><span style="color:#22863A;">kind</span><span style="color:#24292E;">: </span><span style="color:#032F62;">Secret</span></span>
<span class="line"><span style="color:#22863A;">metadata</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">secre-hello</span></span>
<span class="line"><span style="color:#22863A;">data</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">user</span><span style="color:#24292E;">: </span><span style="color:#032F62;">YWRtaW4=</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">password</span><span style="color:#24292E;">: </span><span style="color:#032F62;">MTIzNDU2</span></span></code></pre></div><h1 id="_3-pod引用secret" tabindex="-1">3. Pod引用Secret <a class="header-anchor" href="#_3-pod引用secret" aria-label="Permalink to &quot;3. Pod引用Secret&quot;">​</a></h1><ul><li>帮助文档</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">explain</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pod.spec.imagePullSecrets</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">explain</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pod.spec.imagePullSecrets</span></span></code></pre></div><h2 id="_3-1-secret存储卷" tabindex="-1">3.1 Secret存储卷 <a class="header-anchor" href="#_3-1-secret存储卷" aria-label="Permalink to &quot;3.1 Secret存储卷&quot;">​</a></h2><p>类似于 Pod 使用 ConfigMap 对象的方式，Secret 对象可以注入为环境变量，也可以存储为卷形式挂载使用</p><p>除了其类型及引⽤的标识需要替换为 <code>secret、secretName</code>之外，其他⼏乎⼀致，包括⽀持使⽤挂载整个存储卷，只挂载存储卷中指定的键值等</p><p>1.查看tls</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">[root@kube-master secret]# kubectl get secrets</span></span>
<span class="line"><span style="color:#B392F0;">NAME</span><span style="color:#E1E4E8;">                  </span><span style="color:#9ECBFF;">TYPE</span><span style="color:#E1E4E8;">                                  </span><span style="color:#9ECBFF;">DATA</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">AGE</span></span>
<span class="line"><span style="color:#B392F0;">nginx-tls-secret</span><span style="color:#E1E4E8;">      </span><span style="color:#9ECBFF;">kubernetes.io/tls</span><span style="color:#E1E4E8;">                     </span><span style="color:#79B8FF;">2</span><span style="color:#E1E4E8;">      </span><span style="color:#79B8FF;">60</span><span style="color:#9ECBFF;">m</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">[root@kube-master secret]# kubectl get secrets</span></span>
<span class="line"><span style="color:#6F42C1;">NAME</span><span style="color:#24292E;">                  </span><span style="color:#032F62;">TYPE</span><span style="color:#24292E;">                                  </span><span style="color:#032F62;">DATA</span><span style="color:#24292E;">   </span><span style="color:#032F62;">AGE</span></span>
<span class="line"><span style="color:#6F42C1;">nginx-tls-secret</span><span style="color:#24292E;">      </span><span style="color:#032F62;">kubernetes.io/tls</span><span style="color:#24292E;">                     </span><span style="color:#005CC5;">2</span><span style="color:#24292E;">      </span><span style="color:#005CC5;">60</span><span style="color:#032F62;">m</span></span></code></pre></div><p>2.创建</p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">[</span><span style="color:#9ECBFF;">root@kube-master secret</span><span style="color:#E1E4E8;">]# </span><span style="color:#9ECBFF;">cat secret-volume-demo.yaml</span></span>
<span class="line"><span style="color:#85E89D;">apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">v1</span></span>
<span class="line"><span style="color:#85E89D;">kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Pod</span></span>
<span class="line"><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">my-pod-demo</span></span>
<span class="line"><span style="color:#85E89D;">spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">volumes</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    - </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">my-volume</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;">#定义挂载名字，让volumMounts使用</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">secret</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">secretName</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">nginx-tls-secret</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">containers</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    - </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">my-container-demo</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">image</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">nginx:latest</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">ports</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">        - </span><span style="color:#85E89D;">containerPort</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">80</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">volumeMounts</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">        - </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">my-volume</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#85E89D;">mountPath</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">/etc/nginx/ssl</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#85E89D;">readOnly</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">true</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">[</span><span style="color:#032F62;">root@kube-master secret</span><span style="color:#24292E;">]# </span><span style="color:#032F62;">cat secret-volume-demo.yaml</span></span>
<span class="line"><span style="color:#22863A;">apiVersion</span><span style="color:#24292E;">: </span><span style="color:#032F62;">v1</span></span>
<span class="line"><span style="color:#22863A;">kind</span><span style="color:#24292E;">: </span><span style="color:#032F62;">Pod</span></span>
<span class="line"><span style="color:#22863A;">metadata</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">my-pod-demo</span></span>
<span class="line"><span style="color:#22863A;">spec</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">volumes</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">my-volume</span><span style="color:#24292E;"> </span><span style="color:#6A737D;">#定义挂载名字，让volumMounts使用</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">secret</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">secretName</span><span style="color:#24292E;">: </span><span style="color:#032F62;">nginx-tls-secret</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">containers</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">my-container-demo</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">image</span><span style="color:#24292E;">: </span><span style="color:#032F62;">nginx:latest</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">ports</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">        - </span><span style="color:#22863A;">containerPort</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">80</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">volumeMounts</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">        - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">my-volume</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#22863A;">mountPath</span><span style="color:#24292E;">: </span><span style="color:#032F62;">/etc/nginx/ssl</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#22863A;">readOnly</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">true</span></span></code></pre></div><p>3.执行</p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#9ECBFF;">kubectl apply -f secret-volume-demo.yaml</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#032F62;">kubectl apply -f secret-volume-demo.yaml</span></span></code></pre></div><p>4.验证效果</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">[root@kube-master secret]# kubectl exec -it my-pod-demo -- ls /etc/nginx/ssl</span></span>
<span class="line"><span style="color:#B392F0;">tls.crt</span><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">tls.key</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">[root@kube-master secret]# kubectl exec -it my-pod-demo -- ls /etc/nginx/ssl</span></span>
<span class="line"><span style="color:#6F42C1;">tls.crt</span><span style="color:#24292E;">  </span><span style="color:#032F62;">tls.key</span></span></code></pre></div><h2 id="_3-2-通过环境变量" tabindex="-1">3.2 通过环境变量 <a class="header-anchor" href="#_3-2-通过环境变量" aria-label="Permalink to &quot;3.2 通过环境变量&quot;">​</a></h2><p>Pod资源以环境变量⽅式获取Secret数据，存在两种⽅式</p><ul><li>将指定键的值传递给环境变量，一个一个传递，通过<code>env.valueFrom</code>字段实现;</li><li>将Secret对象上的全部键一次性全部映射为容器的环境变量，通过<code>envFrom</code>字段实现；</li></ul><h3 id="env" tabindex="-1">env <a class="header-anchor" href="#env" aria-label="Permalink to &quot;env&quot;">​</a></h3><p>1.创建secret</p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">[</span><span style="color:#9ECBFF;">root@kube-master secret</span><span style="color:#E1E4E8;">]# </span><span style="color:#9ECBFF;">cat secret-demo.yaml</span></span>
<span class="line"><span style="color:#85E89D;">apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">v1</span></span>
<span class="line"><span style="color:#85E89D;">kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Secret</span></span>
<span class="line"><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">secre-hello</span></span>
<span class="line"><span style="color:#85E89D;">data</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">user</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">YWRtaW4=</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">password</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">MTIzNDU2</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">[</span><span style="color:#032F62;">root@kube-master secret</span><span style="color:#24292E;">]# </span><span style="color:#032F62;">cat secret-demo.yaml</span></span>
<span class="line"><span style="color:#22863A;">apiVersion</span><span style="color:#24292E;">: </span><span style="color:#032F62;">v1</span></span>
<span class="line"><span style="color:#22863A;">kind</span><span style="color:#24292E;">: </span><span style="color:#032F62;">Secret</span></span>
<span class="line"><span style="color:#22863A;">metadata</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">secre-hello</span></span>
<span class="line"><span style="color:#22863A;">data</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">user</span><span style="color:#24292E;">: </span><span style="color:#032F62;">YWRtaW4=</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">password</span><span style="color:#24292E;">: </span><span style="color:#032F62;">MTIzNDU2</span></span></code></pre></div><p>2.创建pod</p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">[</span><span style="color:#9ECBFF;">root@kube-master secret</span><span style="color:#E1E4E8;">]# </span><span style="color:#9ECBFF;">cat secret-env.yaml</span></span>
<span class="line"><span style="color:#85E89D;">apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">v1</span></span>
<span class="line"><span style="color:#85E89D;">kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Pod</span></span>
<span class="line"><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">my-pod-demo1</span></span>
<span class="line"><span style="color:#85E89D;">spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">containers</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  - </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">my-container</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">image</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">nginx:latest</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">ports</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    - </span><span style="color:#85E89D;">containerPort</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">80</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">env</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    - </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">USER</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">valueFrom</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">secretKeyRef</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">secre-hello</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#85E89D;">key</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">user</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">[</span><span style="color:#032F62;">root@kube-master secret</span><span style="color:#24292E;">]# </span><span style="color:#032F62;">cat secret-env.yaml</span></span>
<span class="line"><span style="color:#22863A;">apiVersion</span><span style="color:#24292E;">: </span><span style="color:#032F62;">v1</span></span>
<span class="line"><span style="color:#22863A;">kind</span><span style="color:#24292E;">: </span><span style="color:#032F62;">Pod</span></span>
<span class="line"><span style="color:#22863A;">metadata</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">my-pod-demo1</span></span>
<span class="line"><span style="color:#22863A;">spec</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">containers</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">my-container</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">image</span><span style="color:#24292E;">: </span><span style="color:#032F62;">nginx:latest</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">ports</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    - </span><span style="color:#22863A;">containerPort</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">80</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">env</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">USER</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">valueFrom</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">secretKeyRef</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">secre-hello</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#22863A;">key</span><span style="color:#24292E;">: </span><span style="color:#032F62;">user</span></span></code></pre></div><p>3.验证</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">[root@kube-master secret]# kubectl exec -it my-pod-demo1 -- /bin/bash</span></span>
<span class="line"><span style="color:#B392F0;">root@my-pod-demo1:/#</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">env</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">egrep</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-i</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;(user|pass)&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">USER</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">admin</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">[root@kube-master secret]# kubectl exec -it my-pod-demo1 -- /bin/bash</span></span>
<span class="line"><span style="color:#6F42C1;">root@my-pod-demo1:/#</span><span style="color:#24292E;"> </span><span style="color:#032F62;">env</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">egrep</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-i</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;(user|pass)&quot;</span></span>
<span class="line"><span style="color:#24292E;">USER</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">admin</span></span></code></pre></div><h3 id="envfrom" tabindex="-1">envFrom <a class="header-anchor" href="#envfrom" aria-label="Permalink to &quot;envFrom&quot;">​</a></h3><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#85E89D;">apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">v1</span></span>
<span class="line"><span style="color:#85E89D;">kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Pod</span></span>
<span class="line"><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">my-pod-demo1</span></span>
<span class="line"><span style="color:#85E89D;">spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">containers</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  - </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">my-container</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">image</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">nginx:latest</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">ports</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    - </span><span style="color:#85E89D;">containerPort</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">80</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">envFrom</span><span style="color:#E1E4E8;">:     </span><span style="color:#6A737D;"># 整体引⽤指定的Secret对象全部键名和键值</span></span>
<span class="line"><span style="color:#E1E4E8;">    - </span><span style="color:#85E89D;">prefix</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">New</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># 将所有键名引⽤为环境变量时统⼀添加的前缀 （⽆需求，可不⽤）</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">secretRef</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">secre-hello</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#22863A;">apiVersion</span><span style="color:#24292E;">: </span><span style="color:#032F62;">v1</span></span>
<span class="line"><span style="color:#22863A;">kind</span><span style="color:#24292E;">: </span><span style="color:#032F62;">Pod</span></span>
<span class="line"><span style="color:#22863A;">metadata</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">my-pod-demo1</span></span>
<span class="line"><span style="color:#22863A;">spec</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">containers</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">my-container</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">image</span><span style="color:#24292E;">: </span><span style="color:#032F62;">nginx:latest</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">ports</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    - </span><span style="color:#22863A;">containerPort</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">80</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">envFrom</span><span style="color:#24292E;">:     </span><span style="color:#6A737D;"># 整体引⽤指定的Secret对象全部键名和键值</span></span>
<span class="line"><span style="color:#24292E;">    - </span><span style="color:#22863A;">prefix</span><span style="color:#24292E;">: </span><span style="color:#032F62;">New</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 将所有键名引⽤为环境变量时统⼀添加的前缀 （⽆需求，可不⽤）</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">secretRef</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">secre-hello</span></span></code></pre></div><h1 id="_4-imagepullsecret-资源对象" tabindex="-1">4. imagePullSecret 资源对象 <a class="header-anchor" href="#_4-imagepullsecret-资源对象" aria-label="Permalink to &quot;4. imagePullSecret 资源对象&quot;">​</a></h1><p>官方文档,</p><p><a href="https://kubernetes.io/zh-cn/docs/tasks/configure-pod-container/pull-image-private-registry/" target="_blank" rel="noreferrer">https://kubernetes.io/zh-cn/docs/tasks/configure-pod-container/pull-image-private-registry/</a></p><p><a href="https://kubernetes.io/zh-cn/docs/concepts/configuration/secret/#using-imagepullsecrets" target="_blank" rel="noreferrer">https://kubernetes.io/zh-cn/docs/concepts/configuration/secret/#using-imagepullsecrets</a></p><p>当Pod配置清单中定义的容器镜像来自于<code>私有仓库时</code>，需要先认证目标的Registry，而后才能正常下载镜像，imagePulLSecret字段指定认证Registry时使用的Secret对象，以辅助kubelet从需要认证的私有仓库获取镜像。</p><p>创建用于认证Registry的Secret，有专用的docker-registry子命令，通常认证需要向kubeLet提供Registry地址、用户名、密码、Email信息，因此docker-registry子命令需要同时使用以下4个选项。</p><p>--docker-server：用于指定私有仓库服务器地址;</p><p>--docker-User：用于指定私有仓库认证的用户名;</p><p>--docker-password：用于指定私有仓库认证的密码;</p><p>--dcker-email：用于指定请求私有仓库的用户E-mail(可选)</p><p>1.创建aliyun-registry的Secret对象</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">create</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">secret</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">docker-registry</span><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">local-registry</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--docker-username=admin</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--docker-password=admin@123</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">create</span><span style="color:#24292E;"> </span><span style="color:#032F62;">secret</span><span style="color:#24292E;"> </span><span style="color:#032F62;">docker-registry</span><span style="color:#24292E;">  </span><span style="color:#032F62;">local-registry</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--docker-username=admin</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--docker-password=admin@123</span></span></code></pre></div><ul><li>或者声明文件</li></ul><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#85E89D;">apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">v1</span></span>
<span class="line"><span style="color:#85E89D;">data</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">.dockerconfigjson</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">...</span></span>
<span class="line"><span style="color:#85E89D;">kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Secret</span></span>
<span class="line"><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">local-registry</span></span>
<span class="line"><span style="color:#85E89D;">type</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">kubernetes.io/dockerconfigjson</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#22863A;">apiVersion</span><span style="color:#24292E;">: </span><span style="color:#032F62;">v1</span></span>
<span class="line"><span style="color:#22863A;">data</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">.dockerconfigjson</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">...</span></span>
<span class="line"><span style="color:#22863A;">kind</span><span style="color:#24292E;">: </span><span style="color:#032F62;">Secret</span></span>
<span class="line"><span style="color:#22863A;">metadata</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">local-registry</span></span>
<span class="line"><span style="color:#22863A;">type</span><span style="color:#24292E;">: </span><span style="color:#032F62;">kubernetes.io/dockerconfigjson</span></span></code></pre></div><p>解密</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">get</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">secret</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">regcred</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--output=</span><span style="color:#9ECBFF;">&quot;jsonpath={.data.\\.dockerconfigjson}&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">base64</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-d</span></span>
<span class="line"><span style="color:#E1E4E8;">{</span><span style="color:#B392F0;">&quot;auths&quot;</span><span style="color:#79B8FF;">:</span><span style="color:#E1E4E8;">{&quot;</span><span style="color:#B392F0;">registry.cn-zhangjiakou.aliyuncs.com</span><span style="color:#B392F0;">&quot;:{&quot;</span><span style="color:#B392F0;">username</span><span style="color:#B392F0;">&quot;:&quot;</span><span style="color:#B392F0;">hsuing.han@outlook.com</span><span style="color:#B392F0;">&quot;,&quot;</span><span style="color:#B392F0;">password</span><span style="color:#B392F0;">&quot;:&quot;</span><span style="color:#B392F0;">123456</span><span style="color:#B392F0;">&quot;,&quot;</span><span style="color:#B392F0;">email</span><span style="color:#B392F0;">&quot;:&quot;</span><span style="color:#B392F0;">hsuing.han@outlook.com</span><span style="color:#B392F0;">&quot;,&quot;</span><span style="color:#B392F0;">auth</span><span style="color:#B392F0;">&quot;:&quot;</span><span style="color:#B392F0;">aHN1aW5nLmhhbkBvdXRsb29rLmNvbTpoeDEzMjMxMj</span><span style="color:#B392F0;">&quot;}}}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">#查看用户和密码</span></span>
<span class="line"><span style="color:#B392F0;">echo aHN1aW5nLmhhbkBvdXRsb29rLmNvbTpoeDEzMjMxMj |base64 -d</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">#或者,拿到.dockerconfigjson进行</span></span>
<span class="line"><span style="color:#B392F0;">echo ...|base64 -d</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">#对auth 加密</span></span>
<span class="line"><span style="color:#B392F0;">echo han:123456 |base64</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">get</span><span style="color:#24292E;"> </span><span style="color:#032F62;">secret</span><span style="color:#24292E;"> </span><span style="color:#032F62;">regcred</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--output=</span><span style="color:#032F62;">&quot;jsonpath={.data.\\.dockerconfigjson}&quot;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">base64</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-d</span></span>
<span class="line"><span style="color:#24292E;">{</span><span style="color:#6F42C1;">&quot;auths&quot;</span><span style="color:#005CC5;">:</span><span style="color:#24292E;">{&quot;</span><span style="color:#6F42C1;">registry.cn-zhangjiakou.aliyuncs.com</span><span style="color:#6F42C1;">&quot;:{&quot;</span><span style="color:#6F42C1;">username</span><span style="color:#6F42C1;">&quot;:&quot;</span><span style="color:#6F42C1;">hsuing.han@outlook.com</span><span style="color:#6F42C1;">&quot;,&quot;</span><span style="color:#6F42C1;">password</span><span style="color:#6F42C1;">&quot;:&quot;</span><span style="color:#6F42C1;">123456</span><span style="color:#6F42C1;">&quot;,&quot;</span><span style="color:#6F42C1;">email</span><span style="color:#6F42C1;">&quot;:&quot;</span><span style="color:#6F42C1;">hsuing.han@outlook.com</span><span style="color:#6F42C1;">&quot;,&quot;</span><span style="color:#6F42C1;">auth</span><span style="color:#6F42C1;">&quot;:&quot;</span><span style="color:#6F42C1;">aHN1aW5nLmhhbkBvdXRsb29rLmNvbTpoeDEzMjMxMj</span><span style="color:#6F42C1;">&quot;}}}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">#查看用户和密码</span></span>
<span class="line"><span style="color:#6F42C1;">echo aHN1aW5nLmhhbkBvdXRsb29rLmNvbTpoeDEzMjMxMj |base64 -d</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">#或者,拿到.dockerconfigjson进行</span></span>
<span class="line"><span style="color:#6F42C1;">echo ...|base64 -d</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">#对auth 加密</span></span>
<span class="line"><span style="color:#6F42C1;">echo han:123456 |base64</span></span></code></pre></div><p>2.查看secret,资源类型为<code>kubernetes.io/dockerconfigjson</code></p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">[root@kube-master secret]# kubectl get secrets</span></span>
<span class="line"><span style="color:#B392F0;">NAME</span><span style="color:#E1E4E8;">                  </span><span style="color:#9ECBFF;">TYPE</span><span style="color:#E1E4E8;">                                  </span><span style="color:#9ECBFF;">DATA</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">AGE</span></span>
<span class="line"><span style="color:#B392F0;">local-registry</span><span style="color:#E1E4E8;">        </span><span style="color:#9ECBFF;">kubernetes.io/dockerconfigjson</span><span style="color:#E1E4E8;">        </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">      </span><span style="color:#79B8FF;">47</span><span style="color:#9ECBFF;">s</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">[root@kube-master secret]# kubectl get secrets</span></span>
<span class="line"><span style="color:#6F42C1;">NAME</span><span style="color:#24292E;">                  </span><span style="color:#032F62;">TYPE</span><span style="color:#24292E;">                                  </span><span style="color:#032F62;">DATA</span><span style="color:#24292E;">   </span><span style="color:#032F62;">AGE</span></span>
<span class="line"><span style="color:#6F42C1;">local-registry</span><span style="color:#24292E;">        </span><span style="color:#032F62;">kubernetes.io/dockerconfigjson</span><span style="color:#24292E;">        </span><span style="color:#005CC5;">1</span><span style="color:#24292E;">      </span><span style="color:#005CC5;">47</span><span style="color:#032F62;">s</span></span></code></pre></div><p>3.Pod引用Secret资源；</p><p>imagePullSecret在spec字段中；和container是平级的；</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">explain</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pod.spec.imagePullSecrets</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">KIND:</span><span style="color:#E1E4E8;">     </span><span style="color:#9ECBFF;">Pod</span></span>
<span class="line"><span style="color:#B392F0;">VERSION:</span><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">v1</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">RESOURCE:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">imagePullSecrets</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">[]Objec</span><span style="color:#E1E4E8;">t</span><span style="color:#F97583;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">DESCRIPTION:</span></span>
<span class="line"><span style="color:#E1E4E8;">     </span><span style="color:#B392F0;">ImagePullSecrets</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">is</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">an</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">optional</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">list</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">of</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">references</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">to</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">secrets</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">in</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">the</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">same</span></span>
<span class="line"><span style="color:#E1E4E8;">     </span><span style="color:#B392F0;">namespace</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">to</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">use</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">for</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pulling</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">any</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">of</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">the</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">images</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">used</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">by</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">this</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">PodSpec.</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">If</span></span>
<span class="line"><span style="color:#E1E4E8;">     </span><span style="color:#B392F0;">specified,</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">these</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">secrets</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">will</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">be</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">passed</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">to</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">individual</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">puller</span></span>
<span class="line"><span style="color:#E1E4E8;">     </span><span style="color:#B392F0;">implementations</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">for</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">them</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">to</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">use.</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">For</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">example,</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">in</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">the</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">case</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">of</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">docker,</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">only</span></span>
<span class="line"><span style="color:#E1E4E8;">     </span><span style="color:#B392F0;">DockerConfig</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">type</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">secrets</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">are</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">honored.</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">More</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">info:</span></span>
<span class="line"><span style="color:#E1E4E8;">     </span><span style="color:#B392F0;">https://kubernetes.io/docs/concepts/containers/images#specifying-imagepullsecrets-on-a-pod</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">     </span><span style="color:#B392F0;">LocalObjectReference</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">contains</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">enough</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">information</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">to</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">let</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">you</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">locate</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">the</span></span>
<span class="line"><span style="color:#E1E4E8;">     </span><span style="color:#B392F0;">referenced</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">object</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">inside</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">the</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">same</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">namespace.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">FIELDS:</span></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#B392F0;">name</span><span style="color:#E1E4E8;">	</span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">strin</span><span style="color:#E1E4E8;">g</span><span style="color:#F97583;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">     </span><span style="color:#B392F0;">Name</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">of</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">the</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">referent.</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">More</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">info:</span></span>
<span class="line"><span style="color:#E1E4E8;">     </span><span style="color:#B392F0;">https://kubernetes.io/docs/concepts/overview/working-with-objects/names/#names</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">explain</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pod.spec.imagePullSecrets</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">KIND:</span><span style="color:#24292E;">     </span><span style="color:#032F62;">Pod</span></span>
<span class="line"><span style="color:#6F42C1;">VERSION:</span><span style="color:#24292E;">  </span><span style="color:#032F62;">v1</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">RESOURCE:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">imagePullSecrets</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">[]Objec</span><span style="color:#24292E;">t</span><span style="color:#D73A49;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">DESCRIPTION:</span></span>
<span class="line"><span style="color:#24292E;">     </span><span style="color:#6F42C1;">ImagePullSecrets</span><span style="color:#24292E;"> </span><span style="color:#032F62;">is</span><span style="color:#24292E;"> </span><span style="color:#032F62;">an</span><span style="color:#24292E;"> </span><span style="color:#032F62;">optional</span><span style="color:#24292E;"> </span><span style="color:#032F62;">list</span><span style="color:#24292E;"> </span><span style="color:#032F62;">of</span><span style="color:#24292E;"> </span><span style="color:#032F62;">references</span><span style="color:#24292E;"> </span><span style="color:#032F62;">to</span><span style="color:#24292E;"> </span><span style="color:#032F62;">secrets</span><span style="color:#24292E;"> </span><span style="color:#032F62;">in</span><span style="color:#24292E;"> </span><span style="color:#032F62;">the</span><span style="color:#24292E;"> </span><span style="color:#032F62;">same</span></span>
<span class="line"><span style="color:#24292E;">     </span><span style="color:#6F42C1;">namespace</span><span style="color:#24292E;"> </span><span style="color:#032F62;">to</span><span style="color:#24292E;"> </span><span style="color:#032F62;">use</span><span style="color:#24292E;"> </span><span style="color:#032F62;">for</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pulling</span><span style="color:#24292E;"> </span><span style="color:#032F62;">any</span><span style="color:#24292E;"> </span><span style="color:#032F62;">of</span><span style="color:#24292E;"> </span><span style="color:#032F62;">the</span><span style="color:#24292E;"> </span><span style="color:#032F62;">images</span><span style="color:#24292E;"> </span><span style="color:#032F62;">used</span><span style="color:#24292E;"> </span><span style="color:#032F62;">by</span><span style="color:#24292E;"> </span><span style="color:#032F62;">this</span><span style="color:#24292E;"> </span><span style="color:#032F62;">PodSpec.</span><span style="color:#24292E;"> </span><span style="color:#032F62;">If</span></span>
<span class="line"><span style="color:#24292E;">     </span><span style="color:#6F42C1;">specified,</span><span style="color:#24292E;"> </span><span style="color:#032F62;">these</span><span style="color:#24292E;"> </span><span style="color:#032F62;">secrets</span><span style="color:#24292E;"> </span><span style="color:#032F62;">will</span><span style="color:#24292E;"> </span><span style="color:#032F62;">be</span><span style="color:#24292E;"> </span><span style="color:#032F62;">passed</span><span style="color:#24292E;"> </span><span style="color:#032F62;">to</span><span style="color:#24292E;"> </span><span style="color:#032F62;">individual</span><span style="color:#24292E;"> </span><span style="color:#032F62;">puller</span></span>
<span class="line"><span style="color:#24292E;">     </span><span style="color:#6F42C1;">implementations</span><span style="color:#24292E;"> </span><span style="color:#032F62;">for</span><span style="color:#24292E;"> </span><span style="color:#032F62;">them</span><span style="color:#24292E;"> </span><span style="color:#032F62;">to</span><span style="color:#24292E;"> </span><span style="color:#032F62;">use.</span><span style="color:#24292E;"> </span><span style="color:#032F62;">For</span><span style="color:#24292E;"> </span><span style="color:#032F62;">example,</span><span style="color:#24292E;"> </span><span style="color:#032F62;">in</span><span style="color:#24292E;"> </span><span style="color:#032F62;">the</span><span style="color:#24292E;"> </span><span style="color:#032F62;">case</span><span style="color:#24292E;"> </span><span style="color:#032F62;">of</span><span style="color:#24292E;"> </span><span style="color:#032F62;">docker,</span><span style="color:#24292E;"> </span><span style="color:#032F62;">only</span></span>
<span class="line"><span style="color:#24292E;">     </span><span style="color:#6F42C1;">DockerConfig</span><span style="color:#24292E;"> </span><span style="color:#032F62;">type</span><span style="color:#24292E;"> </span><span style="color:#032F62;">secrets</span><span style="color:#24292E;"> </span><span style="color:#032F62;">are</span><span style="color:#24292E;"> </span><span style="color:#032F62;">honored.</span><span style="color:#24292E;"> </span><span style="color:#032F62;">More</span><span style="color:#24292E;"> </span><span style="color:#032F62;">info:</span></span>
<span class="line"><span style="color:#24292E;">     </span><span style="color:#6F42C1;">https://kubernetes.io/docs/concepts/containers/images#specifying-imagepullsecrets-on-a-pod</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">     </span><span style="color:#6F42C1;">LocalObjectReference</span><span style="color:#24292E;"> </span><span style="color:#032F62;">contains</span><span style="color:#24292E;"> </span><span style="color:#032F62;">enough</span><span style="color:#24292E;"> </span><span style="color:#032F62;">information</span><span style="color:#24292E;"> </span><span style="color:#032F62;">to</span><span style="color:#24292E;"> </span><span style="color:#032F62;">let</span><span style="color:#24292E;"> </span><span style="color:#032F62;">you</span><span style="color:#24292E;"> </span><span style="color:#032F62;">locate</span><span style="color:#24292E;"> </span><span style="color:#032F62;">the</span></span>
<span class="line"><span style="color:#24292E;">     </span><span style="color:#6F42C1;">referenced</span><span style="color:#24292E;"> </span><span style="color:#032F62;">object</span><span style="color:#24292E;"> </span><span style="color:#032F62;">inside</span><span style="color:#24292E;"> </span><span style="color:#032F62;">the</span><span style="color:#24292E;"> </span><span style="color:#032F62;">same</span><span style="color:#24292E;"> </span><span style="color:#032F62;">namespace.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">FIELDS:</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#6F42C1;">name</span><span style="color:#24292E;">	</span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">strin</span><span style="color:#24292E;">g</span><span style="color:#D73A49;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">     </span><span style="color:#6F42C1;">Name</span><span style="color:#24292E;"> </span><span style="color:#032F62;">of</span><span style="color:#24292E;"> </span><span style="color:#032F62;">the</span><span style="color:#24292E;"> </span><span style="color:#032F62;">referent.</span><span style="color:#24292E;"> </span><span style="color:#032F62;">More</span><span style="color:#24292E;"> </span><span style="color:#032F62;">info:</span></span>
<span class="line"><span style="color:#24292E;">     </span><span style="color:#6F42C1;">https://kubernetes.io/docs/concepts/overview/working-with-objects/names/#names</span></span></code></pre></div><p>4.引入imagePullSecrets</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">#需要创建hub仓库的secret</span></span>
<span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">create</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">secret</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">docker-registry</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">docker-regsitry-auth</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--docker-server=</span><span style="color:#9ECBFF;">&quot;hub.cropy.cn&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--docker-username=</span><span style="color:#9ECBFF;">&quot;admin&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--docker-password=</span><span style="color:#9ECBFF;">&quot;Harbor12345&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-n</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">test</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">#需要创建hub仓库的secret</span></span>
<span class="line"><span style="color:#6F42C1;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">create</span><span style="color:#24292E;"> </span><span style="color:#032F62;">secret</span><span style="color:#24292E;"> </span><span style="color:#032F62;">docker-registry</span><span style="color:#24292E;"> </span><span style="color:#032F62;">docker-regsitry-auth</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--docker-server=</span><span style="color:#032F62;">&quot;hub.cropy.cn&quot;</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--docker-username=</span><span style="color:#032F62;">&quot;admin&quot;</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--docker-password=</span><span style="color:#032F62;">&quot;Harbor12345&quot;</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-n</span><span style="color:#24292E;"> </span><span style="color:#032F62;">test</span></span></code></pre></div><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#85E89D;">apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">apps/v1</span></span>
<span class="line"><span style="color:#85E89D;">kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Deployment</span></span>
<span class="line"><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">java-demo</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">namespace</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">test</span></span>
<span class="line"><span style="color:#85E89D;">spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">replicas</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">2</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">selector</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">matchLabels</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">project</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">www</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">app</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">java-demo</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">template</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">labels</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">project</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">www</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">app</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">java-demo</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">imagePullSecrets</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      - </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;docker-regsitry-auth&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">containers</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      - </span><span style="color:#85E89D;">image</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">hub.cropy.cn/demo/java-demo:v1</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">java-demo</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">imagePullPolicy</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Always</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">ports</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">          - </span><span style="color:#85E89D;">containerPort</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">8080</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">web</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#85E89D;">protocol</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">TCP</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">resources</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#85E89D;">requests</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#85E89D;">cpu</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">0.5</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#85E89D;">memory</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">0.5Gi</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#85E89D;">limits</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#85E89D;">cpu</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">1</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#85E89D;">memory</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">2Gi</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">livenessProbe</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#85E89D;">httpGet</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#85E89D;">path</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">/</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#85E89D;">port</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">8080</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#85E89D;">initialDelaySeconds</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">60</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#85E89D;">timeoutSeconds</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">20</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">readinessProbe</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#85E89D;">httpGet</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#85E89D;">path</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">/</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#85E89D;">port</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">8080</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#85E89D;">initialDelaySeconds</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">60</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#85E89D;">timeoutSeconds</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">20</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#22863A;">apiVersion</span><span style="color:#24292E;">: </span><span style="color:#032F62;">apps/v1</span></span>
<span class="line"><span style="color:#22863A;">kind</span><span style="color:#24292E;">: </span><span style="color:#032F62;">Deployment</span></span>
<span class="line"><span style="color:#22863A;">metadata</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">java-demo</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">namespace</span><span style="color:#24292E;">: </span><span style="color:#032F62;">test</span></span>
<span class="line"><span style="color:#22863A;">spec</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">replicas</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">2</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">selector</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">matchLabels</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">project</span><span style="color:#24292E;">: </span><span style="color:#032F62;">www</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">app</span><span style="color:#24292E;">: </span><span style="color:#032F62;">java-demo</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">template</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">metadata</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">labels</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">project</span><span style="color:#24292E;">: </span><span style="color:#032F62;">www</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">app</span><span style="color:#24292E;">: </span><span style="color:#032F62;">java-demo</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">spec</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">imagePullSecrets</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;docker-regsitry-auth&quot;</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">containers</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      - </span><span style="color:#22863A;">image</span><span style="color:#24292E;">: </span><span style="color:#032F62;">hub.cropy.cn/demo/java-demo:v1</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">java-demo</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">imagePullPolicy</span><span style="color:#24292E;">: </span><span style="color:#032F62;">Always</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">ports</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">          - </span><span style="color:#22863A;">containerPort</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">8080</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">web</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#22863A;">protocol</span><span style="color:#24292E;">: </span><span style="color:#032F62;">TCP</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">resources</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#22863A;">requests</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#22863A;">cpu</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">0.5</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#22863A;">memory</span><span style="color:#24292E;">: </span><span style="color:#032F62;">0.5Gi</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#22863A;">limits</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#22863A;">cpu</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">1</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#22863A;">memory</span><span style="color:#24292E;">: </span><span style="color:#032F62;">2Gi</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">livenessProbe</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#22863A;">httpGet</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#22863A;">path</span><span style="color:#24292E;">: </span><span style="color:#032F62;">/</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#22863A;">port</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">8080</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#22863A;">initialDelaySeconds</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">60</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#22863A;">timeoutSeconds</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">20</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">readinessProbe</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#22863A;">httpGet</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#22863A;">path</span><span style="color:#24292E;">: </span><span style="color:#032F62;">/</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#22863A;">port</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">8080</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#22863A;">initialDelaySeconds</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">60</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#22863A;">timeoutSeconds</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">20</span></span></code></pre></div><p>或者</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;"># 配置.docker/config.json文件，包含了与 Docker Hub 或其他私有仓库进行身份验证所需的凭据信息。</span></span>
<span class="line"><span style="color:#B392F0;">cat</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">~/.docker/config.json</span></span>
<span class="line"><span style="color:#E1E4E8;">{</span></span>
<span class="line"><span style="color:#E1E4E8;">	</span><span style="color:#B392F0;">&quot;auths&quot;</span><span style="color:#79B8FF;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">{</span></span>
<span class="line"><span style="color:#E1E4E8;">		</span><span style="color:#B392F0;">&quot;registry.test.com&quot;</span><span style="color:#79B8FF;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">{</span></span>
<span class="line"><span style="color:#E1E4E8;">			</span><span style="color:#B392F0;">&quot;auth&quot;</span><span style="color:#79B8FF;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;dmlwZXIucm9ib3QuZG9ja2VyOlNUYW&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">		}</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span>
<span class="line"><span style="color:#6A737D;"># 创建secret给pod使用</span></span>
<span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">create</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">secret</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">generic</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">secret-nam</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--from-file=.dockerconfigjson=.docker/config.json</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--type=kubernetes.io/dockerconfigjson</span></span>
<span class="line"><span style="color:#6A737D;"># 这里，创建的secret可以在pod中通过imagePullSecrets引用</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;"># 配置.docker/config.json文件，包含了与 Docker Hub 或其他私有仓库进行身份验证所需的凭据信息。</span></span>
<span class="line"><span style="color:#6F42C1;">cat</span><span style="color:#24292E;"> </span><span style="color:#032F62;">~/.docker/config.json</span></span>
<span class="line"><span style="color:#24292E;">{</span></span>
<span class="line"><span style="color:#24292E;">	</span><span style="color:#6F42C1;">&quot;auths&quot;</span><span style="color:#005CC5;">:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">{</span></span>
<span class="line"><span style="color:#24292E;">		</span><span style="color:#6F42C1;">&quot;registry.test.com&quot;</span><span style="color:#005CC5;">:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">{</span></span>
<span class="line"><span style="color:#24292E;">			</span><span style="color:#6F42C1;">&quot;auth&quot;</span><span style="color:#005CC5;">:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;dmlwZXIucm9ib3QuZG9ja2VyOlNUYW&quot;</span></span>
<span class="line"><span style="color:#24292E;">		}</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"><span style="color:#24292E;">}</span></span>
<span class="line"><span style="color:#6A737D;"># 创建secret给pod使用</span></span>
<span class="line"><span style="color:#6F42C1;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">create</span><span style="color:#24292E;"> </span><span style="color:#032F62;">secret</span><span style="color:#24292E;"> </span><span style="color:#032F62;">generic</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">secret-nam</span><span style="color:#24292E;">e</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--from-file=.dockerconfigjson=.docker/config.json</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--type=kubernetes.io/dockerconfigjson</span></span>
<span class="line"><span style="color:#6A737D;"># 这里，创建的secret可以在pod中通过imagePullSecrets引用</span></span></code></pre></div><h2 id="_4-1-imagepullpolicy" tabindex="-1">4.1 ImagePullPolicy <a class="header-anchor" href="#_4-1-imagepullpolicy" aria-label="Permalink to &quot;4.1 ImagePullPolicy&quot;">​</a></h2><p>官方文档: <a href="https://kubernetes.io/zh-cn/docs/concepts/containers/images/" target="_blank" rel="noreferrer">https://kubernetes.io/zh-cn/docs/concepts/containers/images/</a></p><p>在指定容器镜像时，必须要提供镜像值(Image Value)这是一个供容器运行时(如Containerd)从镜像仓库拉取镜像的地址； 关键配置: ImagePullPolicy和ImagePullSecrets这两个都是供容器运行时使用的；</p><p>imagePullPolicy设置的是kubernetes节点拉取镜像策略，这个设置很重要。它有三个值可以设置，Always、Never、IfNotPresent；</p><ul><li>IfNotPresent: 本地有镜像则使用本地镜像，本地不存在则拉取镜像；(默认值)</li><li>Always: 每次都尝试拉取镜像，忽略容器运行时维护的所有本地缓存；</li><li>Never: 永不拉取，禁止从仓库下载镜像，如果本地镜像已经存在，kubelet会尝试启动容器，否则，启动失败；</li></ul><p>查看属性</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">kubectl explain pod.spec.containers.imagePullPolicy</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">KIND:     Pod</span></span>
<span class="line"><span style="color:#e1e4e8;">VERSION:  v1</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">FIELD:    imagePullPolicy &lt;string&gt;</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">DESCRIPTION:</span></span>
<span class="line"><span style="color:#e1e4e8;">     Image pull policy. One of Always, Never, IfNotPresent. Defaults to Always</span></span>
<span class="line"><span style="color:#e1e4e8;">     if :latest tag is specified, or IfNotPresent otherwise. Cannot be updated.</span></span>
<span class="line"><span style="color:#e1e4e8;">     More info:</span></span>
<span class="line"><span style="color:#e1e4e8;">     https://kubernetes.io/docs/concepts/containers/images#updating-images</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">kubectl explain pod.spec.containers.imagePullPolicy</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">KIND:     Pod</span></span>
<span class="line"><span style="color:#24292e;">VERSION:  v1</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">FIELD:    imagePullPolicy &lt;string&gt;</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">DESCRIPTION:</span></span>
<span class="line"><span style="color:#24292e;">     Image pull policy. One of Always, Never, IfNotPresent. Defaults to Always</span></span>
<span class="line"><span style="color:#24292e;">     if :latest tag is specified, or IfNotPresent otherwise. Cannot be updated.</span></span>
<span class="line"><span style="color:#24292e;">     More info:</span></span>
<span class="line"><span style="color:#24292e;">     https://kubernetes.io/docs/concepts/containers/images#updating-images</span></span></code></pre></div><p>案例</p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#9ECBFF;">cat httpdpod-test.yaml</span><span style="color:#E1E4E8;"> </span></span>
<span class="line"><span style="color:#85E89D;">apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">v1</span></span>
<span class="line"><span style="color:#85E89D;">kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Pod</span></span>
<span class="line"><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">httpd-testpod</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">namespace</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">default</span></span>
<span class="line"><span style="color:#85E89D;">spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">containers</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  - </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">httpd</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">image</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">nginx</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">imagePullPolicy</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">IfNotPresent</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#032F62;">cat httpdpod-test.yaml</span><span style="color:#24292E;"> </span></span>
<span class="line"><span style="color:#22863A;">apiVersion</span><span style="color:#24292E;">: </span><span style="color:#032F62;">v1</span></span>
<span class="line"><span style="color:#22863A;">kind</span><span style="color:#24292E;">: </span><span style="color:#032F62;">Pod</span></span>
<span class="line"><span style="color:#22863A;">metadata</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">httpd-testpod</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">namespace</span><span style="color:#24292E;">: </span><span style="color:#032F62;">default</span></span>
<span class="line"><span style="color:#22863A;">spec</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">containers</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">httpd</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">image</span><span style="color:#24292E;">: </span><span style="color:#032F62;">nginx</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">imagePullPolicy</span><span style="color:#24292E;">: </span><span style="color:#032F62;">IfNotPresent</span></span></code></pre></div><h1 id="_5-serviceaccount拉取私有镜像" tabindex="-1">5. ServiceAccount拉取私有镜像 <a class="header-anchor" href="#_5-serviceaccount拉取私有镜像" aria-label="Permalink to &quot;5. ServiceAccount拉取私有镜像&quot;">​</a></h1><p>可以通过ImagPullPolicy和ImageullSecrets指定下载镜像的策略，ServiceAccount也可以基于</p><p>spec.imagePullSecret字段附带一个由下载镜像专用的Secret资源组成的列表，用于在容器创建时，从某个私有镜像仓库下载镜像文件之前的服务认证</p><h2 id="_5-2-创建secrets资源" tabindex="-1">5.2 创建Secrets资源 <a class="header-anchor" href="#_5-2-创建secrets资源" aria-label="Permalink to &quot;5.2 创建Secrets资源&quot;">​</a></h2><p>这里根据自己的实际去定义即可；一定要是对的地址和认证信息；否则无法pull/push</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">create</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">secret</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">docker-registry</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#E1E4E8;">aliyun-registry </span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#E1E4E8;">--docker-server=registry.cn-hangzhou.aliyuncs.com </span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#E1E4E8;">--docker-username=xxxxxxx </span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#E1E4E8;">--docker-password=xxxxxx</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">create</span><span style="color:#24292E;"> </span><span style="color:#032F62;">secret</span><span style="color:#24292E;"> </span><span style="color:#032F62;">docker-registry</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#24292E;">aliyun-registry </span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#24292E;">--docker-server=registry.cn-hangzhou.aliyuncs.com </span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#24292E;">--docker-username=xxxxxxx </span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#24292E;">--docker-password=xxxxxx</span></span></code></pre></div><h2 id="_5-3-查看secrets" tabindex="-1">5.3 查看Secrets <a class="header-anchor" href="#_5-3-查看secrets" aria-label="Permalink to &quot;5.3 查看Secrets&quot;">​</a></h2><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">[root@kube-master secret]# kubectl get secrets</span></span>
<span class="line"><span style="color:#B392F0;">NAME</span><span style="color:#E1E4E8;">                                 </span><span style="color:#9ECBFF;">TYPE</span><span style="color:#E1E4E8;">                                  </span><span style="color:#9ECBFF;">DATA</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">AGE</span></span>
<span class="line"><span style="color:#B392F0;">aliyun-registry</span><span style="color:#E1E4E8;">                      </span><span style="color:#9ECBFF;">kubernetes.io/dockerconfigjson</span><span style="color:#E1E4E8;">        </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">      </span><span style="color:#79B8FF;">16</span><span style="color:#9ECBFF;">s</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">[root@kube-master secret]# kubectl describe secrets aliyun-registry</span></span>
<span class="line"><span style="color:#B392F0;">Name:</span><span style="color:#E1E4E8;">         </span><span style="color:#9ECBFF;">aliyun-registry</span></span>
<span class="line"><span style="color:#B392F0;">Namespace:</span><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">default</span></span>
<span class="line"><span style="color:#B392F0;">Labels:</span><span style="color:#E1E4E8;">       </span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">non</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span></span>
<span class="line"><span style="color:#B392F0;">Annotations:</span><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">non</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">Type:</span><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">kubernetes.io/dockerconfigjson</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">Data</span></span>
<span class="line"><span style="color:#E1E4E8;">====</span></span>
<span class="line"><span style="color:#B392F0;">.dockerconfigjson:</span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">173</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">bytes</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">[root@kube-master secret]# kubectl get secrets</span></span>
<span class="line"><span style="color:#6F42C1;">NAME</span><span style="color:#24292E;">                                 </span><span style="color:#032F62;">TYPE</span><span style="color:#24292E;">                                  </span><span style="color:#032F62;">DATA</span><span style="color:#24292E;">   </span><span style="color:#032F62;">AGE</span></span>
<span class="line"><span style="color:#6F42C1;">aliyun-registry</span><span style="color:#24292E;">                      </span><span style="color:#032F62;">kubernetes.io/dockerconfigjson</span><span style="color:#24292E;">        </span><span style="color:#005CC5;">1</span><span style="color:#24292E;">      </span><span style="color:#005CC5;">16</span><span style="color:#032F62;">s</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">[root@kube-master secret]# kubectl describe secrets aliyun-registry</span></span>
<span class="line"><span style="color:#6F42C1;">Name:</span><span style="color:#24292E;">         </span><span style="color:#032F62;">aliyun-registry</span></span>
<span class="line"><span style="color:#6F42C1;">Namespace:</span><span style="color:#24292E;">    </span><span style="color:#032F62;">default</span></span>
<span class="line"><span style="color:#6F42C1;">Labels:</span><span style="color:#24292E;">       </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">non</span><span style="color:#24292E;">e</span><span style="color:#D73A49;">&gt;</span></span>
<span class="line"><span style="color:#6F42C1;">Annotations:</span><span style="color:#24292E;">  </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">non</span><span style="color:#24292E;">e</span><span style="color:#D73A49;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">Type:</span><span style="color:#24292E;">  </span><span style="color:#032F62;">kubernetes.io/dockerconfigjson</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">Data</span></span>
<span class="line"><span style="color:#24292E;">====</span></span>
<span class="line"><span style="color:#6F42C1;">.dockerconfigjson:</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">173</span><span style="color:#24292E;"> </span><span style="color:#032F62;">bytes</span></span></code></pre></div><h2 id="_5-4-创建serviceaccount" tabindex="-1">5.4 创建ServiceAccount <a class="header-anchor" href="#_5-4-创建serviceaccount" aria-label="Permalink to &quot;5.4 创建ServiceAccount&quot;">​</a></h2><h3 id="_5-4-1-不设置任何策略-测试是否能拉取私有仓库镜像" tabindex="-1">5.4.1 不设置任何策略，测试是否能拉取私有仓库镜像 <a class="header-anchor" href="#_5-4-1-不设置任何策略-测试是否能拉取私有仓库镜像" aria-label="Permalink to &quot;5.4.1 不设置任何策略，测试是否能拉取私有仓库镜像&quot;">​</a></h3><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">[</span><span style="color:#9ECBFF;">root@kube-master secret</span><span style="color:#E1E4E8;">]# </span><span style="color:#9ECBFF;">cat pod-serviceaccount-secret.yaml</span></span>
<span class="line"><span style="color:#85E89D;">apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">v1</span></span>
<span class="line"><span style="color:#85E89D;">kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Pod</span></span>
<span class="line"><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">stree-serviceaccount</span></span>
<span class="line"><span style="color:#85E89D;">spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">containers</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  - </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">stree</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">image</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">registry.cn-zhangjiakou.aliyuncs.com/hsuing/test:v1</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">[</span><span style="color:#032F62;">root@kube-master secret</span><span style="color:#24292E;">]# </span><span style="color:#032F62;">cat pod-serviceaccount-secret.yaml</span></span>
<span class="line"><span style="color:#22863A;">apiVersion</span><span style="color:#24292E;">: </span><span style="color:#032F62;">v1</span></span>
<span class="line"><span style="color:#22863A;">kind</span><span style="color:#24292E;">: </span><span style="color:#032F62;">Pod</span></span>
<span class="line"><span style="color:#22863A;">metadata</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">stree-serviceaccount</span></span>
<span class="line"><span style="color:#22863A;">spec</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">containers</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">stree</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">image</span><span style="color:#24292E;">: </span><span style="color:#032F62;">registry.cn-zhangjiakou.aliyuncs.com/hsuing/test:v1</span></span></code></pre></div><ul><li>查看</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">[root@kube-master secret]# kubectl describe pod stree-serviceaccount</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">Events:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">Type</span><span style="color:#E1E4E8;">     </span><span style="color:#9ECBFF;">Reason</span><span style="color:#E1E4E8;">          </span><span style="color:#9ECBFF;">Age</span><span style="color:#E1E4E8;">                </span><span style="color:#9ECBFF;">From</span><span style="color:#E1E4E8;">               </span><span style="color:#9ECBFF;">Message</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">----</span><span style="color:#E1E4E8;">     </span><span style="color:#79B8FF;">------</span><span style="color:#E1E4E8;">          </span><span style="color:#79B8FF;">----</span><span style="color:#E1E4E8;">               </span><span style="color:#79B8FF;">----</span><span style="color:#E1E4E8;">               </span><span style="color:#79B8FF;">-------</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">Normal</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">Scheduled</span><span style="color:#E1E4E8;">       </span><span style="color:#79B8FF;">25</span><span style="color:#9ECBFF;">s</span><span style="color:#E1E4E8;">                </span><span style="color:#9ECBFF;">default-scheduler</span><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">Successfully</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">assigned</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">default/stree-serviceaccount</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">to</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">kube-node01</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">Normal</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">SandboxChanged</span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">22</span><span style="color:#9ECBFF;">s</span><span style="color:#E1E4E8;"> (x2 </span><span style="color:#9ECBFF;">over</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">24</span><span style="color:#9ECBFF;">s</span><span style="color:#E1E4E8;">)  kubelet            Pod sandbox changed, it will be killed and re-created.</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">Normal</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">BackOff</span><span style="color:#E1E4E8;">         </span><span style="color:#79B8FF;">19</span><span style="color:#9ECBFF;">s</span><span style="color:#E1E4E8;"> (x4 </span><span style="color:#9ECBFF;">over</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#9ECBFF;">s</span><span style="color:#E1E4E8;">)  kubelet            Back-off pulling image </span><span style="color:#9ECBFF;">&quot;registry.cn-zhangjiakou.aliyuncs.com/hsuing/test:v1&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">Warning</span><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">Failed</span><span style="color:#E1E4E8;">          </span><span style="color:#79B8FF;">19</span><span style="color:#9ECBFF;">s</span><span style="color:#E1E4E8;"> (x4 </span><span style="color:#9ECBFF;">over</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#9ECBFF;">s</span><span style="color:#E1E4E8;">)  kubelet            Error: ImagePullBackOff</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">Normal</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">Pulling</span><span style="color:#E1E4E8;">         </span><span style="color:#79B8FF;">8</span><span style="color:#9ECBFF;">s</span><span style="color:#E1E4E8;"> (x2 </span><span style="color:#9ECBFF;">over</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">25</span><span style="color:#9ECBFF;">s</span><span style="color:#E1E4E8;">)   kubelet            Pulling image </span><span style="color:#9ECBFF;">&quot;registry.cn-zhangjiakou.aliyuncs.com/hsuing/test:v1&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">Warning</span><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">Failed</span><span style="color:#E1E4E8;">          </span><span style="color:#79B8FF;">7</span><span style="color:#9ECBFF;">s</span><span style="color:#E1E4E8;"> (x2 </span><span style="color:#9ECBFF;">over</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">24</span><span style="color:#9ECBFF;">s</span><span style="color:#E1E4E8;">)   kubelet            Failed to pull image </span><span style="color:#9ECBFF;">&quot;registry.cn-zhangjiakou.aliyuncs.com/hsuing/test:v1&quot;</span><span style="color:#E1E4E8;">: rpc error: code = Unknown desc = Error response from daemon: pull access denied </span><span style="color:#F97583;">for</span><span style="color:#E1E4E8;"> registry.cn-zhangjiakou.aliyuncs.com/hsuing/test, repository does not exist or may require </span><span style="color:#9ECBFF;">&#39;docker login&#39;</span><span style="color:#E1E4E8;">: denied: requested access to the resource is denied</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">Warning</span><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">Failed</span><span style="color:#E1E4E8;">          </span><span style="color:#79B8FF;">7</span><span style="color:#9ECBFF;">s</span><span style="color:#E1E4E8;"> (x2 </span><span style="color:#9ECBFF;">over</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">24</span><span style="color:#9ECBFF;">s</span><span style="color:#E1E4E8;">)   kubelet            Error: ErrImagePull</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">[root@kube-master secret]# kubectl describe pod stree-serviceaccount</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">Events:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">Type</span><span style="color:#24292E;">     </span><span style="color:#032F62;">Reason</span><span style="color:#24292E;">          </span><span style="color:#032F62;">Age</span><span style="color:#24292E;">                </span><span style="color:#032F62;">From</span><span style="color:#24292E;">               </span><span style="color:#032F62;">Message</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">----</span><span style="color:#24292E;">     </span><span style="color:#005CC5;">------</span><span style="color:#24292E;">          </span><span style="color:#005CC5;">----</span><span style="color:#24292E;">               </span><span style="color:#005CC5;">----</span><span style="color:#24292E;">               </span><span style="color:#005CC5;">-------</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">Normal</span><span style="color:#24292E;">   </span><span style="color:#032F62;">Scheduled</span><span style="color:#24292E;">       </span><span style="color:#005CC5;">25</span><span style="color:#032F62;">s</span><span style="color:#24292E;">                </span><span style="color:#032F62;">default-scheduler</span><span style="color:#24292E;">  </span><span style="color:#032F62;">Successfully</span><span style="color:#24292E;"> </span><span style="color:#032F62;">assigned</span><span style="color:#24292E;"> </span><span style="color:#032F62;">default/stree-serviceaccount</span><span style="color:#24292E;"> </span><span style="color:#032F62;">to</span><span style="color:#24292E;"> </span><span style="color:#032F62;">kube-node01</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">Normal</span><span style="color:#24292E;">   </span><span style="color:#032F62;">SandboxChanged</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">22</span><span style="color:#032F62;">s</span><span style="color:#24292E;"> (x2 </span><span style="color:#032F62;">over</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">24</span><span style="color:#032F62;">s</span><span style="color:#24292E;">)  kubelet            Pod sandbox changed, it will be killed and re-created.</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">Normal</span><span style="color:#24292E;">   </span><span style="color:#032F62;">BackOff</span><span style="color:#24292E;">         </span><span style="color:#005CC5;">19</span><span style="color:#032F62;">s</span><span style="color:#24292E;"> (x4 </span><span style="color:#032F62;">over</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#032F62;">s</span><span style="color:#24292E;">)  kubelet            Back-off pulling image </span><span style="color:#032F62;">&quot;registry.cn-zhangjiakou.aliyuncs.com/hsuing/test:v1&quot;</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">Warning</span><span style="color:#24292E;">  </span><span style="color:#032F62;">Failed</span><span style="color:#24292E;">          </span><span style="color:#005CC5;">19</span><span style="color:#032F62;">s</span><span style="color:#24292E;"> (x4 </span><span style="color:#032F62;">over</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#032F62;">s</span><span style="color:#24292E;">)  kubelet            Error: ImagePullBackOff</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">Normal</span><span style="color:#24292E;">   </span><span style="color:#032F62;">Pulling</span><span style="color:#24292E;">         </span><span style="color:#005CC5;">8</span><span style="color:#032F62;">s</span><span style="color:#24292E;"> (x2 </span><span style="color:#032F62;">over</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">25</span><span style="color:#032F62;">s</span><span style="color:#24292E;">)   kubelet            Pulling image </span><span style="color:#032F62;">&quot;registry.cn-zhangjiakou.aliyuncs.com/hsuing/test:v1&quot;</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">Warning</span><span style="color:#24292E;">  </span><span style="color:#032F62;">Failed</span><span style="color:#24292E;">          </span><span style="color:#005CC5;">7</span><span style="color:#032F62;">s</span><span style="color:#24292E;"> (x2 </span><span style="color:#032F62;">over</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">24</span><span style="color:#032F62;">s</span><span style="color:#24292E;">)   kubelet            Failed to pull image </span><span style="color:#032F62;">&quot;registry.cn-zhangjiakou.aliyuncs.com/hsuing/test:v1&quot;</span><span style="color:#24292E;">: rpc error: code = Unknown desc = Error response from daemon: pull access denied </span><span style="color:#D73A49;">for</span><span style="color:#24292E;"> registry.cn-zhangjiakou.aliyuncs.com/hsuing/test, repository does not exist or may require </span><span style="color:#032F62;">&#39;docker login&#39;</span><span style="color:#24292E;">: denied: requested access to the resource is denied</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">Warning</span><span style="color:#24292E;">  </span><span style="color:#032F62;">Failed</span><span style="color:#24292E;">          </span><span style="color:#005CC5;">7</span><span style="color:#032F62;">s</span><span style="color:#24292E;"> (x2 </span><span style="color:#032F62;">over</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">24</span><span style="color:#032F62;">s</span><span style="color:#24292E;">)   kubelet            Error: ErrImagePull</span></span></code></pre></div><h3 id="_5-4-2查看pod-处于errimage" tabindex="-1">5.4.2查看Pod，处于ErrImage <a class="header-anchor" href="#_5-4-2查看pod-处于errimage" aria-label="Permalink to &quot;5.4.2查看Pod，处于ErrImage&quot;">​</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">[root@kube-master secret]# kubectl get pod</span></span>
<span class="line"><span style="color:#B392F0;">NAME</span><span style="color:#E1E4E8;">                                      </span><span style="color:#9ECBFF;">READY</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">STATUS</span><span style="color:#E1E4E8;">             </span><span style="color:#9ECBFF;">RESTARTS</span><span style="color:#E1E4E8;">       </span><span style="color:#9ECBFF;">AGE</span></span>
<span class="line"><span style="color:#B392F0;">stree-serviceaccount</span><span style="color:#E1E4E8;">                      </span><span style="color:#79B8FF;">0</span><span style="color:#9ECBFF;">/1</span><span style="color:#E1E4E8;">     </span><span style="color:#9ECBFF;">ImagePullBackOff</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">              </span><span style="color:#79B8FF;">2</span><span style="color:#9ECBFF;">m6s</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">[root@kube-master secret]# kubectl get pod</span></span>
<span class="line"><span style="color:#6F42C1;">NAME</span><span style="color:#24292E;">                                      </span><span style="color:#032F62;">READY</span><span style="color:#24292E;">   </span><span style="color:#032F62;">STATUS</span><span style="color:#24292E;">             </span><span style="color:#032F62;">RESTARTS</span><span style="color:#24292E;">       </span><span style="color:#032F62;">AGE</span></span>
<span class="line"><span style="color:#6F42C1;">stree-serviceaccount</span><span style="color:#24292E;">                      </span><span style="color:#005CC5;">0</span><span style="color:#032F62;">/1</span><span style="color:#24292E;">     </span><span style="color:#032F62;">ImagePullBackOff</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">              </span><span style="color:#005CC5;">2</span><span style="color:#032F62;">m6s</span></span></code></pre></div><h3 id="_5-4-3-创建serviceaccount" tabindex="-1">5.4.3 创建ServiceAccount <a class="header-anchor" href="#_5-4-3-创建serviceaccount" aria-label="Permalink to &quot;5.4.3 创建ServiceAccount&quot;">​</a></h3><p>aliyun-registry是docker-registry类型的Secrets对象，由用户提前手动创建，它可以通过键值数据提供docker仓库服务器的地址，接入服务器的用户名，密码及用户的电子邮件信息等，认证通过后，引用ServiceAccount的Pod资源即可从指定的镜像仓库下载image</p><ul><li>创建</li></ul><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">[</span><span style="color:#9ECBFF;">root@kube-master secret</span><span style="color:#E1E4E8;">]# </span><span style="color:#9ECBFF;">cat serviceaccount-imagepullsecret.yaml</span></span>
<span class="line"><span style="color:#85E89D;">apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">v1</span></span>
<span class="line"><span style="color:#85E89D;">kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">ServiceAccount</span></span>
<span class="line"><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">imagepull-aliyun-sa</span></span>
<span class="line"><span style="color:#85E89D;">imagePullSecrets</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">- </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">aliyun-registry</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">[</span><span style="color:#032F62;">root@kube-master secret</span><span style="color:#24292E;">]# </span><span style="color:#032F62;">cat serviceaccount-imagepullsecret.yaml</span></span>
<span class="line"><span style="color:#22863A;">apiVersion</span><span style="color:#24292E;">: </span><span style="color:#032F62;">v1</span></span>
<span class="line"><span style="color:#22863A;">kind</span><span style="color:#24292E;">: </span><span style="color:#032F62;">ServiceAccount</span></span>
<span class="line"><span style="color:#22863A;">metadata</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">imagepull-aliyun-sa</span></span>
<span class="line"><span style="color:#22863A;">imagePullSecrets</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">- </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">aliyun-registry</span></span></code></pre></div><ul><li>查看</li></ul><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">kubectl get sa imagepull-aliyun-sa -o yaml</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">kubectl get sa imagepull-aliyun-sa -o yaml</span></span></code></pre></div><ul><li><h4 id="pod引用serviceaccount" tabindex="-1">Pod引用ServiceAccount <a class="header-anchor" href="#pod引用serviceaccount" aria-label="Permalink to &quot;Pod引用ServiceAccount&quot;">​</a></h4></li></ul><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">[</span><span style="color:#9ECBFF;">root@kube-master secret</span><span style="color:#E1E4E8;">]# </span><span style="color:#9ECBFF;">cat pod-serviceaccount-secret.yaml</span></span>
<span class="line"><span style="color:#85E89D;">apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">v1</span></span>
<span class="line"><span style="color:#85E89D;">kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Pod</span></span>
<span class="line"><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">stree-serviceaccount</span></span>
<span class="line"><span style="color:#85E89D;">spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">serviceAccount</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">imagepull-aliyun-sa</span><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;"># 这里则是创建的sa的名称</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">containers</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  - </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">stree</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">image</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">registry.cn-zhangjiakou.aliyuncs.com/hsuing/test:v1</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">[</span><span style="color:#032F62;">root@kube-master secret</span><span style="color:#24292E;">]# </span><span style="color:#032F62;">cat pod-serviceaccount-secret.yaml</span></span>
<span class="line"><span style="color:#22863A;">apiVersion</span><span style="color:#24292E;">: </span><span style="color:#032F62;">v1</span></span>
<span class="line"><span style="color:#22863A;">kind</span><span style="color:#24292E;">: </span><span style="color:#032F62;">Pod</span></span>
<span class="line"><span style="color:#22863A;">metadata</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">stree-serviceaccount</span></span>
<span class="line"><span style="color:#22863A;">spec</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">serviceAccount</span><span style="color:#24292E;">: </span><span style="color:#032F62;">imagepull-aliyun-sa</span><span style="color:#24292E;">  </span><span style="color:#6A737D;"># 这里则是创建的sa的名称</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">containers</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">stree</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">image</span><span style="color:#24292E;">: </span><span style="color:#032F62;">registry.cn-zhangjiakou.aliyuncs.com/hsuing/test:v1</span></span></code></pre></div><ul><li>查看</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">[root@kube-master secret]# kubectl get pod</span></span>
<span class="line"><span style="color:#B392F0;">NAME</span><span style="color:#E1E4E8;">                                      </span><span style="color:#9ECBFF;">READY</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">STATUS</span><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">RESTARTS</span><span style="color:#E1E4E8;">       </span><span style="color:#9ECBFF;">AGE</span></span>
<span class="line"><span style="color:#B392F0;">stree-serviceaccount</span><span style="color:#E1E4E8;">                      </span><span style="color:#79B8FF;">1</span><span style="color:#9ECBFF;">/1</span><span style="color:#E1E4E8;">     </span><span style="color:#9ECBFF;">Running</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">              </span><span style="color:#79B8FF;">3</span><span style="color:#9ECBFF;">s</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">[root@kube-master secret]# kubectl get pod</span></span>
<span class="line"><span style="color:#6F42C1;">NAME</span><span style="color:#24292E;">                                      </span><span style="color:#032F62;">READY</span><span style="color:#24292E;">   </span><span style="color:#032F62;">STATUS</span><span style="color:#24292E;">    </span><span style="color:#032F62;">RESTARTS</span><span style="color:#24292E;">       </span><span style="color:#032F62;">AGE</span></span>
<span class="line"><span style="color:#6F42C1;">stree-serviceaccount</span><span style="color:#24292E;">                      </span><span style="color:#005CC5;">1</span><span style="color:#032F62;">/1</span><span style="color:#24292E;">     </span><span style="color:#032F62;">Running</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">              </span><span style="color:#005CC5;">3</span><span style="color:#032F62;">s</span></span></code></pre></div><h1 id="_6-secret实践" tabindex="-1">6. Secret实践 <a class="header-anchor" href="#_6-secret实践" aria-label="Permalink to &quot;6. Secret实践&quot;">​</a></h1><p>主要用于存储敏感信息，例如密码、秘钥、证书等</p><ol><li>首先使用base64对数据进行编码</li></ol><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">[root@k8s-master01 </span><span style="color:#F97583;">~</span><span style="color:#E1E4E8;">]# echo -n </span><span style="color:#9ECBFF;">&#39;admin&#39;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">base64</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;">#准备username</span></span>
<span class="line"><span style="color:#E1E4E8;">YWRtaW4</span><span style="color:#F97583;">=</span></span>
<span class="line"><span style="color:#E1E4E8;">[root@k8s-master01 </span><span style="color:#F97583;">~</span><span style="color:#E1E4E8;">]# echo -n </span><span style="color:#9ECBFF;">&#39;123456&#39;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">base64</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;">#准备password</span></span>
<span class="line"><span style="color:#B392F0;">MTIzNDU2</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">[root@k8s-master01 </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# echo -n </span><span style="color:#032F62;">&#39;admin&#39;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">base64</span><span style="color:#24292E;"> </span><span style="color:#6A737D;">#准备username</span></span>
<span class="line"><span style="color:#24292E;">YWRtaW4</span><span style="color:#D73A49;">=</span></span>
<span class="line"><span style="color:#24292E;">[root@k8s-master01 </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# echo -n </span><span style="color:#032F62;">&#39;123456&#39;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">base64</span><span style="color:#24292E;"> </span><span style="color:#6A737D;">#准备password</span></span>
<span class="line"><span style="color:#6F42C1;">MTIzNDU2</span></span></code></pre></div><p>2.接下来编写secret.yaml，并创建Secret</p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#85E89D;">apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">v1</span></span>
<span class="line"><span style="color:#85E89D;">kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Secret</span></span>
<span class="line"><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">secret</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">namespace</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">dev</span></span>
<span class="line"><span style="color:#85E89D;">type</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Opaque</span></span>
<span class="line"><span style="color:#85E89D;">data</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">username</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">YWRtaW4=</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">password</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">MTIzNDU2</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#22863A;">apiVersion</span><span style="color:#24292E;">: </span><span style="color:#032F62;">v1</span></span>
<span class="line"><span style="color:#22863A;">kind</span><span style="color:#24292E;">: </span><span style="color:#032F62;">Secret</span></span>
<span class="line"><span style="color:#22863A;">metadata</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">secret</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">namespace</span><span style="color:#24292E;">: </span><span style="color:#032F62;">dev</span></span>
<span class="line"><span style="color:#22863A;">type</span><span style="color:#24292E;">: </span><span style="color:#032F62;">Opaque</span></span>
<span class="line"><span style="color:#22863A;">data</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">username</span><span style="color:#24292E;">: </span><span style="color:#032F62;">YWRtaW4=</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">password</span><span style="color:#24292E;">: </span><span style="color:#032F62;">MTIzNDU2</span></span></code></pre></div><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;"># 创建secret</span></span>
<span class="line"><span style="color:#E1E4E8;">[root@k8s-master01 </span><span style="color:#F97583;">~</span><span style="color:#E1E4E8;">]# kubectl create -f secret.yaml</span></span>
<span class="line"><span style="color:#B392F0;">secret/secret</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">created</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 查看secret详情</span></span>
<span class="line"><span style="color:#E1E4E8;">[root@k8s-master01 </span><span style="color:#F97583;">~</span><span style="color:#E1E4E8;">]# kubectl describe secret secret -n dev</span></span>
<span class="line"><span style="color:#B392F0;">Name:</span><span style="color:#E1E4E8;">         </span><span style="color:#9ECBFF;">secret</span></span>
<span class="line"><span style="color:#B392F0;">Namespace:</span><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">dev</span></span>
<span class="line"><span style="color:#B392F0;">Labels:</span><span style="color:#E1E4E8;">       </span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">non</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span></span>
<span class="line"><span style="color:#B392F0;">Annotations:</span><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">non</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span></span>
<span class="line"><span style="color:#B392F0;">Type:</span><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">Opaque</span></span>
<span class="line"><span style="color:#B392F0;">Data</span></span>
<span class="line"><span style="color:#E1E4E8;">====</span></span>
<span class="line"><span style="color:#B392F0;">password:</span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">6</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">bytes</span></span>
<span class="line"><span style="color:#B392F0;">username:</span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">5</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">bytes</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;"># 创建secret</span></span>
<span class="line"><span style="color:#24292E;">[root@k8s-master01 </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# kubectl create -f secret.yaml</span></span>
<span class="line"><span style="color:#6F42C1;">secret/secret</span><span style="color:#24292E;"> </span><span style="color:#032F62;">created</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 查看secret详情</span></span>
<span class="line"><span style="color:#24292E;">[root@k8s-master01 </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# kubectl describe secret secret -n dev</span></span>
<span class="line"><span style="color:#6F42C1;">Name:</span><span style="color:#24292E;">         </span><span style="color:#032F62;">secret</span></span>
<span class="line"><span style="color:#6F42C1;">Namespace:</span><span style="color:#24292E;">    </span><span style="color:#032F62;">dev</span></span>
<span class="line"><span style="color:#6F42C1;">Labels:</span><span style="color:#24292E;">       </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">non</span><span style="color:#24292E;">e</span><span style="color:#D73A49;">&gt;</span></span>
<span class="line"><span style="color:#6F42C1;">Annotations:</span><span style="color:#24292E;">  </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">non</span><span style="color:#24292E;">e</span><span style="color:#D73A49;">&gt;</span></span>
<span class="line"><span style="color:#6F42C1;">Type:</span><span style="color:#24292E;">  </span><span style="color:#032F62;">Opaque</span></span>
<span class="line"><span style="color:#6F42C1;">Data</span></span>
<span class="line"><span style="color:#24292E;">====</span></span>
<span class="line"><span style="color:#6F42C1;">password:</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">6</span><span style="color:#24292E;"> </span><span style="color:#032F62;">bytes</span></span>
<span class="line"><span style="color:#6F42C1;">username:</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">5</span><span style="color:#24292E;"> </span><span style="color:#032F62;">bytes</span></span></code></pre></div><p>3.创建pod-secret.yaml，将上面创建的secret挂载进去：</p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#85E89D;">apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">v1</span></span>
<span class="line"><span style="color:#85E89D;">kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Pod</span></span>
<span class="line"><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">pod-secret</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">namespace</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">dev</span></span>
<span class="line"><span style="color:#85E89D;">spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">containers</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  - </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">nginx</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">image</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">nginx:1.17.1</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">volumeMounts</span><span style="color:#E1E4E8;">: </span><span style="color:#6A737D;"># 将secret挂载到目录</span></span>
<span class="line"><span style="color:#E1E4E8;">    - </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">config</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">mountPath</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">/secret/config</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">volumes</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  - </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">config</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">secret</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">secretName</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">secret</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#22863A;">apiVersion</span><span style="color:#24292E;">: </span><span style="color:#032F62;">v1</span></span>
<span class="line"><span style="color:#22863A;">kind</span><span style="color:#24292E;">: </span><span style="color:#032F62;">Pod</span></span>
<span class="line"><span style="color:#22863A;">metadata</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">pod-secret</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">namespace</span><span style="color:#24292E;">: </span><span style="color:#032F62;">dev</span></span>
<span class="line"><span style="color:#22863A;">spec</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">containers</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">nginx</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">image</span><span style="color:#24292E;">: </span><span style="color:#032F62;">nginx:1.17.1</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">volumeMounts</span><span style="color:#24292E;">: </span><span style="color:#6A737D;"># 将secret挂载到目录</span></span>
<span class="line"><span style="color:#24292E;">    - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">config</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">mountPath</span><span style="color:#24292E;">: </span><span style="color:#032F62;">/secret/config</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">volumes</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">config</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">secret</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">secretName</span><span style="color:#24292E;">: </span><span style="color:#032F62;">secret</span></span></code></pre></div><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;"># 创建pod</span></span>
<span class="line"><span style="color:#E1E4E8;">[root@k8s-master01 </span><span style="color:#F97583;">~</span><span style="color:#E1E4E8;">]# kubectl create -f pod-secret.yaml</span></span>
<span class="line"><span style="color:#B392F0;">pod/pod-secret</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">created</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 查看pod</span></span>
<span class="line"><span style="color:#E1E4E8;">[root@k8s-master01 </span><span style="color:#F97583;">~</span><span style="color:#E1E4E8;">]# kubectl get pod pod-secret -n dev</span></span>
<span class="line"><span style="color:#B392F0;">NAME</span><span style="color:#E1E4E8;">            </span><span style="color:#9ECBFF;">READY</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">STATUS</span><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">RESTARTS</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">AGE</span></span>
<span class="line"><span style="color:#B392F0;">pod-secret</span><span style="color:#E1E4E8;">      </span><span style="color:#79B8FF;">1</span><span style="color:#9ECBFF;">/1</span><span style="color:#E1E4E8;">     </span><span style="color:#9ECBFF;">Running</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">          </span><span style="color:#79B8FF;">2</span><span style="color:#9ECBFF;">m28s</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 进入容器，查看secret信息，发现已经自动解码了</span></span>
<span class="line"><span style="color:#E1E4E8;">[root@k8s-master01 </span><span style="color:#F97583;">~</span><span style="color:#E1E4E8;">]# kubectl exec -it pod-secret /bin/sh -n dev</span></span>
<span class="line"><span style="color:#B392F0;">/</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># ls /secret/config/</span></span>
<span class="line"><span style="color:#B392F0;">password</span><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">username</span></span>
<span class="line"><span style="color:#B392F0;">/</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># more /secret/config/username</span></span>
<span class="line"><span style="color:#B392F0;">admin</span></span>
<span class="line"><span style="color:#B392F0;">/</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># more /secret/config/password</span></span>
<span class="line"><span style="color:#B392F0;">123456</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;"># 创建pod</span></span>
<span class="line"><span style="color:#24292E;">[root@k8s-master01 </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# kubectl create -f pod-secret.yaml</span></span>
<span class="line"><span style="color:#6F42C1;">pod/pod-secret</span><span style="color:#24292E;"> </span><span style="color:#032F62;">created</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 查看pod</span></span>
<span class="line"><span style="color:#24292E;">[root@k8s-master01 </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# kubectl get pod pod-secret -n dev</span></span>
<span class="line"><span style="color:#6F42C1;">NAME</span><span style="color:#24292E;">            </span><span style="color:#032F62;">READY</span><span style="color:#24292E;">   </span><span style="color:#032F62;">STATUS</span><span style="color:#24292E;">    </span><span style="color:#032F62;">RESTARTS</span><span style="color:#24292E;">   </span><span style="color:#032F62;">AGE</span></span>
<span class="line"><span style="color:#6F42C1;">pod-secret</span><span style="color:#24292E;">      </span><span style="color:#005CC5;">1</span><span style="color:#032F62;">/1</span><span style="color:#24292E;">     </span><span style="color:#032F62;">Running</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">          </span><span style="color:#005CC5;">2</span><span style="color:#032F62;">m28s</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 进入容器，查看secret信息，发现已经自动解码了</span></span>
<span class="line"><span style="color:#24292E;">[root@k8s-master01 </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# kubectl exec -it pod-secret /bin/sh -n dev</span></span>
<span class="line"><span style="color:#6F42C1;">/</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># ls /secret/config/</span></span>
<span class="line"><span style="color:#6F42C1;">password</span><span style="color:#24292E;">  </span><span style="color:#032F62;">username</span></span>
<span class="line"><span style="color:#6F42C1;">/</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># more /secret/config/username</span></span>
<span class="line"><span style="color:#6F42C1;">admin</span></span>
<span class="line"><span style="color:#6F42C1;">/</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># more /secret/config/password</span></span>
<span class="line"><span style="color:#6F42C1;">123456</span></span></code></pre></div>`,149),e=[o];function c(t,r,E,y,i,F){return a(),n("div",null,e)}const C=s(p,[["render",c]]);export{u as __pageData,C as default};
