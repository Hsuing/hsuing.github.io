import{_ as s,o as a,c as n,R as l}from"./chunks/framework.zUbWieqp.js";const u=JSON.parse('{"title":"1.ns无法删除","description":"","frontmatter":{},"headers":[],"relativePath":"guide/container/k8s/TroubleshootingMaintenanceManual/19-Terminating.md","filePath":"guide/container/k8s/TroubleshootingMaintenanceManual/19-Terminating.md","lastUpdated":1730111076000}'),p={name:"guide/container/k8s/TroubleshootingMaintenanceManual/19-Terminating.md"},o=l(`<h1 id="_1-ns无法删除" tabindex="-1">1.ns无法删除 <a class="header-anchor" href="#_1-ns无法删除" aria-label="Permalink to &quot;1.ns无法删除&quot;">​</a></h1><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">[root@master1 </span><span style="color:#F97583;">~</span><span style="color:#E1E4E8;">]# kubectl get ns</span></span>
<span class="line"><span style="color:#B392F0;">NAME</span><span style="color:#E1E4E8;">                         </span><span style="color:#9ECBFF;">STATUS</span><span style="color:#E1E4E8;">        </span><span style="color:#9ECBFF;">AGE</span></span>
<span class="line"><span style="color:#B392F0;">default</span><span style="color:#E1E4E8;">                      </span><span style="color:#9ECBFF;">Active</span><span style="color:#E1E4E8;">        </span><span style="color:#79B8FF;">2</span><span style="color:#9ECBFF;">d22h</span></span>
<span class="line"><span style="color:#B392F0;">kube-node-lease</span><span style="color:#E1E4E8;">              </span><span style="color:#9ECBFF;">Active</span><span style="color:#E1E4E8;">        </span><span style="color:#79B8FF;">2</span><span style="color:#9ECBFF;">d22h</span></span>
<span class="line"><span style="color:#B392F0;">kube-public</span><span style="color:#E1E4E8;">                  </span><span style="color:#9ECBFF;">Active</span><span style="color:#E1E4E8;">        </span><span style="color:#79B8FF;">2</span><span style="color:#9ECBFF;">d22h</span></span>
<span class="line"><span style="color:#B392F0;">kube-system</span><span style="color:#E1E4E8;">                  </span><span style="color:#9ECBFF;">Active</span><span style="color:#E1E4E8;">        </span><span style="color:#79B8FF;">2</span><span style="color:#9ECBFF;">d22h</span></span>
<span class="line"><span style="color:#B392F0;">kubesphere-logging-system</span><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">Terminating</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">109</span><span style="color:#9ECBFF;">m</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">[root@master1 </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# kubectl get ns</span></span>
<span class="line"><span style="color:#6F42C1;">NAME</span><span style="color:#24292E;">                         </span><span style="color:#032F62;">STATUS</span><span style="color:#24292E;">        </span><span style="color:#032F62;">AGE</span></span>
<span class="line"><span style="color:#6F42C1;">default</span><span style="color:#24292E;">                      </span><span style="color:#032F62;">Active</span><span style="color:#24292E;">        </span><span style="color:#005CC5;">2</span><span style="color:#032F62;">d22h</span></span>
<span class="line"><span style="color:#6F42C1;">kube-node-lease</span><span style="color:#24292E;">              </span><span style="color:#032F62;">Active</span><span style="color:#24292E;">        </span><span style="color:#005CC5;">2</span><span style="color:#032F62;">d22h</span></span>
<span class="line"><span style="color:#6F42C1;">kube-public</span><span style="color:#24292E;">                  </span><span style="color:#032F62;">Active</span><span style="color:#24292E;">        </span><span style="color:#005CC5;">2</span><span style="color:#032F62;">d22h</span></span>
<span class="line"><span style="color:#6F42C1;">kube-system</span><span style="color:#24292E;">                  </span><span style="color:#032F62;">Active</span><span style="color:#24292E;">        </span><span style="color:#005CC5;">2</span><span style="color:#032F62;">d22h</span></span>
<span class="line"><span style="color:#6F42C1;">kubesphere-logging-system</span><span style="color:#24292E;">    </span><span style="color:#032F62;">Terminating</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">109</span><span style="color:#032F62;">m</span></span></code></pre></div><h2 id="_1-1查看该空间资源" tabindex="-1">1.1查看该空间资源 <a class="header-anchor" href="#_1-1查看该空间资源" aria-label="Permalink to &quot;1.1查看该空间资源&quot;">​</a></h2><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">api-resources</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-o</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">name</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--verbs=list</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--namespaced</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">xargs</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-n</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">get</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--show-kind</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--ignore-not-found</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-n</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">kubesphere-logging-system</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">api-resources</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-o</span><span style="color:#24292E;"> </span><span style="color:#032F62;">name</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--verbs=list</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--namespaced</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">xargs</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-n</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">get</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--show-kind</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--ignore-not-found</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-n</span><span style="color:#24292E;"> </span><span style="color:#032F62;">kubesphere-logging-system</span></span></code></pre></div><h2 id="_1-2清理" tabindex="-1">1.2清理 <a class="header-anchor" href="#_1-2清理" aria-label="Permalink to &quot;1.2清理&quot;">​</a></h2><p>如果出现Terminating状态的命名空间，强制删除也不管用，执行以下命令</p><h3 id="清空-finalizers-字段的值" tabindex="-1">清空 finalizers 字段的值 <a class="header-anchor" href="#清空-finalizers-字段的值" aria-label="Permalink to &quot;清空 finalizers 字段的值&quot;">​</a></h3><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">kubectl patch namespace NS -p &#39;{&quot;metadata&quot;:{&quot;finalizers&quot;:[]}}&#39; --type=&#39;merge&#39; -n NS</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">kubectl patch namespace NS -p &#39;{&quot;metadata&quot;:{&quot;finalizers&quot;:[]}}&#39; --type=&#39;merge&#39; -n NS</span></span></code></pre></div><p>再查看 ns，如果没有这个 ns了就不用管了，很有可能需要手动再删除，执行下面命令就行</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">kubectl delete namespace NS --grace-period=0 --force</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">kubectl delete namespace NS --grace-period=0 --force</span></span></code></pre></div><p>或者</p><ul><li>获取ns详细信息</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">get</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">ns</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">kubesphere-logging-system</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-o</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">json</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">ns.json</span></span>
<span class="line"><span style="color:#E1E4E8;"> </span></span>
<span class="line"><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">//</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">删除下面的部分</span></span>
<span class="line"><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">//</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">&quot;spec&quot;:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">{</span></span>
<span class="line"><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">//</span><span style="color:#E1E4E8;">       </span><span style="color:#9ECBFF;">&quot;finalizers&quot;:</span><span style="color:#E1E4E8;"> [</span></span>
<span class="line"><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">//</span><span style="color:#E1E4E8;">           </span><span style="color:#9ECBFF;">&quot;kubernetes&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">//</span><span style="color:#E1E4E8;">       </span><span style="color:#9ECBFF;">]</span></span>
<span class="line"><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">//</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">},</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;"> </span><span style="color:#6F42C1;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">get</span><span style="color:#24292E;"> </span><span style="color:#032F62;">ns</span><span style="color:#24292E;"> </span><span style="color:#032F62;">kubesphere-logging-system</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-o</span><span style="color:#24292E;"> </span><span style="color:#032F62;">json</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">ns.json</span></span>
<span class="line"><span style="color:#24292E;"> </span></span>
<span class="line"><span style="color:#24292E;"> </span><span style="color:#6F42C1;">//</span><span style="color:#24292E;"> </span><span style="color:#032F62;">删除下面的部分</span></span>
<span class="line"><span style="color:#24292E;"> </span><span style="color:#6F42C1;">//</span><span style="color:#24292E;">   </span><span style="color:#032F62;">&quot;spec&quot;:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">{</span></span>
<span class="line"><span style="color:#24292E;"> </span><span style="color:#6F42C1;">//</span><span style="color:#24292E;">       </span><span style="color:#032F62;">&quot;finalizers&quot;:</span><span style="color:#24292E;"> [</span></span>
<span class="line"><span style="color:#24292E;"> </span><span style="color:#6F42C1;">//</span><span style="color:#24292E;">           </span><span style="color:#032F62;">&quot;kubernetes&quot;</span></span>
<span class="line"><span style="color:#24292E;"> </span><span style="color:#6F42C1;">//</span><span style="color:#24292E;">       </span><span style="color:#032F62;">]</span></span>
<span class="line"><span style="color:#24292E;"> </span><span style="color:#6F42C1;">//</span><span style="color:#24292E;">   </span><span style="color:#032F62;">},</span></span></code></pre></div><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">#启动proxy</span></span>
<span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">proxy</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 注意配置finalize前面的namespace</span></span>
<span class="line"><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">curl</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-k</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-H</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;Content-Type: application/json&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-X</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">PUT</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--data-binary</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">@ns.json</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">http://127.0.0.1:8001/api/v1/namespaces/kubesphere-logging-system/finalize</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">#启动proxy</span></span>
<span class="line"><span style="color:#6F42C1;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">proxy</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 注意配置finalize前面的namespace</span></span>
<span class="line"><span style="color:#24292E;"> </span><span style="color:#6F42C1;">curl</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-k</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-H</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;Content-Type: application/json&quot;</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-X</span><span style="color:#24292E;"> </span><span style="color:#032F62;">PUT</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--data-binary</span><span style="color:#24292E;"> </span><span style="color:#032F62;">@ns.json</span><span style="color:#24292E;"> </span><span style="color:#032F62;">http://127.0.0.1:8001/api/v1/namespaces/kubesphere-logging-system/finalize</span></span></code></pre></div>`,14),e=[o];function t(c,r,y,E,i,F){return a(),n("div",null,e)}const C=s(p,[["render",t]]);export{u as __pageData,C as default};
