import{_ as s,o as n,c as a,R as p}from"./chunks/framework.zUbWieqp.js";const m=JSON.parse('{"title":"1. ConfigMap基本概念","description":"","frontmatter":{},"headers":[],"relativePath":"guide/container/k8s/资源对象/8-configmap.md","filePath":"guide/container/k8s/资源对象/8-configmap.md","lastUpdated":1723447064000}'),l={name:"guide/container/k8s/资源对象/8-configmap.md"},o=p(`<p>文档，<a href="https://kubernetes.io/zh-cn/docs/concepts/configuration/configmap/" target="_blank" rel="noreferrer">https://kubernetes.io/zh-cn/docs/concepts/configuration/configmap/</a></p><h1 id="_1-configmap基本概念" tabindex="-1">1. ConfigMap基本概念 <a class="header-anchor" href="#_1-configmap基本概念" aria-label="Permalink to &quot;1. ConfigMap基本概念&quot;">​</a></h1><p><code>ConfigMap和Secret的本质是volume的一种形式</code>,k8s旨在把一切资源抽象化</p><h2 id="_1-1-什么是configmap" tabindex="-1">1.1 什么是ConfigMap <a class="header-anchor" href="#_1-1-什么是configmap" aria-label="Permalink to &quot;1.1 什么是ConfigMap&quot;">​</a></h2><p>ConfigMap资源主要为容器注⼊相关的程序配置信息，⽤来定制程序的运⾏⽅式，⽐如Redis监听端⼝、最⼤客户端连接数等等。</p><p>当定义好⼀个ConfigMap资源后，如果Pod需要使⽤，可以通过通过<code>环境变量</code>、<code>命令行参数</code>或<code>存储卷形式</code>将其挂载并加载相关的配置，降低了配置与镜像⽂件的耦合关系。</p><p>ConfigMap 对象将配置数据以<code>键值对</code>的形式进行存储，这些数据可以在 Pod 对象中使用或者为系统组件提供配置。</p><h2 id="_1-2-为什么需要configmap" tabindex="-1">1.2 为什么需要ConfigMap <a class="header-anchor" href="#_1-2-为什么需要configmap" aria-label="Permalink to &quot;1.2 为什么需要ConfigMap&quot;">​</a></h2><p>将<code>应用配置信息与程序进行分离</code>，这样可以使得应用程序被更好地复用，通过不同的配置能实现更灵活的功能，例如：在测试环境中Nginx提供test域名访问，且没配置压缩功能，而在生产环境中则需要提供www域名访问，且需要开启压缩功能，所以将应用容器与配置分离，根据不同的环境调用不同的<code>ConfigMap</code>配置，能有效的降低耦合度和复杂度。</p><p><img src="https://nnaigos.oss-cn-hangzhou.aliyuncs.com/imgs/202405281159079.png" alt="image-20240528115757521"></p><h2 id="_1-3-configmap作用" tabindex="-1">1.3 ConfigMap作用 <a class="header-anchor" href="#_1-3-configmap作用" aria-label="Permalink to &quot;1.3 ConfigMap作用&quot;">​</a></h2><p>存储不加密数据到etcd，让Pod以变量或者Volume挂载到容器中。</p><h1 id="_2-创建configmap" tabindex="-1">2. 创建ConfigMap <a class="header-anchor" href="#_2-创建configmap" aria-label="Permalink to &quot;2. 创建ConfigMap&quot;">​</a></h1><p>官方文档，<a href="https://kubernetes.io/zh-cn/docs/tasks/configure-pod-container/configure-pod-configmap/" target="_blank" rel="noreferrer">https://kubernetes.io/zh-cn/docs/tasks/configure-pod-container/configure-pod-configmap/</a></p><h2 id="_2-0-资源定义规范" tabindex="-1">2.0 资源定义规范 <a class="header-anchor" href="#_2-0-资源定义规范" aria-label="Permalink to &quot;2.0 资源定义规范&quot;">​</a></h2><ul><li>创建ConfigMap后，数据实际会存储在K8s中Etcd，然后通过创建Pod时引用该数据。</li><li>应用场景：应用程序配置 Pod使用configmap数据有两种方式： <ul><li>变量注入</li><li>数据卷挂载</li></ul></li></ul><p><img src="https://nnaigos.oss-cn-hangzhou.aliyuncs.com/imgs/202408070931952.png" alt="image"></p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">#帮助文档</span></span>
<span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">explain</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">configmap</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">或者</span></span>
<span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">create</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">configmap</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--help</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">#帮助文档</span></span>
<span class="line"><span style="color:#6F42C1;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">explain</span><span style="color:#24292E;"> </span><span style="color:#032F62;">configmap</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">或者</span></span>
<span class="line"><span style="color:#6F42C1;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">create</span><span style="color:#24292E;"> </span><span style="color:#032F62;">configmap</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--help</span></span></code></pre></div><h2 id="_2-1-基于命令创建cm" tabindex="-1">2.1 基于命令创建CM <a class="header-anchor" href="#_2-1-基于命令创建cm" aria-label="Permalink to &quot;2.1 基于命令创建CM&quot;">​</a></h2><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">[root@kube-master </span><span style="color:#F97583;">~</span><span style="color:#E1E4E8;">]# kubectl create configmap nginx-command-config --from-literal=ngx.host=</span><span style="color:#9ECBFF;">&#39;0.0.0.θ&#39;</span><span style="color:#E1E4E8;"> --from-literal=nginx.port=</span><span style="color:#9ECBFF;">&#39;8899&#39;</span></span>
<span class="line"><span style="color:#B392F0;">configmap/nginx-command-config</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">created</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#查看</span></span>
<span class="line"><span style="color:#E1E4E8;">[root@kube-master </span><span style="color:#F97583;">~</span><span style="color:#E1E4E8;">]# kubectl get configmaps</span></span>
<span class="line"><span style="color:#B392F0;">NAME</span><span style="color:#E1E4E8;">                   </span><span style="color:#9ECBFF;">DATA</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">AGE</span></span>
<span class="line"><span style="color:#B392F0;">nginx-command-config</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">2</span><span style="color:#E1E4E8;">      </span><span style="color:#79B8FF;">24</span><span style="color:#9ECBFF;">s</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#查看内容</span></span>
<span class="line"><span style="color:#E1E4E8;">[root@kube-master </span><span style="color:#F97583;">~</span><span style="color:#E1E4E8;">]# kubectl get configmaps nginx-command-config -oyaml</span></span>
<span class="line"><span style="color:#B392F0;">apiVersion:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">v1</span></span>
<span class="line"><span style="color:#B392F0;">data:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">nginx.port:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;8899&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">ngx.host:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0.0</span><span style="color:#9ECBFF;">.0.θ</span></span>
<span class="line"><span style="color:#B392F0;">kind:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">ConfigMap</span></span>
<span class="line"><span style="color:#B392F0;">metadata:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">creationTimestamp:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;2024-05-28T06:55:36Z&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">name:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">nginx-command-config</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">namespace:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">default</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">resourceVersion:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;1578412&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">uid:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">a94ec46f-3b93-4600-80f9-fa467a5eb6cd</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">[root@kube-master </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# kubectl create configmap nginx-command-config --from-literal=ngx.host=</span><span style="color:#032F62;">&#39;0.0.0.θ&#39;</span><span style="color:#24292E;"> --from-literal=nginx.port=</span><span style="color:#032F62;">&#39;8899&#39;</span></span>
<span class="line"><span style="color:#6F42C1;">configmap/nginx-command-config</span><span style="color:#24292E;"> </span><span style="color:#032F62;">created</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#查看</span></span>
<span class="line"><span style="color:#24292E;">[root@kube-master </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# kubectl get configmaps</span></span>
<span class="line"><span style="color:#6F42C1;">NAME</span><span style="color:#24292E;">                   </span><span style="color:#032F62;">DATA</span><span style="color:#24292E;">   </span><span style="color:#032F62;">AGE</span></span>
<span class="line"><span style="color:#6F42C1;">nginx-command-config</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">2</span><span style="color:#24292E;">      </span><span style="color:#005CC5;">24</span><span style="color:#032F62;">s</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#查看内容</span></span>
<span class="line"><span style="color:#24292E;">[root@kube-master </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# kubectl get configmaps nginx-command-config -oyaml</span></span>
<span class="line"><span style="color:#6F42C1;">apiVersion:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">v1</span></span>
<span class="line"><span style="color:#6F42C1;">data:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">nginx.port:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;8899&quot;</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">ngx.host:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0.0</span><span style="color:#032F62;">.0.θ</span></span>
<span class="line"><span style="color:#6F42C1;">kind:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">ConfigMap</span></span>
<span class="line"><span style="color:#6F42C1;">metadata:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">creationTimestamp:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;2024-05-28T06:55:36Z&quot;</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">name:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">nginx-command-config</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">namespace:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">default</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">resourceVersion:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;1578412&quot;</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">uid:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">a94ec46f-3b93-4600-80f9-fa467a5eb6cd</span></span></code></pre></div><div class="warning custom-block"><p class="custom-block-title">💡 说明</p><p>ConfigMap资源没有有sepc和status，而是直接使用data字段嵌套键值数据</p></div><h2 id="_2-2-基于文件创建-生产推荐" tabindex="-1">2.2 基于文件创建（生产推荐） <a class="header-anchor" href="#_2-2-基于文件创建-生产推荐" aria-label="Permalink to &quot;2.2 基于文件创建（生产推荐）&quot;">​</a></h2><p>为 &quot;kubeclt create configmap&quot; 命令使用 &quot;--from-file&quot; 选项即可基于文件内容来创建 ConfigMap 对象，可以重复多次使用 &quot;--from-file&quot; 选项以传递多个文件内容，它的命令格式如下：</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">Usage:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">create</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">configmap</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">NAME</span><span style="color:#E1E4E8;"> [--from-file=[key=]source] [--from-literal</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">key1</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">value1] [--dry-run</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">server</span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">client</span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">none] [options]</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">Usage:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">create</span><span style="color:#24292E;"> </span><span style="color:#032F62;">configmap</span><span style="color:#24292E;"> </span><span style="color:#032F62;">NAME</span><span style="color:#24292E;"> [--from-file=[key=]source] [--from-literal</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">key1</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">value1] [--dry-run</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">server</span><span style="color:#D73A49;">|</span><span style="color:#24292E;">client</span><span style="color:#D73A49;">|</span><span style="color:#24292E;">none] [options]</span></span></code></pre></div><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">#事先准备好的 Nginx 配置文件模板保存于 ConfigMap 对象 nginx-config</span></span>
<span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">create</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">configmap</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">nginx-config</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#E1E4E8;">--from-file=/data/configs/nginx/conf.d/www.aaa.com.conf </span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#E1E4E8;">--from-file=/data/configs/nginx/conf.d/www.bbb.com.conf</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">#事先准备好的 Nginx 配置文件模板保存于 ConfigMap 对象 nginx-config</span></span>
<span class="line"><span style="color:#6F42C1;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">create</span><span style="color:#24292E;"> </span><span style="color:#032F62;">configmap</span><span style="color:#24292E;"> </span><span style="color:#032F62;">nginx-config</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#24292E;">--from-file=/data/configs/nginx/conf.d/www.aaa.com.conf </span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#24292E;">--from-file=/data/configs/nginx/conf.d/www.bbb.com.conf</span></span></code></pre></div><p>如果需要自行指定键名，则可在 &quot;--from-file&quot; 选项中直接指定自定义的键，命令格式如下：</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">create</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">configmap</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">nginx-config</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#E1E4E8;">--from-file=aaa=/data/configs/nginx/conf.d/www.aaa.com.conf </span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#E1E4E8;">--from-file=bbb=/data/configs/nginx/conf.d/www.bbb.com.conf</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">create</span><span style="color:#24292E;"> </span><span style="color:#032F62;">configmap</span><span style="color:#24292E;"> </span><span style="color:#032F62;">nginx-config</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#24292E;">--from-file=aaa=/data/configs/nginx/conf.d/www.aaa.com.conf </span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#24292E;">--from-file=bbb=/data/configs/nginx/conf.d/www.bbb.com.conf</span></span></code></pre></div><h2 id="_2-3-基于目录" tabindex="-1">2.3 基于目录 <a class="header-anchor" href="#_2-3-基于目录" aria-label="Permalink to &quot;2.3 基于目录&quot;">​</a></h2><p>如果配置文件数量较多且存储于有限的目录中时，kubeclt 还提供了基于目录直接将多个文件分别纳为键值数据的 ConfigMap 资源创建方式。将 &quot;--from-file&quot; 选项后面所跟的路径指向一个目录路径就能将目录下的所有创建于同一 ConfigMap 资源中，命令格式如下：</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">Usage:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">create</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">configmap</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">configmap_na</span><span style="color:#E1E4E8;">m</span><span style="color:#F97583;">&gt;</span><span style="color:#9ECBFF;">[--from-file=</span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">path-to-director</span><span style="color:#E1E4E8;">y</span><span style="color:#F97583;">&gt;</span><span style="color:#9ECBFF;">]</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">Usage:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">create</span><span style="color:#24292E;"> </span><span style="color:#032F62;">configmap</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">configmap_na</span><span style="color:#24292E;">m</span><span style="color:#D73A49;">&gt;</span><span style="color:#032F62;">[--from-file=</span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">path-to-director</span><span style="color:#24292E;">y</span><span style="color:#D73A49;">&gt;</span><span style="color:#032F62;">]</span></span></code></pre></div><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">kubect</span><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">create</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">configmap</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">nginx-config-file</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--from-file=/data/confnigs/nginx/conf.d/</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">kubect</span><span style="color:#24292E;">  </span><span style="color:#032F62;">create</span><span style="color:#24292E;"> </span><span style="color:#032F62;">configmap</span><span style="color:#24292E;"> </span><span style="color:#032F62;">nginx-config-file</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--from-file=/data/confnigs/nginx/conf.d/</span></span></code></pre></div><h2 id="_2-4-使用资源清单创建" tabindex="-1">2.4 使用资源清单创建 <a class="header-anchor" href="#_2-4-使用资源清单创建" aria-label="Permalink to &quot;2.4 使用资源清单创建&quot;">​</a></h2><p>基于配置文件创建 ConfigMap 资源时，它所使用的字段包括通常的 apiVersion、kind 和 metadata 字段，以及用于存储数据的关键字段 &quot;data&quot;</p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">[</span><span style="color:#9ECBFF;">root@kube-master ~</span><span style="color:#E1E4E8;">]# </span><span style="color:#9ECBFF;">cat configmap.yaml</span></span>
<span class="line"><span style="color:#85E89D;">apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">v1</span></span>
<span class="line"><span style="color:#85E89D;">kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">ConfigMap</span></span>
<span class="line"><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">demoapp-config</span></span>
<span class="line"><span style="color:#85E89D;">data</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">host</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">0.0.0.0</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">port</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;8888&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">my-server.conf</span><span style="color:#E1E4E8;">: </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#9ECBFF;">    server {</span></span>
<span class="line"><span style="color:#9ECBFF;">      listen 80;</span></span>
<span class="line"><span style="color:#9ECBFF;">      server_name go.ikubernetes.net;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#9ECBFF;">     location / {</span></span>
<span class="line"><span style="color:#9ECBFF;">      root /usr/share/nginx/html;</span></span>
<span class="line"><span style="color:#9ECBFF;">      index index.html;</span></span>
<span class="line"><span style="color:#9ECBFF;">    }</span></span>
<span class="line"><span style="color:#9ECBFF;">    include /etc/nginx/conf.d/*.cfg;</span></span>
<span class="line"><span style="color:#9ECBFF;">    }</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">[</span><span style="color:#032F62;">root@kube-master ~</span><span style="color:#24292E;">]# </span><span style="color:#032F62;">cat configmap.yaml</span></span>
<span class="line"><span style="color:#22863A;">apiVersion</span><span style="color:#24292E;">: </span><span style="color:#032F62;">v1</span></span>
<span class="line"><span style="color:#22863A;">kind</span><span style="color:#24292E;">: </span><span style="color:#032F62;">ConfigMap</span></span>
<span class="line"><span style="color:#22863A;">metadata</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">demoapp-config</span></span>
<span class="line"><span style="color:#22863A;">data</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">host</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">0.0.0.0</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">port</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;8888&quot;</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">my-server.conf</span><span style="color:#24292E;">: </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#032F62;">    server {</span></span>
<span class="line"><span style="color:#032F62;">      listen 80;</span></span>
<span class="line"><span style="color:#032F62;">      server_name go.ikubernetes.net;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#032F62;">     location / {</span></span>
<span class="line"><span style="color:#032F62;">      root /usr/share/nginx/html;</span></span>
<span class="line"><span style="color:#032F62;">      index index.html;</span></span>
<span class="line"><span style="color:#032F62;">    }</span></span>
<span class="line"><span style="color:#032F62;">    include /etc/nginx/conf.d/*.cfg;</span></span>
<span class="line"><span style="color:#032F62;">    }</span></span></code></pre></div><h2 id="_2-5-更新" tabindex="-1">2.5 更新 <a class="header-anchor" href="#_2-5-更新" aria-label="Permalink to &quot;2.5 更新&quot;">​</a></h2><h3 id="edit" tabindex="-1">edit <a class="header-anchor" href="#edit" aria-label="Permalink to &quot;edit&quot;">​</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">#查看configmap</span></span>
<span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">get</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">cm</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#修改</span></span>
<span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">edit</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">cm</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">demoapp-config</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">#查看configmap</span></span>
<span class="line"><span style="color:#6F42C1;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">get</span><span style="color:#24292E;"> </span><span style="color:#032F62;">cm</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#修改</span></span>
<span class="line"><span style="color:#6F42C1;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">edit</span><span style="color:#24292E;"> </span><span style="color:#032F62;">cm</span><span style="color:#24292E;"> </span><span style="color:#032F62;">demoapp-config</span></span></code></pre></div><h3 id="replace" tabindex="-1">replace <a class="header-anchor" href="#replace" aria-label="Permalink to &quot;replace&quot;">​</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">#先把yaml 文件备份出来</span></span>
<span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">get</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">cm</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">demoapp-config</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-oyaml</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">test.yaml</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#替换</span></span>
<span class="line"><span style="color:#E1E4E8;">[root@kube-master </span><span style="color:#F97583;">~</span><span style="color:#E1E4E8;">]# kubectl replace cm -f test.yaml</span></span>
<span class="line"><span style="color:#B392F0;">configmap/demoapp-config</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">replaced</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">#先把yaml 文件备份出来</span></span>
<span class="line"><span style="color:#6F42C1;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">get</span><span style="color:#24292E;"> </span><span style="color:#032F62;">cm</span><span style="color:#24292E;"> </span><span style="color:#032F62;">demoapp-config</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-oyaml</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">test.yaml</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#替换</span></span>
<span class="line"><span style="color:#24292E;">[root@kube-master </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# kubectl replace cm -f test.yaml</span></span>
<span class="line"><span style="color:#6F42C1;">configmap/demoapp-config</span><span style="color:#24292E;"> </span><span style="color:#032F62;">replaced</span></span></code></pre></div><h1 id="_3-pod引用configmap" tabindex="-1">3. Pod引⽤ConfigMap <a class="header-anchor" href="#_3-pod引用configmap" aria-label="Permalink to &quot;3. Pod引⽤ConfigMap&quot;">​</a></h1><p>环境变量通常由 name 和 value（或 valueFrom）字段构成：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">name &lt;string&gt;: 环境变量的名称，必选字段</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">value &lt;string&gt;: 环境变量的值，通过 $(VAR_NAME)引用</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">valueFrom &lt;Object&gt;: 环境变量值的引用源。例如，当前 Pod 资源的名称、名称空间、标签等，不能与非空值的 value 字段同时使用，即环境变量的值要么源于 value 字段，要么源于 valueFrom 字段，二者不可同时提供服数据。</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">name &lt;string&gt;: 环境变量的名称，必选字段</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">value &lt;string&gt;: 环境变量的值，通过 $(VAR_NAME)引用</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">valueFrom &lt;Object&gt;: 环境变量值的引用源。例如，当前 Pod 资源的名称、名称空间、标签等，不能与非空值的 value 字段同时使用，即环境变量的值要么源于 value 字段，要么源于 valueFrom 字段，二者不可同时提供服数据。</span></span></code></pre></div><p>valueFrom 字段可引用的值有多种来源，包括当前 Pod 资源的属性值，容器相关的系统资源配置、ConfigMap 对象中的 Key 以及 Secret 对象中的 Key，它们应分别使用不同的嵌套字段进行定义：</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">configMapRef &lt;Object&gt;：ConfigMap 对象中的特定 Key。</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">secretKeyRef &lt;Object&gt;: Secret 对象中的特定 Key。</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">configMapRef &lt;Object&gt;：ConfigMap 对象中的特定 Key。</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">secretKeyRef &lt;Object&gt;: Secret 对象中的特定 Key。</span></span></code></pre></div><h2 id="_3-1-通过环境变量引用cm键值" tabindex="-1">3.1 通过环境变量引⽤CM键值 <a class="header-anchor" href="#_3-1-通过环境变量引用cm键值" aria-label="Permalink to &quot;3.1 通过环境变量引⽤CM键值&quot;">​</a></h2><h3 id="env引用变量" tabindex="-1">env引⽤变量 <a class="header-anchor" href="#env引用变量" aria-label="Permalink to &quot;env引⽤变量&quot;">​</a></h3><p>pod清单中除了使⽤vaule字段直接给定变量之外，还支持<code>vaLueFrom</code>字段嵌套<code>configMapKeyRef</code>来引用<code>ConfigMap</code>对象的键值，具体格式如下</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">#查看帮助</span></span>
<span class="line"><span style="color:#e1e4e8;">kubectl explain pod.spec.containers.env</span></span>
<span class="line"><span style="color:#e1e4e8;">kubectl explain pod.spec.containers.envFrom</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">#查看帮助</span></span>
<span class="line"><span style="color:#24292e;">kubectl explain pod.spec.containers.env</span></span>
<span class="line"><span style="color:#24292e;">kubectl explain pod.spec.containers.envFrom</span></span></code></pre></div><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#85E89D;">env</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&lt;string&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;">#要赋值的环境变量名称</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">valueFrom</span><span style="color:#E1E4E8;">: </span><span style="color:#6A737D;">#定义变量的引|用</span></span>
<span class="line"><span style="color:#E1E4E8;">  	</span><span style="color:#85E89D;">configMapkeyRef</span><span style="color:#E1E4E8;">: </span><span style="color:#6A737D;"># 变量来自于configmap对象</span></span>
<span class="line"><span style="color:#E1E4E8;">  	   </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&lt;string&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;">#configmap对象的名称（因为有很多configmap,需要指定具体的名称)</span></span>
<span class="line"><span style="color:#E1E4E8;">  	   </span><span style="color:#85E89D;">key</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&lt;string&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;">#configmap的键名称</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#22863A;">env</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&lt;string&gt;</span><span style="color:#24292E;"> </span><span style="color:#6A737D;">#要赋值的环境变量名称</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">valueFrom</span><span style="color:#24292E;">: </span><span style="color:#6A737D;">#定义变量的引|用</span></span>
<span class="line"><span style="color:#24292E;">  	</span><span style="color:#22863A;">configMapkeyRef</span><span style="color:#24292E;">: </span><span style="color:#6A737D;"># 变量来自于configmap对象</span></span>
<span class="line"><span style="color:#24292E;">  	   </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&lt;string&gt;</span><span style="color:#24292E;"> </span><span style="color:#6A737D;">#configmap对象的名称（因为有很多configmap,需要指定具体的名称)</span></span>
<span class="line"><span style="color:#24292E;">  	   </span><span style="color:#22863A;">key</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&lt;string&gt;</span><span style="color:#24292E;"> </span><span style="color:#6A737D;">#configmap的键名称</span></span></code></pre></div><div class="warning custom-block"><p class="custom-block-title">💡 说明</p><p>这种⽅式赋值环境变量与直接赋值环境变量⽅式并⽆区别，它们都可以⽤于容器的启动脚本或直接传递给容器应⽤等</p></div><h4 id="案例1" tabindex="-1">案例1 <a class="header-anchor" href="#案例1" aria-label="Permalink to &quot;案例1&quot;">​</a></h4><p>demoapp容器⽀持通过环境变量 <code>HOST</code>、<code>PORT</code> 为其指定监听的地址和端⼝</p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">[</span><span style="color:#9ECBFF;">root@kube-master configmaps</span><span style="color:#E1E4E8;">]# </span><span style="color:#9ECBFF;">cat demo.yaml</span></span>
<span class="line"><span style="color:#85E89D;">apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">v1</span></span>
<span class="line"><span style="color:#85E89D;">kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">ConfigMap</span></span>
<span class="line"><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">busybox-httpd-config</span></span>
<span class="line"><span style="color:#85E89D;">data</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">http_port</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;8080&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">verbose_level</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;-vv&quot;</span></span>
<span class="line"><span style="color:#B392F0;">---</span></span>
<span class="line"><span style="color:#85E89D;">apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">v1</span></span>
<span class="line"><span style="color:#85E89D;">kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Pod</span></span>
<span class="line"><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">configmap-env-demo</span></span>
<span class="line"><span style="color:#85E89D;">spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">containers</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  - </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">demo-configmap</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">image</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">registry.cn-zhangjiakou.aliyuncs.com/hsuing/demoapp:v1</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">env</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    - </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">PORT</span><span style="color:#E1E4E8;">   </span><span style="color:#6A737D;"># PORT变量名</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">valueFrom</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">configMapKeyRef</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">busybox-httpd-config</span><span style="color:#E1E4E8;">	 </span><span style="color:#6A737D;"># 引⽤dbusybox-httpd-config资源中的http_port</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#85E89D;">key</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">http_port</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">[</span><span style="color:#032F62;">root@kube-master configmaps</span><span style="color:#24292E;">]# </span><span style="color:#032F62;">cat demo.yaml</span></span>
<span class="line"><span style="color:#22863A;">apiVersion</span><span style="color:#24292E;">: </span><span style="color:#032F62;">v1</span></span>
<span class="line"><span style="color:#22863A;">kind</span><span style="color:#24292E;">: </span><span style="color:#032F62;">ConfigMap</span></span>
<span class="line"><span style="color:#22863A;">metadata</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">busybox-httpd-config</span></span>
<span class="line"><span style="color:#22863A;">data</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">http_port</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;8080&quot;</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">verbose_level</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;-vv&quot;</span></span>
<span class="line"><span style="color:#6F42C1;">---</span></span>
<span class="line"><span style="color:#22863A;">apiVersion</span><span style="color:#24292E;">: </span><span style="color:#032F62;">v1</span></span>
<span class="line"><span style="color:#22863A;">kind</span><span style="color:#24292E;">: </span><span style="color:#032F62;">Pod</span></span>
<span class="line"><span style="color:#22863A;">metadata</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">configmap-env-demo</span></span>
<span class="line"><span style="color:#22863A;">spec</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">containers</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">demo-configmap</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">image</span><span style="color:#24292E;">: </span><span style="color:#032F62;">registry.cn-zhangjiakou.aliyuncs.com/hsuing/demoapp:v1</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">env</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">PORT</span><span style="color:#24292E;">   </span><span style="color:#6A737D;"># PORT变量名</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">valueFrom</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">configMapKeyRef</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">busybox-httpd-config</span><span style="color:#24292E;">	 </span><span style="color:#6A737D;"># 引⽤dbusybox-httpd-config资源中的http_port</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#22863A;">key</span><span style="color:#24292E;">: </span><span style="color:#032F62;">http_port</span></span></code></pre></div><div class="danger custom-block"><p class="custom-block-title">❌ 注意</p><p>在 command 或 args 字段中引用环境变量要使用 &quot;$(VAR_NAME)&quot; 的格式</p></div><ul><li>验证</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">[root@kube-master configmaps]# kubectl exec  configmap-env-demo -- netstat -lntp</span></span>
<span class="line"><span style="color:#B392F0;">Active</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Internet</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">connections</span><span style="color:#E1E4E8;"> (only </span><span style="color:#9ECBFF;">servers</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#B392F0;">Proto</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Recv-Q</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Send-Q</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Local</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Address</span><span style="color:#E1E4E8;">           </span><span style="color:#9ECBFF;">Foreign</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Address</span><span style="color:#E1E4E8;">         </span><span style="color:#9ECBFF;">State</span><span style="color:#E1E4E8;">       </span><span style="color:#9ECBFF;">PID/Program</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">name</span></span>
<span class="line"><span style="color:#B392F0;">tcp</span><span style="color:#E1E4E8;">        </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">      </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0.0</span><span style="color:#9ECBFF;">.0.0:8080</span><span style="color:#E1E4E8;">            </span><span style="color:#79B8FF;">0.0</span><span style="color:#9ECBFF;">.0.0:</span><span style="color:#79B8FF;">*</span><span style="color:#E1E4E8;">               </span><span style="color:#9ECBFF;">LISTEN</span><span style="color:#E1E4E8;">      </span><span style="color:#79B8FF;">1</span><span style="color:#9ECBFF;">/python3</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">[root@kube-master configmaps]# kubectl exec  configmap-env-demo -- netstat -lntp</span></span>
<span class="line"><span style="color:#6F42C1;">Active</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Internet</span><span style="color:#24292E;"> </span><span style="color:#032F62;">connections</span><span style="color:#24292E;"> (only </span><span style="color:#032F62;">servers</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#6F42C1;">Proto</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Recv-Q</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Send-Q</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Local</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Address</span><span style="color:#24292E;">           </span><span style="color:#032F62;">Foreign</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Address</span><span style="color:#24292E;">         </span><span style="color:#032F62;">State</span><span style="color:#24292E;">       </span><span style="color:#032F62;">PID/Program</span><span style="color:#24292E;"> </span><span style="color:#032F62;">name</span></span>
<span class="line"><span style="color:#6F42C1;">tcp</span><span style="color:#24292E;">        </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">      </span><span style="color:#005CC5;">0</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0.0</span><span style="color:#032F62;">.0.0:8080</span><span style="color:#24292E;">            </span><span style="color:#005CC5;">0.0</span><span style="color:#032F62;">.0.0:</span><span style="color:#005CC5;">*</span><span style="color:#24292E;">               </span><span style="color:#032F62;">LISTEN</span><span style="color:#24292E;">      </span><span style="color:#005CC5;">1</span><span style="color:#032F62;">/python3</span></span></code></pre></div><div class="danger custom-block"><p class="custom-block-title">❌ 注意</p><p>被引⽤的ConfigMap资源必须事先存在，否则⽆法在Pod对象中引⽤ConfigMap资源，另外ConfigMap属于名称空间级别的资源，它必须与引⽤它的Pod资源在同⼀名称空间</p></div><h4 id="案例2" tabindex="-1">案例2 <a class="header-anchor" href="#案例2" aria-label="Permalink to &quot;案例2&quot;">​</a></h4><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">[</span><span style="color:#9ECBFF;">root@kube-master configmaps</span><span style="color:#E1E4E8;">]# </span><span style="color:#9ECBFF;">cat cm-var.yaml</span></span>
<span class="line"><span style="color:#85E89D;">apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">v1</span></span>
<span class="line"><span style="color:#85E89D;">kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">ConfigMap</span></span>
<span class="line"><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">my-configmap</span></span>
<span class="line"><span style="color:#85E89D;">data</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">special.host</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">172.168.1.1</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">special.type</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">world</span></span>
<span class="line"><span style="color:#B392F0;">---</span></span>
<span class="line"><span style="color:#85E89D;">apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">v1</span></span>
<span class="line"><span style="color:#85E89D;">kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Pod</span></span>
<span class="line"><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">demo-cm-pod</span></span>
<span class="line"><span style="color:#85E89D;">spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">containers</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  - </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">buxybox</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">image</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">busybox:latest</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">command</span><span style="color:#E1E4E8;">: [</span><span style="color:#9ECBFF;">&quot;sh&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&quot;-c&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&quot;echo $(SPECIAL_HOST) $(SPECIAL_TYPE)&quot;</span><span style="color:#E1E4E8;">]</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">env</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      - </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">SPECIAL_HOST</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">valueFrom</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#85E89D;">configMapKeyRef</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">my-configmap</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#85E89D;">key</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">special.host</span></span>
<span class="line"><span style="color:#E1E4E8;">      - </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">SPECIAL_TYPE</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">valueFrom</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#85E89D;">configMapKeyRef</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">my-configmap</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#85E89D;">key</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">special.type</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">[</span><span style="color:#032F62;">root@kube-master configmaps</span><span style="color:#24292E;">]# </span><span style="color:#032F62;">cat cm-var.yaml</span></span>
<span class="line"><span style="color:#22863A;">apiVersion</span><span style="color:#24292E;">: </span><span style="color:#032F62;">v1</span></span>
<span class="line"><span style="color:#22863A;">kind</span><span style="color:#24292E;">: </span><span style="color:#032F62;">ConfigMap</span></span>
<span class="line"><span style="color:#22863A;">metadata</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">my-configmap</span></span>
<span class="line"><span style="color:#22863A;">data</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">special.host</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">172.168.1.1</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">special.type</span><span style="color:#24292E;">: </span><span style="color:#032F62;">world</span></span>
<span class="line"><span style="color:#6F42C1;">---</span></span>
<span class="line"><span style="color:#22863A;">apiVersion</span><span style="color:#24292E;">: </span><span style="color:#032F62;">v1</span></span>
<span class="line"><span style="color:#22863A;">kind</span><span style="color:#24292E;">: </span><span style="color:#032F62;">Pod</span></span>
<span class="line"><span style="color:#22863A;">metadata</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">demo-cm-pod</span></span>
<span class="line"><span style="color:#22863A;">spec</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">containers</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">buxybox</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">image</span><span style="color:#24292E;">: </span><span style="color:#032F62;">busybox:latest</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">command</span><span style="color:#24292E;">: [</span><span style="color:#032F62;">&quot;sh&quot;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;-c&quot;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;echo $(SPECIAL_HOST) $(SPECIAL_TYPE)&quot;</span><span style="color:#24292E;">]</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">env</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">SPECIAL_HOST</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">valueFrom</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#22863A;">configMapKeyRef</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">my-configmap</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#22863A;">key</span><span style="color:#24292E;">: </span><span style="color:#032F62;">special.host</span></span>
<span class="line"><span style="color:#24292E;">      - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">SPECIAL_TYPE</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">valueFrom</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#22863A;">configMapKeyRef</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">my-configmap</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#22863A;">key</span><span style="color:#24292E;">: </span><span style="color:#032F62;">special.type</span></span></code></pre></div><ul><li>验证结果</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">[root@kube-master configmaps]# kubectl logs  demo-cm-pod</span></span>
<span class="line"><span style="color:#B392F0;">172.168.1.1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">world</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">[root@kube-master configmaps]# kubectl logs  demo-cm-pod</span></span>
<span class="line"><span style="color:#6F42C1;">172.168.1.1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">world</span></span></code></pre></div><h2 id="_3-2-通过卷挂载方式引用cm" tabindex="-1">3.2 通过卷挂载⽅式引⽤CM <a class="header-anchor" href="#_3-2-通过卷挂载方式引用cm" aria-label="Permalink to &quot;3.2 通过卷挂载⽅式引⽤CM&quot;">​</a></h2><p>帮助</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">explain</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pod.spec.containers.volumeMounts</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">explain</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pod.spec.containers.volumeMounts</span></span></code></pre></div><h3 id="引用整个存储卷" tabindex="-1">引⽤整个存储卷 <a class="header-anchor" href="#引用整个存储卷" aria-label="Permalink to &quot;引⽤整个存储卷&quot;">​</a></h3><ul><li>创建cm</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">create</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">cm</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">nginx-conf</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--from-file=nginx.conf</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;"> </span><span style="color:#6F42C1;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">create</span><span style="color:#24292E;"> </span><span style="color:#032F62;">cm</span><span style="color:#24292E;"> </span><span style="color:#032F62;">nginx-conf</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--from-file=nginx.conf</span></span></code></pre></div><ul><li>创建deploy</li></ul><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#85E89D;">apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">apps/v1</span></span>
<span class="line"><span style="color:#85E89D;">kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Deployment</span></span>
<span class="line"><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">my-cm-deployment</span></span>
<span class="line"><span style="color:#85E89D;">spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">replicas</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">1</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">selector</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">matchLabels</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">app</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">my-cm-app</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">template</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">labels</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">app</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">my-cm-app</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">volumes</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      - </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">my-cm-volume</span><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;"># name of the volume</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">configMap</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">nginx-conf</span><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;"># name of the ConfigMap object</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">containers</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      - </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">my-cm-container</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">image</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">nginx:latest</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">ports</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">        - </span><span style="color:#85E89D;">containerPort</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">80</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">volumeMounts</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">        - </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">my-cm-volume</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#85E89D;">mountPath</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">/usr/share/nginx/html/</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;">#容器挂载的目录（空的）,这个方式会覆盖这个目录下原有的文件</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#22863A;">apiVersion</span><span style="color:#24292E;">: </span><span style="color:#032F62;">apps/v1</span></span>
<span class="line"><span style="color:#22863A;">kind</span><span style="color:#24292E;">: </span><span style="color:#032F62;">Deployment</span></span>
<span class="line"><span style="color:#22863A;">metadata</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">my-cm-deployment</span></span>
<span class="line"><span style="color:#22863A;">spec</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">replicas</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">1</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">selector</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">matchLabels</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">app</span><span style="color:#24292E;">: </span><span style="color:#032F62;">my-cm-app</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">template</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">metadata</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">labels</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">app</span><span style="color:#24292E;">: </span><span style="color:#032F62;">my-cm-app</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">spec</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">volumes</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">my-cm-volume</span><span style="color:#24292E;">  </span><span style="color:#6A737D;"># name of the volume</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">configMap</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">nginx-conf</span><span style="color:#24292E;">  </span><span style="color:#6A737D;"># name of the ConfigMap object</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">containers</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">my-cm-container</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">image</span><span style="color:#24292E;">: </span><span style="color:#032F62;">nginx:latest</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">ports</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">        - </span><span style="color:#22863A;">containerPort</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">80</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">volumeMounts</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">        - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">my-cm-volume</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#22863A;">mountPath</span><span style="color:#24292E;">: </span><span style="color:#032F62;">/usr/share/nginx/html/</span><span style="color:#24292E;"> </span><span style="color:#6A737D;">#容器挂载的目录（空的）,这个方式会覆盖这个目录下原有的文件</span></span></code></pre></div><ul><li>执行</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">[root@kube-master volumeMounts]# kubectl apply -f demo.yaml</span></span>
<span class="line"><span style="color:#B392F0;">deployment.apps/my-cm-deployment</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">created</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">[root@kube-master volumeMounts]# kubectl apply -f demo.yaml</span></span>
<span class="line"><span style="color:#6F42C1;">deployment.apps/my-cm-deployment</span><span style="color:#24292E;"> </span><span style="color:#032F62;">created</span></span></code></pre></div><ul><li>验证效果</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">[root@kube-master volumeMounts]# kubectl exec -it my-cm-deployment-588bd59774-42wsw -- ls /usr/share/nginx/html/</span></span>
<span class="line"><span style="color:#B392F0;">nginx.conf</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">[root@kube-master volumeMounts]# kubectl exec -it my-cm-deployment-588bd59774-42wsw -- ls /usr/share/nginx/html/</span></span>
<span class="line"><span style="color:#6F42C1;">nginx.conf</span></span></code></pre></div><h3 id="引用存储卷部分键值-itmes" tabindex="-1">引⽤存储卷部分键值(itmes) <a class="header-anchor" href="#引用存储卷部分键值-itmes" aria-label="Permalink to &quot;引⽤存储卷部分键值(itmes)&quot;">​</a></h3><p><code>configmap基于目录创建的时候可以使用itmes，调用部分值</code></p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#85E89D;">apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">v1</span></span>
<span class="line"><span style="color:#85E89D;">kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Pod</span></span>
<span class="line"><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">configmap-volume-demo-2</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">namespace</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">default</span></span>
<span class="line"><span style="color:#85E89D;">spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">volumes</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  - </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">ngxconfig</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">configMap</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">nginx-config-files</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">items</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      - </span><span style="color:#85E89D;">key</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">myserver.conf</span><span style="color:#E1E4E8;">   </span><span style="color:#6A737D;"># 要引⽤的键名称（必写）</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">path</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">myserver.conf</span><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;"># 挂载进 pod 后的文件名（必写）</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">mode</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">0644</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">items</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      - </span><span style="color:#85E89D;">key</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">youserver.conf</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">path</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">youserver.conf</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">mode</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">0644</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">containers</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  - </span><span style="color:#85E89D;">image</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">nginx:alpine</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">nginx-server</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">volumeMounts</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    - </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">ngxconfig</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">mountPath</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">/etc/nginx/conf.d/</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">readOnly</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">true</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#22863A;">apiVersion</span><span style="color:#24292E;">: </span><span style="color:#032F62;">v1</span></span>
<span class="line"><span style="color:#22863A;">kind</span><span style="color:#24292E;">: </span><span style="color:#032F62;">Pod</span></span>
<span class="line"><span style="color:#22863A;">metadata</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">configmap-volume-demo-2</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">namespace</span><span style="color:#24292E;">: </span><span style="color:#032F62;">default</span></span>
<span class="line"><span style="color:#22863A;">spec</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">volumes</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">ngxconfig</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">configMap</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">nginx-config-files</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">items</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      - </span><span style="color:#22863A;">key</span><span style="color:#24292E;">: </span><span style="color:#032F62;">myserver.conf</span><span style="color:#24292E;">   </span><span style="color:#6A737D;"># 要引⽤的键名称（必写）</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">path</span><span style="color:#24292E;">: </span><span style="color:#032F62;">myserver.conf</span><span style="color:#24292E;">  </span><span style="color:#6A737D;"># 挂载进 pod 后的文件名（必写）</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">mode</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">0644</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">items</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      - </span><span style="color:#22863A;">key</span><span style="color:#24292E;">: </span><span style="color:#032F62;">youserver.conf</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">path</span><span style="color:#24292E;">: </span><span style="color:#032F62;">youserver.conf</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">mode</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">0644</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">containers</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  - </span><span style="color:#22863A;">image</span><span style="color:#24292E;">: </span><span style="color:#032F62;">nginx:alpine</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">nginx-server</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">volumeMounts</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">ngxconfig</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">mountPath</span><span style="color:#24292E;">: </span><span style="color:#032F62;">/etc/nginx/conf.d/</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">readOnly</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">true</span></span></code></pre></div><h3 id="引用存储卷单个键值" tabindex="-1">引⽤存储卷单个键值 <a class="header-anchor" href="#引用存储卷单个键值" aria-label="Permalink to &quot;引⽤存储卷单个键值&quot;">​</a></h3><p>前⾯两种⽅式中，⽆论是装在ConfigMap对象中的所有⽂件还是部分⽂件，挂载点⽬录下原有的⽂件都会被隐藏</p><p>对于期望将 ConfigMap 对象提供的配置文件补充于挂载点目录下，并且不影响原本就存在的一些文件，这种方式就可以满足需求。</p><p>使用容器的 volumeMounts 字段中使用的 <code>subPath</code> 字段来解决，它可以支持用户从存储卷挂载单个文件或单个目录而非整个存储卷</p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#85E89D;">apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">v1</span></span>
<span class="line"><span style="color:#85E89D;">kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Pod</span></span>
<span class="line"><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">configmap-volume-demo-3</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">namespace</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">default</span></span>
<span class="line"><span style="color:#85E89D;">spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">containers</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  - </span><span style="color:#85E89D;">image</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">nginx:alpine</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">nginx-server</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">volumeMounts</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    - </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">ngxconfig</span><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;">#ConfigMap 的 Key 名称</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">mountPath</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">/etc/nginx/conf.d/myserver.conf</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">subPath</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">myserver.conf</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">readOnly</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">true</span></span>
<span class="line"><span style="color:#E1E4E8;">    - </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">ngxconfig</span><span style="color:#E1E4E8;">   </span><span style="color:#6A737D;">#ConfigMap 的 Key 名称</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">mountPath</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">/etc/nginx/conf.d/yourserver.conf</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;">#挂载之后的名字</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">subPath</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">yourserver.conf</span><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;">#configmaps 中key</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">readOnly</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">true</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">volumes</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  - </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">ngxconfig</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">configMap</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">nginx-config-files</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#22863A;">apiVersion</span><span style="color:#24292E;">: </span><span style="color:#032F62;">v1</span></span>
<span class="line"><span style="color:#22863A;">kind</span><span style="color:#24292E;">: </span><span style="color:#032F62;">Pod</span></span>
<span class="line"><span style="color:#22863A;">metadata</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">configmap-volume-demo-3</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">namespace</span><span style="color:#24292E;">: </span><span style="color:#032F62;">default</span></span>
<span class="line"><span style="color:#22863A;">spec</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">containers</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  - </span><span style="color:#22863A;">image</span><span style="color:#24292E;">: </span><span style="color:#032F62;">nginx:alpine</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">nginx-server</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">volumeMounts</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">ngxconfig</span><span style="color:#24292E;">  </span><span style="color:#6A737D;">#ConfigMap 的 Key 名称</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">mountPath</span><span style="color:#24292E;">: </span><span style="color:#032F62;">/etc/nginx/conf.d/myserver.conf</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">subPath</span><span style="color:#24292E;">: </span><span style="color:#032F62;">myserver.conf</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">readOnly</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">true</span></span>
<span class="line"><span style="color:#24292E;">    - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">ngxconfig</span><span style="color:#24292E;">   </span><span style="color:#6A737D;">#ConfigMap 的 Key 名称</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">mountPath</span><span style="color:#24292E;">: </span><span style="color:#032F62;">/etc/nginx/conf.d/yourserver.conf</span><span style="color:#24292E;"> </span><span style="color:#6A737D;">#挂载之后的名字</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">subPath</span><span style="color:#24292E;">: </span><span style="color:#032F62;">yourserver.conf</span><span style="color:#24292E;">  </span><span style="color:#6A737D;">#configmaps 中key</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">readOnly</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">true</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">volumes</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">ngxconfig</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">configMap</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">nginx-config-files</span></span></code></pre></div><h1 id="_4-configmap实践" tabindex="-1">4. ConfigMap实践 <a class="header-anchor" href="#_4-configmap实践" aria-label="Permalink to &quot;4. ConfigMap实践&quot;">​</a></h1><h2 id="_4-1-挂载方式" tabindex="-1">4.1 挂载方式 <a class="header-anchor" href="#_4-1-挂载方式" aria-label="Permalink to &quot;4.1 挂载方式&quot;">​</a></h2><p>创建configmap.yaml，内容如下：</p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#85E89D;">apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">v1</span></span>
<span class="line"><span style="color:#85E89D;">kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">ConfigMap</span></span>
<span class="line"><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">configmap</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">namespace</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">dev</span></span>
<span class="line"><span style="color:#85E89D;">data</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">info</span><span style="color:#E1E4E8;">: </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#9ECBFF;">    username:admin</span></span>
<span class="line"><span style="color:#9ECBFF;">    password:123456</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#22863A;">apiVersion</span><span style="color:#24292E;">: </span><span style="color:#032F62;">v1</span></span>
<span class="line"><span style="color:#22863A;">kind</span><span style="color:#24292E;">: </span><span style="color:#032F62;">ConfigMap</span></span>
<span class="line"><span style="color:#22863A;">metadata</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">configmap</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">namespace</span><span style="color:#24292E;">: </span><span style="color:#032F62;">dev</span></span>
<span class="line"><span style="color:#22863A;">data</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">info</span><span style="color:#24292E;">: </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#032F62;">    username:admin</span></span>
<span class="line"><span style="color:#032F62;">    password:123456</span></span></code></pre></div><p>使用此配置文件创建configmap</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;"># 创建configmap</span></span>
<span class="line"><span style="color:#E1E4E8;">[root@k8s-master01 </span><span style="color:#F97583;">~</span><span style="color:#E1E4E8;">]# kubectl create -f configmap.yaml</span></span>
<span class="line"><span style="color:#B392F0;">configmap/configmap</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">created</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 查看configmap详情</span></span>
<span class="line"><span style="color:#E1E4E8;">[root@k8s-master01 </span><span style="color:#F97583;">~</span><span style="color:#E1E4E8;">]# kubectl describe cm configmap -n dev</span></span>
<span class="line"><span style="color:#B392F0;">Name:</span><span style="color:#E1E4E8;">         </span><span style="color:#9ECBFF;">configmap</span></span>
<span class="line"><span style="color:#B392F0;">Namespace:</span><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">dev</span></span>
<span class="line"><span style="color:#B392F0;">Labels:</span><span style="color:#E1E4E8;">       </span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">non</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span></span>
<span class="line"><span style="color:#B392F0;">Annotations:</span><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">non</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">Data</span></span>
<span class="line"><span style="color:#E1E4E8;">====</span></span>
<span class="line"><span style="color:#B392F0;">info:</span></span>
<span class="line"><span style="color:#B392F0;">----</span></span>
<span class="line"><span style="color:#B392F0;">username:admin</span></span>
<span class="line"><span style="color:#B392F0;">password:123456</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">Events:</span><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">non</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;"># 创建configmap</span></span>
<span class="line"><span style="color:#24292E;">[root@k8s-master01 </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# kubectl create -f configmap.yaml</span></span>
<span class="line"><span style="color:#6F42C1;">configmap/configmap</span><span style="color:#24292E;"> </span><span style="color:#032F62;">created</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 查看configmap详情</span></span>
<span class="line"><span style="color:#24292E;">[root@k8s-master01 </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# kubectl describe cm configmap -n dev</span></span>
<span class="line"><span style="color:#6F42C1;">Name:</span><span style="color:#24292E;">         </span><span style="color:#032F62;">configmap</span></span>
<span class="line"><span style="color:#6F42C1;">Namespace:</span><span style="color:#24292E;">    </span><span style="color:#032F62;">dev</span></span>
<span class="line"><span style="color:#6F42C1;">Labels:</span><span style="color:#24292E;">       </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">non</span><span style="color:#24292E;">e</span><span style="color:#D73A49;">&gt;</span></span>
<span class="line"><span style="color:#6F42C1;">Annotations:</span><span style="color:#24292E;">  </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">non</span><span style="color:#24292E;">e</span><span style="color:#D73A49;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">Data</span></span>
<span class="line"><span style="color:#24292E;">====</span></span>
<span class="line"><span style="color:#6F42C1;">info:</span></span>
<span class="line"><span style="color:#6F42C1;">----</span></span>
<span class="line"><span style="color:#6F42C1;">username:admin</span></span>
<span class="line"><span style="color:#6F42C1;">password:123456</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">Events:</span><span style="color:#24292E;">  </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">non</span><span style="color:#24292E;">e</span><span style="color:#D73A49;">&gt;</span></span></code></pre></div><p>创建一个pod-configmap.yaml，将上面创建的configmap挂载进去</p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#85E89D;">apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">v1</span></span>
<span class="line"><span style="color:#85E89D;">kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Pod</span></span>
<span class="line"><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">pod-configmap</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">namespace</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">dev</span></span>
<span class="line"><span style="color:#85E89D;">spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">containers</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  - </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">nginx</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">image</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">nginx:1.17.1</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">volumeMounts</span><span style="color:#E1E4E8;">: </span><span style="color:#6A737D;"># 将configmap挂载到目录</span></span>
<span class="line"><span style="color:#E1E4E8;">    - </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">config</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">mountPath</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">/configmap/config</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">volumes</span><span style="color:#E1E4E8;">: </span><span style="color:#6A737D;"># 引用configmap</span></span>
<span class="line"><span style="color:#E1E4E8;">  - </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">config</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">configMap</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">configmap</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#22863A;">apiVersion</span><span style="color:#24292E;">: </span><span style="color:#032F62;">v1</span></span>
<span class="line"><span style="color:#22863A;">kind</span><span style="color:#24292E;">: </span><span style="color:#032F62;">Pod</span></span>
<span class="line"><span style="color:#22863A;">metadata</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">pod-configmap</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">namespace</span><span style="color:#24292E;">: </span><span style="color:#032F62;">dev</span></span>
<span class="line"><span style="color:#22863A;">spec</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">containers</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">nginx</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">image</span><span style="color:#24292E;">: </span><span style="color:#032F62;">nginx:1.17.1</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">volumeMounts</span><span style="color:#24292E;">: </span><span style="color:#6A737D;"># 将configmap挂载到目录</span></span>
<span class="line"><span style="color:#24292E;">    - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">config</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">mountPath</span><span style="color:#24292E;">: </span><span style="color:#032F62;">/configmap/config</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">volumes</span><span style="color:#24292E;">: </span><span style="color:#6A737D;"># 引用configmap</span></span>
<span class="line"><span style="color:#24292E;">  - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">config</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">configMap</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">configmap</span></span></code></pre></div><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;"># 创建pod</span></span>
<span class="line"><span style="color:#E1E4E8;">[root@k8s-master01 </span><span style="color:#F97583;">~</span><span style="color:#E1E4E8;">]# kubectl create -f pod-configmap.yaml</span></span>
<span class="line"><span style="color:#B392F0;">pod/pod-configmap</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">created</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 查看pod</span></span>
<span class="line"><span style="color:#E1E4E8;">[root@k8s-master01 </span><span style="color:#F97583;">~</span><span style="color:#E1E4E8;">]# kubectl get pod pod-configmap -n dev</span></span>
<span class="line"><span style="color:#B392F0;">NAME</span><span style="color:#E1E4E8;">            </span><span style="color:#9ECBFF;">READY</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">STATUS</span><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">RESTARTS</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">AGE</span></span>
<span class="line"><span style="color:#B392F0;">pod-configmap</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">1</span><span style="color:#9ECBFF;">/1</span><span style="color:#E1E4E8;">     </span><span style="color:#9ECBFF;">Running</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">          </span><span style="color:#79B8FF;">6</span><span style="color:#9ECBFF;">s</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#进入容器</span></span>
<span class="line"><span style="color:#E1E4E8;">[root@k8s-master01 </span><span style="color:#F97583;">~</span><span style="color:#E1E4E8;">]# kubectl exec -it pod-configmap -n dev /bin/sh</span></span>
<span class="line"><span style="color:#6A737D;"># cd /configmap/config/</span></span>
<span class="line"><span style="color:#6A737D;"># ls</span></span>
<span class="line"><span style="color:#B392F0;">info</span></span>
<span class="line"><span style="color:#6A737D;"># more info</span></span>
<span class="line"><span style="color:#B392F0;">username:admin</span></span>
<span class="line"><span style="color:#B392F0;">password:123456</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 可以看到映射已经成功，每个configmap都映射成了一个目录</span></span>
<span class="line"><span style="color:#6A737D;"># key---&gt;文件     value----&gt;文件中的内容</span></span>
<span class="line"><span style="color:#6A737D;"># 此时如果更新configmap的内容, 容器中的值也会动态更新</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;"># 创建pod</span></span>
<span class="line"><span style="color:#24292E;">[root@k8s-master01 </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# kubectl create -f pod-configmap.yaml</span></span>
<span class="line"><span style="color:#6F42C1;">pod/pod-configmap</span><span style="color:#24292E;"> </span><span style="color:#032F62;">created</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 查看pod</span></span>
<span class="line"><span style="color:#24292E;">[root@k8s-master01 </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# kubectl get pod pod-configmap -n dev</span></span>
<span class="line"><span style="color:#6F42C1;">NAME</span><span style="color:#24292E;">            </span><span style="color:#032F62;">READY</span><span style="color:#24292E;">   </span><span style="color:#032F62;">STATUS</span><span style="color:#24292E;">    </span><span style="color:#032F62;">RESTARTS</span><span style="color:#24292E;">   </span><span style="color:#032F62;">AGE</span></span>
<span class="line"><span style="color:#6F42C1;">pod-configmap</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">1</span><span style="color:#032F62;">/1</span><span style="color:#24292E;">     </span><span style="color:#032F62;">Running</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">          </span><span style="color:#005CC5;">6</span><span style="color:#032F62;">s</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#进入容器</span></span>
<span class="line"><span style="color:#24292E;">[root@k8s-master01 </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# kubectl exec -it pod-configmap -n dev /bin/sh</span></span>
<span class="line"><span style="color:#6A737D;"># cd /configmap/config/</span></span>
<span class="line"><span style="color:#6A737D;"># ls</span></span>
<span class="line"><span style="color:#6F42C1;">info</span></span>
<span class="line"><span style="color:#6A737D;"># more info</span></span>
<span class="line"><span style="color:#6F42C1;">username:admin</span></span>
<span class="line"><span style="color:#6F42C1;">password:123456</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 可以看到映射已经成功，每个configmap都映射成了一个目录</span></span>
<span class="line"><span style="color:#6A737D;"># key---&gt;文件     value----&gt;文件中的内容</span></span>
<span class="line"><span style="color:#6A737D;"># 此时如果更新configmap的内容, 容器中的值也会动态更新</span></span></code></pre></div><h2 id="_4-2-注入方式" tabindex="-1">4.2 注入方式 <a class="header-anchor" href="#_4-2-注入方式" aria-label="Permalink to &quot;4.2 注入方式&quot;">​</a></h2><p>1.创建configmap</p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#85E89D;">apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">v1</span></span>
<span class="line"><span style="color:#85E89D;">kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">ConfigMap</span></span>
<span class="line"><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">configmap-demo</span></span>
<span class="line"><span style="color:#85E89D;">data</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;"># 类属性键；每一个键都映射到一个简单的值</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">abc</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;123&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">cde</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;456&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;"># 类文件键</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">redis.properties</span><span style="color:#E1E4E8;">: </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#9ECBFF;">    port: 6379</span></span>
<span class="line"><span style="color:#9ECBFF;">    host: 10.100.24.71</span></span>
<span class="line"><span style="color:#9ECBFF;">    password: 123456</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#22863A;">apiVersion</span><span style="color:#24292E;">: </span><span style="color:#032F62;">v1</span></span>
<span class="line"><span style="color:#22863A;">kind</span><span style="color:#24292E;">: </span><span style="color:#032F62;">ConfigMap</span></span>
<span class="line"><span style="color:#22863A;">metadata</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">configmap-demo</span></span>
<span class="line"><span style="color:#22863A;">data</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6A737D;"># 类属性键；每一个键都映射到一个简单的值</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">abc</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;123&quot;</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">cde</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;456&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6A737D;"># 类文件键</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">redis.properties</span><span style="color:#24292E;">: </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#032F62;">    port: 6379</span></span>
<span class="line"><span style="color:#032F62;">    host: 10.100.24.71</span></span>
<span class="line"><span style="color:#032F62;">    password: 123456</span></span></code></pre></div><p>2.创建configmap中pod</p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#85E89D;">apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">v1</span></span>
<span class="line"><span style="color:#85E89D;">kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Pod</span></span>
<span class="line"><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">configmap-demo-pod</span></span>
<span class="line"><span style="color:#85E89D;">spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">containers</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    - </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">demo</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">image</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">nginx</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">env</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#6A737D;"># 定义环境变量</span></span>
<span class="line"><span style="color:#E1E4E8;">        - </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">ABC_NAME</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># 请注意这里和 ConfigMap 中的键名是不一样的</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#85E89D;">valueFrom</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#85E89D;">configMapKeyRef</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">              </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">configmap-demo</span><span style="color:#E1E4E8;">           </span><span style="color:#6A737D;"># 这个值来自 ConfigMap</span></span>
<span class="line"><span style="color:#E1E4E8;">              </span><span style="color:#85E89D;">key</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">abc</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># 需要取值的键</span></span>
<span class="line"><span style="color:#E1E4E8;">        - </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">CDE_NAME</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#85E89D;">valueFrom</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#85E89D;">configMapKeyRef</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">              </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">configmap-demo</span></span>
<span class="line"><span style="color:#E1E4E8;">              </span><span style="color:#85E89D;">key</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">cde</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">volumeMounts</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      - </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">config</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">mountPath</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;/config&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">readOnly</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">true</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">volumes</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;"># 你可以在 Pod 级别设置卷，然后将其挂载到 Pod 内的容器中</span></span>
<span class="line"><span style="color:#E1E4E8;">    - </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">config</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">configMap</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#6A737D;"># 提供你想要挂载的 ConfigMap 的名字</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">configmap-demo</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#6A737D;"># 来自 ConfigMap 的一组键，将被创建为文件</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">items</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">        - </span><span style="color:#85E89D;">key</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;redis.properties&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#85E89D;">path</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;redis.properties&quot;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#22863A;">apiVersion</span><span style="color:#24292E;">: </span><span style="color:#032F62;">v1</span></span>
<span class="line"><span style="color:#22863A;">kind</span><span style="color:#24292E;">: </span><span style="color:#032F62;">Pod</span></span>
<span class="line"><span style="color:#22863A;">metadata</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">configmap-demo-pod</span></span>
<span class="line"><span style="color:#22863A;">spec</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">containers</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">demo</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">image</span><span style="color:#24292E;">: </span><span style="color:#032F62;">nginx</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">env</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6A737D;"># 定义环境变量</span></span>
<span class="line"><span style="color:#24292E;">        - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">ABC_NAME</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 请注意这里和 ConfigMap 中的键名是不一样的</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#22863A;">valueFrom</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#22863A;">configMapKeyRef</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">              </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">configmap-demo</span><span style="color:#24292E;">           </span><span style="color:#6A737D;"># 这个值来自 ConfigMap</span></span>
<span class="line"><span style="color:#24292E;">              </span><span style="color:#22863A;">key</span><span style="color:#24292E;">: </span><span style="color:#032F62;">abc</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 需要取值的键</span></span>
<span class="line"><span style="color:#24292E;">        - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">CDE_NAME</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#22863A;">valueFrom</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#22863A;">configMapKeyRef</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">              </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">configmap-demo</span></span>
<span class="line"><span style="color:#24292E;">              </span><span style="color:#22863A;">key</span><span style="color:#24292E;">: </span><span style="color:#032F62;">cde</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">volumeMounts</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">config</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">mountPath</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;/config&quot;</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">readOnly</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">true</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">volumes</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;"># 你可以在 Pod 级别设置卷，然后将其挂载到 Pod 内的容器中</span></span>
<span class="line"><span style="color:#24292E;">    - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">config</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">configMap</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6A737D;"># 提供你想要挂载的 ConfigMap 的名字</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">configmap-demo</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6A737D;"># 来自 ConfigMap 的一组键，将被创建为文件</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">items</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">        - </span><span style="color:#22863A;">key</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;redis.properties&quot;</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#22863A;">path</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;redis.properties&quot;</span></span></code></pre></div><h2 id="_4-3-from-file" tabindex="-1">4.3 from-file <a class="header-anchor" href="#_4-3-from-file" aria-label="Permalink to &quot;4.3 from-file&quot;">​</a></h2><p>--from-file 指定在目录下的所有文件都会被用在 ConfigMap 里面创建一个键值对，键的名字就是文件名，值就</p><p>是文件的内容</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">cat</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/root/yaml/configmaps/docs/ui.properties</span></span>
<span class="line"><span style="color:#B392F0;">color.good</span><span style="color:#E1E4E8;">=purple</span></span>
<span class="line"><span style="color:#B392F0;">color.bad</span><span style="color:#E1E4E8;">=yellow</span></span>
<span class="line"><span style="color:#B392F0;">allow.textmode</span><span style="color:#E1E4E8;">=</span><span style="color:#79B8FF;">true</span></span>
<span class="line"><span style="color:#B392F0;">how.nice.to.look</span><span style="color:#E1E4E8;">=fairlyNice</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">cat</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/root/yaml/configmaps/docs/ui.properties</span></span>
<span class="line"><span style="color:#6F42C1;">color.good</span><span style="color:#24292E;">=purple</span></span>
<span class="line"><span style="color:#6F42C1;">color.bad</span><span style="color:#24292E;">=yellow</span></span>
<span class="line"><span style="color:#6F42C1;">allow.textmode</span><span style="color:#24292E;">=</span><span style="color:#005CC5;">true</span></span>
<span class="line"><span style="color:#6F42C1;">how.nice.to.look</span><span style="color:#24292E;">=fairlyNice</span></span></code></pre></div><ul><li>创建from-file</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">create</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">configmap</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">game-config</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--from-file=/root/yaml/configmaps/docs</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">create</span><span style="color:#24292E;"> </span><span style="color:#032F62;">configmap</span><span style="color:#24292E;"> </span><span style="color:#032F62;">game-config</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--from-file=/root/yaml/configmaps/docs</span></span></code></pre></div><ul><li>查看</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">[root@kube-master docs]# kubectl get configmaps game-config  -oyaml</span></span>
<span class="line"><span style="color:#B392F0;">apiVersion:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">v1</span></span>
<span class="line"><span style="color:#B392F0;">data:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">ui.properties:</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">color.good</span><span style="color:#E1E4E8;">=purple</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">color.bad</span><span style="color:#E1E4E8;">=yellow</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">allow.textmode</span><span style="color:#E1E4E8;">=</span><span style="color:#79B8FF;">true</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">how.nice.to.look</span><span style="color:#E1E4E8;">=fairlyNice</span></span>
<span class="line"><span style="color:#B392F0;">kind:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">ConfigMap</span></span>
<span class="line"><span style="color:#B392F0;">metadata:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">creationTimestamp:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;2024-08-09T05:57:51Z&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">name:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">game-config</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">namespace:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">default</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">resourceVersion:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;5081904&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">uid:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">e0da43a5-7405-4356-9da9-23797037f4f0</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">[root@kube-master docs]# kubectl get configmaps game-config  -oyaml</span></span>
<span class="line"><span style="color:#6F42C1;">apiVersion:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">v1</span></span>
<span class="line"><span style="color:#6F42C1;">data:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">ui.properties:</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">color.good</span><span style="color:#24292E;">=purple</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">color.bad</span><span style="color:#24292E;">=yellow</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">allow.textmode</span><span style="color:#24292E;">=</span><span style="color:#005CC5;">true</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">how.nice.to.look</span><span style="color:#24292E;">=fairlyNice</span></span>
<span class="line"><span style="color:#6F42C1;">kind:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">ConfigMap</span></span>
<span class="line"><span style="color:#6F42C1;">metadata:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">creationTimestamp:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;2024-08-09T05:57:51Z&quot;</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">name:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">game-config</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">namespace:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">default</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">resourceVersion:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;5081904&quot;</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">uid:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">e0da43a5-7405-4356-9da9-23797037f4f0</span></span></code></pre></div><ul><li>引用</li></ul><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#85E89D;">apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">v1</span></span>
<span class="line"><span style="color:#85E89D;">kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Pod</span></span>
<span class="line"><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">dapi-test-pod</span></span>
<span class="line"><span style="color:#85E89D;">spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">containers</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  - </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">test-container</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">image</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">wangyanglinux/myapp:v1</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">command</span><span style="color:#E1E4E8;">: [ </span><span style="color:#9ECBFF;">&quot;/bin/sh&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&quot;-c&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&quot;env&quot;</span><span style="color:#E1E4E8;"> ]</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">env</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      - </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">SPECIAL_LEVEL_KEY</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">valueFrom</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#85E89D;">configMapKeyRef</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">special-config</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># 导入special-config这个configmap</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#85E89D;">key</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">special.how</span><span style="color:#E1E4E8;"> </span></span>
<span class="line"><span style="color:#E1E4E8;">      - </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">SPECIAL_TYPE_KEY</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">valueFrom</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#85E89D;">configMapKeyRef</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">special-config</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#85E89D;">key</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">special.type</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">envFrom</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      - </span><span style="color:#85E89D;">configMapRef</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">env-config</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;">#导入env-config这个configmap</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">restartPolicy</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Never</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#22863A;">apiVersion</span><span style="color:#24292E;">: </span><span style="color:#032F62;">v1</span></span>
<span class="line"><span style="color:#22863A;">kind</span><span style="color:#24292E;">: </span><span style="color:#032F62;">Pod</span></span>
<span class="line"><span style="color:#22863A;">metadata</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">dapi-test-pod</span></span>
<span class="line"><span style="color:#22863A;">spec</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">containers</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">test-container</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">image</span><span style="color:#24292E;">: </span><span style="color:#032F62;">wangyanglinux/myapp:v1</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">command</span><span style="color:#24292E;">: [ </span><span style="color:#032F62;">&quot;/bin/sh&quot;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;-c&quot;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;env&quot;</span><span style="color:#24292E;"> ]</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">env</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">SPECIAL_LEVEL_KEY</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">valueFrom</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#22863A;">configMapKeyRef</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">special-config</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 导入special-config这个configmap</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#22863A;">key</span><span style="color:#24292E;">: </span><span style="color:#032F62;">special.how</span><span style="color:#24292E;"> </span></span>
<span class="line"><span style="color:#24292E;">      - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">SPECIAL_TYPE_KEY</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">valueFrom</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#22863A;">configMapKeyRef</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">special-config</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#22863A;">key</span><span style="color:#24292E;">: </span><span style="color:#032F62;">special.type</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">envFrom</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      - </span><span style="color:#22863A;">configMapRef</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">env-config</span><span style="color:#24292E;"> </span><span style="color:#6A737D;">#导入env-config这个configmap</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">restartPolicy</span><span style="color:#24292E;">: </span><span style="color:#032F62;">Never</span></span></code></pre></div><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">#设置命令行参数</span></span>
<span class="line"><span style="color:#E1E4E8;">[</span><span style="color:#9ECBFF;">root@k8s-master01 docs</span><span style="color:#E1E4E8;">]# </span><span style="color:#9ECBFF;">cat pod2.yaml</span><span style="color:#E1E4E8;"> </span></span>
<span class="line"><span style="color:#85E89D;">apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">v1</span></span>
<span class="line"><span style="color:#85E89D;">kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Pod</span></span>
<span class="line"><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">pod-dir</span></span>
<span class="line"><span style="color:#85E89D;">spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">containers</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  - </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">test-container</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">image</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">wangyanglinux/myapp:v1</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">command</span><span style="color:#E1E4E8;">: [ </span><span style="color:#9ECBFF;">&quot;/bin/sh&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&quot;-c&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&quot;echo $(SPECIAL_LEVEL_KEY) $(SPECIAL_TYPE_KEY)&quot;</span><span style="color:#E1E4E8;"> ]</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">env</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      - </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">SPECIAL_LEVEL_KEY</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">valueFrom</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#85E89D;">configMapKeyRef</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">special-config</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#85E89D;">key</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">special.how</span></span>
<span class="line"><span style="color:#E1E4E8;">      - </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">SPECIAL_TYPE_KEY</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">valueFrom</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#85E89D;">configMapKeyRef</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">special-config</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#85E89D;">key</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">special.type</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">restartPolicy</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Never</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">#设置命令行参数</span></span>
<span class="line"><span style="color:#24292E;">[</span><span style="color:#032F62;">root@k8s-master01 docs</span><span style="color:#24292E;">]# </span><span style="color:#032F62;">cat pod2.yaml</span><span style="color:#24292E;"> </span></span>
<span class="line"><span style="color:#22863A;">apiVersion</span><span style="color:#24292E;">: </span><span style="color:#032F62;">v1</span></span>
<span class="line"><span style="color:#22863A;">kind</span><span style="color:#24292E;">: </span><span style="color:#032F62;">Pod</span></span>
<span class="line"><span style="color:#22863A;">metadata</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">pod-dir</span></span>
<span class="line"><span style="color:#22863A;">spec</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">containers</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">test-container</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">image</span><span style="color:#24292E;">: </span><span style="color:#032F62;">wangyanglinux/myapp:v1</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">command</span><span style="color:#24292E;">: [ </span><span style="color:#032F62;">&quot;/bin/sh&quot;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;-c&quot;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;echo $(SPECIAL_LEVEL_KEY) $(SPECIAL_TYPE_KEY)&quot;</span><span style="color:#24292E;"> ]</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">env</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">SPECIAL_LEVEL_KEY</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">valueFrom</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#22863A;">configMapKeyRef</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">special-config</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#22863A;">key</span><span style="color:#24292E;">: </span><span style="color:#032F62;">special.how</span></span>
<span class="line"><span style="color:#24292E;">      - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">SPECIAL_TYPE_KEY</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">valueFrom</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#22863A;">configMapKeyRef</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">special-config</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#22863A;">key</span><span style="color:#24292E;">: </span><span style="color:#032F62;">special.type</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">restartPolicy</span><span style="color:#24292E;">: </span><span style="color:#032F62;">Never</span></span></code></pre></div><h2 id="_4-3-configmap热更" tabindex="-1">4.3 configMap热更 <a class="header-anchor" href="#_4-3-configmap热更" aria-label="Permalink to &quot;4.3 configMap热更&quot;">​</a></h2><p>等待大概 10 秒钟时间，再次查看环境变量的值</p><h1 id="_5-configmap和secret总结" tabindex="-1">5. configmap和secret总结 <a class="header-anchor" href="#_5-configmap和secret总结" aria-label="Permalink to &quot;5. configmap和secret总结&quot;">​</a></h1><ul><li><p>configmap</p><p>主要应用一些配置文件的存储，程序的配置文件替换等</p></li><li><p>secret</p><p>主要存储一些存储镜像仓库认证信息，存储密码、密钥，TLS证书等</p></li><li><p>应用程序动态更新配置方案： 当ConfigMap发生变更时，应用程序自动感知动态加载（需要程序自身支持） 触发滚动更新，即重启服务</p></li></ul>`,110),e=[o];function c(t,r,E,y,i,F){return n(),a("div",null,e)}const g=s(l,[["render",c]]);export{m as __pageData,g as default};
