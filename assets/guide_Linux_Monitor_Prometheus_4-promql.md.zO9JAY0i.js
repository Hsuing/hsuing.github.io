import{_ as s,o as a,c as n,R as o}from"./chunks/framework.zUbWieqp.js";const h=JSON.parse('{"title":"1. promtool介绍","description":"","frontmatter":{},"headers":[],"relativePath":"guide/Linux/Monitor/Prometheus/4-promql.md","filePath":"guide/Linux/Monitor/Prometheus/4-promql.md","lastUpdated":1735898224000}'),p={name:"guide/Linux/Monitor/Prometheus/4-promql.md"},l=o(`<p>官当-<a href="https://prometheus.io/docs/prometheus/2.55/querying/functions/" target="_blank" rel="noreferrer">函数</a></p><h1 id="_1-promtool介绍" tabindex="-1">1. promtool介绍 <a class="header-anchor" href="#_1-promtool介绍" aria-label="Permalink to &quot;1. promtool介绍&quot;">​</a></h1><p>检查yaml<a href="https://yaml.org/" target="_blank" rel="noreferrer">语法</a> 和查询</p><h2 id="_1-1-检查配置" tabindex="-1">1.1 检查配置 <a class="header-anchor" href="#_1-1-检查配置" aria-label="Permalink to &quot;1.1 检查配置&quot;">​</a></h2><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">/etc/prometheus</span><span style="color:#E1E4E8;"> $ </span><span style="color:#9ECBFF;">promtool</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">check</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">config</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">prometheus.yml</span></span>
<span class="line"><span style="color:#B392F0;">Checking</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">prometheus.yml</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">SUCCESS:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">rule</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">files</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">found</span></span>
<span class="line"><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">SUCCESS:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">prometheus.yml</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">is</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">valid</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">prometheus</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">config</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">file</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">syntax</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">Checking</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/opt/prometheus/rules/text.yml</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">SUCCESS:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">rules</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">found</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">/etc/prometheus</span><span style="color:#24292E;"> $ </span><span style="color:#032F62;">promtool</span><span style="color:#24292E;"> </span><span style="color:#032F62;">check</span><span style="color:#24292E;"> </span><span style="color:#032F62;">config</span><span style="color:#24292E;"> </span><span style="color:#032F62;">prometheus.yml</span></span>
<span class="line"><span style="color:#6F42C1;">Checking</span><span style="color:#24292E;"> </span><span style="color:#032F62;">prometheus.yml</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">SUCCESS:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">rule</span><span style="color:#24292E;"> </span><span style="color:#032F62;">files</span><span style="color:#24292E;"> </span><span style="color:#032F62;">found</span></span>
<span class="line"><span style="color:#24292E;"> </span><span style="color:#6F42C1;">SUCCESS:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">prometheus.yml</span><span style="color:#24292E;"> </span><span style="color:#032F62;">is</span><span style="color:#24292E;"> </span><span style="color:#032F62;">valid</span><span style="color:#24292E;"> </span><span style="color:#032F62;">prometheus</span><span style="color:#24292E;"> </span><span style="color:#032F62;">config</span><span style="color:#24292E;"> </span><span style="color:#032F62;">file</span><span style="color:#24292E;"> </span><span style="color:#032F62;">syntax</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">Checking</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/opt/prometheus/rules/text.yml</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">SUCCESS:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">rules</span><span style="color:#24292E;"> </span><span style="color:#032F62;">found</span></span></code></pre></div><h2 id="_1-2-查询" tabindex="-1">1.2 查询 <a class="header-anchor" href="#_1-2-查询" aria-label="Permalink to &quot;1.2 查询&quot;">​</a></h2><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">#由于我这里做了代理，需要添加/prometheus,才能查到数据，默认不用添加</span></span>
<span class="line"><span style="color:#E1E4E8;">$promtool query instant http://127.0.0.1:9090/prometheus up</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">up</span><span style="color:#E1E4E8;">{instance=</span><span style="color:#B392F0;">&quot;alertmanager&quot;</span><span style="color:#B392F0;">,</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">job=&quot;alertmanager&quot;}</span><span style="color:#E1E4E8;"> =</span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">@[</span><span style="color:#79B8FF;">1735872908.436</span><span style="color:#9ECBFF;">]</span></span>
<span class="line"><span style="color:#B392F0;">up</span><span style="color:#E1E4E8;">{instance=</span><span style="color:#B392F0;">&quot;prometheus&quot;</span><span style="color:#B392F0;">,</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">job=&quot;prometheus&quot;}</span><span style="color:#E1E4E8;"> =</span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">@[</span><span style="color:#79B8FF;">1735872908.436</span><span style="color:#9ECBFF;">]</span></span>
<span class="line"><span style="color:#B392F0;">up</span><span style="color:#E1E4E8;">{instance=</span><span style="color:#B392F0;">&quot;10.103.236.199&quot;</span><span style="color:#B392F0;">,</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">job=&quot;blackbox-exporter-10.103.236.199&quot;}</span><span style="color:#E1E4E8;"> =</span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">@[</span><span style="color:#79B8FF;">1735872908.436</span><span style="color:#9ECBFF;">]</span></span>
<span class="line"><span style="color:#B392F0;">up</span><span style="color:#E1E4E8;">{app=</span><span style="color:#B392F0;">&quot;linux-node&quot;</span><span style="color:#B392F0;">,</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">instance=&quot;10.103.236.199&quot;,</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">job=&quot;consul_blackbox_tcp_connect&quot;,</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">project=&quot;yewu&quot;}</span><span style="color:#E1E4E8;"> =</span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">@[</span><span style="color:#79B8FF;">1735872908.436</span><span style="color:#9ECBFF;">]</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">#由于我这里做了代理，需要添加/prometheus,才能查到数据，默认不用添加</span></span>
<span class="line"><span style="color:#24292E;">$promtool query instant http://127.0.0.1:9090/prometheus up</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">up</span><span style="color:#24292E;">{instance=</span><span style="color:#6F42C1;">&quot;alertmanager&quot;</span><span style="color:#6F42C1;">,</span><span style="color:#24292E;"> </span><span style="color:#032F62;">job=&quot;alertmanager&quot;}</span><span style="color:#24292E;"> =</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">@[</span><span style="color:#005CC5;">1735872908.436</span><span style="color:#032F62;">]</span></span>
<span class="line"><span style="color:#6F42C1;">up</span><span style="color:#24292E;">{instance=</span><span style="color:#6F42C1;">&quot;prometheus&quot;</span><span style="color:#6F42C1;">,</span><span style="color:#24292E;"> </span><span style="color:#032F62;">job=&quot;prometheus&quot;}</span><span style="color:#24292E;"> =</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">@[</span><span style="color:#005CC5;">1735872908.436</span><span style="color:#032F62;">]</span></span>
<span class="line"><span style="color:#6F42C1;">up</span><span style="color:#24292E;">{instance=</span><span style="color:#6F42C1;">&quot;10.103.236.199&quot;</span><span style="color:#6F42C1;">,</span><span style="color:#24292E;"> </span><span style="color:#032F62;">job=&quot;blackbox-exporter-10.103.236.199&quot;}</span><span style="color:#24292E;"> =</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">@[</span><span style="color:#005CC5;">1735872908.436</span><span style="color:#032F62;">]</span></span>
<span class="line"><span style="color:#6F42C1;">up</span><span style="color:#24292E;">{app=</span><span style="color:#6F42C1;">&quot;linux-node&quot;</span><span style="color:#6F42C1;">,</span><span style="color:#24292E;"> </span><span style="color:#032F62;">instance=&quot;10.103.236.199&quot;,</span><span style="color:#24292E;"> </span><span style="color:#032F62;">job=&quot;consul_blackbox_tcp_connect&quot;,</span><span style="color:#24292E;"> </span><span style="color:#032F62;">project=&quot;yewu&quot;}</span><span style="color:#24292E;"> =</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">@[</span><span style="color:#005CC5;">1735872908.436</span><span style="color:#032F62;">]</span></span></code></pre></div><h1 id="_2-prometheus-api" tabindex="-1">2. prometheus api <a class="header-anchor" href="#_2-prometheus-api" aria-label="Permalink to &quot;2. prometheus api&quot;">​</a></h1><h2 id="_2-1-开启api" tabindex="-1">2.1 开启api <a class="header-anchor" href="#_2-1-开启api" aria-label="Permalink to &quot;2.1 开启api&quot;">​</a></h2><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">prometheus --web.enable-admin-api</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">prometheus --web.enable-admin-api</span></span></code></pre></div><h2 id="_2-1-制作快照" tabindex="-1">2.1 制作快照 <a class="header-anchor" href="#_2-1-制作快照" aria-label="Permalink to &quot;2.1 制作快照&quot;">​</a></h2><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">curl</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-XPOST</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">http://localhost:9090/api/v1/admin/tsdb/snapshot</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">curl</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-XPOST</span><span style="color:#24292E;"> </span><span style="color:#032F62;">http://localhost:9090/api/v1/admin/tsdb/snapshot</span></span></code></pre></div><h2 id="_2-2-删除timeserie" tabindex="-1">2.2 删除timeserie <a class="header-anchor" href="#_2-2-删除timeserie" aria-label="Permalink to &quot;2.2 删除timeserie&quot;">​</a></h2><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">curl</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-X</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">POST</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-g</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;http://localhost:9090/api/v1/admin/tsdb/delete_series?match[]=process_start_time_seconds{job=&quot;prometheus&quot;}&#39;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">curl</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-X</span><span style="color:#24292E;"> </span><span style="color:#032F62;">POST</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-g</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;http://localhost:9090/api/v1/admin/tsdb/delete_series?match[]=process_start_time_seconds{job=&quot;prometheus&quot;}&#39;</span></span></code></pre></div><p><a href="https://www.yuandangsheng.top/?p=2851" target="_blank" rel="noreferrer">https://www.yuandangsheng.top/?p=2851</a></p><p><a href="https://mafeifan.com/DevOps/Prometheus/1.%E4%BA%A7%E5%93%81%E4%BB%8B%E7%BB%8D.html" target="_blank" rel="noreferrer">https://mafeifan.com/DevOps/Prometheus/1.产品介绍.html</a></p><p><a href="https://www.yuandangsheng.top/?p=2851" target="_blank" rel="noreferrer">https://www.yuandangsheng.top/?p=2851</a></p><p><a href="https://blog.csdn.net/boling_cavalry/article/details/130461338" target="_blank" rel="noreferrer">https://blog.csdn.net/boling_cavalry/article/details/130461338</a></p>`,18),e=[l];function t(r,c,y,E,i,F){return a(),n("div",null,e)}const d=s(p,[["render",t]]);export{h as __pageData,d as default};
