import{_ as s,o as a,c as n,R as l}from"./chunks/framework.zUbWieqp.js";const b=JSON.parse('{"title":"1. 下载","description":"","frontmatter":{},"headers":[],"relativePath":"guide/container/k8s/网络/OpenELB/1-install.md","filePath":"guide/container/k8s/网络/OpenELB/1-install.md","lastUpdated":1716738555000}'),p={name:"guide/container/k8s/网络/OpenELB/1-install.md"},e=l(`<p>环境依赖</p><p>需要k8s版本在1.15.x以上</p><p>官方文档，</p><p><a href="https://openelb.io/docs/getting-started/installation/install-openelb-on-kubernetes/" target="_blank" rel="noreferrer">https://openelb.io/docs/getting-started/installation/install-openelb-on-kubernetes/</a></p><h1 id="_1-下载" tabindex="-1">1. 下载 <a class="header-anchor" href="#_1-下载" aria-label="Permalink to &quot;1. 下载&quot;">​</a></h1><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">wget</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">https://raw.githubusercontent.com/openelb/openelb/release-0.5/deploy/openelb.yaml</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">wget</span><span style="color:#24292E;"> </span><span style="color:#032F62;">https://raw.githubusercontent.com/openelb/openelb/release-0.5/deploy/openelb.yaml</span></span></code></pre></div><h1 id="_2-修改mode" tabindex="-1">2. 修改mode <a class="header-anchor" href="#_2-修改mode" aria-label="Permalink to &quot;2. 修改mode&quot;">​</a></h1><p>Enable strictARP for kube-proxy</p><h2 id="_2-1-ipvs" tabindex="-1">2.1 ipvs <a class="header-anchor" href="#_2-1-ipvs" aria-label="Permalink to &quot;2.1 ipvs&quot;">​</a></h2><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">edit</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">configmap</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">kube-proxy</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-n</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">kube-system</span></span>
<span class="line"><span style="color:#B392F0;">找到</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">mode</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">,</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">改为</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">ipvs</span></span>
<span class="line"><span style="color:#B392F0;">找到ipvs:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">修改</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">strictARP</span><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">:</span><span style="color:#79B8FF;">true</span></span>
<span class="line"><span style="color:#B392F0;">ipvs:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">strictARP:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">true</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">edit</span><span style="color:#24292E;"> </span><span style="color:#032F62;">configmap</span><span style="color:#24292E;"> </span><span style="color:#032F62;">kube-proxy</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-n</span><span style="color:#24292E;"> </span><span style="color:#032F62;">kube-system</span></span>
<span class="line"><span style="color:#6F42C1;">找到</span><span style="color:#24292E;"> </span><span style="color:#032F62;">mode</span><span style="color:#24292E;"> </span><span style="color:#032F62;">,</span><span style="color:#24292E;"> </span><span style="color:#032F62;">改为</span><span style="color:#24292E;"> </span><span style="color:#032F62;">ipvs</span></span>
<span class="line"><span style="color:#6F42C1;">找到ipvs:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">修改</span><span style="color:#24292E;"> </span><span style="color:#032F62;">strictARP</span><span style="color:#24292E;">  </span><span style="color:#032F62;">:</span><span style="color:#005CC5;">true</span></span>
<span class="line"><span style="color:#6F42C1;">ipvs:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">strictARP:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">true</span></span></code></pre></div><ul><li>重启kube-proxy</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">rollout</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">restart</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">daemonset</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">kube-proxy</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-n</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">kube-system</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">rollout</span><span style="color:#24292E;"> </span><span style="color:#032F62;">restart</span><span style="color:#24292E;"> </span><span style="color:#032F62;">daemonset</span><span style="color:#24292E;"> </span><span style="color:#032F62;">kube-proxy</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-n</span><span style="color:#24292E;"> </span><span style="color:#032F62;">kube-system</span></span></code></pre></div><ul><li>查看转发规则</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">ipvsadm</span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">-l</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">ipvsadm</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">-l</span></span></code></pre></div><h1 id="_3-安装yaml" tabindex="-1">3. 安装yaml <a class="header-anchor" href="#_3-安装yaml" aria-label="Permalink to &quot;3. 安装yaml&quot;">​</a></h1><h2 id="_3-1-修改image" tabindex="-1">3.1 修改image <a class="header-anchor" href="#_3-1-修改image" aria-label="Permalink to &quot;3.1 修改image&quot;">​</a></h2><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">vim</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">openelb.yaml</span></span>
<span class="line"><span style="color:#6A737D;">#替换两处image镜像</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">registry.cn-zhangjiakou.aliyuncs.com/hsuing/openelb-kube-webhook:v1.1.1</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">vim</span><span style="color:#24292E;"> </span><span style="color:#032F62;">openelb.yaml</span></span>
<span class="line"><span style="color:#6A737D;">#替换两处image镜像</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">registry.cn-zhangjiakou.aliyuncs.com/hsuing/openelb-kube-webhook:v1.1.1</span></span></code></pre></div><h2 id="_3-2-安装openelb" tabindex="-1">3.2 安装openelb <a class="header-anchor" href="#_3-2-安装openelb" aria-label="Permalink to &quot;3.2 安装openelb&quot;">​</a></h2><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">[root@kube-master openelb]# kubectl apply -f openelb.yaml</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">namespace/openelb-system</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">created</span></span>
<span class="line"><span style="color:#B392F0;">customresourcedefinition.apiextensions.k8s.io/bgpconfs.network.kubesphere.io</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">created</span></span>
<span class="line"><span style="color:#B392F0;">customresourcedefinition.apiextensions.k8s.io/bgppeers.network.kubesphere.io</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">created</span></span>
<span class="line"><span style="color:#B392F0;">customresourcedefinition.apiextensions.k8s.io/eips.network.kubesphere.io</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">created</span></span>
<span class="line"><span style="color:#B392F0;">serviceaccount/kube-keepalived-vip</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">created</span></span>
<span class="line"><span style="color:#B392F0;">serviceaccount/openelb-admission</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">created</span></span>
<span class="line"><span style="color:#B392F0;">role.rbac.authorization.k8s.io/leader-election-role</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">created</span></span>
<span class="line"><span style="color:#B392F0;">role.rbac.authorization.k8s.io/openelb-admission</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">created</span></span>
<span class="line"><span style="color:#B392F0;">clusterrole.rbac.authorization.k8s.io/kube-keepalived-vip</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">created</span></span>
<span class="line"><span style="color:#B392F0;">clusterrole.rbac.authorization.k8s.io/openelb-admission</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">created</span></span>
<span class="line"><span style="color:#B392F0;">clusterrole.rbac.authorization.k8s.io/openelb-manager-role</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">created</span></span>
<span class="line"><span style="color:#B392F0;">rolebinding.rbac.authorization.k8s.io/leader-election-rolebinding</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">created</span></span>
<span class="line"><span style="color:#B392F0;">rolebinding.rbac.authorization.k8s.io/openelb-admission</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">created</span></span>
<span class="line"><span style="color:#B392F0;">clusterrolebinding.rbac.authorization.k8s.io/kube-keepalived-vip</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">created</span></span>
<span class="line"><span style="color:#B392F0;">clusterrolebinding.rbac.authorization.k8s.io/openelb-admission</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">created</span></span>
<span class="line"><span style="color:#B392F0;">clusterrolebinding.rbac.authorization.k8s.io/openelb-manager-rolebinding</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">created</span></span>
<span class="line"><span style="color:#B392F0;">service/openelb-admission</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">created</span></span>
<span class="line"><span style="color:#B392F0;">deployment.apps/openelb-manager</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">created</span></span>
<span class="line"><span style="color:#B392F0;">job.batch/openelb-admission-create</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">created</span></span>
<span class="line"><span style="color:#B392F0;">job.batch/openelb-admission-patch</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">created</span></span>
<span class="line"><span style="color:#B392F0;">mutatingwebhookconfiguration.admissionregistration.k8s.io/openelb-admission</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">created</span></span>
<span class="line"><span style="color:#B392F0;">validatingwebhookconfiguration.admissionregistration.k8s.io/openelb-admission</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">created</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">[root@kube-master openelb]# kubectl apply -f openelb.yaml</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">namespace/openelb-system</span><span style="color:#24292E;"> </span><span style="color:#032F62;">created</span></span>
<span class="line"><span style="color:#6F42C1;">customresourcedefinition.apiextensions.k8s.io/bgpconfs.network.kubesphere.io</span><span style="color:#24292E;"> </span><span style="color:#032F62;">created</span></span>
<span class="line"><span style="color:#6F42C1;">customresourcedefinition.apiextensions.k8s.io/bgppeers.network.kubesphere.io</span><span style="color:#24292E;"> </span><span style="color:#032F62;">created</span></span>
<span class="line"><span style="color:#6F42C1;">customresourcedefinition.apiextensions.k8s.io/eips.network.kubesphere.io</span><span style="color:#24292E;"> </span><span style="color:#032F62;">created</span></span>
<span class="line"><span style="color:#6F42C1;">serviceaccount/kube-keepalived-vip</span><span style="color:#24292E;"> </span><span style="color:#032F62;">created</span></span>
<span class="line"><span style="color:#6F42C1;">serviceaccount/openelb-admission</span><span style="color:#24292E;"> </span><span style="color:#032F62;">created</span></span>
<span class="line"><span style="color:#6F42C1;">role.rbac.authorization.k8s.io/leader-election-role</span><span style="color:#24292E;"> </span><span style="color:#032F62;">created</span></span>
<span class="line"><span style="color:#6F42C1;">role.rbac.authorization.k8s.io/openelb-admission</span><span style="color:#24292E;"> </span><span style="color:#032F62;">created</span></span>
<span class="line"><span style="color:#6F42C1;">clusterrole.rbac.authorization.k8s.io/kube-keepalived-vip</span><span style="color:#24292E;"> </span><span style="color:#032F62;">created</span></span>
<span class="line"><span style="color:#6F42C1;">clusterrole.rbac.authorization.k8s.io/openelb-admission</span><span style="color:#24292E;"> </span><span style="color:#032F62;">created</span></span>
<span class="line"><span style="color:#6F42C1;">clusterrole.rbac.authorization.k8s.io/openelb-manager-role</span><span style="color:#24292E;"> </span><span style="color:#032F62;">created</span></span>
<span class="line"><span style="color:#6F42C1;">rolebinding.rbac.authorization.k8s.io/leader-election-rolebinding</span><span style="color:#24292E;"> </span><span style="color:#032F62;">created</span></span>
<span class="line"><span style="color:#6F42C1;">rolebinding.rbac.authorization.k8s.io/openelb-admission</span><span style="color:#24292E;"> </span><span style="color:#032F62;">created</span></span>
<span class="line"><span style="color:#6F42C1;">clusterrolebinding.rbac.authorization.k8s.io/kube-keepalived-vip</span><span style="color:#24292E;"> </span><span style="color:#032F62;">created</span></span>
<span class="line"><span style="color:#6F42C1;">clusterrolebinding.rbac.authorization.k8s.io/openelb-admission</span><span style="color:#24292E;"> </span><span style="color:#032F62;">created</span></span>
<span class="line"><span style="color:#6F42C1;">clusterrolebinding.rbac.authorization.k8s.io/openelb-manager-rolebinding</span><span style="color:#24292E;"> </span><span style="color:#032F62;">created</span></span>
<span class="line"><span style="color:#6F42C1;">service/openelb-admission</span><span style="color:#24292E;"> </span><span style="color:#032F62;">created</span></span>
<span class="line"><span style="color:#6F42C1;">deployment.apps/openelb-manager</span><span style="color:#24292E;"> </span><span style="color:#032F62;">created</span></span>
<span class="line"><span style="color:#6F42C1;">job.batch/openelb-admission-create</span><span style="color:#24292E;"> </span><span style="color:#032F62;">created</span></span>
<span class="line"><span style="color:#6F42C1;">job.batch/openelb-admission-patch</span><span style="color:#24292E;"> </span><span style="color:#032F62;">created</span></span>
<span class="line"><span style="color:#6F42C1;">mutatingwebhookconfiguration.admissionregistration.k8s.io/openelb-admission</span><span style="color:#24292E;"> </span><span style="color:#032F62;">created</span></span>
<span class="line"><span style="color:#6F42C1;">validatingwebhookconfiguration.admissionregistration.k8s.io/openelb-admission</span><span style="color:#24292E;"> </span><span style="color:#032F62;">created</span></span></code></pre></div><ul><li>查看pod</li></ul><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">[root@kube-master openelb]#  kubectl get pods -n openelb-system</span></span>
<span class="line"><span style="color:#e1e4e8;">NAME                               READY   STATUS      RESTARTS   AGE</span></span>
<span class="line"><span style="color:#e1e4e8;">openelb-admission-create-dgh5g     0/1     Completed   0          18m</span></span>
<span class="line"><span style="color:#e1e4e8;">openelb-admission-patch-n75mk      0/1     Completed   0          18m</span></span>
<span class="line"><span style="color:#e1e4e8;">openelb-keepalive-vip-2zdtm        1/1     Running     0          17m</span></span>
<span class="line"><span style="color:#e1e4e8;">openelb-keepalive-vip-tqv55        1/1     Running     0          17m</span></span>
<span class="line"><span style="color:#e1e4e8;">openelb-keepalive-vip-vg4cm        1/1     Running     0          17m</span></span>
<span class="line"><span style="color:#e1e4e8;">openelb-manager-794999f796-hdm8r   1/1     Running     0          18m</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">[root@kube-master openelb]#  kubectl get pods -n openelb-system</span></span>
<span class="line"><span style="color:#24292e;">NAME                               READY   STATUS      RESTARTS   AGE</span></span>
<span class="line"><span style="color:#24292e;">openelb-admission-create-dgh5g     0/1     Completed   0          18m</span></span>
<span class="line"><span style="color:#24292e;">openelb-admission-patch-n75mk      0/1     Completed   0          18m</span></span>
<span class="line"><span style="color:#24292e;">openelb-keepalive-vip-2zdtm        1/1     Running     0          17m</span></span>
<span class="line"><span style="color:#24292e;">openelb-keepalive-vip-tqv55        1/1     Running     0          17m</span></span>
<span class="line"><span style="color:#24292e;">openelb-keepalive-vip-vg4cm        1/1     Running     0          17m</span></span>
<span class="line"><span style="color:#24292e;">openelb-manager-794999f796-hdm8r   1/1     Running     0          18m</span></span></code></pre></div><h2 id="_3-3-配置对外ip池" tabindex="-1">3.3 配置对外ip池 <a class="header-anchor" href="#_3-3-配置对外ip池" aria-label="Permalink to &quot;3.3 配置对外ip池&quot;">​</a></h2><ul><li>创建layer2配置文件</li></ul><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">#查看ip</span></span>
<span class="line"><span style="color:#E1E4E8;">[</span><span style="color:#9ECBFF;">root@kube-master openelb</span><span style="color:#E1E4E8;">]# </span><span style="color:#9ECBFF;">kubectl describe node | grep -A5 Annotations</span></span>
<span class="line"><span style="color:#85E89D;">Annotations</span><span style="color:#E1E4E8;">:        </span><span style="color:#85E89D;">kubeadm.alpha.kubernetes.io/cri-socket</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">/var/run/dockershim.sock</span></span>
<span class="line"><span style="color:#E1E4E8;">                    </span><span style="color:#85E89D;">node.alpha.kubernetes.io/ttl</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">0</span></span>
<span class="line"><span style="color:#E1E4E8;">                    </span><span style="color:#85E89D;">projectcalico.org/IPv4Address</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">10.103.236.201/24</span></span>
<span class="line"><span style="color:#E1E4E8;">                    </span><span style="color:#85E89D;">projectcalico.org/IPv4IPIPTunnelAddr</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">172.25.244.192</span></span>
<span class="line"><span style="color:#9ECBFF;">。。。</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">[</span><span style="color:#9ECBFF;">root@kube-master openelb</span><span style="color:#E1E4E8;">]# </span><span style="color:#9ECBFF;">cat eip-layer2-pool.yaml</span></span>
<span class="line"><span style="color:#85E89D;">apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">network.kubesphere.io/v1alpha2</span></span>
<span class="line"><span style="color:#85E89D;">kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Eip</span></span>
<span class="line"><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">eip-pool</span><span style="color:#E1E4E8;"> </span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">annotations</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">eip.openelb.kubesphere.io/is-default-eip</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;true&quot;</span></span>
<span class="line"><span style="color:#85E89D;">spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">address</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">10.103.236.70-10.103.236.99</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;">#这里必须和node在同一个网段</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">protocol</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">layer2</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">interface</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">ens33</span><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;">#根据自己的interface修改(master节点)</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">disable</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">false</span></span>
<span class="line"><span style="color:#85E89D;">status</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">occupied</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">false</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">usage</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">1</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">poolSize</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">10</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">firstIP</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">10.103.236.70</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">lastIP</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">10.103.236.99</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">ready</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">true</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">v4</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">true</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">#查看ip</span></span>
<span class="line"><span style="color:#24292E;">[</span><span style="color:#032F62;">root@kube-master openelb</span><span style="color:#24292E;">]# </span><span style="color:#032F62;">kubectl describe node | grep -A5 Annotations</span></span>
<span class="line"><span style="color:#22863A;">Annotations</span><span style="color:#24292E;">:        </span><span style="color:#22863A;">kubeadm.alpha.kubernetes.io/cri-socket</span><span style="color:#24292E;">: </span><span style="color:#032F62;">/var/run/dockershim.sock</span></span>
<span class="line"><span style="color:#24292E;">                    </span><span style="color:#22863A;">node.alpha.kubernetes.io/ttl</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">0</span></span>
<span class="line"><span style="color:#24292E;">                    </span><span style="color:#22863A;">projectcalico.org/IPv4Address</span><span style="color:#24292E;">: </span><span style="color:#032F62;">10.103.236.201/24</span></span>
<span class="line"><span style="color:#24292E;">                    </span><span style="color:#22863A;">projectcalico.org/IPv4IPIPTunnelAddr</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">172.25.244.192</span></span>
<span class="line"><span style="color:#032F62;">。。。</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">[</span><span style="color:#032F62;">root@kube-master openelb</span><span style="color:#24292E;">]# </span><span style="color:#032F62;">cat eip-layer2-pool.yaml</span></span>
<span class="line"><span style="color:#22863A;">apiVersion</span><span style="color:#24292E;">: </span><span style="color:#032F62;">network.kubesphere.io/v1alpha2</span></span>
<span class="line"><span style="color:#22863A;">kind</span><span style="color:#24292E;">: </span><span style="color:#032F62;">Eip</span></span>
<span class="line"><span style="color:#22863A;">metadata</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">eip-pool</span><span style="color:#24292E;"> </span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">annotations</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">eip.openelb.kubesphere.io/is-default-eip</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;true&quot;</span></span>
<span class="line"><span style="color:#22863A;">spec</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">address</span><span style="color:#24292E;">: </span><span style="color:#032F62;">10.103.236.70-10.103.236.99</span><span style="color:#24292E;"> </span><span style="color:#6A737D;">#这里必须和node在同一个网段</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">protocol</span><span style="color:#24292E;">: </span><span style="color:#032F62;">layer2</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">interface</span><span style="color:#24292E;">: </span><span style="color:#032F62;">ens33</span><span style="color:#24292E;">  </span><span style="color:#6A737D;">#根据自己的interface修改(master节点)</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">disable</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">false</span></span>
<span class="line"><span style="color:#22863A;">status</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">occupied</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">false</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">usage</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">1</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">poolSize</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">10</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">firstIP</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">10.103.236.70</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">lastIP</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">10.103.236.99</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">ready</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">true</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">v4</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">true</span></span></code></pre></div><ul><li>执行apply</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">[root@kube-master openelb]# kubectl apply -f eip-layer2-pool.yaml</span></span>
<span class="line"><span style="color:#B392F0;">eip.network.kubesphere.io/eip-sample-pool</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">configured</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">[root@kube-master openelb]# kubectl apply -f eip-layer2-pool.yaml</span></span>
<span class="line"><span style="color:#6F42C1;">eip.network.kubesphere.io/eip-sample-pool</span><span style="color:#24292E;"> </span><span style="color:#032F62;">configured</span></span></code></pre></div><blockquote><p>命令行模式</p><p><strong>kubectl</strong> annotate nodes master01 layer2.openelb.kubesphere.io/v1alpha2=&quot;eth_IP&quot;</p></blockquote><ul><li>查看eip</li></ul><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">[root@kube-master openelb]# kubectl get eip</span></span>
<span class="line"><span style="color:#B392F0;">NAME</span><span style="color:#E1E4E8;">              </span><span style="color:#9ECBFF;">CIDR</span><span style="color:#E1E4E8;">                  </span><span style="color:#9ECBFF;">USAGE</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">TOTAL</span></span>
<span class="line"><span style="color:#B392F0;">eip-pool</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">10.103</span><span style="color:#9ECBFF;">.236.70-10.103.236.99</span><span style="color:#E1E4E8;">           </span><span style="color:#79B8FF;">30</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">[root@kube-master openelb]# kubectl get eip</span></span>
<span class="line"><span style="color:#6F42C1;">NAME</span><span style="color:#24292E;">              </span><span style="color:#032F62;">CIDR</span><span style="color:#24292E;">                  </span><span style="color:#032F62;">USAGE</span><span style="color:#24292E;">   </span><span style="color:#032F62;">TOTAL</span></span>
<span class="line"><span style="color:#6F42C1;">eip-pool</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">10.103</span><span style="color:#032F62;">.236.70-10.103.236.99</span><span style="color:#24292E;">           </span><span style="color:#005CC5;">30</span></span></code></pre></div>`,29),o=[e];function t(c,r,i,y,E,d){return a(),n("div",null,o)}const u=s(p,[["render",t]]);export{b as __pageData,u as default};
