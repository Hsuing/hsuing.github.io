import{_ as s,o as a,c as n,R as l}from"./chunks/framework.zUbWieqp.js";const u=JSON.parse('{"title":"1.安装","description":"","frontmatter":{},"headers":[],"relativePath":"guide/Linux/Jenkins/tool/7-ldap.md","filePath":"guide/Linux/Jenkins/tool/7-ldap.md","lastUpdated":1720606881000}'),p={name:"guide/Linux/Jenkins/tool/7-ldap.md"},o=l(`<h1 id="_1-安装" tabindex="-1">1.安装 <a class="header-anchor" href="#_1-安装" aria-label="Permalink to &quot;1.安装&quot;">​</a></h1><h2 id="_1-1安装ldap服务" tabindex="-1">1.1安装ldap服务 <a class="header-anchor" href="#_1-1安装ldap服务" aria-label="Permalink to &quot;1.1安装ldap服务&quot;">​</a></h2><p>添加jenkins相关的测试账户和组</p><ol><li>group这个ou下面创建一个jenkins的ou。</li><li>在jenkins这个ou里面创建3个组，名为jenkins-admins,jenkins-editors,jenkins-users。</li><li>在ou=people下面创建4个账户，名为admin,test01,test02,test03,配置好邮箱和密码。</li><li>在三个组上面添加对应的用户， jenkins-admins组添加admin,test01用户， jenkins-editors组添加test02用户，jenkins-users组添加test03用户</li></ol><p>ldap 创建两个 group<code>jenkins-admin</code> 和 <code>jenkins-manager</code>。并分别将用户 <code>admin</code>， <code>operator</code> 各自分配到两个组下。（ldapadmin 工具操作用户分配组：在用户条目上右键 <code>View\\Edit Group Membership</code>，选择要加入的组</p><p><img src="https://nnaigos.oss-cn-hangzhou.aliyuncs.com/imgs/202407042237060.jpg" alt=""></p><p>或者通过以下方式操作</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">docker pull osixia/phpldapadmin</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">docker pull osixia/phpldapadmin</span></span></code></pre></div><h3 id="创建ou组织用户数据" tabindex="-1">创建OU组织用户数据 <a class="header-anchor" href="#创建ou组织用户数据" aria-label="Permalink to &quot;创建OU组织用户数据&quot;">​</a></h3><p><img src="https://nnaigos.oss-cn-hangzhou.aliyuncs.com/imgs/202407042237871.png" alt=""></p><ul><li>选择Organisational unit 组织单元</li></ul><p><img src="https://nnaigos.oss-cn-hangzhou.aliyuncs.com/imgs/202407042237389.png" alt=""></p><ul><li>输入OU名称</li></ul><p><img src="https://nnaigos.oss-cn-hangzhou.aliyuncs.com/imgs/202407042237000.png" alt=""></p><ul><li>提交信息</li></ul><p><img src="https://nnaigos.oss-cn-hangzhou.aliyuncs.com/imgs/202407042237919.png" alt=""></p><ul><li>查看结果</li></ul><p><img src="https://nnaigos.oss-cn-hangzhou.aliyuncs.com/imgs/202407042237751.png" alt=""></p><h3 id="创建人员" tabindex="-1">创建人员 <a class="header-anchor" href="#创建人员" aria-label="Permalink to &quot;创建人员&quot;">​</a></h3><ul><li>选择OU-&gt;选择新建子条目</li></ul><p><img src="https://nnaigos.oss-cn-hangzhou.aliyuncs.com/imgs/202407042237606.png" alt=""></p><ul><li>选择默认模板</li></ul><p><img src="https://nnaigos.oss-cn-hangzhou.aliyuncs.com/imgs/202407042237329.png" alt=""></p><ul><li>选择inetorgperson</li></ul><p><img src="https://nnaigos.oss-cn-hangzhou.aliyuncs.com/imgs/202407042237371.png" alt=""></p><ul><li>填写并提交信息</li></ul><p><img src="https://nnaigos.oss-cn-hangzhou.aliyuncs.com/imgs/202407042237842.png" alt=""></p><ul><li>用户创建完成</li></ul><p><img src="https://nnaigos.oss-cn-hangzhou.aliyuncs.com/imgs/202407042237552.png" alt=""></p><h2 id="_1-2安装jenkins-ldap插件" tabindex="-1">1.2安装jenkins ldap插件 <a class="header-anchor" href="#_1-2安装jenkins-ldap插件" aria-label="Permalink to &quot;1.2安装jenkins ldap插件&quot;">​</a></h2><ul><li>ldap</li></ul><p>1.登录Jenkins --&gt; 系统管理 --&gt; 插件管理 --&gt; 可选插件 --&gt; 搜索LDAP --&gt; 选中 --&gt; 直接安装 --&gt; 安装完成重启</p><p>2.官网下载插件 --&gt; 登录Jenkins --&gt; 系统管理 --&gt; 插件管理 --&gt; 高级 --&gt; 上传插件 --&gt; 选择文件 --&gt; 上传 --&gt; 安装完成后重启（手动安装），<a href="https://updates.jenkins-ci.org/download/plugins/" target="_blank" rel="noreferrer">https://updates.jenkins-ci.org/download/plugins/</a></p><p>此处已安装</p><p><img src="https://nnaigos.oss-cn-hangzhou.aliyuncs.com/imgs/202407042237737.jpg" alt=""></p><h2 id="_1-4配置jenkins权限" tabindex="-1">1.4配置jenkins权限 <a class="header-anchor" href="#_1-4配置jenkins权限" aria-label="Permalink to &quot;1.4配置jenkins权限&quot;">​</a></h2><p><img src="https://nnaigos.oss-cn-hangzhou.aliyuncs.com/imgs/202407042238928.jpg" alt=""></p><p>前期配置先把权限配置高级</p><h3 id="配置ldap权限" tabindex="-1">配置ldap权限 <a class="header-anchor" href="#配置ldap权限" aria-label="Permalink to &quot;配置ldap权限&quot;">​</a></h3><p>但是我们需要对用户进行权限的配置，不可能每个人登录都能对我们jenkins进行无限制的操作，这不符合我们之前的意图。安装<code>Role-based Authorization Strategy</code>插件</p><p>在系统管理——&gt;全局安全配置,可以看到下面选项</p><p><img src="https://nnaigos.oss-cn-hangzhou.aliyuncs.com/imgs/202407042238681.jpg" alt=""></p><p>保存以后，返回系统管理界面就可以看到多处一个<code>Manage and Assign Roles</code></p><p><img src="https://nnaigos.oss-cn-hangzhou.aliyuncs.com/imgs/202407092231826.jpg" alt="1571034433352"></p><p>点击进去</p><p><img src="https://nnaigos.oss-cn-hangzhou.aliyuncs.com/imgs/202407042238830.jpg" alt=""></p><ul><li><strong>Manage Roles</strong>: 角色分为Global和Project，可创建角色分组和添加项目。</li><li><strong>Assign Roles</strong>: 增加具体的用户，分配到角色组，指定项目权限</li></ul><p><img src="https://nnaigos.oss-cn-hangzhou.aliyuncs.com/imgs/202407042238608.jpg" alt=""></p><p><strong>注</strong>: 这里有一个小问题，这样配置以后，新用户登录进来以后就会提示没有权限，<code>Access Denied,xxxx没有全部/Read权限</code>，这是因为在打开jenkins后，没有创建用户前，先不要勾选系统设置中启用安全选项，如果勾选了，就会出现无法进入jenkins的现象</p><p><img src="https://nnaigos.oss-cn-hangzhou.aliyuncs.com/imgs/202407042238171.jpg" alt=""></p><ul><li>Role-Based Strategy</li></ul><p>但是这有一个弊端，就是每次新来一个用户就得去添加一次用户权限，虽然满足了业务需求，但是不科学</p><ul><li>项目矩阵授权策略</li></ul><p><img src="https://nnaigos.oss-cn-hangzhou.aliyuncs.com/imgs/202407042238300.jpg" alt=""></p><p>这是一个全局的配置，特定组只能按照最小的权限授权，额外的权限可以在具体的项目权限矩阵里面在添加。 默认只有<code>Anonymous Users</code>和<code>Authenticated Users</code>，管理员组是需要添加的<code>admin</code></p><ul><li>Anonymous Users: 匿名用户，显然不能</li><li>Authenticated Users: 认证用户，就是只要是认证的账号都可以拥有的权限</li><li>admin: 就是拥有所有的权限了，这个组一般只能运维人员和部门老大加入</li></ul><p>加入admin组以后，他会自动去同步ldap的组用户，如果用户在ldap是admin组，那么在这里就会是管理员权限，如果用户是普通组，那么就是<code>Authenticated Users</code>组赋予的权限，使用这种方式只要用户是ldap里面的，就可以登录查看。这样就满足了业务场景需求</p><h3 id="配置ldap" tabindex="-1">配置ldap <a class="header-anchor" href="#配置ldap" aria-label="Permalink to &quot;配置ldap&quot;">​</a></h3><p>参考，<a href="https://plugins.jenkins.io/ldap/" target="_blank" rel="noreferrer">https://plugins.jenkins.io/ldap/</a></p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">#先备份文件</span></span>
<span class="line"><span style="color:#B392F0;">cp</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">config.xml</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">config.xml_back</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">#先备份文件</span></span>
<span class="line"><span style="color:#6F42C1;">cp</span><span style="color:#24292E;"> </span><span style="color:#032F62;">config.xml</span><span style="color:#24292E;"> </span><span style="color:#032F62;">config.xml_back</span></span></code></pre></div><ul><li>登录 Jenkins –&gt; 系统管理 –&gt; 全局安全配置</li></ul><p><img src="https://nnaigos.oss-cn-hangzhou.aliyuncs.com/imgs/202407042238180.jpg" alt=""></p><p>或者</p><p><img src="https://nnaigos.oss-cn-hangzhou.aliyuncs.com/imgs/202407042238160.png" alt=""></p><p>说明：</p><ul><li><p><strong>root DN</strong>：这里的 <code>root DN只</code>是指搜索的根，并非 LDAP 服务器的 <code>root dn</code>。由于 LDAP 数据库的数据组织结构类似一颗大树，而搜索是递归执行的，理论上，我们如果从子节点（而不是根节点）开始搜索，因为缩小了搜索范围那么就可以获得更高的性能。这里的 <code>root DN</code> 指的就是这个子节点的 DN，当然也可以不填，表示从 LDAP 的根节点开始搜索</p></li><li><p><strong>User search base</strong>：这个配置也是为了缩小 LDAP 搜索的范围，例如 Jenkins 系统只允许 ou 为 Admin 下的用户才能登陆，那么你这里可以填写 <code>ou=Admin</code>，这是一个相对的值，相对于上边的 root DN，例如你上边的 root DN 填写的是 dc=domain,dc=com，那么 user search base 这里填写了 ou=Admin，那么登陆用户去 LDAP 搜索时就只会搜索 ou=Admin,dc=domain,dc=com 下的用户</p></li><li><p><strong>User search filter</strong>：这个配置定义登陆的 “用户名” 对应 LDAP 中的哪个字段，如果你想用 LDAP 中的 uid 作为用户名来登录，那么这里可以配置为 uid={0}（{0} 会自动的替换为用户提交的用户名），如果你想用 LDAP 中的 mail 作为用户名来登录，那么这里就需要改为 mail={0}。在测试的时候如果提示你 user xxx does not exist，而你确定密码输入正确时，就要考虑下输入的用户名是不是这里定义的这个值了</p></li><li><p><strong>Group search base</strong>：参考上边 User search base 解释</p></li><li><p><strong>Group search filter</strong>：这个配置允许你将过滤器限制为所需的 objectClass 来提高搜索性能，也就是说可以只搜索用户属性中包含某个 objectClass 的用户，这就要求你对你的 LDAP 足够了解，一般我们也不配置</p></li><li><p><strong>Group membership</strong>：没配置，没有详细研究</p></li><li><p><strong>Manager DN</strong>：这个配置在你的 LDAP 服务器不允许匿名访问的情况下用来做认证，通常 DN 为 cn=admin,dc=domain,dc=com 这样</p></li><li><p><strong>Manager Password</strong>：上边配置 dn 的密码</p></li><li><p><strong>Display Name LDAP attribute</strong>：配置用户的显示名称，一般为显示名称就配置为 uid，如果你想显示其他字段属性也可以这里配置，例如 mail</p></li><li><p><strong>Email Address LDAP attribute</strong>：配置用户 Email 对应的字段属性，一般没有修改过的话都是 mail，除非你用其他的字段属性来标识用户邮箱，这里可以配置</p></li><li><p><strong>Enable Cache</strong>: 当你的 LDAP 数据量很大或者 LDAP 服务器性能较差时，可以开启缓存，配置缓存条数和过期时间，那么在过期时间内新请求优先查找本地缓存认证，认证通过则不会去 LDAP 服务器请求，以减轻 LDAP 服务器的压力</p></li><li><p>选择账号测试，出现一下信息集成完毕</p></li></ul><p><img src="https://nnaigos.oss-cn-hangzhou.aliyuncs.com/imgs/202407042238833.png" alt=""></p><ul><li>配置 ldap 分组认证</li></ul><p>==强烈建议使用安全矩阵授权策略==</p><p>操作步骤：选择 <code>jenkins</code> -&gt; <code>系统管理</code> -&gt; <code>全局安全设置</code> -&gt; <code>访问控制</code> -&gt; <code>ldap</code> -&gt; <code>授权策略</code>，选择安全矩阵授权策略</p><p><img src="https://nnaigos.oss-cn-hangzhou.aliyuncs.com/imgs/202407042238094.jpg" alt=""></p><p>或者</p><p><img src="https://nnaigos.oss-cn-hangzhou.aliyuncs.com/imgs/202407042238157.jpg" alt=""></p><h2 id="_1-5配置失败还原" tabindex="-1">1.5配置失败还原 <a class="header-anchor" href="#_1-5配置失败还原" aria-label="Permalink to &quot;1.5配置失败还原&quot;">​</a></h2><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">如果LDAP配置失败，原来的例如admin账号也无法登陆了。</span></span>
<span class="line"><span style="color:#e1e4e8;"> 解决方法如下：</span></span>
<span class="line"><span style="color:#e1e4e8;"> 找到jenkins服务所在主机，找到数据文件夹，我这里配置的是/var/jenkins_home</span></span>
<span class="line"><span style="color:#e1e4e8;"> 找到config.xml</span></span>
<span class="line"><span style="color:#e1e4e8;"> 将&lt;usesecurity&gt;true&lt;/usesecurity&gt;</span></span>
<span class="line"><span style="color:#e1e4e8;"> 设置为false</span></span>
<span class="line"><span style="color:#e1e4e8;"> 重启jenkins服务即可</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">如果LDAP配置失败，原来的例如admin账号也无法登陆了。</span></span>
<span class="line"><span style="color:#24292e;"> 解决方法如下：</span></span>
<span class="line"><span style="color:#24292e;"> 找到jenkins服务所在主机，找到数据文件夹，我这里配置的是/var/jenkins_home</span></span>
<span class="line"><span style="color:#24292e;"> 找到config.xml</span></span>
<span class="line"><span style="color:#24292e;"> 将&lt;usesecurity&gt;true&lt;/usesecurity&gt;</span></span>
<span class="line"><span style="color:#24292e;"> 设置为false</span></span>
<span class="line"><span style="color:#24292e;"> 重启jenkins服务即可</span></span></code></pre></div><ul><li>或者</li></ul><p>在 config.xml 配置文件中找到这段关于 ldap 认证的信息</p><div class="language-xml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">xml</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">&lt;</span><span style="color:#85E89D;">securityRealm</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">class</span><span style="color:#E1E4E8;">=</span><span style="color:#9ECBFF;">&quot;hudson.security.LDAPSecurityRealm&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">plugin</span><span style="color:#E1E4E8;">=</span><span style="color:#9ECBFF;">&quot;ldap@1.20&quot;</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">    &lt;</span><span style="color:#85E89D;">disableMailAddrexxxesolver</span><span style="color:#E1E4E8;">&gt;false&lt;/</span><span style="color:#85E89D;">disableMailAddrexxxesolver</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">    &lt;</span><span style="color:#85E89D;">configurations</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">      &lt;</span><span style="color:#85E89D;">jenkins.security.plugins.ldap.LDAPConfiguration</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">        &lt;</span><span style="color:#85E89D;">server</span><span style="color:#E1E4E8;">&gt;ldap://XXXXXX.com:389&lt;/</span><span style="color:#85E89D;">server</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">        &lt;</span><span style="color:#85E89D;">rootDN</span><span style="color:#E1E4E8;">&gt;dc=XXXXXX,dc=com&lt;/</span><span style="color:#85E89D;">rootDN</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">        &lt;</span><span style="color:#85E89D;">inhibitInferRootDN</span><span style="color:#E1E4E8;">&gt;false&lt;/</span><span style="color:#85E89D;">inhibitInferRootDN</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">        &lt;</span><span style="color:#85E89D;">userSearchBase</span><span style="color:#E1E4E8;">&gt;&lt;/</span><span style="color:#85E89D;">userSearchBase</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">        &lt;</span><span style="color:#85E89D;">userSearch</span><span style="color:#E1E4E8;">&gt;uid={0}&lt;/</span><span style="color:#85E89D;">userSearch</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">        &lt;</span><span style="color:#85E89D;">groupMembershipStrategy</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">class</span><span style="color:#E1E4E8;">=</span><span style="color:#9ECBFF;">&quot;jenkins.security.plugins.ldap.FromGroupSearchLDAPGroupMembershipStrategy&quot;</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">          &lt;</span><span style="color:#85E89D;">filter</span><span style="color:#E1E4E8;">&gt;cn=jenkins&lt;/</span><span style="color:#85E89D;">filter</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">        &lt;/</span><span style="color:#85E89D;">groupMembershipStrategy</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">        &lt;</span><span style="color:#85E89D;">managerDN</span><span style="color:#E1E4E8;">&gt;uid=jarry,ou=People,dc=XXXXXX,dc=com&lt;/</span><span style="color:#85E89D;">managerDN</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">        &lt;</span><span style="color:#85E89D;">managerPasswordSecret</span><span style="color:#E1E4E8;">&gt;{AQAAABAAAAAQWfZrb7qoIjeM=}&lt;/</span><span style="color:#85E89D;">managerPasswordSecret</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">        &lt;</span><span style="color:#85E89D;">displayNameAttributeName</span><span style="color:#E1E4E8;">&gt;uid&lt;/</span><span style="color:#85E89D;">displayNameAttributeName</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">        &lt;</span><span style="color:#85E89D;">mailAddressAttributeName</span><span style="color:#E1E4E8;">&gt;mail&lt;/</span><span style="color:#85E89D;">mailAddressAttributeName</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">        &lt;</span><span style="color:#85E89D;">ignoreIfUnavailable</span><span style="color:#E1E4E8;">&gt;false&lt;/</span><span style="color:#85E89D;">ignoreIfUnavailable</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">        &lt;</span><span style="color:#85E89D;">extraEnvVars</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">class</span><span style="color:#E1E4E8;">=</span><span style="color:#9ECBFF;">&quot;linked-hash-map&quot;</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">          &lt;</span><span style="color:#85E89D;">entry</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">            &lt;</span><span style="color:#85E89D;">string</span><span style="color:#E1E4E8;">&gt;&lt;/</span><span style="color:#85E89D;">string</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">            &lt;</span><span style="color:#85E89D;">string</span><span style="color:#E1E4E8;">&gt;&lt;/</span><span style="color:#85E89D;">string</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">          &lt;/</span><span style="color:#85E89D;">entry</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">        &lt;/</span><span style="color:#85E89D;">extraEnvVars</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">      &lt;/</span><span style="color:#85E89D;">jenkins.security.plugins.ldap.LDAPConfiguration</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">    &lt;/</span><span style="color:#85E89D;">configurations</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">    &lt;</span><span style="color:#85E89D;">userIdStrategy</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">class</span><span style="color:#E1E4E8;">=</span><span style="color:#9ECBFF;">&quot;jenkins.model.IdStrategy$CaseInsensitive&quot;</span><span style="color:#E1E4E8;">/&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">    &lt;</span><span style="color:#85E89D;">groupIdStrategy</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">class</span><span style="color:#E1E4E8;">=</span><span style="color:#9ECBFF;">&quot;jenkins.model.IdStrategy$CaseInsensitive&quot;</span><span style="color:#E1E4E8;">/&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">    &lt;</span><span style="color:#85E89D;">disableRolePrefixing</span><span style="color:#E1E4E8;">&gt;true&lt;/</span><span style="color:#85E89D;">disableRolePrefixing</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">  &lt;/</span><span style="color:#85E89D;">securityRealm</span><span style="color:#E1E4E8;">&gt;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">&lt;</span><span style="color:#22863A;">securityRealm</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">class</span><span style="color:#24292E;">=</span><span style="color:#032F62;">&quot;hudson.security.LDAPSecurityRealm&quot;</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">plugin</span><span style="color:#24292E;">=</span><span style="color:#032F62;">&quot;ldap@1.20&quot;</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">    &lt;</span><span style="color:#22863A;">disableMailAddrexxxesolver</span><span style="color:#24292E;">&gt;false&lt;/</span><span style="color:#22863A;">disableMailAddrexxxesolver</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">    &lt;</span><span style="color:#22863A;">configurations</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">      &lt;</span><span style="color:#22863A;">jenkins.security.plugins.ldap.LDAPConfiguration</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">        &lt;</span><span style="color:#22863A;">server</span><span style="color:#24292E;">&gt;ldap://XXXXXX.com:389&lt;/</span><span style="color:#22863A;">server</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">        &lt;</span><span style="color:#22863A;">rootDN</span><span style="color:#24292E;">&gt;dc=XXXXXX,dc=com&lt;/</span><span style="color:#22863A;">rootDN</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">        &lt;</span><span style="color:#22863A;">inhibitInferRootDN</span><span style="color:#24292E;">&gt;false&lt;/</span><span style="color:#22863A;">inhibitInferRootDN</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">        &lt;</span><span style="color:#22863A;">userSearchBase</span><span style="color:#24292E;">&gt;&lt;/</span><span style="color:#22863A;">userSearchBase</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">        &lt;</span><span style="color:#22863A;">userSearch</span><span style="color:#24292E;">&gt;uid={0}&lt;/</span><span style="color:#22863A;">userSearch</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">        &lt;</span><span style="color:#22863A;">groupMembershipStrategy</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">class</span><span style="color:#24292E;">=</span><span style="color:#032F62;">&quot;jenkins.security.plugins.ldap.FromGroupSearchLDAPGroupMembershipStrategy&quot;</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">          &lt;</span><span style="color:#22863A;">filter</span><span style="color:#24292E;">&gt;cn=jenkins&lt;/</span><span style="color:#22863A;">filter</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">        &lt;/</span><span style="color:#22863A;">groupMembershipStrategy</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">        &lt;</span><span style="color:#22863A;">managerDN</span><span style="color:#24292E;">&gt;uid=jarry,ou=People,dc=XXXXXX,dc=com&lt;/</span><span style="color:#22863A;">managerDN</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">        &lt;</span><span style="color:#22863A;">managerPasswordSecret</span><span style="color:#24292E;">&gt;{AQAAABAAAAAQWfZrb7qoIjeM=}&lt;/</span><span style="color:#22863A;">managerPasswordSecret</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">        &lt;</span><span style="color:#22863A;">displayNameAttributeName</span><span style="color:#24292E;">&gt;uid&lt;/</span><span style="color:#22863A;">displayNameAttributeName</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">        &lt;</span><span style="color:#22863A;">mailAddressAttributeName</span><span style="color:#24292E;">&gt;mail&lt;/</span><span style="color:#22863A;">mailAddressAttributeName</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">        &lt;</span><span style="color:#22863A;">ignoreIfUnavailable</span><span style="color:#24292E;">&gt;false&lt;/</span><span style="color:#22863A;">ignoreIfUnavailable</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">        &lt;</span><span style="color:#22863A;">extraEnvVars</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">class</span><span style="color:#24292E;">=</span><span style="color:#032F62;">&quot;linked-hash-map&quot;</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">          &lt;</span><span style="color:#22863A;">entry</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">            &lt;</span><span style="color:#22863A;">string</span><span style="color:#24292E;">&gt;&lt;/</span><span style="color:#22863A;">string</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">            &lt;</span><span style="color:#22863A;">string</span><span style="color:#24292E;">&gt;&lt;/</span><span style="color:#22863A;">string</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">          &lt;/</span><span style="color:#22863A;">entry</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">        &lt;/</span><span style="color:#22863A;">extraEnvVars</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">      &lt;/</span><span style="color:#22863A;">jenkins.security.plugins.ldap.LDAPConfiguration</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">    &lt;/</span><span style="color:#22863A;">configurations</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">    &lt;</span><span style="color:#22863A;">userIdStrategy</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">class</span><span style="color:#24292E;">=</span><span style="color:#032F62;">&quot;jenkins.model.IdStrategy$CaseInsensitive&quot;</span><span style="color:#24292E;">/&gt;</span></span>
<span class="line"><span style="color:#24292E;">    &lt;</span><span style="color:#22863A;">groupIdStrategy</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">class</span><span style="color:#24292E;">=</span><span style="color:#032F62;">&quot;jenkins.model.IdStrategy$CaseInsensitive&quot;</span><span style="color:#24292E;">/&gt;</span></span>
<span class="line"><span style="color:#24292E;">    &lt;</span><span style="color:#22863A;">disableRolePrefixing</span><span style="color:#24292E;">&gt;true&lt;/</span><span style="color:#22863A;">disableRolePrefixing</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">  &lt;/</span><span style="color:#22863A;">securityRealm</span><span style="color:#24292E;">&gt;</span></span></code></pre></div><p>上面的配置不当无法通过 ldap 认证，jenkins 也无法正常登陆。可以把上面一段替换成以下内容</p><div class="language-xml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">xml</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">&lt;</span><span style="color:#85E89D;">securityRealm</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">class</span><span style="color:#E1E4E8;">=</span><span style="color:#9ECBFF;">&quot;hudson.security.HudsonPrivateSecurityRealm&quot;</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">  &lt;</span><span style="color:#85E89D;">disableSignup</span><span style="color:#E1E4E8;">&gt;false&lt;/</span><span style="color:#85E89D;">disableSignup</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">  &lt;</span><span style="color:#85E89D;">enableCaptcha</span><span style="color:#E1E4E8;">&gt;false&lt;/</span><span style="color:#85E89D;">enableCaptcha</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">&lt;/</span><span style="color:#85E89D;">securityRealm</span><span style="color:#E1E4E8;">&gt;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">&lt;</span><span style="color:#22863A;">securityRealm</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">class</span><span style="color:#24292E;">=</span><span style="color:#032F62;">&quot;hudson.security.HudsonPrivateSecurityRealm&quot;</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">  &lt;</span><span style="color:#22863A;">disableSignup</span><span style="color:#24292E;">&gt;false&lt;/</span><span style="color:#22863A;">disableSignup</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">  &lt;</span><span style="color:#22863A;">enableCaptcha</span><span style="color:#24292E;">&gt;false&lt;/</span><span style="color:#22863A;">enableCaptcha</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">&lt;/</span><span style="color:#22863A;">securityRealm</span><span style="color:#24292E;">&gt;</span></span></code></pre></div>`,80),e=[o];function t(c,r,i,E,y,g){return a(),n("div",null,e)}const h=s(p,[["render",t]]);export{u as __pageData,h as default};
