import{_ as s,o as n,c as a,R as p}from"./chunks/framework.zUbWieqp.js";const m=JSON.parse('{"title":"1.创建nginx.conf","description":"","frontmatter":{},"headers":[],"relativePath":"guide/container/dockerfile/9-tengine.md","filePath":"guide/container/dockerfile/9-tengine.md","lastUpdated":1753370025000}'),l={name:"guide/container/dockerfile/9-tengine.md"},o=p(`<h1 id="_1-创建nginx-conf" tabindex="-1">1.创建nginx.conf <a class="header-anchor" href="#_1-创建nginx-conf" aria-label="Permalink to &quot;1.创建nginx.conf&quot;">​</a></h1><p>nginx.conf</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">user</span><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">nginx</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#6A737D;"># This number should be, at maximum, the number of CPU cores on your system. </span></span>
<span class="line"><span style="color:#B392F0;">worker_processes</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">auto</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">error_log</span><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">/var/log/nginx/error.log</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">error</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#B392F0;">pid</span><span style="color:#E1E4E8;">        </span><span style="color:#9ECBFF;">/var/run/nginx.pid</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">events</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">{</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;"># The effective method, used on Linux 2.6+, optmized to serve many clients with each thread.</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">use</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">epoll</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;"># Determines how many clients will be served by each worker process.</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">worker_connections</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">4000</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;"># Accept as many connections as possible, after nginx gets notification about a new connection.</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">multi_accept</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">on</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">http</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">{</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">include</span><span style="color:#E1E4E8;">       </span><span style="color:#9ECBFF;">/etc/nginx/mime.types</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">default_type</span><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">application/octet-stream</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">#long time</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">check_shm_size</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5</span><span style="color:#9ECBFF;">M</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;"># Allow the server to close the connection after a client stops responding. </span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">reset_timedout_connection</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">on</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">client_header_timeout</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">15</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;"># Send the client a &quot;request timed out&quot; if the body is not loaded by this time.</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">client_body_timeout</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">10</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;"># If the client stops reading data, free up the stale client connection after this much time.</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">send_timeout</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">15</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;"># Timeout for keep-alive connections. Server will close connections after this time.</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">keepalive_timeout</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">30</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;"># Number of requests a client can make over the keep-alive connection.</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">keepalive_requests</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">30</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">log_format</span><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">main</span><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">&#39;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#39;</span></span>
<span class="line"><span style="color:#E1E4E8;">                      </span><span style="color:#B392F0;">&#39;$status $body_bytes_sent &quot;$http_referer&quot; &#39;</span></span>
<span class="line"><span style="color:#E1E4E8;">                      </span><span style="color:#B392F0;">&#39;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&#39;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">client_body_buffer_size</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">128</span><span style="color:#9ECBFF;">k</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">client_max_body_size</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">10</span><span style="color:#9ECBFF;">m</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">proxy_read_timeout</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">180</span><span style="color:#9ECBFF;">s</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;"> </span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;"># Compression.</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">gzip</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">on</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">gzip_min_length</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">10240</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">gzip_proxied</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">expired</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">no-cache</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">no-store</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">private</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">auth</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">gzip_types</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">text/plain</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">text/css</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">text/xml</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">text/javascript</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">application/x-javascript</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">application/xml</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">gzip_disable</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;msie6&quot;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;"># Sendfile copies data between one FD and other from within the kernel.</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">sendfile</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">on</span><span style="color:#E1E4E8;">; </span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;"># Don&#39;t buffer data-sends (disable Nagle algorithm).</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">tcp_nodelay</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">on</span><span style="color:#E1E4E8;">; </span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;"># Causes nginx to attempt to send its HTTP response head in one packet,  instead of using partial frames.</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">tcp_nopush</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">on</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">	</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;"># Hide web server information</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">server_tokens</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">off</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">server_info</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">off</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">server_tag</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">off</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;"># redirect server error pages to the static page</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">error_page</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">404</span><span style="color:#E1E4E8;">             </span><span style="color:#9ECBFF;">/404.html</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">error_page</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">500</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">502</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">503</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">504</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/50x.html</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">include</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/etc/nginx/conf.d/</span><span style="color:#79B8FF;">*</span><span style="color:#9ECBFF;">.conf</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">user</span><span style="color:#24292E;">  </span><span style="color:#032F62;">nginx</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#6A737D;"># This number should be, at maximum, the number of CPU cores on your system. </span></span>
<span class="line"><span style="color:#6F42C1;">worker_processes</span><span style="color:#24292E;"> </span><span style="color:#032F62;">auto</span><span style="color:#24292E;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">error_log</span><span style="color:#24292E;">  </span><span style="color:#032F62;">/var/log/nginx/error.log</span><span style="color:#24292E;"> </span><span style="color:#032F62;">error</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#6F42C1;">pid</span><span style="color:#24292E;">        </span><span style="color:#032F62;">/var/run/nginx.pid</span><span style="color:#24292E;">;</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">events</span><span style="color:#24292E;"> </span><span style="color:#032F62;">{</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;"># The effective method, used on Linux 2.6+, optmized to serve many clients with each thread.</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">use</span><span style="color:#24292E;"> </span><span style="color:#032F62;">epoll</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;"># Determines how many clients will be served by each worker process.</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">worker_connections</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">4000</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;"># Accept as many connections as possible, after nginx gets notification about a new connection.</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">multi_accept</span><span style="color:#24292E;"> </span><span style="color:#032F62;">on</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">http</span><span style="color:#24292E;"> </span><span style="color:#032F62;">{</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">include</span><span style="color:#24292E;">       </span><span style="color:#032F62;">/etc/nginx/mime.types</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">default_type</span><span style="color:#24292E;">  </span><span style="color:#032F62;">application/octet-stream</span><span style="color:#24292E;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">#long time</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">check_shm_size</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5</span><span style="color:#032F62;">M</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;"># Allow the server to close the connection after a client stops responding. </span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">reset_timedout_connection</span><span style="color:#24292E;"> </span><span style="color:#032F62;">on</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">client_header_timeout</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">15</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;"># Send the client a &quot;request timed out&quot; if the body is not loaded by this time.</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">client_body_timeout</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">10</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;"># If the client stops reading data, free up the stale client connection after this much time.</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">send_timeout</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">15</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;"># Timeout for keep-alive connections. Server will close connections after this time.</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">keepalive_timeout</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">30</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;"># Number of requests a client can make over the keep-alive connection.</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">keepalive_requests</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">30</span><span style="color:#24292E;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">log_format</span><span style="color:#24292E;">  </span><span style="color:#032F62;">main</span><span style="color:#24292E;">  </span><span style="color:#032F62;">&#39;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#39;</span></span>
<span class="line"><span style="color:#24292E;">                      </span><span style="color:#6F42C1;">&#39;$status $body_bytes_sent &quot;$http_referer&quot; &#39;</span></span>
<span class="line"><span style="color:#24292E;">                      </span><span style="color:#6F42C1;">&#39;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&#39;</span><span style="color:#24292E;">;</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">client_body_buffer_size</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">128</span><span style="color:#032F62;">k</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">client_max_body_size</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">10</span><span style="color:#032F62;">m</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">proxy_read_timeout</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">180</span><span style="color:#032F62;">s</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;"> </span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;"># Compression.</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">gzip</span><span style="color:#24292E;"> </span><span style="color:#032F62;">on</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">gzip_min_length</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">10240</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">gzip_proxied</span><span style="color:#24292E;"> </span><span style="color:#032F62;">expired</span><span style="color:#24292E;"> </span><span style="color:#032F62;">no-cache</span><span style="color:#24292E;"> </span><span style="color:#032F62;">no-store</span><span style="color:#24292E;"> </span><span style="color:#032F62;">private</span><span style="color:#24292E;"> </span><span style="color:#032F62;">auth</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">gzip_types</span><span style="color:#24292E;"> </span><span style="color:#032F62;">text/plain</span><span style="color:#24292E;"> </span><span style="color:#032F62;">text/css</span><span style="color:#24292E;"> </span><span style="color:#032F62;">text/xml</span><span style="color:#24292E;"> </span><span style="color:#032F62;">text/javascript</span><span style="color:#24292E;"> </span><span style="color:#032F62;">application/x-javascript</span><span style="color:#24292E;"> </span><span style="color:#032F62;">application/xml</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">gzip_disable</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;msie6&quot;</span><span style="color:#24292E;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;"># Sendfile copies data between one FD and other from within the kernel.</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">sendfile</span><span style="color:#24292E;"> </span><span style="color:#032F62;">on</span><span style="color:#24292E;">; </span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;"># Don&#39;t buffer data-sends (disable Nagle algorithm).</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">tcp_nodelay</span><span style="color:#24292E;"> </span><span style="color:#032F62;">on</span><span style="color:#24292E;">; </span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;"># Causes nginx to attempt to send its HTTP response head in one packet,  instead of using partial frames.</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">tcp_nopush</span><span style="color:#24292E;"> </span><span style="color:#032F62;">on</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">	</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;"># Hide web server information</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">server_tokens</span><span style="color:#24292E;"> </span><span style="color:#032F62;">off</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">server_info</span><span style="color:#24292E;"> </span><span style="color:#032F62;">off</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">server_tag</span><span style="color:#24292E;"> </span><span style="color:#032F62;">off</span><span style="color:#24292E;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;"># redirect server error pages to the static page</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">error_page</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">404</span><span style="color:#24292E;">             </span><span style="color:#032F62;">/404.html</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">error_page</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">500</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">502</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">503</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">504</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/50x.html</span><span style="color:#24292E;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">include</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/etc/nginx/conf.d/</span><span style="color:#005CC5;">*</span><span style="color:#032F62;">.conf</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre></div><h1 id="_2-创建dockerfile" tabindex="-1">2. 创建<strong>Dockerfile</strong> <a class="header-anchor" href="#_2-创建dockerfile" aria-label="Permalink to &quot;2. 创建**Dockerfile**&quot;">​</a></h1><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">FROM</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">alpine:3.17</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">ENV</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">TENGINE_VERSION</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2.4</span><span style="color:#9ECBFF;">.0</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># nginx: https://git.io/vSIyj</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">RUN</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">rm</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-rf</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/var/cache/apk/</span><span style="color:#79B8FF;">*</span><span style="color:#E1E4E8;"> &amp;&amp; </span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">rm</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-rf</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/tmp/</span><span style="color:#79B8FF;">*</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">ENV</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">CONFIG</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;</span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#9ECBFF;">        --prefix=/etc/nginx </span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#9ECBFF;">        --sbin-path=/usr/sbin/nginx </span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#9ECBFF;">        --modules-path=/usr/lib/nginx/modules </span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#9ECBFF;">        --conf-path=/etc/nginx/nginx.conf </span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#9ECBFF;">        --error-log-path=/var/log/nginx/error.log </span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#9ECBFF;">        --http-log-path=/var/log/nginx/access.log </span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#9ECBFF;">        --pid-path=/var/run/nginx.pid </span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#9ECBFF;">        --lock-path=/var/run/nginx.lock </span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#9ECBFF;">        --http-client-body-temp-path=/var/cache/nginx/client_temp </span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#9ECBFF;">        --http-proxy-temp-path=/var/cache/nginx/proxy_temp </span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#9ECBFF;">        --http-fastcgi-temp-path=/var/cache/nginx/fastcgi_temp </span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#9ECBFF;">        --http-uwsgi-temp-path=/var/cache/nginx/uwsgi_temp </span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#9ECBFF;">        --http-scgi-temp-path=/var/cache/nginx/scgi_temp </span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#9ECBFF;">        --user=nginx </span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#9ECBFF;">        --group=nginx </span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#9ECBFF;">        --with-http_ssl_module </span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#9ECBFF;">        --with-http_realip_module </span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#9ECBFF;">        --with-http_addition_module </span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#9ECBFF;">        --with-http_sub_module </span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#9ECBFF;">        --with-http_dav_module </span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#9ECBFF;">        --with-http_flv_module </span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#9ECBFF;">        --with-http_mp4_module </span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#9ECBFF;">        --with-http_gunzip_module </span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#9ECBFF;">        --with-http_gzip_static_module </span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#9ECBFF;">        --with-http_random_index_module </span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#9ECBFF;">        --with-http_secure_link_module </span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#9ECBFF;">        --with-http_stub_status_module </span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#9ECBFF;">        --with-http_auth_request_module </span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#9ECBFF;">        --with-http_xslt_module=dynamic </span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#9ECBFF;">        --with-http_image_filter_module=dynamic </span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#9ECBFF;">        --with-http_geoip_module=dynamic </span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#9ECBFF;">        --with-threads </span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#9ECBFF;">        --with-stream </span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#9ECBFF;">        --with-stream_ssl_module </span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#9ECBFF;">        --with-stream_ssl_preread_module </span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#9ECBFF;">        --with-stream_realip_module </span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#9ECBFF;">        --with-stream_geoip_module=dynamic </span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#9ECBFF;">        --with-http_slice_module </span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#9ECBFF;">        --with-mail </span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#9ECBFF;">        --with-mail_ssl_module </span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#9ECBFF;">        --with-compat </span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#9ECBFF;">        --with-file-aio </span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#9ECBFF;">        --with-http_v2_module </span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#9ECBFF;">        --add-module=modules/ngx_http_upstream_check_module </span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#9ECBFF;">        --add-module=modules/headers-more-nginx-module-0.33 </span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#9ECBFF;">	--add-module=modules/ngx_http_upstream_session_sticky_module </span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#9ECBFF;">        &quot;</span></span>
<span class="line"><span style="color:#B392F0;">RUN</span><span style="color:#E1E4E8;">     </span><span style="color:#9ECBFF;">addgroup</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-S</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">nginx</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#E1E4E8;">        &amp;&amp; </span><span style="color:#B392F0;">adduser</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-D</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-S</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-h</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/var/cache/nginx</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-s</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/sbin/nologin</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-G</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">nginx</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">nginx</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#E1E4E8;">        &amp;&amp; </span><span style="color:#B392F0;">adduser</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-u</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">82</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-D</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-S</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-G</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">www-data</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">www-data</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#E1E4E8;">        &amp;&amp; </span><span style="color:#B392F0;">apk</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">add</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--no-cache</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--virtual</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">.build-deps</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#E1E4E8;">                </span><span style="color:#9ECBFF;">gcc</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#E1E4E8;">                </span><span style="color:#9ECBFF;">libc-dev</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#E1E4E8;">                </span><span style="color:#9ECBFF;">make</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#E1E4E8;">                </span><span style="color:#9ECBFF;">openssl-dev</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#E1E4E8;">                </span><span style="color:#9ECBFF;">pcre-dev</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#E1E4E8;">                </span><span style="color:#9ECBFF;">zlib-dev</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#E1E4E8;">                </span><span style="color:#9ECBFF;">linux-headers</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#E1E4E8;">                </span><span style="color:#9ECBFF;">curl</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#E1E4E8;">                </span><span style="color:#9ECBFF;">libxslt-dev</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#E1E4E8;">                </span><span style="color:#9ECBFF;">gd-dev</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#E1E4E8;">                </span><span style="color:#9ECBFF;">geoip-dev</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#E1E4E8;">        &amp;&amp; </span><span style="color:#B392F0;">curl</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-L</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;https://github.com/alibaba/tengine/archive/</span><span style="color:#E1E4E8;">$TENGINE_VERSION</span><span style="color:#9ECBFF;">.tar.gz&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-o</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">tengine.tar.gz</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#E1E4E8;">        &amp;&amp; </span><span style="color:#B392F0;">mkdir</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-p</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/usr/src</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#E1E4E8;">        &amp;&amp; </span><span style="color:#B392F0;">tar</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-zxC</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/usr/src</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-f</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">tengine.tar.gz</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#E1E4E8;">        &amp;&amp; </span><span style="color:#B392F0;">rm</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">tengine.tar.gz</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#E1E4E8;">        &amp;&amp; </span><span style="color:#79B8FF;">cd</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/usr/src/tengine-</span><span style="color:#E1E4E8;">$TENGINE_VERSION </span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#E1E4E8;">        &amp;&amp; </span><span style="color:#B392F0;">curl</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-L</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;https://github.com/openresty/headers-more-nginx-module/archive/v0.33.tar.gz&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-o</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">more.tar.gz</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#E1E4E8;">        &amp;&amp; </span><span style="color:#B392F0;">tar</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-zxC</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/usr/src/tengine-</span><span style="color:#E1E4E8;">$TENGINE_VERSION</span><span style="color:#9ECBFF;">/modules</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-f</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">more.tar.gz</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#E1E4E8;">	&amp;&amp; </span><span style="color:#B392F0;">rm</span><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">more.tar.gz</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#E1E4E8;">	&amp;&amp; </span><span style="color:#B392F0;">ls</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-l</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/usr/src/tengine-</span><span style="color:#E1E4E8;">$TENGINE_VERSION</span><span style="color:#9ECBFF;">/modules</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#E1E4E8;">	&amp;&amp; </span><span style="color:#B392F0;">./configure</span><span style="color:#E1E4E8;"> $CONFIG </span><span style="color:#79B8FF;">--with-debug</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#E1E4E8;">        &amp;&amp; </span><span style="color:#B392F0;">make</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-j</span><span style="color:#9ECBFF;">$(</span><span style="color:#B392F0;">getconf</span><span style="color:#9ECBFF;"> _NPROCESSORS_ONLN)</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#E1E4E8;">        &amp;&amp; </span><span style="color:#B392F0;">mv</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">objs/nginx</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">objs/nginx-debug</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#E1E4E8;">        &amp;&amp; </span><span style="color:#B392F0;">mv</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">objs/ngx_http_xslt_filter_module.so</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">objs/ngx_http_xslt_filter_module-debug.so</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#E1E4E8;">        &amp;&amp; </span><span style="color:#B392F0;">mv</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">objs/ngx_http_image_filter_module.so</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">objs/ngx_http_image_filter_module-debug.so</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#E1E4E8;">        &amp;&amp; </span><span style="color:#B392F0;">mv</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">objs/ngx_http_geoip_module.so</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">objs/ngx_http_geoip_module-debug.so</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#E1E4E8;">        &amp;&amp; </span><span style="color:#B392F0;">mv</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">objs/ngx_stream_geoip_module.so</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">objs/ngx_stream_geoip_module-debug.so</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#E1E4E8;">        &amp;&amp; </span><span style="color:#B392F0;">./configure</span><span style="color:#E1E4E8;"> $CONFIG </span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#E1E4E8;">        &amp;&amp; </span><span style="color:#B392F0;">make</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-j</span><span style="color:#9ECBFF;">$(</span><span style="color:#B392F0;">getconf</span><span style="color:#9ECBFF;"> _NPROCESSORS_ONLN)</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#E1E4E8;">        &amp;&amp; </span><span style="color:#B392F0;">make</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">install</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#E1E4E8;">        &amp;&amp; </span><span style="color:#B392F0;">rm</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-rf</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/etc/nginx/html/</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#E1E4E8;">        &amp;&amp; </span><span style="color:#B392F0;">mkdir</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/etc/nginx/conf.d/</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#E1E4E8;">        &amp;&amp; </span><span style="color:#B392F0;">mkdir</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-p</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/usr/share/nginx/html/</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#E1E4E8;">        &amp;&amp; </span><span style="color:#B392F0;">install</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-m644</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">html/index.html</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/usr/share/nginx/html/</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#E1E4E8;">        &amp;&amp; </span><span style="color:#B392F0;">install</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-m644</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">html/50x.html</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/usr/share/nginx/html/</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#E1E4E8;">        &amp;&amp; </span><span style="color:#B392F0;">install</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-m755</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">objs/nginx-debug</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/usr/sbin/nginx-debug</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#E1E4E8;">        &amp;&amp; </span><span style="color:#B392F0;">install</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-m755</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">objs/ngx_http_xslt_filter_module-debug.so</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/usr/lib/nginx/modules/ngx_http_xslt_filter_module-debug.so</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#E1E4E8;">        &amp;&amp; </span><span style="color:#B392F0;">install</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-m755</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">objs/ngx_http_image_filter_module-debug.so</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/usr/lib/nginx/modules/ngx_http_image_filter_module-debug.so</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#E1E4E8;">        &amp;&amp; </span><span style="color:#B392F0;">install</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-m755</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">objs/ngx_http_geoip_module-debug.so</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/usr/lib/nginx/modules/ngx_http_geoip_module-debug.so</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#E1E4E8;">        &amp;&amp; </span><span style="color:#B392F0;">install</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-m755</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">objs/ngx_stream_geoip_module-debug.so</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/usr/lib/nginx/modules/ngx_stream_geoip_module-debug.so</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#E1E4E8;">        &amp;&amp; </span><span style="color:#B392F0;">ln</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-s</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">../../usr/lib/nginx/modules</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/etc/nginx/modules</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#E1E4E8;">        &amp;&amp; </span><span style="color:#B392F0;">strip</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/usr/sbin/nginx</span><span style="color:#79B8FF;">*</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#E1E4E8;">        &amp;&amp; </span><span style="color:#B392F0;">strip</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/usr/lib/nginx/modules/</span><span style="color:#79B8FF;">*</span><span style="color:#9ECBFF;">.so</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#E1E4E8;">        &amp;&amp; </span><span style="color:#B392F0;">rm</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-rf</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/usr/src/tengine-</span><span style="color:#E1E4E8;">$NGINX_VERSION </span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#6A737D;"># Bring in gettext so we can get \`envsubst\`, then throw</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#6A737D;"># the rest away. To do this, we need to install \`gettext\`</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#6A737D;"># then move \`envsubst\` out of the way so \`gettext\` can</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#6A737D;"># be deleted completely, then move \`envsubst\` back.</span></span>
<span class="line"><span style="color:#E1E4E8;">        &amp;&amp; </span><span style="color:#B392F0;">apk</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">add</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--no-cache</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--virtual</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">.gettext</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">gettext</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#E1E4E8;">        &amp;&amp; </span><span style="color:#B392F0;">mv</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/usr/bin/envsubst</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/tmp/</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#E1E4E8;">        &amp;&amp; runDeps</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&quot;$( </span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#9ECBFF;">                </span><span style="color:#B392F0;">scanelf</span><span style="color:#9ECBFF;"> </span><span style="color:#79B8FF;">--needed</span><span style="color:#9ECBFF;"> </span><span style="color:#79B8FF;">--nobanner</span><span style="color:#9ECBFF;"> </span><span style="color:#79B8FF;">--format</span><span style="color:#9ECBFF;"> &#39;%n#p&#39; /usr/sbin/nginx /usr/lib/nginx/modules/</span><span style="color:#79B8FF;">*</span><span style="color:#9ECBFF;">.so /tmp/envsubst </span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#9ECBFF;">                        </span><span style="color:#F97583;">|</span><span style="color:#9ECBFF;"> </span><span style="color:#B392F0;">tr</span><span style="color:#9ECBFF;"> &#39;,&#39; &#39;\\n&#39; </span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#9ECBFF;">                        </span><span style="color:#F97583;">|</span><span style="color:#9ECBFF;"> </span><span style="color:#B392F0;">sort</span><span style="color:#9ECBFF;"> </span><span style="color:#79B8FF;">-u</span><span style="color:#9ECBFF;"> </span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#9ECBFF;">                        </span><span style="color:#F97583;">|</span><span style="color:#9ECBFF;"> </span><span style="color:#B392F0;">awk</span><span style="color:#9ECBFF;"> &#39;system(&quot;[ -e /usr/local/lib/&quot; $1 &quot; ]&quot;) == 0 { next } { print &quot;so:&quot; $1 }&#39; </span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#9ECBFF;">        )&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#E1E4E8;">        &amp;&amp; </span><span style="color:#B392F0;">apk</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">add</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--no-cache</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--virtual</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">.nginx-rundeps</span><span style="color:#E1E4E8;"> $runDeps </span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#E1E4E8;">        &amp;&amp; </span><span style="color:#B392F0;">apk</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">del</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">.build-deps</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#E1E4E8;">        &amp;&amp; </span><span style="color:#B392F0;">apk</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">del</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">.gettext</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#E1E4E8;">        &amp;&amp; </span><span style="color:#B392F0;">mv</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/tmp/envsubst</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/usr/local/bin/</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#6A737D;"># Bring in tzdata so users could set the timezones through the environment</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#6A737D;"># variables</span></span>
<span class="line"><span style="color:#E1E4E8;">        &amp;&amp; </span><span style="color:#B392F0;">apk</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">add</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--no-cache</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">tzdata</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#6A737D;"># Bring in curl and ca-certificates to make registering on DNS SD easier</span></span>
<span class="line"><span style="color:#E1E4E8;">        &amp;&amp; </span><span style="color:#B392F0;">apk</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">add</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--no-cache</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">curl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">ca-certificates</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#6A737D;"># forward request and error logs to docker log collector</span></span>
<span class="line"><span style="color:#E1E4E8;">        &amp;&amp; </span><span style="color:#B392F0;">ln</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-sf</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/dev/stdout</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/var/log/nginx/access.log</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#E1E4E8;">        &amp;&amp; </span><span style="color:#B392F0;">ln</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-sf</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/dev/stderr</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/var/log/nginx/error.log</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">COPY</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">nginx.conf</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/etc/nginx/nginx.conf</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">EXPOSE</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">80</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">443</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">STOPSIGNAL</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">SIGTERM</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">CMD</span><span style="color:#E1E4E8;"> [</span><span style="color:#9ECBFF;">&quot;nginx&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&quot;-g&quot;,</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;daemon off;&quot;]</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">FROM</span><span style="color:#24292E;"> </span><span style="color:#032F62;">alpine:3.17</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">ENV</span><span style="color:#24292E;"> </span><span style="color:#032F62;">TENGINE_VERSION</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2.4</span><span style="color:#032F62;">.0</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># nginx: https://git.io/vSIyj</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">RUN</span><span style="color:#24292E;"> </span><span style="color:#032F62;">rm</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-rf</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/var/cache/apk/</span><span style="color:#005CC5;">*</span><span style="color:#24292E;"> &amp;&amp; </span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">rm</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-rf</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/tmp/</span><span style="color:#005CC5;">*</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">ENV</span><span style="color:#24292E;"> </span><span style="color:#032F62;">CONFIG</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;</span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#032F62;">        --prefix=/etc/nginx </span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#032F62;">        --sbin-path=/usr/sbin/nginx </span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#032F62;">        --modules-path=/usr/lib/nginx/modules </span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#032F62;">        --conf-path=/etc/nginx/nginx.conf </span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#032F62;">        --error-log-path=/var/log/nginx/error.log </span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#032F62;">        --http-log-path=/var/log/nginx/access.log </span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#032F62;">        --pid-path=/var/run/nginx.pid </span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#032F62;">        --lock-path=/var/run/nginx.lock </span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#032F62;">        --http-client-body-temp-path=/var/cache/nginx/client_temp </span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#032F62;">        --http-proxy-temp-path=/var/cache/nginx/proxy_temp </span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#032F62;">        --http-fastcgi-temp-path=/var/cache/nginx/fastcgi_temp </span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#032F62;">        --http-uwsgi-temp-path=/var/cache/nginx/uwsgi_temp </span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#032F62;">        --http-scgi-temp-path=/var/cache/nginx/scgi_temp </span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#032F62;">        --user=nginx </span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#032F62;">        --group=nginx </span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#032F62;">        --with-http_ssl_module </span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#032F62;">        --with-http_realip_module </span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#032F62;">        --with-http_addition_module </span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#032F62;">        --with-http_sub_module </span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#032F62;">        --with-http_dav_module </span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#032F62;">        --with-http_flv_module </span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#032F62;">        --with-http_mp4_module </span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#032F62;">        --with-http_gunzip_module </span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#032F62;">        --with-http_gzip_static_module </span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#032F62;">        --with-http_random_index_module </span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#032F62;">        --with-http_secure_link_module </span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#032F62;">        --with-http_stub_status_module </span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#032F62;">        --with-http_auth_request_module </span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#032F62;">        --with-http_xslt_module=dynamic </span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#032F62;">        --with-http_image_filter_module=dynamic </span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#032F62;">        --with-http_geoip_module=dynamic </span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#032F62;">        --with-threads </span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#032F62;">        --with-stream </span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#032F62;">        --with-stream_ssl_module </span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#032F62;">        --with-stream_ssl_preread_module </span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#032F62;">        --with-stream_realip_module </span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#032F62;">        --with-stream_geoip_module=dynamic </span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#032F62;">        --with-http_slice_module </span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#032F62;">        --with-mail </span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#032F62;">        --with-mail_ssl_module </span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#032F62;">        --with-compat </span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#032F62;">        --with-file-aio </span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#032F62;">        --with-http_v2_module </span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#032F62;">        --add-module=modules/ngx_http_upstream_check_module </span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#032F62;">        --add-module=modules/headers-more-nginx-module-0.33 </span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#032F62;">	--add-module=modules/ngx_http_upstream_session_sticky_module </span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#032F62;">        &quot;</span></span>
<span class="line"><span style="color:#6F42C1;">RUN</span><span style="color:#24292E;">     </span><span style="color:#032F62;">addgroup</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-S</span><span style="color:#24292E;"> </span><span style="color:#032F62;">nginx</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#24292E;">        &amp;&amp; </span><span style="color:#6F42C1;">adduser</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-D</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-S</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-h</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/var/cache/nginx</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-s</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/sbin/nologin</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-G</span><span style="color:#24292E;"> </span><span style="color:#032F62;">nginx</span><span style="color:#24292E;"> </span><span style="color:#032F62;">nginx</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#24292E;">        &amp;&amp; </span><span style="color:#6F42C1;">adduser</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-u</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">82</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-D</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-S</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-G</span><span style="color:#24292E;"> </span><span style="color:#032F62;">www-data</span><span style="color:#24292E;"> </span><span style="color:#032F62;">www-data</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#24292E;">        &amp;&amp; </span><span style="color:#6F42C1;">apk</span><span style="color:#24292E;"> </span><span style="color:#032F62;">add</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--no-cache</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--virtual</span><span style="color:#24292E;"> </span><span style="color:#032F62;">.build-deps</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#24292E;">                </span><span style="color:#032F62;">gcc</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#24292E;">                </span><span style="color:#032F62;">libc-dev</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#24292E;">                </span><span style="color:#032F62;">make</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#24292E;">                </span><span style="color:#032F62;">openssl-dev</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#24292E;">                </span><span style="color:#032F62;">pcre-dev</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#24292E;">                </span><span style="color:#032F62;">zlib-dev</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#24292E;">                </span><span style="color:#032F62;">linux-headers</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#24292E;">                </span><span style="color:#032F62;">curl</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#24292E;">                </span><span style="color:#032F62;">libxslt-dev</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#24292E;">                </span><span style="color:#032F62;">gd-dev</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#24292E;">                </span><span style="color:#032F62;">geoip-dev</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#24292E;">        &amp;&amp; </span><span style="color:#6F42C1;">curl</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-L</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;https://github.com/alibaba/tengine/archive/</span><span style="color:#24292E;">$TENGINE_VERSION</span><span style="color:#032F62;">.tar.gz&quot;</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-o</span><span style="color:#24292E;"> </span><span style="color:#032F62;">tengine.tar.gz</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#24292E;">        &amp;&amp; </span><span style="color:#6F42C1;">mkdir</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-p</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/usr/src</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#24292E;">        &amp;&amp; </span><span style="color:#6F42C1;">tar</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-zxC</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/usr/src</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-f</span><span style="color:#24292E;"> </span><span style="color:#032F62;">tengine.tar.gz</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#24292E;">        &amp;&amp; </span><span style="color:#6F42C1;">rm</span><span style="color:#24292E;"> </span><span style="color:#032F62;">tengine.tar.gz</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#24292E;">        &amp;&amp; </span><span style="color:#005CC5;">cd</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/usr/src/tengine-</span><span style="color:#24292E;">$TENGINE_VERSION </span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#24292E;">        &amp;&amp; </span><span style="color:#6F42C1;">curl</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-L</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;https://github.com/openresty/headers-more-nginx-module/archive/v0.33.tar.gz&quot;</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-o</span><span style="color:#24292E;"> </span><span style="color:#032F62;">more.tar.gz</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#24292E;">        &amp;&amp; </span><span style="color:#6F42C1;">tar</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-zxC</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/usr/src/tengine-</span><span style="color:#24292E;">$TENGINE_VERSION</span><span style="color:#032F62;">/modules</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-f</span><span style="color:#24292E;"> </span><span style="color:#032F62;">more.tar.gz</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#24292E;">	&amp;&amp; </span><span style="color:#6F42C1;">rm</span><span style="color:#24292E;">  </span><span style="color:#032F62;">more.tar.gz</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#24292E;">	&amp;&amp; </span><span style="color:#6F42C1;">ls</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-l</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/usr/src/tengine-</span><span style="color:#24292E;">$TENGINE_VERSION</span><span style="color:#032F62;">/modules</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#24292E;">	&amp;&amp; </span><span style="color:#6F42C1;">./configure</span><span style="color:#24292E;"> $CONFIG </span><span style="color:#005CC5;">--with-debug</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#24292E;">        &amp;&amp; </span><span style="color:#6F42C1;">make</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-j</span><span style="color:#032F62;">$(</span><span style="color:#6F42C1;">getconf</span><span style="color:#032F62;"> _NPROCESSORS_ONLN)</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#24292E;">        &amp;&amp; </span><span style="color:#6F42C1;">mv</span><span style="color:#24292E;"> </span><span style="color:#032F62;">objs/nginx</span><span style="color:#24292E;"> </span><span style="color:#032F62;">objs/nginx-debug</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#24292E;">        &amp;&amp; </span><span style="color:#6F42C1;">mv</span><span style="color:#24292E;"> </span><span style="color:#032F62;">objs/ngx_http_xslt_filter_module.so</span><span style="color:#24292E;"> </span><span style="color:#032F62;">objs/ngx_http_xslt_filter_module-debug.so</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#24292E;">        &amp;&amp; </span><span style="color:#6F42C1;">mv</span><span style="color:#24292E;"> </span><span style="color:#032F62;">objs/ngx_http_image_filter_module.so</span><span style="color:#24292E;"> </span><span style="color:#032F62;">objs/ngx_http_image_filter_module-debug.so</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#24292E;">        &amp;&amp; </span><span style="color:#6F42C1;">mv</span><span style="color:#24292E;"> </span><span style="color:#032F62;">objs/ngx_http_geoip_module.so</span><span style="color:#24292E;"> </span><span style="color:#032F62;">objs/ngx_http_geoip_module-debug.so</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#24292E;">        &amp;&amp; </span><span style="color:#6F42C1;">mv</span><span style="color:#24292E;"> </span><span style="color:#032F62;">objs/ngx_stream_geoip_module.so</span><span style="color:#24292E;"> </span><span style="color:#032F62;">objs/ngx_stream_geoip_module-debug.so</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#24292E;">        &amp;&amp; </span><span style="color:#6F42C1;">./configure</span><span style="color:#24292E;"> $CONFIG </span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#24292E;">        &amp;&amp; </span><span style="color:#6F42C1;">make</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-j</span><span style="color:#032F62;">$(</span><span style="color:#6F42C1;">getconf</span><span style="color:#032F62;"> _NPROCESSORS_ONLN)</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#24292E;">        &amp;&amp; </span><span style="color:#6F42C1;">make</span><span style="color:#24292E;"> </span><span style="color:#032F62;">install</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#24292E;">        &amp;&amp; </span><span style="color:#6F42C1;">rm</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-rf</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/etc/nginx/html/</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#24292E;">        &amp;&amp; </span><span style="color:#6F42C1;">mkdir</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/etc/nginx/conf.d/</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#24292E;">        &amp;&amp; </span><span style="color:#6F42C1;">mkdir</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-p</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/usr/share/nginx/html/</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#24292E;">        &amp;&amp; </span><span style="color:#6F42C1;">install</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-m644</span><span style="color:#24292E;"> </span><span style="color:#032F62;">html/index.html</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/usr/share/nginx/html/</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#24292E;">        &amp;&amp; </span><span style="color:#6F42C1;">install</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-m644</span><span style="color:#24292E;"> </span><span style="color:#032F62;">html/50x.html</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/usr/share/nginx/html/</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#24292E;">        &amp;&amp; </span><span style="color:#6F42C1;">install</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-m755</span><span style="color:#24292E;"> </span><span style="color:#032F62;">objs/nginx-debug</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/usr/sbin/nginx-debug</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#24292E;">        &amp;&amp; </span><span style="color:#6F42C1;">install</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-m755</span><span style="color:#24292E;"> </span><span style="color:#032F62;">objs/ngx_http_xslt_filter_module-debug.so</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/usr/lib/nginx/modules/ngx_http_xslt_filter_module-debug.so</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#24292E;">        &amp;&amp; </span><span style="color:#6F42C1;">install</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-m755</span><span style="color:#24292E;"> </span><span style="color:#032F62;">objs/ngx_http_image_filter_module-debug.so</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/usr/lib/nginx/modules/ngx_http_image_filter_module-debug.so</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#24292E;">        &amp;&amp; </span><span style="color:#6F42C1;">install</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-m755</span><span style="color:#24292E;"> </span><span style="color:#032F62;">objs/ngx_http_geoip_module-debug.so</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/usr/lib/nginx/modules/ngx_http_geoip_module-debug.so</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#24292E;">        &amp;&amp; </span><span style="color:#6F42C1;">install</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-m755</span><span style="color:#24292E;"> </span><span style="color:#032F62;">objs/ngx_stream_geoip_module-debug.so</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/usr/lib/nginx/modules/ngx_stream_geoip_module-debug.so</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#24292E;">        &amp;&amp; </span><span style="color:#6F42C1;">ln</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-s</span><span style="color:#24292E;"> </span><span style="color:#032F62;">../../usr/lib/nginx/modules</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/etc/nginx/modules</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#24292E;">        &amp;&amp; </span><span style="color:#6F42C1;">strip</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/usr/sbin/nginx</span><span style="color:#005CC5;">*</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#24292E;">        &amp;&amp; </span><span style="color:#6F42C1;">strip</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/usr/lib/nginx/modules/</span><span style="color:#005CC5;">*</span><span style="color:#032F62;">.so</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#24292E;">        &amp;&amp; </span><span style="color:#6F42C1;">rm</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-rf</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/usr/src/tengine-</span><span style="color:#24292E;">$NGINX_VERSION </span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6A737D;"># Bring in gettext so we can get \`envsubst\`, then throw</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6A737D;"># the rest away. To do this, we need to install \`gettext\`</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6A737D;"># then move \`envsubst\` out of the way so \`gettext\` can</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6A737D;"># be deleted completely, then move \`envsubst\` back.</span></span>
<span class="line"><span style="color:#24292E;">        &amp;&amp; </span><span style="color:#6F42C1;">apk</span><span style="color:#24292E;"> </span><span style="color:#032F62;">add</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--no-cache</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--virtual</span><span style="color:#24292E;"> </span><span style="color:#032F62;">.gettext</span><span style="color:#24292E;"> </span><span style="color:#032F62;">gettext</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#24292E;">        &amp;&amp; </span><span style="color:#6F42C1;">mv</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/usr/bin/envsubst</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/tmp/</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#24292E;">        &amp;&amp; runDeps</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&quot;$( </span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#032F62;">                </span><span style="color:#6F42C1;">scanelf</span><span style="color:#032F62;"> </span><span style="color:#005CC5;">--needed</span><span style="color:#032F62;"> </span><span style="color:#005CC5;">--nobanner</span><span style="color:#032F62;"> </span><span style="color:#005CC5;">--format</span><span style="color:#032F62;"> &#39;%n#p&#39; /usr/sbin/nginx /usr/lib/nginx/modules/</span><span style="color:#005CC5;">*</span><span style="color:#032F62;">.so /tmp/envsubst </span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#032F62;">                        </span><span style="color:#D73A49;">|</span><span style="color:#032F62;"> </span><span style="color:#6F42C1;">tr</span><span style="color:#032F62;"> &#39;,&#39; &#39;\\n&#39; </span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#032F62;">                        </span><span style="color:#D73A49;">|</span><span style="color:#032F62;"> </span><span style="color:#6F42C1;">sort</span><span style="color:#032F62;"> </span><span style="color:#005CC5;">-u</span><span style="color:#032F62;"> </span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#032F62;">                        </span><span style="color:#D73A49;">|</span><span style="color:#032F62;"> </span><span style="color:#6F42C1;">awk</span><span style="color:#032F62;"> &#39;system(&quot;[ -e /usr/local/lib/&quot; $1 &quot; ]&quot;) == 0 { next } { print &quot;so:&quot; $1 }&#39; </span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#032F62;">        )&quot;</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#24292E;">        &amp;&amp; </span><span style="color:#6F42C1;">apk</span><span style="color:#24292E;"> </span><span style="color:#032F62;">add</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--no-cache</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--virtual</span><span style="color:#24292E;"> </span><span style="color:#032F62;">.nginx-rundeps</span><span style="color:#24292E;"> $runDeps </span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#24292E;">        &amp;&amp; </span><span style="color:#6F42C1;">apk</span><span style="color:#24292E;"> </span><span style="color:#032F62;">del</span><span style="color:#24292E;"> </span><span style="color:#032F62;">.build-deps</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#24292E;">        &amp;&amp; </span><span style="color:#6F42C1;">apk</span><span style="color:#24292E;"> </span><span style="color:#032F62;">del</span><span style="color:#24292E;"> </span><span style="color:#032F62;">.gettext</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#24292E;">        &amp;&amp; </span><span style="color:#6F42C1;">mv</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/tmp/envsubst</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/usr/local/bin/</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6A737D;"># Bring in tzdata so users could set the timezones through the environment</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6A737D;"># variables</span></span>
<span class="line"><span style="color:#24292E;">        &amp;&amp; </span><span style="color:#6F42C1;">apk</span><span style="color:#24292E;"> </span><span style="color:#032F62;">add</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--no-cache</span><span style="color:#24292E;"> </span><span style="color:#032F62;">tzdata</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6A737D;"># Bring in curl and ca-certificates to make registering on DNS SD easier</span></span>
<span class="line"><span style="color:#24292E;">        &amp;&amp; </span><span style="color:#6F42C1;">apk</span><span style="color:#24292E;"> </span><span style="color:#032F62;">add</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--no-cache</span><span style="color:#24292E;"> </span><span style="color:#032F62;">curl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">ca-certificates</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6A737D;"># forward request and error logs to docker log collector</span></span>
<span class="line"><span style="color:#24292E;">        &amp;&amp; </span><span style="color:#6F42C1;">ln</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-sf</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/dev/stdout</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/var/log/nginx/access.log</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#24292E;">        &amp;&amp; </span><span style="color:#6F42C1;">ln</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-sf</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/dev/stderr</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/var/log/nginx/error.log</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">COPY</span><span style="color:#24292E;"> </span><span style="color:#032F62;">nginx.conf</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/etc/nginx/nginx.conf</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">EXPOSE</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">80</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">443</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">STOPSIGNAL</span><span style="color:#24292E;"> </span><span style="color:#032F62;">SIGTERM</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">CMD</span><span style="color:#24292E;"> [</span><span style="color:#032F62;">&quot;nginx&quot;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;-g&quot;,</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;daemon off;&quot;]</span></span></code></pre></div><h1 id="_3-创建docker-compose-yml" tabindex="-1">3.创建docker-compose.yml <a class="header-anchor" href="#_3-创建docker-compose-yml" aria-label="Permalink to &quot;3.创建docker-compose.yml&quot;">​</a></h1><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;"># cat docker-compose.yml </span></span>
<span class="line"><span style="color:#85E89D;">version</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&#39;3&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#85E89D;">services</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">tengine</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">image</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">xxx/tengine:2.4.0</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">hostname</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">tengine</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">container_name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">tengine</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">ports</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      - </span><span style="color:#9ECBFF;">&quot;80:80&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">      - </span><span style="color:#9ECBFF;">&quot;443:443&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">volumes</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#6A737D;"># 配置文件目录</span></span>
<span class="line"><span style="color:#E1E4E8;">      - </span><span style="color:#9ECBFF;">/data/tengine/conf.d/:/etc/nginx/conf.d/</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#6A737D;"># ssl 证书文件</span></span>
<span class="line"><span style="color:#E1E4E8;">      - </span><span style="color:#9ECBFF;">/data/tengine/certs/:/etc/nginx/certs/</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#6A737D;"># 日志文件</span></span>
<span class="line"><span style="color:#E1E4E8;">      - </span><span style="color:#9ECBFF;">/data/tengine/logs/:/var/log/nginx/</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">restart</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">always</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;"># cat docker-compose.yml </span></span>
<span class="line"><span style="color:#22863A;">version</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&#39;3&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#22863A;">services</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">tengine</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">image</span><span style="color:#24292E;">: </span><span style="color:#032F62;">xxx/tengine:2.4.0</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">hostname</span><span style="color:#24292E;">: </span><span style="color:#032F62;">tengine</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">container_name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">tengine</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">ports</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      - </span><span style="color:#032F62;">&quot;80:80&quot;</span></span>
<span class="line"><span style="color:#24292E;">      - </span><span style="color:#032F62;">&quot;443:443&quot;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">volumes</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#6A737D;"># 配置文件目录</span></span>
<span class="line"><span style="color:#24292E;">      - </span><span style="color:#032F62;">/data/tengine/conf.d/:/etc/nginx/conf.d/</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#6A737D;"># ssl 证书文件</span></span>
<span class="line"><span style="color:#24292E;">      - </span><span style="color:#032F62;">/data/tengine/certs/:/etc/nginx/certs/</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#6A737D;"># 日志文件</span></span>
<span class="line"><span style="color:#24292E;">      - </span><span style="color:#032F62;">/data/tengine/logs/:/var/log/nginx/</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">restart</span><span style="color:#24292E;">: </span><span style="color:#032F62;">always</span></span></code></pre></div><ul><li>启动</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">docker</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">compose</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">up</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-d</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">docker</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">compose</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">ls</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">docker</span><span style="color:#24292E;"> </span><span style="color:#032F62;">compose</span><span style="color:#24292E;"> </span><span style="color:#032F62;">up</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-d</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">docker</span><span style="color:#24292E;"> </span><span style="color:#032F62;">compose</span><span style="color:#24292E;"> </span><span style="color:#032F62;">ls</span></span></code></pre></div><h1 id="_4-编译" tabindex="-1">4.编译 <a class="header-anchor" href="#_4-编译" aria-label="Permalink to &quot;4.编译&quot;">​</a></h1><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">docker</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">build</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-t</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">tengine:2.4.0</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">.</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">docker</span><span style="color:#24292E;"> </span><span style="color:#032F62;">build</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-t</span><span style="color:#24292E;"> </span><span style="color:#032F62;">tengine:2.4.0</span><span style="color:#24292E;"> </span><span style="color:#032F62;">.</span></span></code></pre></div>`,11),e=[o];function t(c,r,y,E,F,i){return n(),a("div",null,e)}const B=s(l,[["render",t]]);export{m as __pageData,B as default};
