import{_ as s,o as a,c as n,R as l}from"./chunks/framework.zUbWieqp.js";const _=JSON.parse('{"title":"","description":"","frontmatter":{},"headers":[],"relativePath":"guide/Linux/Monitor/Prometheus/monitor_project/9-kafka.md","filePath":"guide/Linux/Monitor/Prometheus/monitor_project/9-kafka.md","lastUpdated":1732185027000}'),e={name:"guide/Linux/Monitor/Prometheus/monitor_project/9-kafka.md"},p=l(`<h2 id="规则" tabindex="-1">规则 <a class="header-anchor" href="#规则" aria-label="Permalink to &quot;规则&quot;">​</a></h2><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"></span>
<span class="line"><span style="color:#85E89D;">groups</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">- </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Kafka_Alerts</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">rules</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    - </span><span style="color:#85E89D;">alert</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Offline_Partiton_Count</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">expr</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">sum(kafka_controller_KafkaController_OfflinePartitionsCount{executor_name=&quot;kafka&quot;})by(service_name)  &gt; 0</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">for</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">1m</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">labels</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">severity</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">critical</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">annotations</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">summary</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&#39;Kafka {{ $labels.service_name }}: {{ $value }} partitons offline&#39;</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">description</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&#39;After successful leader election, if the leader for partition dies, then the partition moves to the OfflinePartition state. Offline partitions are not available for reading and writing. Restart the brokers, if needed, and check the logs for errors.&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    - </span><span style="color:#85E89D;">alert</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Under_Replicated_Partition_Count</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">expr</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">sum(kafka_server_ReplicaManager_UnderReplicatedPartitions{executor_name=&quot;kafka&quot;})by(service_name) &gt; 0</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">for</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">1m</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">labels</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">severity</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">critical</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">annotations</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">summary</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&#39;Kafka {{ $labels.service_name }}: {{ $value }} under replicated partitons&#39;</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">description</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&#39;Under-replicated partitions means that one or more replicas are not available. This is usually because a broker is down.  Restart the broker, and check for errors in the logs.&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    - </span><span style="color:#85E89D;">alert</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Active_Controller</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">expr</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">sum(kafka_controller_KafkaController_ActiveControllerCount{executor_name=&quot;kafka&quot;})by(service_name) != 1</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">for</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">1m</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">labels</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">severity</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">critical</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">annotations</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">summary</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&#39;Kafka {{ $labels.service_name }}: No active controller&#39;</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">description</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&#39;No broker in the cluster is reporting as the active controller in the last 1 minute interval. During steady state there should be only one active controller per cluster.&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    - </span><span style="color:#85E89D;">alert</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Unclean_Leader_Election</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">expr</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">max(kafka_controller_ControllerStats_UncleanLeaderElectionsPerSec_5MinuteRate{executor_name=&quot;kafka&quot;})by(service_name) != 0</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">for</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">1m</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">labels</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">severity</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">critical</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">annotations</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">summary</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&#39;Kafka {{ $labels.service_name }}: {{ $value }} unclean leader elections&#39;</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">description</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&#39;{{ $value }} unclean partition leader elections in the cluster reported in the last 1 minute interval. When unclean leader election is held among out-of-sync replicas, there is a possibility of data loss if any messages were not synced prior to the loss of the former leader. So if the number of unclean elections is greater than 0, investigate broker logs to determine why leaders were re-elected, and look for WARN or ERROR messages. Consider setting the broker configuration parameter unclean.leader.election.enable to false so that a replica outside of the set of in-sync replicas is never elected leader.&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    - </span><span style="color:#85E89D;">alert</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">ISR_Expand_Rate</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">expr</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">sum(kafka_server_ReplicaManager_IsrExpandsPerSec_5MinuteRate)by(service_name) != 0</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">for</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">1m</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">labels</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">severity</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">warning</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">annotations</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">summary</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&#39;Kafka {{ $labels.service_name }}: {{ $value }} ISR Expansion Rate&#39;</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">description</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&#39;If a broker goes down, ISR for some of the partitions shrink. When that broker is up again, ISRs are expanded once the replicas are fully caught up. Other than that, the expected value for ISR expansion rate is 0. If ISR is expanding and shrinking frequently, adjust Allowed replica lag.&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    - </span><span style="color:#85E89D;">alert</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">ISR_Shrink_Rate</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">expr</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">sum(kafka_server_ReplicaManager_IsrShrinksPerSec_5MinuteRate)by(service_name) != 0</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">for</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">1m</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">labels</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">severity</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">warning</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">annotations</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">summary</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&#39;Kafka {{ $labels.service_name }}: {{ $value }} ISR Shrink Rate&#39;</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">description</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&#39;If a broker goes down, ISR for some of the partitions shrink. When that broker is up again, ISRs are expanded once the replicas are fully caught up. Other than that, the expected value for ISR shrink rate is 0. If ISR is expanding and shrinking frequently, adjust Allowed replica lag.&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    - </span><span style="color:#85E89D;">alert</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Broker_Count</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">expr</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">count(kafka_server_KafkaServer_BrokerState{executor_name=&quot;kafka&quot;})by(service_name) == 0</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">for</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">1m</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">labels</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">severity</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">critical</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">annotations</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">summary</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&#39;Kafka {{ $labels.service_name }}: No Brokers online!&#39;</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">description</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&#39;Broker count is 0&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    - </span><span style="color:#85E89D;">alert</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Network_Processor_Idle_Percent</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">expr</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">avg(sum(kafka_network_Processor_IdlePercent{executor_name=&quot;kafka&quot;})by(service_name, task_name))by(service_name) &lt; 0.3</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">for</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">1m</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">labels</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">severity</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">critical</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">annotations</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">summary</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&#39;Kafka {{ $labels.service_name }}: Network Processor Idle Percent is {{ $value }}!&#39;</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">description</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&#39;The average fraction of time the network processors are idle. A lower value {{ $value }} indicates that the network workload of the broker is very high.&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    - </span><span style="color:#85E89D;">alert</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Request_Handler_Idle_Percent</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">expr</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">avg(kafka_server_KafkaRequestHandlerPool_RequestHandlerAvgIdlePercent_meanRate)by(service_name) &lt; 0.3</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">for</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">1m</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">labels</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">severity</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">critical</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">annotations</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">summary</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&#39;Kafka {{ $labels.service_name }}: Request Handler Idle Percent is {{ $value }}!&#39;</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">description</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&#39;The average fraction of time the request handler threads (IO) are idle. A lower value {{ $value }} indicates that the workload of a broker is very high.&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    - </span><span style="color:#85E89D;">alert</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Replica_Fetcher_Manager_Max_Lag</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">expr</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">avg(kafka_server_ReplicaFetcherManager_MaxLag)by(service_name) &gt; 50</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">for</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">1m</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">labels</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">severity</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">critical</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">annotations</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">summary</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&#39;Kafka {{ $labels.service_name }}: Replica Fetcher Manager Max Lag is {{ $value }}!&#39;</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">description</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&#39;The maximum lag between the time that messages are received by the leader replica and by the follower replicas.&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    - </span><span style="color:#85E89D;">alert</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Topic_Count</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">expr</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">count(count by (topic,service_name) (kafka_server_BrokerTopicMetrics_MessagesInPerSec_5MinuteRate{executor_name=&quot;kafka&quot;}))by(service_name) &gt; 1000</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">for</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">5m</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">labels</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">severity</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">warning</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">annotations</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">summary</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&#39;Kafka {{ $labels.service_name }}: 1000 topics reached&#39;</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">description</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&#39;The number of active topics in the cluster has reached 1000.&#39;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span></span>
<span class="line"><span style="color:#E1E4E8;">    - </span><span style="color:#85E89D;">alert</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Request_Queue_Time_Max</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">expr</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">max(kafka_network_RequestMetrics_RequestQueueTimeMs_mean{executor_name=&quot;kafka&quot;})by(service_name) &gt; 100</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">for</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">1m</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">labels</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">severity</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">warning</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">annotations</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">summary</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&#39;Kafka {{ $labels.service_name }}: {{ $value }}ms request queue time&#39;</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">description</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&#39;Max request queue time exceeded 100ms for a request. It is the time, in milliseconds, that a request currently spends in the request queue.&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    - </span><span style="color:#85E89D;">alert</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Response_Queue_Time_Max</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">expr</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">max(kafka_network_RequestMetrics_ResponseQueueTimeMs_mean{executor_name=&quot;kafka&quot;})by(service_name) &gt; 100</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">for</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">1m</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">labels</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">severity</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">warning</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">annotations</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">summary</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&#39;Kafka {{ $labels.service_name }}: {{ $value }}ms response queue time&#39;</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">description</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&#39;Max response queue time exceeded 100ms for a request. It is the length of time, in milliseconds, that the request waits in the response queue.&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    - </span><span style="color:#85E89D;">alert</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Zookeeper_Sync_Connect</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">expr</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">avg(kafka_server_SessionExpireListener_ZooKeeperSyncConnectsPerSec_count{executor_name=&quot;kafka&quot;})by(service_name) &lt; 1</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">for</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">1m</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">labels</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">severity</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">warning</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">annotations</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">summary</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&#39;Kafka {{ $labels.service_name }}: Zookeeper Sync Disconected&#39;</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">description</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&#39;Zookeeper Sync Disconected&#39;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"></span>
<span class="line"><span style="color:#22863A;">groups</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">- </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">Kafka_Alerts</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">rules</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    - </span><span style="color:#22863A;">alert</span><span style="color:#24292E;">: </span><span style="color:#032F62;">Offline_Partiton_Count</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">expr</span><span style="color:#24292E;">: </span><span style="color:#032F62;">sum(kafka_controller_KafkaController_OfflinePartitionsCount{executor_name=&quot;kafka&quot;})by(service_name)  &gt; 0</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">for</span><span style="color:#24292E;">: </span><span style="color:#032F62;">1m</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">labels</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">severity</span><span style="color:#24292E;">: </span><span style="color:#032F62;">critical</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">annotations</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">summary</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&#39;Kafka {{ $labels.service_name }}: {{ $value }} partitons offline&#39;</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">description</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&#39;After successful leader election, if the leader for partition dies, then the partition moves to the OfflinePartition state. Offline partitions are not available for reading and writing. Restart the brokers, if needed, and check the logs for errors.&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    - </span><span style="color:#22863A;">alert</span><span style="color:#24292E;">: </span><span style="color:#032F62;">Under_Replicated_Partition_Count</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">expr</span><span style="color:#24292E;">: </span><span style="color:#032F62;">sum(kafka_server_ReplicaManager_UnderReplicatedPartitions{executor_name=&quot;kafka&quot;})by(service_name) &gt; 0</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">for</span><span style="color:#24292E;">: </span><span style="color:#032F62;">1m</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">labels</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">severity</span><span style="color:#24292E;">: </span><span style="color:#032F62;">critical</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">annotations</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">summary</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&#39;Kafka {{ $labels.service_name }}: {{ $value }} under replicated partitons&#39;</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">description</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&#39;Under-replicated partitions means that one or more replicas are not available. This is usually because a broker is down.  Restart the broker, and check for errors in the logs.&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    - </span><span style="color:#22863A;">alert</span><span style="color:#24292E;">: </span><span style="color:#032F62;">Active_Controller</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">expr</span><span style="color:#24292E;">: </span><span style="color:#032F62;">sum(kafka_controller_KafkaController_ActiveControllerCount{executor_name=&quot;kafka&quot;})by(service_name) != 1</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">for</span><span style="color:#24292E;">: </span><span style="color:#032F62;">1m</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">labels</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">severity</span><span style="color:#24292E;">: </span><span style="color:#032F62;">critical</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">annotations</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">summary</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&#39;Kafka {{ $labels.service_name }}: No active controller&#39;</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">description</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&#39;No broker in the cluster is reporting as the active controller in the last 1 minute interval. During steady state there should be only one active controller per cluster.&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    - </span><span style="color:#22863A;">alert</span><span style="color:#24292E;">: </span><span style="color:#032F62;">Unclean_Leader_Election</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">expr</span><span style="color:#24292E;">: </span><span style="color:#032F62;">max(kafka_controller_ControllerStats_UncleanLeaderElectionsPerSec_5MinuteRate{executor_name=&quot;kafka&quot;})by(service_name) != 0</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">for</span><span style="color:#24292E;">: </span><span style="color:#032F62;">1m</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">labels</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">severity</span><span style="color:#24292E;">: </span><span style="color:#032F62;">critical</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">annotations</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">summary</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&#39;Kafka {{ $labels.service_name }}: {{ $value }} unclean leader elections&#39;</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">description</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&#39;{{ $value }} unclean partition leader elections in the cluster reported in the last 1 minute interval. When unclean leader election is held among out-of-sync replicas, there is a possibility of data loss if any messages were not synced prior to the loss of the former leader. So if the number of unclean elections is greater than 0, investigate broker logs to determine why leaders were re-elected, and look for WARN or ERROR messages. Consider setting the broker configuration parameter unclean.leader.election.enable to false so that a replica outside of the set of in-sync replicas is never elected leader.&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    - </span><span style="color:#22863A;">alert</span><span style="color:#24292E;">: </span><span style="color:#032F62;">ISR_Expand_Rate</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">expr</span><span style="color:#24292E;">: </span><span style="color:#032F62;">sum(kafka_server_ReplicaManager_IsrExpandsPerSec_5MinuteRate)by(service_name) != 0</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">for</span><span style="color:#24292E;">: </span><span style="color:#032F62;">1m</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">labels</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">severity</span><span style="color:#24292E;">: </span><span style="color:#032F62;">warning</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">annotations</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">summary</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&#39;Kafka {{ $labels.service_name }}: {{ $value }} ISR Expansion Rate&#39;</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">description</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&#39;If a broker goes down, ISR for some of the partitions shrink. When that broker is up again, ISRs are expanded once the replicas are fully caught up. Other than that, the expected value for ISR expansion rate is 0. If ISR is expanding and shrinking frequently, adjust Allowed replica lag.&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    - </span><span style="color:#22863A;">alert</span><span style="color:#24292E;">: </span><span style="color:#032F62;">ISR_Shrink_Rate</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">expr</span><span style="color:#24292E;">: </span><span style="color:#032F62;">sum(kafka_server_ReplicaManager_IsrShrinksPerSec_5MinuteRate)by(service_name) != 0</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">for</span><span style="color:#24292E;">: </span><span style="color:#032F62;">1m</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">labels</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">severity</span><span style="color:#24292E;">: </span><span style="color:#032F62;">warning</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">annotations</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">summary</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&#39;Kafka {{ $labels.service_name }}: {{ $value }} ISR Shrink Rate&#39;</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">description</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&#39;If a broker goes down, ISR for some of the partitions shrink. When that broker is up again, ISRs are expanded once the replicas are fully caught up. Other than that, the expected value for ISR shrink rate is 0. If ISR is expanding and shrinking frequently, adjust Allowed replica lag.&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    - </span><span style="color:#22863A;">alert</span><span style="color:#24292E;">: </span><span style="color:#032F62;">Broker_Count</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">expr</span><span style="color:#24292E;">: </span><span style="color:#032F62;">count(kafka_server_KafkaServer_BrokerState{executor_name=&quot;kafka&quot;})by(service_name) == 0</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">for</span><span style="color:#24292E;">: </span><span style="color:#032F62;">1m</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">labels</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">severity</span><span style="color:#24292E;">: </span><span style="color:#032F62;">critical</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">annotations</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">summary</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&#39;Kafka {{ $labels.service_name }}: No Brokers online!&#39;</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">description</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&#39;Broker count is 0&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    - </span><span style="color:#22863A;">alert</span><span style="color:#24292E;">: </span><span style="color:#032F62;">Network_Processor_Idle_Percent</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">expr</span><span style="color:#24292E;">: </span><span style="color:#032F62;">avg(sum(kafka_network_Processor_IdlePercent{executor_name=&quot;kafka&quot;})by(service_name, task_name))by(service_name) &lt; 0.3</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">for</span><span style="color:#24292E;">: </span><span style="color:#032F62;">1m</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">labels</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">severity</span><span style="color:#24292E;">: </span><span style="color:#032F62;">critical</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">annotations</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">summary</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&#39;Kafka {{ $labels.service_name }}: Network Processor Idle Percent is {{ $value }}!&#39;</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">description</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&#39;The average fraction of time the network processors are idle. A lower value {{ $value }} indicates that the network workload of the broker is very high.&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    - </span><span style="color:#22863A;">alert</span><span style="color:#24292E;">: </span><span style="color:#032F62;">Request_Handler_Idle_Percent</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">expr</span><span style="color:#24292E;">: </span><span style="color:#032F62;">avg(kafka_server_KafkaRequestHandlerPool_RequestHandlerAvgIdlePercent_meanRate)by(service_name) &lt; 0.3</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">for</span><span style="color:#24292E;">: </span><span style="color:#032F62;">1m</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">labels</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">severity</span><span style="color:#24292E;">: </span><span style="color:#032F62;">critical</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">annotations</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">summary</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&#39;Kafka {{ $labels.service_name }}: Request Handler Idle Percent is {{ $value }}!&#39;</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">description</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&#39;The average fraction of time the request handler threads (IO) are idle. A lower value {{ $value }} indicates that the workload of a broker is very high.&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    - </span><span style="color:#22863A;">alert</span><span style="color:#24292E;">: </span><span style="color:#032F62;">Replica_Fetcher_Manager_Max_Lag</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">expr</span><span style="color:#24292E;">: </span><span style="color:#032F62;">avg(kafka_server_ReplicaFetcherManager_MaxLag)by(service_name) &gt; 50</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">for</span><span style="color:#24292E;">: </span><span style="color:#032F62;">1m</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">labels</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">severity</span><span style="color:#24292E;">: </span><span style="color:#032F62;">critical</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">annotations</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">summary</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&#39;Kafka {{ $labels.service_name }}: Replica Fetcher Manager Max Lag is {{ $value }}!&#39;</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">description</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&#39;The maximum lag between the time that messages are received by the leader replica and by the follower replicas.&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    - </span><span style="color:#22863A;">alert</span><span style="color:#24292E;">: </span><span style="color:#032F62;">Topic_Count</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">expr</span><span style="color:#24292E;">: </span><span style="color:#032F62;">count(count by (topic,service_name) (kafka_server_BrokerTopicMetrics_MessagesInPerSec_5MinuteRate{executor_name=&quot;kafka&quot;}))by(service_name) &gt; 1000</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">for</span><span style="color:#24292E;">: </span><span style="color:#032F62;">5m</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">labels</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">severity</span><span style="color:#24292E;">: </span><span style="color:#032F62;">warning</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">annotations</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">summary</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&#39;Kafka {{ $labels.service_name }}: 1000 topics reached&#39;</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">description</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&#39;The number of active topics in the cluster has reached 1000.&#39;</span></span>
<span class="line"><span style="color:#24292E;">    </span></span>
<span class="line"><span style="color:#24292E;">    - </span><span style="color:#22863A;">alert</span><span style="color:#24292E;">: </span><span style="color:#032F62;">Request_Queue_Time_Max</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">expr</span><span style="color:#24292E;">: </span><span style="color:#032F62;">max(kafka_network_RequestMetrics_RequestQueueTimeMs_mean{executor_name=&quot;kafka&quot;})by(service_name) &gt; 100</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">for</span><span style="color:#24292E;">: </span><span style="color:#032F62;">1m</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">labels</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">severity</span><span style="color:#24292E;">: </span><span style="color:#032F62;">warning</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">annotations</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">summary</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&#39;Kafka {{ $labels.service_name }}: {{ $value }}ms request queue time&#39;</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">description</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&#39;Max request queue time exceeded 100ms for a request. It is the time, in milliseconds, that a request currently spends in the request queue.&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    - </span><span style="color:#22863A;">alert</span><span style="color:#24292E;">: </span><span style="color:#032F62;">Response_Queue_Time_Max</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">expr</span><span style="color:#24292E;">: </span><span style="color:#032F62;">max(kafka_network_RequestMetrics_ResponseQueueTimeMs_mean{executor_name=&quot;kafka&quot;})by(service_name) &gt; 100</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">for</span><span style="color:#24292E;">: </span><span style="color:#032F62;">1m</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">labels</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">severity</span><span style="color:#24292E;">: </span><span style="color:#032F62;">warning</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">annotations</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">summary</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&#39;Kafka {{ $labels.service_name }}: {{ $value }}ms response queue time&#39;</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">description</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&#39;Max response queue time exceeded 100ms for a request. It is the length of time, in milliseconds, that the request waits in the response queue.&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    - </span><span style="color:#22863A;">alert</span><span style="color:#24292E;">: </span><span style="color:#032F62;">Zookeeper_Sync_Connect</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">expr</span><span style="color:#24292E;">: </span><span style="color:#032F62;">avg(kafka_server_SessionExpireListener_ZooKeeperSyncConnectsPerSec_count{executor_name=&quot;kafka&quot;})by(service_name) &lt; 1</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">for</span><span style="color:#24292E;">: </span><span style="color:#032F62;">1m</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">labels</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">severity</span><span style="color:#24292E;">: </span><span style="color:#032F62;">warning</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">annotations</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">summary</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&#39;Kafka {{ $labels.service_name }}: Zookeeper Sync Disconected&#39;</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">description</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&#39;Zookeeper Sync Disconected&#39;</span></span></code></pre></div>`,2),o=[p];function r(t,c,E,y,i,u){return a(),n("div",null,o)}const F=s(e,[["render",r]]);export{_ as __pageData,F as default};
