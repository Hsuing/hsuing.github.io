import{_ as s,o as a,c as n,R as l}from"./chunks/framework.zUbWieqp.js";const h=JSON.parse('{"title":"1. 创建库和用户","description":"","frontmatter":{},"headers":[],"relativePath":"guide/Database/pgSql/faq/5-授权和备份.md","filePath":"guide/Database/pgSql/faq/5-授权和备份.md","lastUpdated":1734603886000}'),p={name:"guide/Database/pgSql/faq/5-授权和备份.md"},o=l(`<h1 id="_1-创建库和用户" tabindex="-1">1. 创建库和用户 <a class="header-anchor" href="#_1-创建库和用户" aria-label="Permalink to &quot;1. 创建库和用户&quot;">​</a></h1><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">create</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">user</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">transuser</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">with</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">password</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;transiff61384e&#39;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">create</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">database</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">taoism_translation</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">owner</span><span style="color:#E1E4E8;"> transuser;</span></span>
<span class="line"><span style="color:#F97583;">grant</span><span style="color:#E1E4E8;"> all privileges </span><span style="color:#F97583;">on</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">database</span><span style="color:#E1E4E8;"> taoism_translation </span><span style="color:#F97583;">to</span><span style="color:#E1E4E8;"> transuser;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">create</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">user</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">transuser</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">with</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">password</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;transiff61384e&#39;</span><span style="color:#24292E;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">create</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">database</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">taoism_translation</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">owner</span><span style="color:#24292E;"> transuser;</span></span>
<span class="line"><span style="color:#D73A49;">grant</span><span style="color:#24292E;"> all privileges </span><span style="color:#D73A49;">on</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">database</span><span style="color:#24292E;"> taoism_translation </span><span style="color:#D73A49;">to</span><span style="color:#24292E;"> transuser;</span></span></code></pre></div><h1 id="_2-授权" tabindex="-1">2. 授权 <a class="header-anchor" href="#_2-授权" aria-label="Permalink to &quot;2. 授权&quot;">​</a></h1><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">-- 1. 创建用户(如果还没创建)</span></span>
<span class="line"><span style="color:#F97583;">CREATE</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">USER</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">transuser</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">WITH</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">PASSWORD</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;transiff61384e&#39;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">-- 2. 创建数据库(如果还没创建)</span></span>
<span class="line"><span style="color:#F97583;">CREATE</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">DATABASE</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">taoism_translation</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">WITH</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">OWNER</span><span style="color:#E1E4E8;"> transuser;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">-- 3. 撤销用户对public schema的权限(可选,增加安全性)</span></span>
<span class="line"><span style="color:#F97583;">REVOKE</span><span style="color:#E1E4E8;"> ALL </span><span style="color:#F97583;">ON</span><span style="color:#E1E4E8;"> ALL TABLES </span><span style="color:#F97583;">IN</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">SCHEMA</span><span style="color:#E1E4E8;"> public </span><span style="color:#F97583;">FROM</span><span style="color:#E1E4E8;"> public;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">-- 4. 授予用户连接权限</span></span>
<span class="line"><span style="color:#F97583;">GRANT</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">CONNECT</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">ON</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">DATABASE</span><span style="color:#E1E4E8;"> taoism_translation </span><span style="color:#F97583;">TO</span><span style="color:#E1E4E8;"> transuser;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">-- 5. 授予用户对数据库中表的权限</span></span>
<span class="line"><span style="color:#E1E4E8;">\\c taoism_translation</span></span>
<span class="line"><span style="color:#F97583;">GRANT</span><span style="color:#E1E4E8;"> USAGE </span><span style="color:#F97583;">ON</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">SCHEMA</span><span style="color:#E1E4E8;"> public </span><span style="color:#F97583;">TO</span><span style="color:#E1E4E8;"> transuser;</span></span>
<span class="line"><span style="color:#F97583;">GRANT</span><span style="color:#E1E4E8;"> ALL PRIVILEGES </span><span style="color:#F97583;">ON</span><span style="color:#E1E4E8;"> ALL TABLES </span><span style="color:#F97583;">IN</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">SCHEMA</span><span style="color:#E1E4E8;"> public </span><span style="color:#F97583;">TO</span><span style="color:#E1E4E8;"> transuser;</span></span>
<span class="line"><span style="color:#F97583;">GRANT</span><span style="color:#E1E4E8;"> ALL PRIVILEGES </span><span style="color:#F97583;">ON</span><span style="color:#E1E4E8;"> ALL SEQUENCES </span><span style="color:#F97583;">IN</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">SCHEMA</span><span style="color:#E1E4E8;"> public </span><span style="color:#F97583;">TO</span><span style="color:#E1E4E8;"> transuser;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">-- 6. 撤销对其他数据库的访问权限(如果有)</span></span>
<span class="line"><span style="color:#F97583;">REVOKE</span><span style="color:#E1E4E8;"> ALL </span><span style="color:#F97583;">ON</span><span style="color:#E1E4E8;"> ALL TABLES </span><span style="color:#F97583;">IN</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">SCHEMA</span><span style="color:#E1E4E8;"> public </span><span style="color:#F97583;">FROM</span><span style="color:#E1E4E8;"> transuser;</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">-- 7. 修改表的属主，alter不是类型权限，无法进行授权，注意执行这个慎重，先前添加的授权会取消</span></span>
<span class="line"><span style="color:#F97583;">ALTER</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">TABLE</span><span style="color:#E1E4E8;"> table_name </span><span style="color:#F97583;">OWNER</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">TO</span><span style="color:#E1E4E8;"> name_user;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">-- 批量修改</span></span>
<span class="line"><span style="color:#E1E4E8;">DO $$</span></span>
<span class="line"><span style="color:#F97583;">BEGIN</span></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#F97583;">EXECUTE</span><span style="color:#E1E4E8;"> (</span></span>
<span class="line"><span style="color:#E1E4E8;">       </span><span style="color:#F97583;">SELECT</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">string_agg</span><span style="color:#E1E4E8;">(</span></span>
<span class="line"><span style="color:#E1E4E8;">           </span><span style="color:#79B8FF;">format</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;ALTER TABLE public.%I OWNER TO transuser;&#39;</span><span style="color:#E1E4E8;">, table_name),</span></span>
<span class="line"><span style="color:#E1E4E8;">           </span><span style="color:#9ECBFF;">&#39; &#39;</span></span>
<span class="line"><span style="color:#E1E4E8;">       )</span></span>
<span class="line"><span style="color:#E1E4E8;">       </span><span style="color:#F97583;">FROM</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">information_schema</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">tables</span></span>
<span class="line"><span style="color:#E1E4E8;">       </span><span style="color:#F97583;">WHERE</span><span style="color:#E1E4E8;"> table_schema </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;public&#39;</span></span>
<span class="line"><span style="color:#E1E4E8;">   );</span></span>
<span class="line"><span style="color:#F97583;">END</span><span style="color:#E1E4E8;"> $$;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">-- 1. 创建用户(如果还没创建)</span></span>
<span class="line"><span style="color:#D73A49;">CREATE</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">USER</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">transuser</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">WITH</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">PASSWORD</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;transiff61384e&#39;</span><span style="color:#24292E;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">-- 2. 创建数据库(如果还没创建)</span></span>
<span class="line"><span style="color:#D73A49;">CREATE</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">DATABASE</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">taoism_translation</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">WITH</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">OWNER</span><span style="color:#24292E;"> transuser;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">-- 3. 撤销用户对public schema的权限(可选,增加安全性)</span></span>
<span class="line"><span style="color:#D73A49;">REVOKE</span><span style="color:#24292E;"> ALL </span><span style="color:#D73A49;">ON</span><span style="color:#24292E;"> ALL TABLES </span><span style="color:#D73A49;">IN</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">SCHEMA</span><span style="color:#24292E;"> public </span><span style="color:#D73A49;">FROM</span><span style="color:#24292E;"> public;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">-- 4. 授予用户连接权限</span></span>
<span class="line"><span style="color:#D73A49;">GRANT</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">CONNECT</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">ON</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">DATABASE</span><span style="color:#24292E;"> taoism_translation </span><span style="color:#D73A49;">TO</span><span style="color:#24292E;"> transuser;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">-- 5. 授予用户对数据库中表的权限</span></span>
<span class="line"><span style="color:#24292E;">\\c taoism_translation</span></span>
<span class="line"><span style="color:#D73A49;">GRANT</span><span style="color:#24292E;"> USAGE </span><span style="color:#D73A49;">ON</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">SCHEMA</span><span style="color:#24292E;"> public </span><span style="color:#D73A49;">TO</span><span style="color:#24292E;"> transuser;</span></span>
<span class="line"><span style="color:#D73A49;">GRANT</span><span style="color:#24292E;"> ALL PRIVILEGES </span><span style="color:#D73A49;">ON</span><span style="color:#24292E;"> ALL TABLES </span><span style="color:#D73A49;">IN</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">SCHEMA</span><span style="color:#24292E;"> public </span><span style="color:#D73A49;">TO</span><span style="color:#24292E;"> transuser;</span></span>
<span class="line"><span style="color:#D73A49;">GRANT</span><span style="color:#24292E;"> ALL PRIVILEGES </span><span style="color:#D73A49;">ON</span><span style="color:#24292E;"> ALL SEQUENCES </span><span style="color:#D73A49;">IN</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">SCHEMA</span><span style="color:#24292E;"> public </span><span style="color:#D73A49;">TO</span><span style="color:#24292E;"> transuser;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">-- 6. 撤销对其他数据库的访问权限(如果有)</span></span>
<span class="line"><span style="color:#D73A49;">REVOKE</span><span style="color:#24292E;"> ALL </span><span style="color:#D73A49;">ON</span><span style="color:#24292E;"> ALL TABLES </span><span style="color:#D73A49;">IN</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">SCHEMA</span><span style="color:#24292E;"> public </span><span style="color:#D73A49;">FROM</span><span style="color:#24292E;"> transuser;</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">-- 7. 修改表的属主，alter不是类型权限，无法进行授权，注意执行这个慎重，先前添加的授权会取消</span></span>
<span class="line"><span style="color:#D73A49;">ALTER</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">TABLE</span><span style="color:#24292E;"> table_name </span><span style="color:#D73A49;">OWNER</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">TO</span><span style="color:#24292E;"> name_user;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">-- 批量修改</span></span>
<span class="line"><span style="color:#24292E;">DO $$</span></span>
<span class="line"><span style="color:#D73A49;">BEGIN</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#D73A49;">EXECUTE</span><span style="color:#24292E;"> (</span></span>
<span class="line"><span style="color:#24292E;">       </span><span style="color:#D73A49;">SELECT</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">string_agg</span><span style="color:#24292E;">(</span></span>
<span class="line"><span style="color:#24292E;">           </span><span style="color:#005CC5;">format</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;ALTER TABLE public.%I OWNER TO transuser;&#39;</span><span style="color:#24292E;">, table_name),</span></span>
<span class="line"><span style="color:#24292E;">           </span><span style="color:#032F62;">&#39; &#39;</span></span>
<span class="line"><span style="color:#24292E;">       )</span></span>
<span class="line"><span style="color:#24292E;">       </span><span style="color:#D73A49;">FROM</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">information_schema</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">tables</span></span>
<span class="line"><span style="color:#24292E;">       </span><span style="color:#D73A49;">WHERE</span><span style="color:#24292E;"> table_schema </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;public&#39;</span></span>
<span class="line"><span style="color:#24292E;">   );</span></span>
<span class="line"><span style="color:#D73A49;">END</span><span style="color:#24292E;"> $$;</span></span></code></pre></div><h1 id="_3-备份" tabindex="-1">3. 备份 <a class="header-anchor" href="#_3-备份" aria-label="Permalink to &quot;3. 备份&quot;">​</a></h1><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">pg_dump </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">U postgres </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">h </span><span style="color:#79B8FF;">127</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">p </span><span style="color:#79B8FF;">5532</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">d fllowordersystem  </span><span style="color:#6A737D;">--no-owner --no-tablespaces --no-privileges &gt;fll.sql</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">pg_dump </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">U postgres </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">h </span><span style="color:#79B8FF;">127</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">p </span><span style="color:#79B8FF;">5532</span><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">t fllowordersetting fllowordersystem  </span><span style="color:#6A737D;">--no-owner --no-tablespaces --no-privileges &gt;fllowordersetting.sql</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">pg_dump </span><span style="color:#D73A49;">-</span><span style="color:#24292E;">U postgres </span><span style="color:#D73A49;">-</span><span style="color:#24292E;">h </span><span style="color:#005CC5;">127</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">0</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">0</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">1</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">-</span><span style="color:#24292E;">p </span><span style="color:#005CC5;">5532</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">-</span><span style="color:#24292E;">d fllowordersystem  </span><span style="color:#6A737D;">--no-owner --no-tablespaces --no-privileges &gt;fll.sql</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">pg_dump </span><span style="color:#D73A49;">-</span><span style="color:#24292E;">U postgres </span><span style="color:#D73A49;">-</span><span style="color:#24292E;">h </span><span style="color:#005CC5;">127</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">0</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">0</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">1</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">-</span><span style="color:#24292E;">p </span><span style="color:#005CC5;">5532</span><span style="color:#24292E;">  </span><span style="color:#D73A49;">-</span><span style="color:#24292E;">t fllowordersetting fllowordersystem  </span><span style="color:#6A737D;">--no-owner --no-tablespaces --no-privileges &gt;fllowordersetting.sql</span></span></code></pre></div><h1 id="_4-查看" tabindex="-1">4. 查看 <a class="header-anchor" href="#_4-查看" aria-label="Permalink to &quot;4. 查看&quot;">​</a></h1><ul><li>查看序列user_wx_id_seq属于谁</li></ul><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">SELECT</span><span style="color:#E1E4E8;"> usename </span><span style="color:#F97583;">FROM</span><span style="color:#E1E4E8;"> pg_user u </span><span style="color:#F97583;">JOIN</span><span style="color:#E1E4E8;"> pg_class c </span><span style="color:#F97583;">ON</span><span style="color:#E1E4E8;"> (</span><span style="color:#79B8FF;">c</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">relowner</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">u</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">usesysid</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">WHERE</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">c</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">relname</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;user_wx_id_seq&#39;</span><span style="color:#E1E4E8;">;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">SELECT</span><span style="color:#24292E;"> usename </span><span style="color:#D73A49;">FROM</span><span style="color:#24292E;"> pg_user u </span><span style="color:#D73A49;">JOIN</span><span style="color:#24292E;"> pg_class c </span><span style="color:#D73A49;">ON</span><span style="color:#24292E;"> (</span><span style="color:#005CC5;">c</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">relowner</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">u</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">usesysid</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">WHERE</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">c</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">relname</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;user_wx_id_seq&#39;</span><span style="color:#24292E;">;</span></span></code></pre></div><ul><li>查看用户是否有该权限</li></ul><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">SELECT</span><span style="color:#E1E4E8;"> has_sequence_privilege(</span><span style="color:#9ECBFF;">&#39;username&#39;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&#39;user_wx_id_seq&#39;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&#39;SELECT,USAGE&#39;</span><span style="color:#E1E4E8;">);</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">SELECT</span><span style="color:#24292E;"> has_sequence_privilege(</span><span style="color:#032F62;">&#39;username&#39;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&#39;user_wx_id_seq&#39;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&#39;SELECT,USAGE&#39;</span><span style="color:#24292E;">);</span></span></code></pre></div><ul><li>授权</li></ul><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">\\c dataName</span></span>
<span class="line"><span style="color:#F97583;">GRANT</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">SELECT</span><span style="color:#E1E4E8;">, USAGE </span><span style="color:#F97583;">ON</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">SEQUENCE</span><span style="color:#E1E4E8;"> user_wx_id_seq </span><span style="color:#F97583;">TO</span><span style="color:#E1E4E8;"> username;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">\\c dataName</span></span>
<span class="line"><span style="color:#D73A49;">GRANT</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">SELECT</span><span style="color:#24292E;">, USAGE </span><span style="color:#D73A49;">ON</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">SEQUENCE</span><span style="color:#24292E;"> user_wx_id_seq </span><span style="color:#D73A49;">TO</span><span style="color:#24292E;"> username;</span></span></code></pre></div><h2 id="_4-1-元命令" tabindex="-1">4.1 元命令 <a class="header-anchor" href="#_4-1-元命令" aria-label="Permalink to &quot;4.1 元命令&quot;">​</a></h2><p>通常可以使用\\dp+ 列出用户,schema的默认权限。列出表、视图、序列的权限,但是它读起来比较不太方便。</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">\\dp+</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">\\dp+</span></span></code></pre></div><h2 id="_4-2-查看视图" tabindex="-1">4.2 查看视图 <a class="header-anchor" href="#_4-2-查看视图" aria-label="Permalink to &quot;4.2 查看视图&quot;">​</a></h2><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">select * from pg_roles;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">select * from pg_roles;</span></span></code></pre></div><ul><li>查看单表权限</li></ul><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">SELECT</span><span style="color:#E1E4E8;"> grantee,table_schema,table_name,</span><span style="color:#79B8FF;">string_agg</span><span style="color:#E1E4E8;">( privilege_type,</span><span style="color:#9ECBFF;">&#39;, &#39;</span><span style="color:#E1E4E8;"> ) </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> privilege_type</span></span>
<span class="line"><span style="color:#F97583;">FROM</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">information_schema</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">role_table_grants</span></span>
<span class="line"><span style="color:#F97583;">WHERE</span><span style="color:#E1E4E8;"> table_name</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&#39;xxx&#39;</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;">--替换自己的</span></span>
<span class="line"><span style="color:#F97583;">group by</span><span style="color:#E1E4E8;"> grantee,table_schema,table_name;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">#显示结果</span></span>
<span class="line"><span style="color:#E1E4E8;">     grantee     | table_schema | table_name |                        privilege_type</span></span>
<span class="line"><span style="color:#6A737D;">-----------------+--------------+------------+---------------------------------------------------------------</span></span>
<span class="line"><span style="color:#E1E4E8;"> transuser       | public       | text_info  | </span><span style="color:#F97583;">INSERT</span><span style="color:#E1E4E8;">, </span><span style="color:#F97583;">SELECT</span><span style="color:#E1E4E8;">, </span><span style="color:#F97583;">UPDATE</span><span style="color:#E1E4E8;">, </span><span style="color:#F97583;">DELETE</span><span style="color:#E1E4E8;">, </span><span style="color:#F97583;">TRUNCATE</span><span style="color:#E1E4E8;">, </span><span style="color:#F97583;">REFERENCES</span><span style="color:#E1E4E8;">, TRIGGER</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">SELECT</span><span style="color:#24292E;"> grantee,table_schema,table_name,</span><span style="color:#005CC5;">string_agg</span><span style="color:#24292E;">( privilege_type,</span><span style="color:#032F62;">&#39;, &#39;</span><span style="color:#24292E;"> ) </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> privilege_type</span></span>
<span class="line"><span style="color:#D73A49;">FROM</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">information_schema</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">role_table_grants</span></span>
<span class="line"><span style="color:#D73A49;">WHERE</span><span style="color:#24292E;"> table_name</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&#39;xxx&#39;</span><span style="color:#24292E;"> </span><span style="color:#6A737D;">--替换自己的</span></span>
<span class="line"><span style="color:#D73A49;">group by</span><span style="color:#24292E;"> grantee,table_schema,table_name;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">#显示结果</span></span>
<span class="line"><span style="color:#24292E;">     grantee     | table_schema | table_name |                        privilege_type</span></span>
<span class="line"><span style="color:#6A737D;">-----------------+--------------+------------+---------------------------------------------------------------</span></span>
<span class="line"><span style="color:#24292E;"> transuser       | public       | text_info  | </span><span style="color:#D73A49;">INSERT</span><span style="color:#24292E;">, </span><span style="color:#D73A49;">SELECT</span><span style="color:#24292E;">, </span><span style="color:#D73A49;">UPDATE</span><span style="color:#24292E;">, </span><span style="color:#D73A49;">DELETE</span><span style="color:#24292E;">, </span><span style="color:#D73A49;">TRUNCATE</span><span style="color:#24292E;">, </span><span style="color:#D73A49;">REFERENCES</span><span style="color:#24292E;">, TRIGGER</span></span></code></pre></div><ul><li>查看某用户的权限</li></ul><p>替换username</p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">SELECT</span><span style="color:#E1E4E8;"> grantee,table_schema,table_name, </span><span style="color:#79B8FF;">string_agg</span><span style="color:#E1E4E8;">( privilege_type,</span><span style="color:#9ECBFF;">&#39;, &#39;</span><span style="color:#E1E4E8;"> ) </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> privilege_type </span><span style="color:#F97583;">FROM</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">information_schema</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">role_table_grants</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">where</span><span style="color:#E1E4E8;"> grantee</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&#39;username&#39;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">group by</span><span style="color:#E1E4E8;"> table_name,table_schema,grantee;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">SELECT</span><span style="color:#24292E;"> grantee,table_schema,table_name, </span><span style="color:#005CC5;">string_agg</span><span style="color:#24292E;">( privilege_type,</span><span style="color:#032F62;">&#39;, &#39;</span><span style="color:#24292E;"> ) </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> privilege_type </span><span style="color:#D73A49;">FROM</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">information_schema</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">role_table_grants</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">where</span><span style="color:#24292E;"> grantee</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&#39;username&#39;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">group by</span><span style="color:#24292E;"> table_name,table_schema,grantee;</span></span></code></pre></div><h3 id="_1-schema权限" tabindex="-1">1. schema权限 <a class="header-anchor" href="#_1-schema权限" aria-label="Permalink to &quot;1. schema权限&quot;">​</a></h3><p>关注usage的权限，如果没有这个权限，访问 schema有时候会遇到问题</p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">select</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">a</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">nspname</span><span style="color:#E1E4E8;">,</span><span style="color:#79B8FF;">b</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">rolname</span><span style="color:#E1E4E8;">,</span><span style="color:#79B8FF;">string_agg</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">a</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">pri_t</span><span style="color:#E1E4E8;">,</span><span style="color:#9ECBFF;">&#39;,&#39;</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> (</span><span style="color:#F97583;">select</span><span style="color:#E1E4E8;"> nspname,(aclexplode(</span><span style="color:#79B8FF;">COALESCE</span><span style="color:#E1E4E8;">(nspacl, acldefault(</span><span style="color:#9ECBFF;">&#39;n&#39;</span><span style="color:#E1E4E8;">::</span><span style="color:#9ECBFF;">&quot;char&quot;</span><span style="color:#E1E4E8;">,nspowner)))).grantee </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> grantee,(aclexplode(</span><span style="color:#79B8FF;">COALESCE</span><span style="color:#E1E4E8;">(nspacl, acldefault(</span><span style="color:#9ECBFF;">&#39;n&#39;</span><span style="color:#E1E4E8;">::</span><span style="color:#9ECBFF;">&quot;char&quot;</span><span style="color:#E1E4E8;">,nspowner)))).privilege_type </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> pri_t </span><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> pg_namespace </span><span style="color:#F97583;">where</span><span style="color:#E1E4E8;"> nspname </span><span style="color:#F97583;">not</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">like</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;pg%&#39;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">and</span><span style="color:#E1E4E8;"> nspname </span><span style="color:#F97583;">&lt;&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;information_schema&#39;</span><span style="color:#E1E4E8;">) a,pg_authid b </span><span style="color:#F97583;">where</span><span style="color:#E1E4E8;"> (</span><span style="color:#79B8FF;">a</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">grantee</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">b</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">oid</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">or</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">a</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">grantee</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">and</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">b</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">rolname</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&#39;username&#39;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">group by</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">a</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">nspname</span><span style="color:#E1E4E8;">,</span><span style="color:#79B8FF;">b</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">rolname</span><span style="color:#E1E4E8;">;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">select</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">a</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">nspname</span><span style="color:#24292E;">,</span><span style="color:#005CC5;">b</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">rolname</span><span style="color:#24292E;">,</span><span style="color:#005CC5;">string_agg</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">a</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">pri_t</span><span style="color:#24292E;">,</span><span style="color:#032F62;">&#39;,&#39;</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">from</span><span style="color:#24292E;"> (</span><span style="color:#D73A49;">select</span><span style="color:#24292E;"> nspname,(aclexplode(</span><span style="color:#005CC5;">COALESCE</span><span style="color:#24292E;">(nspacl, acldefault(</span><span style="color:#032F62;">&#39;n&#39;</span><span style="color:#24292E;">::</span><span style="color:#032F62;">&quot;char&quot;</span><span style="color:#24292E;">,nspowner)))).grantee </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> grantee,(aclexplode(</span><span style="color:#005CC5;">COALESCE</span><span style="color:#24292E;">(nspacl, acldefault(</span><span style="color:#032F62;">&#39;n&#39;</span><span style="color:#24292E;">::</span><span style="color:#032F62;">&quot;char&quot;</span><span style="color:#24292E;">,nspowner)))).privilege_type </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> pri_t </span><span style="color:#D73A49;">from</span><span style="color:#24292E;"> pg_namespace </span><span style="color:#D73A49;">where</span><span style="color:#24292E;"> nspname </span><span style="color:#D73A49;">not</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">like</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;pg%&#39;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">and</span><span style="color:#24292E;"> nspname </span><span style="color:#D73A49;">&lt;&gt;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;information_schema&#39;</span><span style="color:#24292E;">) a,pg_authid b </span><span style="color:#D73A49;">where</span><span style="color:#24292E;"> (</span><span style="color:#005CC5;">a</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">grantee</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">b</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">oid</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">or</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">a</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">grantee</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">0</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">and</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">b</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">rolname</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&#39;username&#39;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">group by</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">a</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">nspname</span><span style="color:#24292E;">,</span><span style="color:#005CC5;">b</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">rolname</span><span style="color:#24292E;">;</span></span></code></pre></div><h2 id="_4-3-函数权限验证" tabindex="-1">4.3 函数权限验证 <a class="header-anchor" href="#_4-3-函数权限验证" aria-label="Permalink to &quot;4.3 函数权限验证&quot;">​</a></h2><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">\\df has_</span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;">_privilege;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">\\df has_</span><span style="color:#D73A49;">*</span><span style="color:#24292E;">_privilege;</span></span></code></pre></div><h3 id="_1-数据库权限" tabindex="-1">1.数据库权限 <a class="header-anchor" href="#_1-数据库权限" aria-label="Permalink to &quot;1.数据库权限&quot;">​</a></h3><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">select has_database_privilege(user,database,privilege);</span></span>
<span class="line"><span style="color:#e1e4e8;">select has_database_privilege(database,privilege);</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">如：</span></span>
<span class="line"><span style="color:#e1e4e8;">taoism_translation=# select has_database_privilege(&#39;taoism_translation&#39;,&#39;create&#39;);</span></span>
<span class="line"><span style="color:#e1e4e8;"> has_database_privilege</span></span>
<span class="line"><span style="color:#e1e4e8;">------------------------</span></span>
<span class="line"><span style="color:#e1e4e8;"> t</span></span>
<span class="line"><span style="color:#e1e4e8;">(1 row)</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">select has_database_privilege(user,database,privilege);</span></span>
<span class="line"><span style="color:#24292e;">select has_database_privilege(database,privilege);</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">如：</span></span>
<span class="line"><span style="color:#24292e;">taoism_translation=# select has_database_privilege(&#39;taoism_translation&#39;,&#39;create&#39;);</span></span>
<span class="line"><span style="color:#24292e;"> has_database_privilege</span></span>
<span class="line"><span style="color:#24292e;">------------------------</span></span>
<span class="line"><span style="color:#24292e;"> t</span></span>
<span class="line"><span style="color:#24292e;">(1 row)</span></span></code></pre></div><h3 id="_2-schema权限" tabindex="-1">2.schema权限 <a class="header-anchor" href="#_2-schema权限" aria-label="Permalink to &quot;2.schema权限&quot;">​</a></h3><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">select</span><span style="color:#E1E4E8;"> has_schema_privilege(user,</span><span style="color:#F97583;">schema</span><span style="color:#E1E4E8;">,privilege);</span></span>
<span class="line"><span style="color:#F97583;">select</span><span style="color:#E1E4E8;"> has_schema_privilege(</span><span style="color:#F97583;">schema</span><span style="color:#E1E4E8;">,privilege);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">taoism_translation</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"># \\dn</span></span>
<span class="line"><span style="color:#E1E4E8;">      List of schemas</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">Name</span><span style="color:#E1E4E8;">  |       </span><span style="color:#F97583;">Owner</span></span>
<span class="line"><span style="color:#6A737D;">--------+-------------------</span></span>
<span class="line"><span style="color:#E1E4E8;"> public | pg_database_owner</span></span>
<span class="line"><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">row</span><span style="color:#E1E4E8;">)</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">select</span><span style="color:#24292E;"> has_schema_privilege(user,</span><span style="color:#D73A49;">schema</span><span style="color:#24292E;">,privilege);</span></span>
<span class="line"><span style="color:#D73A49;">select</span><span style="color:#24292E;"> has_schema_privilege(</span><span style="color:#D73A49;">schema</span><span style="color:#24292E;">,privilege);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">taoism_translation</span><span style="color:#D73A49;">=</span><span style="color:#24292E;"># \\dn</span></span>
<span class="line"><span style="color:#24292E;">      List of schemas</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">Name</span><span style="color:#24292E;">  |       </span><span style="color:#D73A49;">Owner</span></span>
<span class="line"><span style="color:#6A737D;">--------+-------------------</span></span>
<span class="line"><span style="color:#24292E;"> public | pg_database_owner</span></span>
<span class="line"><span style="color:#24292E;">(</span><span style="color:#005CC5;">1</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">row</span><span style="color:#24292E;">)</span></span></code></pre></div><h3 id="_3-表的权限" tabindex="-1">3.表的权限 <a class="header-anchor" href="#_3-表的权限" aria-label="Permalink to &quot;3.表的权限&quot;">​</a></h3><p>has_table_privilege检查用户是否以特定方式访问表。如果使用文本字符串来声明所希望的权限类型，这个文本字符串必须是SELECT、INSERT、UPDATE、DELETE、TRUNCATE、REFERENCES、TRIGGER。</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">select has_table_privilege(user,table,privilege);</span></span>
<span class="line"><span style="color:#e1e4e8;">select has_table_privilege(table,privilege);</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">select has_table_privilege(user,table,privilege);</span></span>
<span class="line"><span style="color:#24292e;">select has_table_privilege(table,privilege);</span></span></code></pre></div><h2 id="_4-2-系统权限、对象权限" tabindex="-1">4.2 系统权限、对象权限 <a class="header-anchor" href="#_4-2-系统权限、对象权限" aria-label="Permalink to &quot;4.2 系统权限、对象权限&quot;">​</a></h2><h3 id="_1-查看某用户的系统权限" tabindex="-1">1.查看某用户的系统权限 <a class="header-anchor" href="#_1-查看某用户的系统权限" aria-label="Permalink to &quot;1.查看某用户的系统权限&quot;">​</a></h3><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">SELECT</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">FROM</span><span style="color:#E1E4E8;">  pg_roles </span><span style="color:#F97583;">WHERE</span><span style="color:#E1E4E8;"> rolname</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&#39;postgres&#39;</span><span style="color:#E1E4E8;">;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">SELECT</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">*</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">FROM</span><span style="color:#24292E;">  pg_roles </span><span style="color:#D73A49;">WHERE</span><span style="color:#24292E;"> rolname</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&#39;postgres&#39;</span><span style="color:#24292E;">;</span></span></code></pre></div><h3 id="_2-查看某用户的表权限" tabindex="-1">2.查看某用户的表权限 <a class="header-anchor" href="#_2-查看某用户的表权限" aria-label="Permalink to &quot;2.查看某用户的表权限&quot;">​</a></h3><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">select</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">information_schema</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">table_privileges</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">where</span><span style="color:#E1E4E8;"> grantee</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&#39;postgres&#39;</span><span style="color:#E1E4E8;">;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">select</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">*</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">from</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">information_schema</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">table_privileges</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">where</span><span style="color:#24292E;"> grantee</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&#39;postgres&#39;</span><span style="color:#24292E;">;</span></span></code></pre></div><h3 id="_3-查看某用户的usage权限" tabindex="-1">3.查看某用户的usage权限 <a class="header-anchor" href="#_3-查看某用户的usage权限" aria-label="Permalink to &quot;3.查看某用户的usage权限&quot;">​</a></h3><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">select</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">information_schema</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">usage_privileges</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">where</span><span style="color:#E1E4E8;"> grantee</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&#39;postgres&#39;</span><span style="color:#E1E4E8;">;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">select</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">*</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">from</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">information_schema</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">usage_privileges</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">where</span><span style="color:#24292E;"> grantee</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&#39;postgres&#39;</span><span style="color:#24292E;">;</span></span></code></pre></div><h3 id="_4-查看某用户在存储过程函数的执行权限" tabindex="-1">4.查看某用户在存储过程函数的执行权限 <a class="header-anchor" href="#_4-查看某用户在存储过程函数的执行权限" aria-label="Permalink to &quot;4.查看某用户在存储过程函数的执行权限&quot;">​</a></h3><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">select</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">information_schema</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">routine_privileges</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">where</span><span style="color:#E1E4E8;"> grantee</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&#39;postgres&#39;</span><span style="color:#E1E4E8;">;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">select</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">*</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">from</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">information_schema</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">routine_privileges</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">where</span><span style="color:#24292E;"> grantee</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&#39;postgres&#39;</span><span style="color:#24292E;">;</span></span></code></pre></div><h3 id="_5-查看某用户在某表的列上的权限" tabindex="-1">5.查看某用户在某表的列上的权限 <a class="header-anchor" href="#_5-查看某用户在某表的列上的权限" aria-label="Permalink to &quot;5.查看某用户在某表的列上的权限&quot;">​</a></h3><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">select</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">information_schema</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">column_privileges</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">where</span><span style="color:#E1E4E8;"> grantee</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&#39;postgres&#39;</span><span style="color:#E1E4E8;">;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">select</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">*</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">from</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">information_schema</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">column_privileges</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">where</span><span style="color:#24292E;"> grantee</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&#39;postgres&#39;</span><span style="color:#24292E;">;</span></span></code></pre></div><h3 id="_6-查看当前用户能够访问的数据类型" tabindex="-1">6.查看当前用户能够访问的数据类型 <a class="header-anchor" href="#_6-查看当前用户能够访问的数据类型" aria-label="Permalink to &quot;6.查看当前用户能够访问的数据类型&quot;">​</a></h3><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">select</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">information_schema</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">data_type_privileges</span><span style="color:#E1E4E8;"> ;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">select</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">*</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">from</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">information_schema</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">data_type_privileges</span><span style="color:#24292E;"> ;</span></span></code></pre></div><h3 id="_7-查看用户自定义类型上授予的usage权限" tabindex="-1">7.查看用户自定义类型上授予的USAGE权限 <a class="header-anchor" href="#_7-查看用户自定义类型上授予的usage权限" aria-label="Permalink to &quot;7.查看用户自定义类型上授予的USAGE权限&quot;">​</a></h3><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">select</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">information_schema</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">udt_privileges</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">where</span><span style="color:#E1E4E8;"> grantee</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&#39;postgres&#39;</span><span style="color:#E1E4E8;">;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">select</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">*</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">from</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">information_schema</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">udt_privileges</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">where</span><span style="color:#24292E;"> grantee</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&#39;postgres&#39;</span><span style="color:#24292E;">;</span></span></code></pre></div><ul><li>查看</li></ul><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">-- 查看当前模式（默认是 &#39;public&#39;）的权限分配</span></span>
<span class="line"><span style="color:#E1E4E8;">\\dp</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">-- 或者使用 \\z 命令，这通常会显示更详细的信息</span></span>
<span class="line"><span style="color:#E1E4E8;">\\z</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">-- 查看当前模式（默认是 &#39;public&#39;）的权限分配</span></span>
<span class="line"><span style="color:#24292E;">\\dp</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">-- 或者使用 \\z 命令，这通常会显示更详细的信息</span></span>
<span class="line"><span style="color:#24292E;">\\z</span></span></code></pre></div><h1 id="_5-修改表拥有者" tabindex="-1">5.修改表拥有者 <a class="header-anchor" href="#_5-修改表拥有者" aria-label="Permalink to &quot;5.修改表拥有者&quot;">​</a></h1><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">ALTER TABLE your_table_name OWNER TO new_owner;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">ALTER TABLE your_table_name OWNER TO new_owner;</span></span></code></pre></div>`,54),e=[o];function t(c,r,E,y,i,d){return a(),n("div",null,e)}const g=s(p,[["render",t]]);export{h as __pageData,g as default};
