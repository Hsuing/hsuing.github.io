import{_ as s,o as a,c as n,R as l}from"./chunks/framework.zUbWieqp.js";const d=JSON.parse('{"title":"1. 编写配置文件yaml","description":"","frontmatter":{},"headers":[],"relativePath":"guide/container/k8s/CICD/base_jenkins/online_case.md","filePath":"guide/container/k8s/CICD/base_jenkins/online_case.md","lastUpdated":1723529168000}'),p={name:"guide/container/k8s/CICD/base_jenkins/online_case.md"},o=l(`<h1 id="_1-编写配置文件yaml" tabindex="-1">1. 编写配置文件yaml <a class="header-anchor" href="#_1-编写配置文件yaml" aria-label="Permalink to &quot;1. 编写配置文件yaml&quot;">​</a></h1><ul><li><p>编写configmap配置文件</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">[root@k8s-master java-demo]# vim  configmap.yaml </span></span>
<span class="line"><span style="color:#E1E4E8;">[root@k8s-master java-demo]# cat configmap.yaml </span></span>
<span class="line"><span style="color:#B392F0;">apiVersion:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">v1</span></span>
<span class="line"><span style="color:#B392F0;">kind:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">ConfigMap</span></span>
<span class="line"><span style="color:#B392F0;">metadata:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">name:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">java-demo-config</span><span style="color:#E1E4E8;">     </span><span style="color:#6A737D;"># 应用卷的名字</span></span>
<span class="line"><span style="color:#B392F0;">data:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">application.yml:</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#B392F0;">server:</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#B392F0;">port:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">8080</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#B392F0;">spring:</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#B392F0;">datasource:</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#B392F0;">url:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">jdbc:mysql://121.4.77.138:3306/java_demo?characterEncoding=utf-8</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#B392F0;">username:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">java_demo</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#B392F0;">password:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Aa@9953013</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#B392F0;">driver-class-name:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">com.mysql.jdbc.Driver</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#B392F0;">freemarker:</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#B392F0;">allow-request-override:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">false</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#B392F0;">cache:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">true</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#B392F0;">check-template-location:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">true</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#B392F0;">charset:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">UTF-8</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#B392F0;">content-type:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">text/html</span><span style="color:#E1E4E8;">; charset</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">utf-8</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#B392F0;">expose-request-attributes:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">false</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#B392F0;">expose-session-attributes:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">false</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#B392F0;">expose-spring-macro-helpers:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">false</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#B392F0;">suffix:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">.ftl</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#B392F0;">template-loader-path:</span></span>
<span class="line"><span style="color:#E1E4E8;">              </span><span style="color:#B392F0;">-</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">classpath:/templates/</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">[root@k8s-master java-demo]# vim  configmap.yaml </span></span>
<span class="line"><span style="color:#24292E;">[root@k8s-master java-demo]# cat configmap.yaml </span></span>
<span class="line"><span style="color:#6F42C1;">apiVersion:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">v1</span></span>
<span class="line"><span style="color:#6F42C1;">kind:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">ConfigMap</span></span>
<span class="line"><span style="color:#6F42C1;">metadata:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">name:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">java-demo-config</span><span style="color:#24292E;">     </span><span style="color:#6A737D;"># 应用卷的名字</span></span>
<span class="line"><span style="color:#6F42C1;">data:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">application.yml:</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6F42C1;">server:</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#6F42C1;">port:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">8080</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6F42C1;">spring:</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#6F42C1;">datasource:</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#6F42C1;">url:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">jdbc:mysql://121.4.77.138:3306/java_demo?characterEncoding=utf-8</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#6F42C1;">username:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">java_demo</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#6F42C1;">password:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Aa@9953013</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#6F42C1;">driver-class-name:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">com.mysql.jdbc.Driver</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#6F42C1;">freemarker:</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#6F42C1;">allow-request-override:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">false</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#6F42C1;">cache:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">true</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#6F42C1;">check-template-location:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">true</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#6F42C1;">charset:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">UTF-8</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#6F42C1;">content-type:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">text/html</span><span style="color:#24292E;">; charset</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">utf-8</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#6F42C1;">expose-request-attributes:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">false</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#6F42C1;">expose-session-attributes:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">false</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#6F42C1;">expose-spring-macro-helpers:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">false</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#6F42C1;">suffix:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">.ftl</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#6F42C1;">template-loader-path:</span></span>
<span class="line"><span style="color:#24292E;">              </span><span style="color:#6F42C1;">-</span><span style="color:#24292E;"> </span><span style="color:#032F62;">classpath:/templates/</span></span></code></pre></div></li><li><p>应用配置文件</p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">[</span><span style="color:#9ECBFF;">root@k8s-master java-demo</span><span style="color:#E1E4E8;">]# </span><span style="color:#9ECBFF;">kubectl apply -f configmap.yaml</span><span style="color:#E1E4E8;"> </span></span>
<span class="line"><span style="color:#9ECBFF;">configmap/java-demo-config created</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">[</span><span style="color:#032F62;">root@k8s-master java-demo</span><span style="color:#24292E;">]# </span><span style="color:#032F62;">kubectl apply -f configmap.yaml</span><span style="color:#24292E;"> </span></span>
<span class="line"><span style="color:#032F62;">configmap/java-demo-config created</span></span></code></pre></div></li></ul><h1 id="_2-创建configmap" tabindex="-1">2. 创建configmap <a class="header-anchor" href="#_2-创建configmap" aria-label="Permalink to &quot;2. 创建configmap&quot;">​</a></h1><ul><li><p>编写应用配置文件yaml</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">[root@k8s-master java-demo]# vim java_demo.yaml </span></span>
<span class="line"><span style="color:#E1E4E8;">[root@k8s-master java-demo]# cat java_demo.yaml</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">[root@k8s-master java-demo]# vim java_demo.yaml </span></span>
<span class="line"><span style="color:#24292E;">[root@k8s-master java-demo]# cat java_demo.yaml</span></span></code></pre></div><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#85E89D;">apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">apps/v1</span></span>
<span class="line"><span style="color:#85E89D;">kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Deployment</span></span>
<span class="line"><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">java-demo</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">namespace</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">default</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">labels</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">app</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">java-demo</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">annotations</span><span style="color:#E1E4E8;">:       </span><span style="color:#6A737D;"># 记录回滚参数</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">kubernetes.io/change-cause</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;java-demo:v1&quot;</span><span style="color:#E1E4E8;">   </span><span style="color:#6A737D;">#记录到revision中的内容，记录版本号</span></span>
<span class="line"><span style="color:#85E89D;">spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">replicas</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">3</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># Pod副本预期数量</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">revisionHistoryLimit</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">10</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># RS历史版本保存数量</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">selector</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">matchLabels</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">app</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">java-demo</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">strategy</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">rollingUpdate</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">maxSurge</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">25%</span><span style="color:#E1E4E8;">             </span><span style="color:#6A737D;"># 滚动更新过程最大pod副本数</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">maxUnavailable</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">25%</span><span style="color:#E1E4E8;">       </span><span style="color:#6A737D;"># 滚动更新过程中最大不可用pod副本数，</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">type</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">RollingUpdate</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">template</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">labels</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">app</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">java-demo</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># Pod副本的标签</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">imagePullSecrets</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      - </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">harbor-auth</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">containers</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      - </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">java-demo</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">image</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">harbor.ikubernetes.net/hsuing/java:v1</span><span style="color:#E1E4E8;">         </span><span style="color:#6A737D;"># 获取容器</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">ports</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">        - </span><span style="color:#85E89D;">containerPort</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">8080</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">resources</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#85E89D;">requests</span><span style="color:#E1E4E8;">:              </span><span style="color:#6A737D;"># 启动容器最小资源</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#85E89D;">memory</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;256Mi&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#85E89D;">cpu</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;500m&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#85E89D;">limits</span><span style="color:#E1E4E8;">:                 </span><span style="color:#6A737D;"># 容器的最大资源限制</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#85E89D;">memory</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;512Mi&quot;</span><span style="color:#E1E4E8;">       </span><span style="color:#6A737D;"># 容器的最大资源内存限制128M</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#85E89D;">cpu</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;1000m&quot;</span><span style="color:#E1E4E8;">           </span><span style="color:#6A737D;"># 容器的最大资源cpu的核数限制，500m=0.5核数</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">readinessProbe</span><span style="color:#E1E4E8;">:         </span><span style="color:#6A737D;"># 就绪检查，失败就会剔除 service </span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#85E89D;">httpGet</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#85E89D;">port</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">8080</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#85E89D;">path</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">/</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#85E89D;">initialDelaySeconds</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">20</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;">#启动容器后多少秒健康检查</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#85E89D;">periodSeconds</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">20</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;">#以后间隔多少秒检查一次</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">livenessProbe</span><span style="color:#E1E4E8;">:    </span><span style="color:#6A737D;"># 存活检查,如果失败，将杀死容器，来重启</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#85E89D;">httpGet</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#85E89D;">port</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">8080</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#85E89D;">path</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">/</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">volumeMounts</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">        - </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">config</span><span style="color:#E1E4E8;">       </span><span style="color:#6A737D;"># 指定共享卷的名称</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#85E89D;">mountPath</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;/usr/local/tomcat/webapps/ROOT/WEB-INF/classes/application.yml&quot;</span><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;"># 指定挂载目录下</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#85E89D;">subPath</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">application.yml</span><span style="color:#E1E4E8;">     </span><span style="color:#6A737D;"># 指定文件名称</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">volumes</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      - </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">config</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">configMap</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">java-demo-config</span><span style="color:#E1E4E8;">        </span><span style="color:#6A737D;"># 指定configmap的卷名</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#85E89D;">items</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">          - </span><span style="color:#85E89D;">key</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;application.yml&quot;</span><span style="color:#E1E4E8;">      </span><span style="color:#6A737D;"># 指定的configmap的data里的保存的文件名</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#85E89D;">path</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;application.yml&quot;</span><span style="color:#E1E4E8;">     </span><span style="color:#6A737D;"># 指定configmap的data文件</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#22863A;">apiVersion</span><span style="color:#24292E;">: </span><span style="color:#032F62;">apps/v1</span></span>
<span class="line"><span style="color:#22863A;">kind</span><span style="color:#24292E;">: </span><span style="color:#032F62;">Deployment</span></span>
<span class="line"><span style="color:#22863A;">metadata</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">java-demo</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">namespace</span><span style="color:#24292E;">: </span><span style="color:#032F62;">default</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">labels</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">app</span><span style="color:#24292E;">: </span><span style="color:#032F62;">java-demo</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">annotations</span><span style="color:#24292E;">:       </span><span style="color:#6A737D;"># 记录回滚参数</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">kubernetes.io/change-cause</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;java-demo:v1&quot;</span><span style="color:#24292E;">   </span><span style="color:#6A737D;">#记录到revision中的内容，记录版本号</span></span>
<span class="line"><span style="color:#22863A;">spec</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">replicas</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">3</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># Pod副本预期数量</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">revisionHistoryLimit</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">10</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># RS历史版本保存数量</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">selector</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">matchLabels</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">app</span><span style="color:#24292E;">: </span><span style="color:#032F62;">java-demo</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">strategy</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">rollingUpdate</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">maxSurge</span><span style="color:#24292E;">: </span><span style="color:#032F62;">25%</span><span style="color:#24292E;">             </span><span style="color:#6A737D;"># 滚动更新过程最大pod副本数</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">maxUnavailable</span><span style="color:#24292E;">: </span><span style="color:#032F62;">25%</span><span style="color:#24292E;">       </span><span style="color:#6A737D;"># 滚动更新过程中最大不可用pod副本数，</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">type</span><span style="color:#24292E;">: </span><span style="color:#032F62;">RollingUpdate</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">template</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">metadata</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">labels</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">app</span><span style="color:#24292E;">: </span><span style="color:#032F62;">java-demo</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># Pod副本的标签</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">spec</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">imagePullSecrets</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">harbor-auth</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">containers</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">java-demo</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">image</span><span style="color:#24292E;">: </span><span style="color:#032F62;">harbor.ikubernetes.net/hsuing/java:v1</span><span style="color:#24292E;">         </span><span style="color:#6A737D;"># 获取容器</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">ports</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">        - </span><span style="color:#22863A;">containerPort</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">8080</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">resources</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#22863A;">requests</span><span style="color:#24292E;">:              </span><span style="color:#6A737D;"># 启动容器最小资源</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#22863A;">memory</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;256Mi&quot;</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#22863A;">cpu</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;500m&quot;</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#22863A;">limits</span><span style="color:#24292E;">:                 </span><span style="color:#6A737D;"># 容器的最大资源限制</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#22863A;">memory</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;512Mi&quot;</span><span style="color:#24292E;">       </span><span style="color:#6A737D;"># 容器的最大资源内存限制128M</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#22863A;">cpu</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;1000m&quot;</span><span style="color:#24292E;">           </span><span style="color:#6A737D;"># 容器的最大资源cpu的核数限制，500m=0.5核数</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">readinessProbe</span><span style="color:#24292E;">:         </span><span style="color:#6A737D;"># 就绪检查，失败就会剔除 service </span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#22863A;">httpGet</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#22863A;">port</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">8080</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#22863A;">path</span><span style="color:#24292E;">: </span><span style="color:#032F62;">/</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#22863A;">initialDelaySeconds</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">20</span><span style="color:#24292E;"> </span><span style="color:#6A737D;">#启动容器后多少秒健康检查</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#22863A;">periodSeconds</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">20</span><span style="color:#24292E;"> </span><span style="color:#6A737D;">#以后间隔多少秒检查一次</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">livenessProbe</span><span style="color:#24292E;">:    </span><span style="color:#6A737D;"># 存活检查,如果失败，将杀死容器，来重启</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#22863A;">httpGet</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#22863A;">port</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">8080</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#22863A;">path</span><span style="color:#24292E;">: </span><span style="color:#032F62;">/</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">volumeMounts</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">        - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">config</span><span style="color:#24292E;">       </span><span style="color:#6A737D;"># 指定共享卷的名称</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#22863A;">mountPath</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;/usr/local/tomcat/webapps/ROOT/WEB-INF/classes/application.yml&quot;</span><span style="color:#24292E;">    </span><span style="color:#6A737D;"># 指定挂载目录下</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#22863A;">subPath</span><span style="color:#24292E;">: </span><span style="color:#032F62;">application.yml</span><span style="color:#24292E;">     </span><span style="color:#6A737D;"># 指定文件名称</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">volumes</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">config</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">configMap</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">java-demo-config</span><span style="color:#24292E;">        </span><span style="color:#6A737D;"># 指定configmap的卷名</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#22863A;">items</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">          - </span><span style="color:#22863A;">key</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;application.yml&quot;</span><span style="color:#24292E;">      </span><span style="color:#6A737D;"># 指定的configmap的data里的保存的文件名</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#22863A;">path</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;application.yml&quot;</span><span style="color:#24292E;">     </span><span style="color:#6A737D;"># 指定configmap的data文件</span></span></code></pre></div></li><li><p>启动配置文件</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">[root@k8s-master java-demo]# kubectl apply -f java_demo.yaml </span></span>
<span class="line"><span style="color:#B392F0;">deployment.apps/java-demo</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">configured</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">[root@k8s-master java-demo]# kubectl apply -f java_demo.yaml </span></span>
<span class="line"><span style="color:#6F42C1;">deployment.apps/java-demo</span><span style="color:#24292E;"> </span><span style="color:#032F62;">configured</span></span></code></pre></div></li></ul>`,4),e=[o];function c(t,r,E,y,i,F){return a(),n("div",null,e)}const u=s(p,[["render",c]]);export{d as __pageData,u as default};
