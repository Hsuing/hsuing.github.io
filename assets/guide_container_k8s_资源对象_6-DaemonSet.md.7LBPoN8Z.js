import{_ as s,o as n,c as a,R as p}from"./chunks/framework.zUbWieqp.js";const m=JSON.parse('{"title":"1.DaemonSet基本概述","description":"","frontmatter":{},"headers":[],"relativePath":"guide/container/k8s/资源对象/6-DaemonSet.md","filePath":"guide/container/k8s/资源对象/6-DaemonSet.md","lastUpdated":1729246382000}'),l={name:"guide/container/k8s/资源对象/6-DaemonSet.md"},o=p(`<h1 id="_1-daemonset基本概述" tabindex="-1">1.DaemonSet基本概述 <a class="header-anchor" href="#_1-daemonset基本概述" aria-label="Permalink to &quot;1.DaemonSet基本概述&quot;">​</a></h1><h2 id="_1-1-什么是daemonset" tabindex="-1">1.1 什么是DaemonSet <a class="header-anchor" href="#_1-1-什么是daemonset" aria-label="Permalink to &quot;1.1 什么是DaemonSet&quot;">​</a></h2><p>Kubernetes 中的 DaemonSet 是一种控制器，用于确保集群中的每个节点都运行一个 Pod 的副本。与 ReplicaSet 或 Deployment 不同，DaemonSet 中的 Pod 在每个节点上运行一个副本，而不是在整个集群中维护特定数量的副本。</p><p>当有节点加⼊集群时， 也会为他们新增⼀个 Pod。 当有节点从集群移除时，这些 Pod 也会被回收。删除 DaemonSet 将会删除它创建的所有 Pod。</p><p><img src="https://nnaigos.oss-cn-hangzhou.aliyuncs.com/imgs/202405131808424.png" alt="image-20240513180816181"></p><h2 id="_1-2-daemonset典型用法" tabindex="-1">1.2 DaemonSet典型⽤法 <a class="header-anchor" href="#_1-2-daemonset典型用法" aria-label="Permalink to &quot;1.2 DaemonSet典型⽤法&quot;">​</a></h2><ul><li>在每个节点上运行集群存储守护进程，如：<code>GLuster、Ceph</code></li><li>在每个节点上运行日志收集守护进程，如：<code>fluentd、Filebeat、Logstash</code></li><li>在每个节点上运行监控守护进程，如：<code>PrometheusNodeExporter</code></li><li>在每个节点上运行网络插件为Pod提供网络服务，如：<code>fLannel、calico</code></li></ul><h2 id="_1-3-daemonset常用参数" tabindex="-1">1.3 DaemonSet常用参数 <a class="header-anchor" href="#_1-3-daemonset常用参数" aria-label="Permalink to &quot;1.3 DaemonSet常用参数&quot;">​</a></h2><p><code>DaemonSet</code>是标准的API资源类型，它在spec字段中嵌套字段有<code>selector、tempalte</code>，与Deployment用法基本相同，但DaemonSet 不管理Replicas，因为<code>DaemonSet不是基于期望的副本数</code>，而是<code>基于节点数量来控制Pod数量</code>。</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">$</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">explain</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">daemonset</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">GROUP:</span><span style="color:#E1E4E8;">      </span><span style="color:#9ECBFF;">apps</span></span>
<span class="line"><span style="color:#B392F0;">KIND:</span><span style="color:#E1E4E8;">       </span><span style="color:#9ECBFF;">DaemonSet</span></span>
<span class="line"><span style="color:#B392F0;">VERSION:</span><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">v1</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">DESCRIPTION:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">DaemonSet</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">represents</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">the</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">configuration</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">of</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">a</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">daemon</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">set.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">FIELDS:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">apiVersion</span><span style="color:#E1E4E8;">	</span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">strin</span><span style="color:#E1E4E8;">g</span><span style="color:#F97583;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">APIVersion</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">defines</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">the</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">versioned</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">schema</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">of</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">this</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">representation</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">of</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">an</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">object.</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">Servers</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">should</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">convert</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">recognized</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">schemas</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">to</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">the</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">latest</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">internal</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">value,</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">and</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">may</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">reject</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">unrecognized</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">values.</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">More</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">info:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">kind</span><span style="color:#E1E4E8;">	</span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">strin</span><span style="color:#E1E4E8;">g</span><span style="color:#F97583;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">Kind</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">is</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">a</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">string</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">value</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">representing</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">the</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">REST</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">resource</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">this</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">object</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">represents.</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Servers</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">may</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">infer</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">this</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">from</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">the</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">endpoint</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">the</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">client</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">submits</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">requests</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">to.</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Cannot</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">be</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">updated.</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">In</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">CamelCase.</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">More</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">info:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">metadata</span><span style="color:#E1E4E8;">	</span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">ObjectMet</span><span style="color:#E1E4E8;">a</span><span style="color:#F97583;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">Standard</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">object&#39;s metadata. More info:</span></span>
<span class="line"><span style="color:#9ECBFF;">    https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#metadata</span></span>
<span class="line"></span>
<span class="line"><span style="color:#9ECBFF;">  spec	&lt;DaemonSetSpec&gt;</span></span>
<span class="line"><span style="color:#9ECBFF;">    The desired behavior of this daemon set. More info:</span></span>
<span class="line"><span style="color:#9ECBFF;">    https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#spec-and-status</span></span>
<span class="line"></span>
<span class="line"><span style="color:#9ECBFF;">  status	&lt;DaemonSetStatus&gt;</span></span>
<span class="line"><span style="color:#9ECBFF;">    The current status of this daemon set. This data may be out of date by some</span></span>
<span class="line"><span style="color:#9ECBFF;">    window of time. Populated by the system. Read-only. More info:</span></span>
<span class="line"><span style="color:#9ECBFF;">    https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#spec-and-status</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">$</span><span style="color:#24292E;"> </span><span style="color:#032F62;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">explain</span><span style="color:#24292E;"> </span><span style="color:#032F62;">daemonset</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">GROUP:</span><span style="color:#24292E;">      </span><span style="color:#032F62;">apps</span></span>
<span class="line"><span style="color:#6F42C1;">KIND:</span><span style="color:#24292E;">       </span><span style="color:#032F62;">DaemonSet</span></span>
<span class="line"><span style="color:#6F42C1;">VERSION:</span><span style="color:#24292E;">    </span><span style="color:#032F62;">v1</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">DESCRIPTION:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">DaemonSet</span><span style="color:#24292E;"> </span><span style="color:#032F62;">represents</span><span style="color:#24292E;"> </span><span style="color:#032F62;">the</span><span style="color:#24292E;"> </span><span style="color:#032F62;">configuration</span><span style="color:#24292E;"> </span><span style="color:#032F62;">of</span><span style="color:#24292E;"> </span><span style="color:#032F62;">a</span><span style="color:#24292E;"> </span><span style="color:#032F62;">daemon</span><span style="color:#24292E;"> </span><span style="color:#032F62;">set.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">FIELDS:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">apiVersion</span><span style="color:#24292E;">	</span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">strin</span><span style="color:#24292E;">g</span><span style="color:#D73A49;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">APIVersion</span><span style="color:#24292E;"> </span><span style="color:#032F62;">defines</span><span style="color:#24292E;"> </span><span style="color:#032F62;">the</span><span style="color:#24292E;"> </span><span style="color:#032F62;">versioned</span><span style="color:#24292E;"> </span><span style="color:#032F62;">schema</span><span style="color:#24292E;"> </span><span style="color:#032F62;">of</span><span style="color:#24292E;"> </span><span style="color:#032F62;">this</span><span style="color:#24292E;"> </span><span style="color:#032F62;">representation</span><span style="color:#24292E;"> </span><span style="color:#032F62;">of</span><span style="color:#24292E;"> </span><span style="color:#032F62;">an</span><span style="color:#24292E;"> </span><span style="color:#032F62;">object.</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">Servers</span><span style="color:#24292E;"> </span><span style="color:#032F62;">should</span><span style="color:#24292E;"> </span><span style="color:#032F62;">convert</span><span style="color:#24292E;"> </span><span style="color:#032F62;">recognized</span><span style="color:#24292E;"> </span><span style="color:#032F62;">schemas</span><span style="color:#24292E;"> </span><span style="color:#032F62;">to</span><span style="color:#24292E;"> </span><span style="color:#032F62;">the</span><span style="color:#24292E;"> </span><span style="color:#032F62;">latest</span><span style="color:#24292E;"> </span><span style="color:#032F62;">internal</span><span style="color:#24292E;"> </span><span style="color:#032F62;">value,</span><span style="color:#24292E;"> </span><span style="color:#032F62;">and</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">may</span><span style="color:#24292E;"> </span><span style="color:#032F62;">reject</span><span style="color:#24292E;"> </span><span style="color:#032F62;">unrecognized</span><span style="color:#24292E;"> </span><span style="color:#032F62;">values.</span><span style="color:#24292E;"> </span><span style="color:#032F62;">More</span><span style="color:#24292E;"> </span><span style="color:#032F62;">info:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">kind</span><span style="color:#24292E;">	</span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">strin</span><span style="color:#24292E;">g</span><span style="color:#D73A49;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">Kind</span><span style="color:#24292E;"> </span><span style="color:#032F62;">is</span><span style="color:#24292E;"> </span><span style="color:#032F62;">a</span><span style="color:#24292E;"> </span><span style="color:#032F62;">string</span><span style="color:#24292E;"> </span><span style="color:#032F62;">value</span><span style="color:#24292E;"> </span><span style="color:#032F62;">representing</span><span style="color:#24292E;"> </span><span style="color:#032F62;">the</span><span style="color:#24292E;"> </span><span style="color:#032F62;">REST</span><span style="color:#24292E;"> </span><span style="color:#032F62;">resource</span><span style="color:#24292E;"> </span><span style="color:#032F62;">this</span><span style="color:#24292E;"> </span><span style="color:#032F62;">object</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">represents.</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Servers</span><span style="color:#24292E;"> </span><span style="color:#032F62;">may</span><span style="color:#24292E;"> </span><span style="color:#032F62;">infer</span><span style="color:#24292E;"> </span><span style="color:#032F62;">this</span><span style="color:#24292E;"> </span><span style="color:#032F62;">from</span><span style="color:#24292E;"> </span><span style="color:#032F62;">the</span><span style="color:#24292E;"> </span><span style="color:#032F62;">endpoint</span><span style="color:#24292E;"> </span><span style="color:#032F62;">the</span><span style="color:#24292E;"> </span><span style="color:#032F62;">client</span><span style="color:#24292E;"> </span><span style="color:#032F62;">submits</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">requests</span><span style="color:#24292E;"> </span><span style="color:#032F62;">to.</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Cannot</span><span style="color:#24292E;"> </span><span style="color:#032F62;">be</span><span style="color:#24292E;"> </span><span style="color:#032F62;">updated.</span><span style="color:#24292E;"> </span><span style="color:#032F62;">In</span><span style="color:#24292E;"> </span><span style="color:#032F62;">CamelCase.</span><span style="color:#24292E;"> </span><span style="color:#032F62;">More</span><span style="color:#24292E;"> </span><span style="color:#032F62;">info:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">metadata</span><span style="color:#24292E;">	</span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">ObjectMet</span><span style="color:#24292E;">a</span><span style="color:#D73A49;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">Standard</span><span style="color:#24292E;"> </span><span style="color:#032F62;">object&#39;s metadata. More info:</span></span>
<span class="line"><span style="color:#032F62;">    https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#metadata</span></span>
<span class="line"></span>
<span class="line"><span style="color:#032F62;">  spec	&lt;DaemonSetSpec&gt;</span></span>
<span class="line"><span style="color:#032F62;">    The desired behavior of this daemon set. More info:</span></span>
<span class="line"><span style="color:#032F62;">    https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#spec-and-status</span></span>
<span class="line"></span>
<span class="line"><span style="color:#032F62;">  status	&lt;DaemonSetStatus&gt;</span></span>
<span class="line"><span style="color:#032F62;">    The current status of this daemon set. This data may be out of date by some</span></span>
<span class="line"><span style="color:#032F62;">    window of time. Populated by the system. Read-only. More info:</span></span>
<span class="line"><span style="color:#032F62;">    https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#spec-and-status</span></span></code></pre></div><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#85E89D;">apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">apps/v1</span></span>
<span class="line"><span style="color:#85E89D;">kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">DaemonSet</span></span>
<span class="line"><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&lt;string&gt;</span><span style="color:#E1E4E8;">      </span><span style="color:#6A737D;">#资源名称</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">namespace</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&lt;string&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;">#名称空间：DaemonSet资源⾪属于名称空间级别</span></span>
<span class="line"><span style="color:#85E89D;">spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">minReadySeconds</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&lt;integer&gt;</span><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;">#Pod就绪后多少秒内任一容器无崩溃方视为“就绪”</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">selector</span><span style="color:#E1E4E8;">:                   </span><span style="color:#6A737D;">#标签选择器，必须匹配tempLate字段中Pod模板的标签</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">matchLabels</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&lt;string&gt;</span><span style="color:#E1E4E8;">                </span><span style="color:#6A737D;">#选择器标签，DaemonSet控制器⾃动选择符合标签的Pod作为目标</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">revisionHistoryLimit</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&lt;integer&gt;</span><span style="color:#E1E4E8;">   </span><span style="color:#6A737D;">#历史版本数量限制，超过限制的历史版本会被清理掉</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">updateStrategy</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">type</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&lt;string&gt;</span><span style="color:#E1E4E8;">                  </span><span style="color:#6A737D;">#更新策略，支持OnDelete、RollingUpdate两种类型</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">rollingUpdate</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&lt;Object&gt;</span><span style="color:#E1E4E8;">         </span><span style="color:#6A737D;">#滚动更新参数，专用于RolLingUpdate类型</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">maxSurge</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&lt;string&gt;</span><span style="color:#E1E4E8;">             </span><span style="color:#6A737D;">#最大超载，可以是绝对值（例如50%）或百分比（例如25%）</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">maxUnavailable</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&lt;string&gt;</span><span style="color:#E1E4E8;">       </span><span style="color:#6A737D;">#最大不可用，可以是绝对值（例如50%）或百分比（例如25%）</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">template</span><span style="color:#E1E4E8;">:                     </span><span style="color:#6A737D;">#Pod模板</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">:                   </span><span style="color:#6A737D;">#Pod元数据(Pod名称)</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">spec</span><span style="color:#E1E4E8;">:                       </span><span style="color:#6A737D;">#Pod规格(Pod详情)</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#22863A;">apiVersion</span><span style="color:#24292E;">: </span><span style="color:#032F62;">apps/v1</span></span>
<span class="line"><span style="color:#22863A;">kind</span><span style="color:#24292E;">: </span><span style="color:#032F62;">DaemonSet</span></span>
<span class="line"><span style="color:#22863A;">metadata</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&lt;string&gt;</span><span style="color:#24292E;">      </span><span style="color:#6A737D;">#资源名称</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">namespace</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&lt;string&gt;</span><span style="color:#24292E;"> </span><span style="color:#6A737D;">#名称空间：DaemonSet资源⾪属于名称空间级别</span></span>
<span class="line"><span style="color:#22863A;">spec</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">minReadySeconds</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&lt;integer&gt;</span><span style="color:#24292E;">  </span><span style="color:#6A737D;">#Pod就绪后多少秒内任一容器无崩溃方视为“就绪”</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">selector</span><span style="color:#24292E;">:                   </span><span style="color:#6A737D;">#标签选择器，必须匹配tempLate字段中Pod模板的标签</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">matchLabels</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&lt;string&gt;</span><span style="color:#24292E;">                </span><span style="color:#6A737D;">#选择器标签，DaemonSet控制器⾃动选择符合标签的Pod作为目标</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">revisionHistoryLimit</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&lt;integer&gt;</span><span style="color:#24292E;">   </span><span style="color:#6A737D;">#历史版本数量限制，超过限制的历史版本会被清理掉</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">updateStrategy</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">type</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&lt;string&gt;</span><span style="color:#24292E;">                  </span><span style="color:#6A737D;">#更新策略，支持OnDelete、RollingUpdate两种类型</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">rollingUpdate</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&lt;Object&gt;</span><span style="color:#24292E;">         </span><span style="color:#6A737D;">#滚动更新参数，专用于RolLingUpdate类型</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">maxSurge</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&lt;string&gt;</span><span style="color:#24292E;">             </span><span style="color:#6A737D;">#最大超载，可以是绝对值（例如50%）或百分比（例如25%）</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">maxUnavailable</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&lt;string&gt;</span><span style="color:#24292E;">       </span><span style="color:#6A737D;">#最大不可用，可以是绝对值（例如50%）或百分比（例如25%）</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">template</span><span style="color:#24292E;">:                     </span><span style="color:#6A737D;">#Pod模板</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">metadata</span><span style="color:#24292E;">:                   </span><span style="color:#6A737D;">#Pod元数据(Pod名称)</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">spec</span><span style="color:#24292E;">:                       </span><span style="color:#6A737D;">#Pod规格(Pod详情)</span></span></code></pre></div><h1 id="_2-daemonset部署实践" tabindex="-1">2.DaemonSet部署实践 <a class="header-anchor" href="#_2-daemonset部署实践" aria-label="Permalink to &quot;2.DaemonSet部署实践&quot;">​</a></h1><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#85E89D;">apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">apps/v1</span></span>
<span class="line"><span style="color:#85E89D;">kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">DaemonSet</span></span>
<span class="line"><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">nginx-ds</span></span>
<span class="line"><span style="color:#85E89D;">spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">selector</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">matchLabels</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">app</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">nginx1</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">template</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">labels</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">app</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">nginx1</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">containers</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      - </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">nginx</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">image</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">nginx:latest</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">ports</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">        - </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">http</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#85E89D;">containerPort</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">80</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">livenessProbe</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#85E89D;">tcpSocket</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#85E89D;">port</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">80</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#85E89D;">initialDelaySeconds</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">3</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">readinessProbe</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#85E89D;">httpGet</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#85E89D;">path</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;/&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#85E89D;">port</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">80</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#85E89D;">scheme</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">HTTP</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#85E89D;">initialDelaySeconds</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">3</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#22863A;">apiVersion</span><span style="color:#24292E;">: </span><span style="color:#032F62;">apps/v1</span></span>
<span class="line"><span style="color:#22863A;">kind</span><span style="color:#24292E;">: </span><span style="color:#032F62;">DaemonSet</span></span>
<span class="line"><span style="color:#22863A;">metadata</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">nginx-ds</span></span>
<span class="line"><span style="color:#22863A;">spec</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">selector</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">matchLabels</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">app</span><span style="color:#24292E;">: </span><span style="color:#032F62;">nginx1</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">template</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">metadata</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">labels</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">app</span><span style="color:#24292E;">: </span><span style="color:#032F62;">nginx1</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">spec</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">containers</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">nginx</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">image</span><span style="color:#24292E;">: </span><span style="color:#032F62;">nginx:latest</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">ports</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">        - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">http</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#22863A;">containerPort</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">80</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">livenessProbe</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#22863A;">tcpSocket</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#22863A;">port</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">80</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#22863A;">initialDelaySeconds</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">3</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">readinessProbe</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#22863A;">httpGet</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#22863A;">path</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;/&quot;</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#22863A;">port</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">80</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#22863A;">scheme</span><span style="color:#24292E;">: </span><span style="color:#032F62;">HTTP</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#22863A;">initialDelaySeconds</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">3</span></span></code></pre></div><h1 id="_3-daemonset更新策略" tabindex="-1">3.DaemonSet更新策略 <a class="header-anchor" href="#_3-daemonset更新策略" aria-label="Permalink to &quot;3.DaemonSet更新策略&quot;">​</a></h1><p>DaemonSet也⽀持更新策略，它⽀持 <code>OnDelete</code> 和 <code>RollingUpdate</code>两种</p><ul><li>OnDelete：是在相应节点的Pod资源被删除后重建为新版本，从而允许用户手动编排更新过程</li><li>RollingUpdate：滚动更新，工作逻辑和DepLoyment滚动更新类似</li></ul><h2 id="_3-1-rollingupdate案例" tabindex="-1">3.1 RollingUpdate案例 <a class="header-anchor" href="#_3-1-rollingupdate案例" aria-label="Permalink to &quot;3.1 RollingUpdate案例&quot;">​</a></h2><p>cat daemonset-node_exporter.yaml</p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;"># image: prom/node-exporter:v0.18.0修改为0.18.1</span></span>
<span class="line"><span style="color:#85E89D;">apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">apps/v1</span></span>
<span class="line"><span style="color:#85E89D;">kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">DaemonSet</span></span>
<span class="line"><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">node-exporter</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">namespace</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">default</span></span>
<span class="line"><span style="color:#85E89D;">spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">minReadySeconds</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">3</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">revisionHistoryLimit</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">20</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">updateStrategy</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">type</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">RollingUpdate</span><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;"># 更新策略</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">rollingUpdate</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">maxUnavailable</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">1</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">selector</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">matchLabels</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">app</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">node-exporter</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">template</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">labels</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">app</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">node-exporter</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">hostNetwork</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">true</span><span style="color:#E1E4E8;">                    </span><span style="color:#6A737D;"># 共享主机网络</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">hostPID</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">true</span><span style="color:#E1E4E8;">                        </span><span style="color:#6A737D;"># 获取主机的PID</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">containers</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      - </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">prometheus-node-exporter</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">image</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">prom/node-exporter:v0.18.1</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">ports</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">        - </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">node-ex-http</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#85E89D;">containerPort</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">9100</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#85E89D;">hostPort</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">9100</span><span style="color:#E1E4E8;">                  </span><span style="color:#6A737D;"># 监听在节点的9100端口上面，节点的9100，实际就在访问这个Pod</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">livenessProbe</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#85E89D;">tcpSocket</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#85E89D;">port</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">node-ex-http</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#85E89D;">initialDelaySeconds</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">5</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">readinessProbe</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#85E89D;">httpGet</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#85E89D;">path</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&#39;/metrics&#39;</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#85E89D;">port</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">node-ex-http</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#85E89D;">initialDelaySeconds</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">5</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;"># image: prom/node-exporter:v0.18.0修改为0.18.1</span></span>
<span class="line"><span style="color:#22863A;">apiVersion</span><span style="color:#24292E;">: </span><span style="color:#032F62;">apps/v1</span></span>
<span class="line"><span style="color:#22863A;">kind</span><span style="color:#24292E;">: </span><span style="color:#032F62;">DaemonSet</span></span>
<span class="line"><span style="color:#22863A;">metadata</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">node-exporter</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">namespace</span><span style="color:#24292E;">: </span><span style="color:#032F62;">default</span></span>
<span class="line"><span style="color:#22863A;">spec</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">minReadySeconds</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">3</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">revisionHistoryLimit</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">20</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">updateStrategy</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">type</span><span style="color:#24292E;">: </span><span style="color:#032F62;">RollingUpdate</span><span style="color:#24292E;">  </span><span style="color:#6A737D;"># 更新策略</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">rollingUpdate</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">maxUnavailable</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">1</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">selector</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">matchLabels</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">app</span><span style="color:#24292E;">: </span><span style="color:#032F62;">node-exporter</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">template</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">metadata</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">labels</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">app</span><span style="color:#24292E;">: </span><span style="color:#032F62;">node-exporter</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">spec</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">hostNetwork</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">true</span><span style="color:#24292E;">                    </span><span style="color:#6A737D;"># 共享主机网络</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">hostPID</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">true</span><span style="color:#24292E;">                        </span><span style="color:#6A737D;"># 获取主机的PID</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">containers</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">prometheus-node-exporter</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">image</span><span style="color:#24292E;">: </span><span style="color:#032F62;">prom/node-exporter:v0.18.1</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">ports</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">        - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">node-ex-http</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#22863A;">containerPort</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">9100</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#22863A;">hostPort</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">9100</span><span style="color:#24292E;">                  </span><span style="color:#6A737D;"># 监听在节点的9100端口上面，节点的9100，实际就在访问这个Pod</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">livenessProbe</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#22863A;">tcpSocket</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#22863A;">port</span><span style="color:#24292E;">: </span><span style="color:#032F62;">node-ex-http</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#22863A;">initialDelaySeconds</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">5</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">readinessProbe</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#22863A;">httpGet</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#22863A;">path</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&#39;/metrics&#39;</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#22863A;">port</span><span style="color:#24292E;">: </span><span style="color:#032F62;">node-ex-http</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#22863A;">initialDelaySeconds</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">5</span></span></code></pre></div><ul><li>查看更新装</li></ul><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">kubectl apply -f daemonset-node_exporter.yaml  &amp;&amp; kubectl rollout status daemonset node-exporter </span></span>
<span class="line"><span style="color:#e1e4e8;">daemonset.apps/node-exporter configured</span></span>
<span class="line"><span style="color:#e1e4e8;">Waiting for daemon set &quot;node-exporter&quot; rollout to finish: 0 out of 2 new pods have been updated...</span></span>
<span class="line"><span style="color:#e1e4e8;">Waiting for daemon set &quot;node-exporter&quot; rollout to finish: 0 out of 2 new pods have been updated...</span></span>
<span class="line"><span style="color:#e1e4e8;">Waiting for daemon set &quot;node-exporter&quot; rollout to finish: 0 out of 2 new pods have been updated...</span></span>
<span class="line"><span style="color:#e1e4e8;">Waiting for daemon set &quot;node-exporter&quot; rollout to finish: 1 out of 2 new pods have been updated...</span></span>
<span class="line"><span style="color:#e1e4e8;">Waiting for daemon set &quot;node-exporter&quot; rollout to finish: 1 out of 2 new pods have been updated...</span></span>
<span class="line"><span style="color:#e1e4e8;">Waiting for daemon set &quot;node-exporter&quot; rollout to finish: 1 out of 2 new pods have been updated...</span></span>
<span class="line"><span style="color:#e1e4e8;">Waiting for daemon set &quot;node-exporter&quot; rollout to finish: 1 out of 2 new pods have been updated...</span></span>
<span class="line"><span style="color:#e1e4e8;">Waiting for daemon set &quot;node-exporter&quot; rollout to finish: 1 of 2 updated pods are available...</span></span>
<span class="line"><span style="color:#e1e4e8;">Waiting for daemon set &quot;node-exporter&quot; rollout to finish: 1 of 2 updated pods are available...</span></span>
<span class="line"><span style="color:#e1e4e8;">daemon set &quot;node-exporter&quot; successfully rolled out</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">kubectl apply -f daemonset-node_exporter.yaml  &amp;&amp; kubectl rollout status daemonset node-exporter </span></span>
<span class="line"><span style="color:#24292e;">daemonset.apps/node-exporter configured</span></span>
<span class="line"><span style="color:#24292e;">Waiting for daemon set &quot;node-exporter&quot; rollout to finish: 0 out of 2 new pods have been updated...</span></span>
<span class="line"><span style="color:#24292e;">Waiting for daemon set &quot;node-exporter&quot; rollout to finish: 0 out of 2 new pods have been updated...</span></span>
<span class="line"><span style="color:#24292e;">Waiting for daemon set &quot;node-exporter&quot; rollout to finish: 0 out of 2 new pods have been updated...</span></span>
<span class="line"><span style="color:#24292e;">Waiting for daemon set &quot;node-exporter&quot; rollout to finish: 1 out of 2 new pods have been updated...</span></span>
<span class="line"><span style="color:#24292e;">Waiting for daemon set &quot;node-exporter&quot; rollout to finish: 1 out of 2 new pods have been updated...</span></span>
<span class="line"><span style="color:#24292e;">Waiting for daemon set &quot;node-exporter&quot; rollout to finish: 1 out of 2 new pods have been updated...</span></span>
<span class="line"><span style="color:#24292e;">Waiting for daemon set &quot;node-exporter&quot; rollout to finish: 1 out of 2 new pods have been updated...</span></span>
<span class="line"><span style="color:#24292e;">Waiting for daemon set &quot;node-exporter&quot; rollout to finish: 1 of 2 updated pods are available...</span></span>
<span class="line"><span style="color:#24292e;">Waiting for daemon set &quot;node-exporter&quot; rollout to finish: 1 of 2 updated pods are available...</span></span>
<span class="line"><span style="color:#24292e;">daemon set &quot;node-exporter&quot; successfully rolled out</span></span></code></pre></div><blockquote><p>默认的RollingUpdate策略将采用一次更新一个Pod对象，待新建的Pod对象就绪后，再更新下一个Pod对象，直到全部完成</p></blockquote><h2 id="_3-2-ondelete更新示例" tabindex="-1">3.2 OnDelete更新示例: <a class="header-anchor" href="#_3-2-ondelete更新示例" aria-label="Permalink to &quot;3.2  OnDelete更新示例:&quot;">​</a></h2><p>cat daemonset-node_exporter.yaml</p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;"># 修改镜像版本为latest</span></span>
<span class="line"></span>
<span class="line"><span style="color:#85E89D;">apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">apps/v1</span></span>
<span class="line"><span style="color:#85E89D;">kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">DaemonSet</span></span>
<span class="line"><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">node-exporter</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">namespace</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">default</span></span>
<span class="line"><span style="color:#85E89D;">spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">minReadySeconds</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">3</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">revisionHistoryLimit</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">10</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">updateStrategy</span><span style="color:#E1E4E8;">:      </span><span style="color:#6A737D;"># 滚动更新策略</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">type</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">OnDelete</span><span style="color:#E1E4E8;">     </span><span style="color:#6A737D;">#  使用OnDelete</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">rollingUpdate</span><span style="color:#E1E4E8;">: </span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">maxUnavailable</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">1</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">selector</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">matchLabels</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">app</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">node-exporter</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">template</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">labels</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">app</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">node-exporter</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">hostNetwork</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">true</span><span style="color:#E1E4E8;">                    </span><span style="color:#6A737D;"># 共享主机网络</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">hostPID</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">true</span><span style="color:#E1E4E8;">                        </span><span style="color:#6A737D;"># 获取主机的PID</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">containers</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      - </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">prometheus-node-exporter</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">image</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">prom/node-exporter:latest</span><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;"># 修改镜像版本为latest。</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">ports</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">        - </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">node-ex-http</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#85E89D;">containerPort</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">9100</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#85E89D;">hostPort</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">9100</span><span style="color:#E1E4E8;">                  </span><span style="color:#6A737D;"># 监听在节点的9100端口上面，节点的9100，实际就在访问这个Pod</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">livenessProbe</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#85E89D;">tcpSocket</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#85E89D;">port</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">node-ex-http</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#85E89D;">initialDelaySeconds</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">5</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">readinessProbe</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#85E89D;">httpGet</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#85E89D;">path</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&#39;/metrics&#39;</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#85E89D;">port</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">node-ex-http</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#85E89D;">initialDelaySeconds</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">5</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;"># 修改镜像版本为latest</span></span>
<span class="line"></span>
<span class="line"><span style="color:#22863A;">apiVersion</span><span style="color:#24292E;">: </span><span style="color:#032F62;">apps/v1</span></span>
<span class="line"><span style="color:#22863A;">kind</span><span style="color:#24292E;">: </span><span style="color:#032F62;">DaemonSet</span></span>
<span class="line"><span style="color:#22863A;">metadata</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">node-exporter</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">namespace</span><span style="color:#24292E;">: </span><span style="color:#032F62;">default</span></span>
<span class="line"><span style="color:#22863A;">spec</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">minReadySeconds</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">3</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">revisionHistoryLimit</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">10</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">updateStrategy</span><span style="color:#24292E;">:      </span><span style="color:#6A737D;"># 滚动更新策略</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">type</span><span style="color:#24292E;">: </span><span style="color:#032F62;">OnDelete</span><span style="color:#24292E;">     </span><span style="color:#6A737D;">#  使用OnDelete</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">rollingUpdate</span><span style="color:#24292E;">: </span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">maxUnavailable</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">1</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">selector</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">matchLabels</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">app</span><span style="color:#24292E;">: </span><span style="color:#032F62;">node-exporter</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">template</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">metadata</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">labels</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">app</span><span style="color:#24292E;">: </span><span style="color:#032F62;">node-exporter</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">spec</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">hostNetwork</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">true</span><span style="color:#24292E;">                    </span><span style="color:#6A737D;"># 共享主机网络</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">hostPID</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">true</span><span style="color:#24292E;">                        </span><span style="color:#6A737D;"># 获取主机的PID</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">containers</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">prometheus-node-exporter</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">image</span><span style="color:#24292E;">: </span><span style="color:#032F62;">prom/node-exporter:latest</span><span style="color:#24292E;">  </span><span style="color:#6A737D;"># 修改镜像版本为latest。</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">ports</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">        - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">node-ex-http</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#22863A;">containerPort</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">9100</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#22863A;">hostPort</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">9100</span><span style="color:#24292E;">                  </span><span style="color:#6A737D;"># 监听在节点的9100端口上面，节点的9100，实际就在访问这个Pod</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">livenessProbe</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#22863A;">tcpSocket</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#22863A;">port</span><span style="color:#24292E;">: </span><span style="color:#032F62;">node-ex-http</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#22863A;">initialDelaySeconds</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">5</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">readinessProbe</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#22863A;">httpGet</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#22863A;">path</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&#39;/metrics&#39;</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#22863A;">port</span><span style="color:#24292E;">: </span><span style="color:#032F62;">node-ex-http</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#22863A;">initialDelaySeconds</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">5</span></span></code></pre></div><blockquote><p>由于OnDelete并非自动完成升级，它需要管理员手动去删除Pod，然后重新拉起新的Pod，才能完成更新。(对于升级有着先后顺序的软件，这种方法非常有用；)</p></blockquote><ul><li>删除Pod；</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">delete</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pods</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">node-exporter-8c2mr</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">delete</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pods</span><span style="color:#24292E;"> </span><span style="color:#032F62;">node-exporter-8c2mr</span></span></code></pre></div><p>查看Pod已经被拉起；</p>`,29),e=[o];function t(c,r,E,y,i,d){return n(),a("div",null,e)}const u=s(l,[["render",t]]);export{m as __pageData,u as default};
