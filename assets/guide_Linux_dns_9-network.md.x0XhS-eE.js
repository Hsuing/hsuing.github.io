import{_ as t,o as e,c as o,R as n}from"./chunks/framework.zUbWieqp.js";const d=JSON.parse('{"title":"","description":"","frontmatter":{},"headers":[],"relativePath":"guide/Linux/dns/9-network.md","filePath":"guide/Linux/dns/9-network.md","lastUpdated":1701416526000}'),a={name:"guide/Linux/dns/9-network.md"},r=n('<p><strong>文档说明</strong>：客户常有各种⽹络加速的需求，⽐如⽤户应⽤系统部署在海外，为了中国客户的良好体验需要加速中国⽤户访问应⽤的速度等。⾯对这类多对⼀的⽹络加速⽅案，本⽂章⾸先分析了中国⽹络现状，然后根据每个⽤户场景分别写了适⽤的解决⽅案，应对客户的加速场景进⾏分析并结合最后的总结部分告知适合的⽅案</p><h2 id="场景" tabindex="-1"><strong>场景</strong> <a class="header-anchor" href="#场景" aria-label="Permalink to &quot;**场景**&quot;">​</a></h2><p>1.应⽤部署在AWS global，加速中国⽤户的访问</p><p>a.不想备案（IP地址在海外）</p><p>b.需要备案 (IP地址在国内)</p><p>2.应⽤部署在AWS China，加速国外⽤户的访问</p><h2 id="中国网络现状" tabindex="-1"><strong>中国网络现状</strong> <a class="header-anchor" href="#中国网络现状" aria-label="Permalink to &quot;**中国网络现状**&quot;">​</a></h2><p><strong>1.网络资源</strong></p><p>a.在中国，所有的基础⽹络设施（包括Internet接⼊和专线接⼊）均由四⼤基础电信企业提供；</p><p>b.四⼤基础电信企业分别为中国移动、中国联通、中国电信、中国⼴电，均为⼤型国有企业，受⼯信部统⼀管理。</p><p>c.根据《⼯业和信息化部关于清理规范互联⽹⽹络接⼊服务市场的通知》规定，跨境专线只能由基础电信企业（主要为移动、联通、电信）提 供，并且需要向电信主管部⻔报备。</p><p><strong>2.跨境VPN</strong></p><p>a.合规性：根据《⼯业和信息化部关于清理规范互联⽹⽹络接⼊服务市场的通知》规定， 未经电信主管部⻔批准，不得⾃⾏建⽴或租⽤专线（含虚拟专⽤⽹络VPN）等其他信道开展跨境经营活动。跨境专线和VPN只能由基础电信企业（主要为移动、联通、电信）提供，并且需要经过电信主管部⻔批准。</p><p><strong>3.ICP备案</strong></p><p>a.ICP备案：中国电信管理机构要求，适⽤于⾮经营性互联⽹信息服务。（普遍业务）</p><p>b.ICP许可证：中国电信管理机构要求，适⽤于经营性互联⽹信息服务。（电商类业务或其它涉及⽀付的业务）</p><p>c.备案要求：提供主办单位和⽹站负责⼈的基本情况、IP地址、⽹站⽹址（中国域名注册商注册的域名）和服务项⽬。</p><p>d.AWS协助：AWS中国地区的运营⽅光环新⽹和⻄云数据负责为托管在AWS中国区域的内容提供⽀持和验证 ICP 备案和ICP许可证的服务</p><h2 id="客户需求一-应用部署在aws-global-加速中国用户的访问-不想备案" tabindex="-1"><strong>客户需求⼀：应用部署在AWS global，加速中国用户的访问（不想备案）</strong> <a class="header-anchor" href="#客户需求一-应用部署在aws-global-加速中国用户的访问-不想备案" aria-label="Permalink to &quot;**客户需求⼀：应用部署在AWS global，加速中国用户的访问（不想备案）**&quot;">​</a></h2><h3 id="方案一-cn2-ip" tabindex="-1"><strong>方案⼀：CN2 IP</strong> <a class="header-anchor" href="#方案一-cn2-ip" aria-label="Permalink to &quot;**方案⼀：CN2 IP**&quot;">​</a></h3><p><img src="https://nnaigos.oss-cn-hangzhou.aliyuncs.com/imgs/202312011519385.jpg" alt=""></p><p><strong>架构搭建：</strong></p><ol><li>购买海外中国电信CN2 IP，将Global Region的NLB IP通知到海外中国电信，中国电信做两个IP间的转发；</li><li>建⽴VPN连接从中国电信CN2机房到Global Region；（⽬前中国电信的海外机房基本覆盖AWS 海外Region ）</li><li>在Global Region的Route 53上设置基于地理位置的规则，将中国IP的访问请求解析到CN2 IP</li></ol><p><strong>数据流：</strong></p><ol><li>中国⽤户访问海外域名（如<a href="https://link.zhihu.com/?target=http%3A//www.example.com/" target="_blank" rel="noreferrer">www.example.com</a>），经Geo Policy解析到CN2 IP；</li><li>海外CN2机房做NAT，将请求转发到Global Region的NLB。</li><li>请求从⽤户端到海外中国电信机房利⽤中国电信⽹络优化访问路径，加速访问。</li></ol><p>可⽤性：</p><ol><li>VPN连接提供了两条隧道。若⽤户希望增加额外的可⽤性，可以购买多个CN2IP及多台防⽕墙设备。</li><li>海外中国电信机房接收到来⾃中国⽤户的请求后，会做NAT， Global Region接收的请求源IP会被替换，看不到⽤户源IP。</li><li>如果希望进⼀步加速中国电信海外机房与AWS Region之间的访问速度，IPSec VPN可以换成Direct Connect，成本会相应上升</li></ol><h3 id="方案二-海外cdn" tabindex="-1">方案⼆：海外CDN <a class="header-anchor" href="#方案二-海外cdn" aria-label="Permalink to &quot;方案⼆：海外CDN&quot;">​</a></h3><p><img src="https://nnaigos.oss-cn-hangzhou.aliyuncs.com/imgs/202312011519749.png" alt=""></p><p><strong>架构搭建：</strong></p><ol><li>购买海外CDN⼚商的CDN服务（CloudFront），包含对中国区⽤户的访问加速。（这⾥需要理解使⽤海外CDN是因为客户不想备案）</li><li>在Global Region的Route 53上设置域名解析到海外部署的CDN分发域名。</li></ol><p><strong>数据流：</strong></p><ol><li>中国⽤户访问海外域名（如<a href="https://link.zhihu.com/?target=http%3A//www.example.cn/" target="_blank" rel="noreferrer">www.example.cn</a> )，经Route 53解析到海外CDN；</li><li>CDN⼚商通过⾃⼰的定期探测机制决定针对特定⽤户区域延迟最低的POP点，并将POP点IP返回给该区域的⽤户。</li><li>CDN⼚商提供优化不同区域⽤户访问延迟的能⼒。（提供类似优化能⼒的CDN合作伙伴有⽹宿、知道创宇等）</li></ol><p><strong>可⽤性：</strong></p><ol><li>若⽤户使⽤CloudFront服务，CloudFront服务本身是⾼可⽤的</li></ol><h2 id="客户需求二-应用部署在aws-global-加速中国用户的访问-需要备案" tabindex="-1">客户需求⼆：应用部署在AWS global，加速中国用户的访问（需要备案） <a class="header-anchor" href="#客户需求二-应用部署在aws-global-加速中国用户的访问-需要备案" aria-label="Permalink to &quot;客户需求⼆：应用部署在AWS global，加速中国用户的访问（需要备案）&quot;">​</a></h2><p><img src="https://nnaigos.oss-cn-hangzhou.aliyuncs.com/imgs/202312011519455.jpg" alt=""></p><h3 id="方案一-direct-connect-专线" tabindex="-1">⽅案⼀：<strong>Direct Connect +</strong> 专线 <a class="header-anchor" href="#方案一-direct-connect-专线" aria-label="Permalink to &quot;⽅案⼀：**Direct Connect +** 专线&quot;">​</a></h3><p><strong>架构搭建：</strong></p><ol><li><p>购买中国域名（如<a href="https://link.zhihu.com/?target=http%3A//example.cn" target="_blank" rel="noreferrer">http://example.cn</a>）并做ICP备案；</p></li><li><p>在北京/宁夏 Region部署EC2代理集群，转发请求到Global Region的NLB；</p></li><li><p>建⽴Direct Connect连接，购买运营商（常⽤合作伙伴：中国移动，中国联通，中国电信）专线，从北京/宁夏 Region到Global Region加速访问。</p></li></ol><p><strong>数据流：</strong></p><p>中国⽤户访问中国域名（如<a href="https://link.zhihu.com/?target=http%3A//www.example.cn/" target="_blank" rel="noreferrer">www.example.cn</a> )，解析到中国的CloudFront(例如访问<a href="https://link.zhihu.com/?target=http%3A//www.example.cn/" target="_blank" rel="noreferrer">www.example.cn</a> , CNAME解析到CloudFront提供的域名）；</p><p>请求回源到北京/宁夏 Region的NLB，流量负载均衡到EC2代理服务器，之后将请求转发到Global Region的资源。</p><p>转发的请求通过专线进⾏加速，提⾼访问速度和稳定性</p><p><strong>可用性：</strong></p><p>购买专线后，运营商会为⽤户提供两条DirectConnect连接路径，以避免由于单条线路故障造成的服务不可⽤，从⽽提⾼服务可⽤性</p><h3 id="方案二-direct-connect-专线-direct-connect-gateway" tabindex="-1">方案⼆：<strong>Direct Connect +</strong> 专线 <strong>+ Direct Connect Gateway</strong> <a class="header-anchor" href="#方案二-direct-connect-专线-direct-connect-gateway" aria-label="Permalink to &quot;方案⼆：**Direct Connect +** 专线 **+ Direct Connect Gateway**&quot;">​</a></h3><p><img src="https://nnaigos.oss-cn-hangzhou.aliyuncs.com/imgs/202312011519953.jpg" alt=""></p><p><strong>架构搭建：</strong></p><ol><li>购买中国域名（如<a href="https://link.zhihu.com/?target=http%3A//example.cn" target="_blank" rel="noreferrer">http://example.cn</a>）并做ICP备案；</li><li>在北京/宁夏 Region部署EC2代理集群，将请求转发到Global Region的NLB；</li><li>购买运营商（常⽤合作伙伴：中国移动，中国联通，中国电信）专线，建⽴北京/宁夏 Region到⾹港POP点的DirectConnect连接；</li><li>创建Direct Connect Gateway，将其他region的VPC连接到DirectConnectGateway。</li></ol><p><strong>数据流：</strong></p><ol><li>中国⽤户访问中国域名（如<a href="https://link.zhihu.com/?target=http%3A//www.example.cn/" target="_blank" rel="noreferrer">www.example.cn</a> )，解析到中国的CloudFront(例如访问<a href="https://link.zhihu.com/?target=http%3A//www.example.cn/" target="_blank" rel="noreferrer">www.example.cn</a> , CNAME解析到CloudFront提供的域名）；</li><li>请求回源到北京/宁夏 Region的NLB，流量负载均衡到EC2代理服务器，之后将请求转发到Global Region的资源。</li><li>请求从北京/宁夏 Region到⾹港POP点通过专线进⾏加速，从⾹港POP点到Global Region通过AWS⻣⼲⽹实现加速。</li></ol><p><strong>可用性：</strong></p><ol><li>购买专线后，运营商会为⽤户提供两条DirectConnect连接路径，以避免由于单条线路故障造成的服务不可⽤，从⽽提⾼服务可⽤性。</li><li>由于Direct Connect Gateway是由虚拟专⽤⽹关（VGW）和私有虚拟接⼝（VIF）组成的，只能连接到VPC内的资源，所以Direct Connect Gateway的加速⽅案不能⽤于Global区的S3，需要通过同⼀Region的EC2代理做中转来访问S3</li></ol><h3 id="方案三-国内cdn" tabindex="-1">⽅案三：国内CDN <a class="header-anchor" href="#方案三-国内cdn" aria-label="Permalink to &quot;⽅案三：国内CDN&quot;">​</a></h3><p><img src="https://nnaigos.oss-cn-hangzhou.aliyuncs.com/imgs/202312011519402.png" alt=""></p><p><strong>架构搭建：</strong></p><ol><li>购买中国域名（如<a href="https://link.zhihu.com/?target=http%3A//example.cn/" target="_blank" rel="noreferrer">example.cn</a> )，并做ICP备案</li><li>购买国内CDN服务CloudFront，将备过案的⼀个⼦域名（如<a href="https://link.zhihu.com/?target=http%3A//china.example.cn" target="_blank" rel="noreferrer">http://china.example.cn</a>）指向CloudFront（因为CloudFront的域名不能直接拿来备案）；</li></ol><p>3:将备过案的另⼀个⼦域名（如<a href="https://link.zhihu.com/?target=http%3A//source.example.cn" target="_blank" rel="noreferrer">http://source.example.cn</a>）作为CloudFront的源（因为规定CDN的源也必须备过案）；</p><p>4:将上述CloudFront的源（也就是域名<a href="https://link.zhihu.com/?target=http%3A//source.example.cn" target="_blank" rel="noreferrer">http://source.example.cn</a>）指向海外的应⽤服务器。</p><p><strong>数据流：</strong></p><ol><li>中国⽤户访问中国域名（如<a href="https://link.zhihu.com/?target=http%3A//china.example.cn/" target="_blank" rel="noreferrer">china.example.cn</a> )，解析到国内CloudFront；</li><li>国内CloudFront将流量解析到源，也就是备案过的第⼆个⼦域名（<a href="https://link.zhihu.com/?target=http%3A//source.example.cn" target="_blank" rel="noreferrer">http://source.example.cn</a>）；</li><li>备过案的第⼆个⼦域名将流量解析到海外应⽤的服务器；</li><li>国内CloudFront通过⾃⼰的定期探测机制决定针对特定⽤户区域延迟最低的POP点。</li></ol><p><strong>可用性：</strong></p><p>CloudFront服务本身是⾼可⽤的</p><h2 id="客户需求三-应用部署在aws-china-加速国外用户的访问" tabindex="-1">客户需求三：应⽤部署在AWS China，加速国外⽤户的访问 <a class="header-anchor" href="#客户需求三-应用部署在aws-china-加速国外用户的访问" aria-label="Permalink to &quot;客户需求三：应⽤部署在AWS China，加速国外⽤户的访问&quot;">​</a></h2><h3 id="方案-海外cdn" tabindex="-1"><strong>方案：海外CDN</strong> <a class="header-anchor" href="#方案-海外cdn" aria-label="Permalink to &quot;**方案：海外CDN**&quot;">​</a></h3><p><img src="https://nnaigos.oss-cn-hangzhou.aliyuncs.com/imgs/202312011519136.png" alt=""></p><p><strong>架构搭建：</strong></p><ol><li>购买海外CDN服务CloudFront，包含对国外⽤户的访问加速。</li><li>在Global Region的Route 53上设置域名解析到海外部署的CDN分发域名。</li></ol><p><strong>数据流：</strong></p><ol><li>国外⽤户访问中国域名(如<a href="https://link.zhihu.com/?target=http%3A//www.example.com/" target="_blank" rel="noreferrer">www.example.com</a> )，经Route 53解析到海外CDN；</li><li>CDN⼚商通过⾃⼰的定期探测机制决定针对特定⽤户区域延迟最低的POP点，并将POP点IP返回给该区域的⽤户。</li><li>CDN⼚商提供优化不同区域⽤户访问延迟的能⼒。（提供类似优化能⼒的CDN合作伙伴有⽹宿、知道创宇等）</li></ol><p><strong>可用性：</strong></p><ol><li>若⽤户使⽤CloudFront服务，CloudFront服务本身是⾼可⽤的</li></ol><h2 id="方案总结" tabindex="-1">方案总结 <a class="header-anchor" href="#方案总结" aria-label="Permalink to &quot;方案总结&quot;">​</a></h2><p><strong>对外业务，在中国需要备案：</strong></p><p>Direct Connect⽅案：专线直连，成本最⾼，加速效果最好，稳定性最好</p><p>Direct Connect Gateway⽅案：运营商提供成熟的专线接⼊⾹港POP⽅案，相对节约成本，建设周期短</p><p><strong>对外业务，在中国不需要备案：</strong></p><p>CN2 IP：由中国电信提供，做运营商级优化，⽆需备案，加速效果好，稳定性好</p><p>海外CDN：使⽤CloudFront海外节点或海外CDN Partner，解析请求到延迟最低的CDN节点</p>',80),l=[r];function i(p,c,s,h,g,u){return e(),o("div",null,l)}const m=t(a,[["render",i]]);export{d as __pageData,m as default};
