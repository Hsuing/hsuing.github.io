import{_ as s,o as n,c as a,R as l}from"./chunks/framework.zUbWieqp.js";const C=JSON.parse('{"title":"1. storageclass策略","description":"","frontmatter":{},"headers":[],"relativePath":"guide/container/k8s/存储/nfs/3-nfs-dynamic.md","filePath":"guide/container/k8s/存储/nfs/3-nfs-dynamic.md","lastUpdated":1720533756000}'),p={name:"guide/container/k8s/存储/nfs/3-nfs-dynamic.md"},o=l(`<p>PV的全称是: PersistentVolume (持久化卷)，是对底层的共享存储的一种抽象，PV由管理员进行创建和配置，它和具体的底层的共享存储技术的实现方式有关，比如Ceph、GlusterFS、NFS等，都是通过插件机制完成与共享存储的对接.</p><p>PVC的全称是: PersistenVolumeClaim (持久化卷声明)，PVC是用户存储的一种声明，PVC和Pod比较类型，Pod是消耗节点，PVC消耗的是PV资源，Pod可以请求CPU的内存，而PVC可以请求特定的存储空间和访问模式。对于真正存储的用户不需要关心底层的存储实现细节，只需要直接使用PVC即可.</p><p>但是通过PVC请求一定的存储空间也很有可能不足以满足对于存储设备的各种需求，而且不同的应用程序对于存储性能的要求也能也不尽相同，比如读写速度、并发性能等，为了解决这一问题，Kubernetes又为我们引入了一个新的资源对象: StorageClass,通过StorageClass的定义，管理员可以将存储资源定义为某种类型的资源，比如快速存储、慢速存储等，用户根据StorageClass的描述就可以非常直观的知道各种存储资源特性了，这样就可以根据应用的特性去申请合适的存储资源了.</p><p>创建storeageclass流程</p><p><img src="https://nnaigos.oss-cn-hangzhou.aliyuncs.com/imgs/202406041745085.png" alt="image-20240604174459864"></p><p>(1）集群管理员预先创建存储类（StorageClass）</p><p>（2）用户创建使用存储类的持久化存储声明(PVC：PersistentVolumeClaim)</p><p>（3）存储持久化声明通知系统，它需要一个持久化存储(PV: PersistentVolume)</p><p>（4）系统读取存储类的信息</p><p>（5）系统基于存储类的信息，在后台自动创建PVC需要的PV</p><h1 id="_1-storageclass策略" tabindex="-1">1. storageclass策略 <a class="header-anchor" href="#_1-storageclass策略" aria-label="Permalink to &quot;1. storageclass策略&quot;">​</a></h1><p>文档,<a href="https://kubernetes.io/docs/concepts/storage/storage-classes/" target="_blank" rel="noreferrer">https://kubernetes.io/docs/concepts/storage/storage-classes/</a></p><ul><li>provisioner: 该字段指定使用存储卷类型，不同的存储卷提供者类型这里要修改成对应的值</li><li>reclaimPolicy：有两种策略：Delete、Retain。默认是Delet</li><li>用户删除PVC释放对PV的占用后，系统根据PV的”reclaim policy”决定对PV执行何种回收操作。 目前，”reclaim policy”有三种方式：Retained、Recycled、Deleted</li></ul><h2 id="retained" tabindex="-1">Retained <a class="header-anchor" href="#retained" aria-label="Permalink to &quot;Retained&quot;">​</a></h2><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#9ECBFF;">保护被PVC释放的PV及其上数据，并将PV状态改成&quot;released&quot;，不将被其它PVC绑定。集群管理员手动通过如下步骤释放存储资源</span></span>
<span class="line"><span style="color:#9ECBFF;">手动删除PV，但与其相关的后端存储资源如(AWS EBS, GCE PD, Azure Disk, or Cinder volume)仍然存在。</span></span>
<span class="line"><span style="color:#9ECBFF;">手动清空后端存储volume上的数据。</span></span>
<span class="line"><span style="color:#9ECBFF;">手动删除后端存储volume，或者重复使用后端volume，为其创建新的PV</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#032F62;">保护被PVC释放的PV及其上数据，并将PV状态改成&quot;released&quot;，不将被其它PVC绑定。集群管理员手动通过如下步骤释放存储资源</span></span>
<span class="line"><span style="color:#032F62;">手动删除PV，但与其相关的后端存储资源如(AWS EBS, GCE PD, Azure Disk, or Cinder volume)仍然存在。</span></span>
<span class="line"><span style="color:#032F62;">手动清空后端存储volume上的数据。</span></span>
<span class="line"><span style="color:#032F62;">手动删除后端存储volume，或者重复使用后端volume，为其创建新的PV</span></span></code></pre></div><h2 id="delete" tabindex="-1">Delete <a class="header-anchor" href="#delete" aria-label="Permalink to &quot;Delete&quot;">​</a></h2><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">删除被PVC释放的PV及其后端存储volume。对于动态PV其</span><span style="color:#B392F0;">&quot;reclaim policy&quot;</span><span style="color:#B392F0;">继承自其</span><span style="color:#B392F0;">&quot;storage class&quot;</span><span style="color:#B392F0;">，</span></span>
<span class="line"><span style="color:#B392F0;">默认是Delete。集群管理员负责将</span><span style="color:#B392F0;">&quot;storage class&quot;</span><span style="color:#B392F0;">的</span><span style="color:#B392F0;">&quot;reclaim policy&quot;</span><span style="color:#B392F0;">设置成用户期望的形式，否则需要用</span></span>
<span class="line"><span style="color:#B392F0;">户手动为创建后的动态PV编辑</span><span style="color:#B392F0;">&quot;reclaim policy&quot;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">删除被PVC释放的PV及其后端存储volume。对于动态PV其</span><span style="color:#6F42C1;">&quot;reclaim policy&quot;</span><span style="color:#6F42C1;">继承自其</span><span style="color:#6F42C1;">&quot;storage class&quot;</span><span style="color:#6F42C1;">，</span></span>
<span class="line"><span style="color:#6F42C1;">默认是Delete。集群管理员负责将</span><span style="color:#6F42C1;">&quot;storage class&quot;</span><span style="color:#6F42C1;">的</span><span style="color:#6F42C1;">&quot;reclaim policy&quot;</span><span style="color:#6F42C1;">设置成用户期望的形式，否则需要用</span></span>
<span class="line"><span style="color:#6F42C1;">户手动为创建后的动态PV编辑</span><span style="color:#6F42C1;">&quot;reclaim policy&quot;</span></span></code></pre></div><h2 id="recycle-废弃" tabindex="-1">Recycle 废弃 <a class="header-anchor" href="#recycle-废弃" aria-label="Permalink to &quot;Recycle 废弃&quot;">​</a></h2><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">删除被PVC释放的PV及其后端存储volume。对于动态PV其</span><span style="color:#B392F0;">&quot;reclaim policy&quot;</span><span style="color:#B392F0;">继承自其</span><span style="color:#B392F0;">&quot;storage class&quot;</span><span style="color:#B392F0;">，</span></span>
<span class="line"><span style="color:#B392F0;">默认是Delete。集群管理员负责将</span><span style="color:#B392F0;">&quot;storage class&quot;</span><span style="color:#B392F0;">的</span><span style="color:#B392F0;">&quot;reclaim policy&quot;</span><span style="color:#B392F0;">设置成用户期望的形式，否则需要用</span></span>
<span class="line"><span style="color:#B392F0;">户手动为创建后的动态PV编辑</span><span style="color:#B392F0;">&quot;reclaim policy&quot;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">删除被PVC释放的PV及其后端存储volume。对于动态PV其</span><span style="color:#6F42C1;">&quot;reclaim policy&quot;</span><span style="color:#6F42C1;">继承自其</span><span style="color:#6F42C1;">&quot;storage class&quot;</span><span style="color:#6F42C1;">，</span></span>
<span class="line"><span style="color:#6F42C1;">默认是Delete。集群管理员负责将</span><span style="color:#6F42C1;">&quot;storage class&quot;</span><span style="color:#6F42C1;">的</span><span style="color:#6F42C1;">&quot;reclaim policy&quot;</span><span style="color:#6F42C1;">设置成用户期望的形式，否则需要用</span></span>
<span class="line"><span style="color:#6F42C1;">户手动为创建后的动态PV编辑</span><span style="color:#6F42C1;">&quot;reclaim policy&quot;</span></span></code></pre></div><h1 id="_2-创建yaml文件" tabindex="-1">2. 创建yaml文件 <a class="header-anchor" href="#_2-创建yaml文件" aria-label="Permalink to &quot;2. 创建yaml文件&quot;">​</a></h1><p>这个插件之维护到2020年</p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#9ECBFF;">cat 7.storageclass.yaml</span></span>
<span class="line"><span style="color:#6A737D;">#设置ServiceAccount</span></span>
<span class="line"><span style="color:#85E89D;">apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">v1</span></span>
<span class="line"><span style="color:#85E89D;">kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">ServiceAccount</span></span>
<span class="line"><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">nfs-client-provisioner</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;"># replace with namespace where provisioner is deployed</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">namespace</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">default</span><span style="color:#E1E4E8;">        </span><span style="color:#6A737D;">#根据实际环境设定namespace,下面类同</span></span>
<span class="line"><span style="color:#B392F0;">---</span></span>
<span class="line"><span style="color:#85E89D;">kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">ClusterRole</span></span>
<span class="line"><span style="color:#85E89D;">apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">rbac.authorization.k8s.io/v1</span></span>
<span class="line"><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">nfs-client-provisioner-runner</span></span>
<span class="line"><span style="color:#85E89D;">rules</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  - </span><span style="color:#85E89D;">apiGroups</span><span style="color:#E1E4E8;">: [</span><span style="color:#9ECBFF;">&quot;&quot;</span><span style="color:#E1E4E8;">]</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">resources</span><span style="color:#E1E4E8;">: [</span><span style="color:#9ECBFF;">&quot;persistentvolumes&quot;</span><span style="color:#E1E4E8;">]</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">verbs</span><span style="color:#E1E4E8;">: [</span><span style="color:#9ECBFF;">&quot;get&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&quot;list&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&quot;watch&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&quot;create&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&quot;delete&quot;</span><span style="color:#E1E4E8;">]</span></span>
<span class="line"><span style="color:#E1E4E8;">  - </span><span style="color:#85E89D;">apiGroups</span><span style="color:#E1E4E8;">: [</span><span style="color:#9ECBFF;">&quot;&quot;</span><span style="color:#E1E4E8;">]</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">resources</span><span style="color:#E1E4E8;">: [</span><span style="color:#9ECBFF;">&quot;persistentvolumeclaims&quot;</span><span style="color:#E1E4E8;">]</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">verbs</span><span style="color:#E1E4E8;">: [</span><span style="color:#9ECBFF;">&quot;get&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&quot;list&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&quot;watch&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&quot;update&quot;</span><span style="color:#E1E4E8;">]</span></span>
<span class="line"><span style="color:#E1E4E8;">  - </span><span style="color:#85E89D;">apiGroups</span><span style="color:#E1E4E8;">: [</span><span style="color:#9ECBFF;">&quot;storage.k8s.io&quot;</span><span style="color:#E1E4E8;">]</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">resources</span><span style="color:#E1E4E8;">: [</span><span style="color:#9ECBFF;">&quot;storageclasses&quot;</span><span style="color:#E1E4E8;">]</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">verbs</span><span style="color:#E1E4E8;">: [</span><span style="color:#9ECBFF;">&quot;get&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&quot;list&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&quot;watch&quot;</span><span style="color:#E1E4E8;">]</span></span>
<span class="line"><span style="color:#E1E4E8;">  - </span><span style="color:#85E89D;">apiGroups</span><span style="color:#E1E4E8;">: [</span><span style="color:#9ECBFF;">&quot;&quot;</span><span style="color:#E1E4E8;">]</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">resources</span><span style="color:#E1E4E8;">: [</span><span style="color:#9ECBFF;">&quot;events&quot;</span><span style="color:#E1E4E8;">]</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">verbs</span><span style="color:#E1E4E8;">: [</span><span style="color:#9ECBFF;">&quot;create&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&quot;update&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&quot;patch&quot;</span><span style="color:#E1E4E8;">]</span></span>
<span class="line"><span style="color:#B392F0;">---</span></span>
<span class="line"><span style="color:#85E89D;">kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">ClusterRoleBinding</span></span>
<span class="line"><span style="color:#85E89D;">apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">rbac.authorization.k8s.io/v1</span></span>
<span class="line"><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">run-nfs-client-provisioner</span></span>
<span class="line"><span style="color:#85E89D;">subjects</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  - </span><span style="color:#85E89D;">kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">ServiceAccount</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">nfs-client-provisioner</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;"># replace with namespace where provisioner is deployed</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">namespace</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">default</span></span>
<span class="line"><span style="color:#85E89D;">roleRef</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">ClusterRole</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">nfs-client-provisioner-runner</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">apiGroup</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">rbac.authorization.k8s.io</span></span>
<span class="line"><span style="color:#B392F0;">---</span></span>
<span class="line"><span style="color:#85E89D;">kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Role</span></span>
<span class="line"><span style="color:#85E89D;">apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">rbac.authorization.k8s.io/v1</span></span>
<span class="line"><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">leader-locking-nfs-client-provisioner</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;"># replace with namespace where provisioner is deployed</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">namespace</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">default</span></span>
<span class="line"><span style="color:#85E89D;">rules</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  - </span><span style="color:#85E89D;">apiGroups</span><span style="color:#E1E4E8;">: [</span><span style="color:#9ECBFF;">&quot;&quot;</span><span style="color:#E1E4E8;">]</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">resources</span><span style="color:#E1E4E8;">: [</span><span style="color:#9ECBFF;">&quot;endpoints&quot;</span><span style="color:#E1E4E8;">]</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">verbs</span><span style="color:#E1E4E8;">: [</span><span style="color:#9ECBFF;">&quot;get&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&quot;list&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&quot;watch&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&quot;create&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&quot;update&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&quot;patch&quot;</span><span style="color:#E1E4E8;">]</span></span>
<span class="line"><span style="color:#B392F0;">---</span></span>
<span class="line"><span style="color:#85E89D;">kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">RoleBinding</span></span>
<span class="line"><span style="color:#85E89D;">apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">rbac.authorization.k8s.io/v1</span></span>
<span class="line"><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">leader-locking-nfs-client-provisioner</span></span>
<span class="line"><span style="color:#85E89D;">subjects</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  - </span><span style="color:#85E89D;">kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">ServiceAccount</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">nfs-client-provisioner</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;"># replace with namespace where provisioner is deployed</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">namespace</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">default</span></span>
<span class="line"><span style="color:#85E89D;">roleRef</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Role</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">leader-locking-nfs-client-provisioner</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">apiGroup</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">rbac.authorization.k8s.io</span></span>
<span class="line"><span style="color:#B392F0;">---</span></span>
<span class="line"><span style="color:#6A737D;">#配置StorageClass</span></span>
<span class="line"><span style="color:#85E89D;">apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">storage.k8s.io/v1</span></span>
<span class="line"><span style="color:#85E89D;">kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">StorageClass</span></span>
<span class="line"><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">alma-nfs-sc</span></span>
<span class="line"><span style="color:#85E89D;">provisioner</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">alma-nfs</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;">#这里的名称要和provisioner配置中的环境变量PROVISIONER_NAME保持一致</span></span>
<span class="line"><span style="color:#85E89D;">parameters</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">archiveOnDelete</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;false&quot;</span></span>
<span class="line"><span style="color:#B392F0;">---</span></span>
<span class="line"><span style="color:#6A737D;">#配置provisioner</span></span>
<span class="line"><span style="color:#85E89D;">apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">apps/v1</span></span>
<span class="line"><span style="color:#85E89D;">kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Deployment</span></span>
<span class="line"><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">nfs-client-provisioner</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">labels</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">app</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">nfs-client-provisioner</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;"># replace with namespace where provisioner is deployed</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">namespace</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">default</span><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;">#与RBAC中的namespace保持一致</span></span>
<span class="line"><span style="color:#85E89D;">spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">replicas</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">1</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">selector</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">matchLabels</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">app</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">nfs-client-provisioner</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">strategy</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">type</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Recreate</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">template</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">labels</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">app</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">nfs-client-provisioner</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">serviceAccountName</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">nfs-client-provisioner</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">containers</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">        - </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">nfs-client-provisioner</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#85E89D;">image</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">registry.cn-zhangjiakou.aliyuncs.com/hsuing/nfs-client-provisioner:3.1.0</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#85E89D;">volumeMounts</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">            - </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">nfs-client-root</span></span>
<span class="line"><span style="color:#E1E4E8;">              </span><span style="color:#85E89D;">mountPath</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">/persistentvolumes</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#85E89D;">env</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">            - </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">PROVISIONER_NAME</span></span>
<span class="line"><span style="color:#E1E4E8;">              </span><span style="color:#85E89D;">value</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">alma-nfs</span><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;">#provisioner名称,请确保该名称与 nfs-StorageClass配置中的provisioner名称保持一致</span></span>
<span class="line"><span style="color:#E1E4E8;">            - </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">NFS_SERVER</span></span>
<span class="line"><span style="color:#E1E4E8;">              </span><span style="color:#85E89D;">value</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">10.103.236.199</span><span style="color:#E1E4E8;">   </span><span style="color:#6A737D;">#NFS Server IP地址</span></span>
<span class="line"><span style="color:#E1E4E8;">            - </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">NFS_PATH</span></span>
<span class="line"><span style="color:#E1E4E8;">              </span><span style="color:#85E89D;">value</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">/data/nfs/pv01</span><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">#NFS挂载卷</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">volumes</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">        - </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">nfs-client-root</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#85E89D;">nfs</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#85E89D;">server</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">10.103.236.199</span><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;">#NFS Server IP地址</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#85E89D;">path</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">/data/nfs/pv01</span><span style="color:#E1E4E8;">     </span><span style="color:#6A737D;">#NFS 挂载卷</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#032F62;">cat 7.storageclass.yaml</span></span>
<span class="line"><span style="color:#6A737D;">#设置ServiceAccount</span></span>
<span class="line"><span style="color:#22863A;">apiVersion</span><span style="color:#24292E;">: </span><span style="color:#032F62;">v1</span></span>
<span class="line"><span style="color:#22863A;">kind</span><span style="color:#24292E;">: </span><span style="color:#032F62;">ServiceAccount</span></span>
<span class="line"><span style="color:#22863A;">metadata</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">nfs-client-provisioner</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6A737D;"># replace with namespace where provisioner is deployed</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">namespace</span><span style="color:#24292E;">: </span><span style="color:#032F62;">default</span><span style="color:#24292E;">        </span><span style="color:#6A737D;">#根据实际环境设定namespace,下面类同</span></span>
<span class="line"><span style="color:#6F42C1;">---</span></span>
<span class="line"><span style="color:#22863A;">kind</span><span style="color:#24292E;">: </span><span style="color:#032F62;">ClusterRole</span></span>
<span class="line"><span style="color:#22863A;">apiVersion</span><span style="color:#24292E;">: </span><span style="color:#032F62;">rbac.authorization.k8s.io/v1</span></span>
<span class="line"><span style="color:#22863A;">metadata</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">nfs-client-provisioner-runner</span></span>
<span class="line"><span style="color:#22863A;">rules</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  - </span><span style="color:#22863A;">apiGroups</span><span style="color:#24292E;">: [</span><span style="color:#032F62;">&quot;&quot;</span><span style="color:#24292E;">]</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">resources</span><span style="color:#24292E;">: [</span><span style="color:#032F62;">&quot;persistentvolumes&quot;</span><span style="color:#24292E;">]</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">verbs</span><span style="color:#24292E;">: [</span><span style="color:#032F62;">&quot;get&quot;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;list&quot;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;watch&quot;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;create&quot;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;delete&quot;</span><span style="color:#24292E;">]</span></span>
<span class="line"><span style="color:#24292E;">  - </span><span style="color:#22863A;">apiGroups</span><span style="color:#24292E;">: [</span><span style="color:#032F62;">&quot;&quot;</span><span style="color:#24292E;">]</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">resources</span><span style="color:#24292E;">: [</span><span style="color:#032F62;">&quot;persistentvolumeclaims&quot;</span><span style="color:#24292E;">]</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">verbs</span><span style="color:#24292E;">: [</span><span style="color:#032F62;">&quot;get&quot;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;list&quot;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;watch&quot;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;update&quot;</span><span style="color:#24292E;">]</span></span>
<span class="line"><span style="color:#24292E;">  - </span><span style="color:#22863A;">apiGroups</span><span style="color:#24292E;">: [</span><span style="color:#032F62;">&quot;storage.k8s.io&quot;</span><span style="color:#24292E;">]</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">resources</span><span style="color:#24292E;">: [</span><span style="color:#032F62;">&quot;storageclasses&quot;</span><span style="color:#24292E;">]</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">verbs</span><span style="color:#24292E;">: [</span><span style="color:#032F62;">&quot;get&quot;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;list&quot;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;watch&quot;</span><span style="color:#24292E;">]</span></span>
<span class="line"><span style="color:#24292E;">  - </span><span style="color:#22863A;">apiGroups</span><span style="color:#24292E;">: [</span><span style="color:#032F62;">&quot;&quot;</span><span style="color:#24292E;">]</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">resources</span><span style="color:#24292E;">: [</span><span style="color:#032F62;">&quot;events&quot;</span><span style="color:#24292E;">]</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">verbs</span><span style="color:#24292E;">: [</span><span style="color:#032F62;">&quot;create&quot;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;update&quot;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;patch&quot;</span><span style="color:#24292E;">]</span></span>
<span class="line"><span style="color:#6F42C1;">---</span></span>
<span class="line"><span style="color:#22863A;">kind</span><span style="color:#24292E;">: </span><span style="color:#032F62;">ClusterRoleBinding</span></span>
<span class="line"><span style="color:#22863A;">apiVersion</span><span style="color:#24292E;">: </span><span style="color:#032F62;">rbac.authorization.k8s.io/v1</span></span>
<span class="line"><span style="color:#22863A;">metadata</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">run-nfs-client-provisioner</span></span>
<span class="line"><span style="color:#22863A;">subjects</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  - </span><span style="color:#22863A;">kind</span><span style="color:#24292E;">: </span><span style="color:#032F62;">ServiceAccount</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">nfs-client-provisioner</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;"># replace with namespace where provisioner is deployed</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">namespace</span><span style="color:#24292E;">: </span><span style="color:#032F62;">default</span></span>
<span class="line"><span style="color:#22863A;">roleRef</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">kind</span><span style="color:#24292E;">: </span><span style="color:#032F62;">ClusterRole</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">nfs-client-provisioner-runner</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">apiGroup</span><span style="color:#24292E;">: </span><span style="color:#032F62;">rbac.authorization.k8s.io</span></span>
<span class="line"><span style="color:#6F42C1;">---</span></span>
<span class="line"><span style="color:#22863A;">kind</span><span style="color:#24292E;">: </span><span style="color:#032F62;">Role</span></span>
<span class="line"><span style="color:#22863A;">apiVersion</span><span style="color:#24292E;">: </span><span style="color:#032F62;">rbac.authorization.k8s.io/v1</span></span>
<span class="line"><span style="color:#22863A;">metadata</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">leader-locking-nfs-client-provisioner</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;"># replace with namespace where provisioner is deployed</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">namespace</span><span style="color:#24292E;">: </span><span style="color:#032F62;">default</span></span>
<span class="line"><span style="color:#22863A;">rules</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  - </span><span style="color:#22863A;">apiGroups</span><span style="color:#24292E;">: [</span><span style="color:#032F62;">&quot;&quot;</span><span style="color:#24292E;">]</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">resources</span><span style="color:#24292E;">: [</span><span style="color:#032F62;">&quot;endpoints&quot;</span><span style="color:#24292E;">]</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">verbs</span><span style="color:#24292E;">: [</span><span style="color:#032F62;">&quot;get&quot;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;list&quot;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;watch&quot;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;create&quot;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;update&quot;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;patch&quot;</span><span style="color:#24292E;">]</span></span>
<span class="line"><span style="color:#6F42C1;">---</span></span>
<span class="line"><span style="color:#22863A;">kind</span><span style="color:#24292E;">: </span><span style="color:#032F62;">RoleBinding</span></span>
<span class="line"><span style="color:#22863A;">apiVersion</span><span style="color:#24292E;">: </span><span style="color:#032F62;">rbac.authorization.k8s.io/v1</span></span>
<span class="line"><span style="color:#22863A;">metadata</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">leader-locking-nfs-client-provisioner</span></span>
<span class="line"><span style="color:#22863A;">subjects</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  - </span><span style="color:#22863A;">kind</span><span style="color:#24292E;">: </span><span style="color:#032F62;">ServiceAccount</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">nfs-client-provisioner</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;"># replace with namespace where provisioner is deployed</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">namespace</span><span style="color:#24292E;">: </span><span style="color:#032F62;">default</span></span>
<span class="line"><span style="color:#22863A;">roleRef</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">kind</span><span style="color:#24292E;">: </span><span style="color:#032F62;">Role</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">leader-locking-nfs-client-provisioner</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">apiGroup</span><span style="color:#24292E;">: </span><span style="color:#032F62;">rbac.authorization.k8s.io</span></span>
<span class="line"><span style="color:#6F42C1;">---</span></span>
<span class="line"><span style="color:#6A737D;">#配置StorageClass</span></span>
<span class="line"><span style="color:#22863A;">apiVersion</span><span style="color:#24292E;">: </span><span style="color:#032F62;">storage.k8s.io/v1</span></span>
<span class="line"><span style="color:#22863A;">kind</span><span style="color:#24292E;">: </span><span style="color:#032F62;">StorageClass</span></span>
<span class="line"><span style="color:#22863A;">metadata</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">alma-nfs-sc</span></span>
<span class="line"><span style="color:#22863A;">provisioner</span><span style="color:#24292E;">: </span><span style="color:#032F62;">alma-nfs</span><span style="color:#24292E;"> </span><span style="color:#6A737D;">#这里的名称要和provisioner配置中的环境变量PROVISIONER_NAME保持一致</span></span>
<span class="line"><span style="color:#22863A;">parameters</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">archiveOnDelete</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;false&quot;</span></span>
<span class="line"><span style="color:#6F42C1;">---</span></span>
<span class="line"><span style="color:#6A737D;">#配置provisioner</span></span>
<span class="line"><span style="color:#22863A;">apiVersion</span><span style="color:#24292E;">: </span><span style="color:#032F62;">apps/v1</span></span>
<span class="line"><span style="color:#22863A;">kind</span><span style="color:#24292E;">: </span><span style="color:#032F62;">Deployment</span></span>
<span class="line"><span style="color:#22863A;">metadata</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">nfs-client-provisioner</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">labels</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">app</span><span style="color:#24292E;">: </span><span style="color:#032F62;">nfs-client-provisioner</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6A737D;"># replace with namespace where provisioner is deployed</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">namespace</span><span style="color:#24292E;">: </span><span style="color:#032F62;">default</span><span style="color:#24292E;">  </span><span style="color:#6A737D;">#与RBAC中的namespace保持一致</span></span>
<span class="line"><span style="color:#22863A;">spec</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">replicas</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">1</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">selector</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">matchLabels</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">app</span><span style="color:#24292E;">: </span><span style="color:#032F62;">nfs-client-provisioner</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">strategy</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">type</span><span style="color:#24292E;">: </span><span style="color:#032F62;">Recreate</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">template</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">metadata</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">labels</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">app</span><span style="color:#24292E;">: </span><span style="color:#032F62;">nfs-client-provisioner</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">spec</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">serviceAccountName</span><span style="color:#24292E;">: </span><span style="color:#032F62;">nfs-client-provisioner</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">containers</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">        - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">nfs-client-provisioner</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#22863A;">image</span><span style="color:#24292E;">: </span><span style="color:#032F62;">registry.cn-zhangjiakou.aliyuncs.com/hsuing/nfs-client-provisioner:3.1.0</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#22863A;">volumeMounts</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">            - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">nfs-client-root</span></span>
<span class="line"><span style="color:#24292E;">              </span><span style="color:#22863A;">mountPath</span><span style="color:#24292E;">: </span><span style="color:#032F62;">/persistentvolumes</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#22863A;">env</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">            - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">PROVISIONER_NAME</span></span>
<span class="line"><span style="color:#24292E;">              </span><span style="color:#22863A;">value</span><span style="color:#24292E;">: </span><span style="color:#032F62;">alma-nfs</span><span style="color:#24292E;">  </span><span style="color:#6A737D;">#provisioner名称,请确保该名称与 nfs-StorageClass配置中的provisioner名称保持一致</span></span>
<span class="line"><span style="color:#24292E;">            - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">NFS_SERVER</span></span>
<span class="line"><span style="color:#24292E;">              </span><span style="color:#22863A;">value</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">10.103.236.199</span><span style="color:#24292E;">   </span><span style="color:#6A737D;">#NFS Server IP地址</span></span>
<span class="line"><span style="color:#24292E;">            - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">NFS_PATH</span></span>
<span class="line"><span style="color:#24292E;">              </span><span style="color:#22863A;">value</span><span style="color:#24292E;">: </span><span style="color:#032F62;">/data/nfs/pv01</span><span style="color:#24292E;">    </span><span style="color:#6A737D;">#NFS挂载卷</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">volumes</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">        - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">nfs-client-root</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#22863A;">nfs</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#22863A;">server</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">10.103.236.199</span><span style="color:#24292E;">  </span><span style="color:#6A737D;">#NFS Server IP地址</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#22863A;">path</span><span style="color:#24292E;">: </span><span style="color:#032F62;">/data/nfs/pv01</span><span style="color:#24292E;">     </span><span style="color:#6A737D;">#NFS 挂载卷</span></span></code></pre></div><h2 id="_2-1-执行apply" tabindex="-1">2.1 执行apply <a class="header-anchor" href="#_2-1-执行apply" aria-label="Permalink to &quot;2.1 执行apply&quot;">​</a></h2><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">[root@kube-master nfs]# kubectl apply -f 7.storageclass.yaml</span></span>
<span class="line"><span style="color:#B392F0;">serviceaccount/nfs-client-provisioner</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">created</span></span>
<span class="line"><span style="color:#B392F0;">clusterrole.rbac.authorization.k8s.io/nfs-client-provisioner-runner</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">created</span></span>
<span class="line"><span style="color:#B392F0;">clusterrolebinding.rbac.authorization.k8s.io/run-nfs-client-provisioner</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">created</span></span>
<span class="line"><span style="color:#B392F0;">role.rbac.authorization.k8s.io/leader-locking-nfs-client-provisioner</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">created</span></span>
<span class="line"><span style="color:#B392F0;">rolebinding.rbac.authorization.k8s.io/leader-locking-nfs-client-provisioner</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">created</span></span>
<span class="line"><span style="color:#B392F0;">storageclass.storage.k8s.io/alma-nfs-sc</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">created</span></span>
<span class="line"><span style="color:#B392F0;">deployment.apps/nfs-client-provisioner</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">created</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">[root@kube-master nfs]# kubectl apply -f 7.storageclass.yaml</span></span>
<span class="line"><span style="color:#6F42C1;">serviceaccount/nfs-client-provisioner</span><span style="color:#24292E;"> </span><span style="color:#032F62;">created</span></span>
<span class="line"><span style="color:#6F42C1;">clusterrole.rbac.authorization.k8s.io/nfs-client-provisioner-runner</span><span style="color:#24292E;"> </span><span style="color:#032F62;">created</span></span>
<span class="line"><span style="color:#6F42C1;">clusterrolebinding.rbac.authorization.k8s.io/run-nfs-client-provisioner</span><span style="color:#24292E;"> </span><span style="color:#032F62;">created</span></span>
<span class="line"><span style="color:#6F42C1;">role.rbac.authorization.k8s.io/leader-locking-nfs-client-provisioner</span><span style="color:#24292E;"> </span><span style="color:#032F62;">created</span></span>
<span class="line"><span style="color:#6F42C1;">rolebinding.rbac.authorization.k8s.io/leader-locking-nfs-client-provisioner</span><span style="color:#24292E;"> </span><span style="color:#032F62;">created</span></span>
<span class="line"><span style="color:#6F42C1;">storageclass.storage.k8s.io/alma-nfs-sc</span><span style="color:#24292E;"> </span><span style="color:#032F62;">created</span></span>
<span class="line"><span style="color:#6F42C1;">deployment.apps/nfs-client-provisioner</span><span style="color:#24292E;"> </span><span style="color:#032F62;">created</span></span></code></pre></div><ul><li>查看</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">[root@kube-master nfs]# kubectl get sc</span></span>
<span class="line"><span style="color:#B392F0;">NAME</span><span style="color:#E1E4E8;">          </span><span style="color:#9ECBFF;">PROVISIONER</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">RECLAIMPOLICY</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">VOLUMEBINDINGMODE</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">ALLOWVOLUMEEXPANSION</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">AGE</span></span>
<span class="line"><span style="color:#B392F0;">alma-nfs-sc</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">alma-nfs</span><span style="color:#E1E4E8;">      </span><span style="color:#9ECBFF;">Delete</span><span style="color:#E1E4E8;">          </span><span style="color:#9ECBFF;">Immediate</span><span style="color:#E1E4E8;">           </span><span style="color:#79B8FF;">false</span><span style="color:#E1E4E8;">                  </span><span style="color:#79B8FF;">4</span><span style="color:#9ECBFF;">m4s</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">[root@kube-master nfs]# kubectl get sc</span></span>
<span class="line"><span style="color:#6F42C1;">NAME</span><span style="color:#24292E;">          </span><span style="color:#032F62;">PROVISIONER</span><span style="color:#24292E;">   </span><span style="color:#032F62;">RECLAIMPOLICY</span><span style="color:#24292E;">   </span><span style="color:#032F62;">VOLUMEBINDINGMODE</span><span style="color:#24292E;">   </span><span style="color:#032F62;">ALLOWVOLUMEEXPANSION</span><span style="color:#24292E;">   </span><span style="color:#032F62;">AGE</span></span>
<span class="line"><span style="color:#6F42C1;">alma-nfs-sc</span><span style="color:#24292E;">   </span><span style="color:#032F62;">alma-nfs</span><span style="color:#24292E;">      </span><span style="color:#032F62;">Delete</span><span style="color:#24292E;">          </span><span style="color:#032F62;">Immediate</span><span style="color:#24292E;">           </span><span style="color:#005CC5;">false</span><span style="color:#24292E;">                  </span><span style="color:#005CC5;">4</span><span style="color:#032F62;">m4s</span></span></code></pre></div><h2 id="_2-2-测试storageclass" tabindex="-1">2.2 测试StorageClass <a class="header-anchor" href="#_2-2-测试storageclass" aria-label="Permalink to &quot;2.2 测试StorageClass&quot;">​</a></h2><ul><li>创建</li></ul><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">[</span><span style="color:#9ECBFF;">root@kube-master nfs</span><span style="color:#E1E4E8;">]# </span><span style="color:#9ECBFF;">cat 8.test-storageclass-pvc.yaml</span></span>
<span class="line"><span style="color:#85E89D;">apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">v1</span></span>
<span class="line"><span style="color:#85E89D;">kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">PersistentVolumeClaim</span></span>
<span class="line"><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">test-claim</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">annotations</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">volume.beta.kubernetes.io/storage-class</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;alma-nfs-sc&quot;</span><span style="color:#E1E4E8;">   </span><span style="color:#6A737D;">#与nfs-StorageClass的 metadata.name保持一致</span></span>
<span class="line"><span style="color:#85E89D;">spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">accessModes</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    - </span><span style="color:#9ECBFF;">ReadWriteMany</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">resources</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">requests</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">storage</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">1Mi</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">[</span><span style="color:#032F62;">root@kube-master nfs</span><span style="color:#24292E;">]# </span><span style="color:#032F62;">cat 8.test-storageclass-pvc.yaml</span></span>
<span class="line"><span style="color:#22863A;">apiVersion</span><span style="color:#24292E;">: </span><span style="color:#032F62;">v1</span></span>
<span class="line"><span style="color:#22863A;">kind</span><span style="color:#24292E;">: </span><span style="color:#032F62;">PersistentVolumeClaim</span></span>
<span class="line"><span style="color:#22863A;">metadata</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">test-claim</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">annotations</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">volume.beta.kubernetes.io/storage-class</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;alma-nfs-sc&quot;</span><span style="color:#24292E;">   </span><span style="color:#6A737D;">#与nfs-StorageClass的 metadata.name保持一致</span></span>
<span class="line"><span style="color:#22863A;">spec</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">accessModes</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    - </span><span style="color:#032F62;">ReadWriteMany</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">resources</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">requests</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">storage</span><span style="color:#24292E;">: </span><span style="color:#032F62;">1Mi</span></span></code></pre></div><ul><li>执行apply</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">apply</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-f</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">8</span><span style="color:#9ECBFF;">.test-storageclass-pvc.yaml</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">apply</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-f</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">8</span><span style="color:#032F62;">.test-storageclass-pvc.yaml</span></span></code></pre></div><ul><li>查看</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">get</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pvc</span></span>
<span class="line"><span style="color:#B392F0;">NAME</span><span style="color:#E1E4E8;">         </span><span style="color:#9ECBFF;">STATUS</span><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">VOLUME</span><span style="color:#E1E4E8;">     </span><span style="color:#9ECBFF;">CAPACITY</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">ACCESS</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">MODES</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">STORAGECLASS</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">AGE</span></span>
<span class="line"><span style="color:#79B8FF;">test</span><span style="color:#E1E4E8;">-claim   </span><span style="color:#9ECBFF;">Pending</span><span style="color:#E1E4E8;">                                        </span><span style="color:#9ECBFF;">alma-nfs-sc</span><span style="color:#E1E4E8;">    </span><span style="color:#79B8FF;">16</span><span style="color:#9ECBFF;">m</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#查看pod日志</span></span>
<span class="line"><span style="color:#E1E4E8;">[root@kube-master nfs]# kubetail nfs-client-provisioner-68759f5ccd-kbhjj</span></span>
<span class="line"><span style="color:#B392F0;">Will</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">tail</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">logs...</span></span>
<span class="line"><span style="color:#B392F0;">nfs-client-provisioner-68759f5ccd-kbhjj</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">[nfs-client-provisioner-68759f5ccd-kbhjj] I0604 07:56:10.862168       1 controller.go:987] provision </span><span style="color:#9ECBFF;">&quot;default/test-claim&quot;</span><span style="color:#E1E4E8;"> class </span><span style="color:#9ECBFF;">&quot;alma-nfs-sc&quot;</span><span style="color:#E1E4E8;">: started</span></span>
<span class="line"><span style="color:#E1E4E8;">[nfs-client-provisioner-68759f5ccd-kbhjj] E0604 07:56:10.874303       1 controller.go:1004] provision </span><span style="color:#9ECBFF;">&quot;default/test-claim&quot;</span><span style="color:#E1E4E8;"> class </span><span style="color:#9ECBFF;">&quot;alma-nfs-sc&quot;</span><span style="color:#E1E4E8;">: unexpected error getting claim reference: selfLink was empty, can</span><span style="color:#9ECBFF;">&#39;t make reference</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">get</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pvc</span></span>
<span class="line"><span style="color:#6F42C1;">NAME</span><span style="color:#24292E;">         </span><span style="color:#032F62;">STATUS</span><span style="color:#24292E;">    </span><span style="color:#032F62;">VOLUME</span><span style="color:#24292E;">     </span><span style="color:#032F62;">CAPACITY</span><span style="color:#24292E;">   </span><span style="color:#032F62;">ACCESS</span><span style="color:#24292E;"> </span><span style="color:#032F62;">MODES</span><span style="color:#24292E;">   </span><span style="color:#032F62;">STORAGECLASS</span><span style="color:#24292E;">   </span><span style="color:#032F62;">AGE</span></span>
<span class="line"><span style="color:#005CC5;">test</span><span style="color:#24292E;">-claim   </span><span style="color:#032F62;">Pending</span><span style="color:#24292E;">                                        </span><span style="color:#032F62;">alma-nfs-sc</span><span style="color:#24292E;">    </span><span style="color:#005CC5;">16</span><span style="color:#032F62;">m</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#查看pod日志</span></span>
<span class="line"><span style="color:#24292E;">[root@kube-master nfs]# kubetail nfs-client-provisioner-68759f5ccd-kbhjj</span></span>
<span class="line"><span style="color:#6F42C1;">Will</span><span style="color:#24292E;"> </span><span style="color:#032F62;">tail</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">logs...</span></span>
<span class="line"><span style="color:#6F42C1;">nfs-client-provisioner-68759f5ccd-kbhjj</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">[nfs-client-provisioner-68759f5ccd-kbhjj] I0604 07:56:10.862168       1 controller.go:987] provision </span><span style="color:#032F62;">&quot;default/test-claim&quot;</span><span style="color:#24292E;"> class </span><span style="color:#032F62;">&quot;alma-nfs-sc&quot;</span><span style="color:#24292E;">: started</span></span>
<span class="line"><span style="color:#24292E;">[nfs-client-provisioner-68759f5ccd-kbhjj] E0604 07:56:10.874303       1 controller.go:1004] provision </span><span style="color:#032F62;">&quot;default/test-claim&quot;</span><span style="color:#24292E;"> class </span><span style="color:#032F62;">&quot;alma-nfs-sc&quot;</span><span style="color:#24292E;">: unexpected error getting claim reference: selfLink was empty, can</span><span style="color:#032F62;">&#39;t make reference</span></span></code></pre></div><div class="warning custom-block"><p class="custom-block-title">💡 说明</p><p>解决方式：</p><p>kubernetes 1.20版本之后 禁用了 selfLink</p><p>vim /etc/kubernetes/manifests/kube-apiserver.yaml</p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">#Under here:</span></span>
<span class="line"></span>
<span class="line"><span style="color:#85E89D;">spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">containers</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  - </span><span style="color:#85E89D;">command</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    - </span><span style="color:#9ECBFF;">kube-apiserver</span></span>
<span class="line"><span style="color:#6A737D;">#Add this line:</span></span>
<span class="line"><span style="color:#E1E4E8;">- </span><span style="color:#9ECBFF;">--feature-gates=RemoveSelfLink=false</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">#Under here:</span></span>
<span class="line"></span>
<span class="line"><span style="color:#22863A;">spec</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">containers</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  - </span><span style="color:#22863A;">command</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    - </span><span style="color:#032F62;">kube-apiserver</span></span>
<span class="line"><span style="color:#6A737D;">#Add this line:</span></span>
<span class="line"><span style="color:#24292E;">- </span><span style="color:#032F62;">--feature-gates=RemoveSelfLink=false</span></span></code></pre></div><p>保存，稍后几秒，api-server自动重启</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">#改变默认 StorageClass</span></span>
<span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patch</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">storageclass</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">alma-nfs-sc</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-p</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;{&quot;metadata&quot;: {&quot;annotations&quot;:{&quot;storageclass.kubernetes.io/is-default-class&quot;:&quot;true&quot;}}}&#39;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">#改变默认 StorageClass</span></span>
<span class="line"><span style="color:#6F42C1;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patch</span><span style="color:#24292E;"> </span><span style="color:#032F62;">storageclass</span><span style="color:#24292E;"> </span><span style="color:#032F62;">alma-nfs-sc</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-p</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;{&quot;metadata&quot;: {&quot;annotations&quot;:{&quot;storageclass.kubernetes.io/is-default-class&quot;:&quot;true&quot;}}}&#39;</span></span></code></pre></div></div><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">#再次查看pvc</span></span>
<span class="line"><span style="color:#E1E4E8;">[root@kube-master nfs]# kubectl get pvc</span></span>
<span class="line"><span style="color:#B392F0;">NAME</span><span style="color:#E1E4E8;">         </span><span style="color:#9ECBFF;">STATUS</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">VOLUME</span><span style="color:#E1E4E8;">                                     </span><span style="color:#9ECBFF;">CAPACITY</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">ACCESS</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">MODES</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">STORAGECLASS</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">AGE</span></span>
<span class="line"><span style="color:#79B8FF;">test</span><span style="color:#E1E4E8;">-claim   </span><span style="color:#9ECBFF;">Bound</span><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">pvc-a3e2e1de-9b3f-4b80-9d25-f44612aa292b</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">1</span><span style="color:#9ECBFF;">Mi</span><span style="color:#E1E4E8;">        </span><span style="color:#9ECBFF;">RWX</span><span style="color:#E1E4E8;">            </span><span style="color:#9ECBFF;">alma-nfs-sc</span><span style="color:#E1E4E8;">    </span><span style="color:#79B8FF;">3</span><span style="color:#9ECBFF;">s</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">#再次查看pvc</span></span>
<span class="line"><span style="color:#24292E;">[root@kube-master nfs]# kubectl get pvc</span></span>
<span class="line"><span style="color:#6F42C1;">NAME</span><span style="color:#24292E;">         </span><span style="color:#032F62;">STATUS</span><span style="color:#24292E;">   </span><span style="color:#032F62;">VOLUME</span><span style="color:#24292E;">                                     </span><span style="color:#032F62;">CAPACITY</span><span style="color:#24292E;">   </span><span style="color:#032F62;">ACCESS</span><span style="color:#24292E;"> </span><span style="color:#032F62;">MODES</span><span style="color:#24292E;">   </span><span style="color:#032F62;">STORAGECLASS</span><span style="color:#24292E;">   </span><span style="color:#032F62;">AGE</span></span>
<span class="line"><span style="color:#005CC5;">test</span><span style="color:#24292E;">-claim   </span><span style="color:#032F62;">Bound</span><span style="color:#24292E;">    </span><span style="color:#032F62;">pvc-a3e2e1de-9b3f-4b80-9d25-f44612aa292b</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">1</span><span style="color:#032F62;">Mi</span><span style="color:#24292E;">        </span><span style="color:#032F62;">RWX</span><span style="color:#24292E;">            </span><span style="color:#032F62;">alma-nfs-sc</span><span style="color:#24292E;">    </span><span style="color:#005CC5;">3</span><span style="color:#032F62;">s</span></span></code></pre></div><h2 id="_2-3-创建pod" tabindex="-1">2.3 创建Pod <a class="header-anchor" href="#_2-3-创建pod" aria-label="Permalink to &quot;2.3 创建Pod&quot;">​</a></h2><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">[</span><span style="color:#9ECBFF;">root@kube-master nfs</span><span style="color:#E1E4E8;">]# </span><span style="color:#9ECBFF;">cat 9.nginx-storageclass-pod.yaml</span></span>
<span class="line"><span style="color:#85E89D;">apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">apps/v1</span></span>
<span class="line"><span style="color:#85E89D;">kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Deployment</span></span>
<span class="line"><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">labels</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">app</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">nginx-deploy-sc</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">nginx-deploy-sc</span></span>
<span class="line"><span style="color:#85E89D;">spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">replicas</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">2</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">selector</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">matchLabels</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">app</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">nginx-deploy-sc</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">template</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">labels</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">app</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">nginx-deploy-sc</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">containers</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      - </span><span style="color:#85E89D;">image</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">nginx:latest</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">nginx</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">volumeMounts</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">        - </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">html</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#85E89D;">mountPath</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">/usr/share/nginx/html</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">volumes</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">        - </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">html</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#85E89D;">persistentVolumeClaim</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#85E89D;">claimName</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">nginx-sc</span></span>
<span class="line"><span style="color:#B392F0;">---</span></span>
<span class="line"><span style="color:#85E89D;">apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">v1</span></span>
<span class="line"><span style="color:#85E89D;">kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">PersistentVolumeClaim</span></span>
<span class="line"><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">nginx-sc</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">labels</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">app</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">nginx-sc</span></span>
<span class="line"><span style="color:#85E89D;">spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">accessModes</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    - </span><span style="color:#9ECBFF;">ReadWriteMany</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">storageClassName</span><span style="color:#E1E4E8;">:  </span><span style="color:#9ECBFF;">alma-nfs-sc</span><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;">#增加本环境的存储类</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">resources</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">requests</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">storage</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">1Gi</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">[</span><span style="color:#032F62;">root@kube-master nfs</span><span style="color:#24292E;">]# </span><span style="color:#032F62;">cat 9.nginx-storageclass-pod.yaml</span></span>
<span class="line"><span style="color:#22863A;">apiVersion</span><span style="color:#24292E;">: </span><span style="color:#032F62;">apps/v1</span></span>
<span class="line"><span style="color:#22863A;">kind</span><span style="color:#24292E;">: </span><span style="color:#032F62;">Deployment</span></span>
<span class="line"><span style="color:#22863A;">metadata</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">labels</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">app</span><span style="color:#24292E;">: </span><span style="color:#032F62;">nginx-deploy-sc</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">nginx-deploy-sc</span></span>
<span class="line"><span style="color:#22863A;">spec</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">replicas</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">2</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">selector</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">matchLabels</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">app</span><span style="color:#24292E;">: </span><span style="color:#032F62;">nginx-deploy-sc</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">template</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">metadata</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">labels</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">app</span><span style="color:#24292E;">: </span><span style="color:#032F62;">nginx-deploy-sc</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">spec</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">containers</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      - </span><span style="color:#22863A;">image</span><span style="color:#24292E;">: </span><span style="color:#032F62;">nginx:latest</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">nginx</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">volumeMounts</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">        - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">html</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#22863A;">mountPath</span><span style="color:#24292E;">: </span><span style="color:#032F62;">/usr/share/nginx/html</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">volumes</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">        - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">html</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#22863A;">persistentVolumeClaim</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#22863A;">claimName</span><span style="color:#24292E;">: </span><span style="color:#032F62;">nginx-sc</span></span>
<span class="line"><span style="color:#6F42C1;">---</span></span>
<span class="line"><span style="color:#22863A;">apiVersion</span><span style="color:#24292E;">: </span><span style="color:#032F62;">v1</span></span>
<span class="line"><span style="color:#22863A;">kind</span><span style="color:#24292E;">: </span><span style="color:#032F62;">PersistentVolumeClaim</span></span>
<span class="line"><span style="color:#22863A;">metadata</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">nginx-sc</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">labels</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">app</span><span style="color:#24292E;">: </span><span style="color:#032F62;">nginx-sc</span></span>
<span class="line"><span style="color:#22863A;">spec</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">accessModes</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    - </span><span style="color:#032F62;">ReadWriteMany</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">storageClassName</span><span style="color:#24292E;">:  </span><span style="color:#032F62;">alma-nfs-sc</span><span style="color:#24292E;">  </span><span style="color:#6A737D;">#增加本环境的存储类</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">resources</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">requests</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">storage</span><span style="color:#24292E;">: </span><span style="color:#032F62;">1Gi</span></span></code></pre></div><ul><li>查看pod</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">[root@kube-master nfs]# kubectl get pod -owide</span></span>
<span class="line"><span style="color:#B392F0;">NAME</span><span style="color:#E1E4E8;">                                      </span><span style="color:#9ECBFF;">READY</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">STATUS</span><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">RESTARTS</span><span style="color:#E1E4E8;">         </span><span style="color:#9ECBFF;">AGE</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">IP</span><span style="color:#E1E4E8;">              </span><span style="color:#9ECBFF;">NODE</span><span style="color:#E1E4E8;">          </span><span style="color:#9ECBFF;">NOMINATED</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">NODE</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">READINESS</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">GATES</span></span>
<span class="line"><span style="color:#B392F0;">nginx-deploy-sc-865d997b5b-7cj2f</span><span style="color:#E1E4E8;">          </span><span style="color:#79B8FF;">1</span><span style="color:#9ECBFF;">/1</span><span style="color:#E1E4E8;">     </span><span style="color:#9ECBFF;">Running</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">                </span><span style="color:#79B8FF;">43</span><span style="color:#9ECBFF;">s</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">172.17</span><span style="color:#9ECBFF;">.74.108</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">kube-node03</span><span style="color:#E1E4E8;">   </span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">non</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;">           </span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">non</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span></span>
<span class="line"><span style="color:#B392F0;">nginx-deploy-sc-865d997b5b-nshpl</span><span style="color:#E1E4E8;">          </span><span style="color:#79B8FF;">1</span><span style="color:#9ECBFF;">/1</span><span style="color:#E1E4E8;">     </span><span style="color:#9ECBFF;">Running</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">                </span><span style="color:#79B8FF;">43</span><span style="color:#9ECBFF;">s</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">172.30</span><span style="color:#9ECBFF;">.0.143</span><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">kube-node01</span><span style="color:#E1E4E8;">   </span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">non</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;">           </span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">non</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">[root@kube-master nfs]# kubectl get pod -owide</span></span>
<span class="line"><span style="color:#6F42C1;">NAME</span><span style="color:#24292E;">                                      </span><span style="color:#032F62;">READY</span><span style="color:#24292E;">   </span><span style="color:#032F62;">STATUS</span><span style="color:#24292E;">    </span><span style="color:#032F62;">RESTARTS</span><span style="color:#24292E;">         </span><span style="color:#032F62;">AGE</span><span style="color:#24292E;">   </span><span style="color:#032F62;">IP</span><span style="color:#24292E;">              </span><span style="color:#032F62;">NODE</span><span style="color:#24292E;">          </span><span style="color:#032F62;">NOMINATED</span><span style="color:#24292E;"> </span><span style="color:#032F62;">NODE</span><span style="color:#24292E;">   </span><span style="color:#032F62;">READINESS</span><span style="color:#24292E;"> </span><span style="color:#032F62;">GATES</span></span>
<span class="line"><span style="color:#6F42C1;">nginx-deploy-sc-865d997b5b-7cj2f</span><span style="color:#24292E;">          </span><span style="color:#005CC5;">1</span><span style="color:#032F62;">/1</span><span style="color:#24292E;">     </span><span style="color:#032F62;">Running</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">                </span><span style="color:#005CC5;">43</span><span style="color:#032F62;">s</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">172.17</span><span style="color:#032F62;">.74.108</span><span style="color:#24292E;">   </span><span style="color:#032F62;">kube-node03</span><span style="color:#24292E;">   </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">non</span><span style="color:#24292E;">e</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;">           </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">non</span><span style="color:#24292E;">e</span><span style="color:#D73A49;">&gt;</span></span>
<span class="line"><span style="color:#6F42C1;">nginx-deploy-sc-865d997b5b-nshpl</span><span style="color:#24292E;">          </span><span style="color:#005CC5;">1</span><span style="color:#032F62;">/1</span><span style="color:#24292E;">     </span><span style="color:#032F62;">Running</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">                </span><span style="color:#005CC5;">43</span><span style="color:#032F62;">s</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">172.30</span><span style="color:#032F62;">.0.143</span><span style="color:#24292E;">    </span><span style="color:#032F62;">kube-node01</span><span style="color:#24292E;">   </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">non</span><span style="color:#24292E;">e</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;">           </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">non</span><span style="color:#24292E;">e</span><span style="color:#D73A49;">&gt;</span></span></code></pre></div><ul><li>验证效果</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">[root@kube-master nfs]# curl 172.17.74.108</span></span>
<span class="line"><span style="color:#F97583;">&lt;</span><span style="color:#E1E4E8;">html</span><span style="color:#F97583;">&gt;</span></span>
<span class="line"><span style="color:#F97583;">&lt;</span><span style="color:#E1E4E8;">head&gt;&lt;title</span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;">403 Forbidden</span><span style="color:#F97583;">&lt;</span><span style="color:#E1E4E8;">/title&gt;&lt;/head</span><span style="color:#F97583;">&gt;</span></span>
<span class="line"><span style="color:#F97583;">&lt;</span><span style="color:#E1E4E8;">body</span><span style="color:#F97583;">&gt;</span></span>
<span class="line"><span style="color:#F97583;">&lt;</span><span style="color:#E1E4E8;">center&gt;&lt;h</span><span style="color:#F97583;">1&gt;</span><span style="color:#E1E4E8;">403 Forbidden</span><span style="color:#F97583;">&lt;</span><span style="color:#E1E4E8;">/h1&gt;&lt;/center</span><span style="color:#F97583;">&gt;</span></span>
<span class="line"><span style="color:#F97583;">&lt;</span><span style="color:#E1E4E8;">hr&gt;&lt;center</span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;">nginx/1.27.</span><span style="color:#F97583;">0&lt;</span><span style="color:#E1E4E8;">/center</span><span style="color:#F97583;">&gt;</span></span>
<span class="line"><span style="color:#F97583;">&lt;</span><span style="color:#E1E4E8;">/body</span><span style="color:#F97583;">&gt;</span></span>
<span class="line"><span style="color:#F97583;">&lt;</span><span style="color:#E1E4E8;">/html</span><span style="color:#F97583;">&gt;</span></span>
<span class="line"><span style="color:#6A737D;"># 原因是nfs中没有添加资源</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#在nfs server中添加资源，会在pv01下面创建一个目录，需要你在这个目录下创建资源</span></span>
<span class="line"><span style="color:#E1E4E8;">[root@Rocky pv01]# pwd</span></span>
<span class="line"><span style="color:#B392F0;">/data/nfs/pv01</span></span>
<span class="line"><span style="color:#E1E4E8;">[root@Rocky pv01]# ls</span></span>
<span class="line"><span style="color:#B392F0;">default-nginx-sc-pvc-08863344-1951-4235-86c9-241ebf0bb634</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">[root@Rocky pv01]# echo </span><span style="color:#9ECBFF;">&quot;hello nginx svc&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;"> default-nginx-sc-pvc-08863344-1951-4235-86c9-241ebf0bb634/index.html</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#再次访问nginx</span></span>
<span class="line"><span style="color:#E1E4E8;">[root@kube-master nfs]# curl 172.17.74.108</span></span>
<span class="line"><span style="color:#B392F0;">hello</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">nginx</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">svc</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">[root@kube-master nfs]# curl 172.17.74.108</span></span>
<span class="line"><span style="color:#D73A49;">&lt;</span><span style="color:#24292E;">html</span><span style="color:#D73A49;">&gt;</span></span>
<span class="line"><span style="color:#D73A49;">&lt;</span><span style="color:#24292E;">head&gt;&lt;title</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;">403 Forbidden</span><span style="color:#D73A49;">&lt;</span><span style="color:#24292E;">/title&gt;&lt;/head</span><span style="color:#D73A49;">&gt;</span></span>
<span class="line"><span style="color:#D73A49;">&lt;</span><span style="color:#24292E;">body</span><span style="color:#D73A49;">&gt;</span></span>
<span class="line"><span style="color:#D73A49;">&lt;</span><span style="color:#24292E;">center&gt;&lt;h</span><span style="color:#D73A49;">1&gt;</span><span style="color:#24292E;">403 Forbidden</span><span style="color:#D73A49;">&lt;</span><span style="color:#24292E;">/h1&gt;&lt;/center</span><span style="color:#D73A49;">&gt;</span></span>
<span class="line"><span style="color:#D73A49;">&lt;</span><span style="color:#24292E;">hr&gt;&lt;center</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;">nginx/1.27.</span><span style="color:#D73A49;">0&lt;</span><span style="color:#24292E;">/center</span><span style="color:#D73A49;">&gt;</span></span>
<span class="line"><span style="color:#D73A49;">&lt;</span><span style="color:#24292E;">/body</span><span style="color:#D73A49;">&gt;</span></span>
<span class="line"><span style="color:#D73A49;">&lt;</span><span style="color:#24292E;">/html</span><span style="color:#D73A49;">&gt;</span></span>
<span class="line"><span style="color:#6A737D;"># 原因是nfs中没有添加资源</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#在nfs server中添加资源，会在pv01下面创建一个目录，需要你在这个目录下创建资源</span></span>
<span class="line"><span style="color:#24292E;">[root@Rocky pv01]# pwd</span></span>
<span class="line"><span style="color:#6F42C1;">/data/nfs/pv01</span></span>
<span class="line"><span style="color:#24292E;">[root@Rocky pv01]# ls</span></span>
<span class="line"><span style="color:#6F42C1;">default-nginx-sc-pvc-08863344-1951-4235-86c9-241ebf0bb634</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">[root@Rocky pv01]# echo </span><span style="color:#032F62;">&quot;hello nginx svc&quot;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;"> default-nginx-sc-pvc-08863344-1951-4235-86c9-241ebf0bb634/index.html</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#再次访问nginx</span></span>
<span class="line"><span style="color:#24292E;">[root@kube-master nfs]# curl 172.17.74.108</span></span>
<span class="line"><span style="color:#6F42C1;">hello</span><span style="color:#24292E;"> </span><span style="color:#032F62;">nginx</span><span style="color:#24292E;"> </span><span style="color:#032F62;">svc</span></span></code></pre></div><h1 id="_3-基于nfs-subdir-external-provisioner-推荐" tabindex="-1">3. 基于nfs-subdir-external-provisioner,推荐 <a class="header-anchor" href="#_3-基于nfs-subdir-external-provisioner-推荐" aria-label="Permalink to &quot;3. 基于nfs-subdir-external-provisioner,推荐&quot;">​</a></h1><p>由于kubernetes内部不包含NFS驱动，所以需要使用外部驱动nfs-subdir-external-provisioner是一个自动供应器，它使用NFS服务端来支持动态供应。</p><p>NFS-subdir-external- provisioner实例负责监视PersistentVolumeClaims请求StorageClass，并自动为它们创建NFS所支持的PresistentVolumes。</p><p>GitHub地址: <a href="https://github.com/kubernetes-sigs/nfs-subdir-external-provisioner" target="_blank" rel="noreferrer">https://github.com/kubernetes-sigs/nfs-subdir-external-provisioner</a></p><blockquote><p>持续更新中</p></blockquote><h2 id="_3-1-安装nfs-server驱动" tabindex="-1">3.1 安装nfs-Server驱动 <a class="header-anchor" href="#_3-1-安装nfs-server驱动" aria-label="Permalink to &quot;3.1 安装nfs-Server驱动&quot;">​</a></h2><p>创建RBAC权限</p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">[</span><span style="color:#9ECBFF;">root@kube-master nfs</span><span style="color:#E1E4E8;">]# </span><span style="color:#9ECBFF;">cat 1.nfs-rbac.yaml</span><span style="color:#E1E4E8;"> </span></span>
<span class="line"><span style="color:#85E89D;">apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">v1</span></span>
<span class="line"><span style="color:#85E89D;">kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">ServiceAccount</span></span>
<span class="line"><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">nfs-client-provisioner</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;"># replace with namespace where provisioner is deployed</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">namespace</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">default</span></span>
<span class="line"><span style="color:#B392F0;">---</span></span>
<span class="line"><span style="color:#85E89D;">kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">ClusterRole</span></span>
<span class="line"><span style="color:#85E89D;">apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">rbac.authorization.k8s.io/v1</span></span>
<span class="line"><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">nfs-client-provisioner-runner</span></span>
<span class="line"><span style="color:#85E89D;">rules</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  - </span><span style="color:#85E89D;">apiGroups</span><span style="color:#E1E4E8;">: [</span><span style="color:#9ECBFF;">&quot;&quot;</span><span style="color:#E1E4E8;">]</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">resources</span><span style="color:#E1E4E8;">: [</span><span style="color:#9ECBFF;">&quot;nodes&quot;</span><span style="color:#E1E4E8;">]</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">verbs</span><span style="color:#E1E4E8;">: [</span><span style="color:#9ECBFF;">&quot;get&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&quot;list&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&quot;watch&quot;</span><span style="color:#E1E4E8;">]</span></span>
<span class="line"><span style="color:#E1E4E8;">  - </span><span style="color:#85E89D;">apiGroups</span><span style="color:#E1E4E8;">: [</span><span style="color:#9ECBFF;">&quot;&quot;</span><span style="color:#E1E4E8;">]</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">resources</span><span style="color:#E1E4E8;">: [</span><span style="color:#9ECBFF;">&quot;persistentvolumes&quot;</span><span style="color:#E1E4E8;">]</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">verbs</span><span style="color:#E1E4E8;">: [</span><span style="color:#9ECBFF;">&quot;get&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&quot;list&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&quot;watch&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&quot;create&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&quot;delete&quot;</span><span style="color:#E1E4E8;">]</span></span>
<span class="line"><span style="color:#E1E4E8;">  - </span><span style="color:#85E89D;">apiGroups</span><span style="color:#E1E4E8;">: [</span><span style="color:#9ECBFF;">&quot;&quot;</span><span style="color:#E1E4E8;">]</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">resources</span><span style="color:#E1E4E8;">: [</span><span style="color:#9ECBFF;">&quot;persistentvolumeclaims&quot;</span><span style="color:#E1E4E8;">]</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">verbs</span><span style="color:#E1E4E8;">: [</span><span style="color:#9ECBFF;">&quot;get&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&quot;list&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&quot;watch&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&quot;update&quot;</span><span style="color:#E1E4E8;">]</span></span>
<span class="line"><span style="color:#E1E4E8;">  - </span><span style="color:#85E89D;">apiGroups</span><span style="color:#E1E4E8;">: [</span><span style="color:#9ECBFF;">&quot;storage.k8s.io&quot;</span><span style="color:#E1E4E8;">]</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">resources</span><span style="color:#E1E4E8;">: [</span><span style="color:#9ECBFF;">&quot;storageclasses&quot;</span><span style="color:#E1E4E8;">]</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">verbs</span><span style="color:#E1E4E8;">: [</span><span style="color:#9ECBFF;">&quot;get&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&quot;list&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&quot;watch&quot;</span><span style="color:#E1E4E8;">]</span></span>
<span class="line"><span style="color:#E1E4E8;">  - </span><span style="color:#85E89D;">apiGroups</span><span style="color:#E1E4E8;">: [</span><span style="color:#9ECBFF;">&quot;&quot;</span><span style="color:#E1E4E8;">]</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">resources</span><span style="color:#E1E4E8;">: [</span><span style="color:#9ECBFF;">&quot;events&quot;</span><span style="color:#E1E4E8;">]</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">verbs</span><span style="color:#E1E4E8;">: [</span><span style="color:#9ECBFF;">&quot;create&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&quot;update&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&quot;patch&quot;</span><span style="color:#E1E4E8;">]</span></span>
<span class="line"><span style="color:#B392F0;">---</span></span>
<span class="line"><span style="color:#85E89D;">kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">ClusterRoleBinding</span></span>
<span class="line"><span style="color:#85E89D;">apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">rbac.authorization.k8s.io/v1</span></span>
<span class="line"><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">run-nfs-client-provisioner</span></span>
<span class="line"><span style="color:#85E89D;">subjects</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  - </span><span style="color:#85E89D;">kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">ServiceAccount</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">nfs-client-provisioner</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;"># replace with namespace where provisioner is deployed</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">namespace</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">default</span></span>
<span class="line"><span style="color:#85E89D;">roleRef</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">ClusterRole</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">nfs-client-provisioner-runner</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">apiGroup</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">rbac.authorization.k8s.io</span></span>
<span class="line"><span style="color:#B392F0;">---</span></span>
<span class="line"><span style="color:#85E89D;">kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Role</span></span>
<span class="line"><span style="color:#85E89D;">apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">rbac.authorization.k8s.io/v1</span></span>
<span class="line"><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">leader-locking-nfs-client-provisioner</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;"># replace with namespace where provisioner is deployed</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">namespace</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">default</span></span>
<span class="line"><span style="color:#85E89D;">rules</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  - </span><span style="color:#85E89D;">apiGroups</span><span style="color:#E1E4E8;">: [</span><span style="color:#9ECBFF;">&quot;&quot;</span><span style="color:#E1E4E8;">]</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">resources</span><span style="color:#E1E4E8;">: [</span><span style="color:#9ECBFF;">&quot;endpoints&quot;</span><span style="color:#E1E4E8;">]</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">verbs</span><span style="color:#E1E4E8;">: [</span><span style="color:#9ECBFF;">&quot;get&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&quot;list&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&quot;watch&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&quot;create&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&quot;update&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&quot;patch&quot;</span><span style="color:#E1E4E8;">]</span></span>
<span class="line"><span style="color:#B392F0;">---</span></span>
<span class="line"><span style="color:#85E89D;">kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">RoleBinding</span></span>
<span class="line"><span style="color:#85E89D;">apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">rbac.authorization.k8s.io/v1</span></span>
<span class="line"><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">leader-locking-nfs-client-provisioner</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;"># replace with namespace where provisioner is deployed</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">namespace</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">default</span></span>
<span class="line"><span style="color:#85E89D;">subjects</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  - </span><span style="color:#85E89D;">kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">ServiceAccount</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">nfs-client-provisioner</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;"># replace with namespace where provisioner is deployed</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">namespace</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">default</span></span>
<span class="line"><span style="color:#85E89D;">roleRef</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Role</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">leader-locking-nfs-client-provisioner</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">apiGroup</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">rbac.authorization.k8s.io</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">[</span><span style="color:#032F62;">root@kube-master nfs</span><span style="color:#24292E;">]# </span><span style="color:#032F62;">cat 1.nfs-rbac.yaml</span><span style="color:#24292E;"> </span></span>
<span class="line"><span style="color:#22863A;">apiVersion</span><span style="color:#24292E;">: </span><span style="color:#032F62;">v1</span></span>
<span class="line"><span style="color:#22863A;">kind</span><span style="color:#24292E;">: </span><span style="color:#032F62;">ServiceAccount</span></span>
<span class="line"><span style="color:#22863A;">metadata</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">nfs-client-provisioner</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6A737D;"># replace with namespace where provisioner is deployed</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">namespace</span><span style="color:#24292E;">: </span><span style="color:#032F62;">default</span></span>
<span class="line"><span style="color:#6F42C1;">---</span></span>
<span class="line"><span style="color:#22863A;">kind</span><span style="color:#24292E;">: </span><span style="color:#032F62;">ClusterRole</span></span>
<span class="line"><span style="color:#22863A;">apiVersion</span><span style="color:#24292E;">: </span><span style="color:#032F62;">rbac.authorization.k8s.io/v1</span></span>
<span class="line"><span style="color:#22863A;">metadata</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">nfs-client-provisioner-runner</span></span>
<span class="line"><span style="color:#22863A;">rules</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  - </span><span style="color:#22863A;">apiGroups</span><span style="color:#24292E;">: [</span><span style="color:#032F62;">&quot;&quot;</span><span style="color:#24292E;">]</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">resources</span><span style="color:#24292E;">: [</span><span style="color:#032F62;">&quot;nodes&quot;</span><span style="color:#24292E;">]</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">verbs</span><span style="color:#24292E;">: [</span><span style="color:#032F62;">&quot;get&quot;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;list&quot;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;watch&quot;</span><span style="color:#24292E;">]</span></span>
<span class="line"><span style="color:#24292E;">  - </span><span style="color:#22863A;">apiGroups</span><span style="color:#24292E;">: [</span><span style="color:#032F62;">&quot;&quot;</span><span style="color:#24292E;">]</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">resources</span><span style="color:#24292E;">: [</span><span style="color:#032F62;">&quot;persistentvolumes&quot;</span><span style="color:#24292E;">]</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">verbs</span><span style="color:#24292E;">: [</span><span style="color:#032F62;">&quot;get&quot;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;list&quot;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;watch&quot;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;create&quot;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;delete&quot;</span><span style="color:#24292E;">]</span></span>
<span class="line"><span style="color:#24292E;">  - </span><span style="color:#22863A;">apiGroups</span><span style="color:#24292E;">: [</span><span style="color:#032F62;">&quot;&quot;</span><span style="color:#24292E;">]</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">resources</span><span style="color:#24292E;">: [</span><span style="color:#032F62;">&quot;persistentvolumeclaims&quot;</span><span style="color:#24292E;">]</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">verbs</span><span style="color:#24292E;">: [</span><span style="color:#032F62;">&quot;get&quot;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;list&quot;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;watch&quot;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;update&quot;</span><span style="color:#24292E;">]</span></span>
<span class="line"><span style="color:#24292E;">  - </span><span style="color:#22863A;">apiGroups</span><span style="color:#24292E;">: [</span><span style="color:#032F62;">&quot;storage.k8s.io&quot;</span><span style="color:#24292E;">]</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">resources</span><span style="color:#24292E;">: [</span><span style="color:#032F62;">&quot;storageclasses&quot;</span><span style="color:#24292E;">]</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">verbs</span><span style="color:#24292E;">: [</span><span style="color:#032F62;">&quot;get&quot;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;list&quot;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;watch&quot;</span><span style="color:#24292E;">]</span></span>
<span class="line"><span style="color:#24292E;">  - </span><span style="color:#22863A;">apiGroups</span><span style="color:#24292E;">: [</span><span style="color:#032F62;">&quot;&quot;</span><span style="color:#24292E;">]</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">resources</span><span style="color:#24292E;">: [</span><span style="color:#032F62;">&quot;events&quot;</span><span style="color:#24292E;">]</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">verbs</span><span style="color:#24292E;">: [</span><span style="color:#032F62;">&quot;create&quot;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;update&quot;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;patch&quot;</span><span style="color:#24292E;">]</span></span>
<span class="line"><span style="color:#6F42C1;">---</span></span>
<span class="line"><span style="color:#22863A;">kind</span><span style="color:#24292E;">: </span><span style="color:#032F62;">ClusterRoleBinding</span></span>
<span class="line"><span style="color:#22863A;">apiVersion</span><span style="color:#24292E;">: </span><span style="color:#032F62;">rbac.authorization.k8s.io/v1</span></span>
<span class="line"><span style="color:#22863A;">metadata</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">run-nfs-client-provisioner</span></span>
<span class="line"><span style="color:#22863A;">subjects</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  - </span><span style="color:#22863A;">kind</span><span style="color:#24292E;">: </span><span style="color:#032F62;">ServiceAccount</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">nfs-client-provisioner</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;"># replace with namespace where provisioner is deployed</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">namespace</span><span style="color:#24292E;">: </span><span style="color:#032F62;">default</span></span>
<span class="line"><span style="color:#22863A;">roleRef</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">kind</span><span style="color:#24292E;">: </span><span style="color:#032F62;">ClusterRole</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">nfs-client-provisioner-runner</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">apiGroup</span><span style="color:#24292E;">: </span><span style="color:#032F62;">rbac.authorization.k8s.io</span></span>
<span class="line"><span style="color:#6F42C1;">---</span></span>
<span class="line"><span style="color:#22863A;">kind</span><span style="color:#24292E;">: </span><span style="color:#032F62;">Role</span></span>
<span class="line"><span style="color:#22863A;">apiVersion</span><span style="color:#24292E;">: </span><span style="color:#032F62;">rbac.authorization.k8s.io/v1</span></span>
<span class="line"><span style="color:#22863A;">metadata</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">leader-locking-nfs-client-provisioner</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6A737D;"># replace with namespace where provisioner is deployed</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">namespace</span><span style="color:#24292E;">: </span><span style="color:#032F62;">default</span></span>
<span class="line"><span style="color:#22863A;">rules</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  - </span><span style="color:#22863A;">apiGroups</span><span style="color:#24292E;">: [</span><span style="color:#032F62;">&quot;&quot;</span><span style="color:#24292E;">]</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">resources</span><span style="color:#24292E;">: [</span><span style="color:#032F62;">&quot;endpoints&quot;</span><span style="color:#24292E;">]</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">verbs</span><span style="color:#24292E;">: [</span><span style="color:#032F62;">&quot;get&quot;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;list&quot;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;watch&quot;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;create&quot;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;update&quot;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;patch&quot;</span><span style="color:#24292E;">]</span></span>
<span class="line"><span style="color:#6F42C1;">---</span></span>
<span class="line"><span style="color:#22863A;">kind</span><span style="color:#24292E;">: </span><span style="color:#032F62;">RoleBinding</span></span>
<span class="line"><span style="color:#22863A;">apiVersion</span><span style="color:#24292E;">: </span><span style="color:#032F62;">rbac.authorization.k8s.io/v1</span></span>
<span class="line"><span style="color:#22863A;">metadata</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">leader-locking-nfs-client-provisioner</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6A737D;"># replace with namespace where provisioner is deployed</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">namespace</span><span style="color:#24292E;">: </span><span style="color:#032F62;">default</span></span>
<span class="line"><span style="color:#22863A;">subjects</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  - </span><span style="color:#22863A;">kind</span><span style="color:#24292E;">: </span><span style="color:#032F62;">ServiceAccount</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">nfs-client-provisioner</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;"># replace with namespace where provisioner is deployed</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">namespace</span><span style="color:#24292E;">: </span><span style="color:#032F62;">default</span></span>
<span class="line"><span style="color:#22863A;">roleRef</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">kind</span><span style="color:#24292E;">: </span><span style="color:#032F62;">Role</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">leader-locking-nfs-client-provisioner</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">apiGroup</span><span style="color:#24292E;">: </span><span style="color:#032F62;">rbac.authorization.k8s.io</span></span></code></pre></div><ul><li>执行</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">[root@kube-master nfs]# kubectl apply -f 1.nfs-rbac.yaml </span></span>
<span class="line"><span style="color:#B392F0;">serviceaccount/nfs-client-provisioner</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">created</span></span>
<span class="line"><span style="color:#B392F0;">clusterrole.rbac.authorization.k8s.io/nfs-client-provisioner-runner</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">created</span></span>
<span class="line"><span style="color:#B392F0;">clusterrolebinding.rbac.authorization.k8s.io/run-nfs-client-provisioner</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">created</span></span>
<span class="line"><span style="color:#B392F0;">role.rbac.authorization.k8s.io/leader-locking-nfs-client-provisioner</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">created</span></span>
<span class="line"><span style="color:#B392F0;">rolebinding.rbac.authorization.k8s.io/leader-locking-nfs-client-provisioner</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">created</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">[root@kube-master nfs]# kubectl apply -f 1.nfs-rbac.yaml </span></span>
<span class="line"><span style="color:#6F42C1;">serviceaccount/nfs-client-provisioner</span><span style="color:#24292E;"> </span><span style="color:#032F62;">created</span></span>
<span class="line"><span style="color:#6F42C1;">clusterrole.rbac.authorization.k8s.io/nfs-client-provisioner-runner</span><span style="color:#24292E;"> </span><span style="color:#032F62;">created</span></span>
<span class="line"><span style="color:#6F42C1;">clusterrolebinding.rbac.authorization.k8s.io/run-nfs-client-provisioner</span><span style="color:#24292E;"> </span><span style="color:#032F62;">created</span></span>
<span class="line"><span style="color:#6F42C1;">role.rbac.authorization.k8s.io/leader-locking-nfs-client-provisioner</span><span style="color:#24292E;"> </span><span style="color:#032F62;">created</span></span>
<span class="line"><span style="color:#6F42C1;">rolebinding.rbac.authorization.k8s.io/leader-locking-nfs-client-provisioner</span><span style="color:#24292E;"> </span><span style="color:#032F62;">created</span></span></code></pre></div><h2 id="_3-2-部署nfs-provisioner" tabindex="-1">3.2 部署nfs-Provisioner <a class="header-anchor" href="#_3-2-部署nfs-provisioner" aria-label="Permalink to &quot;3.2 部署nfs-Provisioner&quot;">​</a></h2><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">[</span><span style="color:#9ECBFF;">root@kube-master nfs</span><span style="color:#E1E4E8;">]#  </span><span style="color:#9ECBFF;">cat 2.nfs-provisioner-deploy.yaml</span><span style="color:#E1E4E8;"> </span></span>
<span class="line"><span style="color:#85E89D;">apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">apps/v1</span></span>
<span class="line"><span style="color:#85E89D;">kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Deployment</span></span>
<span class="line"><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">nfs-client-provisioner</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">labels</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">app</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">nfs-client-provisioner</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;"># replace with namespace where provisioner is deployed</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">namespace</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">default</span></span>
<span class="line"><span style="color:#85E89D;">spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">replicas</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">1</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">strategy</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">type</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Recreate</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">selector</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">matchLabels</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">app</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">nfs-client-provisioner</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">template</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">labels</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">app</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">nfs-client-provisioner</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">serviceAccountName</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">nfs-client-provisioner</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">containers</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">        - </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">nfs-client-provisioner</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#6A737D;">#image: k8s.gcr.io/sig-storage/nfs-subdir-external-provisioner:v4.0.2</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#85E89D;">image</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">registry.cn-zhangjiakou.aliyuncs.com/hsuing/nfs-subdir-external-provisioner:v4.0.2</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#85E89D;">volumeMounts</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">            - </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">nfs-client-root</span></span>
<span class="line"><span style="color:#E1E4E8;">              </span><span style="color:#85E89D;">mountPath</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">/persistentvolumes</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#85E89D;">env</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">            - </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">PROVISIONER_NAME</span></span>
<span class="line"><span style="color:#E1E4E8;">              </span><span style="color:#85E89D;">value</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">k8s-sigs.io/nfs-subdir-external-provisioner</span><span style="color:#E1E4E8;">   </span><span style="color:#6A737D;">#NFS-Provisioner的名称，后续StorageClassName要与该名称保持一致</span></span>
<span class="line"><span style="color:#E1E4E8;">            - </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">NFS_SERVER</span><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">#NFS服务器的地址</span></span>
<span class="line"><span style="color:#E1E4E8;">              </span><span style="color:#85E89D;">value</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">10.103.236.199</span><span style="color:#E1E4E8;">  </span></span>
<span class="line"><span style="color:#E1E4E8;">            - </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">NFS_PATH</span></span>
<span class="line"><span style="color:#E1E4E8;">              </span><span style="color:#85E89D;">value</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">/data</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">volumes</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">        - </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">nfs-client-root</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#85E89D;">nfs</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#85E89D;">server</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">10.103.236.199</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#85E89D;">path</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">/data</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">[</span><span style="color:#032F62;">root@kube-master nfs</span><span style="color:#24292E;">]#  </span><span style="color:#032F62;">cat 2.nfs-provisioner-deploy.yaml</span><span style="color:#24292E;"> </span></span>
<span class="line"><span style="color:#22863A;">apiVersion</span><span style="color:#24292E;">: </span><span style="color:#032F62;">apps/v1</span></span>
<span class="line"><span style="color:#22863A;">kind</span><span style="color:#24292E;">: </span><span style="color:#032F62;">Deployment</span></span>
<span class="line"><span style="color:#22863A;">metadata</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">nfs-client-provisioner</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">labels</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">app</span><span style="color:#24292E;">: </span><span style="color:#032F62;">nfs-client-provisioner</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6A737D;"># replace with namespace where provisioner is deployed</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">namespace</span><span style="color:#24292E;">: </span><span style="color:#032F62;">default</span></span>
<span class="line"><span style="color:#22863A;">spec</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">replicas</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">1</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">strategy</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">type</span><span style="color:#24292E;">: </span><span style="color:#032F62;">Recreate</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">selector</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">matchLabels</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">app</span><span style="color:#24292E;">: </span><span style="color:#032F62;">nfs-client-provisioner</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">template</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">metadata</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">labels</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">app</span><span style="color:#24292E;">: </span><span style="color:#032F62;">nfs-client-provisioner</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">spec</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">serviceAccountName</span><span style="color:#24292E;">: </span><span style="color:#032F62;">nfs-client-provisioner</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">containers</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">        - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">nfs-client-provisioner</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#6A737D;">#image: k8s.gcr.io/sig-storage/nfs-subdir-external-provisioner:v4.0.2</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#22863A;">image</span><span style="color:#24292E;">: </span><span style="color:#032F62;">registry.cn-zhangjiakou.aliyuncs.com/hsuing/nfs-subdir-external-provisioner:v4.0.2</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#22863A;">volumeMounts</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">            - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">nfs-client-root</span></span>
<span class="line"><span style="color:#24292E;">              </span><span style="color:#22863A;">mountPath</span><span style="color:#24292E;">: </span><span style="color:#032F62;">/persistentvolumes</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#22863A;">env</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">            - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">PROVISIONER_NAME</span></span>
<span class="line"><span style="color:#24292E;">              </span><span style="color:#22863A;">value</span><span style="color:#24292E;">: </span><span style="color:#032F62;">k8s-sigs.io/nfs-subdir-external-provisioner</span><span style="color:#24292E;">   </span><span style="color:#6A737D;">#NFS-Provisioner的名称，后续StorageClassName要与该名称保持一致</span></span>
<span class="line"><span style="color:#24292E;">            - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">NFS_SERVER</span><span style="color:#24292E;">    </span><span style="color:#6A737D;">#NFS服务器的地址</span></span>
<span class="line"><span style="color:#24292E;">              </span><span style="color:#22863A;">value</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">10.103.236.199</span><span style="color:#24292E;">  </span></span>
<span class="line"><span style="color:#24292E;">            - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">NFS_PATH</span></span>
<span class="line"><span style="color:#24292E;">              </span><span style="color:#22863A;">value</span><span style="color:#24292E;">: </span><span style="color:#032F62;">/data</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">volumes</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">        - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">nfs-client-root</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#22863A;">nfs</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#22863A;">server</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">10.103.236.199</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#22863A;">path</span><span style="color:#24292E;">: </span><span style="color:#032F62;">/data</span></span></code></pre></div><ul><li>执行apply</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">[root@kube-master nfs]# kubectl apply -f 2.nfs-provisioner-deploy.yaml </span></span>
<span class="line"><span style="color:#B392F0;">deployment.apps/nfs-client-provisioner</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">created</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#Pod正常运行。</span></span>
<span class="line"><span style="color:#E1E4E8;">[root@kube-master nfs]# kubectl get pods</span></span>
<span class="line"><span style="color:#B392F0;">NAME</span><span style="color:#E1E4E8;">                                      </span><span style="color:#9ECBFF;">READY</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">STATUS</span><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">RESTARTS</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">AGE</span></span>
<span class="line"><span style="color:#B392F0;">nfs-client-provisioner-7f5bc48c68-8z5z6</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">1</span><span style="color:#9ECBFF;">/1</span><span style="color:#E1E4E8;">     </span><span style="color:#9ECBFF;">Running</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">              </span><span style="color:#79B8FF;">3</span><span style="color:#9ECBFF;">m37s</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#describe查看Pod详细信息；</span></span>
<span class="line"><span style="color:#E1E4E8;">[root@kube-master nfs-subdir-external-provisioner]# kubectl describe pod nfs-client-provisioner-7f5bc48c68-8z5z6</span></span>
<span class="line"><span style="color:#B392F0;">Name:</span><span style="color:#E1E4E8;">         </span><span style="color:#9ECBFF;">nfs-client-provisioner-7f5bc48c68-8z5z6</span></span>
<span class="line"><span style="color:#B392F0;">Namespace:</span><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">default</span></span>
<span class="line"><span style="color:#B392F0;">Priority:</span><span style="color:#E1E4E8;">     </span><span style="color:#79B8FF;">0</span></span>
<span class="line"><span style="color:#B392F0;">Node:</span><span style="color:#E1E4E8;">         </span><span style="color:#9ECBFF;">kube-node01/10.103.236.202</span></span>
<span class="line"><span style="color:#B392F0;">Start</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Time:</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">Tue,</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">04</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2024</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">21</span><span style="color:#9ECBFF;">:04:55</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">+0800</span></span>
<span class="line"><span style="color:#B392F0;">Labels:</span><span style="color:#E1E4E8;">       </span><span style="color:#9ECBFF;">app=nfs-client-provisioner</span></span>
<span class="line"><span style="color:#E1E4E8;">              pod-template-hash</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">7</span><span style="color:#9ECBFF;">f5bc48c68</span></span>
<span class="line"><span style="color:#B392F0;">Annotations:</span><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">cni.projectcalico.org/podIP:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">172.30</span><span style="color:#9ECBFF;">.0.158/32</span></span>
<span class="line"><span style="color:#E1E4E8;">              </span><span style="color:#B392F0;">cni.projectcalico.org/podIPs:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">172.30</span><span style="color:#9ECBFF;">.0.158/32</span></span>
<span class="line"><span style="color:#B392F0;">Status:</span><span style="color:#E1E4E8;">       </span><span style="color:#9ECBFF;">Running</span></span>
<span class="line"><span style="color:#B392F0;">IP:</span><span style="color:#E1E4E8;">           </span><span style="color:#79B8FF;">172.30</span><span style="color:#9ECBFF;">.0.158</span></span>
<span class="line"><span style="color:#B392F0;">IPs:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">IP:</span><span style="color:#E1E4E8;">           </span><span style="color:#79B8FF;">172.30</span><span style="color:#9ECBFF;">.0.158</span></span>
<span class="line"><span style="color:#B392F0;">Controlled</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">By:</span><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">ReplicaSet/nfs-client-provisioner-7f5bc48c68</span></span>
<span class="line"><span style="color:#B392F0;">Containers:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">nfs-client-provisioner:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">Container</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">ID:</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">docker://aca9232b37f76ba5589002669046d3339d2cbb9d0220ec17eb3ac678f70ed0e0</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">Image:</span><span style="color:#E1E4E8;">          </span><span style="color:#9ECBFF;">registry.cn-zhangjiakou.aliyuncs.com/hsuing/nfs-subdir-external-provisioner:v4.0.2</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">Image</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">ID:</span><span style="color:#E1E4E8;">       </span><span style="color:#9ECBFF;">docker-pullable://lihuahaitang/nfs-subdir-external-provisioner@sha256:f741e403b3ca161e784163de3ebde9190905fdbf7dfaa463620ab8f16c0f6423</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">Port:</span><span style="color:#E1E4E8;">           </span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">non</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">Host</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Port:</span><span style="color:#E1E4E8;">      </span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">non</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">State:</span><span style="color:#E1E4E8;">          </span><span style="color:#9ECBFF;">Running</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#B392F0;">Started:</span><span style="color:#E1E4E8;">      </span><span style="color:#9ECBFF;">Tue,</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">04</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Jun</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2024</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">21</span><span style="color:#9ECBFF;">:04:58</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">+0800</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">Ready:</span><span style="color:#E1E4E8;">          </span><span style="color:#9ECBFF;">True</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">Restart</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Count:</span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">0</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">Environment:</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#B392F0;">PROVISIONER_NAME:</span><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">k8s-sigs.io/nfs-subdir-external-provisioner</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#B392F0;">NFS_SERVER:</span><span style="color:#E1E4E8;">        </span><span style="color:#79B8FF;">10.103</span><span style="color:#9ECBFF;">.236.199</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#B392F0;">NFS_PATH:</span><span style="color:#E1E4E8;">          </span><span style="color:#9ECBFF;">/data/nfs/pv01</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">Mounts:</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#B392F0;">/persistentvolumes</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">from</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">nfs-client-root</span><span style="color:#E1E4E8;"> (rw)</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#B392F0;">/var/run/secrets/kubernetes.io/serviceaccount</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">from</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">kube-api-access-p97qn</span><span style="color:#E1E4E8;"> (ro)</span></span>
<span class="line"><span style="color:#B392F0;">Conditions:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">Type</span><span style="color:#E1E4E8;">              </span><span style="color:#9ECBFF;">Status</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">Initialized</span><span style="color:#E1E4E8;">       </span><span style="color:#9ECBFF;">True</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">Ready</span><span style="color:#E1E4E8;">             </span><span style="color:#9ECBFF;">True</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">ContainersReady</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">True</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">PodScheduled</span><span style="color:#E1E4E8;">      </span><span style="color:#9ECBFF;">True</span></span>
<span class="line"><span style="color:#B392F0;">Volumes:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">nfs-client-root:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">Type:</span><span style="color:#E1E4E8;">      </span><span style="color:#9ECBFF;">NFS</span><span style="color:#E1E4E8;"> (an </span><span style="color:#9ECBFF;">NFS</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">mount</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">that</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">lasts</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">the</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">lifetime</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">of</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">a</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pod</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">Server:</span><span style="color:#E1E4E8;">    </span><span style="color:#79B8FF;">10.103</span><span style="color:#9ECBFF;">.236.199</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">Path:</span><span style="color:#E1E4E8;">      </span><span style="color:#9ECBFF;">/data/nfs/pv01</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">ReadOnly:</span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">false</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">kube-api-access-p97qn:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">Type:</span><span style="color:#E1E4E8;">                    </span><span style="color:#9ECBFF;">Projected</span><span style="color:#E1E4E8;"> (a </span><span style="color:#9ECBFF;">volume</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">that</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">contains</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">injected</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">data</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">from</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">multiple</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">sources</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">TokenExpirationSeconds:</span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">3607</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">ConfigMapName:</span><span style="color:#E1E4E8;">           </span><span style="color:#9ECBFF;">kube-root-ca.crt</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">ConfigMapOptional:</span><span style="color:#E1E4E8;">       </span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">ni</span><span style="color:#E1E4E8;">l</span><span style="color:#F97583;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">DownwardAPI:</span><span style="color:#E1E4E8;">             </span><span style="color:#79B8FF;">true</span></span>
<span class="line"><span style="color:#B392F0;">QoS</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Class:</span><span style="color:#E1E4E8;">                   </span><span style="color:#9ECBFF;">BestEffort</span></span>
<span class="line"><span style="color:#B392F0;">Node-Selectors:</span><span style="color:#E1E4E8;">              </span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">non</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span></span>
<span class="line"><span style="color:#B392F0;">Tolerations:</span><span style="color:#E1E4E8;">                 </span><span style="color:#9ECBFF;">node.kubernetes.io/not-ready:NoExecute</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">op=Exists</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">for</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">300</span><span style="color:#9ECBFF;">s</span></span>
<span class="line"><span style="color:#E1E4E8;">                             </span><span style="color:#B392F0;">node.kubernetes.io/unreachable:NoExecute</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">op=Exists</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">for</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">300</span><span style="color:#9ECBFF;">s</span></span>
<span class="line"><span style="color:#B392F0;">Events:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">Type</span><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">Reason</span><span style="color:#E1E4E8;">     </span><span style="color:#9ECBFF;">Age</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">From</span><span style="color:#E1E4E8;">               </span><span style="color:#9ECBFF;">Message</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">----</span><span style="color:#E1E4E8;">    </span><span style="color:#79B8FF;">------</span><span style="color:#E1E4E8;">     </span><span style="color:#79B8FF;">----</span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">----</span><span style="color:#E1E4E8;">               </span><span style="color:#79B8FF;">-------</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">Normal</span><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">Scheduled</span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">2</span><span style="color:#9ECBFF;">m3s</span><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">default-scheduler</span><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">Successfully</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">assigned</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">default/nfs-client-provisioner-7f5bc48c68-8z5z6</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">to</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">kube-node01</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">Normal</span><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">Pulling</span><span style="color:#E1E4E8;">    </span><span style="color:#79B8FF;">2</span><span style="color:#9ECBFF;">m1s</span><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">kubelet</span><span style="color:#E1E4E8;">            </span><span style="color:#9ECBFF;">Pulling</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">image</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;registry.cn-zhangjiakou.aliyuncs.com/hsuing/nfs-subdir-external-provisioner:v4.0.2&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">Normal</span><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">Pulled</span><span style="color:#E1E4E8;">     </span><span style="color:#79B8FF;">2</span><span style="color:#9ECBFF;">m</span><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">kubelet</span><span style="color:#E1E4E8;">            </span><span style="color:#9ECBFF;">Successfully</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pulled</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">image</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;registry.cn-zhangjiakou.aliyuncs.com/hsuing/nfs-subdir-external-provisioner:v4.0.2&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">in</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">1.229420395</span><span style="color:#9ECBFF;">s</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">Normal</span><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">Created</span><span style="color:#E1E4E8;">    </span><span style="color:#79B8FF;">2</span><span style="color:#9ECBFF;">m</span><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">kubelet</span><span style="color:#E1E4E8;">            </span><span style="color:#9ECBFF;">Created</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">container</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">nfs-client-provisioner</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">Normal</span><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">Started</span><span style="color:#E1E4E8;">    </span><span style="color:#79B8FF;">2</span><span style="color:#9ECBFF;">m</span><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">kubelet</span><span style="color:#E1E4E8;">            </span><span style="color:#9ECBFF;">Started</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">container</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">nfs-client-provisioner</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">[root@kube-master nfs]# kubectl apply -f 2.nfs-provisioner-deploy.yaml </span></span>
<span class="line"><span style="color:#6F42C1;">deployment.apps/nfs-client-provisioner</span><span style="color:#24292E;"> </span><span style="color:#032F62;">created</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#Pod正常运行。</span></span>
<span class="line"><span style="color:#24292E;">[root@kube-master nfs]# kubectl get pods</span></span>
<span class="line"><span style="color:#6F42C1;">NAME</span><span style="color:#24292E;">                                      </span><span style="color:#032F62;">READY</span><span style="color:#24292E;">   </span><span style="color:#032F62;">STATUS</span><span style="color:#24292E;">    </span><span style="color:#032F62;">RESTARTS</span><span style="color:#24292E;">   </span><span style="color:#032F62;">AGE</span></span>
<span class="line"><span style="color:#6F42C1;">nfs-client-provisioner-7f5bc48c68-8z5z6</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">1</span><span style="color:#032F62;">/1</span><span style="color:#24292E;">     </span><span style="color:#032F62;">Running</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">              </span><span style="color:#005CC5;">3</span><span style="color:#032F62;">m37s</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#describe查看Pod详细信息；</span></span>
<span class="line"><span style="color:#24292E;">[root@kube-master nfs-subdir-external-provisioner]# kubectl describe pod nfs-client-provisioner-7f5bc48c68-8z5z6</span></span>
<span class="line"><span style="color:#6F42C1;">Name:</span><span style="color:#24292E;">         </span><span style="color:#032F62;">nfs-client-provisioner-7f5bc48c68-8z5z6</span></span>
<span class="line"><span style="color:#6F42C1;">Namespace:</span><span style="color:#24292E;">    </span><span style="color:#032F62;">default</span></span>
<span class="line"><span style="color:#6F42C1;">Priority:</span><span style="color:#24292E;">     </span><span style="color:#005CC5;">0</span></span>
<span class="line"><span style="color:#6F42C1;">Node:</span><span style="color:#24292E;">         </span><span style="color:#032F62;">kube-node01/10.103.236.202</span></span>
<span class="line"><span style="color:#6F42C1;">Start</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Time:</span><span style="color:#24292E;">   </span><span style="color:#032F62;">Tue,</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">04</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2024</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">21</span><span style="color:#032F62;">:04:55</span><span style="color:#24292E;"> </span><span style="color:#032F62;">+0800</span></span>
<span class="line"><span style="color:#6F42C1;">Labels:</span><span style="color:#24292E;">       </span><span style="color:#032F62;">app=nfs-client-provisioner</span></span>
<span class="line"><span style="color:#24292E;">              pod-template-hash</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">7</span><span style="color:#032F62;">f5bc48c68</span></span>
<span class="line"><span style="color:#6F42C1;">Annotations:</span><span style="color:#24292E;">  </span><span style="color:#032F62;">cni.projectcalico.org/podIP:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">172.30</span><span style="color:#032F62;">.0.158/32</span></span>
<span class="line"><span style="color:#24292E;">              </span><span style="color:#6F42C1;">cni.projectcalico.org/podIPs:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">172.30</span><span style="color:#032F62;">.0.158/32</span></span>
<span class="line"><span style="color:#6F42C1;">Status:</span><span style="color:#24292E;">       </span><span style="color:#032F62;">Running</span></span>
<span class="line"><span style="color:#6F42C1;">IP:</span><span style="color:#24292E;">           </span><span style="color:#005CC5;">172.30</span><span style="color:#032F62;">.0.158</span></span>
<span class="line"><span style="color:#6F42C1;">IPs:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">IP:</span><span style="color:#24292E;">           </span><span style="color:#005CC5;">172.30</span><span style="color:#032F62;">.0.158</span></span>
<span class="line"><span style="color:#6F42C1;">Controlled</span><span style="color:#24292E;"> </span><span style="color:#032F62;">By:</span><span style="color:#24292E;">  </span><span style="color:#032F62;">ReplicaSet/nfs-client-provisioner-7f5bc48c68</span></span>
<span class="line"><span style="color:#6F42C1;">Containers:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">nfs-client-provisioner:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">Container</span><span style="color:#24292E;"> </span><span style="color:#032F62;">ID:</span><span style="color:#24292E;">   </span><span style="color:#032F62;">docker://aca9232b37f76ba5589002669046d3339d2cbb9d0220ec17eb3ac678f70ed0e0</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">Image:</span><span style="color:#24292E;">          </span><span style="color:#032F62;">registry.cn-zhangjiakou.aliyuncs.com/hsuing/nfs-subdir-external-provisioner:v4.0.2</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">Image</span><span style="color:#24292E;"> </span><span style="color:#032F62;">ID:</span><span style="color:#24292E;">       </span><span style="color:#032F62;">docker-pullable://lihuahaitang/nfs-subdir-external-provisioner@sha256:f741e403b3ca161e784163de3ebde9190905fdbf7dfaa463620ab8f16c0f6423</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">Port:</span><span style="color:#24292E;">           </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">non</span><span style="color:#24292E;">e</span><span style="color:#D73A49;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">Host</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Port:</span><span style="color:#24292E;">      </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">non</span><span style="color:#24292E;">e</span><span style="color:#D73A49;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">State:</span><span style="color:#24292E;">          </span><span style="color:#032F62;">Running</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#6F42C1;">Started:</span><span style="color:#24292E;">      </span><span style="color:#032F62;">Tue,</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">04</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Jun</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2024</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">21</span><span style="color:#032F62;">:04:58</span><span style="color:#24292E;"> </span><span style="color:#032F62;">+0800</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">Ready:</span><span style="color:#24292E;">          </span><span style="color:#032F62;">True</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">Restart</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Count:</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">0</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">Environment:</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#6F42C1;">PROVISIONER_NAME:</span><span style="color:#24292E;">  </span><span style="color:#032F62;">k8s-sigs.io/nfs-subdir-external-provisioner</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#6F42C1;">NFS_SERVER:</span><span style="color:#24292E;">        </span><span style="color:#005CC5;">10.103</span><span style="color:#032F62;">.236.199</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#6F42C1;">NFS_PATH:</span><span style="color:#24292E;">          </span><span style="color:#032F62;">/data/nfs/pv01</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">Mounts:</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#6F42C1;">/persistentvolumes</span><span style="color:#24292E;"> </span><span style="color:#032F62;">from</span><span style="color:#24292E;"> </span><span style="color:#032F62;">nfs-client-root</span><span style="color:#24292E;"> (rw)</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#6F42C1;">/var/run/secrets/kubernetes.io/serviceaccount</span><span style="color:#24292E;"> </span><span style="color:#032F62;">from</span><span style="color:#24292E;"> </span><span style="color:#032F62;">kube-api-access-p97qn</span><span style="color:#24292E;"> (ro)</span></span>
<span class="line"><span style="color:#6F42C1;">Conditions:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">Type</span><span style="color:#24292E;">              </span><span style="color:#032F62;">Status</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">Initialized</span><span style="color:#24292E;">       </span><span style="color:#032F62;">True</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">Ready</span><span style="color:#24292E;">             </span><span style="color:#032F62;">True</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">ContainersReady</span><span style="color:#24292E;">   </span><span style="color:#032F62;">True</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">PodScheduled</span><span style="color:#24292E;">      </span><span style="color:#032F62;">True</span></span>
<span class="line"><span style="color:#6F42C1;">Volumes:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">nfs-client-root:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">Type:</span><span style="color:#24292E;">      </span><span style="color:#032F62;">NFS</span><span style="color:#24292E;"> (an </span><span style="color:#032F62;">NFS</span><span style="color:#24292E;"> </span><span style="color:#032F62;">mount</span><span style="color:#24292E;"> </span><span style="color:#032F62;">that</span><span style="color:#24292E;"> </span><span style="color:#032F62;">lasts</span><span style="color:#24292E;"> </span><span style="color:#032F62;">the</span><span style="color:#24292E;"> </span><span style="color:#032F62;">lifetime</span><span style="color:#24292E;"> </span><span style="color:#032F62;">of</span><span style="color:#24292E;"> </span><span style="color:#032F62;">a</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pod</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">Server:</span><span style="color:#24292E;">    </span><span style="color:#005CC5;">10.103</span><span style="color:#032F62;">.236.199</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">Path:</span><span style="color:#24292E;">      </span><span style="color:#032F62;">/data/nfs/pv01</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">ReadOnly:</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">false</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">kube-api-access-p97qn:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">Type:</span><span style="color:#24292E;">                    </span><span style="color:#032F62;">Projected</span><span style="color:#24292E;"> (a </span><span style="color:#032F62;">volume</span><span style="color:#24292E;"> </span><span style="color:#032F62;">that</span><span style="color:#24292E;"> </span><span style="color:#032F62;">contains</span><span style="color:#24292E;"> </span><span style="color:#032F62;">injected</span><span style="color:#24292E;"> </span><span style="color:#032F62;">data</span><span style="color:#24292E;"> </span><span style="color:#032F62;">from</span><span style="color:#24292E;"> </span><span style="color:#032F62;">multiple</span><span style="color:#24292E;"> </span><span style="color:#032F62;">sources</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">TokenExpirationSeconds:</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">3607</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">ConfigMapName:</span><span style="color:#24292E;">           </span><span style="color:#032F62;">kube-root-ca.crt</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">ConfigMapOptional:</span><span style="color:#24292E;">       </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">ni</span><span style="color:#24292E;">l</span><span style="color:#D73A49;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">DownwardAPI:</span><span style="color:#24292E;">             </span><span style="color:#005CC5;">true</span></span>
<span class="line"><span style="color:#6F42C1;">QoS</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Class:</span><span style="color:#24292E;">                   </span><span style="color:#032F62;">BestEffort</span></span>
<span class="line"><span style="color:#6F42C1;">Node-Selectors:</span><span style="color:#24292E;">              </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">non</span><span style="color:#24292E;">e</span><span style="color:#D73A49;">&gt;</span></span>
<span class="line"><span style="color:#6F42C1;">Tolerations:</span><span style="color:#24292E;">                 </span><span style="color:#032F62;">node.kubernetes.io/not-ready:NoExecute</span><span style="color:#24292E;"> </span><span style="color:#032F62;">op=Exists</span><span style="color:#24292E;"> </span><span style="color:#032F62;">for</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">300</span><span style="color:#032F62;">s</span></span>
<span class="line"><span style="color:#24292E;">                             </span><span style="color:#6F42C1;">node.kubernetes.io/unreachable:NoExecute</span><span style="color:#24292E;"> </span><span style="color:#032F62;">op=Exists</span><span style="color:#24292E;"> </span><span style="color:#032F62;">for</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">300</span><span style="color:#032F62;">s</span></span>
<span class="line"><span style="color:#6F42C1;">Events:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">Type</span><span style="color:#24292E;">    </span><span style="color:#032F62;">Reason</span><span style="color:#24292E;">     </span><span style="color:#032F62;">Age</span><span style="color:#24292E;">   </span><span style="color:#032F62;">From</span><span style="color:#24292E;">               </span><span style="color:#032F62;">Message</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">----</span><span style="color:#24292E;">    </span><span style="color:#005CC5;">------</span><span style="color:#24292E;">     </span><span style="color:#005CC5;">----</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">----</span><span style="color:#24292E;">               </span><span style="color:#005CC5;">-------</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">Normal</span><span style="color:#24292E;">  </span><span style="color:#032F62;">Scheduled</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">2</span><span style="color:#032F62;">m3s</span><span style="color:#24292E;">  </span><span style="color:#032F62;">default-scheduler</span><span style="color:#24292E;">  </span><span style="color:#032F62;">Successfully</span><span style="color:#24292E;"> </span><span style="color:#032F62;">assigned</span><span style="color:#24292E;"> </span><span style="color:#032F62;">default/nfs-client-provisioner-7f5bc48c68-8z5z6</span><span style="color:#24292E;"> </span><span style="color:#032F62;">to</span><span style="color:#24292E;"> </span><span style="color:#032F62;">kube-node01</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">Normal</span><span style="color:#24292E;">  </span><span style="color:#032F62;">Pulling</span><span style="color:#24292E;">    </span><span style="color:#005CC5;">2</span><span style="color:#032F62;">m1s</span><span style="color:#24292E;">  </span><span style="color:#032F62;">kubelet</span><span style="color:#24292E;">            </span><span style="color:#032F62;">Pulling</span><span style="color:#24292E;"> </span><span style="color:#032F62;">image</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;registry.cn-zhangjiakou.aliyuncs.com/hsuing/nfs-subdir-external-provisioner:v4.0.2&quot;</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">Normal</span><span style="color:#24292E;">  </span><span style="color:#032F62;">Pulled</span><span style="color:#24292E;">     </span><span style="color:#005CC5;">2</span><span style="color:#032F62;">m</span><span style="color:#24292E;">    </span><span style="color:#032F62;">kubelet</span><span style="color:#24292E;">            </span><span style="color:#032F62;">Successfully</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pulled</span><span style="color:#24292E;"> </span><span style="color:#032F62;">image</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;registry.cn-zhangjiakou.aliyuncs.com/hsuing/nfs-subdir-external-provisioner:v4.0.2&quot;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">in</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1.229420395</span><span style="color:#032F62;">s</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">Normal</span><span style="color:#24292E;">  </span><span style="color:#032F62;">Created</span><span style="color:#24292E;">    </span><span style="color:#005CC5;">2</span><span style="color:#032F62;">m</span><span style="color:#24292E;">    </span><span style="color:#032F62;">kubelet</span><span style="color:#24292E;">            </span><span style="color:#032F62;">Created</span><span style="color:#24292E;"> </span><span style="color:#032F62;">container</span><span style="color:#24292E;"> </span><span style="color:#032F62;">nfs-client-provisioner</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">Normal</span><span style="color:#24292E;">  </span><span style="color:#032F62;">Started</span><span style="color:#24292E;">    </span><span style="color:#005CC5;">2</span><span style="color:#032F62;">m</span><span style="color:#24292E;">    </span><span style="color:#032F62;">kubelet</span><span style="color:#24292E;">            </span><span style="color:#032F62;">Started</span><span style="color:#24292E;"> </span><span style="color:#032F62;">container</span><span style="color:#24292E;"> </span><span style="color:#032F62;">nfs-client-provisioner</span></span></code></pre></div><h2 id="_3-3-创建storageclass" tabindex="-1">3.3 创建StorageClass <a class="header-anchor" href="#_3-3-创建storageclass" aria-label="Permalink to &quot;3.3 创建StorageClass&quot;">​</a></h2><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">[</span><span style="color:#9ECBFF;">root@kube-master nfs</span><span style="color:#E1E4E8;">]# </span><span style="color:#9ECBFF;">cat 3.storageclass.yaml</span><span style="color:#E1E4E8;"> </span></span>
<span class="line"><span style="color:#85E89D;">apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">storage.k8s.io/v1</span></span>
<span class="line"><span style="color:#85E89D;">kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">StorageClass</span><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">#类型为storageclass</span></span>
<span class="line"><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">nfs-provisioner-storage</span><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">#PVC申请时需明确指定的storageclass名称</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">annotations</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">storageclass.kubernetes.io/is-default-class</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;true&quot;</span></span>
<span class="line"><span style="color:#85E89D;">provisioner</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">k8s-sigs.io/nfs-subdir-external-provisioner</span><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;">#供应商名称，必须和上面创建的&quot;PROVISIONER_NAME&quot;保持一致</span></span>
<span class="line"><span style="color:#85E89D;">parameters</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">archiveOnDelete</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;false&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;">#如果值为true，删除pvc后也会删除目录内容，&quot;false&quot;则会对数据进行保留</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">pathPattern</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;\${.PVC.namespace}/\${.PVC.name}&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;">#创建目录路径的模板，默认为随机命名。</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">[</span><span style="color:#032F62;">root@kube-master nfs</span><span style="color:#24292E;">]# </span><span style="color:#032F62;">cat 3.storageclass.yaml</span><span style="color:#24292E;"> </span></span>
<span class="line"><span style="color:#22863A;">apiVersion</span><span style="color:#24292E;">: </span><span style="color:#032F62;">storage.k8s.io/v1</span></span>
<span class="line"><span style="color:#22863A;">kind</span><span style="color:#24292E;">: </span><span style="color:#032F62;">StorageClass</span><span style="color:#24292E;">    </span><span style="color:#6A737D;">#类型为storageclass</span></span>
<span class="line"><span style="color:#22863A;">metadata</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">nfs-provisioner-storage</span><span style="color:#24292E;">    </span><span style="color:#6A737D;">#PVC申请时需明确指定的storageclass名称</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">annotations</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">storageclass.kubernetes.io/is-default-class</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;true&quot;</span></span>
<span class="line"><span style="color:#22863A;">provisioner</span><span style="color:#24292E;">: </span><span style="color:#032F62;">k8s-sigs.io/nfs-subdir-external-provisioner</span><span style="color:#24292E;">  </span><span style="color:#6A737D;">#供应商名称，必须和上面创建的&quot;PROVISIONER_NAME&quot;保持一致</span></span>
<span class="line"><span style="color:#22863A;">parameters</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">archiveOnDelete</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;false&quot;</span><span style="color:#24292E;"> </span><span style="color:#6A737D;">#如果值为true，删除pvc后也会删除目录内容，&quot;false&quot;则会对数据进行保留</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">pathPattern</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;\${.PVC.namespace}/\${.PVC.name}&quot;</span><span style="color:#24292E;"> </span><span style="color:#6A737D;">#创建目录路径的模板，默认为随机命名。</span></span></code></pre></div><ul><li>执行apply</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">[root@kube-master nfs]# kubectl apply -f 3.storageclass.yaml </span></span>
<span class="line"><span style="color:#B392F0;">storageclass.storage.k8s.io/nfs-provisioner-storage</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">created</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">[root@kube-master nfs]# kubectl apply -f 3.storageclass.yaml </span></span>
<span class="line"><span style="color:#6F42C1;">storageclass.storage.k8s.io/nfs-provisioner-storage</span><span style="color:#24292E;"> </span><span style="color:#032F62;">created</span></span></code></pre></div><ul><li>查看</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"></span>
<span class="line"><span style="color:#B392F0;">storage简写sc</span></span>
<span class="line"><span style="color:#E1E4E8;">[root@kube-master nfs]# kubectl get sc</span></span>
<span class="line"><span style="color:#B392F0;">NAME</span><span style="color:#E1E4E8;">                      </span><span style="color:#9ECBFF;">PROVISIONER</span><span style="color:#E1E4E8;">                                   </span><span style="color:#9ECBFF;">RECLAIMPOLICY</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">VOLUMEBINDINGMODE</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">ALLOWVOLUMEEXPANSION</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">AGE</span></span>
<span class="line"><span style="color:#B392F0;">nfs-provisioner-storage</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">k8s-sigs.io/nfs-subdir-external-provisioner</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">Delete</span><span style="color:#E1E4E8;">          </span><span style="color:#9ECBFF;">Immediate</span><span style="color:#E1E4E8;">           </span><span style="color:#79B8FF;">false</span><span style="color:#E1E4E8;">                  </span><span style="color:#79B8FF;">3</span><span style="color:#9ECBFF;">s</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">describe查看配详细信息。</span></span>
<span class="line"><span style="color:#E1E4E8;">[root@kube-master nfs]# kubectl describe sc </span></span>
<span class="line"><span style="color:#B392F0;">Name:</span><span style="color:#E1E4E8;">            </span><span style="color:#9ECBFF;">nfs-provisioner-storage</span></span>
<span class="line"><span style="color:#B392F0;">IsDefaultClass:</span><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">Yes</span></span>
<span class="line"><span style="color:#B392F0;">Annotations:</span><span style="color:#E1E4E8;">     </span><span style="color:#9ECBFF;">kubectl.kubernetes.io/last-applied-configuration={&quot;apiVersion&quot;:&quot;storage.k8s.io/v1&quot;,&quot;kind&quot;:&quot;StorageClass&quot;,&quot;metadata&quot;:{&quot;annotations&quot;:{&quot;storageclass.kubernetes.io/is-default-class&quot;:&quot;true&quot;},&quot;name&quot;:&quot;nfs-provisioner-storage&quot;},&quot;parameters&quot;:{&quot;archiveOnDelete&quot;:&quot;false&quot;,&quot;pathPattern&quot;:&quot;\${.</span><span style="color:#E1E4E8;">PVC</span><span style="color:#9ECBFF;">.</span><span style="color:#E1E4E8;">namespace</span><span style="color:#9ECBFF;">}/\${.</span><span style="color:#E1E4E8;">PVC</span><span style="color:#9ECBFF;">.</span><span style="color:#E1E4E8;">name</span><span style="color:#9ECBFF;">}&quot;},&quot;provisioner&quot;:&quot;k8s-sigs.io/nfs-subdir-external-provisioner&quot;}</span></span>
<span class="line"><span style="color:#B392F0;">,storageclass.kubernetes.io/is-default-class</span><span style="color:#E1E4E8;">=</span><span style="color:#79B8FF;">true</span></span>
<span class="line"><span style="color:#B392F0;">Provisioner:</span><span style="color:#E1E4E8;">           </span><span style="color:#9ECBFF;">k8s-sigs.io/nfs-subdir-external-provisioner</span></span>
<span class="line"><span style="color:#B392F0;">Parameters:</span><span style="color:#E1E4E8;">            </span><span style="color:#9ECBFF;">archiveOnDelete=</span><span style="color:#79B8FF;">false</span><span style="color:#9ECBFF;">,pathPattern=</span><span style="color:#E1E4E8;">\${.PVC.namespace}</span><span style="color:#9ECBFF;">/</span><span style="color:#E1E4E8;">\${.PVC.name}</span></span>
<span class="line"><span style="color:#B392F0;">AllowVolumeExpansion:</span><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">unse</span><span style="color:#E1E4E8;">t</span><span style="color:#F97583;">&gt;</span></span>
<span class="line"><span style="color:#B392F0;">MountOptions:</span><span style="color:#E1E4E8;">          </span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">non</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span></span>
<span class="line"><span style="color:#B392F0;">ReclaimPolicy:</span><span style="color:#E1E4E8;">         </span><span style="color:#9ECBFF;">Delete</span></span>
<span class="line"><span style="color:#B392F0;">VolumeBindingMode:</span><span style="color:#E1E4E8;">     </span><span style="color:#9ECBFF;">Immediate</span></span>
<span class="line"><span style="color:#B392F0;">Events:</span><span style="color:#E1E4E8;">                </span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">non</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"></span>
<span class="line"><span style="color:#6F42C1;">storage简写sc</span></span>
<span class="line"><span style="color:#24292E;">[root@kube-master nfs]# kubectl get sc</span></span>
<span class="line"><span style="color:#6F42C1;">NAME</span><span style="color:#24292E;">                      </span><span style="color:#032F62;">PROVISIONER</span><span style="color:#24292E;">                                   </span><span style="color:#032F62;">RECLAIMPOLICY</span><span style="color:#24292E;">   </span><span style="color:#032F62;">VOLUMEBINDINGMODE</span><span style="color:#24292E;">   </span><span style="color:#032F62;">ALLOWVOLUMEEXPANSION</span><span style="color:#24292E;">   </span><span style="color:#032F62;">AGE</span></span>
<span class="line"><span style="color:#6F42C1;">nfs-provisioner-storage</span><span style="color:#24292E;">   </span><span style="color:#032F62;">k8s-sigs.io/nfs-subdir-external-provisioner</span><span style="color:#24292E;">   </span><span style="color:#032F62;">Delete</span><span style="color:#24292E;">          </span><span style="color:#032F62;">Immediate</span><span style="color:#24292E;">           </span><span style="color:#005CC5;">false</span><span style="color:#24292E;">                  </span><span style="color:#005CC5;">3</span><span style="color:#032F62;">s</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">describe查看配详细信息。</span></span>
<span class="line"><span style="color:#24292E;">[root@kube-master nfs]# kubectl describe sc </span></span>
<span class="line"><span style="color:#6F42C1;">Name:</span><span style="color:#24292E;">            </span><span style="color:#032F62;">nfs-provisioner-storage</span></span>
<span class="line"><span style="color:#6F42C1;">IsDefaultClass:</span><span style="color:#24292E;">  </span><span style="color:#032F62;">Yes</span></span>
<span class="line"><span style="color:#6F42C1;">Annotations:</span><span style="color:#24292E;">     </span><span style="color:#032F62;">kubectl.kubernetes.io/last-applied-configuration={&quot;apiVersion&quot;:&quot;storage.k8s.io/v1&quot;,&quot;kind&quot;:&quot;StorageClass&quot;,&quot;metadata&quot;:{&quot;annotations&quot;:{&quot;storageclass.kubernetes.io/is-default-class&quot;:&quot;true&quot;},&quot;name&quot;:&quot;nfs-provisioner-storage&quot;},&quot;parameters&quot;:{&quot;archiveOnDelete&quot;:&quot;false&quot;,&quot;pathPattern&quot;:&quot;\${.</span><span style="color:#24292E;">PVC</span><span style="color:#032F62;">.</span><span style="color:#24292E;">namespace</span><span style="color:#032F62;">}/\${.</span><span style="color:#24292E;">PVC</span><span style="color:#032F62;">.</span><span style="color:#24292E;">name</span><span style="color:#032F62;">}&quot;},&quot;provisioner&quot;:&quot;k8s-sigs.io/nfs-subdir-external-provisioner&quot;}</span></span>
<span class="line"><span style="color:#6F42C1;">,storageclass.kubernetes.io/is-default-class</span><span style="color:#24292E;">=</span><span style="color:#005CC5;">true</span></span>
<span class="line"><span style="color:#6F42C1;">Provisioner:</span><span style="color:#24292E;">           </span><span style="color:#032F62;">k8s-sigs.io/nfs-subdir-external-provisioner</span></span>
<span class="line"><span style="color:#6F42C1;">Parameters:</span><span style="color:#24292E;">            </span><span style="color:#032F62;">archiveOnDelete=</span><span style="color:#005CC5;">false</span><span style="color:#032F62;">,pathPattern=</span><span style="color:#24292E;">\${.PVC.namespace}</span><span style="color:#032F62;">/</span><span style="color:#24292E;">\${.PVC.name}</span></span>
<span class="line"><span style="color:#6F42C1;">AllowVolumeExpansion:</span><span style="color:#24292E;">  </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">unse</span><span style="color:#24292E;">t</span><span style="color:#D73A49;">&gt;</span></span>
<span class="line"><span style="color:#6F42C1;">MountOptions:</span><span style="color:#24292E;">          </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">non</span><span style="color:#24292E;">e</span><span style="color:#D73A49;">&gt;</span></span>
<span class="line"><span style="color:#6F42C1;">ReclaimPolicy:</span><span style="color:#24292E;">         </span><span style="color:#032F62;">Delete</span></span>
<span class="line"><span style="color:#6F42C1;">VolumeBindingMode:</span><span style="color:#24292E;">     </span><span style="color:#032F62;">Immediate</span></span>
<span class="line"><span style="color:#6F42C1;">Events:</span><span style="color:#24292E;">                </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">non</span><span style="color:#24292E;">e</span><span style="color:#D73A49;">&gt;</span></span></code></pre></div><h2 id="_3-4-创建pvc-自动关联pv" tabindex="-1">3.4 创建PVC-自动关联PV <a class="header-anchor" href="#_3-4-创建pvc-自动关联pv" aria-label="Permalink to &quot;3.4 创建PVC-自动关联PV&quot;">​</a></h2><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">[</span><span style="color:#9ECBFF;">root@kube-master nfs</span><span style="color:#E1E4E8;">]# </span><span style="color:#9ECBFF;">cat 4.nfs-pvc-test.yaml</span><span style="color:#E1E4E8;"> </span></span>
<span class="line"><span style="color:#85E89D;">apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">v1</span></span>
<span class="line"><span style="color:#85E89D;">kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">PersistentVolumeClaim</span></span>
<span class="line"><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">nfs-pvc-test</span></span>
<span class="line"><span style="color:#85E89D;">spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">storageClassName</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;nfs-provisioner-storage&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">accessModes</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  - </span><span style="color:#9ECBFF;">ReadWriteMany</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">resources</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">requests</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">storage</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">0.5Gi</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">[</span><span style="color:#032F62;">root@kube-master nfs</span><span style="color:#24292E;">]# </span><span style="color:#032F62;">cat 4.nfs-pvc-test.yaml</span><span style="color:#24292E;"> </span></span>
<span class="line"><span style="color:#22863A;">apiVersion</span><span style="color:#24292E;">: </span><span style="color:#032F62;">v1</span></span>
<span class="line"><span style="color:#22863A;">kind</span><span style="color:#24292E;">: </span><span style="color:#032F62;">PersistentVolumeClaim</span></span>
<span class="line"><span style="color:#22863A;">metadata</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">nfs-pvc-test</span></span>
<span class="line"><span style="color:#22863A;">spec</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">storageClassName</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;nfs-provisioner-storage&quot;</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">accessModes</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  - </span><span style="color:#032F62;">ReadWriteMany</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">resources</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">requests</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">storage</span><span style="color:#24292E;">: </span><span style="color:#032F62;">0.5Gi</span></span></code></pre></div><ul><li>查看</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">这里的PV的名字是随机的，数据的存储路径是根据pathPattern来定义的。</span></span>
<span class="line"><span style="color:#E1E4E8;">[root@Rocky nfs-pvc-test]# pwd</span></span>
<span class="line"><span style="color:#B392F0;">/data/nfs/pv01/default/nfs-pvc-test</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">[root@kube-master nfs]# kubectl get pv</span></span>
<span class="line"><span style="color:#B392F0;">pvc-8ed67f7d-d829-4d87-8c66-d8a85f50772f</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">512</span><span style="color:#9ECBFF;">Mi</span><span style="color:#E1E4E8;">      </span><span style="color:#9ECBFF;">RWX</span><span style="color:#E1E4E8;">            </span><span style="color:#9ECBFF;">Delete</span><span style="color:#E1E4E8;">           </span><span style="color:#9ECBFF;">Bound</span><span style="color:#E1E4E8;">         </span><span style="color:#9ECBFF;">default/nfs-pvc-test</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">nfs-provisioner-storage</span><span style="color:#E1E4E8;">            </span><span style="color:#79B8FF;">5</span><span style="color:#9ECBFF;">m19s</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">[root@kube-master nfs]# kubectl describe pv pvc-8ed67f7d-d829-4d87-8c66-d8a85f50772f</span></span>
<span class="line"><span style="color:#B392F0;">Name:</span><span style="color:#E1E4E8;">            </span><span style="color:#9ECBFF;">pvc-8ed67f7d-d829-4d87-8c66-d8a85f50772f</span></span>
<span class="line"><span style="color:#B392F0;">Labels:</span><span style="color:#E1E4E8;">          </span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">non</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span></span>
<span class="line"><span style="color:#B392F0;">Annotations:</span><span style="color:#E1E4E8;">     </span><span style="color:#9ECBFF;">pv.kubernetes.io/provisioned-by:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">k8s-sigs.io/nfs-subdir-external-provisioner</span></span>
<span class="line"><span style="color:#B392F0;">Finalizers:</span><span style="color:#E1E4E8;">      [kubernetes.io/pv-protection]</span></span>
<span class="line"><span style="color:#B392F0;">StorageClass:</span><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">nfs-provisioner-storage</span></span>
<span class="line"><span style="color:#B392F0;">Status:</span><span style="color:#E1E4E8;">          </span><span style="color:#9ECBFF;">Bound</span></span>
<span class="line"><span style="color:#B392F0;">Claim:</span><span style="color:#E1E4E8;">           </span><span style="color:#9ECBFF;">default/nfs-pvc-test</span></span>
<span class="line"><span style="color:#B392F0;">Reclaim</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Policy:</span><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">Delete</span></span>
<span class="line"><span style="color:#B392F0;">Access</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Modes:</span><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">RWX</span></span>
<span class="line"><span style="color:#B392F0;">VolumeMode:</span><span style="color:#E1E4E8;">      </span><span style="color:#9ECBFF;">Filesystem</span></span>
<span class="line"><span style="color:#B392F0;">Capacity:</span><span style="color:#E1E4E8;">        </span><span style="color:#79B8FF;">512</span><span style="color:#9ECBFF;">Mi</span></span>
<span class="line"><span style="color:#B392F0;">Node</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Affinity:</span><span style="color:#E1E4E8;">   </span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">non</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span></span>
<span class="line"><span style="color:#B392F0;">Message:</span><span style="color:#E1E4E8;">         </span></span>
<span class="line"><span style="color:#B392F0;">Source:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">Type:</span><span style="color:#E1E4E8;">      </span><span style="color:#9ECBFF;">NFS</span><span style="color:#E1E4E8;"> (an </span><span style="color:#9ECBFF;">NFS</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">mount</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">that</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">lasts</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">the</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">lifetime</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">of</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">a</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pod</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">Server:</span><span style="color:#E1E4E8;">    </span><span style="color:#79B8FF;">10.103</span><span style="color:#9ECBFF;">.236.199</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">Path:</span><span style="color:#E1E4E8;">      </span><span style="color:#9ECBFF;">/data/nfs/pv01/default/nfs-pvc-test</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">ReadOnly:</span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">false</span></span>
<span class="line"><span style="color:#B392F0;">Events:</span><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">non</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">describe可用看到更详细的信息</span></span>
<span class="line"><span style="color:#E1E4E8;">[root@kube-master nfs]# kubectl describe pvc </span></span>
<span class="line"><span style="color:#B392F0;">Name:</span><span style="color:#E1E4E8;">          </span><span style="color:#9ECBFF;">nfs-pvc-test</span></span>
<span class="line"><span style="color:#B392F0;">Namespace:</span><span style="color:#E1E4E8;">     </span><span style="color:#9ECBFF;">default</span></span>
<span class="line"><span style="color:#B392F0;">StorageClass:</span><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">nfs-provisioner-storage</span></span>
<span class="line"><span style="color:#B392F0;">Status:</span><span style="color:#E1E4E8;">        </span><span style="color:#9ECBFF;">Bound</span></span>
<span class="line"><span style="color:#B392F0;">Volume:</span><span style="color:#E1E4E8;">        </span><span style="color:#9ECBFF;">pvc-8ed67f7d-d829-4d87-8c66-d8a85f50772f</span></span>
<span class="line"><span style="color:#B392F0;">Labels:</span><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">non</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span></span>
<span class="line"><span style="color:#B392F0;">Annotations:</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">pv.kubernetes.io/bind-completed:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">yes</span></span>
<span class="line"><span style="color:#E1E4E8;">               </span><span style="color:#B392F0;">pv.kubernetes.io/bound-by-controller:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">yes</span></span>
<span class="line"><span style="color:#E1E4E8;">               </span><span style="color:#B392F0;">volume.beta.kubernetes.io/storage-provisioner:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">k8s-sigs.io/nfs-subdir-external-provisioner</span></span>
<span class="line"><span style="color:#B392F0;">Finalizers:</span><span style="color:#E1E4E8;">    [kubernetes.io/pvc-protection]</span></span>
<span class="line"><span style="color:#B392F0;">Capacity:</span><span style="color:#E1E4E8;">      </span><span style="color:#79B8FF;">512</span><span style="color:#9ECBFF;">Mi</span><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">定义的存储大小</span></span>
<span class="line"><span style="color:#B392F0;">Access</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Modes:</span><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">RWX</span><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">卷的读写</span></span>
<span class="line"><span style="color:#B392F0;">VolumeMode:</span><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">Filesystem</span></span>
<span class="line"><span style="color:#B392F0;">Used</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">By:</span><span style="color:#E1E4E8;">       </span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">non</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span></span>
<span class="line"><span style="color:#B392F0;">Events:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">Type</span><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">Reason</span><span style="color:#E1E4E8;">                 </span><span style="color:#9ECBFF;">Age</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">From</span><span style="color:#E1E4E8;">                                                                                                                      </span><span style="color:#9ECBFF;">Message</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">----</span><span style="color:#E1E4E8;">    </span><span style="color:#79B8FF;">------</span><span style="color:#E1E4E8;">                 </span><span style="color:#79B8FF;">----</span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">----</span><span style="color:#E1E4E8;">                                                                                                                      </span><span style="color:#79B8FF;">-------</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">Normal</span><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">ExternalProvisioning</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">13</span><span style="color:#9ECBFF;">m</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">persistentvolume-controller</span><span style="color:#E1E4E8;">                                                                                               </span><span style="color:#9ECBFF;">waiting</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">for</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">a</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">volume</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">to</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">be</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">created,</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">either</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">by</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">external</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">provisioner</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;k8s-sigs.io/nfs-subdir-external-provisioner&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">or</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">manually</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">created</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">by</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">system</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">administrator</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">Normal</span><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">Provisioning</span><span style="color:#E1E4E8;">           </span><span style="color:#79B8FF;">13</span><span style="color:#9ECBFF;">m</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">k8s-sigs.io/nfs-subdir-external-provisioner_nfs-client-provisioner-57d6d9d5f6-dcxgq_259532a3-4dba-4183-be6d-8e8b320fc778</span><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">External</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">provisioner</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">is</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">provisioning</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">volume</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">for</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">claim</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;default/nfs-pvc-test&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">Normal</span><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">ProvisioningSucceeded</span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">13</span><span style="color:#9ECBFF;">m</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">k8s-sigs.io/nfs-subdir-external-provisioner_nfs-client-provisioner-57d6d9d5f6-dcxgq_259532a3-4dba-4183-be6d-8e8b320fc778</span><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">Successfully</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">provisioned</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">volume</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pvc-8ed67f7d-d829-4d87-8c66-d8a85f50772f</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">这里的PV的名字是随机的，数据的存储路径是根据pathPattern来定义的。</span></span>
<span class="line"><span style="color:#24292E;">[root@Rocky nfs-pvc-test]# pwd</span></span>
<span class="line"><span style="color:#6F42C1;">/data/nfs/pv01/default/nfs-pvc-test</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">[root@kube-master nfs]# kubectl get pv</span></span>
<span class="line"><span style="color:#6F42C1;">pvc-8ed67f7d-d829-4d87-8c66-d8a85f50772f</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">512</span><span style="color:#032F62;">Mi</span><span style="color:#24292E;">      </span><span style="color:#032F62;">RWX</span><span style="color:#24292E;">            </span><span style="color:#032F62;">Delete</span><span style="color:#24292E;">           </span><span style="color:#032F62;">Bound</span><span style="color:#24292E;">         </span><span style="color:#032F62;">default/nfs-pvc-test</span><span style="color:#24292E;">   </span><span style="color:#032F62;">nfs-provisioner-storage</span><span style="color:#24292E;">            </span><span style="color:#005CC5;">5</span><span style="color:#032F62;">m19s</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">[root@kube-master nfs]# kubectl describe pv pvc-8ed67f7d-d829-4d87-8c66-d8a85f50772f</span></span>
<span class="line"><span style="color:#6F42C1;">Name:</span><span style="color:#24292E;">            </span><span style="color:#032F62;">pvc-8ed67f7d-d829-4d87-8c66-d8a85f50772f</span></span>
<span class="line"><span style="color:#6F42C1;">Labels:</span><span style="color:#24292E;">          </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">non</span><span style="color:#24292E;">e</span><span style="color:#D73A49;">&gt;</span></span>
<span class="line"><span style="color:#6F42C1;">Annotations:</span><span style="color:#24292E;">     </span><span style="color:#032F62;">pv.kubernetes.io/provisioned-by:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">k8s-sigs.io/nfs-subdir-external-provisioner</span></span>
<span class="line"><span style="color:#6F42C1;">Finalizers:</span><span style="color:#24292E;">      [kubernetes.io/pv-protection]</span></span>
<span class="line"><span style="color:#6F42C1;">StorageClass:</span><span style="color:#24292E;">    </span><span style="color:#032F62;">nfs-provisioner-storage</span></span>
<span class="line"><span style="color:#6F42C1;">Status:</span><span style="color:#24292E;">          </span><span style="color:#032F62;">Bound</span></span>
<span class="line"><span style="color:#6F42C1;">Claim:</span><span style="color:#24292E;">           </span><span style="color:#032F62;">default/nfs-pvc-test</span></span>
<span class="line"><span style="color:#6F42C1;">Reclaim</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Policy:</span><span style="color:#24292E;">  </span><span style="color:#032F62;">Delete</span></span>
<span class="line"><span style="color:#6F42C1;">Access</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Modes:</span><span style="color:#24292E;">    </span><span style="color:#032F62;">RWX</span></span>
<span class="line"><span style="color:#6F42C1;">VolumeMode:</span><span style="color:#24292E;">      </span><span style="color:#032F62;">Filesystem</span></span>
<span class="line"><span style="color:#6F42C1;">Capacity:</span><span style="color:#24292E;">        </span><span style="color:#005CC5;">512</span><span style="color:#032F62;">Mi</span></span>
<span class="line"><span style="color:#6F42C1;">Node</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Affinity:</span><span style="color:#24292E;">   </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">non</span><span style="color:#24292E;">e</span><span style="color:#D73A49;">&gt;</span></span>
<span class="line"><span style="color:#6F42C1;">Message:</span><span style="color:#24292E;">         </span></span>
<span class="line"><span style="color:#6F42C1;">Source:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">Type:</span><span style="color:#24292E;">      </span><span style="color:#032F62;">NFS</span><span style="color:#24292E;"> (an </span><span style="color:#032F62;">NFS</span><span style="color:#24292E;"> </span><span style="color:#032F62;">mount</span><span style="color:#24292E;"> </span><span style="color:#032F62;">that</span><span style="color:#24292E;"> </span><span style="color:#032F62;">lasts</span><span style="color:#24292E;"> </span><span style="color:#032F62;">the</span><span style="color:#24292E;"> </span><span style="color:#032F62;">lifetime</span><span style="color:#24292E;"> </span><span style="color:#032F62;">of</span><span style="color:#24292E;"> </span><span style="color:#032F62;">a</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pod</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">Server:</span><span style="color:#24292E;">    </span><span style="color:#005CC5;">10.103</span><span style="color:#032F62;">.236.199</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">Path:</span><span style="color:#24292E;">      </span><span style="color:#032F62;">/data/nfs/pv01/default/nfs-pvc-test</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">ReadOnly:</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">false</span></span>
<span class="line"><span style="color:#6F42C1;">Events:</span><span style="color:#24292E;">        </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">non</span><span style="color:#24292E;">e</span><span style="color:#D73A49;">&gt;</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">describe可用看到更详细的信息</span></span>
<span class="line"><span style="color:#24292E;">[root@kube-master nfs]# kubectl describe pvc </span></span>
<span class="line"><span style="color:#6F42C1;">Name:</span><span style="color:#24292E;">          </span><span style="color:#032F62;">nfs-pvc-test</span></span>
<span class="line"><span style="color:#6F42C1;">Namespace:</span><span style="color:#24292E;">     </span><span style="color:#032F62;">default</span></span>
<span class="line"><span style="color:#6F42C1;">StorageClass:</span><span style="color:#24292E;">  </span><span style="color:#032F62;">nfs-provisioner-storage</span></span>
<span class="line"><span style="color:#6F42C1;">Status:</span><span style="color:#24292E;">        </span><span style="color:#032F62;">Bound</span></span>
<span class="line"><span style="color:#6F42C1;">Volume:</span><span style="color:#24292E;">        </span><span style="color:#032F62;">pvc-8ed67f7d-d829-4d87-8c66-d8a85f50772f</span></span>
<span class="line"><span style="color:#6F42C1;">Labels:</span><span style="color:#24292E;">        </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">non</span><span style="color:#24292E;">e</span><span style="color:#D73A49;">&gt;</span></span>
<span class="line"><span style="color:#6F42C1;">Annotations:</span><span style="color:#24292E;">   </span><span style="color:#032F62;">pv.kubernetes.io/bind-completed:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">yes</span></span>
<span class="line"><span style="color:#24292E;">               </span><span style="color:#6F42C1;">pv.kubernetes.io/bound-by-controller:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">yes</span></span>
<span class="line"><span style="color:#24292E;">               </span><span style="color:#6F42C1;">volume.beta.kubernetes.io/storage-provisioner:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">k8s-sigs.io/nfs-subdir-external-provisioner</span></span>
<span class="line"><span style="color:#6F42C1;">Finalizers:</span><span style="color:#24292E;">    [kubernetes.io/pvc-protection]</span></span>
<span class="line"><span style="color:#6F42C1;">Capacity:</span><span style="color:#24292E;">      </span><span style="color:#005CC5;">512</span><span style="color:#032F62;">Mi</span><span style="color:#24292E;">    </span><span style="color:#032F62;">定义的存储大小</span></span>
<span class="line"><span style="color:#6F42C1;">Access</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Modes:</span><span style="color:#24292E;">  </span><span style="color:#032F62;">RWX</span><span style="color:#24292E;">    </span><span style="color:#032F62;">卷的读写</span></span>
<span class="line"><span style="color:#6F42C1;">VolumeMode:</span><span style="color:#24292E;">    </span><span style="color:#032F62;">Filesystem</span></span>
<span class="line"><span style="color:#6F42C1;">Used</span><span style="color:#24292E;"> </span><span style="color:#032F62;">By:</span><span style="color:#24292E;">       </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">non</span><span style="color:#24292E;">e</span><span style="color:#D73A49;">&gt;</span></span>
<span class="line"><span style="color:#6F42C1;">Events:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">Type</span><span style="color:#24292E;">    </span><span style="color:#032F62;">Reason</span><span style="color:#24292E;">                 </span><span style="color:#032F62;">Age</span><span style="color:#24292E;">   </span><span style="color:#032F62;">From</span><span style="color:#24292E;">                                                                                                                      </span><span style="color:#032F62;">Message</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">----</span><span style="color:#24292E;">    </span><span style="color:#005CC5;">------</span><span style="color:#24292E;">                 </span><span style="color:#005CC5;">----</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">----</span><span style="color:#24292E;">                                                                                                                      </span><span style="color:#005CC5;">-------</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">Normal</span><span style="color:#24292E;">  </span><span style="color:#032F62;">ExternalProvisioning</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">13</span><span style="color:#032F62;">m</span><span style="color:#24292E;">   </span><span style="color:#032F62;">persistentvolume-controller</span><span style="color:#24292E;">                                                                                               </span><span style="color:#032F62;">waiting</span><span style="color:#24292E;"> </span><span style="color:#032F62;">for</span><span style="color:#24292E;"> </span><span style="color:#032F62;">a</span><span style="color:#24292E;"> </span><span style="color:#032F62;">volume</span><span style="color:#24292E;"> </span><span style="color:#032F62;">to</span><span style="color:#24292E;"> </span><span style="color:#032F62;">be</span><span style="color:#24292E;"> </span><span style="color:#032F62;">created,</span><span style="color:#24292E;"> </span><span style="color:#032F62;">either</span><span style="color:#24292E;"> </span><span style="color:#032F62;">by</span><span style="color:#24292E;"> </span><span style="color:#032F62;">external</span><span style="color:#24292E;"> </span><span style="color:#032F62;">provisioner</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;k8s-sigs.io/nfs-subdir-external-provisioner&quot;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">or</span><span style="color:#24292E;"> </span><span style="color:#032F62;">manually</span><span style="color:#24292E;"> </span><span style="color:#032F62;">created</span><span style="color:#24292E;"> </span><span style="color:#032F62;">by</span><span style="color:#24292E;"> </span><span style="color:#032F62;">system</span><span style="color:#24292E;"> </span><span style="color:#032F62;">administrator</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">Normal</span><span style="color:#24292E;">  </span><span style="color:#032F62;">Provisioning</span><span style="color:#24292E;">           </span><span style="color:#005CC5;">13</span><span style="color:#032F62;">m</span><span style="color:#24292E;">   </span><span style="color:#032F62;">k8s-sigs.io/nfs-subdir-external-provisioner_nfs-client-provisioner-57d6d9d5f6-dcxgq_259532a3-4dba-4183-be6d-8e8b320fc778</span><span style="color:#24292E;">  </span><span style="color:#032F62;">External</span><span style="color:#24292E;"> </span><span style="color:#032F62;">provisioner</span><span style="color:#24292E;"> </span><span style="color:#032F62;">is</span><span style="color:#24292E;"> </span><span style="color:#032F62;">provisioning</span><span style="color:#24292E;"> </span><span style="color:#032F62;">volume</span><span style="color:#24292E;"> </span><span style="color:#032F62;">for</span><span style="color:#24292E;"> </span><span style="color:#032F62;">claim</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;default/nfs-pvc-test&quot;</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">Normal</span><span style="color:#24292E;">  </span><span style="color:#032F62;">ProvisioningSucceeded</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">13</span><span style="color:#032F62;">m</span><span style="color:#24292E;">   </span><span style="color:#032F62;">k8s-sigs.io/nfs-subdir-external-provisioner_nfs-client-provisioner-57d6d9d5f6-dcxgq_259532a3-4dba-4183-be6d-8e8b320fc778</span><span style="color:#24292E;">  </span><span style="color:#032F62;">Successfully</span><span style="color:#24292E;"> </span><span style="color:#032F62;">provisioned</span><span style="color:#24292E;"> </span><span style="color:#032F62;">volume</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pvc-8ed67f7d-d829-4d87-8c66-d8a85f50772f</span></span></code></pre></div><h2 id="_3-5-创建pod" tabindex="-1">3.5 创建Pod <a class="header-anchor" href="#_3-5-创建pod" aria-label="Permalink to &quot;3.5 创建Pod&quot;">​</a></h2><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">[</span><span style="color:#9ECBFF;">root@kube-master nfs</span><span style="color:#E1E4E8;">]# </span><span style="color:#9ECBFF;">cat 5.nginx-pvc-test.yaml</span></span>
<span class="line"><span style="color:#85E89D;">apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">v1</span></span>
<span class="line"><span style="color:#85E89D;">kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Pod</span></span>
<span class="line"><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">nginx-sc</span></span>
<span class="line"><span style="color:#85E89D;">spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">containers</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  - </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">nginx</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">image</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">nginx</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">volumeMounts</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    - </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">nginx-page</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">mountPath</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">/usr/share/nginx/html</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">volumes</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  - </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">nginx-page</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">persistentVolumeClaim</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">claimName</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">nfs-pvc-test</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">[</span><span style="color:#032F62;">root@kube-master nfs</span><span style="color:#24292E;">]# </span><span style="color:#032F62;">cat 5.nginx-pvc-test.yaml</span></span>
<span class="line"><span style="color:#22863A;">apiVersion</span><span style="color:#24292E;">: </span><span style="color:#032F62;">v1</span></span>
<span class="line"><span style="color:#22863A;">kind</span><span style="color:#24292E;">: </span><span style="color:#032F62;">Pod</span></span>
<span class="line"><span style="color:#22863A;">metadata</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">nginx-sc</span></span>
<span class="line"><span style="color:#22863A;">spec</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">containers</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">nginx</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">image</span><span style="color:#24292E;">: </span><span style="color:#032F62;">nginx</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">volumeMounts</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">nginx-page</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">mountPath</span><span style="color:#24292E;">: </span><span style="color:#032F62;">/usr/share/nginx/html</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">volumes</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">nginx-page</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">persistentVolumeClaim</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">claimName</span><span style="color:#24292E;">: </span><span style="color:#032F62;">nfs-pvc-test</span></span></code></pre></div><ul><li>查看</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">[root@kube-master nfs]# kubectl apply -f nginx-pvc-test.yaml </span></span>
<span class="line"><span style="color:#B392F0;">pod/nginx-sc</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">created</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">[root@kube-master nfs]# kubectl describe pvc</span></span>
<span class="line"><span style="color:#B392F0;">Name:</span><span style="color:#E1E4E8;">          </span><span style="color:#9ECBFF;">nfs-pvc-test</span></span>
<span class="line"><span style="color:#B392F0;">Namespace:</span><span style="color:#E1E4E8;">     </span><span style="color:#9ECBFF;">default</span></span>
<span class="line"><span style="color:#B392F0;">StorageClass:</span><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">nfs-provisioner-storage</span></span>
<span class="line"><span style="color:#B392F0;">Status:</span><span style="color:#E1E4E8;">        </span><span style="color:#9ECBFF;">Bound</span></span>
<span class="line"><span style="color:#B392F0;">Volume:</span><span style="color:#E1E4E8;">        </span><span style="color:#9ECBFF;">pvc-8ed67f7d-d829-4d87-8c66-d8a85f50772f</span></span>
<span class="line"><span style="color:#B392F0;">Labels:</span><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">non</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span></span>
<span class="line"><span style="color:#B392F0;">Annotations:</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">pv.kubernetes.io/bind-completed:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">yes</span></span>
<span class="line"><span style="color:#E1E4E8;">               </span><span style="color:#B392F0;">pv.kubernetes.io/bound-by-controller:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">yes</span></span>
<span class="line"><span style="color:#E1E4E8;">               </span><span style="color:#B392F0;">volume.beta.kubernetes.io/storage-provisioner:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">k8s-sigs.io/nfs-subdir-external-provisioner</span></span>
<span class="line"><span style="color:#B392F0;">Finalizers:</span><span style="color:#E1E4E8;">    [kubernetes.io/pvc-protection]</span></span>
<span class="line"><span style="color:#B392F0;">Capacity:</span><span style="color:#E1E4E8;">      </span><span style="color:#79B8FF;">512</span><span style="color:#9ECBFF;">Mi</span></span>
<span class="line"><span style="color:#B392F0;">Access</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Modes:</span><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">RWX</span></span>
<span class="line"><span style="color:#B392F0;">VolumeMode:</span><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">Filesystem</span></span>
<span class="line"><span style="color:#B392F0;">Used</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">By:</span><span style="color:#E1E4E8;">       </span><span style="color:#9ECBFF;">nginx-sc</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">可以看到的是nginx-sc这个Pod在使用这个PVC。</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">和上面名称是一致的。</span></span>
<span class="line"><span style="color:#E1E4E8;">[root@kube-master nfs]# kubectl get pods nginx-sc</span></span>
<span class="line"><span style="color:#B392F0;">NAME</span><span style="color:#E1E4E8;">       </span><span style="color:#9ECBFF;">READY</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">STATUS</span><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">RESTARTS</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">AGE</span></span>
<span class="line"><span style="color:#B392F0;">nginx-sc</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">1</span><span style="color:#9ECBFF;">/1</span><span style="color:#E1E4E8;">     </span><span style="color:#9ECBFF;">Running</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">          </span><span style="color:#79B8FF;">2</span><span style="color:#9ECBFF;">m43s</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">尝试写入数据</span></span>
<span class="line"><span style="color:#E1E4E8;">[root@Rocky </span><span style="color:#F97583;">~</span><span style="color:#E1E4E8;">]# echo </span><span style="color:#9ECBFF;">&quot;test nfs&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;"> /data/nfs/pv01/default/nfs-pvc-test/index.html</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">访问测试</span></span>
<span class="line"><span style="color:#E1E4E8;">[root@kube-master nfs-subdir-external-provisioner]# curl 172.30.0.155</span></span>
<span class="line"><span style="color:#79B8FF;">test</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">nfs</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">[root@kube-master nfs]# kubectl apply -f nginx-pvc-test.yaml </span></span>
<span class="line"><span style="color:#6F42C1;">pod/nginx-sc</span><span style="color:#24292E;"> </span><span style="color:#032F62;">created</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">[root@kube-master nfs]# kubectl describe pvc</span></span>
<span class="line"><span style="color:#6F42C1;">Name:</span><span style="color:#24292E;">          </span><span style="color:#032F62;">nfs-pvc-test</span></span>
<span class="line"><span style="color:#6F42C1;">Namespace:</span><span style="color:#24292E;">     </span><span style="color:#032F62;">default</span></span>
<span class="line"><span style="color:#6F42C1;">StorageClass:</span><span style="color:#24292E;">  </span><span style="color:#032F62;">nfs-provisioner-storage</span></span>
<span class="line"><span style="color:#6F42C1;">Status:</span><span style="color:#24292E;">        </span><span style="color:#032F62;">Bound</span></span>
<span class="line"><span style="color:#6F42C1;">Volume:</span><span style="color:#24292E;">        </span><span style="color:#032F62;">pvc-8ed67f7d-d829-4d87-8c66-d8a85f50772f</span></span>
<span class="line"><span style="color:#6F42C1;">Labels:</span><span style="color:#24292E;">        </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">non</span><span style="color:#24292E;">e</span><span style="color:#D73A49;">&gt;</span></span>
<span class="line"><span style="color:#6F42C1;">Annotations:</span><span style="color:#24292E;">   </span><span style="color:#032F62;">pv.kubernetes.io/bind-completed:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">yes</span></span>
<span class="line"><span style="color:#24292E;">               </span><span style="color:#6F42C1;">pv.kubernetes.io/bound-by-controller:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">yes</span></span>
<span class="line"><span style="color:#24292E;">               </span><span style="color:#6F42C1;">volume.beta.kubernetes.io/storage-provisioner:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">k8s-sigs.io/nfs-subdir-external-provisioner</span></span>
<span class="line"><span style="color:#6F42C1;">Finalizers:</span><span style="color:#24292E;">    [kubernetes.io/pvc-protection]</span></span>
<span class="line"><span style="color:#6F42C1;">Capacity:</span><span style="color:#24292E;">      </span><span style="color:#005CC5;">512</span><span style="color:#032F62;">Mi</span></span>
<span class="line"><span style="color:#6F42C1;">Access</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Modes:</span><span style="color:#24292E;">  </span><span style="color:#032F62;">RWX</span></span>
<span class="line"><span style="color:#6F42C1;">VolumeMode:</span><span style="color:#24292E;">    </span><span style="color:#032F62;">Filesystem</span></span>
<span class="line"><span style="color:#6F42C1;">Used</span><span style="color:#24292E;"> </span><span style="color:#032F62;">By:</span><span style="color:#24292E;">       </span><span style="color:#032F62;">nginx-sc</span><span style="color:#24292E;">   </span><span style="color:#032F62;">可以看到的是nginx-sc这个Pod在使用这个PVC。</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">和上面名称是一致的。</span></span>
<span class="line"><span style="color:#24292E;">[root@kube-master nfs]# kubectl get pods nginx-sc</span></span>
<span class="line"><span style="color:#6F42C1;">NAME</span><span style="color:#24292E;">       </span><span style="color:#032F62;">READY</span><span style="color:#24292E;">   </span><span style="color:#032F62;">STATUS</span><span style="color:#24292E;">    </span><span style="color:#032F62;">RESTARTS</span><span style="color:#24292E;">   </span><span style="color:#032F62;">AGE</span></span>
<span class="line"><span style="color:#6F42C1;">nginx-sc</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">1</span><span style="color:#032F62;">/1</span><span style="color:#24292E;">     </span><span style="color:#032F62;">Running</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">          </span><span style="color:#005CC5;">2</span><span style="color:#032F62;">m43s</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">尝试写入数据</span></span>
<span class="line"><span style="color:#24292E;">[root@Rocky </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# echo </span><span style="color:#032F62;">&quot;test nfs&quot;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;"> /data/nfs/pv01/default/nfs-pvc-test/index.html</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">访问测试</span></span>
<span class="line"><span style="color:#24292E;">[root@kube-master nfs-subdir-external-provisioner]# curl 172.30.0.155</span></span>
<span class="line"><span style="color:#005CC5;">test</span><span style="color:#24292E;"> </span><span style="color:#032F62;">nfs</span></span></code></pre></div><h1 id="区别" tabindex="-1">区别 <a class="header-anchor" href="#区别" aria-label="Permalink to &quot;区别&quot;">​</a></h1><p>nfs-subdir-external-provisioner:</p><ul><li>不在需要在kube-apiserver配置selfLink</li><li>也不用操作改变默认 StorageClass</li></ul>`,72),e=[o];function t(c,r,E,y,i,F){return n(),a("div",null,e)}const d=s(p,[["render",t]]);export{C as __pageData,d as default};
