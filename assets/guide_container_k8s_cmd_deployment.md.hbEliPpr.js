import{_ as s,o as n,c as a,R as l}from"./chunks/framework.zUbWieqp.js";const C=JSON.parse('{"title":"1.Deployment场景实践","description":"","frontmatter":{},"headers":[],"relativePath":"guide/container/k8s/cmd/deployment.md","filePath":"guide/container/k8s/cmd/deployment.md","lastUpdated":1734344767000}'),p={name:"guide/container/k8s/cmd/deployment.md"},o=l(`<h1 id="_1-deployment场景实践" tabindex="-1">1.Deployment场景实践 <a class="header-anchor" href="#_1-deployment场景实践" aria-label="Permalink to &quot;1.Deployment场景实践&quot;">​</a></h1><p>场景说明：运⾏⼀个demoapp的应⽤，部署3个副本，然后通过service来实现负载均衡；</p><ul><li>创建 Deployment资源，部署三个副本</li><li>创建 Service资源，通过标签选择器选择对应的Pod，以实现负载均衡；</li><li>⽤ curl命令，或Chrome浏览器验证集群⾼可⽤；</li></ul><p><img src="https://nnaigos.oss-cn-hangzhou.aliyuncs.com/imgs/202404301510483.png" alt="image-20240430151005538"></p><h2 id="_1-1-创建" tabindex="-1">1.1 创建 <a class="header-anchor" href="#_1-1-创建" aria-label="Permalink to &quot;1.1 创建&quot;">​</a></h2><ul><li>创建yaml文件</li></ul><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">[</span><span style="color:#9ECBFF;">root@kube-master yaml</span><span style="color:#E1E4E8;">]# </span><span style="color:#9ECBFF;">cat test.yaml</span></span>
<span class="line"><span style="color:#85E89D;">apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">apps/v1</span></span>
<span class="line"><span style="color:#85E89D;">kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Deployment</span></span>
<span class="line"><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">demo-deployment</span></span>
<span class="line"><span style="color:#85E89D;">spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">replicas</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">3</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">selector</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">matchLabels</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">app</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">demo</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">template</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">labels</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">app</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">demo</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">containers</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      - </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">demo-container</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">image</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">registry.cn-zhangjiakou.aliyuncs.com/hsuing/demoapp:v1</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">ports</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">        - </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">http-server</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#85E89D;">containerPort</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">80</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">[</span><span style="color:#032F62;">root@kube-master yaml</span><span style="color:#24292E;">]# </span><span style="color:#032F62;">cat test.yaml</span></span>
<span class="line"><span style="color:#22863A;">apiVersion</span><span style="color:#24292E;">: </span><span style="color:#032F62;">apps/v1</span></span>
<span class="line"><span style="color:#22863A;">kind</span><span style="color:#24292E;">: </span><span style="color:#032F62;">Deployment</span></span>
<span class="line"><span style="color:#22863A;">metadata</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">demo-deployment</span></span>
<span class="line"><span style="color:#22863A;">spec</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">replicas</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">3</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">selector</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">matchLabels</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">app</span><span style="color:#24292E;">: </span><span style="color:#032F62;">demo</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">template</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">metadata</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">labels</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">app</span><span style="color:#24292E;">: </span><span style="color:#032F62;">demo</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">spec</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">containers</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">demo-container</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">image</span><span style="color:#24292E;">: </span><span style="color:#032F62;">registry.cn-zhangjiakou.aliyuncs.com/hsuing/demoapp:v1</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">ports</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">        - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">http-server</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#22863A;">containerPort</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">80</span></span></code></pre></div><ul><li>查看</li></ul><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">[root@kube-master yaml]# kubectl get pod</span></span>
<span class="line"><span style="color:#B392F0;">NAME</span><span style="color:#E1E4E8;">                               </span><span style="color:#9ECBFF;">READY</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">STATUS</span><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">RESTARTS</span><span style="color:#E1E4E8;">         </span><span style="color:#9ECBFF;">AGE</span></span>
<span class="line"><span style="color:#B392F0;">demo-deployment-6b9fc7dc7f-fnsb2</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">1</span><span style="color:#9ECBFF;">/1</span><span style="color:#E1E4E8;">     </span><span style="color:#9ECBFF;">Running</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">                </span><span style="color:#79B8FF;">8</span><span style="color:#9ECBFF;">s</span></span>
<span class="line"><span style="color:#B392F0;">demo-deployment-6b9fc7dc7f-r4j2l</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">1</span><span style="color:#9ECBFF;">/1</span><span style="color:#E1E4E8;">     </span><span style="color:#9ECBFF;">Running</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">                </span><span style="color:#79B8FF;">8</span><span style="color:#9ECBFF;">s</span></span>
<span class="line"><span style="color:#B392F0;">demo-deployment-6b9fc7dc7f-sqw7c</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">1</span><span style="color:#9ECBFF;">/1</span><span style="color:#E1E4E8;">     </span><span style="color:#9ECBFF;">Running</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">                </span><span style="color:#79B8FF;">8</span><span style="color:#9ECBFF;">s</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">[root@kube-master yaml]# kubectl get pod</span></span>
<span class="line"><span style="color:#6F42C1;">NAME</span><span style="color:#24292E;">                               </span><span style="color:#032F62;">READY</span><span style="color:#24292E;">   </span><span style="color:#032F62;">STATUS</span><span style="color:#24292E;">    </span><span style="color:#032F62;">RESTARTS</span><span style="color:#24292E;">         </span><span style="color:#032F62;">AGE</span></span>
<span class="line"><span style="color:#6F42C1;">demo-deployment-6b9fc7dc7f-fnsb2</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">1</span><span style="color:#032F62;">/1</span><span style="color:#24292E;">     </span><span style="color:#032F62;">Running</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">                </span><span style="color:#005CC5;">8</span><span style="color:#032F62;">s</span></span>
<span class="line"><span style="color:#6F42C1;">demo-deployment-6b9fc7dc7f-r4j2l</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">1</span><span style="color:#032F62;">/1</span><span style="color:#24292E;">     </span><span style="color:#032F62;">Running</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">                </span><span style="color:#005CC5;">8</span><span style="color:#032F62;">s</span></span>
<span class="line"><span style="color:#6F42C1;">demo-deployment-6b9fc7dc7f-sqw7c</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">1</span><span style="color:#032F62;">/1</span><span style="color:#24292E;">     </span><span style="color:#032F62;">Running</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">                </span><span style="color:#005CC5;">8</span><span style="color:#032F62;">s</span></span></code></pre></div><h2 id="_1-2-检查dp状态" tabindex="-1">1.2 检查dp状态 <a class="header-anchor" href="#_1-2-检查dp状态" aria-label="Permalink to &quot;1.2 检查dp状态&quot;">​</a></h2><h3 id="检查集群的-deployment" tabindex="-1">检查集群的 Deployment <a class="header-anchor" href="#检查集群的-deployment" aria-label="Permalink to &quot;检查集群的 Deployment&quot;">​</a></h3><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">[root@kube-master yaml]# kubectl get deployments.apps</span></span>
<span class="line"><span style="color:#B392F0;">NAME</span><span style="color:#E1E4E8;">              </span><span style="color:#9ECBFF;">READY</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">UP-TO-DATE</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">AVAILABLE</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">AGE</span></span>
<span class="line"><span style="color:#B392F0;">demo-deployment</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">3</span><span style="color:#9ECBFF;">/3</span><span style="color:#E1E4E8;">     </span><span style="color:#79B8FF;">3</span><span style="color:#E1E4E8;">            </span><span style="color:#79B8FF;">3</span><span style="color:#E1E4E8;">           </span><span style="color:#79B8FF;">79</span><span style="color:#9ECBFF;">s</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">[root@kube-master yaml]# kubectl get deployments.apps</span></span>
<span class="line"><span style="color:#6F42C1;">NAME</span><span style="color:#24292E;">              </span><span style="color:#032F62;">READY</span><span style="color:#24292E;">   </span><span style="color:#032F62;">UP-TO-DATE</span><span style="color:#24292E;">   </span><span style="color:#032F62;">AVAILABLE</span><span style="color:#24292E;">   </span><span style="color:#032F62;">AGE</span></span>
<span class="line"><span style="color:#6F42C1;">demo-deployment</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">3</span><span style="color:#032F62;">/3</span><span style="color:#24292E;">     </span><span style="color:#005CC5;">3</span><span style="color:#24292E;">            </span><span style="color:#005CC5;">3</span><span style="color:#24292E;">           </span><span style="color:#005CC5;">79</span><span style="color:#032F62;">s</span></span></code></pre></div><blockquote><p>每列参数含义</p><p>NAME 列出了集群中 Deployment 的名称</p><p>READY 显示应⽤程序的可⽤的“副本”数。显示的模式是“就绪个数/期望个数”</p><p>UP-TO-DATE 显示为了达到期望状态已经更新的副本数</p><p>AVAILABLE 显示应⽤可供⽤户使⽤的副本数</p><p>AGE 显示应⽤程序运⾏的时间</p></blockquote><div class="warning custom-block"><p class="custom-block-title">💡 说明</p><p>期望副本数是根据 .spec.replicas 字段设置 3</p></div><h3 id="检查集群的-replicaset" tabindex="-1">检查集群的 ReplicaSet <a class="header-anchor" href="#检查集群的-replicaset" aria-label="Permalink to &quot;检查集群的 ReplicaSet&quot;">​</a></h3><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">[root@kube-master yaml]# kubectl get rs</span></span>
<span class="line"><span style="color:#B392F0;">NAME</span><span style="color:#E1E4E8;">                         </span><span style="color:#9ECBFF;">DESIRED</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">CURRENT</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">READY</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">AGE</span></span>
<span class="line"><span style="color:#B392F0;">demo-deployment-6b9fc7dc7f</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">3</span><span style="color:#E1E4E8;">         </span><span style="color:#79B8FF;">3</span><span style="color:#E1E4E8;">         </span><span style="color:#79B8FF;">3</span><span style="color:#E1E4E8;">       </span><span style="color:#79B8FF;">6</span><span style="color:#9ECBFF;">m35s</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">[root@kube-master yaml]# kubectl get rs</span></span>
<span class="line"><span style="color:#6F42C1;">NAME</span><span style="color:#24292E;">                         </span><span style="color:#032F62;">DESIRED</span><span style="color:#24292E;">   </span><span style="color:#032F62;">CURRENT</span><span style="color:#24292E;">   </span><span style="color:#032F62;">READY</span><span style="color:#24292E;">   </span><span style="color:#032F62;">AGE</span></span>
<span class="line"><span style="color:#6F42C1;">demo-deployment-6b9fc7dc7f</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">3</span><span style="color:#24292E;">         </span><span style="color:#005CC5;">3</span><span style="color:#24292E;">         </span><span style="color:#005CC5;">3</span><span style="color:#24292E;">       </span><span style="color:#005CC5;">6</span><span style="color:#032F62;">m35s</span></span></code></pre></div><blockquote><p>NAME 列出名字空间中 ReplicaSet 的名称</p><p>DESIRED 显示应⽤的期望副本个数，即在创建 Deployment 时所定义的值。 此为期望状态</p><p>CURRENT 显示当前运⾏状态中的副本个数</p><p>READY 显示应⽤中有多少副本可以为⽤户提供服务；</p><p>AGE 显示应⽤已经运⾏的时间⻓度</p></blockquote><div class="danger custom-block"><p class="custom-block-title">❌ 注意</p><p>ReplicaSet 的名称被格式化为[Deployment名称]-[随机字符串]</p></div><ul><li>检查pod 是否为3个</li></ul><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">[root@kube-master yaml]# kubectl get pod</span></span>
<span class="line"><span style="color:#B392F0;">NAME</span><span style="color:#E1E4E8;">                               </span><span style="color:#9ECBFF;">READY</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">STATUS</span><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">RESTARTS</span><span style="color:#E1E4E8;">        </span><span style="color:#9ECBFF;">AGE</span></span>
<span class="line"><span style="color:#B392F0;">demo-deployment-6b9fc7dc7f-fnsb2</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">1</span><span style="color:#9ECBFF;">/1</span><span style="color:#E1E4E8;">     </span><span style="color:#9ECBFF;">Running</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">               </span><span style="color:#79B8FF;">11</span><span style="color:#9ECBFF;">m</span></span>
<span class="line"><span style="color:#B392F0;">demo-deployment-6b9fc7dc7f-r4j2l</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">1</span><span style="color:#9ECBFF;">/1</span><span style="color:#E1E4E8;">     </span><span style="color:#9ECBFF;">Running</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">               </span><span style="color:#79B8FF;">11</span><span style="color:#9ECBFF;">m</span></span>
<span class="line"><span style="color:#B392F0;">demo-deployment-6b9fc7dc7f-sqw7c</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">1</span><span style="color:#9ECBFF;">/1</span><span style="color:#E1E4E8;">     </span><span style="color:#9ECBFF;">Running</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">               </span><span style="color:#79B8FF;">11</span><span style="color:#9ECBFF;">m</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">[root@kube-master yaml]# kubectl get pod</span></span>
<span class="line"><span style="color:#6F42C1;">NAME</span><span style="color:#24292E;">                               </span><span style="color:#032F62;">READY</span><span style="color:#24292E;">   </span><span style="color:#032F62;">STATUS</span><span style="color:#24292E;">    </span><span style="color:#032F62;">RESTARTS</span><span style="color:#24292E;">        </span><span style="color:#032F62;">AGE</span></span>
<span class="line"><span style="color:#6F42C1;">demo-deployment-6b9fc7dc7f-fnsb2</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">1</span><span style="color:#032F62;">/1</span><span style="color:#24292E;">     </span><span style="color:#032F62;">Running</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">               </span><span style="color:#005CC5;">11</span><span style="color:#032F62;">m</span></span>
<span class="line"><span style="color:#6F42C1;">demo-deployment-6b9fc7dc7f-r4j2l</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">1</span><span style="color:#032F62;">/1</span><span style="color:#24292E;">     </span><span style="color:#032F62;">Running</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">               </span><span style="color:#005CC5;">11</span><span style="color:#032F62;">m</span></span>
<span class="line"><span style="color:#6F42C1;">demo-deployment-6b9fc7dc7f-sqw7c</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">1</span><span style="color:#032F62;">/1</span><span style="color:#24292E;">     </span><span style="color:#032F62;">Running</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">               </span><span style="color:#005CC5;">11</span><span style="color:#032F62;">m</span></span></code></pre></div><h2 id="_1-3-创建service" tabindex="-1">1.3 创建Service <a class="header-anchor" href="#_1-3-创建service" aria-label="Permalink to &quot;1.3 创建Service&quot;">​</a></h2><ul><li>创建yaml文件</li></ul><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">[</span><span style="color:#9ECBFF;">root@kube-master yaml</span><span style="color:#E1E4E8;">]# </span><span style="color:#9ECBFF;">cat test_svc.yaml</span></span>
<span class="line"><span style="color:#85E89D;">apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">v1</span></span>
<span class="line"><span style="color:#85E89D;">kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Service</span></span>
<span class="line"><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">demo-service</span></span>
<span class="line"><span style="color:#85E89D;">spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">selector</span><span style="color:#E1E4E8;">:				</span><span style="color:#6A737D;">#类似upstream</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">app</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">demo</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">ports</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  - </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">http</span><span style="color:#E1E4E8;">	</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">port</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">8080</span><span style="color:#E1E4E8;">			</span><span style="color:#6A737D;"># service对外提供的端⼝</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">targetPort</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">80</span><span style="color:#E1E4E8;">		</span><span style="color:#6A737D;"># Pod的端⼝</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">[</span><span style="color:#032F62;">root@kube-master yaml</span><span style="color:#24292E;">]# </span><span style="color:#032F62;">cat test_svc.yaml</span></span>
<span class="line"><span style="color:#22863A;">apiVersion</span><span style="color:#24292E;">: </span><span style="color:#032F62;">v1</span></span>
<span class="line"><span style="color:#22863A;">kind</span><span style="color:#24292E;">: </span><span style="color:#032F62;">Service</span></span>
<span class="line"><span style="color:#22863A;">metadata</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">demo-service</span></span>
<span class="line"><span style="color:#22863A;">spec</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">selector</span><span style="color:#24292E;">:				</span><span style="color:#6A737D;">#类似upstream</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">app</span><span style="color:#24292E;">: </span><span style="color:#032F62;">demo</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">ports</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">http</span><span style="color:#24292E;">	</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">port</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">8080</span><span style="color:#24292E;">			</span><span style="color:#6A737D;"># service对外提供的端⼝</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">targetPort</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">80</span><span style="color:#24292E;">		</span><span style="color:#6A737D;"># Pod的端⼝</span></span></code></pre></div><ul><li>生成</li></ul><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">[root@kube-master yaml]# kubectl apply  -f test_svc.yaml</span></span>
<span class="line"><span style="color:#B392F0;">service/demo-service</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">created</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">[root@kube-master yaml]# kubectl apply  -f test_svc.yaml</span></span>
<span class="line"><span style="color:#6F42C1;">service/demo-service</span><span style="color:#24292E;"> </span><span style="color:#032F62;">created</span></span></code></pre></div><ul><li>查看svc地址</li></ul><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">[root@kube-master yaml]# kubectl get svc -owide</span></span>
<span class="line"><span style="color:#B392F0;">NAME</span><span style="color:#E1E4E8;">           </span><span style="color:#9ECBFF;">TYPE</span><span style="color:#E1E4E8;">        </span><span style="color:#9ECBFF;">CLUSTER-IP</span><span style="color:#E1E4E8;">       </span><span style="color:#9ECBFF;">EXTERNAL-IP</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">PORT</span><span style="color:#E1E4E8;">(</span><span style="color:#B392F0;">S</span><span style="color:#E1E4E8;">)          </span><span style="color:#9ECBFF;">AGE</span><span style="color:#E1E4E8;">     </span><span style="color:#9ECBFF;">SELECTOR</span></span>
<span class="line"><span style="color:#B392F0;">demo-service</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">ClusterIP</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">192.168</span><span style="color:#9ECBFF;">.15.149</span><span style="color:#E1E4E8;">   </span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">non</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;">        </span><span style="color:#79B8FF;">8080</span><span style="color:#9ECBFF;">/TCP</span><span style="color:#E1E4E8;">         </span><span style="color:#79B8FF;">2</span><span style="color:#9ECBFF;">m11s</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">app=demo</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">[root@kube-master yaml]# kubectl get svc -owide</span></span>
<span class="line"><span style="color:#6F42C1;">NAME</span><span style="color:#24292E;">           </span><span style="color:#032F62;">TYPE</span><span style="color:#24292E;">        </span><span style="color:#032F62;">CLUSTER-IP</span><span style="color:#24292E;">       </span><span style="color:#032F62;">EXTERNAL-IP</span><span style="color:#24292E;">   </span><span style="color:#032F62;">PORT</span><span style="color:#24292E;">(</span><span style="color:#6F42C1;">S</span><span style="color:#24292E;">)          </span><span style="color:#032F62;">AGE</span><span style="color:#24292E;">     </span><span style="color:#032F62;">SELECTOR</span></span>
<span class="line"><span style="color:#6F42C1;">demo-service</span><span style="color:#24292E;">   </span><span style="color:#032F62;">ClusterIP</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">192.168</span><span style="color:#032F62;">.15.149</span><span style="color:#24292E;">   </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">non</span><span style="color:#24292E;">e</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;">        </span><span style="color:#005CC5;">8080</span><span style="color:#032F62;">/TCP</span><span style="color:#24292E;">         </span><span style="color:#005CC5;">2</span><span style="color:#032F62;">m11s</span><span style="color:#24292E;">   </span><span style="color:#032F62;">app=demo</span></span></code></pre></div><ul><li>验证集群的可用性</li></ul><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">[root@kube-master yaml]# curl 192.168.15.149:8080</span></span>
<span class="line"><span style="color:#B392F0;">hsuing</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">demoapp</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">v1.1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">!!</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">ClientIP:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">172.25</span><span style="color:#9ECBFF;">.244.192,</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">PodName:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">demo-deployment-bf8f88dbc-b5dmc,</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">PodIP:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">172.30</span><span style="color:#9ECBFF;">.0.142!</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">[root@kube-master yaml]# curl 192.168.15.149:8080</span></span>
<span class="line"><span style="color:#6F42C1;">hsuing</span><span style="color:#24292E;"> </span><span style="color:#032F62;">demoapp</span><span style="color:#24292E;"> </span><span style="color:#032F62;">v1.1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">!!</span><span style="color:#24292E;"> </span><span style="color:#032F62;">ClientIP:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">172.25</span><span style="color:#032F62;">.244.192,</span><span style="color:#24292E;"> </span><span style="color:#032F62;">PodName:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">demo-deployment-bf8f88dbc-b5dmc,</span><span style="color:#24292E;"> </span><span style="color:#032F62;">PodIP:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">172.30</span><span style="color:#032F62;">.0.142!</span></span></code></pre></div><h2 id="_1-4-水平伸缩" tabindex="-1">1.4 ⽔平伸缩 <a class="header-anchor" href="#_1-4-水平伸缩" aria-label="Permalink to &quot;1.4 ⽔平伸缩&quot;">​</a></h2><p>水平扩展/收缩的功能比较简单，修改replicas对应的副本数即可。比如将Pod 的副本调整到5个，那么Deployment所管理的ReplicaSet则会自动创建一个新的Pod出来，这样就实现水平扩展</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">scale</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">deployment</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">demo-deployment</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--replicas=4</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#或者通过edit方式修改</span></span>
<span class="line"><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">edit</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">deployments.apps</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">demo-deployment</span></span>
<span class="line"><span style="color:#E1E4E8;"> </span></span>
<span class="line"><span style="color:#6A737D;">#或者 通过patch</span></span>
<span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patch</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">deployments.apps</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">demo-deployment</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-p</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;{&quot;spec&quot;:{&quot;replicas&quot;:4}}&#39;</span></span>
<span class="line"><span style="color:#B392F0;">deployment.apps/demo-deployment</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patched</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">scale</span><span style="color:#24292E;"> </span><span style="color:#032F62;">deployment</span><span style="color:#24292E;"> </span><span style="color:#032F62;">demo-deployment</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--replicas=4</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#或者通过edit方式修改</span></span>
<span class="line"><span style="color:#24292E;"> </span><span style="color:#6F42C1;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">edit</span><span style="color:#24292E;"> </span><span style="color:#032F62;">deployments.apps</span><span style="color:#24292E;"> </span><span style="color:#032F62;">demo-deployment</span></span>
<span class="line"><span style="color:#24292E;"> </span></span>
<span class="line"><span style="color:#6A737D;">#或者 通过patch</span></span>
<span class="line"><span style="color:#6F42C1;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patch</span><span style="color:#24292E;"> </span><span style="color:#032F62;">deployments.apps</span><span style="color:#24292E;"> </span><span style="color:#032F62;">demo-deployment</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-p</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;{&quot;spec&quot;:{&quot;replicas&quot;:4}}&#39;</span></span>
<span class="line"><span style="color:#6F42C1;">deployment.apps/demo-deployment</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patched</span></span></code></pre></div><div class="warning custom-block"><p class="custom-block-title">💡 说明</p><p>在deployment 管理下，删除其中一个pod之后，dp回自动补齐副本数</p></div><h1 id="_2-deployment操作" tabindex="-1">2. Deployment操作 <a class="header-anchor" href="#_2-deployment操作" aria-label="Permalink to &quot;2. Deployment操作&quot;">​</a></h1><h2 id="_2-1-创建" tabindex="-1">2.1 创建 <a class="header-anchor" href="#_2-1-创建" aria-label="Permalink to &quot;2.1 创建&quot;">​</a></h2><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">#创建资源对象</span></span>
<span class="line"><span style="color:#6A737D;"># 根据yaml配置文件一次性创建service和rc</span></span>
<span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">create</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-f</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">my-service.yaml</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-f</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">my-rc.yaml</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 根据&lt;directory&gt;目录下所有.yaml、.yml、.json文件的定义进行创建操作</span></span>
<span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">create</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-f</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">director</span><span style="color:#E1E4E8;">y</span><span style="color:#F97583;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 使用命令行创建pod资源</span></span>
<span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">run</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">nginx</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--image=nginx:1.16</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--port=80</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--replicas=3</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">[root@kube-master </span><span style="color:#F97583;">~</span><span style="color:#E1E4E8;">]# kubectl create deployment deployapp --image=nginx:1.16 --replicas=3</span></span>
<span class="line"><span style="color:#B392F0;">deployment.apps/deployapp</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">created</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">#创建资源对象</span></span>
<span class="line"><span style="color:#6A737D;"># 根据yaml配置文件一次性创建service和rc</span></span>
<span class="line"><span style="color:#6F42C1;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">create</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-f</span><span style="color:#24292E;"> </span><span style="color:#032F62;">my-service.yaml</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-f</span><span style="color:#24292E;"> </span><span style="color:#032F62;">my-rc.yaml</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 根据&lt;directory&gt;目录下所有.yaml、.yml、.json文件的定义进行创建操作</span></span>
<span class="line"><span style="color:#6F42C1;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">create</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-f</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">director</span><span style="color:#24292E;">y</span><span style="color:#D73A49;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 使用命令行创建pod资源</span></span>
<span class="line"><span style="color:#6F42C1;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">run</span><span style="color:#24292E;"> </span><span style="color:#032F62;">nginx</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--image=nginx:1.16</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--port=80</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--replicas=3</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">[root@kube-master </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# kubectl create deployment deployapp --image=nginx:1.16 --replicas=3</span></span>
<span class="line"><span style="color:#6F42C1;">deployment.apps/deployapp</span><span style="color:#24292E;"> </span><span style="color:#032F62;">created</span></span></code></pre></div><h2 id="_2-2-查看" tabindex="-1">2.2 查看 <a class="header-anchor" href="#_2-2-查看" aria-label="Permalink to &quot;2.2 查看&quot;">​</a></h2><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">[root@kube-master </span><span style="color:#F97583;">~</span><span style="color:#E1E4E8;">]# kubectl get pod</span></span>
<span class="line"><span style="color:#B392F0;">NAME</span><span style="color:#E1E4E8;">                         </span><span style="color:#9ECBFF;">READY</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">STATUS</span><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">RESTARTS</span><span style="color:#E1E4E8;">      </span><span style="color:#9ECBFF;">AGE</span></span>
<span class="line"><span style="color:#B392F0;">deployapp-7749464894-grrds</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">1</span><span style="color:#9ECBFF;">/1</span><span style="color:#E1E4E8;">     </span><span style="color:#9ECBFF;">Running</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">             </span><span style="color:#79B8FF;">3</span><span style="color:#9ECBFF;">m1s</span></span>
<span class="line"><span style="color:#B392F0;">deployapp-7749464894-jb2xx</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">1</span><span style="color:#9ECBFF;">/1</span><span style="color:#E1E4E8;">     </span><span style="color:#9ECBFF;">Running</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">             </span><span style="color:#79B8FF;">3</span><span style="color:#9ECBFF;">m1s</span></span>
<span class="line"><span style="color:#B392F0;">deployapp-7749464894-nhq4w</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">1</span><span style="color:#9ECBFF;">/1</span><span style="color:#E1E4E8;">     </span><span style="color:#9ECBFF;">Running</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">             </span><span style="color:#79B8FF;">3</span><span style="color:#9ECBFF;">m1s</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#查看pod的ip</span></span>
<span class="line"><span style="color:#E1E4E8;">[root@kube-master </span><span style="color:#F97583;">~</span><span style="color:#E1E4E8;">]# kubectl get pod -owide</span></span>
<span class="line"><span style="color:#B392F0;">NAME</span><span style="color:#E1E4E8;">                         </span><span style="color:#9ECBFF;">READY</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">STATUS</span><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">RESTARTS</span><span style="color:#E1E4E8;">      </span><span style="color:#9ECBFF;">AGE</span><span style="color:#E1E4E8;">     </span><span style="color:#9ECBFF;">IP</span><span style="color:#E1E4E8;">              </span><span style="color:#9ECBFF;">NODE</span><span style="color:#E1E4E8;">          </span><span style="color:#9ECBFF;">NOMINATED</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">NODE</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">READINESS</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">GATES</span></span>
<span class="line"><span style="color:#B392F0;">deployapp-7749464894-grrds</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">1</span><span style="color:#9ECBFF;">/1</span><span style="color:#E1E4E8;">     </span><span style="color:#9ECBFF;">Running</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">             </span><span style="color:#79B8FF;">3</span><span style="color:#9ECBFF;">m8s</span><span style="color:#E1E4E8;">    </span><span style="color:#79B8FF;">172.17</span><span style="color:#9ECBFF;">.74.70</span><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">kube-node03</span><span style="color:#E1E4E8;">   </span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">non</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;">           </span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">non</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span></span>
<span class="line"><span style="color:#B392F0;">deployapp-7749464894-jb2xx</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">1</span><span style="color:#9ECBFF;">/1</span><span style="color:#E1E4E8;">     </span><span style="color:#9ECBFF;">Running</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">             </span><span style="color:#79B8FF;">3</span><span style="color:#9ECBFF;">m8s</span><span style="color:#E1E4E8;">    </span><span style="color:#79B8FF;">172.30</span><span style="color:#9ECBFF;">.0.137</span><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">kube-node01</span><span style="color:#E1E4E8;">   </span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">non</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;">           </span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">non</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span></span>
<span class="line"><span style="color:#B392F0;">deployapp-7749464894-nhq4w</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">1</span><span style="color:#9ECBFF;">/1</span><span style="color:#E1E4E8;">     </span><span style="color:#9ECBFF;">Running</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">             </span><span style="color:#79B8FF;">3</span><span style="color:#9ECBFF;">m8s</span><span style="color:#E1E4E8;">    </span><span style="color:#79B8FF;">172.23</span><span style="color:#9ECBFF;">.127.68</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">kube-node02</span><span style="color:#E1E4E8;">   </span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">non</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;">           </span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">non</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">[root@kube-master </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# kubectl get pod</span></span>
<span class="line"><span style="color:#6F42C1;">NAME</span><span style="color:#24292E;">                         </span><span style="color:#032F62;">READY</span><span style="color:#24292E;">   </span><span style="color:#032F62;">STATUS</span><span style="color:#24292E;">    </span><span style="color:#032F62;">RESTARTS</span><span style="color:#24292E;">      </span><span style="color:#032F62;">AGE</span></span>
<span class="line"><span style="color:#6F42C1;">deployapp-7749464894-grrds</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">1</span><span style="color:#032F62;">/1</span><span style="color:#24292E;">     </span><span style="color:#032F62;">Running</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">             </span><span style="color:#005CC5;">3</span><span style="color:#032F62;">m1s</span></span>
<span class="line"><span style="color:#6F42C1;">deployapp-7749464894-jb2xx</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">1</span><span style="color:#032F62;">/1</span><span style="color:#24292E;">     </span><span style="color:#032F62;">Running</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">             </span><span style="color:#005CC5;">3</span><span style="color:#032F62;">m1s</span></span>
<span class="line"><span style="color:#6F42C1;">deployapp-7749464894-nhq4w</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">1</span><span style="color:#032F62;">/1</span><span style="color:#24292E;">     </span><span style="color:#032F62;">Running</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">             </span><span style="color:#005CC5;">3</span><span style="color:#032F62;">m1s</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#查看pod的ip</span></span>
<span class="line"><span style="color:#24292E;">[root@kube-master </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# kubectl get pod -owide</span></span>
<span class="line"><span style="color:#6F42C1;">NAME</span><span style="color:#24292E;">                         </span><span style="color:#032F62;">READY</span><span style="color:#24292E;">   </span><span style="color:#032F62;">STATUS</span><span style="color:#24292E;">    </span><span style="color:#032F62;">RESTARTS</span><span style="color:#24292E;">      </span><span style="color:#032F62;">AGE</span><span style="color:#24292E;">     </span><span style="color:#032F62;">IP</span><span style="color:#24292E;">              </span><span style="color:#032F62;">NODE</span><span style="color:#24292E;">          </span><span style="color:#032F62;">NOMINATED</span><span style="color:#24292E;"> </span><span style="color:#032F62;">NODE</span><span style="color:#24292E;">   </span><span style="color:#032F62;">READINESS</span><span style="color:#24292E;"> </span><span style="color:#032F62;">GATES</span></span>
<span class="line"><span style="color:#6F42C1;">deployapp-7749464894-grrds</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">1</span><span style="color:#032F62;">/1</span><span style="color:#24292E;">     </span><span style="color:#032F62;">Running</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">             </span><span style="color:#005CC5;">3</span><span style="color:#032F62;">m8s</span><span style="color:#24292E;">    </span><span style="color:#005CC5;">172.17</span><span style="color:#032F62;">.74.70</span><span style="color:#24292E;">    </span><span style="color:#032F62;">kube-node03</span><span style="color:#24292E;">   </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">non</span><span style="color:#24292E;">e</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;">           </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">non</span><span style="color:#24292E;">e</span><span style="color:#D73A49;">&gt;</span></span>
<span class="line"><span style="color:#6F42C1;">deployapp-7749464894-jb2xx</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">1</span><span style="color:#032F62;">/1</span><span style="color:#24292E;">     </span><span style="color:#032F62;">Running</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">             </span><span style="color:#005CC5;">3</span><span style="color:#032F62;">m8s</span><span style="color:#24292E;">    </span><span style="color:#005CC5;">172.30</span><span style="color:#032F62;">.0.137</span><span style="color:#24292E;">    </span><span style="color:#032F62;">kube-node01</span><span style="color:#24292E;">   </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">non</span><span style="color:#24292E;">e</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;">           </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">non</span><span style="color:#24292E;">e</span><span style="color:#D73A49;">&gt;</span></span>
<span class="line"><span style="color:#6F42C1;">deployapp-7749464894-nhq4w</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">1</span><span style="color:#032F62;">/1</span><span style="color:#24292E;">     </span><span style="color:#032F62;">Running</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">             </span><span style="color:#005CC5;">3</span><span style="color:#032F62;">m8s</span><span style="color:#24292E;">    </span><span style="color:#005CC5;">172.23</span><span style="color:#032F62;">.127.68</span><span style="color:#24292E;">   </span><span style="color:#032F62;">kube-node02</span><span style="color:#24292E;">   </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">non</span><span style="color:#24292E;">e</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;">           </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">non</span><span style="color:#24292E;">e</span><span style="color:#D73A49;">&gt;</span></span></code></pre></div><h2 id="_2-3-扩展pod副本" tabindex="-1">2.3 扩展Pod副本 <a class="header-anchor" href="#_2-3-扩展pod副本" aria-label="Permalink to &quot;2.3 扩展Pod副本&quot;">​</a></h2><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">#扩展，从3到5</span></span>
<span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">scale</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">deployment</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">deployapp</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--replicas=5</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#查看</span></span>
<span class="line"><span style="color:#E1E4E8;">[root@kube-master </span><span style="color:#F97583;">~</span><span style="color:#E1E4E8;">]# kubectl get pod</span></span>
<span class="line"><span style="color:#B392F0;">NAME</span><span style="color:#E1E4E8;">                         </span><span style="color:#9ECBFF;">READY</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">STATUS</span><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">RESTARTS</span><span style="color:#E1E4E8;">      </span><span style="color:#9ECBFF;">AGE</span></span>
<span class="line"><span style="color:#B392F0;">deployapp-7749464894-dkp72</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">1</span><span style="color:#9ECBFF;">/1</span><span style="color:#E1E4E8;">     </span><span style="color:#9ECBFF;">Running</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">             </span><span style="color:#79B8FF;">87</span><span style="color:#9ECBFF;">s</span></span>
<span class="line"><span style="color:#B392F0;">deployapp-7749464894-grrds</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">1</span><span style="color:#9ECBFF;">/1</span><span style="color:#E1E4E8;">     </span><span style="color:#9ECBFF;">Running</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">             </span><span style="color:#79B8FF;">6</span><span style="color:#9ECBFF;">m22s</span></span>
<span class="line"><span style="color:#B392F0;">deployapp-7749464894-jb2xx</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">1</span><span style="color:#9ECBFF;">/1</span><span style="color:#E1E4E8;">     </span><span style="color:#9ECBFF;">Running</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">             </span><span style="color:#79B8FF;">6</span><span style="color:#9ECBFF;">m22s</span></span>
<span class="line"><span style="color:#B392F0;">deployapp-7749464894-nhq4w</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">1</span><span style="color:#9ECBFF;">/1</span><span style="color:#E1E4E8;">     </span><span style="color:#9ECBFF;">Running</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">             </span><span style="color:#79B8FF;">6</span><span style="color:#9ECBFF;">m22s</span></span>
<span class="line"><span style="color:#B392F0;">deployapp-7749464894-wdbw9</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">1</span><span style="color:#9ECBFF;">/1</span><span style="color:#E1E4E8;">     </span><span style="color:#9ECBFF;">Running</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">             </span><span style="color:#79B8FF;">87</span><span style="color:#9ECBFF;">s</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">#扩展，从3到5</span></span>
<span class="line"><span style="color:#6F42C1;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">scale</span><span style="color:#24292E;"> </span><span style="color:#032F62;">deployment</span><span style="color:#24292E;"> </span><span style="color:#032F62;">deployapp</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--replicas=5</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#查看</span></span>
<span class="line"><span style="color:#24292E;">[root@kube-master </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# kubectl get pod</span></span>
<span class="line"><span style="color:#6F42C1;">NAME</span><span style="color:#24292E;">                         </span><span style="color:#032F62;">READY</span><span style="color:#24292E;">   </span><span style="color:#032F62;">STATUS</span><span style="color:#24292E;">    </span><span style="color:#032F62;">RESTARTS</span><span style="color:#24292E;">      </span><span style="color:#032F62;">AGE</span></span>
<span class="line"><span style="color:#6F42C1;">deployapp-7749464894-dkp72</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">1</span><span style="color:#032F62;">/1</span><span style="color:#24292E;">     </span><span style="color:#032F62;">Running</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">             </span><span style="color:#005CC5;">87</span><span style="color:#032F62;">s</span></span>
<span class="line"><span style="color:#6F42C1;">deployapp-7749464894-grrds</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">1</span><span style="color:#032F62;">/1</span><span style="color:#24292E;">     </span><span style="color:#032F62;">Running</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">             </span><span style="color:#005CC5;">6</span><span style="color:#032F62;">m22s</span></span>
<span class="line"><span style="color:#6F42C1;">deployapp-7749464894-jb2xx</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">1</span><span style="color:#032F62;">/1</span><span style="color:#24292E;">     </span><span style="color:#032F62;">Running</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">             </span><span style="color:#005CC5;">6</span><span style="color:#032F62;">m22s</span></span>
<span class="line"><span style="color:#6F42C1;">deployapp-7749464894-nhq4w</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">1</span><span style="color:#032F62;">/1</span><span style="color:#24292E;">     </span><span style="color:#032F62;">Running</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">             </span><span style="color:#005CC5;">6</span><span style="color:#032F62;">m22s</span></span>
<span class="line"><span style="color:#6F42C1;">deployapp-7749464894-wdbw9</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">1</span><span style="color:#032F62;">/1</span><span style="color:#24292E;">     </span><span style="color:#032F62;">Running</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">             </span><span style="color:#005CC5;">87</span><span style="color:#032F62;">s</span></span></code></pre></div><h2 id="_2-4-缩减pod副本" tabindex="-1">2.4 缩减Pod副本 <a class="header-anchor" href="#_2-4-缩减pod副本" aria-label="Permalink to &quot;2.4 缩减Pod副本&quot;">​</a></h2><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">scale</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">deployment</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">deployapp</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--replicas=3</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">scale</span><span style="color:#24292E;"> </span><span style="color:#032F62;">deployment</span><span style="color:#24292E;"> </span><span style="color:#032F62;">deployapp</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--replicas=3</span></span></code></pre></div><h2 id="_2-5-发布应用" tabindex="-1">2.5 发布应用 <a class="header-anchor" href="#_2-5-发布应用" aria-label="Permalink to &quot;2.5 发布应用&quot;">​</a></h2><p>通过Service将应用发布出来，而后集群中的应用就可以通过ServiceIP或域名来访问该复制均衡</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">--port:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">集群内访问service的端口</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">--target-port:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pod容器提供的端口</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">expose</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">deployment</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">deployapp</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--port=8888</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--target-port=80</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#查看service</span></span>
<span class="line"><span style="color:#E1E4E8;">[root@kube-master </span><span style="color:#F97583;">~</span><span style="color:#E1E4E8;">]# kubectl get svc</span></span>
<span class="line"><span style="color:#B392F0;">NAME</span><span style="color:#E1E4E8;">         </span><span style="color:#9ECBFF;">TYPE</span><span style="color:#E1E4E8;">        </span><span style="color:#9ECBFF;">CLUSTER-IP</span><span style="color:#E1E4E8;">        </span><span style="color:#9ECBFF;">EXTERNAL-IP</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">PORT</span><span style="color:#E1E4E8;">(</span><span style="color:#B392F0;">S</span><span style="color:#E1E4E8;">)          </span><span style="color:#9ECBFF;">AGE</span></span>
<span class="line"><span style="color:#B392F0;">deployapp</span><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">ClusterIP</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">192.168</span><span style="color:#9ECBFF;">.132.134</span><span style="color:#E1E4E8;">   </span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">non</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;">        </span><span style="color:#79B8FF;">8888</span><span style="color:#9ECBFF;">/TCP</span><span style="color:#E1E4E8;">         </span><span style="color:#79B8FF;">111</span><span style="color:#9ECBFF;">s</span></span>
<span class="line"><span style="color:#B392F0;">kubernetes</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">ClusterIP</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">192.168</span><span style="color:#9ECBFF;">.0.1</span><span style="color:#E1E4E8;">       </span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">non</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;">        </span><span style="color:#79B8FF;">443</span><span style="color:#9ECBFF;">/TCP</span><span style="color:#E1E4E8;">          </span><span style="color:#79B8FF;">29</span><span style="color:#9ECBFF;">h</span></span>
<span class="line"><span style="color:#B392F0;">nginx</span><span style="color:#E1E4E8;">        </span><span style="color:#9ECBFF;">NodePort</span><span style="color:#E1E4E8;">    </span><span style="color:#79B8FF;">192.168</span><span style="color:#9ECBFF;">.253.94</span><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">non</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;">        </span><span style="color:#79B8FF;">8080</span><span style="color:#9ECBFF;">:32498/TCP</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">6</span><span style="color:#9ECBFF;">h51m</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">--port:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">集群内访问service的端口</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">--target-port:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pod容器提供的端口</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">expose</span><span style="color:#24292E;"> </span><span style="color:#032F62;">deployment</span><span style="color:#24292E;"> </span><span style="color:#032F62;">deployapp</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--port=8888</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--target-port=80</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#查看service</span></span>
<span class="line"><span style="color:#24292E;">[root@kube-master </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# kubectl get svc</span></span>
<span class="line"><span style="color:#6F42C1;">NAME</span><span style="color:#24292E;">         </span><span style="color:#032F62;">TYPE</span><span style="color:#24292E;">        </span><span style="color:#032F62;">CLUSTER-IP</span><span style="color:#24292E;">        </span><span style="color:#032F62;">EXTERNAL-IP</span><span style="color:#24292E;">   </span><span style="color:#032F62;">PORT</span><span style="color:#24292E;">(</span><span style="color:#6F42C1;">S</span><span style="color:#24292E;">)          </span><span style="color:#032F62;">AGE</span></span>
<span class="line"><span style="color:#6F42C1;">deployapp</span><span style="color:#24292E;">    </span><span style="color:#032F62;">ClusterIP</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">192.168</span><span style="color:#032F62;">.132.134</span><span style="color:#24292E;">   </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">non</span><span style="color:#24292E;">e</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;">        </span><span style="color:#005CC5;">8888</span><span style="color:#032F62;">/TCP</span><span style="color:#24292E;">         </span><span style="color:#005CC5;">111</span><span style="color:#032F62;">s</span></span>
<span class="line"><span style="color:#6F42C1;">kubernetes</span><span style="color:#24292E;">   </span><span style="color:#032F62;">ClusterIP</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">192.168</span><span style="color:#032F62;">.0.1</span><span style="color:#24292E;">       </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">non</span><span style="color:#24292E;">e</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;">        </span><span style="color:#005CC5;">443</span><span style="color:#032F62;">/TCP</span><span style="color:#24292E;">          </span><span style="color:#005CC5;">29</span><span style="color:#032F62;">h</span></span>
<span class="line"><span style="color:#6F42C1;">nginx</span><span style="color:#24292E;">        </span><span style="color:#032F62;">NodePort</span><span style="color:#24292E;">    </span><span style="color:#005CC5;">192.168</span><span style="color:#032F62;">.253.94</span><span style="color:#24292E;">    </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">non</span><span style="color:#24292E;">e</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;">        </span><span style="color:#005CC5;">8080</span><span style="color:#032F62;">:32498/TCP</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">6</span><span style="color:#032F62;">h51m</span></span></code></pre></div><h2 id="_2-6-更新" tabindex="-1">2.6 更新 <a class="header-anchor" href="#_2-6-更新" aria-label="Permalink to &quot;2.6 更新&quot;">​</a></h2><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">set</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">image</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">deployment/deployapp</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">nginx=nginx:1.18</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">get</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pod</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">set</span><span style="color:#24292E;"> </span><span style="color:#032F62;">image</span><span style="color:#24292E;"> </span><span style="color:#032F62;">deployment/deployapp</span><span style="color:#24292E;"> </span><span style="color:#032F62;">nginx=nginx:1.18</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">get</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pod</span></span></code></pre></div><h2 id="_2-7-回滚" tabindex="-1">2.7 回滚 <a class="header-anchor" href="#_2-7-回滚" aria-label="Permalink to &quot;2.7 回滚&quot;">​</a></h2><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">查看版本信息</span></span>
<span class="line"><span style="color:#B392F0;">$</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">rollout</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">history</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">deployment</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">deployapp</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">查看更新状态：</span></span>
<span class="line"><span style="color:#B392F0;">$</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">rollout</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">status</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">deployment</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">deployapp</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">终止升级</span></span>
<span class="line"><span style="color:#B392F0;">$</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">rollout</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pause</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">deployment/deployapp</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">继续升级</span></span>
<span class="line"><span style="color:#B392F0;">$</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">rollout</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">resume</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">deployment/deployapp</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">回滚到上一个版本</span></span>
<span class="line"><span style="color:#B392F0;">$</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">rollout</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">undo</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">deployments</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">deployapp</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">回滚到指定版本</span></span>
<span class="line"><span style="color:#B392F0;">$</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">rollout</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">undo</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">deployments</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">deployapp</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--to-revision=1</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">查看版本信息</span></span>
<span class="line"><span style="color:#6F42C1;">$</span><span style="color:#24292E;"> </span><span style="color:#032F62;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">rollout</span><span style="color:#24292E;"> </span><span style="color:#032F62;">history</span><span style="color:#24292E;"> </span><span style="color:#032F62;">deployment</span><span style="color:#24292E;"> </span><span style="color:#032F62;">deployapp</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">查看更新状态：</span></span>
<span class="line"><span style="color:#6F42C1;">$</span><span style="color:#24292E;"> </span><span style="color:#032F62;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">rollout</span><span style="color:#24292E;"> </span><span style="color:#032F62;">status</span><span style="color:#24292E;"> </span><span style="color:#032F62;">deployment</span><span style="color:#24292E;"> </span><span style="color:#032F62;">deployapp</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">终止升级</span></span>
<span class="line"><span style="color:#6F42C1;">$</span><span style="color:#24292E;"> </span><span style="color:#032F62;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">rollout</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pause</span><span style="color:#24292E;"> </span><span style="color:#032F62;">deployment/deployapp</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">继续升级</span></span>
<span class="line"><span style="color:#6F42C1;">$</span><span style="color:#24292E;"> </span><span style="color:#032F62;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">rollout</span><span style="color:#24292E;"> </span><span style="color:#032F62;">resume</span><span style="color:#24292E;"> </span><span style="color:#032F62;">deployment/deployapp</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">回滚到上一个版本</span></span>
<span class="line"><span style="color:#6F42C1;">$</span><span style="color:#24292E;"> </span><span style="color:#032F62;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">rollout</span><span style="color:#24292E;"> </span><span style="color:#032F62;">undo</span><span style="color:#24292E;"> </span><span style="color:#032F62;">deployments</span><span style="color:#24292E;"> </span><span style="color:#032F62;">deployapp</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">回滚到指定版本</span></span>
<span class="line"><span style="color:#6F42C1;">$</span><span style="color:#24292E;"> </span><span style="color:#032F62;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">rollout</span><span style="color:#24292E;"> </span><span style="color:#032F62;">undo</span><span style="color:#24292E;"> </span><span style="color:#032F62;">deployments</span><span style="color:#24292E;"> </span><span style="color:#032F62;">deployapp</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--to-revision=1</span></span></code></pre></div><h1 id="_3-deployment升级过程" tabindex="-1">3. Deployment升级过程 <a class="header-anchor" href="#_3-deployment升级过程" aria-label="Permalink to &quot;3. Deployment升级过程&quot;">​</a></h1><p>以下是Deployment进行滚动升级的基本步骤：</p><ol><li><p>更新Deployment配置</p><ul><li>首先，你需要更新Deployment的yaml配置文件，例如更改镜像标签到新版本的应用程序镜像。</li></ul></li><li><p>提交变更</p><ul><li>应用这些更改，通过<code>kubectl apply</code>命令或API调用将新的配置应用到集群中。</li></ul></li><li><p>启动滚动更新</p><ul><li>Kubernetes Deployment控制器检测到配置变化后，会开始执行滚动更新策略。默认情况下，它采用滚动更新（RollingUpdate）策略。</li></ul></li><li><p>逐步替换Pod</p><ul><li><p>滚动更新策略会按照ReplicaSet中的Pod副本数量和指定的</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">.spec.strategy.rollingUpdate.maxUnavailable</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">.spec.strategy.rollingUpdate.maxUnavailable</span></span></code></pre></div><p>和</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">.spec.strategy.rollingUpdate.maxSurge</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">.spec.strategy.rollingUpdate.maxSurge</span></span></code></pre></div><p>参数来逐步创建新版本Pod，并同时删除旧版本Pod。</p><ul><li><code>maxUnavailable</code> 定义了可以有多少个Pod不可用（未就绪）而不会影响服务的整体可用性。</li><li><code>maxSurge</code> 则指定了可以比期望副本数多创建多少个Pod，以加速升级过程。</li></ul></li></ul></li><li><p>健康检查</p><ul><li>在每个新Pod被创建之后，Kubernetes会根据定义的livenessProbe和readinessProbe来检查新Pod是否已经启动并准备好接收流量。</li></ul></li><li><p>流量转移</p><ul><li>当新Pod通过健康检查并标记为“就绪”时，Service会逐渐将流量从旧Pod转移到新Pod。</li></ul></li><li><p>完成升级</p><ul><li>一旦所有旧Pod都被新Pod替换并且新版本的所有Pod都已准备就绪，则升级过程结束。</li></ul></li><li><p>回滚机制</p><ul><li>如果在升级过程中出现问题，可以通过回滚Deployment到之前的修订版来恢复到之前的工作状态。</li></ul></li><li><p>清理旧版本</p><ul><li>一旦验证新版本的应用程序正常工作，可以逐步删除旧版本的Pod副本，以释放资源。</li></ul></li></ol>`,52),e=[o];function t(c,r,y,E,F,i){return n(),a("div",null,e)}const B=s(p,[["render",t]]);export{C as __pageData,B as default};
