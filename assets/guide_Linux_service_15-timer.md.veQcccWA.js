import{_ as s,o as a,c as n,R as p}from"./chunks/framework.zUbWieqp.js";const m=JSON.parse('{"title":"1. systemd timer","description":"","frontmatter":{},"headers":[],"relativePath":"guide/Linux/service/15-timer.md","filePath":"guide/Linux/service/15-timer.md","lastUpdated":1759585023000}'),l={name:"guide/Linux/service/15-timer.md"},o=p(`<h1 id="_1-systemd-timer" tabindex="-1">1. systemd timer <a class="header-anchor" href="#_1-systemd-timer" aria-label="Permalink to &quot;1. systemd timer&quot;">​</a></h1><p><strong>AWS EC2 内核 5.16 (Amazon Linux 2023 / openEuler / CentOS Stream 之类的新系统)</strong> 上发现没有 <code>/etc/cron.d</code> 目录</p><p>Amazon Linux 2023 默认 <strong>不再内置 cron 守护进程 (crond)</strong>，推荐用 <strong>systemd timer</strong> 代替。</p><p>所以 <code>/etc/cron.d</code>、<code>/etc/cron.daily</code>、<code>/etc/cron.hourly</code> 等目录都可能不存在。</p><p>如果你还是想用传统 <code>cron</code>，需要手动安装。</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">sudo</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">dnf</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">install</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-y</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">cronie</span></span>
<span class="line"><span style="color:#B392F0;">sudo</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">systemctl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">enable</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--now</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">crond</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">sudo</span><span style="color:#24292E;"> </span><span style="color:#032F62;">dnf</span><span style="color:#24292E;"> </span><span style="color:#032F62;">install</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-y</span><span style="color:#24292E;"> </span><span style="color:#032F62;">cronie</span></span>
<span class="line"><span style="color:#6F42C1;">sudo</span><span style="color:#24292E;"> </span><span style="color:#032F62;">systemctl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">enable</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--now</span><span style="color:#24292E;"> </span><span style="color:#032F62;">crond</span></span></code></pre></div><h1 id="_2-案例" tabindex="-1">2. 案例 <a class="header-anchor" href="#_2-案例" aria-label="Permalink to &quot;2. 案例&quot;">​</a></h1><p>内核 5.16 的系统，推荐用 <code>systemd timer</code>，systemd timer 替代 cron</p><h2 id="_2-1-创建目录" tabindex="-1">2.1 创建目录 <a class="header-anchor" href="#_2-1-创建目录" aria-label="Permalink to &quot;2.1 创建目录&quot;">​</a></h2><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">mkdir</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-p</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/opt/myscripts</span></span>
<span class="line"><span style="color:#B392F0;">chmod</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">+x</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/opt/myscripts</span></span>
<span class="line"><span style="color:#B392F0;">chmod</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">+x</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/opt/myscripts/</span><span style="color:#79B8FF;">*</span><span style="color:#9ECBFF;">.sh</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">mkdir</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-p</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/opt/myscripts</span></span>
<span class="line"><span style="color:#6F42C1;">chmod</span><span style="color:#24292E;"> </span><span style="color:#032F62;">+x</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/opt/myscripts</span></span>
<span class="line"><span style="color:#6F42C1;">chmod</span><span style="color:#24292E;"> </span><span style="color:#032F62;">+x</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/opt/myscripts/</span><span style="color:#005CC5;">*</span><span style="color:#032F62;">.sh</span></span></code></pre></div><h2 id="_2-2-创建-systemd-service" tabindex="-1">2.2 创建 systemd service <a class="header-anchor" href="#_2-2-创建-systemd-service" aria-label="Permalink to &quot;2.2 创建 systemd service&quot;">​</a></h2><p>文件：<code>/etc/systemd/system/myscripts.service</code></p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">[Unit]</span></span>
<span class="line"><span style="color:#E1E4E8;">Description</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">Run</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">all</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">scripts</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">in</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/opt/myscripts</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">[Service]</span></span>
<span class="line"><span style="color:#E1E4E8;">Type</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">oneshot</span></span>
<span class="line"><span style="color:#E1E4E8;">ExecStart</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">/bin/bash</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">-c</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;/bin/run-parts /opt/myscripts &gt;&gt; /var/log/myscripts.log 2&gt;&amp;1&quot;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">[Unit]</span></span>
<span class="line"><span style="color:#24292E;">Description</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">Run</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">all</span><span style="color:#24292E;"> </span><span style="color:#032F62;">scripts</span><span style="color:#24292E;"> </span><span style="color:#032F62;">in</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/opt/myscripts</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">[Service]</span></span>
<span class="line"><span style="color:#24292E;">Type</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">oneshot</span></span>
<span class="line"><span style="color:#24292E;">ExecStart</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">/bin/bash</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">-c</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;/bin/run-parts /opt/myscripts &gt;&gt; /var/log/myscripts.log 2&gt;&amp;1&quot;</span></span></code></pre></div><h2 id="_2-3-创建-systemd-timer" tabindex="-1">2.3 创建 systemd timer <a class="header-anchor" href="#_2-3-创建-systemd-timer" aria-label="Permalink to &quot;2.3 创建 systemd timer&quot;">​</a></h2><p>文件：<code>/etc/systemd/system/myscripts.timer</code></p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">[Unit]</span></span>
<span class="line"><span style="color:#E1E4E8;">Description</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">Run</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">myscripts</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">every</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">minutes</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">[Timer]</span></span>
<span class="line"><span style="color:#E1E4E8;">OnCalendar</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">*</span><span style="color:#9ECBFF;">:0/5</span></span>
<span class="line"><span style="color:#E1E4E8;">Unit</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">myscripts.service</span></span>
<span class="line"><span style="color:#E1E4E8;">Persistent</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">true</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">[Install]</span></span>
<span class="line"><span style="color:#E1E4E8;">WantedBy</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">timers.target</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">[Unit]</span></span>
<span class="line"><span style="color:#24292E;">Description</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">Run</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">myscripts</span><span style="color:#24292E;"> </span><span style="color:#032F62;">every</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5</span><span style="color:#24292E;"> </span><span style="color:#032F62;">minutes</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">[Timer]</span></span>
<span class="line"><span style="color:#24292E;">OnCalendar</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">*</span><span style="color:#032F62;">:0/5</span></span>
<span class="line"><span style="color:#24292E;">Unit</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">myscripts.service</span></span>
<span class="line"><span style="color:#24292E;">Persistent</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">true</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">[Install]</span></span>
<span class="line"><span style="color:#24292E;">WantedBy</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">timers.target</span></span></code></pre></div><blockquote><p><code>Persistent=true</code> → 如果服务器宕机/重启错过任务，下次开机会立即补跑一次</p></blockquote><h2 id="_2-4-启用并启动" tabindex="-1">2.4 启用并启动 <a class="header-anchor" href="#_2-4-启用并启动" aria-label="Permalink to &quot;2.4 启用并启动&quot;">​</a></h2><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">systemctl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">daemon-reload</span></span>
<span class="line"><span style="color:#B392F0;">systemctl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">enable</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--now</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">myscripts.timer</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">systemctl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">daemon-reload</span></span>
<span class="line"><span style="color:#6F42C1;">systemctl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">enable</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--now</span><span style="color:#24292E;"> </span><span style="color:#032F62;">myscripts.timer</span></span></code></pre></div><h2 id="_2-5-检查状态" tabindex="-1">2.5 检查状态 <a class="header-anchor" href="#_2-5-检查状态" aria-label="Permalink to &quot;2.5 检查状态&quot;">​</a></h2><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">systemctl list-timers | grep myscripts</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">systemctl list-timers | grep myscripts</span></span></code></pre></div>`,21),e=[o];function t(c,r,i,y,E,d){return a(),n("div",null,e)}const h=s(l,[["render",t]]);export{m as __pageData,h as default};
