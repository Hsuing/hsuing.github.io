import{_ as s,o as n,c as a,R as l}from"./chunks/framework.zUbWieqp.js";const u=JSON.parse('{"title":"1. dash_board导出脚本","description":"","frontmatter":{},"headers":[],"relativePath":"guide/Linux/Monitor/Grafana/5-backup.md","filePath":"guide/Linux/Monitor/Grafana/5-backup.md","lastUpdated":1760705628000}'),p={name:"guide/Linux/Monitor/Grafana/5-backup.md"},o=l(`<h1 id="_1-dash-board导出脚本" tabindex="-1">1. dash_board导出脚本 <a class="header-anchor" href="#_1-dash-board导出脚本" aria-label="Permalink to &quot;1. dash_board导出脚本&quot;">​</a></h1><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">#/bin/bash</span></span>
<span class="line"><span style="color:#6A737D;">#</span></span>
<span class="line"><span style="color:#6A737D;"># add the &quot;-x&quot; option to the shebang line if you want a more verbose output</span></span>
<span class="line"><span style="color:#6A737D;">#</span></span>
<span class="line"><span style="color:#6A737D;"># set some colors for status OK, FAIL and titles</span></span>
<span class="line"><span style="color:#E1E4E8;">SETCOLOR_SUCCESS</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&quot;echo -en </span><span style="color:#79B8FF;">\\\\</span><span style="color:#9ECBFF;">033[0;32m&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">SETCOLOR_FAILURE</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&quot;echo -en </span><span style="color:#79B8FF;">\\\\</span><span style="color:#9ECBFF;">033[1;31m&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">SETCOLOR_NORMAL</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&quot;echo -en </span><span style="color:#79B8FF;">\\\\</span><span style="color:#9ECBFF;">033[0;39m&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">SETCOLOR_TITLE_PURPLE</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&quot;echo -en </span><span style="color:#79B8FF;">\\\\</span><span style="color:#9ECBFF;">033[0;35m&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># purple</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># usage log &quot;string to log&quot; &quot;color option&quot;</span></span>
<span class="line"><span style="color:#F97583;">function</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">log_success</span><span style="color:#E1E4E8;">() {</span></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> [ </span><span style="color:#79B8FF;">$#</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">-lt</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;"> ]; </span><span style="color:#F97583;">then</span></span>
<span class="line"><span style="color:#E1E4E8;">       \${SETCOLOR_FAILURE}</span></span>
<span class="line"><span style="color:#E1E4E8;">       </span><span style="color:#79B8FF;">echo</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;Not enough arguments for log function! Expecting 1 argument got </span><span style="color:#79B8FF;">$#</span><span style="color:#9ECBFF;">&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">       </span><span style="color:#79B8FF;">exit</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">1</span></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#F97583;">fi</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">   timestamp</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">$(</span><span style="color:#B392F0;">date</span><span style="color:#9ECBFF;"> &quot;+%Y-%m-%d %H:%M:%S %Z&quot;)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">   \${SETCOLOR_SUCCESS}</span></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">printf</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;[\${</span><span style="color:#E1E4E8;">timestamp</span><span style="color:#9ECBFF;">}] </span><span style="color:#79B8FF;">$1</span><span style="color:#9ECBFF;">\\n&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">   \${SETCOLOR_NORMAL}</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">function</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">log_failure</span><span style="color:#E1E4E8;">() {</span></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> [ </span><span style="color:#79B8FF;">$#</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">-lt</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;"> ]; </span><span style="color:#F97583;">then</span></span>
<span class="line"><span style="color:#E1E4E8;">       \${SETCOLOR_FAILURE}</span></span>
<span class="line"><span style="color:#E1E4E8;">       </span><span style="color:#79B8FF;">echo</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;Not enough arguments for log function! Expecting 1 argument got </span><span style="color:#79B8FF;">$#</span><span style="color:#9ECBFF;">&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">       </span><span style="color:#79B8FF;">exit</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">1</span></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#F97583;">fi</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">   timestamp</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">$(</span><span style="color:#B392F0;">date</span><span style="color:#9ECBFF;"> &quot;+%Y-%m-%d %H:%M:%S %Z&quot;)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">   \${SETCOLOR_FAILURE}</span></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">printf</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;[\${</span><span style="color:#E1E4E8;">timestamp</span><span style="color:#9ECBFF;">}] </span><span style="color:#79B8FF;">$1</span><span style="color:#9ECBFF;">\\n&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">   \${SETCOLOR_NORMAL}</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">function</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">log_title</span><span style="color:#E1E4E8;">() {</span></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> [ </span><span style="color:#79B8FF;">$#</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">-lt</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;"> ]; </span><span style="color:#F97583;">then</span></span>
<span class="line"><span style="color:#E1E4E8;">       \${SETCOLOR_FAILURE}</span></span>
<span class="line"><span style="color:#E1E4E8;">       </span><span style="color:#B392F0;">log_failure</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;Not enough arguments for log function! Expecting 1 argument got </span><span style="color:#79B8FF;">$#</span><span style="color:#9ECBFF;">&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">       </span><span style="color:#79B8FF;">exit</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">1</span></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#F97583;">fi</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">   \${SETCOLOR_TITLE_PURPLE}</span></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">printf</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;|-------------------------------------------------------------------------|\\n&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">printf</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;|</span><span style="color:#79B8FF;">$1</span><span style="color:#9ECBFF;">|\\n&quot;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">printf</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;|-------------------------------------------------------------------------|\\n&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">   \${SETCOLOR_NORMAL}</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">function</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">init</span><span style="color:#E1E4E8;">() {</span></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#6A737D;"># Check if hostname and key are provided</span></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> [ </span><span style="color:#FFAB70;">$1</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">-lt</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2</span><span style="color:#E1E4E8;"> ]; </span><span style="color:#F97583;">then</span></span>
<span class="line"><span style="color:#E1E4E8;">       \${SETCOLOR_FAILURE}</span></span>
<span class="line"><span style="color:#E1E4E8;">       </span><span style="color:#B392F0;">log_failure</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;Not enough command line arguments! Expecting two: </span><span style="color:#79B8FF;">\\$</span><span style="color:#9ECBFF;">HOSTNAME and </span><span style="color:#79B8FF;">\\$</span><span style="color:#9ECBFF;">KEY. Recieved only </span><span style="color:#79B8FF;">$1</span><span style="color:#9ECBFF;">.&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">       </span><span style="color:#79B8FF;">exit</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">1</span></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#F97583;">fi</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">   DASH_DIR</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">$(</span><span style="color:#79B8FF;">echo</span><span style="color:#9ECBFF;"> </span><span style="color:#E1E4E8;">$HOST</span><span style="color:#9ECBFF;"> </span><span style="color:#F97583;">|</span><span style="color:#9ECBFF;"> </span><span style="color:#B392F0;">awk</span><span style="color:#9ECBFF;"> </span><span style="color:#79B8FF;">-F[/:]</span><span style="color:#9ECBFF;"> &#39;{print $4}&#39;)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> [ </span><span style="color:#F97583;">!</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">-d</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;\${</span><span style="color:#E1E4E8;">DASH_DIR</span><span style="color:#9ECBFF;">}&quot;</span><span style="color:#E1E4E8;"> ]; </span><span style="color:#F97583;">then</span></span>
<span class="line"><span style="color:#E1E4E8;">   	 </span><span style="color:#B392F0;">mkdir</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;\${</span><span style="color:#E1E4E8;">DASH_DIR</span><span style="color:#9ECBFF;">}&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#F97583;">else</span></span>
<span class="line"><span style="color:#E1E4E8;">   	</span><span style="color:#B392F0;">log_title</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;----------------- A </span><span style="color:#E1E4E8;">$DASH_DIR</span><span style="color:#9ECBFF;"> directory already exists! -----------------&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#F97583;">fi</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">HOST</span><span style="color:#F97583;">=</span><span style="color:#FFAB70;">$1</span></span>
<span class="line"><span style="color:#E1E4E8;">KEY</span><span style="color:#F97583;">=</span><span style="color:#FFAB70;">$2</span></span>
<span class="line"><span style="color:#B392F0;">init</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">$#</span><span style="color:#E1E4E8;"> $HOST $KEY</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">counter</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">0</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">for</span><span style="color:#E1E4E8;"> dashboard_uid </span><span style="color:#F97583;">in</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">$(</span><span style="color:#B392F0;">curl</span><span style="color:#9ECBFF;"> </span><span style="color:#79B8FF;">-sS</span><span style="color:#9ECBFF;"> </span><span style="color:#79B8FF;">-H</span><span style="color:#9ECBFF;"> &quot;Authorization: Bearer </span><span style="color:#E1E4E8;">$KEY</span><span style="color:#9ECBFF;">&quot; </span><span style="color:#E1E4E8;">$HOST</span><span style="color:#9ECBFF;">/api/search</span><span style="color:#79B8FF;">\\?</span><span style="color:#9ECBFF;">query</span><span style="color:#79B8FF;">\\=\\&amp;</span><span style="color:#9ECBFF;"> </span><span style="color:#F97583;">|</span><span style="color:#9ECBFF;"> </span><span style="color:#B392F0;">jq</span><span style="color:#9ECBFF;"> </span><span style="color:#79B8FF;">-r</span><span style="color:#9ECBFF;"> &#39;.[] | select( .type | contains(&quot;dash-db&quot;)) | .uid&#39;)</span><span style="color:#E1E4E8;">; </span><span style="color:#F97583;">do</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">   counter</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">$((counter </span><span style="color:#F97583;">+</span><span style="color:#9ECBFF;"> </span><span style="color:#79B8FF;">1</span><span style="color:#9ECBFF;">))</span></span>
<span class="line"><span style="color:#E1E4E8;">   url</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">\`</span><span style="color:#79B8FF;">echo</span><span style="color:#9ECBFF;"> </span><span style="color:#E1E4E8;">$HOST</span><span style="color:#9ECBFF;">/api/dashboards/uid/</span><span style="color:#E1E4E8;">$dashboard_uid</span><span style="color:#9ECBFF;"> </span><span style="color:#F97583;">|</span><span style="color:#9ECBFF;"> </span><span style="color:#B392F0;">tr</span><span style="color:#9ECBFF;"> </span><span style="color:#79B8FF;">-d</span><span style="color:#9ECBFF;"> &#39;\\r&#39;\`</span></span>
<span class="line"><span style="color:#E1E4E8;">   dashboard_json</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">$(</span><span style="color:#B392F0;">curl</span><span style="color:#9ECBFF;"> </span><span style="color:#79B8FF;">-sS</span><span style="color:#9ECBFF;"> </span><span style="color:#79B8FF;">-H</span><span style="color:#9ECBFF;"> &quot;Authorization: Bearer </span><span style="color:#E1E4E8;">$KEY</span><span style="color:#9ECBFF;">&quot; </span><span style="color:#E1E4E8;">$url</span><span style="color:#9ECBFF;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">   dashboard_title</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">$(</span><span style="color:#79B8FF;">echo</span><span style="color:#9ECBFF;"> </span><span style="color:#E1E4E8;">$dashboard_json</span><span style="color:#9ECBFF;"> </span><span style="color:#F97583;">|</span><span style="color:#9ECBFF;"> </span><span style="color:#B392F0;">jq</span><span style="color:#9ECBFF;"> </span><span style="color:#79B8FF;">-r</span><span style="color:#9ECBFF;"> &#39;.dashboard | .title&#39; </span><span style="color:#F97583;">|</span><span style="color:#9ECBFF;"> </span><span style="color:#B392F0;">sed</span><span style="color:#9ECBFF;"> </span><span style="color:#79B8FF;">-r</span><span style="color:#9ECBFF;"> &#39;s/[ \\/]+/_/g&#39; )</span></span>
<span class="line"><span style="color:#E1E4E8;">   dashboard_version</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">$(</span><span style="color:#79B8FF;">echo</span><span style="color:#9ECBFF;"> </span><span style="color:#E1E4E8;">$dashboard_json</span><span style="color:#9ECBFF;"> </span><span style="color:#F97583;">|</span><span style="color:#9ECBFF;"> </span><span style="color:#B392F0;">jq</span><span style="color:#9ECBFF;"> </span><span style="color:#79B8FF;">-r</span><span style="color:#9ECBFF;"> &#39;.dashboard | .version&#39;)</span></span>
<span class="line"><span style="color:#E1E4E8;">   folder_title</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">$(</span><span style="color:#79B8FF;">echo</span><span style="color:#9ECBFF;"> </span><span style="color:#E1E4E8;">$dashboard_json</span><span style="color:#9ECBFF;"> </span><span style="color:#F97583;">|</span><span style="color:#9ECBFF;"> </span><span style="color:#B392F0;">jq</span><span style="color:#9ECBFF;"> </span><span style="color:#79B8FF;">-r</span><span style="color:#9ECBFF;"> &#39;.meta | .folderTitle&#39;)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#B392F0;">mkdir</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-p</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;</span><span style="color:#E1E4E8;">$DASH_DIR</span><span style="color:#9ECBFF;">/</span><span style="color:#E1E4E8;">$folder_title</span><span style="color:#9ECBFF;">&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">echo</span><span style="color:#E1E4E8;"> $dashboard_json </span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;</span><span style="color:#E1E4E8;">$DASH_DIR</span><span style="color:#9ECBFF;">/</span><span style="color:#E1E4E8;">$folder_title</span><span style="color:#9ECBFF;">/\${</span><span style="color:#E1E4E8;">dashboard_title</span><span style="color:#9ECBFF;">}_v\${</span><span style="color:#E1E4E8;">dashboard_version</span><span style="color:#9ECBFF;">}.json&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#B392F0;">log_success</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;Dashboard has been saved\\t\\t title=</span><span style="color:#79B8FF;">\\&quot;</span><span style="color:#9ECBFF;">\${</span><span style="color:#E1E4E8;">dashboard_title</span><span style="color:#9ECBFF;">}</span><span style="color:#79B8FF;">\\&quot;</span><span style="color:#9ECBFF;">, uid=</span><span style="color:#79B8FF;">\\&quot;</span><span style="color:#9ECBFF;">\${</span><span style="color:#E1E4E8;">dashboard_uid</span><span style="color:#9ECBFF;">}</span><span style="color:#79B8FF;">\\&quot;</span><span style="color:#9ECBFF;">, path=</span><span style="color:#79B8FF;">\\&quot;</span><span style="color:#9ECBFF;">\${</span><span style="color:#E1E4E8;">DASH_DIR</span><span style="color:#9ECBFF;">}/</span><span style="color:#E1E4E8;">$folder_title</span><span style="color:#9ECBFF;">/\${</span><span style="color:#E1E4E8;">dashboard_title</span><span style="color:#9ECBFF;">}_v\${</span><span style="color:#E1E4E8;">dashboard_version</span><span style="color:#9ECBFF;">}.json</span><span style="color:#79B8FF;">\\&quot;</span><span style="color:#9ECBFF;">.&quot;</span></span>
<span class="line"><span style="color:#F97583;">done</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">log_title</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;\${</span><span style="color:#E1E4E8;">counter</span><span style="color:#9ECBFF;">} dashboards were saved&quot;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">log_title</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;------------------------------ FINISHED ---------------------------------&quot;</span><span style="color:#E1E4E8;">;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">#/bin/bash</span></span>
<span class="line"><span style="color:#6A737D;">#</span></span>
<span class="line"><span style="color:#6A737D;"># add the &quot;-x&quot; option to the shebang line if you want a more verbose output</span></span>
<span class="line"><span style="color:#6A737D;">#</span></span>
<span class="line"><span style="color:#6A737D;"># set some colors for status OK, FAIL and titles</span></span>
<span class="line"><span style="color:#24292E;">SETCOLOR_SUCCESS</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&quot;echo -en </span><span style="color:#005CC5;">\\\\</span><span style="color:#032F62;">033[0;32m&quot;</span></span>
<span class="line"><span style="color:#24292E;">SETCOLOR_FAILURE</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&quot;echo -en </span><span style="color:#005CC5;">\\\\</span><span style="color:#032F62;">033[1;31m&quot;</span></span>
<span class="line"><span style="color:#24292E;">SETCOLOR_NORMAL</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&quot;echo -en </span><span style="color:#005CC5;">\\\\</span><span style="color:#032F62;">033[0;39m&quot;</span></span>
<span class="line"><span style="color:#24292E;">SETCOLOR_TITLE_PURPLE</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&quot;echo -en </span><span style="color:#005CC5;">\\\\</span><span style="color:#032F62;">033[0;35m&quot;</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># purple</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># usage log &quot;string to log&quot; &quot;color option&quot;</span></span>
<span class="line"><span style="color:#D73A49;">function</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">log_success</span><span style="color:#24292E;">() {</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> [ </span><span style="color:#005CC5;">$#</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">-lt</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1</span><span style="color:#24292E;"> ]; </span><span style="color:#D73A49;">then</span></span>
<span class="line"><span style="color:#24292E;">       \${SETCOLOR_FAILURE}</span></span>
<span class="line"><span style="color:#24292E;">       </span><span style="color:#005CC5;">echo</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;Not enough arguments for log function! Expecting 1 argument got </span><span style="color:#005CC5;">$#</span><span style="color:#032F62;">&quot;</span></span>
<span class="line"><span style="color:#24292E;">       </span><span style="color:#005CC5;">exit</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#D73A49;">fi</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">   timestamp</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">$(</span><span style="color:#6F42C1;">date</span><span style="color:#032F62;"> &quot;+%Y-%m-%d %H:%M:%S %Z&quot;)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">   \${SETCOLOR_SUCCESS}</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#005CC5;">printf</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;[\${</span><span style="color:#24292E;">timestamp</span><span style="color:#032F62;">}] </span><span style="color:#005CC5;">$1</span><span style="color:#032F62;">\\n&quot;</span></span>
<span class="line"><span style="color:#24292E;">   \${SETCOLOR_NORMAL}</span></span>
<span class="line"><span style="color:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">function</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">log_failure</span><span style="color:#24292E;">() {</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> [ </span><span style="color:#005CC5;">$#</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">-lt</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1</span><span style="color:#24292E;"> ]; </span><span style="color:#D73A49;">then</span></span>
<span class="line"><span style="color:#24292E;">       \${SETCOLOR_FAILURE}</span></span>
<span class="line"><span style="color:#24292E;">       </span><span style="color:#005CC5;">echo</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;Not enough arguments for log function! Expecting 1 argument got </span><span style="color:#005CC5;">$#</span><span style="color:#032F62;">&quot;</span></span>
<span class="line"><span style="color:#24292E;">       </span><span style="color:#005CC5;">exit</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#D73A49;">fi</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">   timestamp</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">$(</span><span style="color:#6F42C1;">date</span><span style="color:#032F62;"> &quot;+%Y-%m-%d %H:%M:%S %Z&quot;)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">   \${SETCOLOR_FAILURE}</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#005CC5;">printf</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;[\${</span><span style="color:#24292E;">timestamp</span><span style="color:#032F62;">}] </span><span style="color:#005CC5;">$1</span><span style="color:#032F62;">\\n&quot;</span></span>
<span class="line"><span style="color:#24292E;">   \${SETCOLOR_NORMAL}</span></span>
<span class="line"><span style="color:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">function</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">log_title</span><span style="color:#24292E;">() {</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> [ </span><span style="color:#005CC5;">$#</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">-lt</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1</span><span style="color:#24292E;"> ]; </span><span style="color:#D73A49;">then</span></span>
<span class="line"><span style="color:#24292E;">       \${SETCOLOR_FAILURE}</span></span>
<span class="line"><span style="color:#24292E;">       </span><span style="color:#6F42C1;">log_failure</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;Not enough arguments for log function! Expecting 1 argument got </span><span style="color:#005CC5;">$#</span><span style="color:#032F62;">&quot;</span></span>
<span class="line"><span style="color:#24292E;">       </span><span style="color:#005CC5;">exit</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#D73A49;">fi</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">   \${SETCOLOR_TITLE_PURPLE}</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#005CC5;">printf</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;|-------------------------------------------------------------------------|\\n&quot;</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#005CC5;">printf</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;|</span><span style="color:#005CC5;">$1</span><span style="color:#032F62;">|\\n&quot;</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#005CC5;">printf</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;|-------------------------------------------------------------------------|\\n&quot;</span></span>
<span class="line"><span style="color:#24292E;">   \${SETCOLOR_NORMAL}</span></span>
<span class="line"><span style="color:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">function</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">init</span><span style="color:#24292E;">() {</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#6A737D;"># Check if hostname and key are provided</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> [ </span><span style="color:#E36209;">$1</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">-lt</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2</span><span style="color:#24292E;"> ]; </span><span style="color:#D73A49;">then</span></span>
<span class="line"><span style="color:#24292E;">       \${SETCOLOR_FAILURE}</span></span>
<span class="line"><span style="color:#24292E;">       </span><span style="color:#6F42C1;">log_failure</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;Not enough command line arguments! Expecting two: </span><span style="color:#005CC5;">\\$</span><span style="color:#032F62;">HOSTNAME and </span><span style="color:#005CC5;">\\$</span><span style="color:#032F62;">KEY. Recieved only </span><span style="color:#005CC5;">$1</span><span style="color:#032F62;">.&quot;</span></span>
<span class="line"><span style="color:#24292E;">       </span><span style="color:#005CC5;">exit</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#D73A49;">fi</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">   DASH_DIR</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">$(</span><span style="color:#005CC5;">echo</span><span style="color:#032F62;"> </span><span style="color:#24292E;">$HOST</span><span style="color:#032F62;"> </span><span style="color:#D73A49;">|</span><span style="color:#032F62;"> </span><span style="color:#6F42C1;">awk</span><span style="color:#032F62;"> </span><span style="color:#005CC5;">-F[/:]</span><span style="color:#032F62;"> &#39;{print $4}&#39;)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> [ </span><span style="color:#D73A49;">!</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">-d</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;\${</span><span style="color:#24292E;">DASH_DIR</span><span style="color:#032F62;">}&quot;</span><span style="color:#24292E;"> ]; </span><span style="color:#D73A49;">then</span></span>
<span class="line"><span style="color:#24292E;">   	 </span><span style="color:#6F42C1;">mkdir</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;\${</span><span style="color:#24292E;">DASH_DIR</span><span style="color:#032F62;">}&quot;</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#D73A49;">else</span></span>
<span class="line"><span style="color:#24292E;">   	</span><span style="color:#6F42C1;">log_title</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;----------------- A </span><span style="color:#24292E;">$DASH_DIR</span><span style="color:#032F62;"> directory already exists! -----------------&quot;</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#D73A49;">fi</span></span>
<span class="line"><span style="color:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">HOST</span><span style="color:#D73A49;">=</span><span style="color:#E36209;">$1</span></span>
<span class="line"><span style="color:#24292E;">KEY</span><span style="color:#D73A49;">=</span><span style="color:#E36209;">$2</span></span>
<span class="line"><span style="color:#6F42C1;">init</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">$#</span><span style="color:#24292E;"> $HOST $KEY</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">counter</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">0</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">for</span><span style="color:#24292E;"> dashboard_uid </span><span style="color:#D73A49;">in</span><span style="color:#24292E;"> </span><span style="color:#032F62;">$(</span><span style="color:#6F42C1;">curl</span><span style="color:#032F62;"> </span><span style="color:#005CC5;">-sS</span><span style="color:#032F62;"> </span><span style="color:#005CC5;">-H</span><span style="color:#032F62;"> &quot;Authorization: Bearer </span><span style="color:#24292E;">$KEY</span><span style="color:#032F62;">&quot; </span><span style="color:#24292E;">$HOST</span><span style="color:#032F62;">/api/search</span><span style="color:#005CC5;">\\?</span><span style="color:#032F62;">query</span><span style="color:#005CC5;">\\=\\&amp;</span><span style="color:#032F62;"> </span><span style="color:#D73A49;">|</span><span style="color:#032F62;"> </span><span style="color:#6F42C1;">jq</span><span style="color:#032F62;"> </span><span style="color:#005CC5;">-r</span><span style="color:#032F62;"> &#39;.[] | select( .type | contains(&quot;dash-db&quot;)) | .uid&#39;)</span><span style="color:#24292E;">; </span><span style="color:#D73A49;">do</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">   counter</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">$((counter </span><span style="color:#D73A49;">+</span><span style="color:#032F62;"> </span><span style="color:#005CC5;">1</span><span style="color:#032F62;">))</span></span>
<span class="line"><span style="color:#24292E;">   url</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">\`</span><span style="color:#005CC5;">echo</span><span style="color:#032F62;"> </span><span style="color:#24292E;">$HOST</span><span style="color:#032F62;">/api/dashboards/uid/</span><span style="color:#24292E;">$dashboard_uid</span><span style="color:#032F62;"> </span><span style="color:#D73A49;">|</span><span style="color:#032F62;"> </span><span style="color:#6F42C1;">tr</span><span style="color:#032F62;"> </span><span style="color:#005CC5;">-d</span><span style="color:#032F62;"> &#39;\\r&#39;\`</span></span>
<span class="line"><span style="color:#24292E;">   dashboard_json</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">$(</span><span style="color:#6F42C1;">curl</span><span style="color:#032F62;"> </span><span style="color:#005CC5;">-sS</span><span style="color:#032F62;"> </span><span style="color:#005CC5;">-H</span><span style="color:#032F62;"> &quot;Authorization: Bearer </span><span style="color:#24292E;">$KEY</span><span style="color:#032F62;">&quot; </span><span style="color:#24292E;">$url</span><span style="color:#032F62;">)</span></span>
<span class="line"><span style="color:#24292E;">   dashboard_title</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">$(</span><span style="color:#005CC5;">echo</span><span style="color:#032F62;"> </span><span style="color:#24292E;">$dashboard_json</span><span style="color:#032F62;"> </span><span style="color:#D73A49;">|</span><span style="color:#032F62;"> </span><span style="color:#6F42C1;">jq</span><span style="color:#032F62;"> </span><span style="color:#005CC5;">-r</span><span style="color:#032F62;"> &#39;.dashboard | .title&#39; </span><span style="color:#D73A49;">|</span><span style="color:#032F62;"> </span><span style="color:#6F42C1;">sed</span><span style="color:#032F62;"> </span><span style="color:#005CC5;">-r</span><span style="color:#032F62;"> &#39;s/[ \\/]+/_/g&#39; )</span></span>
<span class="line"><span style="color:#24292E;">   dashboard_version</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">$(</span><span style="color:#005CC5;">echo</span><span style="color:#032F62;"> </span><span style="color:#24292E;">$dashboard_json</span><span style="color:#032F62;"> </span><span style="color:#D73A49;">|</span><span style="color:#032F62;"> </span><span style="color:#6F42C1;">jq</span><span style="color:#032F62;"> </span><span style="color:#005CC5;">-r</span><span style="color:#032F62;"> &#39;.dashboard | .version&#39;)</span></span>
<span class="line"><span style="color:#24292E;">   folder_title</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">$(</span><span style="color:#005CC5;">echo</span><span style="color:#032F62;"> </span><span style="color:#24292E;">$dashboard_json</span><span style="color:#032F62;"> </span><span style="color:#D73A49;">|</span><span style="color:#032F62;"> </span><span style="color:#6F42C1;">jq</span><span style="color:#032F62;"> </span><span style="color:#005CC5;">-r</span><span style="color:#032F62;"> &#39;.meta | .folderTitle&#39;)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#6F42C1;">mkdir</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-p</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;</span><span style="color:#24292E;">$DASH_DIR</span><span style="color:#032F62;">/</span><span style="color:#24292E;">$folder_title</span><span style="color:#032F62;">&quot;</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#005CC5;">echo</span><span style="color:#24292E;"> $dashboard_json </span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;</span><span style="color:#24292E;">$DASH_DIR</span><span style="color:#032F62;">/</span><span style="color:#24292E;">$folder_title</span><span style="color:#032F62;">/\${</span><span style="color:#24292E;">dashboard_title</span><span style="color:#032F62;">}_v\${</span><span style="color:#24292E;">dashboard_version</span><span style="color:#032F62;">}.json&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#6F42C1;">log_success</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;Dashboard has been saved\\t\\t title=</span><span style="color:#005CC5;">\\&quot;</span><span style="color:#032F62;">\${</span><span style="color:#24292E;">dashboard_title</span><span style="color:#032F62;">}</span><span style="color:#005CC5;">\\&quot;</span><span style="color:#032F62;">, uid=</span><span style="color:#005CC5;">\\&quot;</span><span style="color:#032F62;">\${</span><span style="color:#24292E;">dashboard_uid</span><span style="color:#032F62;">}</span><span style="color:#005CC5;">\\&quot;</span><span style="color:#032F62;">, path=</span><span style="color:#005CC5;">\\&quot;</span><span style="color:#032F62;">\${</span><span style="color:#24292E;">DASH_DIR</span><span style="color:#032F62;">}/</span><span style="color:#24292E;">$folder_title</span><span style="color:#032F62;">/\${</span><span style="color:#24292E;">dashboard_title</span><span style="color:#032F62;">}_v\${</span><span style="color:#24292E;">dashboard_version</span><span style="color:#032F62;">}.json</span><span style="color:#005CC5;">\\&quot;</span><span style="color:#032F62;">.&quot;</span></span>
<span class="line"><span style="color:#D73A49;">done</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">log_title</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;\${</span><span style="color:#24292E;">counter</span><span style="color:#032F62;">} dashboards were saved&quot;</span><span style="color:#24292E;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">log_title</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;------------------------------ FINISHED ---------------------------------&quot;</span><span style="color:#24292E;">;</span></span></code></pre></div><ul><li>执行</li></ul><p><img src="https://nnaigos.oss-cn-hangzhou.aliyuncs.com/imgs/20251015165721272.png" alt="image-20251015165718358"></p><h1 id="_2-dash-board导入脚本" tabindex="-1">2. dash_board导入脚本 <a class="header-anchor" href="#_2-dash-board导入脚本" aria-label="Permalink to &quot;2. dash_board导入脚本&quot;">​</a></h1><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">#!/bin/bash</span></span>
<span class="line"><span style="color:#6A737D;">#</span></span>
<span class="line"><span style="color:#6A737D;"># add the &quot;-x&quot; option to the shebang line if you want a more verbose output</span></span>
<span class="line"><span style="color:#6A737D;">#</span></span>
<span class="line"><span style="color:#6A737D;">#</span></span>
<span class="line"><span style="color:#E1E4E8;">OPTSPEC</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&quot;:hp:t:k:&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">show_help</span><span style="color:#E1E4E8;">() {</span></span>
<span class="line"><span style="color:#B392F0;">cat</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">&lt;&lt;</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">EOF</span></span>
<span class="line"><span style="color:#9ECBFF;">Usage: </span><span style="color:#79B8FF;">$0</span><span style="color:#9ECBFF;"> [-p PATH] [-t TARGET_HOST] [-k API_KEY]</span></span>
<span class="line"><span style="color:#9ECBFF;">Script to import dashboards into Grafana</span></span>
<span class="line"><span style="color:#9ECBFF;">    -p      Required. Root path containing JSON exports of the dashboards you want imported.</span></span>
<span class="line"><span style="color:#9ECBFF;">    -t      Required. The full URL of the target host</span></span>
<span class="line"><span style="color:#9ECBFF;">    -k      Required. The API key to use on the target host</span></span>
<span class="line"></span>
<span class="line"><span style="color:#9ECBFF;">    -h      Display this help and exit.</span></span>
<span class="line"><span style="color:#9ECBFF;">EOF</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">###### Check script invocation options ######</span></span>
<span class="line"><span style="color:#F97583;">while</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">getopts</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;</span><span style="color:#E1E4E8;">$OPTSPEC</span><span style="color:#9ECBFF;">&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">optchar</span><span style="color:#E1E4E8;">; </span><span style="color:#F97583;">do</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">case</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;</span><span style="color:#E1E4E8;">$optchar</span><span style="color:#9ECBFF;">&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">in</span></span>
<span class="line"><span style="color:#E1E4E8;">        h)</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#B392F0;">show_help</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#79B8FF;">exit</span></span>
<span class="line"><span style="color:#E1E4E8;">            ;;</span></span>
<span class="line"><span style="color:#E1E4E8;">        p)</span></span>
<span class="line"><span style="color:#E1E4E8;">            DASH_DIR</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&quot;</span><span style="color:#E1E4E8;">$OPTARG</span><span style="color:#9ECBFF;">&quot;</span><span style="color:#E1E4E8;">;;</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#B392F0;">t</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">            HOST</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&quot;</span><span style="color:#E1E4E8;">$OPTARG</span><span style="color:#9ECBFF;">&quot;</span><span style="color:#E1E4E8;">;;</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#B392F0;">k</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">            KEY</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&quot;</span><span style="color:#E1E4E8;">$OPTARG</span><span style="color:#9ECBFF;">&quot;</span><span style="color:#E1E4E8;">;;</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#B392F0;">\\?</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#79B8FF;">echo</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;Invalid option: -</span><span style="color:#E1E4E8;">$OPTARG</span><span style="color:#9ECBFF;">&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">&gt;&amp;2</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#79B8FF;">exit</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">1</span></span>
<span class="line"><span style="color:#E1E4E8;">          ;;</span></span>
<span class="line"><span style="color:#E1E4E8;">        :)</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#79B8FF;">echo</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;Option -</span><span style="color:#E1E4E8;">$OPTARG</span><span style="color:#9ECBFF;"> requires an argument.&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">&gt;&amp;2</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#79B8FF;">exit</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">1</span></span>
<span class="line"><span style="color:#E1E4E8;">          ;;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">esac</span></span>
<span class="line"><span style="color:#F97583;">done</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> [ </span><span style="color:#F97583;">-z</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;</span><span style="color:#E1E4E8;">$DASH_DIR</span><span style="color:#9ECBFF;">&quot;</span><span style="color:#E1E4E8;"> ] </span><span style="color:#F97583;">||</span><span style="color:#E1E4E8;"> [ </span><span style="color:#F97583;">-z</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;</span><span style="color:#E1E4E8;">$HOST</span><span style="color:#9ECBFF;">&quot;</span><span style="color:#E1E4E8;"> ] </span><span style="color:#F97583;">||</span><span style="color:#E1E4E8;"> [ </span><span style="color:#F97583;">-z</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;</span><span style="color:#E1E4E8;">$KEY</span><span style="color:#9ECBFF;">&quot;</span><span style="color:#E1E4E8;"> ]; </span><span style="color:#F97583;">then</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">show_help</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#79B8FF;">exit</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">1</span></span>
<span class="line"><span style="color:#F97583;">fi</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># set some colors for status OK, FAIL and titles</span></span>
<span class="line"><span style="color:#E1E4E8;">SETCOLOR_SUCCESS</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&quot;echo -en </span><span style="color:#79B8FF;">\\\\</span><span style="color:#9ECBFF;">033[0;32m&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">SETCOLOR_FAILURE</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&quot;echo -en </span><span style="color:#79B8FF;">\\\\</span><span style="color:#9ECBFF;">033[1;31m&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">SETCOLOR_NORMAL</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&quot;echo -en </span><span style="color:#79B8FF;">\\\\</span><span style="color:#9ECBFF;">033[0;39m&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">SETCOLOR_TITLE_PURPLE</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&quot;echo -en </span><span style="color:#79B8FF;">\\\\</span><span style="color:#9ECBFF;">033[0;35m&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># purple</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># usage log &quot;string to log&quot; &quot;color option&quot;</span></span>
<span class="line"><span style="color:#F97583;">function</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">log_success</span><span style="color:#E1E4E8;">() {</span></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> [ </span><span style="color:#79B8FF;">$#</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">-lt</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;"> ]; </span><span style="color:#F97583;">then</span></span>
<span class="line"><span style="color:#E1E4E8;">       \${SETCOLOR_FAILURE}</span></span>
<span class="line"><span style="color:#E1E4E8;">       </span><span style="color:#79B8FF;">echo</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;Not enough arguments for log function! Expecting 1 argument got </span><span style="color:#79B8FF;">$#</span><span style="color:#9ECBFF;">&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">       </span><span style="color:#79B8FF;">exit</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">1</span></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#F97583;">fi</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">   timestamp</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">$(</span><span style="color:#B392F0;">date</span><span style="color:#9ECBFF;"> &quot;+%Y-%m-%d %H:%M:%S %Z&quot;)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">   \${SETCOLOR_SUCCESS}</span></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">printf</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;[%s] </span><span style="color:#79B8FF;">$1</span><span style="color:#9ECBFF;">\\n&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;</span><span style="color:#E1E4E8;">$timestamp</span><span style="color:#9ECBFF;">&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">   \${SETCOLOR_NORMAL}</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">function</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">log_failure</span><span style="color:#E1E4E8;">() {</span></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> [ </span><span style="color:#79B8FF;">$#</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">-lt</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;"> ]; </span><span style="color:#F97583;">then</span></span>
<span class="line"><span style="color:#E1E4E8;">       \${SETCOLOR_FAILURE}</span></span>
<span class="line"><span style="color:#E1E4E8;">       </span><span style="color:#79B8FF;">echo</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;Not enough arguments for log function! Expecting 1 argument got </span><span style="color:#79B8FF;">$#</span><span style="color:#9ECBFF;">&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">       </span><span style="color:#79B8FF;">exit</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">1</span></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#F97583;">fi</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">   timestamp</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">$(</span><span style="color:#B392F0;">date</span><span style="color:#9ECBFF;"> &quot;+%Y-%m-%d %H:%M:%S %Z&quot;)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">   \${SETCOLOR_FAILURE}</span></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">printf</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;[%s] </span><span style="color:#79B8FF;">$1</span><span style="color:#9ECBFF;">\\n&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;</span><span style="color:#E1E4E8;">$timestamp</span><span style="color:#9ECBFF;">&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">   \${SETCOLOR_NORMAL}</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">function</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">log_title</span><span style="color:#E1E4E8;">() {</span></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> [ </span><span style="color:#79B8FF;">$#</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">-lt</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;"> ]; </span><span style="color:#F97583;">then</span></span>
<span class="line"><span style="color:#E1E4E8;">       \${SETCOLOR_FAILURE}</span></span>
<span class="line"><span style="color:#E1E4E8;">       </span><span style="color:#B392F0;">log_failure</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;Not enough arguments for log function! Expecting 1 argument got </span><span style="color:#79B8FF;">$#</span><span style="color:#9ECBFF;">&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">       </span><span style="color:#79B8FF;">exit</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">1</span></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#F97583;">fi</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">   \${SETCOLOR_TITLE_PURPLE}</span></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">printf</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;|-------------------------------------------------------------------------|\\n&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">printf</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;|%s|\\n&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;</span><span style="color:#79B8FF;">$1</span><span style="color:#9ECBFF;">&quot;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">printf</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;|-------------------------------------------------------------------------|\\n&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">   \${SETCOLOR_NORMAL}</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> [ </span><span style="color:#F97583;">-d</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;</span><span style="color:#E1E4E8;">$DASH_DIR</span><span style="color:#9ECBFF;">&quot;</span><span style="color:#E1E4E8;"> ]; </span><span style="color:#F97583;">then</span></span>
<span class="line"><span style="color:#E1E4E8;">    DASH_LIST</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">$(</span><span style="color:#B392F0;">find</span><span style="color:#9ECBFF;"> &quot;</span><span style="color:#E1E4E8;">$DASH_DIR</span><span style="color:#9ECBFF;">&quot; </span><span style="color:#79B8FF;">-mindepth</span><span style="color:#9ECBFF;"> </span><span style="color:#79B8FF;">1</span><span style="color:#9ECBFF;"> </span><span style="color:#79B8FF;">-name</span><span style="color:#9ECBFF;"> </span><span style="color:#79B8FF;">\\*</span><span style="color:#9ECBFF;">.json)</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> [ </span><span style="color:#F97583;">-z</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;</span><span style="color:#E1E4E8;">$DASH_LIST</span><span style="color:#9ECBFF;">&quot;</span><span style="color:#E1E4E8;"> ]; </span><span style="color:#F97583;">then</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#B392F0;">log_title</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;----------------- </span><span style="color:#E1E4E8;">$DASH_DIR</span><span style="color:#9ECBFF;"> contains no JSON files! -----------------&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#B392F0;">log_failure</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;Directory </span><span style="color:#E1E4E8;">$DASH_DIR</span><span style="color:#9ECBFF;"> does not appear to contain any JSON files for import. Check your path and try again.&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#79B8FF;">exit</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">1</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">else</span></span>
<span class="line"><span style="color:#E1E4E8;">        FILESTOTAL</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">$(</span><span style="color:#79B8FF;">echo</span><span style="color:#9ECBFF;"> &quot;</span><span style="color:#E1E4E8;">$DASH_LIST</span><span style="color:#9ECBFF;">&quot; </span><span style="color:#F97583;">|</span><span style="color:#9ECBFF;"> </span><span style="color:#B392F0;">wc</span><span style="color:#9ECBFF;"> </span><span style="color:#79B8FF;">-l</span><span style="color:#9ECBFF;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#B392F0;">log_title</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;----------------- Starting import of </span><span style="color:#E1E4E8;">$FILESTOTAL</span><span style="color:#9ECBFF;"> dashboards -----------------&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">fi</span></span>
<span class="line"><span style="color:#F97583;">else</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">log_title</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;----------------- </span><span style="color:#E1E4E8;">$DASH_DIR</span><span style="color:#9ECBFF;"> directory not found! -----------------&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">log_failure</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;Directory </span><span style="color:#E1E4E8;">$DASH_DIR</span><span style="color:#9ECBFF;"> does not exist. Check your path and try again.&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#79B8FF;">exit</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">1</span></span>
<span class="line"><span style="color:#F97583;">fi</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">NUMSUCCESS</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">0</span></span>
<span class="line"><span style="color:#E1E4E8;">NUMFAILURE</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">0</span></span>
<span class="line"><span style="color:#E1E4E8;">COUNTER</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">0</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">for</span><span style="color:#E1E4E8;"> DASH_FILE </span><span style="color:#F97583;">in</span><span style="color:#E1E4E8;"> $DASH_LIST; </span><span style="color:#F97583;">do</span></span>
<span class="line"><span style="color:#E1E4E8;">    COUNTER</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">$((COUNTER </span><span style="color:#F97583;">+</span><span style="color:#9ECBFF;"> </span><span style="color:#79B8FF;">1</span><span style="color:#9ECBFF;">))</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#79B8FF;">echo</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;Import </span><span style="color:#E1E4E8;">$COUNTER</span><span style="color:#9ECBFF;">/</span><span style="color:#E1E4E8;">$FILESTOTAL</span><span style="color:#9ECBFF;">: </span><span style="color:#E1E4E8;">$DASH_FILE</span><span style="color:#9ECBFF;">...&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">    RESULT</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">$(</span><span style="color:#B392F0;">cat</span><span style="color:#9ECBFF;"> &quot;</span><span style="color:#E1E4E8;">$DASH_FILE</span><span style="color:#9ECBFF;">&quot; </span><span style="color:#F97583;">|</span><span style="color:#9ECBFF;"> </span><span style="color:#B392F0;">jq</span><span style="color:#9ECBFF;"> &#39;. * {overwrite: true, dashboard: {id: null}}&#39; </span><span style="color:#F97583;">|</span><span style="color:#9ECBFF;"> </span><span style="color:#B392F0;">curl</span><span style="color:#9ECBFF;"> </span><span style="color:#79B8FF;">-s</span><span style="color:#9ECBFF;"> </span><span style="color:#79B8FF;">-X</span><span style="color:#9ECBFF;"> POST </span><span style="color:#79B8FF;">-H</span><span style="color:#9ECBFF;"> &quot;Content-Type: application/json&quot; </span><span style="color:#79B8FF;">-H</span><span style="color:#9ECBFF;"> &quot;Authorization: Bearer </span><span style="color:#E1E4E8;">$KEY</span><span style="color:#9ECBFF;">&quot; &quot;</span><span style="color:#E1E4E8;">$HOST</span><span style="color:#9ECBFF;">&quot;/api/dashboards/db </span><span style="color:#79B8FF;">-d</span><span style="color:#9ECBFF;"> @-)</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> [[ </span><span style="color:#9ECBFF;">&quot;</span><span style="color:#E1E4E8;">$RESULT</span><span style="color:#9ECBFF;">&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">==</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">*</span><span style="color:#9ECBFF;">&quot;success&quot;</span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;"> ]]; </span><span style="color:#F97583;">then</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#B392F0;">log_success</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;</span><span style="color:#E1E4E8;">$RESULT</span><span style="color:#9ECBFF;">&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">        NUMSUCCESS</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">$((NUMSUCCESS </span><span style="color:#F97583;">+</span><span style="color:#9ECBFF;"> </span><span style="color:#79B8FF;">1</span><span style="color:#9ECBFF;">))</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">else</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#B392F0;">log_failure</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;</span><span style="color:#E1E4E8;">$RESULT</span><span style="color:#9ECBFF;">&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">        NUMFAILURE</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">$((NUMFAILURE </span><span style="color:#F97583;">+</span><span style="color:#9ECBFF;"> </span><span style="color:#79B8FF;">1</span><span style="color:#9ECBFF;">))</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">fi</span></span>
<span class="line"><span style="color:#F97583;">done</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">log_title</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;Import complete. </span><span style="color:#E1E4E8;">$NUMSUCCESS</span><span style="color:#9ECBFF;"> dashboards were successfully imported. </span><span style="color:#E1E4E8;">$NUMFAILURE</span><span style="color:#9ECBFF;"> dashboard imports failed.&quot;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#B392F0;">log_title</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;------------------------------ FINISHED ---------------------------------&quot;</span><span style="color:#E1E4E8;">;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">#!/bin/bash</span></span>
<span class="line"><span style="color:#6A737D;">#</span></span>
<span class="line"><span style="color:#6A737D;"># add the &quot;-x&quot; option to the shebang line if you want a more verbose output</span></span>
<span class="line"><span style="color:#6A737D;">#</span></span>
<span class="line"><span style="color:#6A737D;">#</span></span>
<span class="line"><span style="color:#24292E;">OPTSPEC</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&quot;:hp:t:k:&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">show_help</span><span style="color:#24292E;">() {</span></span>
<span class="line"><span style="color:#6F42C1;">cat</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&lt;&lt;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">EOF</span></span>
<span class="line"><span style="color:#032F62;">Usage: </span><span style="color:#005CC5;">$0</span><span style="color:#032F62;"> [-p PATH] [-t TARGET_HOST] [-k API_KEY]</span></span>
<span class="line"><span style="color:#032F62;">Script to import dashboards into Grafana</span></span>
<span class="line"><span style="color:#032F62;">    -p      Required. Root path containing JSON exports of the dashboards you want imported.</span></span>
<span class="line"><span style="color:#032F62;">    -t      Required. The full URL of the target host</span></span>
<span class="line"><span style="color:#032F62;">    -k      Required. The API key to use on the target host</span></span>
<span class="line"></span>
<span class="line"><span style="color:#032F62;">    -h      Display this help and exit.</span></span>
<span class="line"><span style="color:#032F62;">EOF</span></span>
<span class="line"><span style="color:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">###### Check script invocation options ######</span></span>
<span class="line"><span style="color:#D73A49;">while</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">getopts</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;</span><span style="color:#24292E;">$OPTSPEC</span><span style="color:#032F62;">&quot;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">optchar</span><span style="color:#24292E;">; </span><span style="color:#D73A49;">do</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">case</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;</span><span style="color:#24292E;">$optchar</span><span style="color:#032F62;">&quot;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">in</span></span>
<span class="line"><span style="color:#24292E;">        h)</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#6F42C1;">show_help</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#005CC5;">exit</span></span>
<span class="line"><span style="color:#24292E;">            ;;</span></span>
<span class="line"><span style="color:#24292E;">        p)</span></span>
<span class="line"><span style="color:#24292E;">            DASH_DIR</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&quot;</span><span style="color:#24292E;">$OPTARG</span><span style="color:#032F62;">&quot;</span><span style="color:#24292E;">;;</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6F42C1;">t</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">            HOST</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&quot;</span><span style="color:#24292E;">$OPTARG</span><span style="color:#032F62;">&quot;</span><span style="color:#24292E;">;;</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6F42C1;">k</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">            KEY</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&quot;</span><span style="color:#24292E;">$OPTARG</span><span style="color:#032F62;">&quot;</span><span style="color:#24292E;">;;</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6F42C1;">\\?</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#005CC5;">echo</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;Invalid option: -</span><span style="color:#24292E;">$OPTARG</span><span style="color:#032F62;">&quot;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&gt;&amp;2</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#005CC5;">exit</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1</span></span>
<span class="line"><span style="color:#24292E;">          ;;</span></span>
<span class="line"><span style="color:#24292E;">        :)</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#005CC5;">echo</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;Option -</span><span style="color:#24292E;">$OPTARG</span><span style="color:#032F62;"> requires an argument.&quot;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&gt;&amp;2</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#005CC5;">exit</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1</span></span>
<span class="line"><span style="color:#24292E;">          ;;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">esac</span></span>
<span class="line"><span style="color:#D73A49;">done</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">if</span><span style="color:#24292E;"> [ </span><span style="color:#D73A49;">-z</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;</span><span style="color:#24292E;">$DASH_DIR</span><span style="color:#032F62;">&quot;</span><span style="color:#24292E;"> ] </span><span style="color:#D73A49;">||</span><span style="color:#24292E;"> [ </span><span style="color:#D73A49;">-z</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;</span><span style="color:#24292E;">$HOST</span><span style="color:#032F62;">&quot;</span><span style="color:#24292E;"> ] </span><span style="color:#D73A49;">||</span><span style="color:#24292E;"> [ </span><span style="color:#D73A49;">-z</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;</span><span style="color:#24292E;">$KEY</span><span style="color:#032F62;">&quot;</span><span style="color:#24292E;"> ]; </span><span style="color:#D73A49;">then</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">show_help</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#005CC5;">exit</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1</span></span>
<span class="line"><span style="color:#D73A49;">fi</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># set some colors for status OK, FAIL and titles</span></span>
<span class="line"><span style="color:#24292E;">SETCOLOR_SUCCESS</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&quot;echo -en </span><span style="color:#005CC5;">\\\\</span><span style="color:#032F62;">033[0;32m&quot;</span></span>
<span class="line"><span style="color:#24292E;">SETCOLOR_FAILURE</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&quot;echo -en </span><span style="color:#005CC5;">\\\\</span><span style="color:#032F62;">033[1;31m&quot;</span></span>
<span class="line"><span style="color:#24292E;">SETCOLOR_NORMAL</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&quot;echo -en </span><span style="color:#005CC5;">\\\\</span><span style="color:#032F62;">033[0;39m&quot;</span></span>
<span class="line"><span style="color:#24292E;">SETCOLOR_TITLE_PURPLE</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&quot;echo -en </span><span style="color:#005CC5;">\\\\</span><span style="color:#032F62;">033[0;35m&quot;</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># purple</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># usage log &quot;string to log&quot; &quot;color option&quot;</span></span>
<span class="line"><span style="color:#D73A49;">function</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">log_success</span><span style="color:#24292E;">() {</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> [ </span><span style="color:#005CC5;">$#</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">-lt</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1</span><span style="color:#24292E;"> ]; </span><span style="color:#D73A49;">then</span></span>
<span class="line"><span style="color:#24292E;">       \${SETCOLOR_FAILURE}</span></span>
<span class="line"><span style="color:#24292E;">       </span><span style="color:#005CC5;">echo</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;Not enough arguments for log function! Expecting 1 argument got </span><span style="color:#005CC5;">$#</span><span style="color:#032F62;">&quot;</span></span>
<span class="line"><span style="color:#24292E;">       </span><span style="color:#005CC5;">exit</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#D73A49;">fi</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">   timestamp</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">$(</span><span style="color:#6F42C1;">date</span><span style="color:#032F62;"> &quot;+%Y-%m-%d %H:%M:%S %Z&quot;)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">   \${SETCOLOR_SUCCESS}</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#005CC5;">printf</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;[%s] </span><span style="color:#005CC5;">$1</span><span style="color:#032F62;">\\n&quot;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;</span><span style="color:#24292E;">$timestamp</span><span style="color:#032F62;">&quot;</span></span>
<span class="line"><span style="color:#24292E;">   \${SETCOLOR_NORMAL}</span></span>
<span class="line"><span style="color:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">function</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">log_failure</span><span style="color:#24292E;">() {</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> [ </span><span style="color:#005CC5;">$#</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">-lt</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1</span><span style="color:#24292E;"> ]; </span><span style="color:#D73A49;">then</span></span>
<span class="line"><span style="color:#24292E;">       \${SETCOLOR_FAILURE}</span></span>
<span class="line"><span style="color:#24292E;">       </span><span style="color:#005CC5;">echo</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;Not enough arguments for log function! Expecting 1 argument got </span><span style="color:#005CC5;">$#</span><span style="color:#032F62;">&quot;</span></span>
<span class="line"><span style="color:#24292E;">       </span><span style="color:#005CC5;">exit</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#D73A49;">fi</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">   timestamp</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">$(</span><span style="color:#6F42C1;">date</span><span style="color:#032F62;"> &quot;+%Y-%m-%d %H:%M:%S %Z&quot;)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">   \${SETCOLOR_FAILURE}</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#005CC5;">printf</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;[%s] </span><span style="color:#005CC5;">$1</span><span style="color:#032F62;">\\n&quot;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;</span><span style="color:#24292E;">$timestamp</span><span style="color:#032F62;">&quot;</span></span>
<span class="line"><span style="color:#24292E;">   \${SETCOLOR_NORMAL}</span></span>
<span class="line"><span style="color:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">function</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">log_title</span><span style="color:#24292E;">() {</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> [ </span><span style="color:#005CC5;">$#</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">-lt</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1</span><span style="color:#24292E;"> ]; </span><span style="color:#D73A49;">then</span></span>
<span class="line"><span style="color:#24292E;">       \${SETCOLOR_FAILURE}</span></span>
<span class="line"><span style="color:#24292E;">       </span><span style="color:#6F42C1;">log_failure</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;Not enough arguments for log function! Expecting 1 argument got </span><span style="color:#005CC5;">$#</span><span style="color:#032F62;">&quot;</span></span>
<span class="line"><span style="color:#24292E;">       </span><span style="color:#005CC5;">exit</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#D73A49;">fi</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">   \${SETCOLOR_TITLE_PURPLE}</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#005CC5;">printf</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;|-------------------------------------------------------------------------|\\n&quot;</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#005CC5;">printf</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;|%s|\\n&quot;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;</span><span style="color:#005CC5;">$1</span><span style="color:#032F62;">&quot;</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#005CC5;">printf</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;|-------------------------------------------------------------------------|\\n&quot;</span></span>
<span class="line"><span style="color:#24292E;">   \${SETCOLOR_NORMAL}</span></span>
<span class="line"><span style="color:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">if</span><span style="color:#24292E;"> [ </span><span style="color:#D73A49;">-d</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;</span><span style="color:#24292E;">$DASH_DIR</span><span style="color:#032F62;">&quot;</span><span style="color:#24292E;"> ]; </span><span style="color:#D73A49;">then</span></span>
<span class="line"><span style="color:#24292E;">    DASH_LIST</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">$(</span><span style="color:#6F42C1;">find</span><span style="color:#032F62;"> &quot;</span><span style="color:#24292E;">$DASH_DIR</span><span style="color:#032F62;">&quot; </span><span style="color:#005CC5;">-mindepth</span><span style="color:#032F62;"> </span><span style="color:#005CC5;">1</span><span style="color:#032F62;"> </span><span style="color:#005CC5;">-name</span><span style="color:#032F62;"> </span><span style="color:#005CC5;">\\*</span><span style="color:#032F62;">.json)</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> [ </span><span style="color:#D73A49;">-z</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;</span><span style="color:#24292E;">$DASH_LIST</span><span style="color:#032F62;">&quot;</span><span style="color:#24292E;"> ]; </span><span style="color:#D73A49;">then</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6F42C1;">log_title</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;----------------- </span><span style="color:#24292E;">$DASH_DIR</span><span style="color:#032F62;"> contains no JSON files! -----------------&quot;</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6F42C1;">log_failure</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;Directory </span><span style="color:#24292E;">$DASH_DIR</span><span style="color:#032F62;"> does not appear to contain any JSON files for import. Check your path and try again.&quot;</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#005CC5;">exit</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">else</span></span>
<span class="line"><span style="color:#24292E;">        FILESTOTAL</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">$(</span><span style="color:#005CC5;">echo</span><span style="color:#032F62;"> &quot;</span><span style="color:#24292E;">$DASH_LIST</span><span style="color:#032F62;">&quot; </span><span style="color:#D73A49;">|</span><span style="color:#032F62;"> </span><span style="color:#6F42C1;">wc</span><span style="color:#032F62;"> </span><span style="color:#005CC5;">-l</span><span style="color:#032F62;">)</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6F42C1;">log_title</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;----------------- Starting import of </span><span style="color:#24292E;">$FILESTOTAL</span><span style="color:#032F62;"> dashboards -----------------&quot;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">fi</span></span>
<span class="line"><span style="color:#D73A49;">else</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">log_title</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;----------------- </span><span style="color:#24292E;">$DASH_DIR</span><span style="color:#032F62;"> directory not found! -----------------&quot;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">log_failure</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;Directory </span><span style="color:#24292E;">$DASH_DIR</span><span style="color:#032F62;"> does not exist. Check your path and try again.&quot;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#005CC5;">exit</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1</span></span>
<span class="line"><span style="color:#D73A49;">fi</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">NUMSUCCESS</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">0</span></span>
<span class="line"><span style="color:#24292E;">NUMFAILURE</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">0</span></span>
<span class="line"><span style="color:#24292E;">COUNTER</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">0</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">for</span><span style="color:#24292E;"> DASH_FILE </span><span style="color:#D73A49;">in</span><span style="color:#24292E;"> $DASH_LIST; </span><span style="color:#D73A49;">do</span></span>
<span class="line"><span style="color:#24292E;">    COUNTER</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">$((COUNTER </span><span style="color:#D73A49;">+</span><span style="color:#032F62;"> </span><span style="color:#005CC5;">1</span><span style="color:#032F62;">))</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#005CC5;">echo</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;Import </span><span style="color:#24292E;">$COUNTER</span><span style="color:#032F62;">/</span><span style="color:#24292E;">$FILESTOTAL</span><span style="color:#032F62;">: </span><span style="color:#24292E;">$DASH_FILE</span><span style="color:#032F62;">...&quot;</span></span>
<span class="line"><span style="color:#24292E;">    RESULT</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">$(</span><span style="color:#6F42C1;">cat</span><span style="color:#032F62;"> &quot;</span><span style="color:#24292E;">$DASH_FILE</span><span style="color:#032F62;">&quot; </span><span style="color:#D73A49;">|</span><span style="color:#032F62;"> </span><span style="color:#6F42C1;">jq</span><span style="color:#032F62;"> &#39;. * {overwrite: true, dashboard: {id: null}}&#39; </span><span style="color:#D73A49;">|</span><span style="color:#032F62;"> </span><span style="color:#6F42C1;">curl</span><span style="color:#032F62;"> </span><span style="color:#005CC5;">-s</span><span style="color:#032F62;"> </span><span style="color:#005CC5;">-X</span><span style="color:#032F62;"> POST </span><span style="color:#005CC5;">-H</span><span style="color:#032F62;"> &quot;Content-Type: application/json&quot; </span><span style="color:#005CC5;">-H</span><span style="color:#032F62;"> &quot;Authorization: Bearer </span><span style="color:#24292E;">$KEY</span><span style="color:#032F62;">&quot; &quot;</span><span style="color:#24292E;">$HOST</span><span style="color:#032F62;">&quot;/api/dashboards/db </span><span style="color:#005CC5;">-d</span><span style="color:#032F62;"> @-)</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> [[ </span><span style="color:#032F62;">&quot;</span><span style="color:#24292E;">$RESULT</span><span style="color:#032F62;">&quot;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">==</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">*</span><span style="color:#032F62;">&quot;success&quot;</span><span style="color:#D73A49;">*</span><span style="color:#24292E;"> ]]; </span><span style="color:#D73A49;">then</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6F42C1;">log_success</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;</span><span style="color:#24292E;">$RESULT</span><span style="color:#032F62;">&quot;</span></span>
<span class="line"><span style="color:#24292E;">        NUMSUCCESS</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">$((NUMSUCCESS </span><span style="color:#D73A49;">+</span><span style="color:#032F62;"> </span><span style="color:#005CC5;">1</span><span style="color:#032F62;">))</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">else</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6F42C1;">log_failure</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;</span><span style="color:#24292E;">$RESULT</span><span style="color:#032F62;">&quot;</span></span>
<span class="line"><span style="color:#24292E;">        NUMFAILURE</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">$((NUMFAILURE </span><span style="color:#D73A49;">+</span><span style="color:#032F62;"> </span><span style="color:#005CC5;">1</span><span style="color:#032F62;">))</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">fi</span></span>
<span class="line"><span style="color:#D73A49;">done</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">log_title</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;Import complete. </span><span style="color:#24292E;">$NUMSUCCESS</span><span style="color:#032F62;"> dashboards were successfully imported. </span><span style="color:#24292E;">$NUMFAILURE</span><span style="color:#032F62;"> dashboard imports failed.&quot;</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#6F42C1;">log_title</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;------------------------------ FINISHED ---------------------------------&quot;</span><span style="color:#24292E;">;</span></span></code></pre></div><ul><li>如果是provisioning，需要进行如下格式化</li></ul><p><strong>说明：<a href="http://docs.grafana.org/administration/provisioning/#provisioning-grafana" target="_blank" rel="noreferrer">grafana provisioning</a>是grafana 5.0后引入的功能，用以支持通过配置的方式进行datasource和dashboard的配置</strong></p><p>provision.py</p><div class="language-py vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">py</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;"># -*- coding: utf-8 -*-</span></span>
<span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> os</span></span>
<span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> json</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">dirs </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> [</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">&quot;/root/scritps/localhost/主机层面&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">]</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">def</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">main</span><span style="color:#E1E4E8;">():</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">for</span><span style="color:#E1E4E8;"> d </span><span style="color:#F97583;">in</span><span style="color:#E1E4E8;"> dirs:</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">for</span><span style="color:#E1E4E8;"> f </span><span style="color:#F97583;">in</span><span style="color:#E1E4E8;"> os.listdir(d):</span></span>
<span class="line"><span style="color:#E1E4E8;">            filename </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;</span><span style="color:#79B8FF;">{}</span><span style="color:#9ECBFF;">/</span><span style="color:#79B8FF;">{}</span><span style="color:#9ECBFF;">&quot;</span><span style="color:#E1E4E8;">.format(d, f)</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">not</span><span style="color:#E1E4E8;"> f.endswith(</span><span style="color:#9ECBFF;">&quot;.json&quot;</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">or</span><span style="color:#E1E4E8;"> f.startswith(</span><span style="color:#9ECBFF;">&quot;.&quot;</span><span style="color:#E1E4E8;">):</span></span>
<span class="line"><span style="color:#E1E4E8;">                </span><span style="color:#F97583;">continue</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#F97583;">try</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">                </span><span style="color:#F97583;">with</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">open</span><span style="color:#E1E4E8;">(filename, </span><span style="color:#9ECBFF;">&quot;r+&quot;</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> fp:</span></span>
<span class="line"><span style="color:#E1E4E8;">                    json_data </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> fp.read()</span></span>
<span class="line"><span style="color:#E1E4E8;">                    data </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> json.loads(json_data)</span></span>
<span class="line"><span style="color:#E1E4E8;">                    fp.seek(</span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">                    fp.write(json.dumps(data[</span><span style="color:#9ECBFF;">&quot;dashboard&quot;</span><span style="color:#E1E4E8;">], </span><span style="color:#FFAB70;">sort_keys</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">True</span><span style="color:#E1E4E8;">))  </span><span style="color:#6A737D;"># 字母序</span></span>
<span class="line"><span style="color:#E1E4E8;">                    </span><span style="color:#79B8FF;">print</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;</span><span style="color:#79B8FF;">{}</span><span style="color:#9ECBFF;">: success&quot;</span><span style="color:#E1E4E8;">.format(filename))</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#F97583;">except</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">Exception</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> e:</span></span>
<span class="line"><span style="color:#E1E4E8;">                </span><span style="color:#79B8FF;">print</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;</span><span style="color:#79B8FF;">{}</span><span style="color:#9ECBFF;">: </span><span style="color:#79B8FF;">{}</span><span style="color:#9ECBFF;">&quot;</span><span style="color:#E1E4E8;">.format(filename, e))</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">__name__</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">==</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;__main__&quot;</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    main()</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;"># -*- coding: utf-8 -*-</span></span>
<span class="line"><span style="color:#D73A49;">import</span><span style="color:#24292E;"> os</span></span>
<span class="line"><span style="color:#D73A49;">import</span><span style="color:#24292E;"> json</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">dirs </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> [</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#032F62;">&quot;/root/scritps/localhost/主机层面&quot;</span></span>
<span class="line"><span style="color:#24292E;">]</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">def</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">main</span><span style="color:#24292E;">():</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">for</span><span style="color:#24292E;"> d </span><span style="color:#D73A49;">in</span><span style="color:#24292E;"> dirs:</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">for</span><span style="color:#24292E;"> f </span><span style="color:#D73A49;">in</span><span style="color:#24292E;"> os.listdir(d):</span></span>
<span class="line"><span style="color:#24292E;">            filename </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;</span><span style="color:#005CC5;">{}</span><span style="color:#032F62;">/</span><span style="color:#005CC5;">{}</span><span style="color:#032F62;">&quot;</span><span style="color:#24292E;">.format(d, f)</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">not</span><span style="color:#24292E;"> f.endswith(</span><span style="color:#032F62;">&quot;.json&quot;</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">or</span><span style="color:#24292E;"> f.startswith(</span><span style="color:#032F62;">&quot;.&quot;</span><span style="color:#24292E;">):</span></span>
<span class="line"><span style="color:#24292E;">                </span><span style="color:#D73A49;">continue</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#D73A49;">try</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">                </span><span style="color:#D73A49;">with</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">open</span><span style="color:#24292E;">(filename, </span><span style="color:#032F62;">&quot;r+&quot;</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> fp:</span></span>
<span class="line"><span style="color:#24292E;">                    json_data </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> fp.read()</span></span>
<span class="line"><span style="color:#24292E;">                    data </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> json.loads(json_data)</span></span>
<span class="line"><span style="color:#24292E;">                    fp.seek(</span><span style="color:#005CC5;">0</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">                    fp.write(json.dumps(data[</span><span style="color:#032F62;">&quot;dashboard&quot;</span><span style="color:#24292E;">], </span><span style="color:#E36209;">sort_keys</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">True</span><span style="color:#24292E;">))  </span><span style="color:#6A737D;"># 字母序</span></span>
<span class="line"><span style="color:#24292E;">                    </span><span style="color:#005CC5;">print</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;</span><span style="color:#005CC5;">{}</span><span style="color:#032F62;">: success&quot;</span><span style="color:#24292E;">.format(filename))</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#D73A49;">except</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">Exception</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> e:</span></span>
<span class="line"><span style="color:#24292E;">                </span><span style="color:#005CC5;">print</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;</span><span style="color:#005CC5;">{}</span><span style="color:#032F62;">: </span><span style="color:#005CC5;">{}</span><span style="color:#032F62;">&quot;</span><span style="color:#24292E;">.format(filename, e))</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">if</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">__name__</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">==</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;__main__&quot;</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    main()</span></span></code></pre></div><p><code>之后在手动导入</code></p>`,11),e=[o];function t(c,r,y,E,F,i){return n(),a("div",null,e)}const B=s(p,[["render",t]]);export{u as __pageData,B as default};
