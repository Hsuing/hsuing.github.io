import{_ as s,o as a,c as n,R as l}from"./chunks/framework.zUbWieqp.js";const F=JSON.parse('{"title":"1. 安装服务端","description":"","frontmatter":{},"headers":[],"relativePath":"guide/container/k8s/存储/nfs/1-nfs.md","filePath":"guide/container/k8s/存储/nfs/1-nfs.md","lastUpdated":1720533756000}'),p={name:"guide/container/k8s/存储/nfs/1-nfs.md"},o=l(`<h1 id="_1-安装服务端" tabindex="-1">1. 安装服务端 <a class="header-anchor" href="#_1-安装服务端" aria-label="Permalink to &quot;1. 安装服务端&quot;">​</a></h1><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">yum</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">install</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-y</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">nfs-utils</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">rpcbind</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">yum</span><span style="color:#24292E;"> </span><span style="color:#032F62;">install</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-y</span><span style="color:#24292E;"> </span><span style="color:#032F62;">nfs-utils</span><span style="color:#24292E;"> </span><span style="color:#032F62;">rpcbind</span></span></code></pre></div><h2 id="_1-1-启动服务" tabindex="-1">1.1 启动服务 <a class="header-anchor" href="#_1-1-启动服务" aria-label="Permalink to &quot;1.1 启动服务&quot;">​</a></h2><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">#查看状态</span></span>
<span class="line"><span style="color:#B392F0;">systemctl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">status</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">rpcbind</span></span>
<span class="line"><span style="color:#B392F0;">systemctl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">status</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">nfs-server</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#启动</span></span>
<span class="line"><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">systemctl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">enable</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--now</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">nfs-server</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">rpcbind</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">#查看状态</span></span>
<span class="line"><span style="color:#6F42C1;">systemctl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">status</span><span style="color:#24292E;"> </span><span style="color:#032F62;">rpcbind</span></span>
<span class="line"><span style="color:#6F42C1;">systemctl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">status</span><span style="color:#24292E;"> </span><span style="color:#032F62;">nfs-server</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#启动</span></span>
<span class="line"><span style="color:#24292E;"> </span><span style="color:#6F42C1;">systemctl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">enable</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--now</span><span style="color:#24292E;"> </span><span style="color:#032F62;">nfs-server</span><span style="color:#24292E;"> </span><span style="color:#032F62;">rpcbind</span></span></code></pre></div><h1 id="_2-安装客户端" tabindex="-1">2. 安装客户端 <a class="header-anchor" href="#_2-安装客户端" aria-label="Permalink to &quot;2. 安装客户端&quot;">​</a></h1><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">yum install install nfs-utils -y</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">yum install install nfs-utils -y</span></span></code></pre></div><h1 id="_3-配置" tabindex="-1">3. 配置 <a class="header-anchor" href="#_3-配置" aria-label="Permalink to &quot;3. 配置&quot;">​</a></h1><h2 id="_3-1-域名方式" tabindex="-1">3.1 域名方式 <a class="header-anchor" href="#_3-1-域名方式" aria-label="Permalink to &quot;3.1 域名方式&quot;">​</a></h2><p>默认是ip方式进行挂载</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">sed</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-i</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;/^#Domain/s/^#//;/Domain = /s/=.*/= xxx.com/&#39;</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/etc/idmapd.conf</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">sed</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-i</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;/^#Domain/s/^#//;/Domain = /s/=.*/= xxx.com/&#39;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/etc/idmapd.conf</span></span></code></pre></div><h2 id="_3-2-配置" tabindex="-1">3.2 配置 <a class="header-anchor" href="#_3-2-配置" aria-label="Permalink to &quot;3.2 配置&quot;">​</a></h2><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">#创建共享目录</span></span>
<span class="line"><span style="color:#B392F0;">mkdir</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-p</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/data/nfs</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#配置exports</span></span>
<span class="line"><span style="color:#79B8FF;">echo</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;/data/nfs/ *(insecure,rw,sync,no_root_squash)&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/etc/exports</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">##配置生效</span></span>
<span class="line"><span style="color:#B392F0;">exportfs</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-r</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#验证共享节点，可以看到/data/nfs ，说明成功</span></span>
<span class="line"><span style="color:#E1E4E8;">[root@Rocky </span><span style="color:#F97583;">~</span><span style="color:#E1E4E8;">]# showmount -e</span></span>
<span class="line"><span style="color:#B392F0;">Export</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">list</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">for</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Rocky:</span></span>
<span class="line"><span style="color:#B392F0;">/data/nfs</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">#创建共享目录</span></span>
<span class="line"><span style="color:#6F42C1;">mkdir</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-p</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/data/nfs</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#配置exports</span></span>
<span class="line"><span style="color:#005CC5;">echo</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;/data/nfs/ *(insecure,rw,sync,no_root_squash)&quot;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/etc/exports</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">##配置生效</span></span>
<span class="line"><span style="color:#6F42C1;">exportfs</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-r</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#验证共享节点，可以看到/data/nfs ，说明成功</span></span>
<span class="line"><span style="color:#24292E;">[root@Rocky </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# showmount -e</span></span>
<span class="line"><span style="color:#6F42C1;">Export</span><span style="color:#24292E;"> </span><span style="color:#032F62;">list</span><span style="color:#24292E;"> </span><span style="color:#032F62;">for</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Rocky:</span></span>
<span class="line"><span style="color:#6F42C1;">/data/nfs</span></span></code></pre></div><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">参数说明：</span></span>
<span class="line"><span style="color:#e1e4e8;">　　　　rw 读写</span></span>
<span class="line"><span style="color:#e1e4e8;">　　　　ro 只读</span></span>
<span class="line"><span style="color:#e1e4e8;">　　　　sync 数据直接写入磁盘</span></span>
<span class="line"><span style="color:#e1e4e8;">　　　　async 数据先写入内存</span></span>
<span class="line"><span style="color:#e1e4e8;">　　　　no_root_squash 对root用户不压制，在服务端都映射为服务端的root用户</span></span>
<span class="line"><span style="color:#e1e4e8;">　　　　root_squash 如果客户端是用户root操作，会被压制成nobody用户</span></span>
<span class="line"><span style="color:#e1e4e8;">　　　　all_squash 不管客户端的使用nfs的用户是谁，都会压制成nobody用户</span></span>
<span class="line"><span style="color:#e1e4e8;">　　　　nonuid=uid: 指定uid的值</span></span>
<span class="line"><span style="color:#e1e4e8;">　　　　anongid=gid:指定gid的值</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">参数说明：</span></span>
<span class="line"><span style="color:#24292e;">　　　　rw 读写</span></span>
<span class="line"><span style="color:#24292e;">　　　　ro 只读</span></span>
<span class="line"><span style="color:#24292e;">　　　　sync 数据直接写入磁盘</span></span>
<span class="line"><span style="color:#24292e;">　　　　async 数据先写入内存</span></span>
<span class="line"><span style="color:#24292e;">　　　　no_root_squash 对root用户不压制，在服务端都映射为服务端的root用户</span></span>
<span class="line"><span style="color:#24292e;">　　　　root_squash 如果客户端是用户root操作，会被压制成nobody用户</span></span>
<span class="line"><span style="color:#24292e;">　　　　all_squash 不管客户端的使用nfs的用户是谁，都会压制成nobody用户</span></span>
<span class="line"><span style="color:#24292e;">　　　　nonuid=uid: 指定uid的值</span></span>
<span class="line"><span style="color:#24292e;">　　　　anongid=gid:指定gid的值</span></span></code></pre></div><h2 id="_3-3-挂载" tabindex="-1">3.3 挂载 <a class="header-anchor" href="#_3-3-挂载" aria-label="Permalink to &quot;3.3 挂载&quot;">​</a></h2><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">mount</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-t</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">nfs</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">nfs.xxx.com:share_path</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/mnt/home</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;"> </span><span style="color:#6F42C1;">mount</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-t</span><span style="color:#24292E;"> </span><span style="color:#032F62;">nfs</span><span style="color:#24292E;"> </span><span style="color:#032F62;">nfs.xxx.com:share_path</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/mnt/home</span></span></code></pre></div>`,15),e=[o];function t(c,r,i,y,d,E){return a(),n("div",null,e)}const u=s(p,[["render",t]]);export{F as __pageData,u as default};
