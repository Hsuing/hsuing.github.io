import{_ as s,o as a,c as n,R as l}from"./chunks/framework.zUbWieqp.js";const C=JSON.parse('{"title":"","description":"","frontmatter":{},"headers":[],"relativePath":"guide/container/k8s/资源对象/13-1-deployment-滚动发布.md","filePath":"guide/container/k8s/资源对象/13-1-deployment-滚动发布.md","lastUpdated":1726652211000}'),p={name:"guide/container/k8s/资源对象/13-1-deployment-滚动发布.md"},o=l(`<h2 id="_1-创建yaml文件" tabindex="-1">1. 创建yaml文件 <a class="header-anchor" href="#_1-创建yaml文件" aria-label="Permalink to &quot;1. 创建yaml文件&quot;">​</a></h2><p>vim deployment-demo.yaml</p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#85E89D;">apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">apps/v1</span></span>
<span class="line"><span style="color:#85E89D;">kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Deployment</span></span>
<span class="line"><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">deployment-demo</span></span>
<span class="line"><span style="color:#85E89D;">spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">replicas</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">4</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">selector</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">matchLabels</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">app</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">demoapp</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">release</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">stable</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">template</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">labels</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">app</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">demoapp</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">release</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">stable</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">containers</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      - </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">demoapp</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#9ECBFF;">image:registry.cn-zhangjiakou.aliyuncs.com/hsuing/demoapp:\${VERSION}</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">ports</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">        - </span><span style="color:#85E89D;">containerPort</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">80</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">http</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#22863A;">apiVersion</span><span style="color:#24292E;">: </span><span style="color:#032F62;">apps/v1</span></span>
<span class="line"><span style="color:#22863A;">kind</span><span style="color:#24292E;">: </span><span style="color:#032F62;">Deployment</span></span>
<span class="line"><span style="color:#22863A;">metadata</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">deployment-demo</span></span>
<span class="line"><span style="color:#22863A;">spec</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">replicas</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">4</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">selector</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">matchLabels</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">app</span><span style="color:#24292E;">: </span><span style="color:#032F62;">demoapp</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">release</span><span style="color:#24292E;">: </span><span style="color:#032F62;">stable</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">template</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">metadata</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">labels</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">app</span><span style="color:#24292E;">: </span><span style="color:#032F62;">demoapp</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">release</span><span style="color:#24292E;">: </span><span style="color:#032F62;">stable</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">spec</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">containers</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">demoapp</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#032F62;">image:registry.cn-zhangjiakou.aliyuncs.com/hsuing/demoapp:\${VERSION}</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">ports</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">        - </span><span style="color:#22863A;">containerPort</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">80</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">http</span></span></code></pre></div><h2 id="_2-应用清单文件" tabindex="-1">2. 应用清单文件 <a class="header-anchor" href="#_2-应用清单文件" aria-label="Permalink to &quot;2. 应用清单文件&quot;">​</a></h2><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">VERSION</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">v1.0</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">envsubst</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">&lt;</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">deployment-demo.yaml</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">apply</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-f</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">-</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">VERSION</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">v1.0</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">envsubst</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&lt;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">deployment-demo.yaml</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">apply</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-f</span><span style="color:#24292E;"> </span><span style="color:#032F62;">-</span></span></code></pre></div><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;"># 查看deployment信息</span></span>
<span class="line"><span style="color:#B392F0;">root@k8s-master01:~/yaml/chapter08#</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">get</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">deployments.apps</span></span>
<span class="line"><span style="color:#B392F0;">NAME</span><span style="color:#E1E4E8;">              </span><span style="color:#9ECBFF;">READY</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">UP-TO-DATE</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">AVAILABLE</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">AGE</span></span>
<span class="line"><span style="color:#B392F0;">deployment-demo</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">4</span><span style="color:#9ECBFF;">/4</span><span style="color:#E1E4E8;">     </span><span style="color:#79B8FF;">4</span><span style="color:#E1E4E8;">            </span><span style="color:#79B8FF;">4</span><span style="color:#E1E4E8;">           </span><span style="color:#79B8FF;">12</span><span style="color:#9ECBFF;">s</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 查看pod信息</span></span>
<span class="line"><span style="color:#B392F0;">root@k8s-master01:~/yaml/chapter08#</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">get</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pods</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-l</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;app=demoapp,release=stable&#39;</span></span>
<span class="line"><span style="color:#B392F0;">NAME</span><span style="color:#E1E4E8;">                              </span><span style="color:#9ECBFF;">READY</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">STATUS</span><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">RESTARTS</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">AGE</span></span>
<span class="line"><span style="color:#B392F0;">deployment-demo-fb544c5d8-2687q</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">1</span><span style="color:#9ECBFF;">/1</span><span style="color:#E1E4E8;">     </span><span style="color:#9ECBFF;">Running</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">          </span><span style="color:#79B8FF;">2</span><span style="color:#9ECBFF;">m16s</span></span>
<span class="line"><span style="color:#B392F0;">deployment-demo-fb544c5d8-2t6q4</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">1</span><span style="color:#9ECBFF;">/1</span><span style="color:#E1E4E8;">     </span><span style="color:#9ECBFF;">Running</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">          </span><span style="color:#79B8FF;">2</span><span style="color:#9ECBFF;">m16s</span></span>
<span class="line"><span style="color:#B392F0;">deployment-demo-fb544c5d8-pkgzn</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">1</span><span style="color:#9ECBFF;">/1</span><span style="color:#E1E4E8;">     </span><span style="color:#9ECBFF;">Running</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">          </span><span style="color:#79B8FF;">2</span><span style="color:#9ECBFF;">m16s</span></span>
<span class="line"><span style="color:#B392F0;">deployment-demo-fb544c5d8-w52qp</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">1</span><span style="color:#9ECBFF;">/1</span><span style="color:#E1E4E8;">     </span><span style="color:#9ECBFF;">Running</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">          </span><span style="color:#79B8FF;">2</span><span style="color:#9ECBFF;">m16s</span></span>
<span class="line"><span style="color:#6A737D;"># 可以看到第一段为deployment名字，最后一段为随机值，中间的fb544c5d8为replicaset中Pod模板的哈希值，也就是template字段的哈希值</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 查看replicaset信息</span></span>
<span class="line"><span style="color:#B392F0;">root@k8s-master01:~/yaml/chapter08#</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">get</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">replicasets.apps</span></span>
<span class="line"><span style="color:#B392F0;">NAME</span><span style="color:#E1E4E8;">                        </span><span style="color:#9ECBFF;">DESIRED</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">CURRENT</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">READY</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">AGE</span></span>
<span class="line"><span style="color:#B392F0;">deployment-demo-fb544c5d8</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">4</span><span style="color:#E1E4E8;">         </span><span style="color:#79B8FF;">4</span><span style="color:#E1E4E8;">         </span><span style="color:#79B8FF;">4</span><span style="color:#E1E4E8;">       </span><span style="color:#79B8FF;">4</span><span style="color:#9ECBFF;">m5s</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 一旦pod模板发生变更，会导致ReplicaSet的哈希值发生变化，然后出发deployment更新的</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;"># 查看deployment信息</span></span>
<span class="line"><span style="color:#6F42C1;">root@k8s-master01:~/yaml/chapter08#</span><span style="color:#24292E;"> </span><span style="color:#032F62;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">get</span><span style="color:#24292E;"> </span><span style="color:#032F62;">deployments.apps</span></span>
<span class="line"><span style="color:#6F42C1;">NAME</span><span style="color:#24292E;">              </span><span style="color:#032F62;">READY</span><span style="color:#24292E;">   </span><span style="color:#032F62;">UP-TO-DATE</span><span style="color:#24292E;">   </span><span style="color:#032F62;">AVAILABLE</span><span style="color:#24292E;">   </span><span style="color:#032F62;">AGE</span></span>
<span class="line"><span style="color:#6F42C1;">deployment-demo</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">4</span><span style="color:#032F62;">/4</span><span style="color:#24292E;">     </span><span style="color:#005CC5;">4</span><span style="color:#24292E;">            </span><span style="color:#005CC5;">4</span><span style="color:#24292E;">           </span><span style="color:#005CC5;">12</span><span style="color:#032F62;">s</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 查看pod信息</span></span>
<span class="line"><span style="color:#6F42C1;">root@k8s-master01:~/yaml/chapter08#</span><span style="color:#24292E;"> </span><span style="color:#032F62;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">get</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pods</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-l</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;app=demoapp,release=stable&#39;</span></span>
<span class="line"><span style="color:#6F42C1;">NAME</span><span style="color:#24292E;">                              </span><span style="color:#032F62;">READY</span><span style="color:#24292E;">   </span><span style="color:#032F62;">STATUS</span><span style="color:#24292E;">    </span><span style="color:#032F62;">RESTARTS</span><span style="color:#24292E;">   </span><span style="color:#032F62;">AGE</span></span>
<span class="line"><span style="color:#6F42C1;">deployment-demo-fb544c5d8-2687q</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">1</span><span style="color:#032F62;">/1</span><span style="color:#24292E;">     </span><span style="color:#032F62;">Running</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">          </span><span style="color:#005CC5;">2</span><span style="color:#032F62;">m16s</span></span>
<span class="line"><span style="color:#6F42C1;">deployment-demo-fb544c5d8-2t6q4</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">1</span><span style="color:#032F62;">/1</span><span style="color:#24292E;">     </span><span style="color:#032F62;">Running</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">          </span><span style="color:#005CC5;">2</span><span style="color:#032F62;">m16s</span></span>
<span class="line"><span style="color:#6F42C1;">deployment-demo-fb544c5d8-pkgzn</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">1</span><span style="color:#032F62;">/1</span><span style="color:#24292E;">     </span><span style="color:#032F62;">Running</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">          </span><span style="color:#005CC5;">2</span><span style="color:#032F62;">m16s</span></span>
<span class="line"><span style="color:#6F42C1;">deployment-demo-fb544c5d8-w52qp</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">1</span><span style="color:#032F62;">/1</span><span style="color:#24292E;">     </span><span style="color:#032F62;">Running</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">          </span><span style="color:#005CC5;">2</span><span style="color:#032F62;">m16s</span></span>
<span class="line"><span style="color:#6A737D;"># 可以看到第一段为deployment名字，最后一段为随机值，中间的fb544c5d8为replicaset中Pod模板的哈希值，也就是template字段的哈希值</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 查看replicaset信息</span></span>
<span class="line"><span style="color:#6F42C1;">root@k8s-master01:~/yaml/chapter08#</span><span style="color:#24292E;"> </span><span style="color:#032F62;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">get</span><span style="color:#24292E;"> </span><span style="color:#032F62;">replicasets.apps</span></span>
<span class="line"><span style="color:#6F42C1;">NAME</span><span style="color:#24292E;">                        </span><span style="color:#032F62;">DESIRED</span><span style="color:#24292E;">   </span><span style="color:#032F62;">CURRENT</span><span style="color:#24292E;">   </span><span style="color:#032F62;">READY</span><span style="color:#24292E;">   </span><span style="color:#032F62;">AGE</span></span>
<span class="line"><span style="color:#6F42C1;">deployment-demo-fb544c5d8</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">4</span><span style="color:#24292E;">         </span><span style="color:#005CC5;">4</span><span style="color:#24292E;">         </span><span style="color:#005CC5;">4</span><span style="color:#24292E;">       </span><span style="color:#005CC5;">4</span><span style="color:#032F62;">m5s</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 一旦pod模板发生变更，会导致ReplicaSet的哈希值发生变化，然后出发deployment更新的</span></span></code></pre></div><h2 id="_3-查看deployment的描述信息" tabindex="-1">3. 查看deployment的描述信息 <a class="header-anchor" href="#_3-查看deployment的描述信息" aria-label="Permalink to &quot;3. 查看deployment的描述信息&quot;">​</a></h2><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">describe</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">deployments.apps</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">deployment-demo</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">Name:</span><span style="color:#E1E4E8;">                   </span><span style="color:#9ECBFF;">deployment-demo</span></span>
<span class="line"><span style="color:#B392F0;">Namespace:</span><span style="color:#E1E4E8;">              </span><span style="color:#9ECBFF;">default</span></span>
<span class="line"><span style="color:#B392F0;">CreationTimestamp:</span><span style="color:#E1E4E8;">      </span><span style="color:#9ECBFF;">Wed,</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">21</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Apr</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2024</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">13</span><span style="color:#9ECBFF;">:23:13</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">+0000</span></span>
<span class="line"><span style="color:#B392F0;">Labels:</span><span style="color:#E1E4E8;">                 </span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">non</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span></span>
<span class="line"><span style="color:#B392F0;">Annotations:</span><span style="color:#E1E4E8;">            </span><span style="color:#9ECBFF;">deployment.kubernetes.io/revision:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">1</span></span>
<span class="line"><span style="color:#B392F0;">Selector:</span><span style="color:#E1E4E8;">               </span><span style="color:#9ECBFF;">app=demoapp,release=stable</span></span>
<span class="line"><span style="color:#B392F0;">Replicas:</span><span style="color:#E1E4E8;">               </span><span style="color:#79B8FF;">4</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">desired</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">4</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">updated</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">4</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">total</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">4</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">available</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">0</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">unavailable</span></span>
<span class="line"><span style="color:#B392F0;">StrategyType:</span><span style="color:#E1E4E8;">           </span><span style="color:#9ECBFF;">RollingUpdate</span><span style="color:#E1E4E8;">      </span><span style="color:#6A737D;"># 一旦模板发生变化将触发滚动跟新</span></span>
<span class="line"><span style="color:#B392F0;">MinReadySeconds:</span><span style="color:#E1E4E8;">        </span><span style="color:#79B8FF;">0</span></span>
<span class="line"><span style="color:#B392F0;">RollingUpdateStrategy:</span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">25</span><span style="color:#9ECBFF;">%</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">max</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">unavailable,</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">25</span><span style="color:#9ECBFF;">%</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">max</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">surge</span><span style="color:#E1E4E8;">     </span><span style="color:#6A737D;"># 滚动更新逻辑</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">describe</span><span style="color:#24292E;"> </span><span style="color:#032F62;">deployments.apps</span><span style="color:#24292E;"> </span><span style="color:#032F62;">deployment-demo</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">Name:</span><span style="color:#24292E;">                   </span><span style="color:#032F62;">deployment-demo</span></span>
<span class="line"><span style="color:#6F42C1;">Namespace:</span><span style="color:#24292E;">              </span><span style="color:#032F62;">default</span></span>
<span class="line"><span style="color:#6F42C1;">CreationTimestamp:</span><span style="color:#24292E;">      </span><span style="color:#032F62;">Wed,</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">21</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Apr</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2024</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">13</span><span style="color:#032F62;">:23:13</span><span style="color:#24292E;"> </span><span style="color:#032F62;">+0000</span></span>
<span class="line"><span style="color:#6F42C1;">Labels:</span><span style="color:#24292E;">                 </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">non</span><span style="color:#24292E;">e</span><span style="color:#D73A49;">&gt;</span></span>
<span class="line"><span style="color:#6F42C1;">Annotations:</span><span style="color:#24292E;">            </span><span style="color:#032F62;">deployment.kubernetes.io/revision:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1</span></span>
<span class="line"><span style="color:#6F42C1;">Selector:</span><span style="color:#24292E;">               </span><span style="color:#032F62;">app=demoapp,release=stable</span></span>
<span class="line"><span style="color:#6F42C1;">Replicas:</span><span style="color:#24292E;">               </span><span style="color:#005CC5;">4</span><span style="color:#24292E;"> </span><span style="color:#032F62;">desired</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">4</span><span style="color:#24292E;"> </span><span style="color:#032F62;">updated</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">4</span><span style="color:#24292E;"> </span><span style="color:#032F62;">total</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">4</span><span style="color:#24292E;"> </span><span style="color:#032F62;">available</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">0</span><span style="color:#24292E;"> </span><span style="color:#032F62;">unavailable</span></span>
<span class="line"><span style="color:#6F42C1;">StrategyType:</span><span style="color:#24292E;">           </span><span style="color:#032F62;">RollingUpdate</span><span style="color:#24292E;">      </span><span style="color:#6A737D;"># 一旦模板发生变化将触发滚动跟新</span></span>
<span class="line"><span style="color:#6F42C1;">MinReadySeconds:</span><span style="color:#24292E;">        </span><span style="color:#005CC5;">0</span></span>
<span class="line"><span style="color:#6F42C1;">RollingUpdateStrategy:</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">25</span><span style="color:#032F62;">%</span><span style="color:#24292E;"> </span><span style="color:#032F62;">max</span><span style="color:#24292E;"> </span><span style="color:#032F62;">unavailable,</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">25</span><span style="color:#032F62;">%</span><span style="color:#24292E;"> </span><span style="color:#032F62;">max</span><span style="color:#24292E;"> </span><span style="color:#032F62;">surge</span><span style="color:#24292E;">     </span><span style="color:#6A737D;"># 滚动更新逻辑</span></span></code></pre></div><h2 id="_4-更新" tabindex="-1">4. 更新 <a class="header-anchor" href="#_4-更新" aria-label="Permalink to &quot;4. 更新&quot;">​</a></h2><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">VERSION=v2.0 envsubst &lt; deployment-demo.yaml | kubectl apply -f -</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">VERSION=v2.0 envsubst &lt; deployment-demo.yaml | kubectl apply -f -</span></span></code></pre></div><ul><li>使用rollout查看滚动更新的状态</li></ul><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">kubectl rollout status deployment deployment-demo</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">kubectl rollout status deployment deployment-demo</span></span></code></pre></div><ul><li>查看pod是否更新为v2.0版本</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">get</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pods</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-o</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">wide</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 对pod进行访问</span></span>
<span class="line"><span style="color:#B392F0;">root@k8s-master01:~#</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">curl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pod_ip</span></span>
<span class="line"><span style="color:#B392F0;">hsuing</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">demoapp</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">v2.0</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">!!</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">ClientIP:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">10.244</span><span style="color:#9ECBFF;">.0.0,</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">ServerName:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">deployment-demo-867c7d9d55-b4trp,</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">ServerIP:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">10.244</span><span style="color:#9ECBFF;">.3.33!</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">get</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pods</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-o</span><span style="color:#24292E;"> </span><span style="color:#032F62;">wide</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 对pod进行访问</span></span>
<span class="line"><span style="color:#6F42C1;">root@k8s-master01:~#</span><span style="color:#24292E;"> </span><span style="color:#032F62;">curl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pod_ip</span></span>
<span class="line"><span style="color:#6F42C1;">hsuing</span><span style="color:#24292E;"> </span><span style="color:#032F62;">demoapp</span><span style="color:#24292E;"> </span><span style="color:#032F62;">v2.0</span><span style="color:#24292E;"> </span><span style="color:#032F62;">!!</span><span style="color:#24292E;"> </span><span style="color:#032F62;">ClientIP:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">10.244</span><span style="color:#032F62;">.0.0,</span><span style="color:#24292E;"> </span><span style="color:#032F62;">ServerName:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">deployment-demo-867c7d9d55-b4trp,</span><span style="color:#24292E;"> </span><span style="color:#032F62;">ServerIP:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">10.244</span><span style="color:#032F62;">.3.33!</span></span></code></pre></div><h2 id="_5-回滚" tabindex="-1">5. 回滚 <a class="header-anchor" href="#_5-回滚" aria-label="Permalink to &quot;5. 回滚&quot;">​</a></h2><ul><li>查看<code>deployment</code>的更新历史信息</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">root@k8s-master01:~#</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">rollout</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">history</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">deployment</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">deployment-demo</span></span>
<span class="line"><span style="color:#B392F0;">deployment.apps/deployment-demo</span></span>
<span class="line"><span style="color:#B392F0;">REVISION</span><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">CHANGE-CAUSE</span></span>
<span class="line"><span style="color:#B392F0;">1</span><span style="color:#E1E4E8;">         </span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">non</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span></span>
<span class="line"><span style="color:#B392F0;">2</span><span style="color:#E1E4E8;">         </span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">non</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;">   </span><span style="color:#6A737D;"># 此为当前版本信息</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">root@k8s-master01:~#</span><span style="color:#24292E;"> </span><span style="color:#032F62;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">rollout</span><span style="color:#24292E;"> </span><span style="color:#032F62;">history</span><span style="color:#24292E;"> </span><span style="color:#032F62;">deployment</span><span style="color:#24292E;"> </span><span style="color:#032F62;">deployment-demo</span></span>
<span class="line"><span style="color:#6F42C1;">deployment.apps/deployment-demo</span></span>
<span class="line"><span style="color:#6F42C1;">REVISION</span><span style="color:#24292E;">  </span><span style="color:#032F62;">CHANGE-CAUSE</span></span>
<span class="line"><span style="color:#6F42C1;">1</span><span style="color:#24292E;">         </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">non</span><span style="color:#24292E;">e</span><span style="color:#D73A49;">&gt;</span></span>
<span class="line"><span style="color:#6F42C1;">2</span><span style="color:#24292E;">         </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">non</span><span style="color:#24292E;">e</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;">   </span><span style="color:#6A737D;"># 此为当前版本信息</span></span></code></pre></div><ul><li>将其回滚到上一个版本</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">rollout</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">undo</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">deployment</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">deployment-demo</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">rollout</span><span style="color:#24292E;"> </span><span style="color:#032F62;">undo</span><span style="color:#24292E;"> </span><span style="color:#032F62;">deployment</span><span style="color:#24292E;"> </span><span style="color:#032F62;">deployment-demo</span></span></code></pre></div><ul><li>查看replicaset信息</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">root@k8s-master01:~#</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">get</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">rs</span></span>
<span class="line"><span style="color:#B392F0;">NAME</span><span style="color:#E1E4E8;">                         </span><span style="color:#9ECBFF;">DESIRED</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">CURRENT</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">READY</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">AGE</span></span>
<span class="line"><span style="color:#B392F0;">deployment-demo-867c7d9d55</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">         </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">         </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">       </span><span style="color:#79B8FF;">24</span><span style="color:#9ECBFF;">m</span></span>
<span class="line"><span style="color:#B392F0;">deployment-demo-fb544c5d8</span><span style="color:#E1E4E8;">    </span><span style="color:#79B8FF;">4</span><span style="color:#E1E4E8;">         </span><span style="color:#79B8FF;">4</span><span style="color:#E1E4E8;">         </span><span style="color:#79B8FF;">4</span><span style="color:#E1E4E8;">       </span><span style="color:#79B8FF;">48</span><span style="color:#9ECBFF;">m</span></span>
<span class="line"><span style="color:#6A737D;"># 原本的deployment-demo-867c7d9d55已经变为0</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">root@k8s-master01:~#</span><span style="color:#24292E;"> </span><span style="color:#032F62;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">get</span><span style="color:#24292E;"> </span><span style="color:#032F62;">rs</span></span>
<span class="line"><span style="color:#6F42C1;">NAME</span><span style="color:#24292E;">                         </span><span style="color:#032F62;">DESIRED</span><span style="color:#24292E;">   </span><span style="color:#032F62;">CURRENT</span><span style="color:#24292E;">   </span><span style="color:#032F62;">READY</span><span style="color:#24292E;">   </span><span style="color:#032F62;">AGE</span></span>
<span class="line"><span style="color:#6F42C1;">deployment-demo-867c7d9d55</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">         </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">         </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">       </span><span style="color:#005CC5;">24</span><span style="color:#032F62;">m</span></span>
<span class="line"><span style="color:#6F42C1;">deployment-demo-fb544c5d8</span><span style="color:#24292E;">    </span><span style="color:#005CC5;">4</span><span style="color:#24292E;">         </span><span style="color:#005CC5;">4</span><span style="color:#24292E;">         </span><span style="color:#005CC5;">4</span><span style="color:#24292E;">       </span><span style="color:#005CC5;">48</span><span style="color:#032F62;">m</span></span>
<span class="line"><span style="color:#6A737D;"># 原本的deployment-demo-867c7d9d55已经变为0</span></span></code></pre></div><ul><li>再次查看更新历史</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">root@k8s-master01:~#</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">rollout</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">history</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">deployment</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">deployment-demo</span></span>
<span class="line"><span style="color:#B392F0;">deployment.apps/deployment-demo</span></span>
<span class="line"><span style="color:#B392F0;">REVISION</span><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">CHANGE-CAUSE</span></span>
<span class="line"><span style="color:#B392F0;">2</span><span style="color:#E1E4E8;">         </span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">non</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span></span>
<span class="line"><span style="color:#B392F0;">3</span><span style="color:#E1E4E8;">         </span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">non</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span></span>
<span class="line"><span style="color:#6A737D;"># 可以看到原本的1没有了新增了3，3表示当前的</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">root@k8s-master01:~#</span><span style="color:#24292E;"> </span><span style="color:#032F62;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">rollout</span><span style="color:#24292E;"> </span><span style="color:#032F62;">history</span><span style="color:#24292E;"> </span><span style="color:#032F62;">deployment</span><span style="color:#24292E;"> </span><span style="color:#032F62;">deployment-demo</span></span>
<span class="line"><span style="color:#6F42C1;">deployment.apps/deployment-demo</span></span>
<span class="line"><span style="color:#6F42C1;">REVISION</span><span style="color:#24292E;">  </span><span style="color:#032F62;">CHANGE-CAUSE</span></span>
<span class="line"><span style="color:#6F42C1;">2</span><span style="color:#24292E;">         </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">non</span><span style="color:#24292E;">e</span><span style="color:#D73A49;">&gt;</span></span>
<span class="line"><span style="color:#6F42C1;">3</span><span style="color:#24292E;">         </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">non</span><span style="color:#24292E;">e</span><span style="color:#D73A49;">&gt;</span></span>
<span class="line"><span style="color:#6A737D;"># 可以看到原本的1没有了新增了3，3表示当前的</span></span></code></pre></div><blockquote><p>VERSION=v1.2 envsubst &lt; deployment-demo.yaml | kubectl apply -f - &amp;&amp; kubectl rollout pause deployment deployment-demo</p><p>kubectl rollout status deployment deployment-demo</p><p>kubectl rollout resume deployment deployment-demo</p></blockquote>`,24),e=[o];function t(c,r,y,E,F,i){return a(),n("div",null,e)}const m=s(p,[["render",t]]);export{C as __pageData,m as default};
