import{_ as s,o as a,c as n,R as p}from"./chunks/framework.zUbWieqp.js";const F=JSON.parse('{"title":"9,表空间创建","description":"","frontmatter":{},"headers":[],"relativePath":"guide/Database/pgSql/base/6-pg_tablespace.md","filePath":"guide/Database/pgSql/base/6-pg_tablespace.md","lastUpdated":1711535325000}'),l={name:"guide/Database/pgSql/base/6-pg_tablespace.md"},o=p(`<h1 id="_9-表空间创建" tabindex="-1">9,表空间创建 <a class="header-anchor" href="#_9-表空间创建" aria-label="Permalink to &quot;9,表空间创建&quot;">​</a></h1><p>表空间：字面上理解就是表存储的物理空间，其实包括数据库的表、索引、序列等。</p><p>PostgreSQL使用表空间映射逻辑名称和磁盘物理位置。默认提供了两个表空间：</p><ul><li>pg_default 表空间存储用户数据.</li><li>pg_global 表空间存储全局数据.</li></ul><p>表空间名称不能以pg开头，因为这些名称为系统表空间保留。默认执行CREATE TABLESPACE语句的用户是表空间的拥有者。如果需要给其他用户赋权，可以值后面指定owner关键词。</p><p>directory_path是表空间使用空目录的绝对路径，PostgreSQL的用户必须拥有该目录的权限可以进行读写操作</p><p>可以将表空间创建在服务器的不同分区，这样做的好处有：</p><p>一、如果初始化集群所在分区已经用光，可以方便的其他分区上创建表空间已达到扩容的目的。</p><p>二、对于频繁访问的数据可以存储在性能较高、较快的磁盘分区上，而不常用的数据存储在便宜的较慢的磁盘分区上</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">语法：</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">postgres</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">#</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">\\h</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">create</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">tablespace</span></span>
<span class="line"><span style="color:#B392F0;">Command:</span><span style="color:#E1E4E8;">     </span><span style="color:#9ECBFF;">CREATE</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">TABLESPACE</span></span>
<span class="line"><span style="color:#B392F0;">Description:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">define</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">a</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">new</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">tablespace</span></span>
<span class="line"><span style="color:#B392F0;">Syntax:</span></span>
<span class="line"><span style="color:#B392F0;">CREATE</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">TABLESPACE</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">tablespace_name</span></span>
<span class="line"><span style="color:#E1E4E8;">    [ OWNER user_name ]</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">LOCATION</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;directory&#39;</span></span>
<span class="line"><span style="color:#E1E4E8;">    [ WITH ( tablespace_option </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> value [, ... ] ) ]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">用户必须有表空间所在目录访问权限，所以在创建表空间之前需要在对应分区下创建相应的目录，并为其分配权限。</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">[root@pg01 </span><span style="color:#F97583;">~</span><span style="color:#E1E4E8;">]# mkdir /home/ptgres/kongjian</span></span>
<span class="line"><span style="color:#E1E4E8;">[root@pg01 </span><span style="color:#F97583;">~</span><span style="color:#E1E4E8;">]# chown postgres:postgres /home/ptgres/kongjian</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">语法：</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">postgres</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">#</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">\\h</span><span style="color:#24292E;"> </span><span style="color:#032F62;">create</span><span style="color:#24292E;"> </span><span style="color:#032F62;">tablespace</span></span>
<span class="line"><span style="color:#6F42C1;">Command:</span><span style="color:#24292E;">     </span><span style="color:#032F62;">CREATE</span><span style="color:#24292E;"> </span><span style="color:#032F62;">TABLESPACE</span></span>
<span class="line"><span style="color:#6F42C1;">Description:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">define</span><span style="color:#24292E;"> </span><span style="color:#032F62;">a</span><span style="color:#24292E;"> </span><span style="color:#032F62;">new</span><span style="color:#24292E;"> </span><span style="color:#032F62;">tablespace</span></span>
<span class="line"><span style="color:#6F42C1;">Syntax:</span></span>
<span class="line"><span style="color:#6F42C1;">CREATE</span><span style="color:#24292E;"> </span><span style="color:#032F62;">TABLESPACE</span><span style="color:#24292E;"> </span><span style="color:#032F62;">tablespace_name</span></span>
<span class="line"><span style="color:#24292E;">    [ OWNER user_name ]</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">LOCATION</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;directory&#39;</span></span>
<span class="line"><span style="color:#24292E;">    [ WITH ( tablespace_option </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> value [, ... ] ) ]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">用户必须有表空间所在目录访问权限，所以在创建表空间之前需要在对应分区下创建相应的目录，并为其分配权限。</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">[root@pg01 </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# mkdir /home/ptgres/kongjian</span></span>
<span class="line"><span style="color:#24292E;">[root@pg01 </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# chown postgres:postgres /home/ptgres/kongjian</span></span></code></pre></div><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">-- 创建表空间</span></span>
<span class="line"><span style="color:#6A737D;">-- 想在sql命令行下，执行外部shell命令</span></span>
<span class="line"><span style="color:#E1E4E8;">postgres@postgres</span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;">\\! pwd</span></span>
<span class="line"><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">home</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">postgres</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">--不指定用户</span></span>
<span class="line"><span style="color:#E1E4E8;">postgres@postgres</span><span style="color:#F97583;">=&gt;CREATE</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">DATABASE</span><span style="color:#E1E4E8;"> logistics TABLESPACE ts_primary;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">-- 创建表空间属于哪个用户</span></span>
<span class="line"><span style="color:#E1E4E8;">postgres@postgres</span><span style="color:#F97583;">=&gt;create</span><span style="color:#E1E4E8;"> tablespace tbs_test </span><span style="color:#F97583;">owner</span><span style="color:#E1E4E8;"> postgres </span><span style="color:#F97583;">location</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;/home/ptgres/kongjian&#39;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#F97583;">CREATE</span><span style="color:#E1E4E8;"> TABLESPACE</span></span>
<span class="line"><span style="color:#6A737D;">-- 注意：同一个目录只能对应一个表空间</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">-- 查看表空间</span></span>
<span class="line"><span style="color:#E1E4E8;">postgres@postgres</span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;">\\db</span></span>
<span class="line"><span style="color:#E1E4E8;">              List of tablespaces</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">Name</span><span style="color:#E1E4E8;">    |  </span><span style="color:#F97583;">Owner</span><span style="color:#E1E4E8;">   |       </span><span style="color:#F97583;">Location</span><span style="color:#E1E4E8;">        </span></span>
<span class="line"><span style="color:#6A737D;">------------+----------+-----------------------</span></span>
<span class="line"><span style="color:#E1E4E8;"> pg_default | postgres | </span></span>
<span class="line"><span style="color:#E1E4E8;"> pg_global  | postgres | </span></span>
<span class="line"><span style="color:#E1E4E8;"> tbs_test   | postgres | </span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">home</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">ptgres</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">kongjian</span></span>
<span class="line"><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">3</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">rows</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#6A737D;">-- 或者</span></span>
<span class="line"><span style="color:#E1E4E8;">postgres@postgres</span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;">\\db</span><span style="color:#F97583;">+</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">-- 或者</span></span>
<span class="line"><span style="color:#E1E4E8;">postgres@postgres</span><span style="color:#F97583;">=&gt;select</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> pg_tablespace;</span></span>
<span class="line"><span style="color:#E1E4E8;">  spcname   | spcowner | spcacl | spcoptions </span></span>
<span class="line"><span style="color:#6A737D;">------------+----------+--------+------------</span></span>
<span class="line"><span style="color:#E1E4E8;"> pg_default |       </span><span style="color:#79B8FF;">10</span><span style="color:#E1E4E8;"> |        | </span></span>
<span class="line"><span style="color:#E1E4E8;"> pg_global  |       </span><span style="color:#79B8FF;">10</span><span style="color:#E1E4E8;"> |        | </span></span>
<span class="line"><span style="color:#E1E4E8;"> ts01       |       </span><span style="color:#79B8FF;">10</span><span style="color:#E1E4E8;"> |        | </span></span>
<span class="line"><span style="color:#E1E4E8;"> ts02       |    </span><span style="color:#79B8FF;">16384</span><span style="color:#E1E4E8;"> |        | </span></span>
<span class="line"><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">4</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">rows</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">-- 或者指定具体的表空间名字</span></span>
<span class="line"><span style="color:#E1E4E8;">postgres@postgres</span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;">\\db</span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> ts_primary</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">-- 数据库集群目录下</span></span>
<span class="line"><span style="color:#E1E4E8;">[ptgres@pg01 ~]$ ls kongjian</span><span style="color:#F97583;">/</span></span>
<span class="line"><span style="color:#E1E4E8;">PG_12_201909212</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">-- 在此表空间内创建表</span></span>
<span class="line"><span style="color:#6A737D;">-- 切换用户和数据库</span></span>
<span class="line"><span style="color:#E1E4E8;">postgres@postgres</span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;">\\c </span><span style="color:#F97583;">database_name</span><span style="color:#E1E4E8;"> username;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">postgres@postgres</span><span style="color:#F97583;">=&gt;create</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">table</span><span style="color:#E1E4E8;"> test(a </span><span style="color:#F97583;">int</span><span style="color:#E1E4E8;">) tablespace tbs_test;</span></span>
<span class="line"><span style="color:#F97583;">CREATE</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">TABLE</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">[ptgres@pg01 13447]$ ls</span></span>
<span class="line"><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">home</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">ptgres</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">kongjian</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">PG_12_201909212</span><span style="color:#F97583;">/</span><span style="color:#79B8FF;">13447</span><span style="color:#F97583;">/</span><span style="color:#79B8FF;">16421</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">-- 其中16421对应的是test表的relfilenode，13447是数据库postgres的oid</span></span>
<span class="line"><span style="color:#E1E4E8;">postgres@postgres</span><span style="color:#F97583;">=&gt;select</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">oid</span><span style="color:#E1E4E8;">,datname </span><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> pg_database </span><span style="color:#F97583;">where</span><span style="color:#E1E4E8;"> datname </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;postgres&#39;</span><span style="color:#E1E4E8;">; </span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">oid</span><span style="color:#E1E4E8;">  | datname  </span></span>
<span class="line"><span style="color:#6A737D;">-------+----------</span></span>
<span class="line"><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">13447</span><span style="color:#E1E4E8;"> | postgres</span></span>
<span class="line"><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">row</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">postgres@postgres</span><span style="color:#F97583;">=&gt;select</span><span style="color:#E1E4E8;"> relname,relfilenode </span><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> pg_class </span><span style="color:#F97583;">where</span><span style="color:#E1E4E8;"> relname</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&#39;test&#39;</span><span style="color:#E1E4E8;">; </span></span>
<span class="line"><span style="color:#E1E4E8;"> relname | relfilenode </span></span>
<span class="line"><span style="color:#6A737D;">---------+-------------</span></span>
<span class="line"><span style="color:#E1E4E8;"> test    |       </span><span style="color:#79B8FF;">16421</span></span>
<span class="line"><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">row</span><span style="color:#E1E4E8;">)</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">-- 创建表空间</span></span>
<span class="line"><span style="color:#6A737D;">-- 想在sql命令行下，执行外部shell命令</span></span>
<span class="line"><span style="color:#24292E;">postgres@postgres</span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;">\\! pwd</span></span>
<span class="line"><span style="color:#D73A49;">/</span><span style="color:#24292E;">home</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">postgres</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">--不指定用户</span></span>
<span class="line"><span style="color:#24292E;">postgres@postgres</span><span style="color:#D73A49;">=&gt;CREATE</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">DATABASE</span><span style="color:#24292E;"> logistics TABLESPACE ts_primary;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">-- 创建表空间属于哪个用户</span></span>
<span class="line"><span style="color:#24292E;">postgres@postgres</span><span style="color:#D73A49;">=&gt;create</span><span style="color:#24292E;"> tablespace tbs_test </span><span style="color:#D73A49;">owner</span><span style="color:#24292E;"> postgres </span><span style="color:#D73A49;">location</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;/home/ptgres/kongjian&#39;</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#D73A49;">CREATE</span><span style="color:#24292E;"> TABLESPACE</span></span>
<span class="line"><span style="color:#6A737D;">-- 注意：同一个目录只能对应一个表空间</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">-- 查看表空间</span></span>
<span class="line"><span style="color:#24292E;">postgres@postgres</span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;">\\db</span></span>
<span class="line"><span style="color:#24292E;">              List of tablespaces</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">Name</span><span style="color:#24292E;">    |  </span><span style="color:#D73A49;">Owner</span><span style="color:#24292E;">   |       </span><span style="color:#D73A49;">Location</span><span style="color:#24292E;">        </span></span>
<span class="line"><span style="color:#6A737D;">------------+----------+-----------------------</span></span>
<span class="line"><span style="color:#24292E;"> pg_default | postgres | </span></span>
<span class="line"><span style="color:#24292E;"> pg_global  | postgres | </span></span>
<span class="line"><span style="color:#24292E;"> tbs_test   | postgres | </span><span style="color:#D73A49;">/</span><span style="color:#24292E;">home</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">ptgres</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">kongjian</span></span>
<span class="line"><span style="color:#24292E;">(</span><span style="color:#005CC5;">3</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">rows</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#6A737D;">-- 或者</span></span>
<span class="line"><span style="color:#24292E;">postgres@postgres</span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;">\\db</span><span style="color:#D73A49;">+</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">-- 或者</span></span>
<span class="line"><span style="color:#24292E;">postgres@postgres</span><span style="color:#D73A49;">=&gt;select</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">*</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">from</span><span style="color:#24292E;"> pg_tablespace;</span></span>
<span class="line"><span style="color:#24292E;">  spcname   | spcowner | spcacl | spcoptions </span></span>
<span class="line"><span style="color:#6A737D;">------------+----------+--------+------------</span></span>
<span class="line"><span style="color:#24292E;"> pg_default |       </span><span style="color:#005CC5;">10</span><span style="color:#24292E;"> |        | </span></span>
<span class="line"><span style="color:#24292E;"> pg_global  |       </span><span style="color:#005CC5;">10</span><span style="color:#24292E;"> |        | </span></span>
<span class="line"><span style="color:#24292E;"> ts01       |       </span><span style="color:#005CC5;">10</span><span style="color:#24292E;"> |        | </span></span>
<span class="line"><span style="color:#24292E;"> ts02       |    </span><span style="color:#005CC5;">16384</span><span style="color:#24292E;"> |        | </span></span>
<span class="line"><span style="color:#24292E;">(</span><span style="color:#005CC5;">4</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">rows</span><span style="color:#24292E;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">-- 或者指定具体的表空间名字</span></span>
<span class="line"><span style="color:#24292E;">postgres@postgres</span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;">\\db</span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> ts_primary</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">-- 数据库集群目录下</span></span>
<span class="line"><span style="color:#24292E;">[ptgres@pg01 ~]$ ls kongjian</span><span style="color:#D73A49;">/</span></span>
<span class="line"><span style="color:#24292E;">PG_12_201909212</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">-- 在此表空间内创建表</span></span>
<span class="line"><span style="color:#6A737D;">-- 切换用户和数据库</span></span>
<span class="line"><span style="color:#24292E;">postgres@postgres</span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;">\\c </span><span style="color:#D73A49;">database_name</span><span style="color:#24292E;"> username;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">postgres@postgres</span><span style="color:#D73A49;">=&gt;create</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">table</span><span style="color:#24292E;"> test(a </span><span style="color:#D73A49;">int</span><span style="color:#24292E;">) tablespace tbs_test;</span></span>
<span class="line"><span style="color:#D73A49;">CREATE</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">TABLE</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">[ptgres@pg01 13447]$ ls</span></span>
<span class="line"><span style="color:#D73A49;">/</span><span style="color:#24292E;">home</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">ptgres</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">kongjian</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">PG_12_201909212</span><span style="color:#D73A49;">/</span><span style="color:#005CC5;">13447</span><span style="color:#D73A49;">/</span><span style="color:#005CC5;">16421</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">-- 其中16421对应的是test表的relfilenode，13447是数据库postgres的oid</span></span>
<span class="line"><span style="color:#24292E;">postgres@postgres</span><span style="color:#D73A49;">=&gt;select</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">oid</span><span style="color:#24292E;">,datname </span><span style="color:#D73A49;">from</span><span style="color:#24292E;"> pg_database </span><span style="color:#D73A49;">where</span><span style="color:#24292E;"> datname </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;postgres&#39;</span><span style="color:#24292E;">; </span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">oid</span><span style="color:#24292E;">  | datname  </span></span>
<span class="line"><span style="color:#6A737D;">-------+----------</span></span>
<span class="line"><span style="color:#24292E;"> </span><span style="color:#005CC5;">13447</span><span style="color:#24292E;"> | postgres</span></span>
<span class="line"><span style="color:#24292E;">(</span><span style="color:#005CC5;">1</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">row</span><span style="color:#24292E;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">postgres@postgres</span><span style="color:#D73A49;">=&gt;select</span><span style="color:#24292E;"> relname,relfilenode </span><span style="color:#D73A49;">from</span><span style="color:#24292E;"> pg_class </span><span style="color:#D73A49;">where</span><span style="color:#24292E;"> relname</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&#39;test&#39;</span><span style="color:#24292E;">; </span></span>
<span class="line"><span style="color:#24292E;"> relname | relfilenode </span></span>
<span class="line"><span style="color:#6A737D;">---------+-------------</span></span>
<span class="line"><span style="color:#24292E;"> test    |       </span><span style="color:#005CC5;">16421</span></span>
<span class="line"><span style="color:#24292E;">(</span><span style="color:#005CC5;">1</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">row</span><span style="color:#24292E;">)</span></span></code></pre></div><ul><li>普通用户使用表空间</li></ul><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">-- 默认对ts01没有权限</span></span>
<span class="line"><span style="color:#E1E4E8;">database2</span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">create</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">table</span><span style="color:#E1E4E8;"> t2(id </span><span style="color:#F97583;">text</span><span style="color:#E1E4E8;">) tablespace ts01;</span></span>
<span class="line"><span style="color:#E1E4E8;">ERROR:  permission denied </span><span style="color:#F97583;">for</span><span style="color:#E1E4E8;"> tablespace ts01</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">database2</span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> \\c </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;"> postgres</span></span>
<span class="line"><span style="color:#E1E4E8;">You are </span><span style="color:#F97583;">now</span><span style="color:#E1E4E8;"> connected </span><span style="color:#F97583;">to</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">database</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;database2&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> user </span><span style="color:#9ECBFF;">&quot;postgres&quot;</span><span style="color:#E1E4E8;">.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">database2</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"># </span><span style="color:#F97583;">alter</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">database</span><span style="color:#E1E4E8;"> database2 </span><span style="color:#F97583;">set</span><span style="color:#E1E4E8;"> tablespace ts01; </span><span style="color:#6A737D;">--连接在上面不能进行更改</span></span>
<span class="line"><span style="color:#E1E4E8;">ERROR:  cannot change the tablespace of the currently </span><span style="color:#F97583;">open</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">database</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">database2</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"># \\c postgres postgres</span></span>
<span class="line"><span style="color:#E1E4E8;">You are </span><span style="color:#F97583;">now</span><span style="color:#E1E4E8;"> connected </span><span style="color:#F97583;">to</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">database</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;postgres&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> user </span><span style="color:#9ECBFF;">&quot;postgres&quot;</span><span style="color:#E1E4E8;">.</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">-- 默认对ts01没有权限</span></span>
<span class="line"><span style="color:#24292E;">database2</span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">create</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">table</span><span style="color:#24292E;"> t2(id </span><span style="color:#D73A49;">text</span><span style="color:#24292E;">) tablespace ts01;</span></span>
<span class="line"><span style="color:#24292E;">ERROR:  permission denied </span><span style="color:#D73A49;">for</span><span style="color:#24292E;"> tablespace ts01</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">database2</span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> \\c </span><span style="color:#D73A49;">-</span><span style="color:#24292E;"> postgres</span></span>
<span class="line"><span style="color:#24292E;">You are </span><span style="color:#D73A49;">now</span><span style="color:#24292E;"> connected </span><span style="color:#D73A49;">to</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">database</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;database2&quot;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> user </span><span style="color:#032F62;">&quot;postgres&quot;</span><span style="color:#24292E;">.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">database2</span><span style="color:#D73A49;">=</span><span style="color:#24292E;"># </span><span style="color:#D73A49;">alter</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">database</span><span style="color:#24292E;"> database2 </span><span style="color:#D73A49;">set</span><span style="color:#24292E;"> tablespace ts01; </span><span style="color:#6A737D;">--连接在上面不能进行更改</span></span>
<span class="line"><span style="color:#24292E;">ERROR:  cannot change the tablespace of the currently </span><span style="color:#D73A49;">open</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">database</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">database2</span><span style="color:#D73A49;">=</span><span style="color:#24292E;"># \\c postgres postgres</span></span>
<span class="line"><span style="color:#24292E;">You are </span><span style="color:#D73A49;">now</span><span style="color:#24292E;"> connected </span><span style="color:#D73A49;">to</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">database</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;postgres&quot;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> user </span><span style="color:#032F62;">&quot;postgres&quot;</span><span style="color:#24292E;">.</span></span></code></pre></div><ul><li>设置默认表空间</li></ul><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">postgres</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"># </span><span style="color:#F97583;">alter</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">database</span><span style="color:#E1E4E8;"> database2 </span><span style="color:#F97583;">set</span><span style="color:#E1E4E8;"> tablespace ts01;</span></span>
<span class="line"><span style="color:#F97583;">ALTER</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">DATABASE</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">postgres</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"># \\c database2 user2</span></span>
<span class="line"><span style="color:#E1E4E8;">You are </span><span style="color:#F97583;">now</span><span style="color:#E1E4E8;"> connected </span><span style="color:#F97583;">to</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">database</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;database2&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> user </span><span style="color:#9ECBFF;">&quot;user2&quot;</span><span style="color:#E1E4E8;">.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">database2</span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">create</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">table</span><span style="color:#E1E4E8;"> t2(id </span><span style="color:#F97583;">text</span><span style="color:#E1E4E8;">) tablespace ts01;</span></span>
<span class="line"><span style="color:#F97583;">CREATE</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">TABLE</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">postgres</span><span style="color:#D73A49;">=</span><span style="color:#24292E;"># </span><span style="color:#D73A49;">alter</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">database</span><span style="color:#24292E;"> database2 </span><span style="color:#D73A49;">set</span><span style="color:#24292E;"> tablespace ts01;</span></span>
<span class="line"><span style="color:#D73A49;">ALTER</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">DATABASE</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">postgres</span><span style="color:#D73A49;">=</span><span style="color:#24292E;"># \\c database2 user2</span></span>
<span class="line"><span style="color:#24292E;">You are </span><span style="color:#D73A49;">now</span><span style="color:#24292E;"> connected </span><span style="color:#D73A49;">to</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">database</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;database2&quot;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> user </span><span style="color:#032F62;">&quot;user2&quot;</span><span style="color:#24292E;">.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">database2</span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">create</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">table</span><span style="color:#24292E;"> t2(id </span><span style="color:#D73A49;">text</span><span style="color:#24292E;">) tablespace ts01;</span></span>
<span class="line"><span style="color:#D73A49;">CREATE</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">TABLE</span></span></code></pre></div><h2 id="_9-1删除表空间" tabindex="-1">9.1删除表空间 <a class="header-anchor" href="#_9-1删除表空间" aria-label="Permalink to &quot;9.1删除表空间&quot;">​</a></h2><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">语法：</span></span>
<span class="line"><span style="color:#E1E4E8;">postgres</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"># \\h </span><span style="color:#F97583;">drop</span><span style="color:#E1E4E8;"> tablespace</span></span>
<span class="line"><span style="color:#E1E4E8;">Command:     </span><span style="color:#F97583;">DROP</span><span style="color:#E1E4E8;"> TABLESPACE</span></span>
<span class="line"><span style="color:#F97583;">Description</span><span style="color:#E1E4E8;">: </span><span style="color:#F97583;">remove</span><span style="color:#E1E4E8;"> a tablespace</span></span>
<span class="line"><span style="color:#E1E4E8;">Syntax:</span></span>
<span class="line"><span style="color:#F97583;">DROP</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">TABLE</span><span style="color:#E1E4E8;">SPACE [ IF EXISTS ] </span><span style="color:#F97583;">name</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">语法：</span></span>
<span class="line"><span style="color:#24292E;">postgres</span><span style="color:#D73A49;">=</span><span style="color:#24292E;"># \\h </span><span style="color:#D73A49;">drop</span><span style="color:#24292E;"> tablespace</span></span>
<span class="line"><span style="color:#24292E;">Command:     </span><span style="color:#D73A49;">DROP</span><span style="color:#24292E;"> TABLESPACE</span></span>
<span class="line"><span style="color:#D73A49;">Description</span><span style="color:#24292E;">: </span><span style="color:#D73A49;">remove</span><span style="color:#24292E;"> a tablespace</span></span>
<span class="line"><span style="color:#24292E;">Syntax:</span></span>
<span class="line"><span style="color:#D73A49;">DROP</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">TABLE</span><span style="color:#24292E;">SPACE [ IF EXISTS ] </span><span style="color:#D73A49;">name</span></span></code></pre></div><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">-- 删除表空间前必须要删除该表空间下的所有数据库对象，否则无法删除</span></span>
<span class="line"><span style="color:#E1E4E8;">postgres@postgres</span><span style="color:#F97583;">=&gt;drop</span><span style="color:#E1E4E8;"> tablespace </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">exists</span><span style="color:#E1E4E8;"> tbs_test;</span></span>
<span class="line"><span style="color:#E1E4E8;">ERROR:  tablespace </span><span style="color:#9ECBFF;">&quot;tbs_test&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">is</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">not</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">empty</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">-- 删除表</span></span>
<span class="line"><span style="color:#E1E4E8;">postgres@postgres</span><span style="color:#F97583;">=&gt;drop</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">table</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">if</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">exists</span><span style="color:#E1E4E8;"> test;</span></span>
<span class="line"><span style="color:#F97583;">DROP</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">TABLE</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">-- 删除刚才在此表空间创建的表test，然后再删除表空间</span></span>
<span class="line"><span style="color:#E1E4E8;">postgres@postgres</span><span style="color:#F97583;">=&gt;drop</span><span style="color:#E1E4E8;"> tablespace </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">exists</span><span style="color:#E1E4E8;"> tbs_test;</span></span>
<span class="line"><span style="color:#F97583;">DROP</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">TABLE</span><span style="color:#E1E4E8;">SPACE</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">-- 删除表空间前必须要删除该表空间下的所有数据库对象，否则无法删除</span></span>
<span class="line"><span style="color:#24292E;">postgres@postgres</span><span style="color:#D73A49;">=&gt;drop</span><span style="color:#24292E;"> tablespace </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">exists</span><span style="color:#24292E;"> tbs_test;</span></span>
<span class="line"><span style="color:#24292E;">ERROR:  tablespace </span><span style="color:#032F62;">&quot;tbs_test&quot;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">is</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">not</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">empty</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">-- 删除表</span></span>
<span class="line"><span style="color:#24292E;">postgres@postgres</span><span style="color:#D73A49;">=&gt;drop</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">table</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">if</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">exists</span><span style="color:#24292E;"> test;</span></span>
<span class="line"><span style="color:#D73A49;">DROP</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">TABLE</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">-- 删除刚才在此表空间创建的表test，然后再删除表空间</span></span>
<span class="line"><span style="color:#24292E;">postgres@postgres</span><span style="color:#D73A49;">=&gt;drop</span><span style="color:#24292E;"> tablespace </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">exists</span><span style="color:#24292E;"> tbs_test;</span></span>
<span class="line"><span style="color:#D73A49;">DROP</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">TABLE</span><span style="color:#24292E;">SPACE</span></span></code></pre></div><h2 id="_9-2授权新用户表空间" tabindex="-1">9.2授权新用户表空间 <a class="header-anchor" href="#_9-2授权新用户表空间" aria-label="Permalink to &quot;9.2授权新用户表空间&quot;">​</a></h2><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">--授权,管理员身份</span></span>
<span class="line"><span style="color:#E1E4E8;">postgres</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"># </span><span style="color:#F97583;">grant</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">create</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">on</span><span style="color:#E1E4E8;"> tablespace 表空间名字 </span><span style="color:#F97583;">to</span><span style="color:#E1E4E8;"> username; </span></span>
<span class="line"><span style="color:#F97583;">GRANT</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">--授权,管理员身份</span></span>
<span class="line"><span style="color:#24292E;">postgres</span><span style="color:#D73A49;">=</span><span style="color:#24292E;"># </span><span style="color:#D73A49;">grant</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">create</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">on</span><span style="color:#24292E;"> tablespace 表空间名字 </span><span style="color:#D73A49;">to</span><span style="color:#24292E;"> username; </span></span>
<span class="line"><span style="color:#D73A49;">GRANT</span></span></code></pre></div><p>#表空间对应与文件系统 PGDATA下的pg_tblspc目录下存放的是表空间的链接</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">[postgres@fnddb pg_tblspc]$ pwd</span></span>
<span class="line"><span style="color:#B392F0;">/var/lib/pgsql/data/pg_tblspc</span></span>
<span class="line"><span style="color:#E1E4E8;">[postgres@fnddb pg_tblspc]$ ll</span></span>
<span class="line"><span style="color:#B392F0;">lrwxrwxrwx.</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">postgres</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">postgres</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">21</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Feb</span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">6</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">22</span><span style="color:#9ECBFF;">:52</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">16423</span><span style="color:#E1E4E8;"> -</span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/var/lib/pgsql/tsdata</span></span>
<span class="line"><span style="color:#B392F0;">lrwxrwxrwx.</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">postgres</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">postgres</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Feb</span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">6</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#9ECBFF;">:04</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">16425</span><span style="color:#E1E4E8;"> -</span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/var/lib/pgsql/tsdata02</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">[postgres@fnddb pg_tblspc]$ pwd</span></span>
<span class="line"><span style="color:#6F42C1;">/var/lib/pgsql/data/pg_tblspc</span></span>
<span class="line"><span style="color:#24292E;">[postgres@fnddb pg_tblspc]$ ll</span></span>
<span class="line"><span style="color:#6F42C1;">lrwxrwxrwx.</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">postgres</span><span style="color:#24292E;"> </span><span style="color:#032F62;">postgres</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">21</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Feb</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">6</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">22</span><span style="color:#032F62;">:52</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">16423</span><span style="color:#24292E;"> -</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/var/lib/pgsql/tsdata</span></span>
<span class="line"><span style="color:#6F42C1;">lrwxrwxrwx.</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">postgres</span><span style="color:#24292E;"> </span><span style="color:#032F62;">postgres</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Feb</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">6</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#032F62;">:04</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">16425</span><span style="color:#24292E;"> -</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/var/lib/pgsql/tsdata02</span></span></code></pre></div><p>#初始化cluster时默认的表空间说明 database cluster初始化时,默认创建两个表空间</p><ul><li>pg_global --系统字典表都存这里</li><li>pg_default --template0,template1默认表空间,因此通过create database 不带tablespace参数创建的数据库都使用此表空间</li></ul><h2 id="_9-3-表空间迁移" tabindex="-1">9.3 表空间迁移 <a class="header-anchor" href="#_9-3-表空间迁移" aria-label="Permalink to &quot;9.3 表空间迁移&quot;">​</a></h2><p>postgresql 的表空间其实就是操作系统的一个文件夹.有时候需要将热点数据移动到SSD盘.就会在数据库层面创建一个表空间指向SSD的文件夹目录</p><ul><li>查看表空间</li></ul><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">postgres</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"># \\l</span><span style="color:#F97583;">+</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">--或者</span></span>
<span class="line"><span style="color:#E1E4E8;">postgres</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"># \\db</span><span style="color:#F97583;">+</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">--或者 查看单独</span></span>
<span class="line"><span style="color:#E1E4E8;">postgres</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"># \\db</span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> table_space_name</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">postgres</span><span style="color:#D73A49;">=</span><span style="color:#24292E;"># \\l</span><span style="color:#D73A49;">+</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">--或者</span></span>
<span class="line"><span style="color:#24292E;">postgres</span><span style="color:#D73A49;">=</span><span style="color:#24292E;"># \\db</span><span style="color:#D73A49;">+</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">--或者 查看单独</span></span>
<span class="line"><span style="color:#24292E;">postgres</span><span style="color:#D73A49;">=</span><span style="color:#24292E;"># \\db</span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> table_space_name</span></span></code></pre></div><p><img src="https://nnaigos.oss-cn-hangzhou.aliyuncs.com/imgs/202403271816947.jpg" alt=""></p><h3 id="准备数据" tabindex="-1">准备数据 <a class="header-anchor" href="#准备数据" aria-label="Permalink to &quot;准备数据&quot;">​</a></h3><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">postgres=# create table tmp_t1 as select * from tmp_t0;</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">postgres=# create table tbl_test (id int, info text, c_time timestamp);</span></span>
<span class="line"><span style="color:#e1e4e8;">CREATE TABLE</span></span>
<span class="line"><span style="color:#e1e4e8;">postgres=# insert into tbl_test select generate_series(1,100000),md5(random()::text),clock_timestamp() ;</span></span>
<span class="line"><span style="color:#e1e4e8;">INSERT 0 100000</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">postgres=# create table tmp_t1 as select * from tmp_t0;</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">postgres=# create table tbl_test (id int, info text, c_time timestamp);</span></span>
<span class="line"><span style="color:#24292e;">CREATE TABLE</span></span>
<span class="line"><span style="color:#24292e;">postgres=# insert into tbl_test select generate_series(1,100000),md5(random()::text),clock_timestamp() ;</span></span>
<span class="line"><span style="color:#24292e;">INSERT 0 100000</span></span></code></pre></div><p><img src="https://nnaigos.oss-cn-hangzhou.aliyuncs.com/imgs/202403271816812.jpg" alt=""></p><p>pg_default 的 Size 由 20m 增长到 30m</p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">postgres</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"># \\d</span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> tbl_test</span></span>
<span class="line"><span style="color:#E1E4E8;">                                            </span><span style="color:#F97583;">Table</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;public.tbl_test&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;"> Column |            </span><span style="color:#F97583;">Type</span><span style="color:#E1E4E8;">             | Collation | Nullable | </span><span style="color:#F97583;">Default</span><span style="color:#E1E4E8;"> | Storage  | </span><span style="color:#F97583;">Stats</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">target</span><span style="color:#E1E4E8;"> | </span><span style="color:#F97583;">Description</span><span style="color:#E1E4E8;"> </span></span>
<span class="line"><span style="color:#6A737D;">--------+-----------------------------+-----------+----------+---------+----------+--------------+-------------</span></span>
<span class="line"><span style="color:#E1E4E8;"> id     | </span><span style="color:#F97583;">integer</span><span style="color:#E1E4E8;">                     |           |          |         | plain    |              | </span></span>
<span class="line"><span style="color:#E1E4E8;"> info   | </span><span style="color:#F97583;">text</span><span style="color:#E1E4E8;">                        |           |          |         | extended |              | </span></span>
<span class="line"><span style="color:#E1E4E8;"> c_time | </span><span style="color:#F97583;">timestamp without time zone</span><span style="color:#E1E4E8;"> |           |          |         | plain    |              | </span></span>
<span class="line"><span style="color:#E1E4E8;">Access method: heap</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">-- 创建索引</span></span>
<span class="line"><span style="color:#E1E4E8;">postgres</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"># </span><span style="color:#F97583;">create</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">index</span><span style="color:#E1E4E8;"> idx_tbl_t1_x1 </span><span style="color:#F97583;">on</span><span style="color:#E1E4E8;"> tbl_test </span><span style="color:#F97583;">using</span><span style="color:#E1E4E8;"> btree (id);</span></span>
<span class="line"><span style="color:#F97583;">CREATE</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">INDEX</span></span>
<span class="line"><span style="color:#E1E4E8;">postgres</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"># \\d</span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> tbl_test</span></span>
<span class="line"><span style="color:#E1E4E8;">                                            </span><span style="color:#F97583;">Table</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;public.tbl_test&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;"> Column |            </span><span style="color:#F97583;">Type</span><span style="color:#E1E4E8;">             | Collation | Nullable | </span><span style="color:#F97583;">Default</span><span style="color:#E1E4E8;"> | Storage  | </span><span style="color:#F97583;">Stats</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">target</span><span style="color:#E1E4E8;"> | </span><span style="color:#F97583;">Description</span><span style="color:#E1E4E8;"> </span></span>
<span class="line"><span style="color:#6A737D;">--------+-----------------------------+-----------+----------+---------+----------+--------------+-------------</span></span>
<span class="line"><span style="color:#E1E4E8;"> id     | </span><span style="color:#F97583;">integer</span><span style="color:#E1E4E8;">                     |           |          |         | plain    |              | </span></span>
<span class="line"><span style="color:#E1E4E8;"> info   | </span><span style="color:#F97583;">text</span><span style="color:#E1E4E8;">                        |           |          |         | extended |              | </span></span>
<span class="line"><span style="color:#E1E4E8;"> c_time | </span><span style="color:#F97583;">timestamp without time zone</span><span style="color:#E1E4E8;"> |           |          |         | plain    |              | </span></span>
<span class="line"><span style="color:#E1E4E8;">Indexes:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">&quot;idx_tbl_t1_x1&quot;</span><span style="color:#E1E4E8;"> btree (id)</span></span>
<span class="line"><span style="color:#E1E4E8;">Access method: heap</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">postgres</span><span style="color:#D73A49;">=</span><span style="color:#24292E;"># \\d</span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> tbl_test</span></span>
<span class="line"><span style="color:#24292E;">                                            </span><span style="color:#D73A49;">Table</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;public.tbl_test&quot;</span></span>
<span class="line"><span style="color:#24292E;"> Column |            </span><span style="color:#D73A49;">Type</span><span style="color:#24292E;">             | Collation | Nullable | </span><span style="color:#D73A49;">Default</span><span style="color:#24292E;"> | Storage  | </span><span style="color:#D73A49;">Stats</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">target</span><span style="color:#24292E;"> | </span><span style="color:#D73A49;">Description</span><span style="color:#24292E;"> </span></span>
<span class="line"><span style="color:#6A737D;">--------+-----------------------------+-----------+----------+---------+----------+--------------+-------------</span></span>
<span class="line"><span style="color:#24292E;"> id     | </span><span style="color:#D73A49;">integer</span><span style="color:#24292E;">                     |           |          |         | plain    |              | </span></span>
<span class="line"><span style="color:#24292E;"> info   | </span><span style="color:#D73A49;">text</span><span style="color:#24292E;">                        |           |          |         | extended |              | </span></span>
<span class="line"><span style="color:#24292E;"> c_time | </span><span style="color:#D73A49;">timestamp without time zone</span><span style="color:#24292E;"> |           |          |         | plain    |              | </span></span>
<span class="line"><span style="color:#24292E;">Access method: heap</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">-- 创建索引</span></span>
<span class="line"><span style="color:#24292E;">postgres</span><span style="color:#D73A49;">=</span><span style="color:#24292E;"># </span><span style="color:#D73A49;">create</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">index</span><span style="color:#24292E;"> idx_tbl_t1_x1 </span><span style="color:#D73A49;">on</span><span style="color:#24292E;"> tbl_test </span><span style="color:#D73A49;">using</span><span style="color:#24292E;"> btree (id);</span></span>
<span class="line"><span style="color:#D73A49;">CREATE</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">INDEX</span></span>
<span class="line"><span style="color:#24292E;">postgres</span><span style="color:#D73A49;">=</span><span style="color:#24292E;"># \\d</span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> tbl_test</span></span>
<span class="line"><span style="color:#24292E;">                                            </span><span style="color:#D73A49;">Table</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;public.tbl_test&quot;</span></span>
<span class="line"><span style="color:#24292E;"> Column |            </span><span style="color:#D73A49;">Type</span><span style="color:#24292E;">             | Collation | Nullable | </span><span style="color:#D73A49;">Default</span><span style="color:#24292E;"> | Storage  | </span><span style="color:#D73A49;">Stats</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">target</span><span style="color:#24292E;"> | </span><span style="color:#D73A49;">Description</span><span style="color:#24292E;"> </span></span>
<span class="line"><span style="color:#6A737D;">--------+-----------------------------+-----------+----------+---------+----------+--------------+-------------</span></span>
<span class="line"><span style="color:#24292E;"> id     | </span><span style="color:#D73A49;">integer</span><span style="color:#24292E;">                     |           |          |         | plain    |              | </span></span>
<span class="line"><span style="color:#24292E;"> info   | </span><span style="color:#D73A49;">text</span><span style="color:#24292E;">                        |           |          |         | extended |              | </span></span>
<span class="line"><span style="color:#24292E;"> c_time | </span><span style="color:#D73A49;">timestamp without time zone</span><span style="color:#24292E;"> |           |          |         | plain    |              | </span></span>
<span class="line"><span style="color:#24292E;">Indexes:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#032F62;">&quot;idx_tbl_t1_x1&quot;</span><span style="color:#24292E;"> btree (id)</span></span>
<span class="line"><span style="color:#24292E;">Access method: heap</span></span></code></pre></div><p>添加索引之后，表空间大小，增加3M</p><p><img src="https://nnaigos.oss-cn-hangzhou.aliyuncs.com/imgs/202403271816829.jpg" alt=""></p><h3 id="创建新的表空间" tabindex="-1">创建新的表空间 <a class="header-anchor" href="#创建新的表空间" aria-label="Permalink to &quot;创建新的表空间&quot;">​</a></h3><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">postgres</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"># </span><span style="color:#F97583;">create</span><span style="color:#E1E4E8;"> tablespace tbs1 </span><span style="color:#F97583;">location</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;/home/ptgres/ts_primary&#39;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#F97583;">CREATE</span><span style="color:#E1E4E8;"> TABLESPACE</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">-- 查看表空间位置</span></span>
<span class="line"><span style="color:#E1E4E8;">[ptgres@pg02 data]$ tree pg_tblspc</span></span>
<span class="line"><span style="color:#E1E4E8;">pg_tblspc</span></span>
<span class="line"><span style="color:#E1E4E8;">└── </span><span style="color:#79B8FF;">16402</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">-&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">home</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">ptgres</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">ts_primary</span></span>
<span class="line"></span>
<span class="line"><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;"> directory, </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;"> files</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">postgres</span><span style="color:#D73A49;">=</span><span style="color:#24292E;"># </span><span style="color:#D73A49;">create</span><span style="color:#24292E;"> tablespace tbs1 </span><span style="color:#D73A49;">location</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;/home/ptgres/ts_primary&#39;</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#D73A49;">CREATE</span><span style="color:#24292E;"> TABLESPACE</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">-- 查看表空间位置</span></span>
<span class="line"><span style="color:#24292E;">[ptgres@pg02 data]$ tree pg_tblspc</span></span>
<span class="line"><span style="color:#24292E;">pg_tblspc</span></span>
<span class="line"><span style="color:#24292E;">└── </span><span style="color:#005CC5;">16402</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">-&gt;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">/</span><span style="color:#24292E;">home</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">ptgres</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">ts_primary</span></span>
<span class="line"></span>
<span class="line"><span style="color:#005CC5;">1</span><span style="color:#24292E;"> directory, </span><span style="color:#005CC5;">0</span><span style="color:#24292E;"> files</span></span></code></pre></div><p><img src="https://nnaigos.oss-cn-hangzhou.aliyuncs.com/imgs/202403271816575.jpg" alt=""></p><h3 id="移动表" tabindex="-1">移动表 <a class="header-anchor" href="#移动表" aria-label="Permalink to &quot;移动表&quot;">​</a></h3><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">postgres</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"># </span><span style="color:#F97583;">alter</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">table</span><span style="color:#E1E4E8;"> tbl_test </span><span style="color:#F97583;">set</span><span style="color:#E1E4E8;"> tablespace tbs1 ;</span></span>
<span class="line"><span style="color:#F97583;">ALTER</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">TABLE</span></span>
<span class="line"><span style="color:#E1E4E8;">postgres</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"># \\dt</span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> tbl_test;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">postgres</span><span style="color:#D73A49;">=</span><span style="color:#24292E;"># </span><span style="color:#D73A49;">alter</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">table</span><span style="color:#24292E;"> tbl_test </span><span style="color:#D73A49;">set</span><span style="color:#24292E;"> tablespace tbs1 ;</span></span>
<span class="line"><span style="color:#D73A49;">ALTER</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">TABLE</span></span>
<span class="line"><span style="color:#24292E;">postgres</span><span style="color:#D73A49;">=</span><span style="color:#24292E;"># \\dt</span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> tbl_test;</span></span></code></pre></div><p><img src="https://nnaigos.oss-cn-hangzhou.aliyuncs.com/imgs/202403271816296.jpg" alt=""></p><blockquote><p>[!WARNING] 注意：</p><p>可以看到 tbs1 的 Size 已经由 0 bytes 增长到 7512 kB.同时 pg_default 的 Size 由 33 MB 降到 25 MB</p><p>此时虽然 tbl_test 的数据已经从 pg_default 移动到 tbs1,但是 idx_tmp_t1_x1 依旧存在 pg_default 里. 需要重建下index</p></blockquote><h3 id="重建下index" tabindex="-1">重建下index <a class="header-anchor" href="#重建下index" aria-label="Permalink to &quot;重建下index&quot;">​</a></h3><p><img src="https://nnaigos.oss-cn-hangzhou.aliyuncs.com/imgs/202403271816368.jpg" alt=""></p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">postgres</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"># \\d</span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> tbl_test;</span></span>
<span class="line"><span style="color:#E1E4E8;">                                            </span><span style="color:#F97583;">Table</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;public.tbl_test&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;"> Column |            </span><span style="color:#F97583;">Type</span><span style="color:#E1E4E8;">             | Collation | Nullable | </span><span style="color:#F97583;">Default</span><span style="color:#E1E4E8;"> | Storage  | </span><span style="color:#F97583;">Stats</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">target</span><span style="color:#E1E4E8;"> | </span><span style="color:#F97583;">Description</span><span style="color:#E1E4E8;"> </span></span>
<span class="line"><span style="color:#6A737D;">--------+-----------------------------+-----------+----------+---------+----------+--------------+-------------</span></span>
<span class="line"><span style="color:#E1E4E8;"> id     | </span><span style="color:#F97583;">integer</span><span style="color:#E1E4E8;">                     |           |          |         | plain    |              | </span></span>
<span class="line"><span style="color:#E1E4E8;"> info   | </span><span style="color:#F97583;">text</span><span style="color:#E1E4E8;">                        |           |          |         | extended |              | </span></span>
<span class="line"><span style="color:#E1E4E8;"> c_time | </span><span style="color:#F97583;">timestamp without time zone</span><span style="color:#E1E4E8;"> |           |          |         | plain    |              | </span></span>
<span class="line"><span style="color:#E1E4E8;">Indexes:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">&quot;idx_tbl_t1_x1&quot;</span><span style="color:#E1E4E8;"> btree (id)</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">&quot;idx_tmp_t1_x2&quot;</span><span style="color:#E1E4E8;"> btree (id), tablespace </span><span style="color:#9ECBFF;">&quot;tbs1&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">Tablespace: </span><span style="color:#9ECBFF;">&quot;tbs1&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">Access method: heap</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">postgres</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"># </span><span style="color:#F97583;">drop</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">index</span><span style="color:#E1E4E8;"> idx_tbl_t1_x1 ;</span></span>
<span class="line"><span style="color:#F97583;">DROP</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">INDEX</span></span>
<span class="line"><span style="color:#E1E4E8;">postgres</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"># \\d</span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> tbl_test;</span></span>
<span class="line"><span style="color:#E1E4E8;">                                            </span><span style="color:#F97583;">Table</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;public.tbl_test&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;"> Column |            </span><span style="color:#F97583;">Type</span><span style="color:#E1E4E8;">             | Collation | Nullable | </span><span style="color:#F97583;">Default</span><span style="color:#E1E4E8;"> | Storage  | </span><span style="color:#F97583;">Stats</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">target</span><span style="color:#E1E4E8;"> | </span><span style="color:#F97583;">Description</span><span style="color:#E1E4E8;"> </span></span>
<span class="line"><span style="color:#6A737D;">--------+-----------------------------+-----------+----------+---------+----------+--------------+-------------</span></span>
<span class="line"><span style="color:#E1E4E8;"> id     | </span><span style="color:#F97583;">integer</span><span style="color:#E1E4E8;">                     |           |          |         | plain    |              | </span></span>
<span class="line"><span style="color:#E1E4E8;"> info   | </span><span style="color:#F97583;">text</span><span style="color:#E1E4E8;">                        |           |          |         | extended |              | </span></span>
<span class="line"><span style="color:#E1E4E8;"> c_time | </span><span style="color:#F97583;">timestamp without time zone</span><span style="color:#E1E4E8;"> |           |          |         | plain    |              | </span></span>
<span class="line"><span style="color:#E1E4E8;">Indexes:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">&quot;idx_tmp_t1_x2&quot;</span><span style="color:#E1E4E8;"> btree (id), tablespace </span><span style="color:#9ECBFF;">&quot;tbs1&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">Tablespace: </span><span style="color:#9ECBFF;">&quot;tbs1&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">Access method: heap</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">postgres</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"># </span><span style="color:#F97583;">alter</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">index</span><span style="color:#E1E4E8;"> idx_tmp_t1_x2 rename </span><span style="color:#F97583;">to</span><span style="color:#E1E4E8;"> idx_tbl_t1_x1;</span></span>
<span class="line"><span style="color:#F97583;">ALTER</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">INDEX</span></span>
<span class="line"><span style="color:#E1E4E8;">postgres</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"># \\d</span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> tbl_test;</span></span>
<span class="line"><span style="color:#E1E4E8;">                                            </span><span style="color:#F97583;">Table</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;public.tbl_test&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;"> Column |            </span><span style="color:#F97583;">Type</span><span style="color:#E1E4E8;">             | Collation | Nullable | </span><span style="color:#F97583;">Default</span><span style="color:#E1E4E8;"> | Storage  | </span><span style="color:#F97583;">Stats</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">target</span><span style="color:#E1E4E8;"> | </span><span style="color:#F97583;">Description</span><span style="color:#E1E4E8;"> </span></span>
<span class="line"><span style="color:#6A737D;">--------+-----------------------------+-----------+----------+---------+----------+--------------+-------------</span></span>
<span class="line"><span style="color:#E1E4E8;"> id     | </span><span style="color:#F97583;">integer</span><span style="color:#E1E4E8;">                     |           |          |         | plain    |              | </span></span>
<span class="line"><span style="color:#E1E4E8;"> info   | </span><span style="color:#F97583;">text</span><span style="color:#E1E4E8;">                        |           |          |         | extended |              | </span></span>
<span class="line"><span style="color:#E1E4E8;"> c_time | </span><span style="color:#F97583;">timestamp without time zone</span><span style="color:#E1E4E8;"> |           |          |         | plain    |              | </span></span>
<span class="line"><span style="color:#E1E4E8;">Indexes:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">&quot;idx_tbl_t1_x1&quot;</span><span style="color:#E1E4E8;"> btree (id), tablespace </span><span style="color:#9ECBFF;">&quot;tbs1&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">Tablespace: </span><span style="color:#9ECBFF;">&quot;tbs1&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">Access method: heap</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">postgres</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"># \\db</span><span style="color:#F97583;">+</span></span>
<span class="line"><span style="color:#E1E4E8;">                                          List of tablespaces</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">Name</span><span style="color:#E1E4E8;">    |  </span><span style="color:#F97583;">Owner</span><span style="color:#E1E4E8;">   |        </span><span style="color:#F97583;">Location</span><span style="color:#E1E4E8;">         | Access privileges | Options |  </span><span style="color:#F97583;">Size</span><span style="color:#E1E4E8;">   | </span><span style="color:#F97583;">Description</span><span style="color:#E1E4E8;"> </span></span>
<span class="line"><span style="color:#6A737D;">------------+----------+-------------------------+-------------------+---------+---------+-------------</span></span>
<span class="line"><span style="color:#E1E4E8;"> pg_default | postgres |                         |                   |         | </span><span style="color:#79B8FF;">23</span><span style="color:#E1E4E8;"> MB   | </span></span>
<span class="line"><span style="color:#E1E4E8;"> pg_global  | postgres |                         |                   |         | </span><span style="color:#79B8FF;">623</span><span style="color:#E1E4E8;"> kB  | </span></span>
<span class="line"><span style="color:#E1E4E8;"> tbs1       | postgres | </span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">home</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">ptgres</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">ts_primary |                   |         | </span><span style="color:#79B8FF;">9720</span><span style="color:#E1E4E8;"> kB | </span></span>
<span class="line"><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">3</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">rows</span><span style="color:#E1E4E8;">)</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">postgres</span><span style="color:#D73A49;">=</span><span style="color:#24292E;"># \\d</span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> tbl_test;</span></span>
<span class="line"><span style="color:#24292E;">                                            </span><span style="color:#D73A49;">Table</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;public.tbl_test&quot;</span></span>
<span class="line"><span style="color:#24292E;"> Column |            </span><span style="color:#D73A49;">Type</span><span style="color:#24292E;">             | Collation | Nullable | </span><span style="color:#D73A49;">Default</span><span style="color:#24292E;"> | Storage  | </span><span style="color:#D73A49;">Stats</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">target</span><span style="color:#24292E;"> | </span><span style="color:#D73A49;">Description</span><span style="color:#24292E;"> </span></span>
<span class="line"><span style="color:#6A737D;">--------+-----------------------------+-----------+----------+---------+----------+--------------+-------------</span></span>
<span class="line"><span style="color:#24292E;"> id     | </span><span style="color:#D73A49;">integer</span><span style="color:#24292E;">                     |           |          |         | plain    |              | </span></span>
<span class="line"><span style="color:#24292E;"> info   | </span><span style="color:#D73A49;">text</span><span style="color:#24292E;">                        |           |          |         | extended |              | </span></span>
<span class="line"><span style="color:#24292E;"> c_time | </span><span style="color:#D73A49;">timestamp without time zone</span><span style="color:#24292E;"> |           |          |         | plain    |              | </span></span>
<span class="line"><span style="color:#24292E;">Indexes:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#032F62;">&quot;idx_tbl_t1_x1&quot;</span><span style="color:#24292E;"> btree (id)</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#032F62;">&quot;idx_tmp_t1_x2&quot;</span><span style="color:#24292E;"> btree (id), tablespace </span><span style="color:#032F62;">&quot;tbs1&quot;</span></span>
<span class="line"><span style="color:#24292E;">Tablespace: </span><span style="color:#032F62;">&quot;tbs1&quot;</span></span>
<span class="line"><span style="color:#24292E;">Access method: heap</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">postgres</span><span style="color:#D73A49;">=</span><span style="color:#24292E;"># </span><span style="color:#D73A49;">drop</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">index</span><span style="color:#24292E;"> idx_tbl_t1_x1 ;</span></span>
<span class="line"><span style="color:#D73A49;">DROP</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">INDEX</span></span>
<span class="line"><span style="color:#24292E;">postgres</span><span style="color:#D73A49;">=</span><span style="color:#24292E;"># \\d</span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> tbl_test;</span></span>
<span class="line"><span style="color:#24292E;">                                            </span><span style="color:#D73A49;">Table</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;public.tbl_test&quot;</span></span>
<span class="line"><span style="color:#24292E;"> Column |            </span><span style="color:#D73A49;">Type</span><span style="color:#24292E;">             | Collation | Nullable | </span><span style="color:#D73A49;">Default</span><span style="color:#24292E;"> | Storage  | </span><span style="color:#D73A49;">Stats</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">target</span><span style="color:#24292E;"> | </span><span style="color:#D73A49;">Description</span><span style="color:#24292E;"> </span></span>
<span class="line"><span style="color:#6A737D;">--------+-----------------------------+-----------+----------+---------+----------+--------------+-------------</span></span>
<span class="line"><span style="color:#24292E;"> id     | </span><span style="color:#D73A49;">integer</span><span style="color:#24292E;">                     |           |          |         | plain    |              | </span></span>
<span class="line"><span style="color:#24292E;"> info   | </span><span style="color:#D73A49;">text</span><span style="color:#24292E;">                        |           |          |         | extended |              | </span></span>
<span class="line"><span style="color:#24292E;"> c_time | </span><span style="color:#D73A49;">timestamp without time zone</span><span style="color:#24292E;"> |           |          |         | plain    |              | </span></span>
<span class="line"><span style="color:#24292E;">Indexes:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#032F62;">&quot;idx_tmp_t1_x2&quot;</span><span style="color:#24292E;"> btree (id), tablespace </span><span style="color:#032F62;">&quot;tbs1&quot;</span></span>
<span class="line"><span style="color:#24292E;">Tablespace: </span><span style="color:#032F62;">&quot;tbs1&quot;</span></span>
<span class="line"><span style="color:#24292E;">Access method: heap</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">postgres</span><span style="color:#D73A49;">=</span><span style="color:#24292E;"># </span><span style="color:#D73A49;">alter</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">index</span><span style="color:#24292E;"> idx_tmp_t1_x2 rename </span><span style="color:#D73A49;">to</span><span style="color:#24292E;"> idx_tbl_t1_x1;</span></span>
<span class="line"><span style="color:#D73A49;">ALTER</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">INDEX</span></span>
<span class="line"><span style="color:#24292E;">postgres</span><span style="color:#D73A49;">=</span><span style="color:#24292E;"># \\d</span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> tbl_test;</span></span>
<span class="line"><span style="color:#24292E;">                                            </span><span style="color:#D73A49;">Table</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;public.tbl_test&quot;</span></span>
<span class="line"><span style="color:#24292E;"> Column |            </span><span style="color:#D73A49;">Type</span><span style="color:#24292E;">             | Collation | Nullable | </span><span style="color:#D73A49;">Default</span><span style="color:#24292E;"> | Storage  | </span><span style="color:#D73A49;">Stats</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">target</span><span style="color:#24292E;"> | </span><span style="color:#D73A49;">Description</span><span style="color:#24292E;"> </span></span>
<span class="line"><span style="color:#6A737D;">--------+-----------------------------+-----------+----------+---------+----------+--------------+-------------</span></span>
<span class="line"><span style="color:#24292E;"> id     | </span><span style="color:#D73A49;">integer</span><span style="color:#24292E;">                     |           |          |         | plain    |              | </span></span>
<span class="line"><span style="color:#24292E;"> info   | </span><span style="color:#D73A49;">text</span><span style="color:#24292E;">                        |           |          |         | extended |              | </span></span>
<span class="line"><span style="color:#24292E;"> c_time | </span><span style="color:#D73A49;">timestamp without time zone</span><span style="color:#24292E;"> |           |          |         | plain    |              | </span></span>
<span class="line"><span style="color:#24292E;">Indexes:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#032F62;">&quot;idx_tbl_t1_x1&quot;</span><span style="color:#24292E;"> btree (id), tablespace </span><span style="color:#032F62;">&quot;tbs1&quot;</span></span>
<span class="line"><span style="color:#24292E;">Tablespace: </span><span style="color:#032F62;">&quot;tbs1&quot;</span></span>
<span class="line"><span style="color:#24292E;">Access method: heap</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">postgres</span><span style="color:#D73A49;">=</span><span style="color:#24292E;"># \\db</span><span style="color:#D73A49;">+</span></span>
<span class="line"><span style="color:#24292E;">                                          List of tablespaces</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">Name</span><span style="color:#24292E;">    |  </span><span style="color:#D73A49;">Owner</span><span style="color:#24292E;">   |        </span><span style="color:#D73A49;">Location</span><span style="color:#24292E;">         | Access privileges | Options |  </span><span style="color:#D73A49;">Size</span><span style="color:#24292E;">   | </span><span style="color:#D73A49;">Description</span><span style="color:#24292E;"> </span></span>
<span class="line"><span style="color:#6A737D;">------------+----------+-------------------------+-------------------+---------+---------+-------------</span></span>
<span class="line"><span style="color:#24292E;"> pg_default | postgres |                         |                   |         | </span><span style="color:#005CC5;">23</span><span style="color:#24292E;"> MB   | </span></span>
<span class="line"><span style="color:#24292E;"> pg_global  | postgres |                         |                   |         | </span><span style="color:#005CC5;">623</span><span style="color:#24292E;"> kB  | </span></span>
<span class="line"><span style="color:#24292E;"> tbs1       | postgres | </span><span style="color:#D73A49;">/</span><span style="color:#24292E;">home</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">ptgres</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">ts_primary |                   |         | </span><span style="color:#005CC5;">9720</span><span style="color:#24292E;"> kB | </span></span>
<span class="line"><span style="color:#24292E;">(</span><span style="color:#005CC5;">3</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">rows</span><span style="color:#24292E;">)</span></span></code></pre></div><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">-- 待验证</span></span>
<span class="line"><span style="color:#e1e4e8;">postgres=# begin;</span></span>
<span class="line"><span style="color:#e1e4e8;">drop index idx_tbl_t1_x1;</span></span>
<span class="line"><span style="color:#e1e4e8;">alter index idx_tmp_t1_x2 rename to idx_tbl_t1_x1;</span></span>
<span class="line"><span style="color:#e1e4e8;">commit;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">-- 待验证</span></span>
<span class="line"><span style="color:#24292e;">postgres=# begin;</span></span>
<span class="line"><span style="color:#24292e;">drop index idx_tbl_t1_x1;</span></span>
<span class="line"><span style="color:#24292e;">alter index idx_tmp_t1_x2 rename to idx_tbl_t1_x1;</span></span>
<span class="line"><span style="color:#24292e;">commit;</span></span></code></pre></div><p><img src="https://nnaigos.oss-cn-hangzhou.aliyuncs.com/imgs/202403271816518.jpg" alt=""></p><p><img src="https://nnaigos.oss-cn-hangzhou.aliyuncs.com/imgs/202403271816261.jpg" alt=""></p><p>结束</p><p>参考: <a href="https://www.postgresql.org/docs/10/manage-ag-tablespaces.html" target="_blank" rel="noreferrer">https://www.postgresql.org/docs/10/manage-ag-tablespaces.html</a></p><p><a href="https://www.postgresql.org/docs/10/sql-createtablespace.html" target="_blank" rel="noreferrer">https://www.postgresql.org/docs/10/sql-createtablespace.html</a></p><p><a href="https://www.postgresql.org/docs/10/sql-altertablespace.html" target="_blank" rel="noreferrer">https://www.postgresql.org/docs/10/sql-altertablespace.html</a></p>`,53),e=[o];function t(c,r,E,y,i,g){return a(),n("div",null,e)}const A=s(l,[["render",t]]);export{F as __pageData,A as default};
