import{_ as s,o as n,c as a,R as l}from"./chunks/framework.zUbWieqp.js";const C=JSON.parse('{"title":"1. Lark Noticeä»‹ç»","description":"","frontmatter":{},"headers":[],"relativePath":"guide/container/k8s/CICD/base_jenkins/3-feishu.md","filePath":"guide/container/k8s/CICD/base_jenkins/3-feishu.md","lastUpdated":1723709691000}'),p={name:"guide/container/k8s/CICD/base_jenkins/3-feishu.md"},o=l(`<h1 id="_1-lark-noticeä»‹ç»" tabindex="-1">1. Lark Noticeä»‹ç» <a class="header-anchor" href="#_1-lark-noticeä»‹ç»" aria-label="Permalink to &quot;1. Lark Noticeä»‹ç»&quot;">â€‹</a></h1><p>Lark Notice Plugin æ˜¯ä¸€ä¸ªç”¨äº Jenkins çš„æ„å»ºé€šçŸ¥æ’ä»¶ï¼Œå¯ä»¥å°† Jenkinsæ„å»ºè¿‡ç¨‹ä»¥åŠç»“æœé€šçŸ¥æ¨é€åˆ° Larkã€é£ä¹¦ã€é’‰é’‰ åä½œå¹³å°ã€‚ å¯é…ç½®å¤šä¸ªçš„é€šçŸ¥æ—¶æœºï¼ŒåŒ…æ‹¬ æ„å»ºå¯åŠ¨æ—¶ã€æ„å»ºä¸­æ–­ã€æ„å»ºå¤±è´¥ã€æ„å»ºæˆåŠŸæ—¶ã€æ„å»ºä¸ç¨³å®š ç­‰ã€‚ æ”¯æŒå¤šç§ä¸åŒç±»å‹çš„æ¶ˆæ¯ï¼ŒåŒ…æ‹¬ æ–‡æœ¬æ¶ˆæ¯ã€å›¾ç‰‡æ¶ˆæ¯ï¼Œ ç¾¤åç‰‡æ¶ˆæ¯ã€å¯Œæ–‡æœ¬æ¶ˆæ¯ã€å¡ç‰‡æ¶ˆæ¯ï¼› åŒæ—¶è¯¥æ’ä»¶è¿˜æä¾›äº†è‡ªå®šä¹‰æ¨¡æ¿å’Œå˜é‡çš„åŠŸèƒ½ï¼Œä½¿æ‚¨èƒ½å¤Ÿæ ¹æ®è‡ªå·±çš„éœ€æ±‚æ¥å®šåˆ¶é€šçŸ¥æ¶ˆæ¯çš„å†…å®¹å’Œæ ¼å¼</p><h1 id="_2-å®‰è£…æ’ä»¶" tabindex="-1">2. å®‰è£…æ’ä»¶ <a class="header-anchor" href="#_2-å®‰è£…æ’ä»¶" aria-label="Permalink to &quot;2. å®‰è£…æ’ä»¶&quot;">â€‹</a></h1><p>ç‰ˆæœ¬ä¾èµ–,jenkins-2.414.x</p><p>Lark Noticeï¼ˆé€šè¿‡ä¸Šä¼ æ–‡ä»¶çš„æ–¹å¼å®‰è£…ï¼‰<a href="https://721806280.github.io/lark-notice-plugin-doc/" target="_blank" rel="noreferrer">https://721806280.github.io/lark-notice-plugin-doc/</a></p><p>ä» Jenkins é¦–é¡µå¼€å§‹ï¼Œç‚¹å‡» <code>ç³»ç»Ÿç®¡ç†</code> -&gt; <code>æ’ä»¶ç®¡ç†</code> , æ‰¾åˆ° <code>Deploy Plugin</code> é€‰é¡¹åè¾“å…¥æ’ä»¶åœ°å€åç‚¹å‡» <code>deploy</code> å³å¯</p><blockquote><p>ä¸‹è½½åœ°å€,<a href="https://nnaigos.oss-cn-hangzhou.aliyuncs.com/lark-notice.hpi" target="_blank" rel="noreferrer">https://nnaigos.oss-cn-hangzhou.aliyuncs.com/lark-notice.hpi</a></p></blockquote><h1 id="_3-æœºå™¨äººé…ç½®" tabindex="-1">3. æœºå™¨äººé…ç½® <a class="header-anchor" href="#_3-æœºå™¨äººé…ç½®" aria-label="Permalink to &quot;3. æœºå™¨äººé…ç½®&quot;">â€‹</a></h1><h2 id="_3-2-ç”³è¯·æœºå™¨äºº" tabindex="-1">3.2 ç”³è¯·æœºå™¨äºº <a class="header-anchor" href="#_3-2-ç”³è¯·æœºå™¨äºº" aria-label="Permalink to &quot;3.2 ç”³è¯·æœºå™¨äºº&quot;">â€‹</a></h2><p>å‡†å¤‡å·¥ä½œï¼Œåœ¨é£ä¹¦ç¾¤æ–°å»ºä¸€ä¸ªæœºå™¨äººï¼ˆ<a href="https://open.feishu.cn/document/client-docs/bot-v3/add-custom-bot%EF%BC%89" target="_blank" rel="noreferrer">https://open.feishu.cn/document/client-docs/bot-v3/add-custom-botï¼‰</a></p><p><img src="https://nnaigos.oss-cn-hangzhou.aliyuncs.com/imgs/202408061523702.png" alt="image-20240806152312416"></p><ul><li>é…ç½®å…³é”®å­—</li></ul><p><img src="https://nnaigos.oss-cn-hangzhou.aliyuncs.com/imgs/202408061524981.png" alt="image-20240806152402605"></p><p>ä¹‹åä¿å­˜å³å¯</p><h2 id="_3-2-é…ç½®" tabindex="-1">3.2 é…ç½® <a class="header-anchor" href="#_3-2-é…ç½®" aria-label="Permalink to &quot;3.2 é…ç½®&quot;">â€‹</a></h2><p>æ‰“å¼€ <code>Manage Jenkins</code> é¡µé¢ï¼Œæ‰¾åˆ° <code>Lark Notice</code> é…ç½®é¡¹ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="https://nnaigos.oss-cn-hangzhou.aliyuncs.com/imgs/202408061511407.png" alt="image-20240806151104482"></p><p>ç‚¹è¿›å»</p><p><img src="https://nnaigos.oss-cn-hangzhou.aliyuncs.com/imgs/202408061519220.png" alt="image-20240806151920843"></p><p><img src="https://nnaigos.oss-cn-hangzhou.aliyuncs.com/imgs/202408061521054.png" alt="image-20240806152150780"></p><ul><li>æµ‹è¯•</li></ul><p><img src="https://nnaigos.oss-cn-hangzhou.aliyuncs.com/imgs/202408061524917.png" alt="image-20240806152439213"></p><ul><li>æ•ˆæœ</li></ul><p><img src="https://nnaigos.oss-cn-hangzhou.aliyuncs.com/imgs/202408061525825.png" alt="image-20240806152507635"></p><ul><li>é‡å¯jenkinsæœåŠ¡</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">http://url/safeRestart</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">http://url/safeRestart</span></span></code></pre></div><h1 id="_4-çº¿ä¸Šæ¡ˆä¾‹" tabindex="-1">4. çº¿ä¸Šæ¡ˆä¾‹ <a class="header-anchor" href="#_4-çº¿ä¸Šæ¡ˆä¾‹" aria-label="Permalink to &quot;4. çº¿ä¸Šæ¡ˆä¾‹&quot;">â€‹</a></h1><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">def</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">git_address</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;http://house.freehan.ink/root/springdemo.git&quot;</span></span>
<span class="line"><span style="color:#B392F0;">def</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">git_auth</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;02d72dd6-0eab-4261-b0c0-12824e083421&quot;</span></span>
<span class="line"><span style="color:#B392F0;">def</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">tag</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;latest&quot;</span></span>
<span class="line"><span style="color:#B392F0;">def</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">harbor_url</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;registry.cn-zhangjiakou.aliyuncs.com&quot;</span></span>
<span class="line"><span style="color:#B392F0;">def</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">harbor_project_name</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;spring&quot;</span></span>
<span class="line"><span style="color:#B392F0;">def</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">harbor_auth</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;1e7ee468-9da7-469b-a43a-56556b56f308&quot;</span></span>
<span class="line"><span style="color:#B392F0;">def</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">start</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">new</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Date</span><span style="color:#E1E4E8;">()</span><span style="color:#9ECBFF;">.format</span><span style="color:#E1E4E8;">(</span><span style="color:#B392F0;">&#39;yyyy-MM-dd HH:mm:ss&#39;</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">//</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">é€šçŸ¥æœºå™¨äººé…ç½®</span></span>
<span class="line"><span style="color:#B392F0;">def</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">lark_robot_id</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;55d84e77-d1c5-4b1c-9e0f-ea1630b4e236&#39;&quot;</span><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">//</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">é£ä¹¦æœºå™¨äººID</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">podTemplate(label:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;jenkins-slave-java&#39;,</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">cloud:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;kubernetes&#39;,</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">containers:</span><span style="color:#E1E4E8;"> [ </span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">containerTemplate(</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#B392F0;">name:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;jnlp&#39;,</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#B392F0;">image:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;registry.cn-zhangjiakou.aliyuncs.com/hsuing/jenkins-slave-maven:v1&quot;,</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#B392F0;">ttyEnabled:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">true</span></span>
<span class="line"><span style="color:#E1E4E8;">    ),</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">containerTemplate(</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#B392F0;">name:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;docker&#39;,</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#B392F0;">image:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;registry.cn-zhangjiakou.aliyuncs.com/hsuing/docker:stable&quot;,</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#B392F0;">ttyEnabled:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">true</span><span style="color:#9ECBFF;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#79B8FF;">command</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&#39;cat&#39;</span></span>
<span class="line"><span style="color:#E1E4E8;">    )</span></span>
<span class="line"><span style="color:#E1E4E8;">  ],</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">volumes:</span><span style="color:#E1E4E8;"> [</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">hostPathVolume(mountPath:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;/var/run/docker.sock&#39;,</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">hostPath:&#39;/var/run/docker.sock&#39;</span><span style="color:#E1E4E8;">),</span></span>
<span class="line"><span style="color:#E1E4E8;">  ],</span></span>
<span class="line"><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">{</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">node(</span><span style="color:#B392F0;">&quot;jenkins-slave-java&quot;</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#B392F0;">try</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">{</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#B392F0;">stage(</span><span style="color:#B392F0;">&#39;æ‹‰å–ä»£ç &#39;</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">                </span><span style="color:#B392F0;">checkout([$class:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;GitSCM&#39;,</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">branches:</span><span style="color:#E1E4E8;"> [[name: </span><span style="color:#9ECBFF;">&#39;*/main&#39;]],</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">extensions:</span><span style="color:#E1E4E8;"> [], userRemoteConfigs: [[credentialsId: git_auth, url: git_address]]])</span></span>
<span class="line"><span style="color:#E1E4E8;">            }</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#B392F0;">//å®šä¹‰å…¨å±€newTag</span></span>
<span class="line"><span style="color:#E1E4E8;">			</span><span style="color:#B392F0;">def</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">newTag</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">sh</span><span style="color:#E1E4E8;">(</span><span style="color:#B392F0;">returnStdout:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">true</span><span style="color:#9ECBFF;">,script:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;echo \`date +&quot;%Y%m%d%H%M&quot;_\`\`git describe --tags --always\`&#39;</span><span style="color:#E1E4E8;">)</span><span style="color:#9ECBFF;">.trim</span><span style="color:#E1E4E8;">()</span></span>
<span class="line"><span style="color:#E1E4E8;">			</span><span style="color:#B392F0;">stage(</span><span style="color:#B392F0;">&#39;ç¼–è¯‘æè¿°&#39;</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">				</span><span style="color:#B392F0;">//</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">è‡ªå®šä¹‰è®¾ç½®æ„å»ºå†å²æ˜¾ç¤ºçš„åç§°å’Œæè¿°ä¿¡æ¯</span></span>
<span class="line"><span style="color:#E1E4E8;">				</span><span style="color:#B392F0;">//</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">ä¸åŒçš„éƒ¨ç½²æ–¹å¼è®¾ç½®æ„å»ºå†å²æ˜¾ç¤ºçš„åç§°å’Œæè¿°ä¿¡æ¯æ–¹å¼ä¸ä¸€æ ·ï¼Œæ ¹æ®è‡ªå·±çš„éƒ¨ç½²æ–¹å¼è‡ªè¡Œç™¾åº¦æ‰¾åˆ°è®¾ç½®æ–¹æ³•</span></span>
<span class="line"><span style="color:#E1E4E8;">				</span><span style="color:#B392F0;">script</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">{</span></span>
<span class="line"><span style="color:#E1E4E8;">					</span><span style="color:#B392F0;">//è®¾ç½®buildName</span></span>
<span class="line"><span style="color:#E1E4E8;">					</span><span style="color:#B392F0;">wrap([$class:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;BuildUser&#39;]</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">						</span><span style="color:#B392F0;">//ä¿®æ”¹Description</span></span>
<span class="line"><span style="color:#E1E4E8;">						</span><span style="color:#B392F0;">buildDescription</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;\${</span><span style="color:#E1E4E8;">BUILD_USER</span><span style="color:#9ECBFF;">} &gt; \${</span><span style="color:#E1E4E8;">project_name</span><span style="color:#9ECBFF;">} &gt; \${</span><span style="color:#E1E4E8;">branch</span><span style="color:#9ECBFF;">}&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">					}</span></span>
<span class="line"><span style="color:#E1E4E8;">				}</span></span>
<span class="line"><span style="color:#E1E4E8;">			}</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#B392F0;">stage(</span><span style="color:#B392F0;">&#39;ä»£ç ç¼–è¯‘&#39;</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">                </span><span style="color:#B392F0;">def</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">selectedProjects</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">project_name.split</span><span style="color:#E1E4E8;">(</span><span style="color:#B392F0;">&#39;,&#39;</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">                </span><span style="color:#B392F0;">selectedProjects.each</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">{</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">currentProjectName</span><span style="color:#E1E4E8;"> -</span><span style="color:#F97583;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">                    </span><span style="color:#B392F0;">def</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">imageName</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;\${</span><span style="color:#E1E4E8;">currentProjectName</span><span style="color:#9ECBFF;">}:\${</span><span style="color:#E1E4E8;">tag</span><span style="color:#9ECBFF;">}&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">                    </span><span style="color:#B392F0;">//def</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">newTag</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">sh</span><span style="color:#E1E4E8;">(</span><span style="color:#B392F0;">returnStdout:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">true</span><span style="color:#9ECBFF;">,</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">script:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;echo \`date +&quot;%Y%m%d%H%M&quot;_\`\`git describe --tags --always\`&#39;</span><span style="color:#E1E4E8;">)</span><span style="color:#9ECBFF;">.trim</span><span style="color:#E1E4E8;">()</span></span>
<span class="line"><span style="color:#E1E4E8;">                    </span><span style="color:#B392F0;">sh</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;mvn clean package -Dmaven.test.skip=true&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">                }</span></span>
<span class="line"><span style="color:#E1E4E8;">            }</span></span>
<span class="line"><span style="color:#E1E4E8;">			</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#B392F0;">stage(</span><span style="color:#B392F0;">&#39;æ„å»ºé•œåƒ&#39;</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">                </span><span style="color:#B392F0;">def</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">selectedProjects</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">project_name.split</span><span style="color:#E1E4E8;">(</span><span style="color:#B392F0;">&#39;,&#39;</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">                </span><span style="color:#B392F0;">container(</span><span style="color:#B392F0;">&#39;docker&#39;</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">                    </span><span style="color:#B392F0;">selectedProjects.each</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">{</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">currentProjectName</span><span style="color:#E1E4E8;"> -</span><span style="color:#F97583;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">                        </span><span style="color:#B392F0;">def</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">imageName</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;\${</span><span style="color:#E1E4E8;">currentProjectName</span><span style="color:#9ECBFF;">}:\${</span><span style="color:#E1E4E8;">tag</span><span style="color:#9ECBFF;">}&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">                        </span><span style="color:#B392F0;">//def</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">newTag</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">sh</span><span style="color:#E1E4E8;">(</span><span style="color:#B392F0;">returnStdout:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">true</span><span style="color:#9ECBFF;">,</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">script:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;echo \`date +&quot;%Y%m%d%H%M&quot;_\`\`git describe --tags --always\`&#39;</span><span style="color:#E1E4E8;">)</span><span style="color:#9ECBFF;">.trim</span><span style="color:#E1E4E8;">()</span></span>
<span class="line"><span style="color:#E1E4E8;">                        </span><span style="color:#B392F0;">sh</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;docker build -t \${</span><span style="color:#E1E4E8;">imageName</span><span style="color:#9ECBFF;">} .&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">                        </span><span style="color:#B392F0;">sh</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;docker tag \${</span><span style="color:#E1E4E8;">imageName</span><span style="color:#9ECBFF;">} \${</span><span style="color:#E1E4E8;">harbor_url</span><span style="color:#9ECBFF;">}/hsuing/\${</span><span style="color:#E1E4E8;">harbor_project_name</span><span style="color:#9ECBFF;">}:\${</span><span style="color:#E1E4E8;">newTag</span><span style="color:#9ECBFF;">}&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">                        </span><span style="color:#B392F0;">withCredentials([usernamePassword(credentialsId:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">harbor_auth,</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">passwordVariable:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;password&#39;,</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">usernameVariable:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;username&#39;</span><span style="color:#E1E4E8;">)]) {</span></span>
<span class="line"><span style="color:#E1E4E8;">							</span><span style="color:#B392F0;">//ç™»å½•</span></span>
<span class="line"><span style="color:#E1E4E8;">                            </span><span style="color:#B392F0;">sh</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;docker login -u \${</span><span style="color:#E1E4E8;">username</span><span style="color:#9ECBFF;">} -p \${</span><span style="color:#E1E4E8;">password</span><span style="color:#9ECBFF;">} \${</span><span style="color:#E1E4E8;">harbor_url</span><span style="color:#9ECBFF;">}&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">                            </span><span style="color:#B392F0;">//ä¸Šä¼ é•œåƒ</span></span>
<span class="line"><span style="color:#E1E4E8;">                            </span><span style="color:#B392F0;">sh</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;docker push \${</span><span style="color:#E1E4E8;">harbor_url</span><span style="color:#9ECBFF;">}/hsuing/\${</span><span style="color:#E1E4E8;">harbor_project_name</span><span style="color:#9ECBFF;">}:\${</span><span style="color:#E1E4E8;">newTag</span><span style="color:#9ECBFF;">}&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">                        }</span></span>
<span class="line"><span style="color:#E1E4E8;">                        </span><span style="color:#B392F0;">//åˆ é™¤æœ¬åœ°é•œåƒ</span></span>
<span class="line"><span style="color:#E1E4E8;">                        </span><span style="color:#B392F0;">sh</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;docker rmi -f \${</span><span style="color:#E1E4E8;">imageName</span><span style="color:#9ECBFF;">}&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">                        </span><span style="color:#B392F0;">sh</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;docker rmi -f \${</span><span style="color:#E1E4E8;">harbor_url</span><span style="color:#9ECBFF;">}/hsuing/\${</span><span style="color:#E1E4E8;">harbor_project_name</span><span style="color:#9ECBFF;">}:\${</span><span style="color:#E1E4E8;">newTag</span><span style="color:#9ECBFF;">}&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">                    }</span></span>
<span class="line"><span style="color:#E1E4E8;">                }</span></span>
<span class="line"><span style="color:#E1E4E8;">            }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#B392F0;">stage(</span><span style="color:#B392F0;">&#39;éƒ¨ç½²åˆ°k8så¹³å°&#39;</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">                </span><span style="color:#B392F0;">def</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">selectedProjects</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">project_name.split</span><span style="color:#E1E4E8;">(</span><span style="color:#B392F0;">&#39;,&#39;</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">                </span><span style="color:#B392F0;">selectedProjects.each</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">{</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">currentProjectName</span><span style="color:#E1E4E8;"> -</span><span style="color:#F97583;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">                    </span><span style="color:#B392F0;">//def</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">newTag</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">sh</span><span style="color:#E1E4E8;">(</span><span style="color:#B392F0;">returnStdout:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">true</span><span style="color:#9ECBFF;">,</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">script:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;echo \`date +&quot;%Y%m%d%H%M&quot;_\`\`git describe --tags --always\`&#39;</span><span style="color:#E1E4E8;">)</span><span style="color:#9ECBFF;">.trim</span><span style="color:#E1E4E8;">()</span></span>
<span class="line"><span style="color:#E1E4E8;">                    </span><span style="color:#B392F0;">def</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">deploy_image_name</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;\${</span><span style="color:#E1E4E8;">harbor_url</span><span style="color:#9ECBFF;">}/hsuing/\${</span><span style="color:#E1E4E8;">harbor_project_name</span><span style="color:#9ECBFF;">}:\${</span><span style="color:#E1E4E8;">newTag</span><span style="color:#9ECBFF;">}&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">                    </span><span style="color:#B392F0;">sh</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#9ECBFF;">                        sed -i &#39;s#</span><span style="color:#79B8FF;">\\$</span><span style="color:#9ECBFF;">IMAGE_NAME#\${</span><span style="color:#E1E4E8;">deploy_image_name</span><span style="color:#9ECBFF;">}#&#39; deployment.yaml</span></span>
<span class="line"><span style="color:#9ECBFF;">                        sed -i &#39;s#</span><span style="color:#79B8FF;">\\$</span><span style="color:#9ECBFF;">APP_NAME#\${</span><span style="color:#E1E4E8;">currentProjectName</span><span style="color:#9ECBFF;">}#&#39;  deployment.yaml</span></span>
<span class="line"><span style="color:#9ECBFF;">                        sed -i &#39;s#</span><span style="color:#79B8FF;">\\$</span><span style="color:#9ECBFF;">APP_REPLICAS#\${</span><span style="color:#E1E4E8;">replicas</span><span style="color:#9ECBFF;">}#&#39; deployment.yaml</span></span>
<span class="line"><span style="color:#9ECBFF;">                        sed -i &#39;s#</span><span style="color:#79B8FF;">\\$</span><span style="color:#9ECBFF;">NAMESPACE#\${</span><span style="color:#E1E4E8;">namespaces</span><span style="color:#9ECBFF;">}#&#39; deployment.yaml</span></span>
<span class="line"><span style="color:#9ECBFF;">                        sed -i &#39;s#</span><span style="color:#79B8FF;">\\$</span><span style="color:#9ECBFF;">SPRINGENV#\${</span><span style="color:#E1E4E8;">springProfilesActive</span><span style="color:#9ECBFF;">}#&#39; deployment.yaml</span></span>
<span class="line"><span style="color:#9ECBFF;">                        sed -i &#39;s#</span><span style="color:#79B8FF;">\\$</span><span style="color:#9ECBFF;">PODMEMORY#\${</span><span style="color:#E1E4E8;">podsMem</span><span style="color:#9ECBFF;">}#&#39; deployment.yaml</span></span>
<span class="line"><span style="color:#9ECBFF;">                        sed -i &#39;s#</span><span style="color:#79B8FF;">\\$</span><span style="color:#9ECBFF;">PODCPU#\${</span><span style="color:#E1E4E8;">podsCpu</span><span style="color:#9ECBFF;">}#&#39; deployment.yaml</span></span>
<span class="line"><span style="color:#9ECBFF;">                        cat deployment.yaml</span></span>
<span class="line"><span style="color:#9ECBFF;">                    &quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">                    </span><span style="color:#B392F0;">kubernetesDeploy(kubeconfigId:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;55a88b59-fd12-4bf0-ba57-8a664fed2f71&quot;,</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">configs:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;deployment.yaml&quot;</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">                }</span></span>
<span class="line"><span style="color:#E1E4E8;">            }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#B392F0;">stage(</span><span style="color:#B392F0;">&#39;å‘é€é£ä¹¦é€šçŸ¥&#39;</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">                </span><span style="color:#B392F0;">//</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">è·å–æ‰§è¡Œç”¨æˆ·</span></span>
<span class="line"><span style="color:#E1E4E8;">                </span><span style="color:#B392F0;">wrap([$class:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;BuildUser&#39;]</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">                    </span><span style="color:#B392F0;">//</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">å‘é€é£ä¹¦é€šçŸ¥</span></span>
<span class="line"><span style="color:#E1E4E8;">                    </span><span style="color:#B392F0;">lark</span><span style="color:#E1E4E8;"> (</span></span>
<span class="line"><span style="color:#E1E4E8;">                        </span><span style="color:#B392F0;">robot:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;</span><span style="color:#E1E4E8;">$lark_robot_id</span><span style="color:#9ECBFF;">&quot;,</span></span>
<span class="line"><span style="color:#E1E4E8;">                        </span><span style="color:#79B8FF;">type</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;CARD&quot;,</span></span>
<span class="line"><span style="color:#E1E4E8;">                        </span><span style="color:#B392F0;">title:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;ğŸ“¢  Jenkins é•œåƒæ„å»ºæˆåŠŸ&quot;,</span></span>
<span class="line"><span style="color:#E1E4E8;">                        </span><span style="color:#B392F0;">text:</span><span style="color:#E1E4E8;"> [</span></span>
<span class="line"><span style="color:#E1E4E8;">                            </span><span style="color:#B392F0;">&quot;ğŸ“‹ **ä»»åŠ¡åç§°**ï¼š[\${</span><span style="color:#E1E4E8;">JOB_NAME</span><span style="color:#B392F0;">}](\${</span><span style="color:#E1E4E8;">JOB_URL</span><span style="color:#B392F0;">})&quot;</span><span style="color:#B392F0;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">                            </span><span style="color:#B392F0;">&quot;ğŸ”¢ **ä»»åŠ¡ç¼–å·**ï¼š[\${</span><span style="color:#E1E4E8;">BUILD_DISPLAY_NAME</span><span style="color:#B392F0;">}](\${</span><span style="color:#E1E4E8;">BUILD_URL</span><span style="color:#B392F0;">})&quot;</span><span style="color:#B392F0;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">                            </span><span style="color:#B392F0;">&quot;ğŸŒŸ **æ„å»ºçŠ¶æ€**: &lt;font color=&#39;green&#39;&gt;æˆåŠŸ&lt;/font&gt;&quot;</span><span style="color:#B392F0;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">                            </span><span style="color:#B392F0;">&quot;ğŸ¤© **é•œåƒç‰ˆæœ¬**: \${</span><span style="color:#E1E4E8;">newTag</span><span style="color:#B392F0;">}&quot;</span><span style="color:#B392F0;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">                            </span><span style="color:#B392F0;">&quot;ğŸ˜ **é•œåƒä»“åº“**: \${</span><span style="color:#E1E4E8;">harbor_url</span><span style="color:#B392F0;">}/hsuing/\${</span><span style="color:#E1E4E8;">harbor_project_name</span><span style="color:#B392F0;">}&quot;</span><span style="color:#B392F0;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">                            </span><span style="color:#B392F0;">&quot;ğŸ• **æ„å»ºç”¨æ—¶**: \${</span><span style="color:#E1E4E8;">currentBuild</span><span style="color:#B392F0;">.</span><span style="color:#E1E4E8;">duration</span><span style="color:#B392F0;">} ms&quot;</span><span style="color:#B392F0;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">                            </span><span style="color:#B392F0;">&quot;ğŸ‘¤ **æ‰§è¡Œè€…**: \${</span><span style="color:#E1E4E8;">env</span><span style="color:#B392F0;">.</span><span style="color:#E1E4E8;">BUILD_USER</span><span style="color:#B392F0;">}&quot;</span><span style="color:#B392F0;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">                            </span><span style="color:#B392F0;">&quot;&lt;at id=all&gt;&lt;/at&gt;&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">                        ],</span></span>
<span class="line"><span style="color:#E1E4E8;">                        </span><span style="color:#B392F0;">buttons:</span><span style="color:#E1E4E8;"> [</span></span>
<span class="line"><span style="color:#E1E4E8;">                            [</span></span>
<span class="line"><span style="color:#E1E4E8;">                                title: </span><span style="color:#9ECBFF;">&quot;æ›´æ”¹è®°å½•&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">                                url: </span><span style="color:#9ECBFF;">&quot;\${</span><span style="color:#E1E4E8;">BUILD_URL</span><span style="color:#9ECBFF;">}changes&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">                            ]</span><span style="color:#B392F0;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">                            [</span></span>
<span class="line"><span style="color:#E1E4E8;">                                title: </span><span style="color:#9ECBFF;">&quot;æ§åˆ¶å°&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">                                type: </span><span style="color:#9ECBFF;">&quot;danger&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">                                url: </span><span style="color:#9ECBFF;">&quot;\${</span><span style="color:#E1E4E8;">BUILD_URL</span><span style="color:#9ECBFF;">}console&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">                            ]</span></span>
<span class="line"><span style="color:#E1E4E8;">                        ]</span></span>
<span class="line"><span style="color:#E1E4E8;">                    )</span></span>
<span class="line"><span style="color:#E1E4E8;">                }</span></span>
<span class="line"><span style="color:#E1E4E8;">            }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">        } catch (</span><span style="color:#B392F0;">Exception</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">e</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#B392F0;">currentBuild.result</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;FAILURE&#39;</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#B392F0;">error</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;Pipeline failed: \${</span><span style="color:#E1E4E8;">e</span><span style="color:#9ECBFF;">.</span><span style="color:#E1E4E8;">message</span><span style="color:#9ECBFF;">}&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">        }</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">def</span><span style="color:#24292E;"> </span><span style="color:#032F62;">git_address</span><span style="color:#24292E;"> </span><span style="color:#032F62;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;http://house.freehan.ink/root/springdemo.git&quot;</span></span>
<span class="line"><span style="color:#6F42C1;">def</span><span style="color:#24292E;"> </span><span style="color:#032F62;">git_auth</span><span style="color:#24292E;"> </span><span style="color:#032F62;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;02d72dd6-0eab-4261-b0c0-12824e083421&quot;</span></span>
<span class="line"><span style="color:#6F42C1;">def</span><span style="color:#24292E;"> </span><span style="color:#032F62;">tag</span><span style="color:#24292E;"> </span><span style="color:#032F62;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;latest&quot;</span></span>
<span class="line"><span style="color:#6F42C1;">def</span><span style="color:#24292E;"> </span><span style="color:#032F62;">harbor_url</span><span style="color:#24292E;"> </span><span style="color:#032F62;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;registry.cn-zhangjiakou.aliyuncs.com&quot;</span></span>
<span class="line"><span style="color:#6F42C1;">def</span><span style="color:#24292E;"> </span><span style="color:#032F62;">harbor_project_name</span><span style="color:#24292E;"> </span><span style="color:#032F62;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;spring&quot;</span></span>
<span class="line"><span style="color:#6F42C1;">def</span><span style="color:#24292E;"> </span><span style="color:#032F62;">harbor_auth</span><span style="color:#24292E;"> </span><span style="color:#032F62;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;1e7ee468-9da7-469b-a43a-56556b56f308&quot;</span></span>
<span class="line"><span style="color:#6F42C1;">def</span><span style="color:#24292E;"> </span><span style="color:#032F62;">start</span><span style="color:#24292E;"> </span><span style="color:#032F62;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">new</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Date</span><span style="color:#24292E;">()</span><span style="color:#032F62;">.format</span><span style="color:#24292E;">(</span><span style="color:#6F42C1;">&#39;yyyy-MM-dd HH:mm:ss&#39;</span><span style="color:#24292E;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">//</span><span style="color:#24292E;"> </span><span style="color:#032F62;">é€šçŸ¥æœºå™¨äººé…ç½®</span></span>
<span class="line"><span style="color:#6F42C1;">def</span><span style="color:#24292E;"> </span><span style="color:#032F62;">lark_robot_id</span><span style="color:#24292E;"> </span><span style="color:#032F62;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;55d84e77-d1c5-4b1c-9e0f-ea1630b4e236&#39;&quot;</span><span style="color:#24292E;">  </span><span style="color:#032F62;">//</span><span style="color:#24292E;"> </span><span style="color:#032F62;">é£ä¹¦æœºå™¨äººID</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">podTemplate(label:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;jenkins-slave-java&#39;,</span><span style="color:#24292E;"> </span><span style="color:#032F62;">cloud:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;kubernetes&#39;,</span><span style="color:#24292E;"> </span><span style="color:#032F62;">containers:</span><span style="color:#24292E;"> [ </span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">containerTemplate(</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6F42C1;">name:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;jnlp&#39;,</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6F42C1;">image:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;registry.cn-zhangjiakou.aliyuncs.com/hsuing/jenkins-slave-maven:v1&quot;,</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6F42C1;">ttyEnabled:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">true</span></span>
<span class="line"><span style="color:#24292E;">    ),</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">containerTemplate(</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6F42C1;">name:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;docker&#39;,</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6F42C1;">image:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;registry.cn-zhangjiakou.aliyuncs.com/hsuing/docker:stable&quot;,</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6F42C1;">ttyEnabled:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">true</span><span style="color:#032F62;">,</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#005CC5;">command</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&#39;cat&#39;</span></span>
<span class="line"><span style="color:#24292E;">    )</span></span>
<span class="line"><span style="color:#24292E;">  ],</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">volumes:</span><span style="color:#24292E;"> [</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">hostPathVolume(mountPath:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;/var/run/docker.sock&#39;,</span><span style="color:#24292E;"> </span><span style="color:#032F62;">hostPath:&#39;/var/run/docker.sock&#39;</span><span style="color:#24292E;">),</span></span>
<span class="line"><span style="color:#24292E;">  ],</span></span>
<span class="line"><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">{</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">node(</span><span style="color:#6F42C1;">&quot;jenkins-slave-java&quot;</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6F42C1;">try</span><span style="color:#24292E;"> </span><span style="color:#032F62;">{</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#6F42C1;">stage(</span><span style="color:#6F42C1;">&#39;æ‹‰å–ä»£ç &#39;</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">                </span><span style="color:#6F42C1;">checkout([$class:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;GitSCM&#39;,</span><span style="color:#24292E;"> </span><span style="color:#032F62;">branches:</span><span style="color:#24292E;"> [[name: </span><span style="color:#032F62;">&#39;*/main&#39;]],</span><span style="color:#24292E;"> </span><span style="color:#032F62;">extensions:</span><span style="color:#24292E;"> [], userRemoteConfigs: [[credentialsId: git_auth, url: git_address]]])</span></span>
<span class="line"><span style="color:#24292E;">            }</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#6F42C1;">//å®šä¹‰å…¨å±€newTag</span></span>
<span class="line"><span style="color:#24292E;">			</span><span style="color:#6F42C1;">def</span><span style="color:#24292E;"> </span><span style="color:#032F62;">newTag</span><span style="color:#24292E;"> </span><span style="color:#032F62;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">sh</span><span style="color:#24292E;">(</span><span style="color:#6F42C1;">returnStdout:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">true</span><span style="color:#032F62;">,script:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;echo \`date +&quot;%Y%m%d%H%M&quot;_\`\`git describe --tags --always\`&#39;</span><span style="color:#24292E;">)</span><span style="color:#032F62;">.trim</span><span style="color:#24292E;">()</span></span>
<span class="line"><span style="color:#24292E;">			</span><span style="color:#6F42C1;">stage(</span><span style="color:#6F42C1;">&#39;ç¼–è¯‘æè¿°&#39;</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">				</span><span style="color:#6F42C1;">//</span><span style="color:#24292E;"> </span><span style="color:#032F62;">è‡ªå®šä¹‰è®¾ç½®æ„å»ºå†å²æ˜¾ç¤ºçš„åç§°å’Œæè¿°ä¿¡æ¯</span></span>
<span class="line"><span style="color:#24292E;">				</span><span style="color:#6F42C1;">//</span><span style="color:#24292E;"> </span><span style="color:#032F62;">ä¸åŒçš„éƒ¨ç½²æ–¹å¼è®¾ç½®æ„å»ºå†å²æ˜¾ç¤ºçš„åç§°å’Œæè¿°ä¿¡æ¯æ–¹å¼ä¸ä¸€æ ·ï¼Œæ ¹æ®è‡ªå·±çš„éƒ¨ç½²æ–¹å¼è‡ªè¡Œç™¾åº¦æ‰¾åˆ°è®¾ç½®æ–¹æ³•</span></span>
<span class="line"><span style="color:#24292E;">				</span><span style="color:#6F42C1;">script</span><span style="color:#24292E;"> </span><span style="color:#032F62;">{</span></span>
<span class="line"><span style="color:#24292E;">					</span><span style="color:#6F42C1;">//è®¾ç½®buildName</span></span>
<span class="line"><span style="color:#24292E;">					</span><span style="color:#6F42C1;">wrap([$class:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;BuildUser&#39;]</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">						</span><span style="color:#6F42C1;">//ä¿®æ”¹Description</span></span>
<span class="line"><span style="color:#24292E;">						</span><span style="color:#6F42C1;">buildDescription</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;\${</span><span style="color:#24292E;">BUILD_USER</span><span style="color:#032F62;">} &gt; \${</span><span style="color:#24292E;">project_name</span><span style="color:#032F62;">} &gt; \${</span><span style="color:#24292E;">branch</span><span style="color:#032F62;">}&quot;</span></span>
<span class="line"><span style="color:#24292E;">					}</span></span>
<span class="line"><span style="color:#24292E;">				}</span></span>
<span class="line"><span style="color:#24292E;">			}</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#6F42C1;">stage(</span><span style="color:#6F42C1;">&#39;ä»£ç ç¼–è¯‘&#39;</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">                </span><span style="color:#6F42C1;">def</span><span style="color:#24292E;"> </span><span style="color:#032F62;">selectedProjects</span><span style="color:#24292E;"> </span><span style="color:#032F62;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">project_name.split</span><span style="color:#24292E;">(</span><span style="color:#6F42C1;">&#39;,&#39;</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">                </span><span style="color:#6F42C1;">selectedProjects.each</span><span style="color:#24292E;"> </span><span style="color:#032F62;">{</span><span style="color:#24292E;"> </span><span style="color:#032F62;">currentProjectName</span><span style="color:#24292E;"> -</span><span style="color:#D73A49;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">                    </span><span style="color:#6F42C1;">def</span><span style="color:#24292E;"> </span><span style="color:#032F62;">imageName</span><span style="color:#24292E;"> </span><span style="color:#032F62;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;\${</span><span style="color:#24292E;">currentProjectName</span><span style="color:#032F62;">}:\${</span><span style="color:#24292E;">tag</span><span style="color:#032F62;">}&quot;</span></span>
<span class="line"><span style="color:#24292E;">                    </span><span style="color:#6F42C1;">//def</span><span style="color:#24292E;"> </span><span style="color:#032F62;">newTag</span><span style="color:#24292E;"> </span><span style="color:#032F62;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">sh</span><span style="color:#24292E;">(</span><span style="color:#6F42C1;">returnStdout:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">true</span><span style="color:#032F62;">,</span><span style="color:#24292E;"> </span><span style="color:#032F62;">script:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;echo \`date +&quot;%Y%m%d%H%M&quot;_\`\`git describe --tags --always\`&#39;</span><span style="color:#24292E;">)</span><span style="color:#032F62;">.trim</span><span style="color:#24292E;">()</span></span>
<span class="line"><span style="color:#24292E;">                    </span><span style="color:#6F42C1;">sh</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;mvn clean package -Dmaven.test.skip=true&quot;</span></span>
<span class="line"><span style="color:#24292E;">                }</span></span>
<span class="line"><span style="color:#24292E;">            }</span></span>
<span class="line"><span style="color:#24292E;">			</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#6F42C1;">stage(</span><span style="color:#6F42C1;">&#39;æ„å»ºé•œåƒ&#39;</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">                </span><span style="color:#6F42C1;">def</span><span style="color:#24292E;"> </span><span style="color:#032F62;">selectedProjects</span><span style="color:#24292E;"> </span><span style="color:#032F62;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">project_name.split</span><span style="color:#24292E;">(</span><span style="color:#6F42C1;">&#39;,&#39;</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">                </span><span style="color:#6F42C1;">container(</span><span style="color:#6F42C1;">&#39;docker&#39;</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">                    </span><span style="color:#6F42C1;">selectedProjects.each</span><span style="color:#24292E;"> </span><span style="color:#032F62;">{</span><span style="color:#24292E;"> </span><span style="color:#032F62;">currentProjectName</span><span style="color:#24292E;"> -</span><span style="color:#D73A49;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">                        </span><span style="color:#6F42C1;">def</span><span style="color:#24292E;"> </span><span style="color:#032F62;">imageName</span><span style="color:#24292E;"> </span><span style="color:#032F62;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;\${</span><span style="color:#24292E;">currentProjectName</span><span style="color:#032F62;">}:\${</span><span style="color:#24292E;">tag</span><span style="color:#032F62;">}&quot;</span></span>
<span class="line"><span style="color:#24292E;">                        </span><span style="color:#6F42C1;">//def</span><span style="color:#24292E;"> </span><span style="color:#032F62;">newTag</span><span style="color:#24292E;"> </span><span style="color:#032F62;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">sh</span><span style="color:#24292E;">(</span><span style="color:#6F42C1;">returnStdout:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">true</span><span style="color:#032F62;">,</span><span style="color:#24292E;"> </span><span style="color:#032F62;">script:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;echo \`date +&quot;%Y%m%d%H%M&quot;_\`\`git describe --tags --always\`&#39;</span><span style="color:#24292E;">)</span><span style="color:#032F62;">.trim</span><span style="color:#24292E;">()</span></span>
<span class="line"><span style="color:#24292E;">                        </span><span style="color:#6F42C1;">sh</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;docker build -t \${</span><span style="color:#24292E;">imageName</span><span style="color:#032F62;">} .&quot;</span></span>
<span class="line"><span style="color:#24292E;">                        </span><span style="color:#6F42C1;">sh</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;docker tag \${</span><span style="color:#24292E;">imageName</span><span style="color:#032F62;">} \${</span><span style="color:#24292E;">harbor_url</span><span style="color:#032F62;">}/hsuing/\${</span><span style="color:#24292E;">harbor_project_name</span><span style="color:#032F62;">}:\${</span><span style="color:#24292E;">newTag</span><span style="color:#032F62;">}&quot;</span></span>
<span class="line"><span style="color:#24292E;">                        </span><span style="color:#6F42C1;">withCredentials([usernamePassword(credentialsId:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">harbor_auth,</span><span style="color:#24292E;"> </span><span style="color:#032F62;">passwordVariable:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;password&#39;,</span><span style="color:#24292E;"> </span><span style="color:#032F62;">usernameVariable:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;username&#39;</span><span style="color:#24292E;">)]) {</span></span>
<span class="line"><span style="color:#24292E;">							</span><span style="color:#6F42C1;">//ç™»å½•</span></span>
<span class="line"><span style="color:#24292E;">                            </span><span style="color:#6F42C1;">sh</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;docker login -u \${</span><span style="color:#24292E;">username</span><span style="color:#032F62;">} -p \${</span><span style="color:#24292E;">password</span><span style="color:#032F62;">} \${</span><span style="color:#24292E;">harbor_url</span><span style="color:#032F62;">}&quot;</span></span>
<span class="line"><span style="color:#24292E;">                            </span><span style="color:#6F42C1;">//ä¸Šä¼ é•œåƒ</span></span>
<span class="line"><span style="color:#24292E;">                            </span><span style="color:#6F42C1;">sh</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;docker push \${</span><span style="color:#24292E;">harbor_url</span><span style="color:#032F62;">}/hsuing/\${</span><span style="color:#24292E;">harbor_project_name</span><span style="color:#032F62;">}:\${</span><span style="color:#24292E;">newTag</span><span style="color:#032F62;">}&quot;</span></span>
<span class="line"><span style="color:#24292E;">                        }</span></span>
<span class="line"><span style="color:#24292E;">                        </span><span style="color:#6F42C1;">//åˆ é™¤æœ¬åœ°é•œåƒ</span></span>
<span class="line"><span style="color:#24292E;">                        </span><span style="color:#6F42C1;">sh</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;docker rmi -f \${</span><span style="color:#24292E;">imageName</span><span style="color:#032F62;">}&quot;</span></span>
<span class="line"><span style="color:#24292E;">                        </span><span style="color:#6F42C1;">sh</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;docker rmi -f \${</span><span style="color:#24292E;">harbor_url</span><span style="color:#032F62;">}/hsuing/\${</span><span style="color:#24292E;">harbor_project_name</span><span style="color:#032F62;">}:\${</span><span style="color:#24292E;">newTag</span><span style="color:#032F62;">}&quot;</span></span>
<span class="line"><span style="color:#24292E;">                    }</span></span>
<span class="line"><span style="color:#24292E;">                }</span></span>
<span class="line"><span style="color:#24292E;">            }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#6F42C1;">stage(</span><span style="color:#6F42C1;">&#39;éƒ¨ç½²åˆ°k8så¹³å°&#39;</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">                </span><span style="color:#6F42C1;">def</span><span style="color:#24292E;"> </span><span style="color:#032F62;">selectedProjects</span><span style="color:#24292E;"> </span><span style="color:#032F62;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">project_name.split</span><span style="color:#24292E;">(</span><span style="color:#6F42C1;">&#39;,&#39;</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">                </span><span style="color:#6F42C1;">selectedProjects.each</span><span style="color:#24292E;"> </span><span style="color:#032F62;">{</span><span style="color:#24292E;"> </span><span style="color:#032F62;">currentProjectName</span><span style="color:#24292E;"> -</span><span style="color:#D73A49;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">                    </span><span style="color:#6F42C1;">//def</span><span style="color:#24292E;"> </span><span style="color:#032F62;">newTag</span><span style="color:#24292E;"> </span><span style="color:#032F62;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">sh</span><span style="color:#24292E;">(</span><span style="color:#6F42C1;">returnStdout:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">true</span><span style="color:#032F62;">,</span><span style="color:#24292E;"> </span><span style="color:#032F62;">script:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;echo \`date +&quot;%Y%m%d%H%M&quot;_\`\`git describe --tags --always\`&#39;</span><span style="color:#24292E;">)</span><span style="color:#032F62;">.trim</span><span style="color:#24292E;">()</span></span>
<span class="line"><span style="color:#24292E;">                    </span><span style="color:#6F42C1;">def</span><span style="color:#24292E;"> </span><span style="color:#032F62;">deploy_image_name</span><span style="color:#24292E;"> </span><span style="color:#032F62;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;\${</span><span style="color:#24292E;">harbor_url</span><span style="color:#032F62;">}/hsuing/\${</span><span style="color:#24292E;">harbor_project_name</span><span style="color:#032F62;">}:\${</span><span style="color:#24292E;">newTag</span><span style="color:#032F62;">}&quot;</span></span>
<span class="line"><span style="color:#24292E;">                    </span><span style="color:#6F42C1;">sh</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#032F62;">                        sed -i &#39;s#</span><span style="color:#005CC5;">\\$</span><span style="color:#032F62;">IMAGE_NAME#\${</span><span style="color:#24292E;">deploy_image_name</span><span style="color:#032F62;">}#&#39; deployment.yaml</span></span>
<span class="line"><span style="color:#032F62;">                        sed -i &#39;s#</span><span style="color:#005CC5;">\\$</span><span style="color:#032F62;">APP_NAME#\${</span><span style="color:#24292E;">currentProjectName</span><span style="color:#032F62;">}#&#39;  deployment.yaml</span></span>
<span class="line"><span style="color:#032F62;">                        sed -i &#39;s#</span><span style="color:#005CC5;">\\$</span><span style="color:#032F62;">APP_REPLICAS#\${</span><span style="color:#24292E;">replicas</span><span style="color:#032F62;">}#&#39; deployment.yaml</span></span>
<span class="line"><span style="color:#032F62;">                        sed -i &#39;s#</span><span style="color:#005CC5;">\\$</span><span style="color:#032F62;">NAMESPACE#\${</span><span style="color:#24292E;">namespaces</span><span style="color:#032F62;">}#&#39; deployment.yaml</span></span>
<span class="line"><span style="color:#032F62;">                        sed -i &#39;s#</span><span style="color:#005CC5;">\\$</span><span style="color:#032F62;">SPRINGENV#\${</span><span style="color:#24292E;">springProfilesActive</span><span style="color:#032F62;">}#&#39; deployment.yaml</span></span>
<span class="line"><span style="color:#032F62;">                        sed -i &#39;s#</span><span style="color:#005CC5;">\\$</span><span style="color:#032F62;">PODMEMORY#\${</span><span style="color:#24292E;">podsMem</span><span style="color:#032F62;">}#&#39; deployment.yaml</span></span>
<span class="line"><span style="color:#032F62;">                        sed -i &#39;s#</span><span style="color:#005CC5;">\\$</span><span style="color:#032F62;">PODCPU#\${</span><span style="color:#24292E;">podsCpu</span><span style="color:#032F62;">}#&#39; deployment.yaml</span></span>
<span class="line"><span style="color:#032F62;">                        cat deployment.yaml</span></span>
<span class="line"><span style="color:#032F62;">                    &quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#24292E;">                    </span><span style="color:#6F42C1;">kubernetesDeploy(kubeconfigId:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;55a88b59-fd12-4bf0-ba57-8a664fed2f71&quot;,</span><span style="color:#24292E;"> </span><span style="color:#032F62;">configs:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;deployment.yaml&quot;</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">                }</span></span>
<span class="line"><span style="color:#24292E;">            }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#6F42C1;">stage(</span><span style="color:#6F42C1;">&#39;å‘é€é£ä¹¦é€šçŸ¥&#39;</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">                </span><span style="color:#6F42C1;">//</span><span style="color:#24292E;"> </span><span style="color:#032F62;">è·å–æ‰§è¡Œç”¨æˆ·</span></span>
<span class="line"><span style="color:#24292E;">                </span><span style="color:#6F42C1;">wrap([$class:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;BuildUser&#39;]</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">                    </span><span style="color:#6F42C1;">//</span><span style="color:#24292E;"> </span><span style="color:#032F62;">å‘é€é£ä¹¦é€šçŸ¥</span></span>
<span class="line"><span style="color:#24292E;">                    </span><span style="color:#6F42C1;">lark</span><span style="color:#24292E;"> (</span></span>
<span class="line"><span style="color:#24292E;">                        </span><span style="color:#6F42C1;">robot:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;</span><span style="color:#24292E;">$lark_robot_id</span><span style="color:#032F62;">&quot;,</span></span>
<span class="line"><span style="color:#24292E;">                        </span><span style="color:#005CC5;">type</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;CARD&quot;,</span></span>
<span class="line"><span style="color:#24292E;">                        </span><span style="color:#6F42C1;">title:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;ğŸ“¢  Jenkins é•œåƒæ„å»ºæˆåŠŸ&quot;,</span></span>
<span class="line"><span style="color:#24292E;">                        </span><span style="color:#6F42C1;">text:</span><span style="color:#24292E;"> [</span></span>
<span class="line"><span style="color:#24292E;">                            </span><span style="color:#6F42C1;">&quot;ğŸ“‹ **ä»»åŠ¡åç§°**ï¼š[\${</span><span style="color:#24292E;">JOB_NAME</span><span style="color:#6F42C1;">}](\${</span><span style="color:#24292E;">JOB_URL</span><span style="color:#6F42C1;">})&quot;</span><span style="color:#6F42C1;">,</span></span>
<span class="line"><span style="color:#24292E;">                            </span><span style="color:#6F42C1;">&quot;ğŸ”¢ **ä»»åŠ¡ç¼–å·**ï¼š[\${</span><span style="color:#24292E;">BUILD_DISPLAY_NAME</span><span style="color:#6F42C1;">}](\${</span><span style="color:#24292E;">BUILD_URL</span><span style="color:#6F42C1;">})&quot;</span><span style="color:#6F42C1;">,</span></span>
<span class="line"><span style="color:#24292E;">                            </span><span style="color:#6F42C1;">&quot;ğŸŒŸ **æ„å»ºçŠ¶æ€**: &lt;font color=&#39;green&#39;&gt;æˆåŠŸ&lt;/font&gt;&quot;</span><span style="color:#6F42C1;">,</span></span>
<span class="line"><span style="color:#24292E;">                            </span><span style="color:#6F42C1;">&quot;ğŸ¤© **é•œåƒç‰ˆæœ¬**: \${</span><span style="color:#24292E;">newTag</span><span style="color:#6F42C1;">}&quot;</span><span style="color:#6F42C1;">,</span></span>
<span class="line"><span style="color:#24292E;">                            </span><span style="color:#6F42C1;">&quot;ğŸ˜ **é•œåƒä»“åº“**: \${</span><span style="color:#24292E;">harbor_url</span><span style="color:#6F42C1;">}/hsuing/\${</span><span style="color:#24292E;">harbor_project_name</span><span style="color:#6F42C1;">}&quot;</span><span style="color:#6F42C1;">,</span></span>
<span class="line"><span style="color:#24292E;">                            </span><span style="color:#6F42C1;">&quot;ğŸ• **æ„å»ºç”¨æ—¶**: \${</span><span style="color:#24292E;">currentBuild</span><span style="color:#6F42C1;">.</span><span style="color:#24292E;">duration</span><span style="color:#6F42C1;">} ms&quot;</span><span style="color:#6F42C1;">,</span></span>
<span class="line"><span style="color:#24292E;">                            </span><span style="color:#6F42C1;">&quot;ğŸ‘¤ **æ‰§è¡Œè€…**: \${</span><span style="color:#24292E;">env</span><span style="color:#6F42C1;">.</span><span style="color:#24292E;">BUILD_USER</span><span style="color:#6F42C1;">}&quot;</span><span style="color:#6F42C1;">,</span></span>
<span class="line"><span style="color:#24292E;">                            </span><span style="color:#6F42C1;">&quot;&lt;at id=all&gt;&lt;/at&gt;&quot;</span></span>
<span class="line"><span style="color:#24292E;">                        ],</span></span>
<span class="line"><span style="color:#24292E;">                        </span><span style="color:#6F42C1;">buttons:</span><span style="color:#24292E;"> [</span></span>
<span class="line"><span style="color:#24292E;">                            [</span></span>
<span class="line"><span style="color:#24292E;">                                title: </span><span style="color:#032F62;">&quot;æ›´æ”¹è®°å½•&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">                                url: </span><span style="color:#032F62;">&quot;\${</span><span style="color:#24292E;">BUILD_URL</span><span style="color:#032F62;">}changes&quot;</span></span>
<span class="line"><span style="color:#24292E;">                            ]</span><span style="color:#6F42C1;">,</span></span>
<span class="line"><span style="color:#24292E;">                            [</span></span>
<span class="line"><span style="color:#24292E;">                                title: </span><span style="color:#032F62;">&quot;æ§åˆ¶å°&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">                                type: </span><span style="color:#032F62;">&quot;danger&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">                                url: </span><span style="color:#032F62;">&quot;\${</span><span style="color:#24292E;">BUILD_URL</span><span style="color:#032F62;">}console&quot;</span></span>
<span class="line"><span style="color:#24292E;">                            ]</span></span>
<span class="line"><span style="color:#24292E;">                        ]</span></span>
<span class="line"><span style="color:#24292E;">                    )</span></span>
<span class="line"><span style="color:#24292E;">                }</span></span>
<span class="line"><span style="color:#24292E;">            }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">        } catch (</span><span style="color:#6F42C1;">Exception</span><span style="color:#24292E;"> </span><span style="color:#032F62;">e</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#6F42C1;">currentBuild.result</span><span style="color:#24292E;"> </span><span style="color:#032F62;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;FAILURE&#39;</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#6F42C1;">error</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;Pipeline failed: \${</span><span style="color:#24292E;">e</span><span style="color:#032F62;">.</span><span style="color:#24292E;">message</span><span style="color:#032F62;">}&quot;</span></span>
<span class="line"><span style="color:#24292E;">        }</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre></div><ul><li>æ•ˆæœ</li></ul><p><img src="https://nnaigos.oss-cn-hangzhou.aliyuncs.com/imgs/202408151504521.png" alt="image-20240815150401558"></p><ul><li>æŠ¥è­¦æ•ˆæœ</li></ul><p><img src="https://nnaigos.oss-cn-hangzhou.aliyuncs.com/imgs/202408151505149.png" alt="image-20240815150447789"></p>`,32),e=[o];function t(c,r,E,y,F,i){return n(),a("div",null,e)}const B=s(p,[["render",t]]);export{C as __pageData,B as default};
