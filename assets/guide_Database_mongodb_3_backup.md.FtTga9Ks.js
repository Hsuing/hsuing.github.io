import{_ as s,o as n,c as a,R as o}from"./chunks/framework.zUbWieqp.js";const F=JSON.parse('{"title":"MongoDB 备份方式","description":"","frontmatter":{},"headers":[],"relativePath":"guide/Database/mongodb/3_backup.md","filePath":"guide/Database/mongodb/3_backup.md","lastUpdated":1704853811000}'),e={name:"guide/Database/mongodb/3_backup.md"},l=o(`<h1 id="mongodb-备份方式" tabindex="-1">MongoDB 备份方式 <a class="header-anchor" href="#mongodb-备份方式" aria-label="Permalink to &quot;MongoDB 备份方式&quot;">​</a></h1><ul><li>mongodump</li><li>系统快照(具体内容见官网：<a href="https://docs.mongodb.com/manual/core/backups/#back-up-with-filesystem-snapshots" target="_blank" rel="noreferrer">Back Up with Filesystem Snapshots</a>)</li><li>cp 或者 rsync</li></ul><h1 id="_0-区别" tabindex="-1">0.区别 <a class="header-anchor" href="#_0-区别" aria-label="Permalink to &quot;0.区别&quot;">​</a></h1><table><thead><tr><th>区别</th><th>mongodump/mongorestore</th><th>mongoexport/mongoimport</th></tr></thead><tbody><tr><td>主要用途</td><td>数据备份小规模或部分或测试期间的数据/恢复</td><td>备份/恢复小型的MongoDB数据库</td></tr><tr><td>导出格式</td><td>JSON/CSV</td><td>BSON</td></tr><tr><td>指定导出</td><td>不支持导出单个db的所有collection</td><td>支持导出单个db的所有collection</td></tr><tr><td>注意事项</td><td>不要用于生产环境的备份</td><td>不适合备份/恢复大型MongoDB数据库</td></tr></tbody></table><h1 id="_1-mongodump" tabindex="-1">1.mongodump <a class="header-anchor" href="#_1-mongodump" aria-label="Permalink to &quot;1.mongodump&quot;">​</a></h1><p>下载mongdodump</p><p><a href="https://www.mongodb.com/try/download/database-tools" target="_blank" rel="noreferrer">https://www.mongodb.com/try/download/database-tools</a></p><h2 id="mongodump参数" tabindex="-1">mongodump参数 <a class="header-anchor" href="#mongodump参数" aria-label="Permalink to &quot;mongodump参数&quot;">​</a></h2><p>官方文档：<a href="https://docs.mongodb.com/v4.2/reference/program/mongodump/#bin.mongodump" target="_blank" rel="noreferrer">https://docs.mongodb.com/v4.2/reference/program/mongodump/#bin.mongodump</a></p><p><a href="https://www.mongodb.com/docs/database-tools/mongodump/#mongodb-binary-bin.mongodump" target="_blank" rel="noreferrer">https://www.mongodb.com/docs/database-tools/mongodump/#mongodb-binary-bin.mongodump</a></p><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">mongodump </span><span style="color:#6A737D;">--help</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">mongodump </span><span style="color:#6A737D;">--help</span></span></code></pre></div><table><thead><tr><th>参数</th><th>介绍</th></tr></thead><tbody><tr><td><strong>-h</strong>，--host</td><td>127.0.0.1，当然也可以指定端口号：127.0.0.1:27017</td></tr><tr><td>-d，--db</td><td>需要备份的数据库实例</td></tr><tr><td>-u，--username</td><td>指定用户名</td></tr><tr><td><strong>-o</strong>，--out</td><td>备份的数据存放位置</td></tr><tr><td>-c，--collection</td><td>指定表名字</td></tr><tr><td>-p，--password</td><td>指定密码</td></tr><tr><td>--port</td><td>指定端口</td></tr><tr><td>--archive</td><td>备份到一个文件</td></tr><tr><td>--oplog</td><td>使用oplog进行时间点快照</td></tr><tr><td>--authenticationDatabase</td><td>--authenticationDatabase</td></tr></tbody></table><blockquote><p>[!WARNING]</p><p>WARNING</p><p>Failed: bad option: --out not allowed when --archive is specified -o, --out 不能和 --archive 同时指定</p><p>仅备份数据库中的文档，不备份索引，所以我们还原后，需要重新生成索引。</p><p>mongodump 备份过程中会对 mongod 服务的性能产生影响，我们建议在业务低峰期进行操作。如果我们备份的数据，大于系统内存，我们备份的时候容易出现错误</p></blockquote><h2 id="无用户密码dump" tabindex="-1">无用户密码dump <a class="header-anchor" href="#无用户密码dump" aria-label="Permalink to &quot;无用户密码dump&quot;">​</a></h2><h3 id="备份单个库" tabindex="-1">备份单个库 <a class="header-anchor" href="#备份单个库" aria-label="Permalink to &quot;备份单个库&quot;">​</a></h3><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">[root@slave01 ~]# mongodump  -h 127.0.0.1 --port 27017 -d test -o /root/test</span></span>
<span class="line"><span style="color:#e1e4e8;">2021-12-14T02:18:29.459-0500	writing test.userdetails to /root/test/test/userdetails.bson</span></span>
<span class="line"><span style="color:#e1e4e8;">2021-12-14T02:18:29.460-0500	done dumping test.userdetails (1 document)</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">注意：</span></span>
<span class="line"><span style="color:#e1e4e8;">   /root/test下test 目录必须为空，否则失败，没有自动创建test目录</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">[root@slave01 ~]# mongodump  -h 127.0.0.1 --port 27017 -d test -o /root/test</span></span>
<span class="line"><span style="color:#24292e;">2021-12-14T02:18:29.459-0500	writing test.userdetails to /root/test/test/userdetails.bson</span></span>
<span class="line"><span style="color:#24292e;">2021-12-14T02:18:29.460-0500	done dumping test.userdetails (1 document)</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">注意：</span></span>
<span class="line"><span style="color:#24292e;">   /root/test下test 目录必须为空，否则失败，没有自动创建test目录</span></span></code></pre></div><h3 id="备份所有库" tabindex="-1">备份所有库 <a class="header-anchor" href="#备份所有库" aria-label="Permalink to &quot;备份所有库&quot;">​</a></h3><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">#不指定-d 参数，备份所有库，--oplog参数（的开启副本才行），这样的备份是基于某一时间点的快照，只能用于备份全部库时才可用，单库和单表不适用</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">[root@slave01 ~]# mongodump  -h 127.0.0.1 --port 27017  -o /root/test</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">2021-12-14T02:49:52.383-0500	writing admin.system.users to /root/test/admin/system.users.bson</span></span>
<span class="line"><span style="color:#e1e4e8;">2021-12-14T02:49:52.384-0500	done dumping admin.system.users (3 documents)</span></span>
<span class="line"><span style="color:#e1e4e8;">2021-12-14T02:49:52.384-0500	writing admin.system.version to /root/test/admin/system.version.bson</span></span>
<span class="line"><span style="color:#e1e4e8;">2021-12-14T02:49:52.385-0500	done dumping admin.system.version (2 documents)</span></span>
<span class="line"><span style="color:#e1e4e8;">2021-12-14T02:49:52.385-0500	writing test.userdetails to /root/test/test/userdetails.bson</span></span>
<span class="line"><span style="color:#e1e4e8;">2021-12-14T02:49:52.386-0500	done dumping test.userdetails (1 document)</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">#不指定-d 参数，备份所有库，--oplog参数（的开启副本才行），这样的备份是基于某一时间点的快照，只能用于备份全部库时才可用，单库和单表不适用</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">[root@slave01 ~]# mongodump  -h 127.0.0.1 --port 27017  -o /root/test</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">2021-12-14T02:49:52.383-0500	writing admin.system.users to /root/test/admin/system.users.bson</span></span>
<span class="line"><span style="color:#24292e;">2021-12-14T02:49:52.384-0500	done dumping admin.system.users (3 documents)</span></span>
<span class="line"><span style="color:#24292e;">2021-12-14T02:49:52.384-0500	writing admin.system.version to /root/test/admin/system.version.bson</span></span>
<span class="line"><span style="color:#24292e;">2021-12-14T02:49:52.385-0500	done dumping admin.system.version (2 documents)</span></span>
<span class="line"><span style="color:#24292e;">2021-12-14T02:49:52.385-0500	writing test.userdetails to /root/test/test/userdetails.bson</span></span>
<span class="line"><span style="color:#24292e;">2021-12-14T02:49:52.386-0500	done dumping test.userdetails (1 document)</span></span></code></pre></div><h3 id="备份单个表" tabindex="-1">备份单个表 <a class="header-anchor" href="#备份单个表" aria-label="Permalink to &quot;备份单个表&quot;">​</a></h3><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">[root@slave01 test]# mongodump  -h 127.0.0.1 --port 27017 -d test -c userdetails -o /root/test/test_userdetails</span></span>
<span class="line"><span style="color:#e1e4e8;">2021-12-14T02:32:36.415-0500	writing test.userdetails to /root/test/test_userdetails/test/userdetails.bson</span></span>
<span class="line"><span style="color:#e1e4e8;">2021-12-14T02:32:36.417-0500	done dumping test.userdetails (1 document)</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">[root@slave01 test]# mongodump  -h 127.0.0.1 --port 27017 -d test -c userdetails -o /root/test/test_userdetails</span></span>
<span class="line"><span style="color:#24292e;">2021-12-14T02:32:36.415-0500	writing test.userdetails to /root/test/test_userdetails/test/userdetails.bson</span></span>
<span class="line"><span style="color:#24292e;">2021-12-14T02:32:36.417-0500	done dumping test.userdetails (1 document)</span></span></code></pre></div><ul><li>带密码备份</li></ul><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">mongodump -u admin -p password -h 127.0.0.1 --port 27017 -d db_name -o /path/db_name</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">mongodump -u admin -p password -h 127.0.0.1 --port 27017 -d db_name -o /path/db_name</span></span></code></pre></div><h3 id="压缩备份" tabindex="-1">压缩备份 <a class="header-anchor" href="#压缩备份" aria-label="Permalink to &quot;压缩备份&quot;">​</a></h3><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">[root@slave01 ~]#  mongodump -h 127.0.0.1 --port=27017 -d test --archive=/path/test.gz --gzip</span></span>
<span class="line"><span style="color:#e1e4e8;">2021-12-14T21:19:12.340-0500	writing test.user to archive &#39;test.gz&#39;</span></span>
<span class="line"><span style="color:#e1e4e8;">2021-12-14T21:19:12.345-0500	writing test.userdetails to archive &#39;test.gz&#39;</span></span>
<span class="line"><span style="color:#e1e4e8;">2021-12-14T21:19:12.347-0500	done dumping test.userdetails (1 document)</span></span>
<span class="line"><span style="color:#e1e4e8;">2021-12-14T21:19:12.347-0500	done dumping test.user (1 document)</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">[root@slave01 ~]#  mongodump -h 127.0.0.1 --port=27017 -d test --archive=/path/test.gz --gzip</span></span>
<span class="line"><span style="color:#24292e;">2021-12-14T21:19:12.340-0500	writing test.user to archive &#39;test.gz&#39;</span></span>
<span class="line"><span style="color:#24292e;">2021-12-14T21:19:12.345-0500	writing test.userdetails to archive &#39;test.gz&#39;</span></span>
<span class="line"><span style="color:#24292e;">2021-12-14T21:19:12.347-0500	done dumping test.userdetails (1 document)</span></span>
<span class="line"><span style="color:#24292e;">2021-12-14T21:19:12.347-0500	done dumping test.user (1 document)</span></span></code></pre></div><h3 id="用户鉴定库备份" tabindex="-1">用户鉴定库备份 <a class="header-anchor" href="#用户鉴定库备份" aria-label="Permalink to &quot;用户鉴定库备份&quot;">​</a></h3><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">#参数 --authenticationDatabase admin ，admin 不可修改</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">[root@slave01 ~]# mongodump -u admin -p 123456 -h 127.0.0.1 --port=27017 --authenticationDatabase admin -d test --archive=/root/test.gz --gzip</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">2021-12-15T00:49:40.824-0500	writing test.user to archive &#39;/root/test.gz&#39;</span></span>
<span class="line"><span style="color:#e1e4e8;">2021-12-15T00:49:40.827-0500	writing test.userdetails to archive &#39;/root/test.gz&#39;</span></span>
<span class="line"><span style="color:#e1e4e8;">2021-12-15T00:49:40.831-0500	done dumping test.user (1 document)</span></span>
<span class="line"><span style="color:#e1e4e8;">2021-12-15T00:49:40.836-0500	done dumping test.userdetails (1 document)</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">#参数 --authenticationDatabase admin ，admin 不可修改</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">[root@slave01 ~]# mongodump -u admin -p 123456 -h 127.0.0.1 --port=27017 --authenticationDatabase admin -d test --archive=/root/test.gz --gzip</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">2021-12-15T00:49:40.824-0500	writing test.user to archive &#39;/root/test.gz&#39;</span></span>
<span class="line"><span style="color:#24292e;">2021-12-15T00:49:40.827-0500	writing test.userdetails to archive &#39;/root/test.gz&#39;</span></span>
<span class="line"><span style="color:#24292e;">2021-12-15T00:49:40.831-0500	done dumping test.user (1 document)</span></span>
<span class="line"><span style="color:#24292e;">2021-12-15T00:49:40.836-0500	done dumping test.userdetails (1 document)</span></span></code></pre></div><h4 id="带有加密算法备份" tabindex="-1">带有加密算法备份 <a class="header-anchor" href="#带有加密算法备份" aria-label="Permalink to &quot;带有加密算法备份&quot;">​</a></h4><div class="language-sql vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">#备份所有库</span></span>
<span class="line"><span style="color:#F97583;">/data/</span><span style="color:#E1E4E8;">apps</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">mongo_tools</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">bin</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">mongodump </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">u leihuo </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">p fa2e5474db854dd </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">h </span><span style="color:#79B8FF;">172</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">16</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">195</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">193</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;">--port 47017 --authenticationDatabase admin --authenticationMechanism=SCRAM-SHA-1 -o /root/yidu_mongo</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">#备份所有库</span></span>
<span class="line"><span style="color:#D73A49;">/data/</span><span style="color:#24292E;">apps</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">mongo_tools</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">bin</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">mongodump </span><span style="color:#D73A49;">-</span><span style="color:#24292E;">u leihuo </span><span style="color:#D73A49;">-</span><span style="color:#24292E;">p fa2e5474db854dd </span><span style="color:#D73A49;">-</span><span style="color:#24292E;">h </span><span style="color:#005CC5;">172</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">16</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">195</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">193</span><span style="color:#24292E;"> </span><span style="color:#6A737D;">--port 47017 --authenticationDatabase admin --authenticationMechanism=SCRAM-SHA-1 -o /root/yidu_mongo</span></span></code></pre></div><h2 id="生产环境备份" tabindex="-1">生产环境备份 <a class="header-anchor" href="#生产环境备份" aria-label="Permalink to &quot;生产环境备份&quot;">​</a></h2><p><a href="https://docs.mongodb.com/manual/core/backups/#back-up-with-mongodump" target="_blank" rel="noreferrer">https://docs.mongodb.com/manual/core/backups/#back-up-with-mongodump</a></p><h1 id="_2-mongorestore" tabindex="-1">2.mongorestore <a class="header-anchor" href="#_2-mongorestore" aria-label="Permalink to &quot;2.mongorestore&quot;">​</a></h1><h2 id="参数" tabindex="-1">参数 <a class="header-anchor" href="#参数" aria-label="Permalink to &quot;参数&quot;">​</a></h2><table><thead><tr><th>参数</th><th>介绍</th></tr></thead><tbody><tr><td>--drop</td><td>删除现有数据</td></tr><tr><td>-d，--dir</td><td>指定要恢复的数据存放的文件夹</td></tr><tr><td>--archive</td><td>指定恢复的文件名称</td></tr><tr><td>--excludeCollection</td><td>不恢复指定集合</td></tr><tr><td>--excludeCollectionsWithPrefix</td><td>不恢复匹配前缀的集合</td></tr></tbody></table><blockquote><p>[!WARNING] WARNING</p><p>Failed: stream or file does not appear to be a mongodump archive 可能是压缩过的文件，需指定 --gzip 参数</p></blockquote><h2 id="恢复压缩包库" tabindex="-1">恢复压缩包库 <a class="header-anchor" href="#恢复压缩包库" aria-label="Permalink to &quot;恢复压缩包库&quot;">​</a></h2><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">#删除原有的库</span></span>
<span class="line"><span style="color:#e1e4e8;">[root@slave01 ~]# mongorestore -d test --drop  --archive=test.gz --gzip</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">2021-12-14T21:24:55.685-0500	The --db and --collection flags are deprecated for this use-case; please use --nsInclude instead, i.e. with --nsInclude=\${DATABASE}.\${COLLECTION}</span></span>
<span class="line"><span style="color:#e1e4e8;">2021-12-14T21:24:55.695-0500	preparing collections to restore from</span></span>
<span class="line"><span style="color:#e1e4e8;">2021-12-14T21:24:55.715-0500	reading metadata for test.user from archive &#39;test.gz&#39;</span></span>
<span class="line"><span style="color:#e1e4e8;">2021-12-14T21:24:55.715-0500	reading metadata for test.userdetails from archive &#39;test.gz&#39;</span></span>
<span class="line"><span style="color:#e1e4e8;">2021-12-14T21:24:55.720-0500	dropping collection test.userdetails before restoring</span></span>
<span class="line"><span style="color:#e1e4e8;">2021-12-14T21:24:55.732-0500	restoring test.userdetails from archive &#39;test.gz&#39;</span></span>
<span class="line"><span style="color:#e1e4e8;">2021-12-14T21:24:55.743-0500	finished restoring test.userdetails (1 document, 0 failures)</span></span>
<span class="line"><span style="color:#e1e4e8;">2021-12-14T21:24:55.743-0500	dropping collection test.user before restoring</span></span>
<span class="line"><span style="color:#e1e4e8;">2021-12-14T21:24:55.759-0500	restoring test.user from archive &#39;test.gz&#39;</span></span>
<span class="line"><span style="color:#e1e4e8;">2021-12-14T21:24:55.771-0500	finished restoring test.user (1 document, 0 failures)</span></span>
<span class="line"><span style="color:#e1e4e8;">2021-12-14T21:24:55.771-0500	no indexes to restore for collection test.user</span></span>
<span class="line"><span style="color:#e1e4e8;">2021-12-14T21:24:55.771-0500	no indexes to restore for collection test.userdetails</span></span>
<span class="line"><span style="color:#e1e4e8;">2021-12-14T21:24:55.771-0500	2 document(s) restored successfully. 0 document(s) failed to restore.</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">#删除原有的库</span></span>
<span class="line"><span style="color:#24292e;">[root@slave01 ~]# mongorestore -d test --drop  --archive=test.gz --gzip</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">2021-12-14T21:24:55.685-0500	The --db and --collection flags are deprecated for this use-case; please use --nsInclude instead, i.e. with --nsInclude=\${DATABASE}.\${COLLECTION}</span></span>
<span class="line"><span style="color:#24292e;">2021-12-14T21:24:55.695-0500	preparing collections to restore from</span></span>
<span class="line"><span style="color:#24292e;">2021-12-14T21:24:55.715-0500	reading metadata for test.user from archive &#39;test.gz&#39;</span></span>
<span class="line"><span style="color:#24292e;">2021-12-14T21:24:55.715-0500	reading metadata for test.userdetails from archive &#39;test.gz&#39;</span></span>
<span class="line"><span style="color:#24292e;">2021-12-14T21:24:55.720-0500	dropping collection test.userdetails before restoring</span></span>
<span class="line"><span style="color:#24292e;">2021-12-14T21:24:55.732-0500	restoring test.userdetails from archive &#39;test.gz&#39;</span></span>
<span class="line"><span style="color:#24292e;">2021-12-14T21:24:55.743-0500	finished restoring test.userdetails (1 document, 0 failures)</span></span>
<span class="line"><span style="color:#24292e;">2021-12-14T21:24:55.743-0500	dropping collection test.user before restoring</span></span>
<span class="line"><span style="color:#24292e;">2021-12-14T21:24:55.759-0500	restoring test.user from archive &#39;test.gz&#39;</span></span>
<span class="line"><span style="color:#24292e;">2021-12-14T21:24:55.771-0500	finished restoring test.user (1 document, 0 failures)</span></span>
<span class="line"><span style="color:#24292e;">2021-12-14T21:24:55.771-0500	no indexes to restore for collection test.user</span></span>
<span class="line"><span style="color:#24292e;">2021-12-14T21:24:55.771-0500	no indexes to restore for collection test.userdetails</span></span>
<span class="line"><span style="color:#24292e;">2021-12-14T21:24:55.771-0500	2 document(s) restored successfully. 0 document(s) failed to restore.</span></span></code></pre></div><h2 id="恢复单个库" tabindex="-1">恢复单个库 <a class="header-anchor" href="#恢复单个库" aria-label="Permalink to &quot;恢复单个库&quot;">​</a></h2><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">[root@slave01 test]# mongorestore -h 127.0.0.1 --port=27017  -d test /root/test/test</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">2021-12-14T04:22:35.064-0500</span><span style="color:#E1E4E8;">	</span><span style="color:#9ECBFF;">The</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--db</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">and</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--collection</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">flags</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">are</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">deprecated</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">for</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">this</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">use-case</span><span style="color:#E1E4E8;">; </span><span style="color:#B392F0;">please</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">use</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--nsInclude</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">instead,</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">i.e.</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">with</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--nsInclude=\${</span><span style="color:#E1E4E8;">DATABASE</span><span style="color:#79B8FF;">}.\${</span><span style="color:#E1E4E8;">COLLECTION</span><span style="color:#79B8FF;">}</span></span>
<span class="line"><span style="color:#B392F0;">2021-12-14T04:22:35.064-0500</span><span style="color:#E1E4E8;">	</span><span style="color:#9ECBFF;">building</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">a</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">list</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">of</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">collections</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">to</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">restore</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">from</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/root/test/test</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">dir</span></span>
<span class="line"><span style="color:#B392F0;">2021-12-14T04:22:35.064-0500</span><span style="color:#E1E4E8;">	</span><span style="color:#9ECBFF;">reading</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">metadata</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">for</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">test.userdetails</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">from</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/root/test/test/userdetails.metadata.json</span></span>
<span class="line"><span style="color:#B392F0;">2021-12-14T04:22:35.065-0500</span><span style="color:#E1E4E8;">	</span><span style="color:#9ECBFF;">restoring</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">to</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">existing</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">collection</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">test.userdetails</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">without</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">dropping</span></span>
<span class="line"><span style="color:#B392F0;">2021-12-14T04:22:35.065-0500</span><span style="color:#E1E4E8;">	</span><span style="color:#9ECBFF;">restoring</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">test.userdetails</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">from</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/root/test/test/userdetails.bson</span></span>
<span class="line"><span style="color:#B392F0;">2021-12-14T04:22:35.067-0500</span><span style="color:#E1E4E8;">	</span><span style="color:#9ECBFF;">continuing</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">through</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">error:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">E11000</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">duplicate</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">key</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">error</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">collection:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">test.userdetails</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">index:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">_id_</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">dup</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">key:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">{</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">_id:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">ObjectId</span><span style="color:#E1E4E8;">(</span><span style="color:#B392F0;">&#39;61b711f67978d27bed034272&#39;</span><span style="color:#E1E4E8;">) </span><span style="color:#9ECBFF;">}</span></span>
<span class="line"><span style="color:#B392F0;">2021-12-14T04:22:35.076-0500</span><span style="color:#E1E4E8;">	</span><span style="color:#9ECBFF;">finished</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">restoring</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">test.userdetails</span><span style="color:#E1E4E8;"> (0 </span><span style="color:#9ECBFF;">documents,</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">failure</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#B392F0;">2021-12-14T04:22:35.076-0500</span><span style="color:#E1E4E8;">	</span><span style="color:#9ECBFF;">no</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">indexes</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">to</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">restore</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">for</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">collection</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">test.userdetails</span></span>
<span class="line"><span style="color:#B392F0;">2021-12-14T04:22:35.076-0500</span><span style="color:#E1E4E8;">	</span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">document</span><span style="color:#E1E4E8;">(</span><span style="color:#B392F0;">s</span><span style="color:#E1E4E8;">) </span><span style="color:#9ECBFF;">restored</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">successfully.</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">document</span><span style="color:#E1E4E8;">(</span><span style="color:#B392F0;">s</span><span style="color:#E1E4E8;">) </span><span style="color:#9ECBFF;">failed</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">to</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">restore.</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">[root@slave01 test]# mongorestore -h 127.0.0.1 --port=27017  -d test /root/test/test</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">2021-12-14T04:22:35.064-0500</span><span style="color:#24292E;">	</span><span style="color:#032F62;">The</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--db</span><span style="color:#24292E;"> </span><span style="color:#032F62;">and</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--collection</span><span style="color:#24292E;"> </span><span style="color:#032F62;">flags</span><span style="color:#24292E;"> </span><span style="color:#032F62;">are</span><span style="color:#24292E;"> </span><span style="color:#032F62;">deprecated</span><span style="color:#24292E;"> </span><span style="color:#032F62;">for</span><span style="color:#24292E;"> </span><span style="color:#032F62;">this</span><span style="color:#24292E;"> </span><span style="color:#032F62;">use-case</span><span style="color:#24292E;">; </span><span style="color:#6F42C1;">please</span><span style="color:#24292E;"> </span><span style="color:#032F62;">use</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--nsInclude</span><span style="color:#24292E;"> </span><span style="color:#032F62;">instead,</span><span style="color:#24292E;"> </span><span style="color:#032F62;">i.e.</span><span style="color:#24292E;"> </span><span style="color:#032F62;">with</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--nsInclude=\${</span><span style="color:#24292E;">DATABASE</span><span style="color:#005CC5;">}.\${</span><span style="color:#24292E;">COLLECTION</span><span style="color:#005CC5;">}</span></span>
<span class="line"><span style="color:#6F42C1;">2021-12-14T04:22:35.064-0500</span><span style="color:#24292E;">	</span><span style="color:#032F62;">building</span><span style="color:#24292E;"> </span><span style="color:#032F62;">a</span><span style="color:#24292E;"> </span><span style="color:#032F62;">list</span><span style="color:#24292E;"> </span><span style="color:#032F62;">of</span><span style="color:#24292E;"> </span><span style="color:#032F62;">collections</span><span style="color:#24292E;"> </span><span style="color:#032F62;">to</span><span style="color:#24292E;"> </span><span style="color:#032F62;">restore</span><span style="color:#24292E;"> </span><span style="color:#032F62;">from</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/root/test/test</span><span style="color:#24292E;"> </span><span style="color:#032F62;">dir</span></span>
<span class="line"><span style="color:#6F42C1;">2021-12-14T04:22:35.064-0500</span><span style="color:#24292E;">	</span><span style="color:#032F62;">reading</span><span style="color:#24292E;"> </span><span style="color:#032F62;">metadata</span><span style="color:#24292E;"> </span><span style="color:#032F62;">for</span><span style="color:#24292E;"> </span><span style="color:#032F62;">test.userdetails</span><span style="color:#24292E;"> </span><span style="color:#032F62;">from</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/root/test/test/userdetails.metadata.json</span></span>
<span class="line"><span style="color:#6F42C1;">2021-12-14T04:22:35.065-0500</span><span style="color:#24292E;">	</span><span style="color:#032F62;">restoring</span><span style="color:#24292E;"> </span><span style="color:#032F62;">to</span><span style="color:#24292E;"> </span><span style="color:#032F62;">existing</span><span style="color:#24292E;"> </span><span style="color:#032F62;">collection</span><span style="color:#24292E;"> </span><span style="color:#032F62;">test.userdetails</span><span style="color:#24292E;"> </span><span style="color:#032F62;">without</span><span style="color:#24292E;"> </span><span style="color:#032F62;">dropping</span></span>
<span class="line"><span style="color:#6F42C1;">2021-12-14T04:22:35.065-0500</span><span style="color:#24292E;">	</span><span style="color:#032F62;">restoring</span><span style="color:#24292E;"> </span><span style="color:#032F62;">test.userdetails</span><span style="color:#24292E;"> </span><span style="color:#032F62;">from</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/root/test/test/userdetails.bson</span></span>
<span class="line"><span style="color:#6F42C1;">2021-12-14T04:22:35.067-0500</span><span style="color:#24292E;">	</span><span style="color:#032F62;">continuing</span><span style="color:#24292E;"> </span><span style="color:#032F62;">through</span><span style="color:#24292E;"> </span><span style="color:#032F62;">error:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">E11000</span><span style="color:#24292E;"> </span><span style="color:#032F62;">duplicate</span><span style="color:#24292E;"> </span><span style="color:#032F62;">key</span><span style="color:#24292E;"> </span><span style="color:#032F62;">error</span><span style="color:#24292E;"> </span><span style="color:#032F62;">collection:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">test.userdetails</span><span style="color:#24292E;"> </span><span style="color:#032F62;">index:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">_id_</span><span style="color:#24292E;"> </span><span style="color:#032F62;">dup</span><span style="color:#24292E;"> </span><span style="color:#032F62;">key:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">{</span><span style="color:#24292E;"> </span><span style="color:#032F62;">_id:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">ObjectId</span><span style="color:#24292E;">(</span><span style="color:#6F42C1;">&#39;61b711f67978d27bed034272&#39;</span><span style="color:#24292E;">) </span><span style="color:#032F62;">}</span></span>
<span class="line"><span style="color:#6F42C1;">2021-12-14T04:22:35.076-0500</span><span style="color:#24292E;">	</span><span style="color:#032F62;">finished</span><span style="color:#24292E;"> </span><span style="color:#032F62;">restoring</span><span style="color:#24292E;"> </span><span style="color:#032F62;">test.userdetails</span><span style="color:#24292E;"> (0 </span><span style="color:#032F62;">documents,</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">failure</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#6F42C1;">2021-12-14T04:22:35.076-0500</span><span style="color:#24292E;">	</span><span style="color:#032F62;">no</span><span style="color:#24292E;"> </span><span style="color:#032F62;">indexes</span><span style="color:#24292E;"> </span><span style="color:#032F62;">to</span><span style="color:#24292E;"> </span><span style="color:#032F62;">restore</span><span style="color:#24292E;"> </span><span style="color:#032F62;">for</span><span style="color:#24292E;"> </span><span style="color:#032F62;">collection</span><span style="color:#24292E;"> </span><span style="color:#032F62;">test.userdetails</span></span>
<span class="line"><span style="color:#6F42C1;">2021-12-14T04:22:35.076-0500</span><span style="color:#24292E;">	</span><span style="color:#005CC5;">0</span><span style="color:#24292E;"> </span><span style="color:#032F62;">document</span><span style="color:#24292E;">(</span><span style="color:#6F42C1;">s</span><span style="color:#24292E;">) </span><span style="color:#032F62;">restored</span><span style="color:#24292E;"> </span><span style="color:#032F62;">successfully.</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">document</span><span style="color:#24292E;">(</span><span style="color:#6F42C1;">s</span><span style="color:#24292E;">) </span><span style="color:#032F62;">failed</span><span style="color:#24292E;"> </span><span style="color:#032F62;">to</span><span style="color:#24292E;"> </span><span style="color:#032F62;">restore.</span></span></code></pre></div><h2 id="恢复单个表" tabindex="-1">恢复单个表 <a class="header-anchor" href="#恢复单个表" aria-label="Permalink to &quot;恢复单个表&quot;">​</a></h2><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">#语法</span></span>
<span class="line"><span style="color:#E1E4E8;">	</span><span style="color:#B392F0;">mongorestore</span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">-h</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">127.0</span><span style="color:#9ECBFF;">.0.1</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--port</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">27017</span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">-d</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">db_name</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-c</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">table_name</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/path/table_name.bson</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">[root@slave01 test]# mongorestore  -h 127.0.0.1 --port 27017  -d test -c userdetails /root/test/test_userdetails/test/userdetails.bson</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">2021-12-14T04:27:10.339-0500</span><span style="color:#E1E4E8;">	</span><span style="color:#9ECBFF;">checking</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">for</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">collection</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">data</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">in</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/root/test/test_userdetails/test/userdetails.bson</span></span>
<span class="line"><span style="color:#B392F0;">2021-12-14T04:27:10.339-0500</span><span style="color:#E1E4E8;">	</span><span style="color:#9ECBFF;">reading</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">metadata</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">for</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">test.userdetails</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">from</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/root/test/test_userdetails/test/userdetails.metadata.json</span></span>
<span class="line"><span style="color:#B392F0;">2021-12-14T04:27:10.340-0500</span><span style="color:#E1E4E8;">	</span><span style="color:#9ECBFF;">restoring</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">to</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">existing</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">collection</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">test.userdetails</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">without</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">dropping</span></span>
<span class="line"><span style="color:#B392F0;">2021-12-14T04:27:10.340-0500</span><span style="color:#E1E4E8;">	</span><span style="color:#9ECBFF;">restoring</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">test.userdetails</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">from</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/root/test/test_userdetails/test/userdetails.bson</span></span>
<span class="line"><span style="color:#B392F0;">2021-12-14T04:27:10.343-0500</span><span style="color:#E1E4E8;">	</span><span style="color:#9ECBFF;">continuing</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">through</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">error:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">E11000</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">duplicate</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">key</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">error</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">collection:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">test.userdetails</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">index:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">_id_</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">dup</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">key:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">{</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">_id:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">ObjectId</span><span style="color:#E1E4E8;">(</span><span style="color:#B392F0;">&#39;61b711f67978d27bed034272&#39;</span><span style="color:#E1E4E8;">) </span><span style="color:#9ECBFF;">}</span></span>
<span class="line"><span style="color:#B392F0;">2021-12-14T04:27:10.383-0500</span><span style="color:#E1E4E8;">	</span><span style="color:#9ECBFF;">finished</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">restoring</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">test.userdetails</span><span style="color:#E1E4E8;"> (0 </span><span style="color:#9ECBFF;">documents,</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">failure</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#B392F0;">2021-12-14T04:27:10.384-0500</span><span style="color:#E1E4E8;">	</span><span style="color:#9ECBFF;">no</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">indexes</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">to</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">restore</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">for</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">collection</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">test.userdetails</span></span>
<span class="line"><span style="color:#B392F0;">2021-12-14T04:27:10.384-0500</span><span style="color:#E1E4E8;">	</span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">document</span><span style="color:#E1E4E8;">(</span><span style="color:#B392F0;">s</span><span style="color:#E1E4E8;">) </span><span style="color:#9ECBFF;">restored</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">successfully.</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">document</span><span style="color:#E1E4E8;">(</span><span style="color:#B392F0;">s</span><span style="color:#E1E4E8;">) </span><span style="color:#9ECBFF;">failed</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">to</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">restore.</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">#语法</span></span>
<span class="line"><span style="color:#24292E;">	</span><span style="color:#6F42C1;">mongorestore</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">-h</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">127.0</span><span style="color:#032F62;">.0.1</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--port</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">27017</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">-d</span><span style="color:#24292E;"> </span><span style="color:#032F62;">db_name</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-c</span><span style="color:#24292E;"> </span><span style="color:#032F62;">table_name</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/path/table_name.bson</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">[root@slave01 test]# mongorestore  -h 127.0.0.1 --port 27017  -d test -c userdetails /root/test/test_userdetails/test/userdetails.bson</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">2021-12-14T04:27:10.339-0500</span><span style="color:#24292E;">	</span><span style="color:#032F62;">checking</span><span style="color:#24292E;"> </span><span style="color:#032F62;">for</span><span style="color:#24292E;"> </span><span style="color:#032F62;">collection</span><span style="color:#24292E;"> </span><span style="color:#032F62;">data</span><span style="color:#24292E;"> </span><span style="color:#032F62;">in</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/root/test/test_userdetails/test/userdetails.bson</span></span>
<span class="line"><span style="color:#6F42C1;">2021-12-14T04:27:10.339-0500</span><span style="color:#24292E;">	</span><span style="color:#032F62;">reading</span><span style="color:#24292E;"> </span><span style="color:#032F62;">metadata</span><span style="color:#24292E;"> </span><span style="color:#032F62;">for</span><span style="color:#24292E;"> </span><span style="color:#032F62;">test.userdetails</span><span style="color:#24292E;"> </span><span style="color:#032F62;">from</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/root/test/test_userdetails/test/userdetails.metadata.json</span></span>
<span class="line"><span style="color:#6F42C1;">2021-12-14T04:27:10.340-0500</span><span style="color:#24292E;">	</span><span style="color:#032F62;">restoring</span><span style="color:#24292E;"> </span><span style="color:#032F62;">to</span><span style="color:#24292E;"> </span><span style="color:#032F62;">existing</span><span style="color:#24292E;"> </span><span style="color:#032F62;">collection</span><span style="color:#24292E;"> </span><span style="color:#032F62;">test.userdetails</span><span style="color:#24292E;"> </span><span style="color:#032F62;">without</span><span style="color:#24292E;"> </span><span style="color:#032F62;">dropping</span></span>
<span class="line"><span style="color:#6F42C1;">2021-12-14T04:27:10.340-0500</span><span style="color:#24292E;">	</span><span style="color:#032F62;">restoring</span><span style="color:#24292E;"> </span><span style="color:#032F62;">test.userdetails</span><span style="color:#24292E;"> </span><span style="color:#032F62;">from</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/root/test/test_userdetails/test/userdetails.bson</span></span>
<span class="line"><span style="color:#6F42C1;">2021-12-14T04:27:10.343-0500</span><span style="color:#24292E;">	</span><span style="color:#032F62;">continuing</span><span style="color:#24292E;"> </span><span style="color:#032F62;">through</span><span style="color:#24292E;"> </span><span style="color:#032F62;">error:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">E11000</span><span style="color:#24292E;"> </span><span style="color:#032F62;">duplicate</span><span style="color:#24292E;"> </span><span style="color:#032F62;">key</span><span style="color:#24292E;"> </span><span style="color:#032F62;">error</span><span style="color:#24292E;"> </span><span style="color:#032F62;">collection:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">test.userdetails</span><span style="color:#24292E;"> </span><span style="color:#032F62;">index:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">_id_</span><span style="color:#24292E;"> </span><span style="color:#032F62;">dup</span><span style="color:#24292E;"> </span><span style="color:#032F62;">key:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">{</span><span style="color:#24292E;"> </span><span style="color:#032F62;">_id:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">ObjectId</span><span style="color:#24292E;">(</span><span style="color:#6F42C1;">&#39;61b711f67978d27bed034272&#39;</span><span style="color:#24292E;">) </span><span style="color:#032F62;">}</span></span>
<span class="line"><span style="color:#6F42C1;">2021-12-14T04:27:10.383-0500</span><span style="color:#24292E;">	</span><span style="color:#032F62;">finished</span><span style="color:#24292E;"> </span><span style="color:#032F62;">restoring</span><span style="color:#24292E;"> </span><span style="color:#032F62;">test.userdetails</span><span style="color:#24292E;"> (0 </span><span style="color:#032F62;">documents,</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">failure</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#6F42C1;">2021-12-14T04:27:10.384-0500</span><span style="color:#24292E;">	</span><span style="color:#032F62;">no</span><span style="color:#24292E;"> </span><span style="color:#032F62;">indexes</span><span style="color:#24292E;"> </span><span style="color:#032F62;">to</span><span style="color:#24292E;"> </span><span style="color:#032F62;">restore</span><span style="color:#24292E;"> </span><span style="color:#032F62;">for</span><span style="color:#24292E;"> </span><span style="color:#032F62;">collection</span><span style="color:#24292E;"> </span><span style="color:#032F62;">test.userdetails</span></span>
<span class="line"><span style="color:#6F42C1;">2021-12-14T04:27:10.384-0500</span><span style="color:#24292E;">	</span><span style="color:#005CC5;">0</span><span style="color:#24292E;"> </span><span style="color:#032F62;">document</span><span style="color:#24292E;">(</span><span style="color:#6F42C1;">s</span><span style="color:#24292E;">) </span><span style="color:#032F62;">restored</span><span style="color:#24292E;"> </span><span style="color:#032F62;">successfully.</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">document</span><span style="color:#24292E;">(</span><span style="color:#6F42C1;">s</span><span style="color:#24292E;">) </span><span style="color:#032F62;">failed</span><span style="color:#24292E;"> </span><span style="color:#032F62;">to</span><span style="color:#24292E;"> </span><span style="color:#032F62;">restore.</span></span></code></pre></div><h2 id="只恢复部分表" tabindex="-1">只恢复部分表 <a class="header-anchor" href="#只恢复部分表" aria-label="Permalink to &quot;只恢复部分表&quot;">​</a></h2><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">#语法</span></span>
<span class="line"><span style="color:#E1E4E8;">	--nsInclude</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&quot;支持正则&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">	</span><span style="color:#B392F0;">mongorestore</span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">-h</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">127.0</span><span style="color:#9ECBFF;">.0.1</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--port</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">27017</span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">-d</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">db_name</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--nsInclude=</span><span style="color:#9ECBFF;">&quot;test.use*&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/path/</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">[root@slave01 test]# mongorestore  -h 127.0.0.1 --port 27017  -d test --nsInclude=</span><span style="color:#9ECBFF;">&quot;test.user&quot;</span><span style="color:#E1E4E8;"> /root/test/test/</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">2021-12-14T04:38:28.334-0500</span><span style="color:#E1E4E8;">	</span><span style="color:#9ECBFF;">The</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--db</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">and</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--collection</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">flags</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">are</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">deprecated</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">for</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">this</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">use-case</span><span style="color:#E1E4E8;">; </span><span style="color:#B392F0;">please</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">use</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--nsInclude</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">instead,</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">i.e.</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">with</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--nsInclude=\${</span><span style="color:#E1E4E8;">DATABASE</span><span style="color:#79B8FF;">}.\${</span><span style="color:#E1E4E8;">COLLECTION</span><span style="color:#79B8FF;">}</span></span>
<span class="line"><span style="color:#B392F0;">2021-12-14T04:38:28.334-0500</span><span style="color:#E1E4E8;">	</span><span style="color:#9ECBFF;">building</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">a</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">list</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">of</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">collections</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">to</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">restore</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">from</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/root/test/test</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">dir</span></span>
<span class="line"><span style="color:#B392F0;">2021-12-14T04:38:28.334-0500</span><span style="color:#E1E4E8;">	</span><span style="color:#9ECBFF;">reading</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">metadata</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">for</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">test.user</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">from</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/root/test/test/user.metadata.json</span></span>
<span class="line"><span style="color:#B392F0;">2021-12-14T04:38:28.334-0500</span><span style="color:#E1E4E8;">	</span><span style="color:#9ECBFF;">reading</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">metadata</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">for</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">test.userdetails</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">from</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/root/test/test/userdetails.metadata.json</span></span>
<span class="line"><span style="color:#B392F0;">2021-12-14T04:38:28.335-0500</span><span style="color:#E1E4E8;">	</span><span style="color:#9ECBFF;">restoring</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">to</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">existing</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">collection</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">test.userdetails</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">without</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">dropping</span></span>
<span class="line"><span style="color:#B392F0;">2021-12-14T04:38:28.335-0500</span><span style="color:#E1E4E8;">	</span><span style="color:#9ECBFF;">restoring</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">test.userdetails</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">from</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/root/test/test/userdetails.bson</span></span>
<span class="line"><span style="color:#B392F0;">2021-12-14T04:38:28.339-0500</span><span style="color:#E1E4E8;">	</span><span style="color:#9ECBFF;">continuing</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">through</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">error:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">E11000</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">duplicate</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">key</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">error</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">collection:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">test.userdetails</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">index:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">_id_</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">dup</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">key:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">{</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">_id:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">ObjectId</span><span style="color:#E1E4E8;">(</span><span style="color:#B392F0;">&#39;61b711f67978d27bed034272&#39;</span><span style="color:#E1E4E8;">) </span><span style="color:#9ECBFF;">}</span></span>
<span class="line"><span style="color:#B392F0;">2021-12-14T04:38:28.347-0500</span><span style="color:#E1E4E8;">	</span><span style="color:#9ECBFF;">finished</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">restoring</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">test.userdetails</span><span style="color:#E1E4E8;"> (0 </span><span style="color:#9ECBFF;">documents,</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">failure</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#B392F0;">2021-12-14T04:38:28.348-0500</span><span style="color:#E1E4E8;">	</span><span style="color:#9ECBFF;">restoring</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">test.user</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">from</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/root/test/test/user.bson</span></span>
<span class="line"><span style="color:#B392F0;">2021-12-14T04:38:28.360-0500</span><span style="color:#E1E4E8;">	</span><span style="color:#9ECBFF;">finished</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">restoring</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">test.user</span><span style="color:#E1E4E8;"> (1 </span><span style="color:#9ECBFF;">document,</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">failures</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#B392F0;">2021-12-14T04:38:28.360-0500</span><span style="color:#E1E4E8;">	</span><span style="color:#9ECBFF;">no</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">indexes</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">to</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">restore</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">for</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">collection</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">test.user</span></span>
<span class="line"><span style="color:#B392F0;">2021-12-14T04:38:28.360-0500</span><span style="color:#E1E4E8;">	</span><span style="color:#9ECBFF;">no</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">indexes</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">to</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">restore</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">for</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">collection</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">test.userdetails</span></span>
<span class="line"><span style="color:#B392F0;">2021-12-14T04:38:28.360-0500</span><span style="color:#E1E4E8;">	</span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">document</span><span style="color:#E1E4E8;">(</span><span style="color:#B392F0;">s</span><span style="color:#E1E4E8;">) </span><span style="color:#9ECBFF;">restored</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">successfully.</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">document</span><span style="color:#E1E4E8;">(</span><span style="color:#B392F0;">s</span><span style="color:#E1E4E8;">) </span><span style="color:#9ECBFF;">failed</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">to</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">restore.</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">#语法</span></span>
<span class="line"><span style="color:#24292E;">	--nsInclude</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&quot;支持正则&quot;</span></span>
<span class="line"><span style="color:#24292E;">	</span><span style="color:#6F42C1;">mongorestore</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">-h</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">127.0</span><span style="color:#032F62;">.0.1</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--port</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">27017</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">-d</span><span style="color:#24292E;"> </span><span style="color:#032F62;">db_name</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--nsInclude=</span><span style="color:#032F62;">&quot;test.use*&quot;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/path/</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">[root@slave01 test]# mongorestore  -h 127.0.0.1 --port 27017  -d test --nsInclude=</span><span style="color:#032F62;">&quot;test.user&quot;</span><span style="color:#24292E;"> /root/test/test/</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">2021-12-14T04:38:28.334-0500</span><span style="color:#24292E;">	</span><span style="color:#032F62;">The</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--db</span><span style="color:#24292E;"> </span><span style="color:#032F62;">and</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--collection</span><span style="color:#24292E;"> </span><span style="color:#032F62;">flags</span><span style="color:#24292E;"> </span><span style="color:#032F62;">are</span><span style="color:#24292E;"> </span><span style="color:#032F62;">deprecated</span><span style="color:#24292E;"> </span><span style="color:#032F62;">for</span><span style="color:#24292E;"> </span><span style="color:#032F62;">this</span><span style="color:#24292E;"> </span><span style="color:#032F62;">use-case</span><span style="color:#24292E;">; </span><span style="color:#6F42C1;">please</span><span style="color:#24292E;"> </span><span style="color:#032F62;">use</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--nsInclude</span><span style="color:#24292E;"> </span><span style="color:#032F62;">instead,</span><span style="color:#24292E;"> </span><span style="color:#032F62;">i.e.</span><span style="color:#24292E;"> </span><span style="color:#032F62;">with</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--nsInclude=\${</span><span style="color:#24292E;">DATABASE</span><span style="color:#005CC5;">}.\${</span><span style="color:#24292E;">COLLECTION</span><span style="color:#005CC5;">}</span></span>
<span class="line"><span style="color:#6F42C1;">2021-12-14T04:38:28.334-0500</span><span style="color:#24292E;">	</span><span style="color:#032F62;">building</span><span style="color:#24292E;"> </span><span style="color:#032F62;">a</span><span style="color:#24292E;"> </span><span style="color:#032F62;">list</span><span style="color:#24292E;"> </span><span style="color:#032F62;">of</span><span style="color:#24292E;"> </span><span style="color:#032F62;">collections</span><span style="color:#24292E;"> </span><span style="color:#032F62;">to</span><span style="color:#24292E;"> </span><span style="color:#032F62;">restore</span><span style="color:#24292E;"> </span><span style="color:#032F62;">from</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/root/test/test</span><span style="color:#24292E;"> </span><span style="color:#032F62;">dir</span></span>
<span class="line"><span style="color:#6F42C1;">2021-12-14T04:38:28.334-0500</span><span style="color:#24292E;">	</span><span style="color:#032F62;">reading</span><span style="color:#24292E;"> </span><span style="color:#032F62;">metadata</span><span style="color:#24292E;"> </span><span style="color:#032F62;">for</span><span style="color:#24292E;"> </span><span style="color:#032F62;">test.user</span><span style="color:#24292E;"> </span><span style="color:#032F62;">from</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/root/test/test/user.metadata.json</span></span>
<span class="line"><span style="color:#6F42C1;">2021-12-14T04:38:28.334-0500</span><span style="color:#24292E;">	</span><span style="color:#032F62;">reading</span><span style="color:#24292E;"> </span><span style="color:#032F62;">metadata</span><span style="color:#24292E;"> </span><span style="color:#032F62;">for</span><span style="color:#24292E;"> </span><span style="color:#032F62;">test.userdetails</span><span style="color:#24292E;"> </span><span style="color:#032F62;">from</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/root/test/test/userdetails.metadata.json</span></span>
<span class="line"><span style="color:#6F42C1;">2021-12-14T04:38:28.335-0500</span><span style="color:#24292E;">	</span><span style="color:#032F62;">restoring</span><span style="color:#24292E;"> </span><span style="color:#032F62;">to</span><span style="color:#24292E;"> </span><span style="color:#032F62;">existing</span><span style="color:#24292E;"> </span><span style="color:#032F62;">collection</span><span style="color:#24292E;"> </span><span style="color:#032F62;">test.userdetails</span><span style="color:#24292E;"> </span><span style="color:#032F62;">without</span><span style="color:#24292E;"> </span><span style="color:#032F62;">dropping</span></span>
<span class="line"><span style="color:#6F42C1;">2021-12-14T04:38:28.335-0500</span><span style="color:#24292E;">	</span><span style="color:#032F62;">restoring</span><span style="color:#24292E;"> </span><span style="color:#032F62;">test.userdetails</span><span style="color:#24292E;"> </span><span style="color:#032F62;">from</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/root/test/test/userdetails.bson</span></span>
<span class="line"><span style="color:#6F42C1;">2021-12-14T04:38:28.339-0500</span><span style="color:#24292E;">	</span><span style="color:#032F62;">continuing</span><span style="color:#24292E;"> </span><span style="color:#032F62;">through</span><span style="color:#24292E;"> </span><span style="color:#032F62;">error:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">E11000</span><span style="color:#24292E;"> </span><span style="color:#032F62;">duplicate</span><span style="color:#24292E;"> </span><span style="color:#032F62;">key</span><span style="color:#24292E;"> </span><span style="color:#032F62;">error</span><span style="color:#24292E;"> </span><span style="color:#032F62;">collection:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">test.userdetails</span><span style="color:#24292E;"> </span><span style="color:#032F62;">index:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">_id_</span><span style="color:#24292E;"> </span><span style="color:#032F62;">dup</span><span style="color:#24292E;"> </span><span style="color:#032F62;">key:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">{</span><span style="color:#24292E;"> </span><span style="color:#032F62;">_id:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">ObjectId</span><span style="color:#24292E;">(</span><span style="color:#6F42C1;">&#39;61b711f67978d27bed034272&#39;</span><span style="color:#24292E;">) </span><span style="color:#032F62;">}</span></span>
<span class="line"><span style="color:#6F42C1;">2021-12-14T04:38:28.347-0500</span><span style="color:#24292E;">	</span><span style="color:#032F62;">finished</span><span style="color:#24292E;"> </span><span style="color:#032F62;">restoring</span><span style="color:#24292E;"> </span><span style="color:#032F62;">test.userdetails</span><span style="color:#24292E;"> (0 </span><span style="color:#032F62;">documents,</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">failure</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#6F42C1;">2021-12-14T04:38:28.348-0500</span><span style="color:#24292E;">	</span><span style="color:#032F62;">restoring</span><span style="color:#24292E;"> </span><span style="color:#032F62;">test.user</span><span style="color:#24292E;"> </span><span style="color:#032F62;">from</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/root/test/test/user.bson</span></span>
<span class="line"><span style="color:#6F42C1;">2021-12-14T04:38:28.360-0500</span><span style="color:#24292E;">	</span><span style="color:#032F62;">finished</span><span style="color:#24292E;"> </span><span style="color:#032F62;">restoring</span><span style="color:#24292E;"> </span><span style="color:#032F62;">test.user</span><span style="color:#24292E;"> (1 </span><span style="color:#032F62;">document,</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0</span><span style="color:#24292E;"> </span><span style="color:#032F62;">failures</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#6F42C1;">2021-12-14T04:38:28.360-0500</span><span style="color:#24292E;">	</span><span style="color:#032F62;">no</span><span style="color:#24292E;"> </span><span style="color:#032F62;">indexes</span><span style="color:#24292E;"> </span><span style="color:#032F62;">to</span><span style="color:#24292E;"> </span><span style="color:#032F62;">restore</span><span style="color:#24292E;"> </span><span style="color:#032F62;">for</span><span style="color:#24292E;"> </span><span style="color:#032F62;">collection</span><span style="color:#24292E;"> </span><span style="color:#032F62;">test.user</span></span>
<span class="line"><span style="color:#6F42C1;">2021-12-14T04:38:28.360-0500</span><span style="color:#24292E;">	</span><span style="color:#032F62;">no</span><span style="color:#24292E;"> </span><span style="color:#032F62;">indexes</span><span style="color:#24292E;"> </span><span style="color:#032F62;">to</span><span style="color:#24292E;"> </span><span style="color:#032F62;">restore</span><span style="color:#24292E;"> </span><span style="color:#032F62;">for</span><span style="color:#24292E;"> </span><span style="color:#032F62;">collection</span><span style="color:#24292E;"> </span><span style="color:#032F62;">test.userdetails</span></span>
<span class="line"><span style="color:#6F42C1;">2021-12-14T04:38:28.360-0500</span><span style="color:#24292E;">	</span><span style="color:#005CC5;">1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">document</span><span style="color:#24292E;">(</span><span style="color:#6F42C1;">s</span><span style="color:#24292E;">) </span><span style="color:#032F62;">restored</span><span style="color:#24292E;"> </span><span style="color:#032F62;">successfully.</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">document</span><span style="color:#24292E;">(</span><span style="color:#6F42C1;">s</span><span style="color:#24292E;">) </span><span style="color:#032F62;">failed</span><span style="color:#24292E;"> </span><span style="color:#032F62;">to</span><span style="color:#24292E;"> </span><span style="color:#032F62;">restore.</span></span></code></pre></div><h2 id="恢复到新库" tabindex="-1">恢复到新库 <a class="header-anchor" href="#恢复到新库" aria-label="Permalink to &quot;恢复到新库&quot;">​</a></h2><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">[root@slave01 ~]# mongodump -u admin -p 123456 -h 127.0.0.1 --port=27017 --authenticationDatabase admin -d test  --archive=&quot;mongodump-test-db&quot; </span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">[root@slave01 ~]# mongorestore -u admin -p 123456 -h 127.0.0.1 --port=27017 --authenticationDatabase admin -d test  --archive=&quot;mongodump-test-db&quot; --nsFrom=&#39;test.*&#39; --nsTo=&#39;examples.*&#39;</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">2021-12-15T00:58:48.555-0500	The --db and --collection flags are deprecated for this use-case; please use --nsInclude instead, i.e. with --nsInclude=\${DATABASE}.\${COLLECTION}</span></span>
<span class="line"><span style="color:#e1e4e8;">2021-12-15T00:58:48.575-0500	preparing collections to restore from</span></span>
<span class="line"><span style="color:#e1e4e8;">2021-12-15T00:58:48.586-0500	reading metadata for examples.user from archive &#39;mongodump-test-db&#39;</span></span>
<span class="line"><span style="color:#e1e4e8;">2021-12-15T00:58:48.587-0500	reading metadata for examples.userdetails from archive &#39;mongodump-test-db&#39;</span></span>
<span class="line"><span style="color:#e1e4e8;">2021-12-15T00:58:48.603-0500	restoring examples.userdetails from archive &#39;mongodump-test-db&#39;</span></span>
<span class="line"><span style="color:#e1e4e8;">2021-12-15T00:58:48.614-0500	finished restoring examples.userdetails (1 document, 0 failures)</span></span>
<span class="line"><span style="color:#e1e4e8;">2021-12-15T00:58:48.627-0500	restoring examples.user from archive &#39;mongodump-test-db&#39;</span></span>
<span class="line"><span style="color:#e1e4e8;">2021-12-15T00:58:48.638-0500	finished restoring examples.user (1 document, 0 failures)</span></span>
<span class="line"><span style="color:#e1e4e8;">2021-12-15T00:58:48.638-0500	no indexes to restore for collection examples.user</span></span>
<span class="line"><span style="color:#e1e4e8;">2021-12-15T00:58:48.638-0500	no indexes to restore for collection examples.userdetails</span></span>
<span class="line"><span style="color:#e1e4e8;">2021-12-15T00:58:48.638-0500	2 document(s) restored successfully. 0 document(s) failed to restore.</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">#查看数据库</span></span>
<span class="line"><span style="color:#e1e4e8;">&gt; use admin</span></span>
<span class="line"><span style="color:#e1e4e8;">switched to db admin</span></span>
<span class="line"><span style="color:#e1e4e8;">&gt; db.auth(&quot;admin&quot;,&quot;123456&quot;)</span></span>
<span class="line"><span style="color:#e1e4e8;">1</span></span>
<span class="line"><span style="color:#e1e4e8;">&gt; show dbs;</span></span>
<span class="line"><span style="color:#e1e4e8;">admin     0.000GB</span></span>
<span class="line"><span style="color:#e1e4e8;">config    0.000GB</span></span>
<span class="line"><span style="color:#e1e4e8;">examples  0.000GB    -----&gt;新的数据库</span></span>
<span class="line"><span style="color:#e1e4e8;">local     0.000GB</span></span>
<span class="line"><span style="color:#e1e4e8;">test      0.000GB</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">[root@slave01 ~]# mongodump -u admin -p 123456 -h 127.0.0.1 --port=27017 --authenticationDatabase admin -d test  --archive=&quot;mongodump-test-db&quot; </span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">[root@slave01 ~]# mongorestore -u admin -p 123456 -h 127.0.0.1 --port=27017 --authenticationDatabase admin -d test  --archive=&quot;mongodump-test-db&quot; --nsFrom=&#39;test.*&#39; --nsTo=&#39;examples.*&#39;</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">2021-12-15T00:58:48.555-0500	The --db and --collection flags are deprecated for this use-case; please use --nsInclude instead, i.e. with --nsInclude=\${DATABASE}.\${COLLECTION}</span></span>
<span class="line"><span style="color:#24292e;">2021-12-15T00:58:48.575-0500	preparing collections to restore from</span></span>
<span class="line"><span style="color:#24292e;">2021-12-15T00:58:48.586-0500	reading metadata for examples.user from archive &#39;mongodump-test-db&#39;</span></span>
<span class="line"><span style="color:#24292e;">2021-12-15T00:58:48.587-0500	reading metadata for examples.userdetails from archive &#39;mongodump-test-db&#39;</span></span>
<span class="line"><span style="color:#24292e;">2021-12-15T00:58:48.603-0500	restoring examples.userdetails from archive &#39;mongodump-test-db&#39;</span></span>
<span class="line"><span style="color:#24292e;">2021-12-15T00:58:48.614-0500	finished restoring examples.userdetails (1 document, 0 failures)</span></span>
<span class="line"><span style="color:#24292e;">2021-12-15T00:58:48.627-0500	restoring examples.user from archive &#39;mongodump-test-db&#39;</span></span>
<span class="line"><span style="color:#24292e;">2021-12-15T00:58:48.638-0500	finished restoring examples.user (1 document, 0 failures)</span></span>
<span class="line"><span style="color:#24292e;">2021-12-15T00:58:48.638-0500	no indexes to restore for collection examples.user</span></span>
<span class="line"><span style="color:#24292e;">2021-12-15T00:58:48.638-0500	no indexes to restore for collection examples.userdetails</span></span>
<span class="line"><span style="color:#24292e;">2021-12-15T00:58:48.638-0500	2 document(s) restored successfully. 0 document(s) failed to restore.</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">#查看数据库</span></span>
<span class="line"><span style="color:#24292e;">&gt; use admin</span></span>
<span class="line"><span style="color:#24292e;">switched to db admin</span></span>
<span class="line"><span style="color:#24292e;">&gt; db.auth(&quot;admin&quot;,&quot;123456&quot;)</span></span>
<span class="line"><span style="color:#24292e;">1</span></span>
<span class="line"><span style="color:#24292e;">&gt; show dbs;</span></span>
<span class="line"><span style="color:#24292e;">admin     0.000GB</span></span>
<span class="line"><span style="color:#24292e;">config    0.000GB</span></span>
<span class="line"><span style="color:#24292e;">examples  0.000GB    -----&gt;新的数据库</span></span>
<span class="line"><span style="color:#24292e;">local     0.000GB</span></span>
<span class="line"><span style="color:#24292e;">test      0.000GB</span></span></code></pre></div><h1 id="_3-cp-或者-rsync" tabindex="-1">3.cp 或者 rsync <a class="header-anchor" href="#_3-cp-或者-rsync" aria-label="Permalink to &quot;3.cp 或者 rsync&quot;">​</a></h1><p>可以直接复制数据文件，但是我们必须在复制文件前停止对 MongoDB 的操作，否则我们复制的文件是无效的</p><h1 id="_4-查看备份数据" tabindex="-1">4.查看备份数据 <a class="header-anchor" href="#_4-查看备份数据" aria-label="Permalink to &quot;4.查看备份数据&quot;">​</a></h1><p>部分的数据都是二进制的，我们直接查看是查看不到的，那么我们可以通过工具 bsondump</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">[root@slave01 test]# bsondump user.bson </span></span>
<span class="line"><span style="color:#e1e4e8;">{&quot;_id&quot;:{&quot;$oid&quot;:&quot;61b864e1e463d036cacdca76&quot;},&quot;id&quot;:{&quot;$numberDouble&quot;:&quot;1.0&quot;},&quot;name&quot;:&quot;jack&quot;,&quot;age&quot;:{&quot;$numberDouble&quot;:&quot;73.0&quot;}}</span></span>
<span class="line"><span style="color:#e1e4e8;">2021-12-14T21:50:37.923-0500	1 objects found</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">[root@slave01 test]# bsondump user.bson </span></span>
<span class="line"><span style="color:#24292e;">{&quot;_id&quot;:{&quot;$oid&quot;:&quot;61b864e1e463d036cacdca76&quot;},&quot;id&quot;:{&quot;$numberDouble&quot;:&quot;1.0&quot;},&quot;name&quot;:&quot;jack&quot;,&quot;age&quot;:{&quot;$numberDouble&quot;:&quot;73.0&quot;}}</span></span>
<span class="line"><span style="color:#24292e;">2021-12-14T21:50:37.923-0500	1 objects found</span></span></code></pre></div><p>mongodb 使用mongodump备份 指定用户名密码 出现错误</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">[root@MongoDB ~]# mongodump --host 127.0.0.1 --port 27017 -u admin -p 123456 -d db1 -o /root/</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">[root@MongoDB ~]# mongodump --host 127.0.0.1 --port 27017 -u admin -p 123456 -d db1 -o /root/</span></span></code></pre></div><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;"> Failed: error connecting to db server: server returned error on SASL authentication step: Authentication failed</span></span>
<span class="line"><span style="color:#e1e4e8;"> </span></span>
<span class="line"><span style="color:#e1e4e8;"> </span></span>
<span class="line"><span style="color:#e1e4e8;">解决方式：</span></span>
<span class="line"><span style="color:#e1e4e8;">mongodump --host 127.0.0.1 --port 27017 -u admin -p 123456 -d db1 -o /tmp/mongobak --authenticationDatabase admin</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;"> Failed: error connecting to db server: server returned error on SASL authentication step: Authentication failed</span></span>
<span class="line"><span style="color:#24292e;"> </span></span>
<span class="line"><span style="color:#24292e;"> </span></span>
<span class="line"><span style="color:#24292e;">解决方式：</span></span>
<span class="line"><span style="color:#24292e;">mongodump --host 127.0.0.1 --port 27017 -u admin -p 123456 -d db1 -o /tmp/mongobak --authenticationDatabase admin</span></span></code></pre></div><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">mongorestore -h 8.210.164.8:27017 -u whp -p whp123 -d db_name /path/db_name</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">mongorestore -h 8.210.164.8:27017 -u whp -p whp123 -d db_name /path/db_name</span></span></code></pre></div><h1 id="_5-mongoexport" tabindex="-1">5.mongoexport <a class="header-anchor" href="#_5-mongoexport" aria-label="Permalink to &quot;5.mongoexport&quot;">​</a></h1><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">mongoexport --help</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">    -h:指明数据库宿主机的IP</span></span>
<span class="line"><span style="color:#e1e4e8;">    -u:指明数据库的用户名</span></span>
<span class="line"><span style="color:#e1e4e8;">    -p:指明数据库的密码</span></span>
<span class="line"><span style="color:#e1e4e8;">    -d:指明数据库的名字</span></span>
<span class="line"><span style="color:#e1e4e8;">    -c:指明collection的名字</span></span>
<span class="line"><span style="color:#e1e4e8;">    -f:指明要导出那些列</span></span>
<span class="line"><span style="color:#e1e4e8;">    -o:指明到要导出的文件名</span></span>
<span class="line"><span style="color:#e1e4e8;">    -q:指明导出数据的过滤条件</span></span>
<span class="line"><span style="color:#e1e4e8;">    --authenticationDatabase admin</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">没有用户名密码的导出：</span></span>
<span class="line"><span style="color:#e1e4e8;">&gt; mongoexport --db=sales --collection=contacts --out=contacts.json</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">带有用户名密码的导出：</span></span>
<span class="line"><span style="color:#e1e4e8;">&gt; mongoexport --port 27017 -u root -p 123456 --authenticationDatabase testdb --collection=info --db=testdb --out=/opt/backup-data/info.json</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">带有过滤条件的导出</span></span>
<span class="line"><span style="color:#e1e4e8;">&gt; mongoexport --db=sales --collection=contacts -q &#39;{&quot;field&quot;:&quot;fieldValue&quot;}&#39; --out=contacts.json</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">说明：-q 的参数key也一定要有双引号引起来，要不然会出现以下错误</span></span>
<span class="line"><span style="color:#e1e4e8;">Failed: error parsing query as Extended JSON: invalid JSON input</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">mongoexport --help</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">    -h:指明数据库宿主机的IP</span></span>
<span class="line"><span style="color:#24292e;">    -u:指明数据库的用户名</span></span>
<span class="line"><span style="color:#24292e;">    -p:指明数据库的密码</span></span>
<span class="line"><span style="color:#24292e;">    -d:指明数据库的名字</span></span>
<span class="line"><span style="color:#24292e;">    -c:指明collection的名字</span></span>
<span class="line"><span style="color:#24292e;">    -f:指明要导出那些列</span></span>
<span class="line"><span style="color:#24292e;">    -o:指明到要导出的文件名</span></span>
<span class="line"><span style="color:#24292e;">    -q:指明导出数据的过滤条件</span></span>
<span class="line"><span style="color:#24292e;">    --authenticationDatabase admin</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">没有用户名密码的导出：</span></span>
<span class="line"><span style="color:#24292e;">&gt; mongoexport --db=sales --collection=contacts --out=contacts.json</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">带有用户名密码的导出：</span></span>
<span class="line"><span style="color:#24292e;">&gt; mongoexport --port 27017 -u root -p 123456 --authenticationDatabase testdb --collection=info --db=testdb --out=/opt/backup-data/info.json</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">带有过滤条件的导出</span></span>
<span class="line"><span style="color:#24292e;">&gt; mongoexport --db=sales --collection=contacts -q &#39;{&quot;field&quot;:&quot;fieldValue&quot;}&#39; --out=contacts.json</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">说明：-q 的参数key也一定要有双引号引起来，要不然会出现以下错误</span></span>
<span class="line"><span style="color:#24292e;">Failed: error parsing query as Extended JSON: invalid JSON input</span></span></code></pre></div><h1 id="_6-mongoimport" tabindex="-1">6.mongoimport <a class="header-anchor" href="#_6-mongoimport" aria-label="Permalink to &quot;6.mongoimport&quot;">​</a></h1><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">mongoimport --help</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">    -h:指明数据库宿主机的IP</span></span>
<span class="line"><span style="color:#e1e4e8;">    -u:指明数据库的用户名</span></span>
<span class="line"><span style="color:#e1e4e8;">    -p:指明数据库的密码</span></span>
<span class="line"><span style="color:#e1e4e8;">    -d:指明数据库的名字</span></span>
<span class="line"><span style="color:#e1e4e8;">    -c:指明collection的名字</span></span>
<span class="line"><span style="color:#e1e4e8;">    -f:指明要导入那些列</span></span>
<span class="line"><span style="color:#e1e4e8;">    -j:--numInsertionWorkers=&lt;number&gt;  number of insert operations to run concurrently</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">没有用户名密码的导入：</span></span>
<span class="line"><span style="color:#e1e4e8;">&gt; mongoimport --db=users --collection=contacts --file=contacts.json</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">带有用户名密码的导入：</span></span>
<span class="line"><span style="color:#e1e4e8;">&gt; mongoimport --port 27017 -u root -p 123456 --authenticationDatabase testdb -d testdb -c info  --file=/opt/backup-data/info.json</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">说明：-f /opt/backup-data/info.json 这样传文件参数是不行的，指定文件一定需要使用--file参数</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">mongoimport --help</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">    -h:指明数据库宿主机的IP</span></span>
<span class="line"><span style="color:#24292e;">    -u:指明数据库的用户名</span></span>
<span class="line"><span style="color:#24292e;">    -p:指明数据库的密码</span></span>
<span class="line"><span style="color:#24292e;">    -d:指明数据库的名字</span></span>
<span class="line"><span style="color:#24292e;">    -c:指明collection的名字</span></span>
<span class="line"><span style="color:#24292e;">    -f:指明要导入那些列</span></span>
<span class="line"><span style="color:#24292e;">    -j:--numInsertionWorkers=&lt;number&gt;  number of insert operations to run concurrently</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">没有用户名密码的导入：</span></span>
<span class="line"><span style="color:#24292e;">&gt; mongoimport --db=users --collection=contacts --file=contacts.json</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">带有用户名密码的导入：</span></span>
<span class="line"><span style="color:#24292e;">&gt; mongoimport --port 27017 -u root -p 123456 --authenticationDatabase testdb -d testdb -c info  --file=/opt/backup-data/info.json</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">说明：-f /opt/backup-data/info.json 这样传文件参数是不行的，指定文件一定需要使用--file参数</span></span></code></pre></div><h1 id="_7-时间点恢复" tabindex="-1">7.时间点恢复 <a class="header-anchor" href="#_7-时间点恢复" aria-label="Permalink to &quot;7.时间点恢复&quot;">​</a></h1><h2 id="备份-oplog" tabindex="-1">备份--oplog <a class="header-anchor" href="#备份-oplog" aria-label="Permalink to &quot;备份--oplog&quot;">​</a></h2><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">[root@master bin]# ./mongodump -h 127.0.0.1 --port 28017 --oplog --gzip -o /root/mongo_back/test</span></span>
<span class="line"><span style="color:#e1e4e8;">2021-12-26T22:34:36.522-0500	writing admin.system.version to </span></span>
<span class="line"><span style="color:#e1e4e8;">2021-12-26T22:34:36.522-0500	done dumping admin.system.version (1 document)</span></span>
<span class="line"><span style="color:#e1e4e8;">2021-12-26T22:34:36.523-0500	writing test.new10 to </span></span>
<span class="line"><span style="color:#e1e4e8;">2021-12-26T22:34:36.524-0500	done dumping test.new10 (1 document)</span></span>
<span class="line"><span style="color:#e1e4e8;">2021-12-26T22:34:36.524-0500	writing captured oplog to </span></span>
<span class="line"><span style="color:#e1e4e8;">2021-12-26T22:34:36.525-0500		dumped 1 oplog entry</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">#验证方式</span></span>
<span class="line"><span style="color:#e1e4e8;">./mongodump -h 127.0.0.1 --port 28017  --oplog --authenticationDatabase admin -u 用户名 -p密码  --gzip -o /data/mongodb_back/mongotestdump</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">[root@master bin]# ./mongodump -h 127.0.0.1 --port 28017 --oplog --gzip -o /root/mongo_back/test</span></span>
<span class="line"><span style="color:#24292e;">2021-12-26T22:34:36.522-0500	writing admin.system.version to </span></span>
<span class="line"><span style="color:#24292e;">2021-12-26T22:34:36.522-0500	done dumping admin.system.version (1 document)</span></span>
<span class="line"><span style="color:#24292e;">2021-12-26T22:34:36.523-0500	writing test.new10 to </span></span>
<span class="line"><span style="color:#24292e;">2021-12-26T22:34:36.524-0500	done dumping test.new10 (1 document)</span></span>
<span class="line"><span style="color:#24292e;">2021-12-26T22:34:36.524-0500	writing captured oplog to </span></span>
<span class="line"><span style="color:#24292e;">2021-12-26T22:34:36.525-0500		dumped 1 oplog entry</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">#验证方式</span></span>
<span class="line"><span style="color:#24292e;">./mongodump -h 127.0.0.1 --port 28017  --oplog --authenticationDatabase admin -u 用户名 -p密码  --gzip -o /data/mongodb_back/mongotestdump</span></span></code></pre></div><h2 id="还原-oplogreplay" tabindex="-1">还原--oplogReplay <a class="header-anchor" href="#还原-oplogreplay" aria-label="Permalink to &quot;还原--oplogReplay&quot;">​</a></h2><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">[root@master bin]# ./mongorestore -h 127.0.0.1 --port 28017 --oplogReplay --gzip /root/mongo_back/test</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">2021-12-26T22:41:59.062-0500	preparing collections to restore from</span></span>
<span class="line"><span style="color:#e1e4e8;">2021-12-26T22:41:59.064-0500	reading metadata for test.new10 from /root/mongo_back/test/test/new10.metadata.json.gz</span></span>
<span class="line"><span style="color:#e1e4e8;">2021-12-26T22:41:59.088-0500	restoring test.new10 from /root/mongo_back/test/test/new10.bson.gz</span></span>
<span class="line"><span style="color:#e1e4e8;">2021-12-26T22:41:59.094-0500	no indexes to restore</span></span>
<span class="line"><span style="color:#e1e4e8;">2021-12-26T22:41:59.094-0500	finished restoring test.new10 (1 document)</span></span>
<span class="line"><span style="color:#e1e4e8;">2021-12-26T22:41:59.094-0500	replaying oplog</span></span>
<span class="line"><span style="color:#e1e4e8;">2021-12-26T22:41:59.094-0500	done</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">#验证方式</span></span>
<span class="line"><span style="color:#e1e4e8;">./mongorestore -h 127.0.0.1 --port 端口  --oplogReplay --authenticationDatabase admin -u 用户名 -p 密码  --gzip /root/mongo_back/test</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">[root@master bin]# ./mongorestore -h 127.0.0.1 --port 28017 --oplogReplay --gzip /root/mongo_back/test</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">2021-12-26T22:41:59.062-0500	preparing collections to restore from</span></span>
<span class="line"><span style="color:#24292e;">2021-12-26T22:41:59.064-0500	reading metadata for test.new10 from /root/mongo_back/test/test/new10.metadata.json.gz</span></span>
<span class="line"><span style="color:#24292e;">2021-12-26T22:41:59.088-0500	restoring test.new10 from /root/mongo_back/test/test/new10.bson.gz</span></span>
<span class="line"><span style="color:#24292e;">2021-12-26T22:41:59.094-0500	no indexes to restore</span></span>
<span class="line"><span style="color:#24292e;">2021-12-26T22:41:59.094-0500	finished restoring test.new10 (1 document)</span></span>
<span class="line"><span style="color:#24292e;">2021-12-26T22:41:59.094-0500	replaying oplog</span></span>
<span class="line"><span style="color:#24292e;">2021-12-26T22:41:59.094-0500	done</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">#验证方式</span></span>
<span class="line"><span style="color:#24292e;">./mongorestore -h 127.0.0.1 --port 端口  --oplogReplay --authenticationDatabase admin -u 用户名 -p 密码  --gzip /root/mongo_back/test</span></span></code></pre></div><h2 id="指定时间点还原" tabindex="-1">指定时间点还原 <a class="header-anchor" href="#指定时间点还原" aria-label="Permalink to &quot;指定时间点还原&quot;">​</a></h2><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">#查看此时间点对应的时间和操作序列，在源库local中的oplog.rs 集合查询</span></span>
<span class="line"><span style="color:#e1e4e8;">&gt;use local</span></span>
<span class="line"><span style="color:#e1e4e8;">&gt;db.oplog.rs.find({&quot;o._id&quot;: ObjectId(&quot;61c9275b5745d52b72d861c5&quot;)}).sort({ts:-1}).limit(1);</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">./mongorestore -h 127.0.0.1 --port 28017  --oplogReplay --oplogLimit &quot;1527736438:858&quot; --authenticationDatabase admin -u 用户名 -p 密码  /root/mongo_back/test</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">#查看此时间点对应的时间和操作序列，在源库local中的oplog.rs 集合查询</span></span>
<span class="line"><span style="color:#24292e;">&gt;use local</span></span>
<span class="line"><span style="color:#24292e;">&gt;db.oplog.rs.find({&quot;o._id&quot;: ObjectId(&quot;61c9275b5745d52b72d861c5&quot;)}).sort({ts:-1}).limit(1);</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">./mongorestore -h 127.0.0.1 --port 28017  --oplogReplay --oplogLimit &quot;1527736438:858&quot; --authenticationDatabase admin -u 用户名 -p 密码  /root/mongo_back/test</span></span></code></pre></div><h1 id="_8-集群备份" tabindex="-1">8.集群备份 <a class="header-anchor" href="#_8-集群备份" aria-label="Permalink to &quot;8.集群备份&quot;">​</a></h1><h2 id="mongoexport备份" tabindex="-1">mongoexport备份 <a class="header-anchor" href="#mongoexport备份" aria-label="Permalink to &quot;mongoexport备份&quot;">​</a></h2><h3 id="备份所有" tabindex="-1">备份所有 <a class="header-anchor" href="#备份所有" aria-label="Permalink to &quot;备份所有&quot;">​</a></h3><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">#退出mongos连接，到命令行界面执行备份</span></span>
<span class="line"><span style="color:#e1e4e8;">mongoexport -h 10.0.0.40 --port 28017 -d olda -c student -o /tmp/mongodb_backup.json</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">#退出mongos连接，到命令行界面执行备份</span></span>
<span class="line"><span style="color:#24292e;">mongoexport -h 10.0.0.40 --port 28017 -d olda -c student -o /tmp/mongodb_backup.json</span></span></code></pre></div><h3 id="指定列备份" tabindex="-1">指定列备份 <a class="header-anchor" href="#指定列备份" aria-label="Permalink to &quot;指定列备份&quot;">​</a></h3><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">#退出mongos连接，到命令行界面执行备份（要指定数据列的键）</span></span>
<span class="line"><span style="color:#e1e4e8;">#注意：想要备份哪一列，那就指定哪一列</span></span>
<span class="line"><span style="color:#e1e4e8;">mongoexport -h 10.0.0.40 --port 28017 -d oldb -c student --type=csv -f id,name,age,date -o /tmp/mongodb_backup.csv</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">#退出mongos连接，到命令行界面执行备份（要指定数据列的键）</span></span>
<span class="line"><span style="color:#24292e;">#注意：想要备份哪一列，那就指定哪一列</span></span>
<span class="line"><span style="color:#24292e;">mongoexport -h 10.0.0.40 --port 28017 -d oldb -c student --type=csv -f id,name,age,date -o /tmp/mongodb_backup.csv</span></span></code></pre></div><h2 id="mongoimport恢复" tabindex="-1">mongoimport恢复 <a class="header-anchor" href="#mongoimport恢复" aria-label="Permalink to &quot;mongoimport恢复&quot;">​</a></h2><h3 id="恢复所有" tabindex="-1">恢复所有 <a class="header-anchor" href="#恢复所有" aria-label="Permalink to &quot;恢复所有&quot;">​</a></h3><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">mongodb恢复不会覆盖原有的数据，当前测试环境会产生数据冲突。</span></span>
<span class="line"><span style="color:#e1e4e8;">所以恢复数据到其他的表中（也可以直接恢复到其他 &quot;库&quot; ）</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">mongoimport -h 10.0.0.40 --port 28017 -d olda -c student_source /tmp/mongodb_backup.json</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">mongodb恢复不会覆盖原有的数据，当前测试环境会产生数据冲突。</span></span>
<span class="line"><span style="color:#24292e;">所以恢复数据到其他的表中（也可以直接恢复到其他 &quot;库&quot; ）</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">mongoimport -h 10.0.0.40 --port 28017 -d olda -c student_source /tmp/mongodb_backup.json</span></span></code></pre></div><h3 id="恢复指定列" tabindex="-1">恢复指定列 <a class="header-anchor" href="#恢复指定列" aria-label="Permalink to &quot;恢复指定列&quot;">​</a></h3><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">要指定第一列的id,name,age,date不为数据，mongodb没有数据格式束缚</span></span>
<span class="line"><span style="color:#e1e4e8;">本次恢复数据到wsp与wll库</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">#csv格式的文件第一行，没有数据对应列的名字（导入wsp库）</span></span>
<span class="line"><span style="color:#e1e4e8;">mongoimport -h 10.0.0.40 --port 28017 -d wsp  -c student --type=csv -f id,name,age,date --file /tmp/mongodb_backup.csv</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">要指定第一列的id,name,age,date不为数据，mongodb没有数据格式束缚</span></span>
<span class="line"><span style="color:#24292e;">本次恢复数据到wsp与wll库</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">#csv格式的文件第一行，没有数据对应列的名字（导入wsp库）</span></span>
<span class="line"><span style="color:#24292e;">mongoimport -h 10.0.0.40 --port 28017 -d wsp  -c student --type=csv -f id,name,age,date --file /tmp/mongodb_backup.csv</span></span></code></pre></div><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">#csv格式的文件第一行，有数据对应列的名字（导入wll库）</span></span>
<span class="line"><span style="color:#e1e4e8;">#--headerline:指明第一行是列名，不需要导入。</span></span>
<span class="line"><span style="color:#e1e4e8;">mongoimport -h 10.0.0.40  --port 28017 -d wll -c student --type=csv --headerline --file /tmp/mongodb_backup.csv</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">#csv格式的文件第一行，有数据对应列的名字（导入wll库）</span></span>
<span class="line"><span style="color:#24292e;">#--headerline:指明第一行是列名，不需要导入。</span></span>
<span class="line"><span style="color:#24292e;">mongoimport -h 10.0.0.40  --port 28017 -d wll -c student --type=csv --headerline --file /tmp/mongodb_backup.csv</span></span></code></pre></div><h2 id="dump" tabindex="-1">dump <a class="header-anchor" href="#dump" aria-label="Permalink to &quot;dump&quot;">​</a></h2><ul><li>mongos节点</li></ul><h3 id="备份所有-1" tabindex="-1">备份所有 <a class="header-anchor" href="#备份所有-1" aria-label="Permalink to &quot;备份所有&quot;">​</a></h3><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">mkdir /tmp/backup</span></span>
<span class="line"><span style="color:#e1e4e8;">mongodump -h 10.0.0.40 --port 28017 -o /tmp/backup/</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">mkdir /tmp/backup</span></span>
<span class="line"><span style="color:#24292e;">mongodump -h 10.0.0.40 --port 28017 -o /tmp/backup/</span></span></code></pre></div><h3 id="备份指定库" tabindex="-1"><strong>备份指定库</strong> <a class="header-anchor" href="#备份指定库" aria-label="Permalink to &quot;**备份指定库**&quot;">​</a></h3><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">mongodump</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-h</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">10.0</span><span style="color:#9ECBFF;">.0.40</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--port</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">28017</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-d</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">world</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-o</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/tmp/backup/</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">mongodump</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-h</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">10.0</span><span style="color:#032F62;">.0.40</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--port</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">28017</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-d</span><span style="color:#24292E;"> </span><span style="color:#032F62;">world</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-o</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/tmp/backup/</span></span></code></pre></div><h3 id="备份指定表" tabindex="-1"><strong>备份指定表</strong> <a class="header-anchor" href="#备份指定表" aria-label="Permalink to &quot;**备份指定表**&quot;">​</a></h3><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">mongodump -h 10.0.0.40 --port 28017 -d world -c city -o /tmp/backup/</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">mongodump -h 10.0.0.40 --port 28017 -d world -c city -o /tmp/backup/</span></span></code></pre></div><h3 id="恢复" tabindex="-1">恢复 <a class="header-anchor" href="#恢复" aria-label="Permalink to &quot;恢复&quot;">​</a></h3><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">#加了--drop参数会自动覆盖原有数据，不需要删除原有数据</span></span>
<span class="line"><span style="color:#e1e4e8;">mongorestore -h 10.0.0.40 --port 28017 -d world -c city --drop /tmp/backup/world/city.bson</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">#加了--drop参数会自动覆盖原有数据，不需要删除原有数据</span></span>
<span class="line"><span style="color:#24292e;">mongorestore -h 10.0.0.40 --port 28017 -d world -c city --drop /tmp/backup/world/city.bson</span></span></code></pre></div>`,86),p=[l];function t(r,c,i,y,E,d){return n(),a("div",null,p)}const m=s(e,[["render",t]]);export{F as __pageData,m as default};
