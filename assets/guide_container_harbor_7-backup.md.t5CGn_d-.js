import{_ as s,o as a,c as n,R as o}from"./chunks/framework.zUbWieqp.js";const u=JSON.parse('{"title":"1.备份","description":"","frontmatter":{},"headers":[],"relativePath":"guide/container/harbor/7-backup.md","filePath":"guide/container/harbor/7-backup.md","lastUpdated":1729503684000}'),p={name:"guide/container/harbor/7-backup.md"},l=o('<h1 id="_1-备份" tabindex="-1">1.备份 <a class="header-anchor" href="#_1-备份" aria-label="Permalink to &quot;1.备份&quot;">​</a></h1><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">#!/bin/bash</span></span>\n<span class="line"><span style="color:#E1E4E8;">harborUsername</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&#39;admin&#39;</span></span>\n<span class="line"><span style="color:#E1E4E8;">harborPassword</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&#39;Harbor12345&#39;</span></span>\n<span class="line"><span style="color:#E1E4E8;">harborRegistry</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&#39;registry.test.com&#39;</span></span>\n<span class="line"><span style="color:#E1E4E8;">harborBasicAuthToken</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">$(</span><span style="color:#79B8FF;">echo</span><span style="color:#9ECBFF;"> </span><span style="color:#79B8FF;">-n</span><span style="color:#9ECBFF;"> &quot;${</span><span style="color:#E1E4E8;">harborUsername</span><span style="color:#9ECBFF;">}:${</span><span style="color:#E1E4E8;">harborPassword</span><span style="color:#9ECBFF;">}&quot; </span><span style="color:#F97583;">|</span><span style="color:#9ECBFF;"> </span><span style="color:#B392F0;">base64</span><span style="color:#9ECBFF;">)</span></span>\n<span class="line"><span style="color:#B392F0;">docker</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">login</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--username</span><span style="color:#E1E4E8;"> ${harborUsername} </span><span style="color:#79B8FF;">--password</span><span style="color:#E1E4E8;"> ${harborPassword} ${harborRegistry}</span></span>\n<span class="line"><span style="color:#B392F0;">rm</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-f</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">dist/images.list</span></span>\n<span class="line"><span style="color:#B392F0;">rm</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-f</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">dist/charts.list</span></span>\n<span class="line"><span style="color:#6A737D;"># list projects</span></span>\n<span class="line"><span style="color:#E1E4E8;">projs</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">`</span><span style="color:#B392F0;">curl</span><span style="color:#9ECBFF;"> </span><span style="color:#79B8FF;">-s</span><span style="color:#9ECBFF;"> </span><span style="color:#79B8FF;">-k</span><span style="color:#9ECBFF;"> </span><span style="color:#79B8FF;">-H</span><span style="color:#9ECBFF;"> &quot;Authorization: Basic ${</span><span style="color:#E1E4E8;">harborBasicAuthToken</span><span style="color:#9ECBFF;">}&quot; &quot;https://${</span><span style="color:#E1E4E8;">harborRegistry</span><span style="color:#9ECBFF;">}&quot;&#39;/api/projects?page=1&amp;page_size=1000&#39; </span><span style="color:#F97583;">|</span><span style="color:#9ECBFF;"> </span><span style="color:#B392F0;">jq</span><span style="color:#9ECBFF;"> </span><span style="color:#79B8FF;">-r</span><span style="color:#9ECBFF;"> &#39;.[] | &quot;\\(.project_id)=\\(.name)&quot;&#39;`</span></span>\n<span class="line"><span style="color:#F97583;">for</span><span style="color:#E1E4E8;"> proj </span><span style="color:#F97583;">in</span><span style="color:#E1E4E8;"> ${projs[*]}; </span><span style="color:#F97583;">do</span></span>\n<span class="line"><span style="color:#E1E4E8;">  projId</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">`</span><span style="color:#79B8FF;">echo</span><span style="color:#9ECBFF;"> </span><span style="color:#E1E4E8;">$proj</span><span style="color:#F97583;">|</span><span style="color:#B392F0;">cut</span><span style="color:#9ECBFF;"> </span><span style="color:#79B8FF;">-d</span><span style="color:#9ECBFF;"> &#39;=&#39; </span><span style="color:#79B8FF;">-f</span><span style="color:#9ECBFF;"> </span><span style="color:#79B8FF;">1</span><span style="color:#9ECBFF;">`</span></span>\n<span class="line"><span style="color:#E1E4E8;">  projName</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">`</span><span style="color:#79B8FF;">echo</span><span style="color:#9ECBFF;"> </span><span style="color:#E1E4E8;">$proj</span><span style="color:#F97583;">|</span><span style="color:#B392F0;">cut</span><span style="color:#9ECBFF;"> </span><span style="color:#79B8FF;">-d</span><span style="color:#9ECBFF;"> &#39;=&#39; </span><span style="color:#79B8FF;">-f</span><span style="color:#9ECBFF;"> </span><span style="color:#79B8FF;">2</span><span style="color:#9ECBFF;">`</span></span>\n<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;"># list repos in one project</span></span>\n<span class="line"><span style="color:#E1E4E8;">  repos</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">`</span><span style="color:#B392F0;">curl</span><span style="color:#9ECBFF;"> </span><span style="color:#79B8FF;">-s</span><span style="color:#9ECBFF;"> </span><span style="color:#79B8FF;">-k</span><span style="color:#9ECBFF;"> </span><span style="color:#79B8FF;">-H</span><span style="color:#9ECBFF;"> &quot;Authorization: Basic ${</span><span style="color:#E1E4E8;">harborBasicAuthToken</span><span style="color:#9ECBFF;">}&quot; &quot;https://${</span><span style="color:#E1E4E8;">harborRegistry</span><span style="color:#9ECBFF;">}&quot;&#39;/api/repositories?page=1&amp;page_size=1000&amp;project_id=&#39;&quot;${</span><span style="color:#E1E4E8;">projId</span><span style="color:#9ECBFF;">}&quot; </span><span style="color:#F97583;">|</span><span style="color:#9ECBFF;"> </span><span style="color:#B392F0;">jq</span><span style="color:#9ECBFF;"> </span><span style="color:#79B8FF;">-r</span><span style="color:#9ECBFF;"> &#39;.[] | &quot;\\(.id)=\\(.name)&quot;&#39;`</span></span>\n<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">for</span><span style="color:#E1E4E8;"> repo </span><span style="color:#F97583;">in</span><span style="color:#E1E4E8;"> ${repos[*]}; </span><span style="color:#F97583;">do</span></span>\n<span class="line"><span style="color:#E1E4E8;">    repoId</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">`</span><span style="color:#79B8FF;">echo</span><span style="color:#9ECBFF;"> </span><span style="color:#E1E4E8;">$repo</span><span style="color:#F97583;">|</span><span style="color:#B392F0;">cut</span><span style="color:#9ECBFF;"> </span><span style="color:#79B8FF;">-d</span><span style="color:#9ECBFF;"> &#39;=&#39; </span><span style="color:#79B8FF;">-f</span><span style="color:#9ECBFF;"> </span><span style="color:#79B8FF;">1</span><span style="color:#9ECBFF;">`</span></span>\n<span class="line"><span style="color:#E1E4E8;">    repoName</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">`</span><span style="color:#79B8FF;">echo</span><span style="color:#9ECBFF;"> </span><span style="color:#E1E4E8;">$repo</span><span style="color:#F97583;">|</span><span style="color:#B392F0;">cut</span><span style="color:#9ECBFF;"> </span><span style="color:#79B8FF;">-d</span><span style="color:#9ECBFF;"> &#39;=&#39; </span><span style="color:#79B8FF;">-f</span><span style="color:#9ECBFF;"> </span><span style="color:#79B8FF;">2</span><span style="color:#9ECBFF;">`</span></span>\n<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;"># list tags in one repo</span></span>\n<span class="line"><span style="color:#E1E4E8;">    tags</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">`</span><span style="color:#B392F0;">curl</span><span style="color:#9ECBFF;"> </span><span style="color:#79B8FF;">-s</span><span style="color:#9ECBFF;"> </span><span style="color:#79B8FF;">-k</span><span style="color:#9ECBFF;"> </span><span style="color:#79B8FF;">-H</span><span style="color:#9ECBFF;"> &quot;Authorization: Basic ${</span><span style="color:#E1E4E8;">harborBasicAuthToken</span><span style="color:#9ECBFF;">}&quot; &quot;https://${</span><span style="color:#E1E4E8;">harborRegistry</span><span style="color:#9ECBFF;">}&quot;&#39;/api/repositories/&#39;&quot;${</span><span style="color:#E1E4E8;">repoName</span><span style="color:#9ECBFF;">}&quot;&#39;/tags?detail=1&#39; </span><span style="color:#F97583;">|</span><span style="color:#9ECBFF;"> </span><span style="color:#B392F0;">jq</span><span style="color:#9ECBFF;"> </span><span style="color:#79B8FF;">-r</span><span style="color:#9ECBFF;"> &#39;.[].name&#39;`</span></span>\n<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">for</span><span style="color:#E1E4E8;"> tag </span><span style="color:#F97583;">in</span><span style="color:#E1E4E8;"> ${tags[*]}; </span><span style="color:#F97583;">do</span></span>\n<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#6A737D;">#echo ${tag};</span></span>\n<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#6A737D;"># pull image</span></span>\n<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#B392F0;">docker</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pull</span><span style="color:#E1E4E8;"> ${harborRegistry}</span><span style="color:#9ECBFF;">/</span><span style="color:#E1E4E8;">${repoName}</span><span style="color:#9ECBFF;">:</span><span style="color:#E1E4E8;">${tag}</span></span>\n<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#6A737D;"># tag image</span></span>\n<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#B392F0;">docker</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">tag</span><span style="color:#E1E4E8;"> ${harborRegistry}</span><span style="color:#9ECBFF;">/</span><span style="color:#E1E4E8;">${repoName}</span><span style="color:#9ECBFF;">:</span><span style="color:#E1E4E8;">${tag} ${repoName}</span><span style="color:#9ECBFF;">:</span><span style="color:#E1E4E8;">${tag}</span></span>\n<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#6A737D;"># save image</span></span>\n<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#B392F0;">mkdir</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-p</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">$(</span><span style="color:#B392F0;">dirname</span><span style="color:#9ECBFF;"> dist/${</span><span style="color:#E1E4E8;">repoName</span><span style="color:#9ECBFF;">})</span></span>\n<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#B392F0;">docker</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">save</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-o</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">dist/</span><span style="color:#E1E4E8;">${repoName}</span><span style="color:#9ECBFF;">:</span><span style="color:#E1E4E8;">${tag}</span><span style="color:#9ECBFF;">.tar</span><span style="color:#E1E4E8;">  ${repoName}</span><span style="color:#9ECBFF;">:</span><span style="color:#E1E4E8;">${tag}</span></span>\n<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#6A737D;"># record image to list file</span></span>\n<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#79B8FF;">echo</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;${</span><span style="color:#E1E4E8;">repoName</span><span style="color:#9ECBFF;">}:${</span><span style="color:#E1E4E8;">tag</span><span style="color:#9ECBFF;">}&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">&gt;&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">dist/images.list</span></span>\n<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">done</span></span>\n<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">done</span></span>\n<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;"># list charts in one project</span></span>\n<span class="line"><span style="color:#E1E4E8;">  charts</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">`</span><span style="color:#B392F0;">curl</span><span style="color:#9ECBFF;"> </span><span style="color:#79B8FF;">-s</span><span style="color:#9ECBFF;"> </span><span style="color:#79B8FF;">-k</span><span style="color:#9ECBFF;"> </span><span style="color:#79B8FF;">-H</span><span style="color:#9ECBFF;"> &quot;Authorization: Basic ${</span><span style="color:#E1E4E8;">harborBasicAuthToken</span><span style="color:#9ECBFF;">}&quot; &quot;https://${</span><span style="color:#E1E4E8;">harborRegistry</span><span style="color:#9ECBFF;">}&quot;&#39;/api/chartrepo/&#39;&quot;${</span><span style="color:#E1E4E8;">projName</span><span style="color:#9ECBFF;">}&quot;&#39;/charts&#39; </span><span style="color:#F97583;">|</span><span style="color:#9ECBFF;"> </span><span style="color:#B392F0;">jq</span><span style="color:#9ECBFF;"> </span><span style="color:#79B8FF;">-r</span><span style="color:#9ECBFF;"> &#39;.[].name&#39;`</span></span>\n<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">for</span><span style="color:#E1E4E8;"> chart </span><span style="color:#F97583;">in</span><span style="color:#E1E4E8;"> ${charts[*]}; </span><span style="color:#F97583;">do</span></span>\n<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">#echo ${chart}</span></span>\n<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;"># list download urls in one chart</span></span>\n<span class="line"><span style="color:#E1E4E8;">    durls</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">`</span><span style="color:#B392F0;">curl</span><span style="color:#9ECBFF;"> </span><span style="color:#79B8FF;">-s</span><span style="color:#9ECBFF;"> </span><span style="color:#79B8FF;">-k</span><span style="color:#9ECBFF;"> </span><span style="color:#79B8FF;">-H</span><span style="color:#9ECBFF;"> &quot;Authorization: Basic ${</span><span style="color:#E1E4E8;">harborBasicAuthToken</span><span style="color:#9ECBFF;">}&quot; &quot;https://${</span><span style="color:#E1E4E8;">harborRegistry</span><span style="color:#9ECBFF;">}&quot;&#39;/api/chartrepo/&#39;&quot;${</span><span style="color:#E1E4E8;">projName</span><span style="color:#9ECBFF;">}&quot;&#39;/charts/&#39;&quot;${</span><span style="color:#E1E4E8;">chart</span><span style="color:#9ECBFF;">}&quot; </span><span style="color:#F97583;">|</span><span style="color:#9ECBFF;"> </span><span style="color:#B392F0;">jq</span><span style="color:#9ECBFF;"> </span><span style="color:#79B8FF;">-r</span><span style="color:#9ECBFF;"> &#39;.[].urls[0]&#39;`</span></span>\n<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">#echo ${durl[*]}</span></span>\n<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">for</span><span style="color:#E1E4E8;"> durl </span><span style="color:#F97583;">in</span><span style="color:#E1E4E8;"> ${durls[*]}; </span><span style="color:#F97583;">do</span></span>\n<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#6A737D;">#echo ${durl};</span></span>\n<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#6A737D;"># download chart</span></span>\n<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#B392F0;">mkdir</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-p</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">$(</span><span style="color:#B392F0;">dirname</span><span style="color:#9ECBFF;"> dist/${</span><span style="color:#E1E4E8;">projName</span><span style="color:#9ECBFF;">}/${</span><span style="color:#E1E4E8;">durl</span><span style="color:#9ECBFF;">})</span></span>\n<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#B392F0;">curl</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-s</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-k</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-H</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;Authorization: Basic ${</span><span style="color:#E1E4E8;">harborBasicAuthToken</span><span style="color:#9ECBFF;">}&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-o</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">dist/</span><span style="color:#E1E4E8;">${projName}</span><span style="color:#9ECBFF;">/</span><span style="color:#E1E4E8;">${durl} </span><span style="color:#9ECBFF;">&quot;https://${</span><span style="color:#E1E4E8;">harborRegistry</span><span style="color:#9ECBFF;">}/chartrepo/${</span><span style="color:#E1E4E8;">projName</span><span style="color:#9ECBFF;">}/${</span><span style="color:#E1E4E8;">durl</span><span style="color:#9ECBFF;">}&quot;</span></span>\n<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#6A737D;"># record chart to list file</span></span>\n<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#79B8FF;">echo</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;${</span><span style="color:#E1E4E8;">projName</span><span style="color:#9ECBFF;">}/${</span><span style="color:#E1E4E8;">durl</span><span style="color:#9ECBFF;">}&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">&gt;&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">dist/charts.list</span></span>\n<span class="line"><span style="color:#E1E4E8;">        </span></span>\n<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">done</span></span>\n<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">done</span></span>\n<span class="line"><span style="color:#F97583;">done</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">#!/bin/bash</span></span>\n<span class="line"><span style="color:#24292E;">harborUsername</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&#39;admin&#39;</span></span>\n<span class="line"><span style="color:#24292E;">harborPassword</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&#39;Harbor12345&#39;</span></span>\n<span class="line"><span style="color:#24292E;">harborRegistry</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&#39;registry.test.com&#39;</span></span>\n<span class="line"><span style="color:#24292E;">harborBasicAuthToken</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">$(</span><span style="color:#005CC5;">echo</span><span style="color:#032F62;"> </span><span style="color:#005CC5;">-n</span><span style="color:#032F62;"> &quot;${</span><span style="color:#24292E;">harborUsername</span><span style="color:#032F62;">}:${</span><span style="color:#24292E;">harborPassword</span><span style="color:#032F62;">}&quot; </span><span style="color:#D73A49;">|</span><span style="color:#032F62;"> </span><span style="color:#6F42C1;">base64</span><span style="color:#032F62;">)</span></span>\n<span class="line"><span style="color:#6F42C1;">docker</span><span style="color:#24292E;"> </span><span style="color:#032F62;">login</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--username</span><span style="color:#24292E;"> ${harborUsername} </span><span style="color:#005CC5;">--password</span><span style="color:#24292E;"> ${harborPassword} ${harborRegistry}</span></span>\n<span class="line"><span style="color:#6F42C1;">rm</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-f</span><span style="color:#24292E;"> </span><span style="color:#032F62;">dist/images.list</span></span>\n<span class="line"><span style="color:#6F42C1;">rm</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-f</span><span style="color:#24292E;"> </span><span style="color:#032F62;">dist/charts.list</span></span>\n<span class="line"><span style="color:#6A737D;"># list projects</span></span>\n<span class="line"><span style="color:#24292E;">projs</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">`</span><span style="color:#6F42C1;">curl</span><span style="color:#032F62;"> </span><span style="color:#005CC5;">-s</span><span style="color:#032F62;"> </span><span style="color:#005CC5;">-k</span><span style="color:#032F62;"> </span><span style="color:#005CC5;">-H</span><span style="color:#032F62;"> &quot;Authorization: Basic ${</span><span style="color:#24292E;">harborBasicAuthToken</span><span style="color:#032F62;">}&quot; &quot;https://${</span><span style="color:#24292E;">harborRegistry</span><span style="color:#032F62;">}&quot;&#39;/api/projects?page=1&amp;page_size=1000&#39; </span><span style="color:#D73A49;">|</span><span style="color:#032F62;"> </span><span style="color:#6F42C1;">jq</span><span style="color:#032F62;"> </span><span style="color:#005CC5;">-r</span><span style="color:#032F62;"> &#39;.[] | &quot;\\(.project_id)=\\(.name)&quot;&#39;`</span></span>\n<span class="line"><span style="color:#D73A49;">for</span><span style="color:#24292E;"> proj </span><span style="color:#D73A49;">in</span><span style="color:#24292E;"> ${projs[*]}; </span><span style="color:#D73A49;">do</span></span>\n<span class="line"><span style="color:#24292E;">  projId</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">`</span><span style="color:#005CC5;">echo</span><span style="color:#032F62;"> </span><span style="color:#24292E;">$proj</span><span style="color:#D73A49;">|</span><span style="color:#6F42C1;">cut</span><span style="color:#032F62;"> </span><span style="color:#005CC5;">-d</span><span style="color:#032F62;"> &#39;=&#39; </span><span style="color:#005CC5;">-f</span><span style="color:#032F62;"> </span><span style="color:#005CC5;">1</span><span style="color:#032F62;">`</span></span>\n<span class="line"><span style="color:#24292E;">  projName</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">`</span><span style="color:#005CC5;">echo</span><span style="color:#032F62;"> </span><span style="color:#24292E;">$proj</span><span style="color:#D73A49;">|</span><span style="color:#6F42C1;">cut</span><span style="color:#032F62;"> </span><span style="color:#005CC5;">-d</span><span style="color:#032F62;"> &#39;=&#39; </span><span style="color:#005CC5;">-f</span><span style="color:#032F62;"> </span><span style="color:#005CC5;">2</span><span style="color:#032F62;">`</span></span>\n<span class="line"><span style="color:#24292E;">  </span><span style="color:#6A737D;"># list repos in one project</span></span>\n<span class="line"><span style="color:#24292E;">  repos</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">`</span><span style="color:#6F42C1;">curl</span><span style="color:#032F62;"> </span><span style="color:#005CC5;">-s</span><span style="color:#032F62;"> </span><span style="color:#005CC5;">-k</span><span style="color:#032F62;"> </span><span style="color:#005CC5;">-H</span><span style="color:#032F62;"> &quot;Authorization: Basic ${</span><span style="color:#24292E;">harborBasicAuthToken</span><span style="color:#032F62;">}&quot; &quot;https://${</span><span style="color:#24292E;">harborRegistry</span><span style="color:#032F62;">}&quot;&#39;/api/repositories?page=1&amp;page_size=1000&amp;project_id=&#39;&quot;${</span><span style="color:#24292E;">projId</span><span style="color:#032F62;">}&quot; </span><span style="color:#D73A49;">|</span><span style="color:#032F62;"> </span><span style="color:#6F42C1;">jq</span><span style="color:#032F62;"> </span><span style="color:#005CC5;">-r</span><span style="color:#032F62;"> &#39;.[] | &quot;\\(.id)=\\(.name)&quot;&#39;`</span></span>\n<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">for</span><span style="color:#24292E;"> repo </span><span style="color:#D73A49;">in</span><span style="color:#24292E;"> ${repos[*]}; </span><span style="color:#D73A49;">do</span></span>\n<span class="line"><span style="color:#24292E;">    repoId</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">`</span><span style="color:#005CC5;">echo</span><span style="color:#032F62;"> </span><span style="color:#24292E;">$repo</span><span style="color:#D73A49;">|</span><span style="color:#6F42C1;">cut</span><span style="color:#032F62;"> </span><span style="color:#005CC5;">-d</span><span style="color:#032F62;"> &#39;=&#39; </span><span style="color:#005CC5;">-f</span><span style="color:#032F62;"> </span><span style="color:#005CC5;">1</span><span style="color:#032F62;">`</span></span>\n<span class="line"><span style="color:#24292E;">    repoName</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">`</span><span style="color:#005CC5;">echo</span><span style="color:#032F62;"> </span><span style="color:#24292E;">$repo</span><span style="color:#D73A49;">|</span><span style="color:#6F42C1;">cut</span><span style="color:#032F62;"> </span><span style="color:#005CC5;">-d</span><span style="color:#032F62;"> &#39;=&#39; </span><span style="color:#005CC5;">-f</span><span style="color:#032F62;"> </span><span style="color:#005CC5;">2</span><span style="color:#032F62;">`</span></span>\n<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;"># list tags in one repo</span></span>\n<span class="line"><span style="color:#24292E;">    tags</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">`</span><span style="color:#6F42C1;">curl</span><span style="color:#032F62;"> </span><span style="color:#005CC5;">-s</span><span style="color:#032F62;"> </span><span style="color:#005CC5;">-k</span><span style="color:#032F62;"> </span><span style="color:#005CC5;">-H</span><span style="color:#032F62;"> &quot;Authorization: Basic ${</span><span style="color:#24292E;">harborBasicAuthToken</span><span style="color:#032F62;">}&quot; &quot;https://${</span><span style="color:#24292E;">harborRegistry</span><span style="color:#032F62;">}&quot;&#39;/api/repositories/&#39;&quot;${</span><span style="color:#24292E;">repoName</span><span style="color:#032F62;">}&quot;&#39;/tags?detail=1&#39; </span><span style="color:#D73A49;">|</span><span style="color:#032F62;"> </span><span style="color:#6F42C1;">jq</span><span style="color:#032F62;"> </span><span style="color:#005CC5;">-r</span><span style="color:#032F62;"> &#39;.[].name&#39;`</span></span>\n<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">for</span><span style="color:#24292E;"> tag </span><span style="color:#D73A49;">in</span><span style="color:#24292E;"> ${tags[*]}; </span><span style="color:#D73A49;">do</span></span>\n<span class="line"><span style="color:#24292E;">      </span><span style="color:#6A737D;">#echo ${tag};</span></span>\n<span class="line"><span style="color:#24292E;">      </span><span style="color:#6A737D;"># pull image</span></span>\n<span class="line"><span style="color:#24292E;">      </span><span style="color:#6F42C1;">docker</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pull</span><span style="color:#24292E;"> ${harborRegistry}</span><span style="color:#032F62;">/</span><span style="color:#24292E;">${repoName}</span><span style="color:#032F62;">:</span><span style="color:#24292E;">${tag}</span></span>\n<span class="line"><span style="color:#24292E;">      </span><span style="color:#6A737D;"># tag image</span></span>\n<span class="line"><span style="color:#24292E;">      </span><span style="color:#6F42C1;">docker</span><span style="color:#24292E;"> </span><span style="color:#032F62;">tag</span><span style="color:#24292E;"> ${harborRegistry}</span><span style="color:#032F62;">/</span><span style="color:#24292E;">${repoName}</span><span style="color:#032F62;">:</span><span style="color:#24292E;">${tag} ${repoName}</span><span style="color:#032F62;">:</span><span style="color:#24292E;">${tag}</span></span>\n<span class="line"><span style="color:#24292E;">      </span><span style="color:#6A737D;"># save image</span></span>\n<span class="line"><span style="color:#24292E;">      </span><span style="color:#6F42C1;">mkdir</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-p</span><span style="color:#24292E;"> </span><span style="color:#032F62;">$(</span><span style="color:#6F42C1;">dirname</span><span style="color:#032F62;"> dist/${</span><span style="color:#24292E;">repoName</span><span style="color:#032F62;">})</span></span>\n<span class="line"><span style="color:#24292E;">      </span><span style="color:#6F42C1;">docker</span><span style="color:#24292E;"> </span><span style="color:#032F62;">save</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-o</span><span style="color:#24292E;"> </span><span style="color:#032F62;">dist/</span><span style="color:#24292E;">${repoName}</span><span style="color:#032F62;">:</span><span style="color:#24292E;">${tag}</span><span style="color:#032F62;">.tar</span><span style="color:#24292E;">  ${repoName}</span><span style="color:#032F62;">:</span><span style="color:#24292E;">${tag}</span></span>\n<span class="line"><span style="color:#24292E;">      </span><span style="color:#6A737D;"># record image to list file</span></span>\n<span class="line"><span style="color:#24292E;">      </span><span style="color:#005CC5;">echo</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;${</span><span style="color:#24292E;">repoName</span><span style="color:#032F62;">}:${</span><span style="color:#24292E;">tag</span><span style="color:#032F62;">}&quot;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&gt;&gt;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">dist/images.list</span></span>\n<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">done</span></span>\n<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">done</span></span>\n<span class="line"><span style="color:#24292E;">  </span><span style="color:#6A737D;"># list charts in one project</span></span>\n<span class="line"><span style="color:#24292E;">  charts</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">`</span><span style="color:#6F42C1;">curl</span><span style="color:#032F62;"> </span><span style="color:#005CC5;">-s</span><span style="color:#032F62;"> </span><span style="color:#005CC5;">-k</span><span style="color:#032F62;"> </span><span style="color:#005CC5;">-H</span><span style="color:#032F62;"> &quot;Authorization: Basic ${</span><span style="color:#24292E;">harborBasicAuthToken</span><span style="color:#032F62;">}&quot; &quot;https://${</span><span style="color:#24292E;">harborRegistry</span><span style="color:#032F62;">}&quot;&#39;/api/chartrepo/&#39;&quot;${</span><span style="color:#24292E;">projName</span><span style="color:#032F62;">}&quot;&#39;/charts&#39; </span><span style="color:#D73A49;">|</span><span style="color:#032F62;"> </span><span style="color:#6F42C1;">jq</span><span style="color:#032F62;"> </span><span style="color:#005CC5;">-r</span><span style="color:#032F62;"> &#39;.[].name&#39;`</span></span>\n<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">for</span><span style="color:#24292E;"> chart </span><span style="color:#D73A49;">in</span><span style="color:#24292E;"> ${charts[*]}; </span><span style="color:#D73A49;">do</span></span>\n<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">#echo ${chart}</span></span>\n<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;"># list download urls in one chart</span></span>\n<span class="line"><span style="color:#24292E;">    durls</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">`</span><span style="color:#6F42C1;">curl</span><span style="color:#032F62;"> </span><span style="color:#005CC5;">-s</span><span style="color:#032F62;"> </span><span style="color:#005CC5;">-k</span><span style="color:#032F62;"> </span><span style="color:#005CC5;">-H</span><span style="color:#032F62;"> &quot;Authorization: Basic ${</span><span style="color:#24292E;">harborBasicAuthToken</span><span style="color:#032F62;">}&quot; &quot;https://${</span><span style="color:#24292E;">harborRegistry</span><span style="color:#032F62;">}&quot;&#39;/api/chartrepo/&#39;&quot;${</span><span style="color:#24292E;">projName</span><span style="color:#032F62;">}&quot;&#39;/charts/&#39;&quot;${</span><span style="color:#24292E;">chart</span><span style="color:#032F62;">}&quot; </span><span style="color:#D73A49;">|</span><span style="color:#032F62;"> </span><span style="color:#6F42C1;">jq</span><span style="color:#032F62;"> </span><span style="color:#005CC5;">-r</span><span style="color:#032F62;"> &#39;.[].urls[0]&#39;`</span></span>\n<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">#echo ${durl[*]}</span></span>\n<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">for</span><span style="color:#24292E;"> durl </span><span style="color:#D73A49;">in</span><span style="color:#24292E;"> ${durls[*]}; </span><span style="color:#D73A49;">do</span></span>\n<span class="line"><span style="color:#24292E;">        </span><span style="color:#6A737D;">#echo ${durl};</span></span>\n<span class="line"><span style="color:#24292E;">        </span><span style="color:#6A737D;"># download chart</span></span>\n<span class="line"><span style="color:#24292E;">        </span><span style="color:#6F42C1;">mkdir</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-p</span><span style="color:#24292E;"> </span><span style="color:#032F62;">$(</span><span style="color:#6F42C1;">dirname</span><span style="color:#032F62;"> dist/${</span><span style="color:#24292E;">projName</span><span style="color:#032F62;">}/${</span><span style="color:#24292E;">durl</span><span style="color:#032F62;">})</span></span>\n<span class="line"><span style="color:#24292E;">        </span><span style="color:#6F42C1;">curl</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-s</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-k</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-H</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;Authorization: Basic ${</span><span style="color:#24292E;">harborBasicAuthToken</span><span style="color:#032F62;">}&quot;</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-o</span><span style="color:#24292E;"> </span><span style="color:#032F62;">dist/</span><span style="color:#24292E;">${projName}</span><span style="color:#032F62;">/</span><span style="color:#24292E;">${durl} </span><span style="color:#032F62;">&quot;https://${</span><span style="color:#24292E;">harborRegistry</span><span style="color:#032F62;">}/chartrepo/${</span><span style="color:#24292E;">projName</span><span style="color:#032F62;">}/${</span><span style="color:#24292E;">durl</span><span style="color:#032F62;">}&quot;</span></span>\n<span class="line"><span style="color:#24292E;">        </span><span style="color:#6A737D;"># record chart to list file</span></span>\n<span class="line"><span style="color:#24292E;">        </span><span style="color:#005CC5;">echo</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;${</span><span style="color:#24292E;">projName</span><span style="color:#032F62;">}/${</span><span style="color:#24292E;">durl</span><span style="color:#032F62;">}&quot;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&gt;&gt;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">dist/charts.list</span></span>\n<span class="line"><span style="color:#24292E;">        </span></span>\n<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">done</span></span>\n<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">done</span></span>\n<span class="line"><span style="color:#D73A49;">done</span></span></code></pre></div><h1 id="_2-还原" tabindex="-1">2.还原 <a class="header-anchor" href="#_2-还原" aria-label="Permalink to &quot;2.还原&quot;">​</a></h1><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">#!/bin/bash</span></span>\n<span class="line"><span style="color:#E1E4E8;">harborUsername</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&#39;admin&#39;</span></span>\n<span class="line"><span style="color:#E1E4E8;">harborPassword</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&#39;Harbor12345&#39;</span></span>\n<span class="line"><span style="color:#E1E4E8;">harborRegistry</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&#39;registry.test.com&#39;</span></span>\n<span class="line"><span style="color:#E1E4E8;">harborBasicAuthToken</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">$(</span><span style="color:#79B8FF;">echo</span><span style="color:#9ECBFF;"> </span><span style="color:#79B8FF;">-n</span><span style="color:#9ECBFF;"> &quot;${</span><span style="color:#E1E4E8;">harborUsername</span><span style="color:#9ECBFF;">}:${</span><span style="color:#E1E4E8;">harborPassword</span><span style="color:#9ECBFF;">}&quot; </span><span style="color:#F97583;">|</span><span style="color:#9ECBFF;"> </span><span style="color:#B392F0;">base64</span><span style="color:#9ECBFF;">)</span></span>\n<span class="line"><span style="color:#B392F0;">docker</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">login</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--username</span><span style="color:#E1E4E8;"> ${harborUsername} </span><span style="color:#79B8FF;">--password</span><span style="color:#E1E4E8;"> ${harborPassword} ${harborRegistry}</span></span>\n<span class="line"><span style="color:#F97583;">while</span><span style="color:#E1E4E8;"> IFS</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&quot;&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">read</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-r</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">image</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">||</span><span style="color:#E1E4E8;"> [ </span><span style="color:#F97583;">-n</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;</span><span style="color:#E1E4E8;">$image</span><span style="color:#9ECBFF;">&quot;</span><span style="color:#E1E4E8;"> ]</span></span>\n<span class="line"><span style="color:#F97583;">do</span></span>\n<span class="line"><span style="color:#E1E4E8;">  projName</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">${image</span><span style="color:#F97583;">%%/*</span><span style="color:#E1E4E8;">}</span></span>\n<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;"># echo ${projName}</span></span>\n<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;"># create harbor project</span></span>\n<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">curl</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-k</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-X</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">POST</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-H</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;Authorization: Basic ${</span><span style="color:#E1E4E8;">harborBasicAuthToken</span><span style="color:#9ECBFF;">}&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;https://${</span><span style="color:#E1E4E8;">harborRegistry</span><span style="color:#9ECBFF;">}/api/projects&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-H</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;accept: application/json&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-H</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;Content-Type: application/json&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-d</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;{ &quot;project_name&quot;: &quot;&#39;&quot;</span><span style="color:#E1E4E8;">$projName</span><span style="color:#9ECBFF;">&quot;&#39;&quot;, &quot;metadata&quot;: { &quot;public&quot;: &quot;true&quot; }}&#39;</span></span>\n<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;"># load image</span></span>\n<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">docker</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">load</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-i</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">dist/</span><span style="color:#E1E4E8;">${image}</span><span style="color:#9ECBFF;">.tar</span></span>\n<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;"># tag image</span></span>\n<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">docker</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">tag</span><span style="color:#E1E4E8;"> ${image} ${harborRegistry}</span><span style="color:#9ECBFF;">/</span><span style="color:#E1E4E8;">${image}</span></span>\n<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;"># push image</span></span>\n<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">docker</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">push</span><span style="color:#E1E4E8;"> ${harborRegistry}</span><span style="color:#9ECBFF;">/</span><span style="color:#E1E4E8;">${image}</span></span>\n<span class="line"><span style="color:#F97583;">done</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">&lt;</span><span style="color:#E1E4E8;"> dist/images.list</span></span>\n<span class="line"><span style="color:#F97583;">while</span><span style="color:#E1E4E8;"> IFS</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">&quot;&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">read</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-r</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">chart</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">||</span><span style="color:#E1E4E8;"> [ </span><span style="color:#F97583;">-n</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;</span><span style="color:#E1E4E8;">$chart</span><span style="color:#9ECBFF;">&quot;</span><span style="color:#E1E4E8;"> ]</span></span>\n<span class="line"><span style="color:#F97583;">do</span></span>\n<span class="line"><span style="color:#E1E4E8;">  projName</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">${chart</span><span style="color:#F97583;">%%/*</span><span style="color:#E1E4E8;">}</span></span>\n<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;"># echo ${projName}</span></span>\n<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;"># create harbor project</span></span>\n<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">curl</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-k</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-X</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">POST</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-H</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;Authorization: Basic ${</span><span style="color:#E1E4E8;">harborBasicAuthToken</span><span style="color:#9ECBFF;">}&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;https://${</span><span style="color:#E1E4E8;">harborRegistry</span><span style="color:#9ECBFF;">}/api/projects&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-H</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;accept: application/json&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-H</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;Content-Type: application/json&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-d</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;{ &quot;project_name&quot;: &quot;&#39;&quot;</span><span style="color:#E1E4E8;">$projName</span><span style="color:#9ECBFF;">&quot;&#39;&quot;, &quot;metadata&quot;: { &quot;public&quot;: &quot;true&quot; }}&#39;</span></span>\n<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;"># upload chart</span></span>\n<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">curl</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-s</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-k</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-H</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;Authorization: Basic ${</span><span style="color:#E1E4E8;">harborBasicAuthToken</span><span style="color:#9ECBFF;">}&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-X</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">POST</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;https://${</span><span style="color:#E1E4E8;">harborRegistry</span><span style="color:#9ECBFF;">}/api/chartrepo/${</span><span style="color:#E1E4E8;">projName</span><span style="color:#9ECBFF;">}/charts&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-H</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;accept: application/json&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-H</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;Content-Type: multipart/form-data&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-F</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;chart=@dist/${</span><span style="color:#E1E4E8;">chart</span><span style="color:#9ECBFF;">};type=application/gzip&quot;</span></span>\n<span class="line"><span style="color:#F97583;">done</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">&lt;</span><span style="color:#E1E4E8;"> dist/charts.list</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">#!/bin/bash</span></span>\n<span class="line"><span style="color:#24292E;">harborUsername</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&#39;admin&#39;</span></span>\n<span class="line"><span style="color:#24292E;">harborPassword</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&#39;Harbor12345&#39;</span></span>\n<span class="line"><span style="color:#24292E;">harborRegistry</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&#39;registry.test.com&#39;</span></span>\n<span class="line"><span style="color:#24292E;">harborBasicAuthToken</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">$(</span><span style="color:#005CC5;">echo</span><span style="color:#032F62;"> </span><span style="color:#005CC5;">-n</span><span style="color:#032F62;"> &quot;${</span><span style="color:#24292E;">harborUsername</span><span style="color:#032F62;">}:${</span><span style="color:#24292E;">harborPassword</span><span style="color:#032F62;">}&quot; </span><span style="color:#D73A49;">|</span><span style="color:#032F62;"> </span><span style="color:#6F42C1;">base64</span><span style="color:#032F62;">)</span></span>\n<span class="line"><span style="color:#6F42C1;">docker</span><span style="color:#24292E;"> </span><span style="color:#032F62;">login</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--username</span><span style="color:#24292E;"> ${harborUsername} </span><span style="color:#005CC5;">--password</span><span style="color:#24292E;"> ${harborPassword} ${harborRegistry}</span></span>\n<span class="line"><span style="color:#D73A49;">while</span><span style="color:#24292E;"> IFS</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&quot;&quot;</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">read</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-r</span><span style="color:#24292E;"> </span><span style="color:#032F62;">image</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">||</span><span style="color:#24292E;"> [ </span><span style="color:#D73A49;">-n</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;</span><span style="color:#24292E;">$image</span><span style="color:#032F62;">&quot;</span><span style="color:#24292E;"> ]</span></span>\n<span class="line"><span style="color:#D73A49;">do</span></span>\n<span class="line"><span style="color:#24292E;">  projName</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">${image</span><span style="color:#D73A49;">%%/*</span><span style="color:#24292E;">}</span></span>\n<span class="line"><span style="color:#24292E;">  </span><span style="color:#6A737D;"># echo ${projName}</span></span>\n<span class="line"><span style="color:#24292E;">  </span><span style="color:#6A737D;"># create harbor project</span></span>\n<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">curl</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-k</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-X</span><span style="color:#24292E;"> </span><span style="color:#032F62;">POST</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-H</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;Authorization: Basic ${</span><span style="color:#24292E;">harborBasicAuthToken</span><span style="color:#032F62;">}&quot;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;https://${</span><span style="color:#24292E;">harborRegistry</span><span style="color:#032F62;">}/api/projects&quot;</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-H</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;accept: application/json&quot;</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-H</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;Content-Type: application/json&quot;</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-d</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;{ &quot;project_name&quot;: &quot;&#39;&quot;</span><span style="color:#24292E;">$projName</span><span style="color:#032F62;">&quot;&#39;&quot;, &quot;metadata&quot;: { &quot;public&quot;: &quot;true&quot; }}&#39;</span></span>\n<span class="line"><span style="color:#24292E;">  </span><span style="color:#6A737D;"># load image</span></span>\n<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">docker</span><span style="color:#24292E;"> </span><span style="color:#032F62;">load</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-i</span><span style="color:#24292E;"> </span><span style="color:#032F62;">dist/</span><span style="color:#24292E;">${image}</span><span style="color:#032F62;">.tar</span></span>\n<span class="line"><span style="color:#24292E;">  </span><span style="color:#6A737D;"># tag image</span></span>\n<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">docker</span><span style="color:#24292E;"> </span><span style="color:#032F62;">tag</span><span style="color:#24292E;"> ${image} ${harborRegistry}</span><span style="color:#032F62;">/</span><span style="color:#24292E;">${image}</span></span>\n<span class="line"><span style="color:#24292E;">  </span><span style="color:#6A737D;"># push image</span></span>\n<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">docker</span><span style="color:#24292E;"> </span><span style="color:#032F62;">push</span><span style="color:#24292E;"> ${harborRegistry}</span><span style="color:#032F62;">/</span><span style="color:#24292E;">${image}</span></span>\n<span class="line"><span style="color:#D73A49;">done</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&lt;</span><span style="color:#24292E;"> dist/images.list</span></span>\n<span class="line"><span style="color:#D73A49;">while</span><span style="color:#24292E;"> IFS</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">&quot;&quot;</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">read</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-r</span><span style="color:#24292E;"> </span><span style="color:#032F62;">chart</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">||</span><span style="color:#24292E;"> [ </span><span style="color:#D73A49;">-n</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;</span><span style="color:#24292E;">$chart</span><span style="color:#032F62;">&quot;</span><span style="color:#24292E;"> ]</span></span>\n<span class="line"><span style="color:#D73A49;">do</span></span>\n<span class="line"><span style="color:#24292E;">  projName</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">${chart</span><span style="color:#D73A49;">%%/*</span><span style="color:#24292E;">}</span></span>\n<span class="line"><span style="color:#24292E;">  </span><span style="color:#6A737D;"># echo ${projName}</span></span>\n<span class="line"><span style="color:#24292E;">  </span><span style="color:#6A737D;"># create harbor project</span></span>\n<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">curl</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-k</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-X</span><span style="color:#24292E;"> </span><span style="color:#032F62;">POST</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-H</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;Authorization: Basic ${</span><span style="color:#24292E;">harborBasicAuthToken</span><span style="color:#032F62;">}&quot;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;https://${</span><span style="color:#24292E;">harborRegistry</span><span style="color:#032F62;">}/api/projects&quot;</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-H</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;accept: application/json&quot;</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-H</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;Content-Type: application/json&quot;</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-d</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;{ &quot;project_name&quot;: &quot;&#39;&quot;</span><span style="color:#24292E;">$projName</span><span style="color:#032F62;">&quot;&#39;&quot;, &quot;metadata&quot;: { &quot;public&quot;: &quot;true&quot; }}&#39;</span></span>\n<span class="line"><span style="color:#24292E;">  </span><span style="color:#6A737D;"># upload chart</span></span>\n<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">curl</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-s</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-k</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-H</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;Authorization: Basic ${</span><span style="color:#24292E;">harborBasicAuthToken</span><span style="color:#032F62;">}&quot;</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-X</span><span style="color:#24292E;"> </span><span style="color:#032F62;">POST</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;https://${</span><span style="color:#24292E;">harborRegistry</span><span style="color:#032F62;">}/api/chartrepo/${</span><span style="color:#24292E;">projName</span><span style="color:#032F62;">}/charts&quot;</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-H</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;accept: application/json&quot;</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-H</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;Content-Type: multipart/form-data&quot;</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-F</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;chart=@dist/${</span><span style="color:#24292E;">chart</span><span style="color:#032F62;">};type=application/gzip&quot;</span></span>\n<span class="line"><span style="color:#D73A49;">done</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&lt;</span><span style="color:#24292E;"> dist/charts.list</span></span></code></pre></div>',4),t=[l];function e(r,c,y,E,F,i){return a(),n("div",null,t)}const B=s(p,[["render",e]]);export{u as __pageData,B as default};
