import{_ as s,o as a,c as n,R as l}from"./chunks/framework.zUbWieqp.js";const u=JSON.parse('{"title":"1. domain_exporter","description":"","frontmatter":{},"headers":[],"relativePath":"guide/Linux/Monitor/Prometheus/monitor_project/18-domain_exporter.md","filePath":"guide/Linux/Monitor/Prometheus/monitor_project/18-domain_exporter.md","lastUpdated":1735121496000}'),p={name:"guide/Linux/Monitor/Prometheus/monitor_project/18-domain_exporter.md"},o=l(`<h1 id="_1-domain-exporter" tabindex="-1">1. domain_exporter <a class="header-anchor" href="#_1-domain-exporter" aria-label="Permalink to &quot;1. domain_exporter&quot;">​</a></h1><h2 id="_1-1-介绍" tabindex="-1">1.1 介绍 <a class="header-anchor" href="#_1-1-介绍" aria-label="Permalink to &quot;1.1 介绍&quot;">​</a></h2><p>检查域名状况</p><p><a href="https://github.com/caarlos0/domain_exporter" target="_blank" rel="noreferrer">https://github.com/caarlos0/domain_exporter</a></p><h3 id="指标" tabindex="-1">指标 <a class="header-anchor" href="#指标" aria-label="Permalink to &quot;指标&quot;">​</a></h3><table><thead><tr><th>指标名称</th><th>指标类型</th><th>指标含义</th></tr></thead><tbody><tr><td>domain_expiry_days</td><td>gauge</td><td>显示了域名距离过期还剩余的天数</td></tr><tr><td>domain_probe_success</td><td>gauge</td><td>对域名检测是否成功。1 表示成功，0 表示失败</td></tr><tr><td>domain_probe_duration_seconds</td><td>gauge</td><td>完成⼀次WHOIS 查询所需要的时间，单位为秒。如果延迟过⾼，说明连接WHOIS服务器的响应⽐较慢</td></tr></tbody></table><h2 id="_1-2-部署" tabindex="-1">1.2 部署 <a class="header-anchor" href="#_1-2-部署" aria-label="Permalink to &quot;1.2 部署&quot;">​</a></h2><h3 id="_1-容器方式" tabindex="-1">1.容器方式 <a class="header-anchor" href="#_1-容器方式" aria-label="Permalink to &quot;1.容器方式&quot;">​</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">docker</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">run</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-d</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--restart=always</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--name</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">domain_exporter</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-p</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">9222</span><span style="color:#9ECBFF;">:9222</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">registry.cn-zhangjiakou.aliyuncs.com/hsuing/domain_exporter:v1.23.0</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">docker</span><span style="color:#24292E;"> </span><span style="color:#032F62;">run</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-d</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--restart=always</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--name</span><span style="color:#24292E;"> </span><span style="color:#032F62;">domain_exporter</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-p</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">9222</span><span style="color:#032F62;">:9222</span><span style="color:#24292E;"> </span><span style="color:#032F62;">registry.cn-zhangjiakou.aliyuncs.com/hsuing/domain_exporter:v1.23.0</span></span></code></pre></div><h3 id="_2-k8s方式" tabindex="-1">2.k8s方式 <a class="header-anchor" href="#_2-k8s方式" aria-label="Permalink to &quot;2.k8s方式&quot;">​</a></h3><p>请看k8s章节</p><h3 id="_3-二进制方式" tabindex="-1">3.二进制方式 <a class="header-anchor" href="#_3-二进制方式" aria-label="Permalink to &quot;3.二进制方式&quot;">​</a></h3><ul><li>创建目录</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">mkdir</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/opt/prometheus/domain_exporter</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">mkdir</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/opt/prometheus/domain_exporter</span></span></code></pre></div><ul><li>创建用户</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">useradd</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-rs</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/bin/</span><span style="color:#79B8FF;">false</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">prometheus</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">chown</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-R</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">prometheus.</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/opt/prometheus/domain_exporter</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">useradd</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-rs</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/bin/</span><span style="color:#005CC5;">false</span><span style="color:#24292E;"> </span><span style="color:#032F62;">prometheus</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">chown</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-R</span><span style="color:#24292E;"> </span><span style="color:#032F62;">prometheus.</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/opt/prometheus/domain_exporter</span></span></code></pre></div><ul><li>下载</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">wget</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">https://github.com/caarlos0/domain_exporter/releases/download/v1.23.0/domain_exporter_1.23.0_linux_amd64.tar.gz</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 解压</span></span>
<span class="line"><span style="color:#B392F0;">tar</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">zxvf</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">domain_exporter_1.23.0_linux_amd64.tar.gz</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-C</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/opt/prometheus/domain_exporter</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">wget</span><span style="color:#24292E;"> </span><span style="color:#032F62;">https://github.com/caarlos0/domain_exporter/releases/download/v1.23.0/domain_exporter_1.23.0_linux_amd64.tar.gz</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 解压</span></span>
<span class="line"><span style="color:#6F42C1;">tar</span><span style="color:#24292E;"> </span><span style="color:#032F62;">zxvf</span><span style="color:#24292E;"> </span><span style="color:#032F62;">domain_exporter_1.23.0_linux_amd64.tar.gz</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-C</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/opt/prometheus/domain_exporter</span></span></code></pre></div><h3 id="_4-配置systemd" tabindex="-1">4. 配置systemd <a class="header-anchor" href="#_4-配置systemd" aria-label="Permalink to &quot;4. 配置systemd&quot;">​</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">cat</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">&gt;</span><span style="color:#9ECBFF;">/etc/systemd/system/domain_exporter.service</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">&lt;&lt;</span><span style="color:#E1E4E8;">&quot;</span><span style="color:#9ECBFF;">EOF</span><span style="color:#E1E4E8;">&quot;</span></span>
<span class="line"><span style="color:#9ECBFF;">[Unit]</span></span>
<span class="line"><span style="color:#9ECBFF;">Description=domain_exporter</span></span>
<span class="line"><span style="color:#9ECBFF;">Documentation=https://prometheus.io/</span></span>
<span class="line"><span style="color:#9ECBFF;">After=network.target</span></span>
<span class="line"></span>
<span class="line"><span style="color:#9ECBFF;">[Service]</span></span>
<span class="line"><span style="color:#9ECBFF;">Type=simple</span></span>
<span class="line"><span style="color:#9ECBFF;">User=prometheus</span></span>
<span class="line"><span style="color:#9ECBFF;">Group=prometheus</span></span>
<span class="line"><span style="color:#9ECBFF;">WorkingDirectory=/opt/prometheus/domain_exporter</span></span>
<span class="line"><span style="color:#9ECBFF;">ExecStart=/opt/prometheus/domain_exporter/domain_exporter --bind=&quot;:9222&quot;</span></span>
<span class="line"><span style="color:#9ECBFF;">ExecReload=/bin/kill -HUP $MAINPID</span></span>
<span class="line"><span style="color:#9ECBFF;">TimeoutStopSec=20s</span></span>
<span class="line"><span style="color:#9ECBFF;">KillMode=process</span></span>
<span class="line"><span style="color:#9ECBFF;">Restart=on-failure</span></span>
<span class="line"></span>
<span class="line"><span style="color:#9ECBFF;">[Install]</span></span>
<span class="line"><span style="color:#9ECBFF;">WantedBy=multi-user.target</span></span>
<span class="line"><span style="color:#9ECBFF;">EOF</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">cat</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&gt;</span><span style="color:#032F62;">/etc/systemd/system/domain_exporter.service</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&lt;&lt;</span><span style="color:#24292E;">&quot;</span><span style="color:#032F62;">EOF</span><span style="color:#24292E;">&quot;</span></span>
<span class="line"><span style="color:#032F62;">[Unit]</span></span>
<span class="line"><span style="color:#032F62;">Description=domain_exporter</span></span>
<span class="line"><span style="color:#032F62;">Documentation=https://prometheus.io/</span></span>
<span class="line"><span style="color:#032F62;">After=network.target</span></span>
<span class="line"></span>
<span class="line"><span style="color:#032F62;">[Service]</span></span>
<span class="line"><span style="color:#032F62;">Type=simple</span></span>
<span class="line"><span style="color:#032F62;">User=prometheus</span></span>
<span class="line"><span style="color:#032F62;">Group=prometheus</span></span>
<span class="line"><span style="color:#032F62;">WorkingDirectory=/opt/prometheus/domain_exporter</span></span>
<span class="line"><span style="color:#032F62;">ExecStart=/opt/prometheus/domain_exporter/domain_exporter --bind=&quot;:9222&quot;</span></span>
<span class="line"><span style="color:#032F62;">ExecReload=/bin/kill -HUP $MAINPID</span></span>
<span class="line"><span style="color:#032F62;">TimeoutStopSec=20s</span></span>
<span class="line"><span style="color:#032F62;">KillMode=process</span></span>
<span class="line"><span style="color:#032F62;">Restart=on-failure</span></span>
<span class="line"></span>
<span class="line"><span style="color:#032F62;">[Install]</span></span>
<span class="line"><span style="color:#032F62;">WantedBy=multi-user.target</span></span>
<span class="line"><span style="color:#032F62;">EOF</span></span></code></pre></div><ul><li>启动</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">systemctl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">daemon-reload</span></span>
<span class="line"><span style="color:#B392F0;">systemctl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">enable</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--now</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">domain_exporter</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">systemctl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">daemon-reload</span></span>
<span class="line"><span style="color:#6F42C1;">systemctl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">enable</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--now</span><span style="color:#24292E;"> </span><span style="color:#032F62;">domain_exporter</span></span></code></pre></div><ul><li>测试</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">curl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">http://localhost:9222/probe?target=www.baidu.com</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># HELP domain_expiry_days time in days until the domain expires</span></span>
<span class="line"><span style="color:#6A737D;"># TYPE domain_expiry_days gauge</span></span>
<span class="line"><span style="color:#B392F0;">domain_expiry_days</span><span style="color:#E1E4E8;">{domain=</span><span style="color:#B392F0;">&quot;baidu.com&quot;</span><span style="color:#B392F0;">}</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">655</span></span>
<span class="line"><span style="color:#6A737D;"># HELP domain_probe_duration_seconds returns how long the probe took to complete in seconds</span></span>
<span class="line"><span style="color:#6A737D;"># TYPE domain_probe_duration_seconds gauge</span></span>
<span class="line"><span style="color:#B392F0;">domain_probe_duration_seconds</span><span style="color:#E1E4E8;">{domain=</span><span style="color:#B392F0;">&quot;baidu.com&quot;</span><span style="color:#B392F0;">}</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">3.30020302</span></span>
<span class="line"><span style="color:#6A737D;"># HELP domain_probe_success whether the probe was successful or not</span></span>
<span class="line"><span style="color:#6A737D;"># TYPE domain_probe_success gauge</span></span>
<span class="line"><span style="color:#B392F0;">domain_probe_success</span><span style="color:#E1E4E8;">{domain=</span><span style="color:#B392F0;">&quot;baidu.com&quot;</span><span style="color:#B392F0;">}</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">1</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">curl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">http://localhost:9222/probe?target=www.baidu.com</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># HELP domain_expiry_days time in days until the domain expires</span></span>
<span class="line"><span style="color:#6A737D;"># TYPE domain_expiry_days gauge</span></span>
<span class="line"><span style="color:#6F42C1;">domain_expiry_days</span><span style="color:#24292E;">{domain=</span><span style="color:#6F42C1;">&quot;baidu.com&quot;</span><span style="color:#6F42C1;">}</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">655</span></span>
<span class="line"><span style="color:#6A737D;"># HELP domain_probe_duration_seconds returns how long the probe took to complete in seconds</span></span>
<span class="line"><span style="color:#6A737D;"># TYPE domain_probe_duration_seconds gauge</span></span>
<span class="line"><span style="color:#6F42C1;">domain_probe_duration_seconds</span><span style="color:#24292E;">{domain=</span><span style="color:#6F42C1;">&quot;baidu.com&quot;</span><span style="color:#6F42C1;">}</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">3.30020302</span></span>
<span class="line"><span style="color:#6A737D;"># HELP domain_probe_success whether the probe was successful or not</span></span>
<span class="line"><span style="color:#6A737D;"># TYPE domain_probe_success gauge</span></span>
<span class="line"><span style="color:#6F42C1;">domain_probe_success</span><span style="color:#24292E;">{domain=</span><span style="color:#6F42C1;">&quot;baidu.com&quot;</span><span style="color:#6F42C1;">}</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1</span></span></code></pre></div><h2 id="_1-3-配置prometheus" tabindex="-1">1.3 配置prometheus <a class="header-anchor" href="#_1-3-配置prometheus" aria-label="Permalink to &quot;1.3 配置prometheus&quot;">​</a></h2><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">  - </span><span style="color:#85E89D;">job_name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;domain_exporter&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">metrics_path</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">/probe</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">static_configs</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    - </span><span style="color:#85E89D;">targets</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      - </span><span style="color:#9ECBFF;">baidu.com</span></span>
<span class="line"><span style="color:#E1E4E8;">      - </span><span style="color:#9ECBFF;">jd.com</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">relabel_configs</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      - </span><span style="color:#85E89D;">source_labels</span><span style="color:#E1E4E8;">: [</span><span style="color:#9ECBFF;">__address__</span><span style="color:#E1E4E8;">]</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">target_label</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">__param_target</span></span>
<span class="line"><span style="color:#E1E4E8;">      - </span><span style="color:#85E89D;">source_labels</span><span style="color:#E1E4E8;">: [</span><span style="color:#9ECBFF;">__param_target</span><span style="color:#E1E4E8;">]</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">target_label</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">instance</span></span>
<span class="line"><span style="color:#E1E4E8;">      - </span><span style="color:#85E89D;">target_label</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">__address__</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">replacement</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">192.168.137.131:19222</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;">#domain_exporter address</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">  - </span><span style="color:#22863A;">job_name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;domain_exporter&quot;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">metrics_path</span><span style="color:#24292E;">: </span><span style="color:#032F62;">/probe</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">static_configs</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    - </span><span style="color:#22863A;">targets</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      - </span><span style="color:#032F62;">baidu.com</span></span>
<span class="line"><span style="color:#24292E;">      - </span><span style="color:#032F62;">jd.com</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">relabel_configs</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      - </span><span style="color:#22863A;">source_labels</span><span style="color:#24292E;">: [</span><span style="color:#032F62;">__address__</span><span style="color:#24292E;">]</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">target_label</span><span style="color:#24292E;">: </span><span style="color:#032F62;">__param_target</span></span>
<span class="line"><span style="color:#24292E;">      - </span><span style="color:#22863A;">source_labels</span><span style="color:#24292E;">: [</span><span style="color:#032F62;">__param_target</span><span style="color:#24292E;">]</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">target_label</span><span style="color:#24292E;">: </span><span style="color:#032F62;">instance</span></span>
<span class="line"><span style="color:#24292E;">      - </span><span style="color:#22863A;">target_label</span><span style="color:#24292E;">: </span><span style="color:#032F62;">__address__</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">replacement</span><span style="color:#24292E;">: </span><span style="color:#032F62;">192.168.137.131:19222</span><span style="color:#24292E;"> </span><span style="color:#6A737D;">#domain_exporter address</span></span></code></pre></div><ul><li>热更</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">curl</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-X</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">POST</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">http://localhost:9090/-/reload</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">curl</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-X</span><span style="color:#24292E;"> </span><span style="color:#032F62;">POST</span><span style="color:#24292E;"> </span><span style="color:#032F62;">http://localhost:9090/-/reload</span></span></code></pre></div><h2 id="_1-4-配置告警" tabindex="-1">1.4 配置告警 <a class="header-anchor" href="#_1-4-配置告警" aria-label="Permalink to &quot;1.4 配置告警&quot;">​</a></h2><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">groups</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    - </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">domain</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">rules</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      - </span><span style="color:#85E89D;">alert</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">域名SlowHttp</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">expr</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">avg_over_time(probe_http_duration_seconds[1m]) &gt; 10</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">for</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">1m</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">labels</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#85E89D;">severity</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">warning</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">annotations</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#85E89D;">summary</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">HTTP请求超时 (instance {{ $labels.instance }})</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#85E89D;">description</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;HTTP请求超时超过10秒n  VALUE = {{ $value }}n  LABELS = {{ $labels }}&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">      - </span><span style="color:#85E89D;">alert</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">域名检测失败</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">expr</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">domain_probe_success == 0</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">for</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">2h</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">labels</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#85E89D;">severity</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">warning</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">annotations</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#85E89D;">summary</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&#39;{{ $labels.instance }} ,域名检测&#39;</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#85E89D;">description</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&#39;{{ $labels.domain }}, 域名检测失败,请及时查看!!!&#39;</span></span>
<span class="line"><span style="color:#E1E4E8;">      - </span><span style="color:#85E89D;">alert</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">域名过期 &lt;15天</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">expr</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">domain_expiry_days &lt; 15</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">for</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">2h</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">labels</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#85E89D;">severity</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">warning</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">annotations</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#85E89D;">summary</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&#39;{{ $labels.instance }},域名过期&#39;</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#85E89D;">description</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&#39;{{ $labels.domain }},将在15天后过期,当前剩余天数：{{ $value }},请及时查看!!!&#39;</span></span>
<span class="line"><span style="color:#E1E4E8;">      - </span><span style="color:#85E89D;">alert</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">域名过期 &lt;5天</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">expr</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">domain_expiry_days &lt; 5</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">for</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">2h</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">labels</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#85E89D;">severity</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">warning</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">annotations</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#85E89D;">summary</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&#39;{{ $labels.instance }},域名过期&#39;</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#85E89D;">description</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&#39;{{ $labels.domain }},将在5天后过期,当前剩余天数：{{ $value }},请及时查看!!!&#39;</span></span>
<span class="line"><span style="color:#E1E4E8;">      - </span><span style="color:#85E89D;">alert</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">域名证书已过期</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">expr</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">probe_ssl_earliest_cert_expiry - time() &lt;= 0</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">for</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">30m</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">labels</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#85E89D;">severity</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">critical</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">annotations</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#85E89D;">summary</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">域名证书已过期 (instance {{ $labels.instance }})</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#85E89D;">description</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;域名证书已过期n  VALUE = {{ $value }}n  LABELS = {{ $labels }}&quot;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">groups</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">domain</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">rules</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      - </span><span style="color:#22863A;">alert</span><span style="color:#24292E;">: </span><span style="color:#032F62;">域名SlowHttp</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">expr</span><span style="color:#24292E;">: </span><span style="color:#032F62;">avg_over_time(probe_http_duration_seconds[1m]) &gt; 10</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">for</span><span style="color:#24292E;">: </span><span style="color:#032F62;">1m</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">labels</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#22863A;">severity</span><span style="color:#24292E;">: </span><span style="color:#032F62;">warning</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">annotations</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#22863A;">summary</span><span style="color:#24292E;">: </span><span style="color:#032F62;">HTTP请求超时 (instance {{ $labels.instance }})</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#22863A;">description</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;HTTP请求超时超过10秒n  VALUE = {{ $value }}n  LABELS = {{ $labels }}&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">      - </span><span style="color:#22863A;">alert</span><span style="color:#24292E;">: </span><span style="color:#032F62;">域名检测失败</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">expr</span><span style="color:#24292E;">: </span><span style="color:#032F62;">domain_probe_success == 0</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">for</span><span style="color:#24292E;">: </span><span style="color:#032F62;">2h</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">labels</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#22863A;">severity</span><span style="color:#24292E;">: </span><span style="color:#032F62;">warning</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">annotations</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#22863A;">summary</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&#39;{{ $labels.instance }} ,域名检测&#39;</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#22863A;">description</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&#39;{{ $labels.domain }}, 域名检测失败,请及时查看!!!&#39;</span></span>
<span class="line"><span style="color:#24292E;">      - </span><span style="color:#22863A;">alert</span><span style="color:#24292E;">: </span><span style="color:#032F62;">域名过期 &lt;15天</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">expr</span><span style="color:#24292E;">: </span><span style="color:#032F62;">domain_expiry_days &lt; 15</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">for</span><span style="color:#24292E;">: </span><span style="color:#032F62;">2h</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">labels</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#22863A;">severity</span><span style="color:#24292E;">: </span><span style="color:#032F62;">warning</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">annotations</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#22863A;">summary</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&#39;{{ $labels.instance }},域名过期&#39;</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#22863A;">description</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&#39;{{ $labels.domain }},将在15天后过期,当前剩余天数：{{ $value }},请及时查看!!!&#39;</span></span>
<span class="line"><span style="color:#24292E;">      - </span><span style="color:#22863A;">alert</span><span style="color:#24292E;">: </span><span style="color:#032F62;">域名过期 &lt;5天</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">expr</span><span style="color:#24292E;">: </span><span style="color:#032F62;">domain_expiry_days &lt; 5</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">for</span><span style="color:#24292E;">: </span><span style="color:#032F62;">2h</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">labels</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#22863A;">severity</span><span style="color:#24292E;">: </span><span style="color:#032F62;">warning</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">annotations</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#22863A;">summary</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&#39;{{ $labels.instance }},域名过期&#39;</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#22863A;">description</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&#39;{{ $labels.domain }},将在5天后过期,当前剩余天数：{{ $value }},请及时查看!!!&#39;</span></span>
<span class="line"><span style="color:#24292E;">      - </span><span style="color:#22863A;">alert</span><span style="color:#24292E;">: </span><span style="color:#032F62;">域名证书已过期</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">expr</span><span style="color:#24292E;">: </span><span style="color:#032F62;">probe_ssl_earliest_cert_expiry - time() &lt;= 0</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">for</span><span style="color:#24292E;">: </span><span style="color:#032F62;">30m</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">labels</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#22863A;">severity</span><span style="color:#24292E;">: </span><span style="color:#032F62;">critical</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">annotations</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#22863A;">summary</span><span style="color:#24292E;">: </span><span style="color:#032F62;">域名证书已过期 (instance {{ $labels.instance }})</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#22863A;">description</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;域名证书已过期n  VALUE = {{ $value }}n  LABELS = {{ $labels }}&quot;</span></span></code></pre></div>`,30),e=[o];function t(r,c,E,y,i,d){return a(),n("div",null,e)}const m=s(p,[["render",t]]);export{u as __pageData,m as default};
