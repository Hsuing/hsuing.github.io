import{_ as s,o as n,c as a,R as l}from"./chunks/framework.zUbWieqp.js";const C=JSON.parse('{"title":"1.ReplicaSet","description":"","frontmatter":{},"headers":[],"relativePath":"guide/container/k8s/资源对象/5-deployment-ReplicaSet.md","filePath":"guide/container/k8s/资源对象/5-deployment-ReplicaSet.md","lastUpdated":1734344767000}'),p={name:"guide/container/k8s/资源对象/5-deployment-ReplicaSet.md"},o=l(`<h1 id="_1-replicaset" tabindex="-1">1.ReplicaSet <a class="header-anchor" href="#_1-replicaset" aria-label="Permalink to &quot;1.ReplicaSet&quot;">​</a></h1><h2 id="_1-1-传统应用集群" tabindex="-1">1.1 传统应⽤集群 <a class="header-anchor" href="#_1-1-传统应用集群" aria-label="Permalink to &quot;1.1 传统应⽤集群&quot;">​</a></h2><p>在传统环境中，如果要保证应用的高可用。一般都以集群方式部署，集群中的应用实例至少部署2个以上，这样即使一个应用故障了，另一台应用任然能够对外提供服务，在这种环境下，我们主要依赖前置的负载均衡Nginx，通过手动编辑配置文件的方式来实现。而一旦我们需要对应用进行扩容或缩容，也需要在Nginx上进行手动配置，过程相对繁琐也比较容易出错。</p><p><img src="https://nnaigos.oss-cn-hangzhou.aliyuncs.com/imgs/202404301359308.png" alt="image-20240430135851488"></p><h2 id="_1-2-什么是replicaset" tabindex="-1">1.2 什么是ReplicaSet <a class="header-anchor" href="#_1-2-什么是replicaset" aria-label="Permalink to &quot;1.2 什么是ReplicaSet&quot;">​</a></h2><p>文档，<a href="https://kubernetes.io/zh-cn/docs/concepts/workloads/controllers/replicaset/" target="_blank" rel="noreferrer">https://kubernetes.io/zh-cn/docs/concepts/workloads/controllers/replicaset/</a></p><p>ReplicaSet 的目的是维护一组在任何时候都处于运行状态的 Pod 副本的稳定集合。 因此，它通常用来保证给定数量的、完全相同的 Pod 的可用性</p><p>在Kubernetes环境中，通过<code>ReplicaSet</code>这种资源对象就可以来帮助我们实现集群的高可用，<code>RepLicaSet(RS)</code>的主要作用就是维持一组Pod副本的运行，<code>ReplicaSet</code>控制器会持续监听它控制的这些Pod的运行状态以及数量，保证应用集群的高可用；</p><p>ReplicaSet和Deployment联合起来控制无状态应用。ReplicaSet并不是我们直接应该使用的控制器，虽然说它是一个非常重要的基础的控制器。而更加高级的抽象的也是我们使用最多的控制器叫Deployment。借助一到多个ReplicaSet便捷的管理Pod。从某种意义来讲，Deployment是ReplicaSet控制器。Deployment控制器在定义的时候却不定义与Replicaset有任何关系。定义的所有内容都是Pod模板。Pod副本之类的。也就对用户而言，即便我们使用Deployment控制器，用户即便使用的是ReplicaSet控制器，用户对中间的Replicaset甚至无从感知的。</p><p><img src="https://nnaigos.oss-cn-hangzhou.aliyuncs.com/imgs/202404301407940.png" alt="image-20240430140739476"></p><div class="warning custom-block"><p class="custom-block-title">💡 说明</p><p>正确的管理方式是 Deployment-&gt;ReplicaSet-&gt;Pod</p></div><h2 id="_1-3-replicaset组成部分" tabindex="-1">1.3 ReplicaSet组成部分 <a class="header-anchor" href="#_1-3-replicaset组成部分" aria-label="Permalink to &quot;1.3 ReplicaSet组成部分&quot;">​</a></h2><p>ReplicaSet控制器包含了3个基本的组成部分:</p><ul><li><strong>selector</strong>标签选择器：匹配并关联Pod对象，并加入控制器的管理中;</li><li><strong>replicas</strong>期望的副本数：期望在集群中所运行的Pod对象数量</li><li><strong>template</strong> Pod模板：实际上就是定义的 Pod规范，相当于把一个Pod的描述以模板的形式嵌入到了RepLicaSet</li></ul><h2 id="_1-4-replicaset的资源规范" tabindex="-1">1.4 ReplicaSet的资源规范 <a class="header-anchor" href="#_1-4-replicaset的资源规范" aria-label="Permalink to &quot;1.4 ReplicaSet的资源规范&quot;">​</a></h2><p>ReplicaSet配置文件示例:</p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#85E89D;">apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">apps/v1</span><span style="color:#E1E4E8;">   </span><span style="color:#6A737D;"># 所在群组是apps/v1群组和Deployment一样；</span></span>
<span class="line"><span style="color:#85E89D;">kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">ReplicaSet</span><span style="color:#E1E4E8;">       </span><span style="color:#6A737D;"># 资源类型为ReplicaSet；</span></span>
<span class="line"><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">: </span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">:   </span><span style="color:#6A737D;"># Pod的名称；</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">namespace</span><span style="color:#E1E4E8;">:  </span><span style="color:#6A737D;"># Pod所在的Namespace，默认是Default；</span></span>
<span class="line"><span style="color:#85E89D;">spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">minReadySeconds &lt;integer&gt;</span><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;">#  Pod就绪后多少秒内任一容器无Crash方可视为&quot;就绪&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">replicas  &lt;integer&gt;</span><span style="color:#E1E4E8;">        </span><span style="color:#6A737D;">#  期望的Pod副本数，默认为1。如果期望Pod的副本数增加，只需要更改replicas的数字即可。如果你写2个，创建的Pod就是根据Template定义的规范去运行起来的。Pod启动后就会被我们标签选择器所管理，进而被我们RS所管理。</span></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#85E89D;">selector</span><span style="color:#E1E4E8;">:    </span><span style="color:#6A737D;"># 这里的标签选择器与Service的标签选择器是不一样的，不是选择器的功能不一样，而是选择器的格式不同；</span></span>
<span class="line"><span style="color:#E1E4E8;">     </span><span style="color:#9ECBFF;">matchExpressions &lt;[]Object&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">     </span><span style="color:#9ECBFF;">matchLabels &lt;map[string]string&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#85E89D;">template</span><span style="color:#E1E4E8;">:    </span><span style="color:#6A737D;"># 定义Pod的模板，用来描述Pod的详情；比如定义Containers、Images、Resoucre、Lifecycle，把它做成一个模板。</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">labels</span><span style="color:#E1E4E8;">:  </span><span style="color:#6A737D;"># 定义Pod的标签，</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">spec</span><span style="color:#E1E4E8;">:</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#22863A;">apiVersion</span><span style="color:#24292E;">: </span><span style="color:#032F62;">apps/v1</span><span style="color:#24292E;">   </span><span style="color:#6A737D;"># 所在群组是apps/v1群组和Deployment一样；</span></span>
<span class="line"><span style="color:#22863A;">kind</span><span style="color:#24292E;">: </span><span style="color:#032F62;">ReplicaSet</span><span style="color:#24292E;">       </span><span style="color:#6A737D;"># 资源类型为ReplicaSet；</span></span>
<span class="line"><span style="color:#22863A;">metadata</span><span style="color:#24292E;">: </span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">name</span><span style="color:#24292E;">:   </span><span style="color:#6A737D;"># Pod的名称；</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">namespace</span><span style="color:#24292E;">:  </span><span style="color:#6A737D;"># Pod所在的Namespace，默认是Default；</span></span>
<span class="line"><span style="color:#22863A;">spec</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#032F62;">minReadySeconds &lt;integer&gt;</span><span style="color:#24292E;">  </span><span style="color:#6A737D;">#  Pod就绪后多少秒内任一容器无Crash方可视为&quot;就绪&quot;</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#032F62;">replicas  &lt;integer&gt;</span><span style="color:#24292E;">        </span><span style="color:#6A737D;">#  期望的Pod副本数，默认为1。如果期望Pod的副本数增加，只需要更改replicas的数字即可。如果你写2个，创建的Pod就是根据Template定义的规范去运行起来的。Pod启动后就会被我们标签选择器所管理，进而被我们RS所管理。</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#22863A;">selector</span><span style="color:#24292E;">:    </span><span style="color:#6A737D;"># 这里的标签选择器与Service的标签选择器是不一样的，不是选择器的功能不一样，而是选择器的格式不同；</span></span>
<span class="line"><span style="color:#24292E;">     </span><span style="color:#032F62;">matchExpressions &lt;[]Object&gt;</span></span>
<span class="line"><span style="color:#24292E;">     </span><span style="color:#032F62;">matchLabels &lt;map[string]string&gt;</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#22863A;">template</span><span style="color:#24292E;">:    </span><span style="color:#6A737D;"># 定义Pod的模板，用来描述Pod的详情；比如定义Containers、Images、Resoucre、Lifecycle，把它做成一个模板。</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">metadata</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">labels</span><span style="color:#24292E;">:  </span><span style="color:#6A737D;"># 定义Pod的标签，</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">spec</span><span style="color:#24292E;">:</span></span></code></pre></div><p><img src="https://nnaigos.oss-cn-hangzhou.aliyuncs.com/imgs/202404301410765.png" alt="image-20240430141034808"></p><h3 id="示例配置1" tabindex="-1">示例配置1 <a class="header-anchor" href="#示例配置1" aria-label="Permalink to &quot;示例配置1&quot;">​</a></h3><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#85E89D;">apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">apps/v1</span></span>
<span class="line"><span style="color:#85E89D;">kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">ReplicaSet</span></span>
<span class="line"><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">mall-web-rs</span><span style="color:#E1E4E8;">     </span><span style="color:#6A737D;"># RS控制器名称</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">namespace</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">default</span><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;"># 命名空间</span></span>
<span class="line"><span style="color:#85E89D;">spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">replicas</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">2</span><span style="color:#E1E4E8;">           </span><span style="color:#6A737D;"># 期望的 Pod 副本数量，默认值为1</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">selector</span><span style="color:#E1E4E8;">:             </span><span style="color:#6A737D;"># 选择器，匹配 Pod 模板中的标签</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">matchLabels</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">app</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">mall-web</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">template</span><span style="color:#E1E4E8;">:             </span><span style="color:#6A737D;"># 定义 Pod 模板 （内嵌Pod模板不需要apiVersion和kind字段）</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">labels</span><span style="color:#E1E4E8;">:           </span><span style="color:#6A737D;"># 定义Pod标签</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">app</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">mall-web</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">containers</span><span style="color:#E1E4E8;">:       </span><span style="color:#6A737D;"># 定义容器列表</span></span>
<span class="line"><span style="color:#E1E4E8;">      - </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">mall-web</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">image</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">nginx:latest</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">ports</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">        - </span><span style="color:#85E89D;">containerPort</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">8080</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#22863A;">apiVersion</span><span style="color:#24292E;">: </span><span style="color:#032F62;">apps/v1</span></span>
<span class="line"><span style="color:#22863A;">kind</span><span style="color:#24292E;">: </span><span style="color:#032F62;">ReplicaSet</span></span>
<span class="line"><span style="color:#22863A;">metadata</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">mall-web-rs</span><span style="color:#24292E;">     </span><span style="color:#6A737D;"># RS控制器名称</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">namespace</span><span style="color:#24292E;">: </span><span style="color:#032F62;">default</span><span style="color:#24292E;">    </span><span style="color:#6A737D;"># 命名空间</span></span>
<span class="line"><span style="color:#22863A;">spec</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">replicas</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">2</span><span style="color:#24292E;">           </span><span style="color:#6A737D;"># 期望的 Pod 副本数量，默认值为1</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">selector</span><span style="color:#24292E;">:             </span><span style="color:#6A737D;"># 选择器，匹配 Pod 模板中的标签</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">matchLabels</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">app</span><span style="color:#24292E;">: </span><span style="color:#032F62;">mall-web</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">template</span><span style="color:#24292E;">:             </span><span style="color:#6A737D;"># 定义 Pod 模板 （内嵌Pod模板不需要apiVersion和kind字段）</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">metadata</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">labels</span><span style="color:#24292E;">:           </span><span style="color:#6A737D;"># 定义Pod标签</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">app</span><span style="color:#24292E;">: </span><span style="color:#032F62;">mall-web</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">spec</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">containers</span><span style="color:#24292E;">:       </span><span style="color:#6A737D;"># 定义容器列表</span></span>
<span class="line"><span style="color:#24292E;">      - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">mall-web</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">image</span><span style="color:#24292E;">: </span><span style="color:#032F62;">nginx:latest</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">ports</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">        - </span><span style="color:#22863A;">containerPort</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">8080</span></span></code></pre></div><h3 id="示例配置2" tabindex="-1">示例配置2 <a class="header-anchor" href="#示例配置2" aria-label="Permalink to &quot;示例配置2&quot;">​</a></h3><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">#cat nginx-test-replicas.yaml </span></span>
<span class="line"><span style="color:#85E89D;">apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">apps/v1</span><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;"># API版本</span></span>
<span class="line"><span style="color:#85E89D;">kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">ReplicaSet</span><span style="color:#E1E4E8;">     </span><span style="color:#6A737D;"># 资源类型</span></span>
<span class="line"><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">: </span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">nginx-rs</span><span style="color:#E1E4E8;">      </span><span style="color:#6A737D;"># RS控制器名称</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">namespace</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">default</span><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;"># 名称空间</span></span>
<span class="line"><span style="color:#85E89D;">spec</span><span style="color:#E1E4E8;">:          </span><span style="color:#6A737D;"># 定义RS规范</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">replicas</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">2</span><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;"># 定义的副本数,如果我们觉得副本数量太小，可以在这里定义副本数，也可以通过命令的方式来扩缩容。</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">minReadySeconds</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">20</span><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;"># Pod就绪后多少秒内任一容器无Crash方可视为&quot;就绪&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">selector</span><span style="color:#E1E4E8;">:        </span><span style="color:#6A737D;">#  标签选择器</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">matchLabels</span><span style="color:#E1E4E8;">:  </span></span>
<span class="line"><span style="color:#E1E4E8;">       </span><span style="color:#85E89D;">app</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">nginx-test</span><span style="color:#E1E4E8;">  </span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">template</span><span style="color:#E1E4E8;">:       </span><span style="color:#6A737D;"># Pod的模板</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">labels</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">app</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">nginx-test</span><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;">#  标签匹配上面的Selector</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">containers</span><span style="color:#E1E4E8;">:        </span><span style="color:#6A737D;"># 定义容器</span></span>
<span class="line"><span style="color:#E1E4E8;">      - </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">nginx</span><span style="color:#E1E4E8;">      </span><span style="color:#6A737D;"># Containers Name</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">image</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">nginx</span><span style="color:#E1E4E8;">     </span><span style="color:#6A737D;"># Containers Images</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">ports</span><span style="color:#E1E4E8;">:           </span><span style="color:#6A737D;"># 定义容器的端口</span></span>
<span class="line"><span style="color:#E1E4E8;">        - </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">http</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#85E89D;">containerPort</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">80</span><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;"># 容器的端口为80</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">#cat nginx-test-replicas.yaml </span></span>
<span class="line"><span style="color:#22863A;">apiVersion</span><span style="color:#24292E;">: </span><span style="color:#032F62;">apps/v1</span><span style="color:#24292E;">  </span><span style="color:#6A737D;"># API版本</span></span>
<span class="line"><span style="color:#22863A;">kind</span><span style="color:#24292E;">: </span><span style="color:#032F62;">ReplicaSet</span><span style="color:#24292E;">     </span><span style="color:#6A737D;"># 资源类型</span></span>
<span class="line"><span style="color:#22863A;">metadata</span><span style="color:#24292E;">: </span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">nginx-rs</span><span style="color:#24292E;">      </span><span style="color:#6A737D;"># RS控制器名称</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">namespace</span><span style="color:#24292E;">: </span><span style="color:#032F62;">default</span><span style="color:#24292E;">  </span><span style="color:#6A737D;"># 名称空间</span></span>
<span class="line"><span style="color:#22863A;">spec</span><span style="color:#24292E;">:          </span><span style="color:#6A737D;"># 定义RS规范</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">replicas</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">2</span><span style="color:#24292E;">  </span><span style="color:#6A737D;"># 定义的副本数,如果我们觉得副本数量太小，可以在这里定义副本数，也可以通过命令的方式来扩缩容。</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">minReadySeconds</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">20</span><span style="color:#24292E;">  </span><span style="color:#6A737D;"># Pod就绪后多少秒内任一容器无Crash方可视为&quot;就绪&quot;</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">selector</span><span style="color:#24292E;">:        </span><span style="color:#6A737D;">#  标签选择器</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">matchLabels</span><span style="color:#24292E;">:  </span></span>
<span class="line"><span style="color:#24292E;">       </span><span style="color:#22863A;">app</span><span style="color:#24292E;">: </span><span style="color:#032F62;">nginx-test</span><span style="color:#24292E;">  </span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">template</span><span style="color:#24292E;">:       </span><span style="color:#6A737D;"># Pod的模板</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">metadata</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">labels</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">app</span><span style="color:#24292E;">: </span><span style="color:#032F62;">nginx-test</span><span style="color:#24292E;">  </span><span style="color:#6A737D;">#  标签匹配上面的Selector</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">spec</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">containers</span><span style="color:#24292E;">:        </span><span style="color:#6A737D;"># 定义容器</span></span>
<span class="line"><span style="color:#24292E;">      - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">nginx</span><span style="color:#24292E;">      </span><span style="color:#6A737D;"># Containers Name</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">image</span><span style="color:#24292E;">: </span><span style="color:#032F62;">nginx</span><span style="color:#24292E;">     </span><span style="color:#6A737D;"># Containers Images</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">ports</span><span style="color:#24292E;">:           </span><span style="color:#6A737D;"># 定义容器的端口</span></span>
<span class="line"><span style="color:#24292E;">        - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">http</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#22863A;">containerPort</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">80</span><span style="color:#24292E;">  </span><span style="color:#6A737D;"># 容器的端口为80</span></span></code></pre></div><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;"># 创建Pod</span></span>
<span class="line"><span style="color:#E1E4E8;">[root@kube-master volumes]# kubectl apply -f nginx-test-replicas.yaml </span></span>
<span class="line"><span style="color:#B392F0;">replicaset.apps/nginx-rs</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">created</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 这两个副本都能提供服务且是相同的服务。</span></span>
<span class="line"><span style="color:#E1E4E8;">[root@kube-master volumes]# kubectl get pods -l app=nginx-test</span></span>
<span class="line"><span style="color:#B392F0;">NAME</span><span style="color:#E1E4E8;">             </span><span style="color:#9ECBFF;">READY</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">STATUS</span><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">RESTARTS</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">AGE</span></span>
<span class="line"><span style="color:#B392F0;">nginx-rs-542db</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">1</span><span style="color:#9ECBFF;">/1</span><span style="color:#E1E4E8;">     </span><span style="color:#9ECBFF;">Running</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">          </span><span style="color:#79B8FF;">2</span><span style="color:#9ECBFF;">m1s</span></span>
<span class="line"><span style="color:#B392F0;">nginx-rs-hcxh9</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">1</span><span style="color:#9ECBFF;">/1</span><span style="color:#E1E4E8;">     </span><span style="color:#9ECBFF;">Running</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">          </span><span style="color:#79B8FF;">2</span><span style="color:#9ECBFF;">m1s</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># ReplicaSet可以简写为rs，写replicaset或者rs都可以。</span></span>
<span class="line"><span style="color:#E1E4E8;">[root@kube-master volumes]# kubectl get  rs nginx-rs</span></span>
<span class="line"><span style="color:#B392F0;">NAME</span><span style="color:#E1E4E8;">       </span><span style="color:#9ECBFF;">DESIRED</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">CURRENT</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">READY</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">AGE</span></span>
<span class="line"><span style="color:#B392F0;">nginx-rs</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">2</span><span style="color:#E1E4E8;">         </span><span style="color:#79B8FF;">2</span><span style="color:#E1E4E8;">         </span><span style="color:#79B8FF;">2</span><span style="color:#E1E4E8;">       </span><span style="color:#79B8FF;">85</span><span style="color:#9ECBFF;">s</span></span>
<span class="line"><span style="color:#6A737D;"># DESIRED:期望是2个Pod</span></span>
<span class="line"><span style="color:#6A737D;"># CURRENT:正常运行是2个</span></span>
<span class="line"><span style="color:#6A737D;"># READY: 正在运行是2个</span></span>
<span class="line"><span style="color:#6A737D;"># AGE:运行时间</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 如果我把某一个Pod删除以后，控制器是自己会创建Pod的。ReplicaSet会始终维持与我们所期望的副本数保持一致；</span></span>
<span class="line"><span style="color:#E1E4E8;">[root@kube-master volumes]# kubectl delete pods nginx-rs-hcxh9 </span></span>
<span class="line"><span style="color:#B392F0;">pod</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;nginx-rs-hcxh9&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">deleted</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 可以发现一个已经重建。或者通过describe来查看</span></span>
<span class="line"><span style="color:#E1E4E8;">[root@kube-master volumes]# kubectl get pods -l app=nginx-test</span></span>
<span class="line"><span style="color:#B392F0;">NAME</span><span style="color:#E1E4E8;">             </span><span style="color:#9ECBFF;">READY</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">STATUS</span><span style="color:#E1E4E8;">              </span><span style="color:#9ECBFF;">RESTARTS</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">AGE</span></span>
<span class="line"><span style="color:#B392F0;">nginx-rs-542db</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">1</span><span style="color:#9ECBFF;">/1</span><span style="color:#E1E4E8;">     </span><span style="color:#9ECBFF;">Running</span><span style="color:#E1E4E8;">             </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">          </span><span style="color:#79B8FF;">7</span><span style="color:#9ECBFF;">m32s</span></span>
<span class="line"><span style="color:#B392F0;">nginx-rs-n8995</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">1</span><span style="color:#9ECBFF;">/1</span><span style="color:#E1E4E8;">     </span><span style="color:#9ECBFF;">Running</span><span style="color:#E1E4E8;">             </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">          </span><span style="color:#79B8FF;">5</span><span style="color:#9ECBFF;">s</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 我们也可以通过describe RS来查看我们Pod被重建的信息，通过Events可以看到一个Pod被重建n8995；</span></span>
<span class="line"><span style="color:#E1E4E8;">[root@kube-master volumes]# kubectl describe rs nginx-rs</span></span>
<span class="line"><span style="color:#B392F0;">Name:</span><span style="color:#E1E4E8;">         </span><span style="color:#9ECBFF;">nginx-rs</span></span>
<span class="line"><span style="color:#B392F0;">Namespace:</span><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">default</span></span>
<span class="line"><span style="color:#B392F0;">Selector:</span><span style="color:#E1E4E8;">     </span><span style="color:#9ECBFF;">app=nginx-test</span></span>
<span class="line"><span style="color:#B392F0;">Labels:</span><span style="color:#E1E4E8;">       </span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">non</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span></span>
<span class="line"><span style="color:#B392F0;">Annotations:</span><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">non</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span></span>
<span class="line"><span style="color:#B392F0;">Replicas:</span><span style="color:#E1E4E8;">     </span><span style="color:#79B8FF;">2</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">current</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">desired</span></span>
<span class="line"><span style="color:#B392F0;">Pods</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Status:</span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">2</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Running</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Waiting</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Succeeded</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Failed</span></span>
<span class="line"><span style="color:#B392F0;">Pod</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Template:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">Labels:</span><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">app=nginx-test</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">Containers:</span></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#B392F0;">nginx:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">Image:</span><span style="color:#E1E4E8;">        </span><span style="color:#9ECBFF;">nginx</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">Port:</span><span style="color:#E1E4E8;">         </span><span style="color:#79B8FF;">80</span><span style="color:#9ECBFF;">/TCP</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">Host</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Port:</span><span style="color:#E1E4E8;">    </span><span style="color:#79B8FF;">0</span><span style="color:#9ECBFF;">/TCP</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">Environment:</span><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">non</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">Mounts:</span><span style="color:#E1E4E8;">       </span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">non</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">Volumes:</span><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">non</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span></span>
<span class="line"><span style="color:#B392F0;">Events:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">Type</span><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">Reason</span><span style="color:#E1E4E8;">            </span><span style="color:#9ECBFF;">Age</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">From</span><span style="color:#E1E4E8;">                   </span><span style="color:#9ECBFF;">Message</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">----</span><span style="color:#E1E4E8;">    </span><span style="color:#79B8FF;">------</span><span style="color:#E1E4E8;">            </span><span style="color:#79B8FF;">----</span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">----</span><span style="color:#E1E4E8;">                   </span><span style="color:#79B8FF;">-------</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">Normal</span><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">SuccessfulCreate</span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">56</span><span style="color:#9ECBFF;">m</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">replicaset-controller</span><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">Created</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pod:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">nginx-rs-542db</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">Normal</span><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">SuccessfulCreate</span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">56</span><span style="color:#9ECBFF;">m</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">replicaset-controller</span><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">Created</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pod:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">nginx-rs-hcxh9</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">Normal</span><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">SuccessfulCreate</span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">48</span><span style="color:#9ECBFF;">m</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">replicaset-controller</span><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">Created</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pod:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">nginx-rs-n8995</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;"># 创建Pod</span></span>
<span class="line"><span style="color:#24292E;">[root@kube-master volumes]# kubectl apply -f nginx-test-replicas.yaml </span></span>
<span class="line"><span style="color:#6F42C1;">replicaset.apps/nginx-rs</span><span style="color:#24292E;"> </span><span style="color:#032F62;">created</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 这两个副本都能提供服务且是相同的服务。</span></span>
<span class="line"><span style="color:#24292E;">[root@kube-master volumes]# kubectl get pods -l app=nginx-test</span></span>
<span class="line"><span style="color:#6F42C1;">NAME</span><span style="color:#24292E;">             </span><span style="color:#032F62;">READY</span><span style="color:#24292E;">   </span><span style="color:#032F62;">STATUS</span><span style="color:#24292E;">    </span><span style="color:#032F62;">RESTARTS</span><span style="color:#24292E;">   </span><span style="color:#032F62;">AGE</span></span>
<span class="line"><span style="color:#6F42C1;">nginx-rs-542db</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">1</span><span style="color:#032F62;">/1</span><span style="color:#24292E;">     </span><span style="color:#032F62;">Running</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">          </span><span style="color:#005CC5;">2</span><span style="color:#032F62;">m1s</span></span>
<span class="line"><span style="color:#6F42C1;">nginx-rs-hcxh9</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">1</span><span style="color:#032F62;">/1</span><span style="color:#24292E;">     </span><span style="color:#032F62;">Running</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">          </span><span style="color:#005CC5;">2</span><span style="color:#032F62;">m1s</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># ReplicaSet可以简写为rs，写replicaset或者rs都可以。</span></span>
<span class="line"><span style="color:#24292E;">[root@kube-master volumes]# kubectl get  rs nginx-rs</span></span>
<span class="line"><span style="color:#6F42C1;">NAME</span><span style="color:#24292E;">       </span><span style="color:#032F62;">DESIRED</span><span style="color:#24292E;">   </span><span style="color:#032F62;">CURRENT</span><span style="color:#24292E;">   </span><span style="color:#032F62;">READY</span><span style="color:#24292E;">   </span><span style="color:#032F62;">AGE</span></span>
<span class="line"><span style="color:#6F42C1;">nginx-rs</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">2</span><span style="color:#24292E;">         </span><span style="color:#005CC5;">2</span><span style="color:#24292E;">         </span><span style="color:#005CC5;">2</span><span style="color:#24292E;">       </span><span style="color:#005CC5;">85</span><span style="color:#032F62;">s</span></span>
<span class="line"><span style="color:#6A737D;"># DESIRED:期望是2个Pod</span></span>
<span class="line"><span style="color:#6A737D;"># CURRENT:正常运行是2个</span></span>
<span class="line"><span style="color:#6A737D;"># READY: 正在运行是2个</span></span>
<span class="line"><span style="color:#6A737D;"># AGE:运行时间</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 如果我把某一个Pod删除以后，控制器是自己会创建Pod的。ReplicaSet会始终维持与我们所期望的副本数保持一致；</span></span>
<span class="line"><span style="color:#24292E;">[root@kube-master volumes]# kubectl delete pods nginx-rs-hcxh9 </span></span>
<span class="line"><span style="color:#6F42C1;">pod</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;nginx-rs-hcxh9&quot;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">deleted</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 可以发现一个已经重建。或者通过describe来查看</span></span>
<span class="line"><span style="color:#24292E;">[root@kube-master volumes]# kubectl get pods -l app=nginx-test</span></span>
<span class="line"><span style="color:#6F42C1;">NAME</span><span style="color:#24292E;">             </span><span style="color:#032F62;">READY</span><span style="color:#24292E;">   </span><span style="color:#032F62;">STATUS</span><span style="color:#24292E;">              </span><span style="color:#032F62;">RESTARTS</span><span style="color:#24292E;">   </span><span style="color:#032F62;">AGE</span></span>
<span class="line"><span style="color:#6F42C1;">nginx-rs-542db</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">1</span><span style="color:#032F62;">/1</span><span style="color:#24292E;">     </span><span style="color:#032F62;">Running</span><span style="color:#24292E;">             </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">          </span><span style="color:#005CC5;">7</span><span style="color:#032F62;">m32s</span></span>
<span class="line"><span style="color:#6F42C1;">nginx-rs-n8995</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">1</span><span style="color:#032F62;">/1</span><span style="color:#24292E;">     </span><span style="color:#032F62;">Running</span><span style="color:#24292E;">             </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">          </span><span style="color:#005CC5;">5</span><span style="color:#032F62;">s</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;"># 我们也可以通过describe RS来查看我们Pod被重建的信息，通过Events可以看到一个Pod被重建n8995；</span></span>
<span class="line"><span style="color:#24292E;">[root@kube-master volumes]# kubectl describe rs nginx-rs</span></span>
<span class="line"><span style="color:#6F42C1;">Name:</span><span style="color:#24292E;">         </span><span style="color:#032F62;">nginx-rs</span></span>
<span class="line"><span style="color:#6F42C1;">Namespace:</span><span style="color:#24292E;">    </span><span style="color:#032F62;">default</span></span>
<span class="line"><span style="color:#6F42C1;">Selector:</span><span style="color:#24292E;">     </span><span style="color:#032F62;">app=nginx-test</span></span>
<span class="line"><span style="color:#6F42C1;">Labels:</span><span style="color:#24292E;">       </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">non</span><span style="color:#24292E;">e</span><span style="color:#D73A49;">&gt;</span></span>
<span class="line"><span style="color:#6F42C1;">Annotations:</span><span style="color:#24292E;">  </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">non</span><span style="color:#24292E;">e</span><span style="color:#D73A49;">&gt;</span></span>
<span class="line"><span style="color:#6F42C1;">Replicas:</span><span style="color:#24292E;">     </span><span style="color:#005CC5;">2</span><span style="color:#24292E;"> </span><span style="color:#032F62;">current</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2</span><span style="color:#24292E;"> </span><span style="color:#032F62;">desired</span></span>
<span class="line"><span style="color:#6F42C1;">Pods</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Status:</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">2</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Running</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Waiting</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Succeeded</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Failed</span></span>
<span class="line"><span style="color:#6F42C1;">Pod</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Template:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">Labels:</span><span style="color:#24292E;">  </span><span style="color:#032F62;">app=nginx-test</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">Containers:</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#6F42C1;">nginx:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">Image:</span><span style="color:#24292E;">        </span><span style="color:#032F62;">nginx</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">Port:</span><span style="color:#24292E;">         </span><span style="color:#005CC5;">80</span><span style="color:#032F62;">/TCP</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">Host</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Port:</span><span style="color:#24292E;">    </span><span style="color:#005CC5;">0</span><span style="color:#032F62;">/TCP</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">Environment:</span><span style="color:#24292E;">  </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">non</span><span style="color:#24292E;">e</span><span style="color:#D73A49;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">Mounts:</span><span style="color:#24292E;">       </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">non</span><span style="color:#24292E;">e</span><span style="color:#D73A49;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">Volumes:</span><span style="color:#24292E;">        </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">non</span><span style="color:#24292E;">e</span><span style="color:#D73A49;">&gt;</span></span>
<span class="line"><span style="color:#6F42C1;">Events:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">Type</span><span style="color:#24292E;">    </span><span style="color:#032F62;">Reason</span><span style="color:#24292E;">            </span><span style="color:#032F62;">Age</span><span style="color:#24292E;">   </span><span style="color:#032F62;">From</span><span style="color:#24292E;">                   </span><span style="color:#032F62;">Message</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">----</span><span style="color:#24292E;">    </span><span style="color:#005CC5;">------</span><span style="color:#24292E;">            </span><span style="color:#005CC5;">----</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">----</span><span style="color:#24292E;">                   </span><span style="color:#005CC5;">-------</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">Normal</span><span style="color:#24292E;">  </span><span style="color:#032F62;">SuccessfulCreate</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">56</span><span style="color:#032F62;">m</span><span style="color:#24292E;">   </span><span style="color:#032F62;">replicaset-controller</span><span style="color:#24292E;">  </span><span style="color:#032F62;">Created</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pod:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">nginx-rs-542db</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">Normal</span><span style="color:#24292E;">  </span><span style="color:#032F62;">SuccessfulCreate</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">56</span><span style="color:#032F62;">m</span><span style="color:#24292E;">   </span><span style="color:#032F62;">replicaset-controller</span><span style="color:#24292E;">  </span><span style="color:#032F62;">Created</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pod:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">nginx-rs-hcxh9</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">Normal</span><span style="color:#24292E;">  </span><span style="color:#032F62;">SuccessfulCreate</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">48</span><span style="color:#032F62;">m</span><span style="color:#24292E;">   </span><span style="color:#032F62;">replicaset-controller</span><span style="color:#24292E;">  </span><span style="color:#032F62;">Created</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pod:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">nginx-rs-n8995</span></span></code></pre></div><h2 id="_1-5-replica-set和replication-controller之间有什么区别" tabindex="-1">1.5 Replica Set和Replication Controller之间有什么区别？ <a class="header-anchor" href="#_1-5-replica-set和replication-controller之间有什么区别" aria-label="Permalink to &quot;1.5 Replica Set和Replication Controller之间有什么区别？&quot;">​</a></h2><p>在 Kubernetes (K8s) 中，Replica Set 和 Replication Controller（RC）都是用于确保集群中特定数量的 Pod 副本始终运行的服务。尽管它们有相似的功能，但在功能演变过程中，Replica Set 是对 Replication Controller 的改进和升级。</p><p><strong>Replication Controller (RC)</strong>：</p><ul><li>在早期版本的 Kubernetes 中被广泛使用。</li><li>使用的是基于等式的标签选择器（Equivalence-based selector），这意味着它只能匹配具有相同标签值的Pod。</li><li>对于复杂的选择器表达式支持有限。</li></ul><p><strong>Replica Set (RS)</strong>：</p><ul><li>自 Kubernetes v1.2 引入作为下一代副本控制器，并最终取代了 Replication Controller。</li><li>也负责保持指定数量的 Pod 副本数量不变，但使用了更强大的基于集合的标签选择器（Set-based selector）。</li><li>集合选择器允许用户设置更加灵活的匹配条件，例如通过标签键存在或不存在、标签键值的集合包含关系等。</li><li>因此，Replica Set 提供了更强的扩展性和控制能力，能够处理更复杂的场景下Pod的管理和扩展。</li></ul>`,29),e=[o];function c(t,r,E,y,i,F){return n(),a("div",null,e)}const m=s(p,[["render",c]]);export{C as __pageData,m as default};
