import{_ as s,o as a,c as n,R as l}from"./chunks/framework.zUbWieqp.js";const u=JSON.parse('{"title":"1.freeapi 介绍","description":"","frontmatter":{},"headers":[],"relativePath":"guide/Linux/vpn/13-freeipa_ldap.md","filePath":"guide/Linux/vpn/13-freeipa_ldap.md","lastUpdated":1701595065000}'),p={name:"guide/Linux/vpn/13-freeipa_ldap.md"},e=l(`<h1 id="_1-freeapi-介绍" tabindex="-1">1.freeapi 介绍 <a class="header-anchor" href="#_1-freeapi-介绍" aria-label="Permalink to &quot;1.freeapi 介绍&quot;">​</a></h1><p>FreeIPA是一个用于Linux/Unix环境的开源身份管理系统，它提供集中式帐户管理和身份验证，如Microsoft Active Directory或LDAP。FreeIPA集成389目录服务器、MIT Kerberos、Apache HTTP服务器、NTP、DNS、Dogtag(证书系统)和SSSD，使其成为管理标识、策略和执行审计跟踪的单一集成安全解决方案。FreeIPA支持通过Web UI和命令行工具来执行管理任务</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">主要功能包括：</span></span>
<span class="line"><span style="color:#e1e4e8;">身份识别: (机器、用户、虚拟机、组、身份验证凭据)</span></span>
<span class="line"><span style="color:#e1e4e8;">策略: (配置设置，访问控制信息)</span></span>
<span class="line"><span style="color:#e1e4e8;">审计跟踪: (事件、日志、分析)</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">主要功能包括：</span></span>
<span class="line"><span style="color:#24292e;">身份识别: (机器、用户、虚拟机、组、身份验证凭据)</span></span>
<span class="line"><span style="color:#24292e;">策略: (配置设置，访问控制信息)</span></span>
<span class="line"><span style="color:#24292e;">审计跟踪: (事件、日志、分析)</span></span></code></pre></div><h1 id="_2-安装" tabindex="-1">2.安装 <a class="header-anchor" href="#_2-安装" aria-label="Permalink to &quot;2.安装&quot;">​</a></h1><p><a href="https://github.com/freeipa/ansible-freeipa" target="_blank" rel="noreferrer">https://github.com/freeipa/ansible-freeipa</a></p><ul><li>注意</li><li>centos7</li></ul><ul><li>内存至少 1.5 G 以上。</li><li>Host 列请改为您自己的主机名。</li><li>本文都是以 root 用户进行操作，您可以使用其他有相应 sudo 权限的用户。</li><li>建议使用三级域名，如本例为 <code>corp.example.com</code> 因为 <code>example.com</code> 一般为公网使用。</li><li>本机 IP 的子网掩码不能是 <code>/32</code> (255.255.255.255), 至少是 <code>/24</code>(255.255.255.0) 或 <code>/16</code>(255.255.0.0)。</li><li>启动防火墙，因为 LDAP 是非常重要的服务，安全性很重要</li></ul><h2 id="防火墙" tabindex="-1">防火墙 <a class="header-anchor" href="#防火墙" aria-label="Permalink to &quot;防火墙&quot;">​</a></h2><p>FreeIPA可以选择关闭防火墙，或者打开防火墙需要使用的端口。如果防火墙关闭，则忽略该步剩下内容</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">firewall-cmd --permanent --add-port={80/tcp,443/tcp,389/tcp,636/tcp,88/tcp,464/tcp,53/tcp,88/udp,464/udp,53/udp,123/udp}</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">firewall-cmd --reload</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">#查看防火墙开放端口</span></span>
<span class="line"><span style="color:#e1e4e8;">firewall-cmd --zone=public --list-ports</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">firewall-cmd --permanent --add-port={80/tcp,443/tcp,389/tcp,636/tcp,88/tcp,464/tcp,53/tcp,88/udp,464/udp,53/udp,123/udp}</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">firewall-cmd --reload</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">#查看防火墙开放端口</span></span>
<span class="line"><span style="color:#24292e;">firewall-cmd --zone=public --list-ports</span></span></code></pre></div><h2 id="配置hosts文件" tabindex="-1"><strong>配置hosts文件</strong> <a class="header-anchor" href="#配置hosts文件" aria-label="Permalink to &quot;**配置hosts文件**&quot;">​</a></h2><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">#添加</span></span>
<span class="line"><span style="color:#e1e4e8;">[root@ipa openldap]# cat /etc/hosts</span></span>
<span class="line"><span style="color:#e1e4e8;">172.18.106.132 ipa.freehan.ink ipa</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">#添加</span></span>
<span class="line"><span style="color:#24292e;">[root@ipa openldap]# cat /etc/hosts</span></span>
<span class="line"><span style="color:#24292e;">172.18.106.132 ipa.freehan.ink ipa</span></span></code></pre></div><h2 id="配置随机数生成器" tabindex="-1"><strong>配置随机数生成器</strong> <a class="header-anchor" href="#配置随机数生成器" aria-label="Permalink to &quot;**配置随机数生成器**&quot;">​</a></h2><p>设置FreeIPA需要大量随机数据来运行它的加密操作。默认情况下，虚拟机将很快耗尽随机数据或熵。为了解决这个问题，我们将使用rngd软件随机数生成器。rngd通过从连接到其他服务器的硬件设备获取数据并将其提供给内核的随机数生成器来工作</p><div class="language-javascript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">yum </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">y install rng</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">tools</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">yum </span><span style="color:#D73A49;">-</span><span style="color:#24292E;">y install rng</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">tools</span></span></code></pre></div><p>启用</p><div class="language-javascript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">systemctl start rngd</span></span>
<span class="line"><span style="color:#E1E4E8;">systemctl enable rngd</span></span>
<span class="line"><span style="color:#E1E4E8;">systemctl status rngd</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">systemctl start rngd</span></span>
<span class="line"><span style="color:#24292E;">systemctl enable rngd</span></span>
<span class="line"><span style="color:#24292E;">systemctl status rngd</span></span></code></pre></div><h2 id="安装" tabindex="-1">安装 <a class="header-anchor" href="#安装" aria-label="Permalink to &quot;安装&quot;">​</a></h2><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">#安装ipa-server，也就是FreeIPA服务。如果不需要配置dns，也可以不安装ipa-server-dns包</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">[root@ipa ~]#yum -y install bind bind-utils bind-dyndb-ldap</span></span>
<span class="line"><span style="color:#e1e4e8;">[root@ipa ~]# yum -y install ipa-server ipa-server-dns</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">vi /etc/named.conf  -- 将以下两个参数改为 yes</span></span>
<span class="line"><span style="color:#e1e4e8;">dnssec-enable yes;</span></span>
<span class="line"><span style="color:#e1e4e8;">dnssec-validation yes;</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">[root@ipa ~]# ipa-server-install --allow-zone-overlap</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">The log file for this installation can be found in /var/log/ipaserver-install.log</span></span>
<span class="line"><span style="color:#e1e4e8;">==============================================================================</span></span>
<span class="line"><span style="color:#e1e4e8;">This program will set up the IPA Server.</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">This includes:</span></span>
<span class="line"><span style="color:#e1e4e8;">* Configure a stand-alone CA (dogtag) for certificate management</span></span>
<span class="line"><span style="color:#e1e4e8;">* Configure the Network Time Daemon (ntpd)</span></span>
<span class="line"><span style="color:#e1e4e8;">* Create and configure an instance of Directory Server</span></span>
<span class="line"><span style="color:#e1e4e8;">* Create and configure a Kerberos Key Distribution Center (KDC)</span></span>
<span class="line"><span style="color:#e1e4e8;">* Configure Apache (httpd)</span></span>
<span class="line"><span style="color:#e1e4e8;">* Configure the KDC to enable PKINIT</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">To accept the default shown in brackets, press the Enter key.</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">Do you want to configure integrated DNS (BIND)? [no]: no     ---&gt;用不到dns</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">Enter the fully qualified domain name of the computer</span></span>
<span class="line"><span style="color:#e1e4e8;">on which you&#39;re setting up server software. Using the form</span></span>
<span class="line"><span style="color:#e1e4e8;">&lt;hostname&gt;.&lt;domainname&gt;</span></span>
<span class="line"><span style="color:#e1e4e8;">Example: master.example.com.</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">Server host name [ipa.freehan.ink]: ipa.freehan.ink</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">Warning: skipping DNS resolution of host ipa.kclouder.local</span></span>
<span class="line"><span style="color:#e1e4e8;">The domain name has been determined based on the host name.</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">Please confirm the domain name [kclouder.local]: freehan.ink</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">The kerberos protocol requires a Realm name to be defined.</span></span>
<span class="line"><span style="color:#e1e4e8;">This is typically the domain name converted to uppercase.</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">-------------------------------------</span></span>
<span class="line"><span style="color:#e1e4e8;">警告：不要将您的根域（example.com）用作您的IPA域名。这可能会导致DNS问题</span></span>
<span class="line"><span style="color:#e1e4e8;">Server host name [ipa.example.org]: ipa.example.org</span></span>
<span class="line"><span style="color:#e1e4e8;">Please confirm the domain name [example.org]: ipa.example.org</span></span>
<span class="line"><span style="color:#e1e4e8;">Please provide a realm name [EXAMPLE.ORG]: IPA.EXAMPLE.ORG</span></span>
<span class="line"><span style="color:#e1e4e8;">-------------------------------------</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">Please provide a realm name [KCLOUDER.LOCAL]: FREEHAN.INK</span></span>
<span class="line"><span style="color:#e1e4e8;">Certain directory server operations require an administrative user.</span></span>
<span class="line"><span style="color:#e1e4e8;">This user is referred to as the Directory Manager and has full access</span></span>
<span class="line"><span style="color:#e1e4e8;">to the Directory for system management tasks and will be added to the</span></span>
<span class="line"><span style="color:#e1e4e8;">instance of directory server created for IPA.</span></span>
<span class="line"><span style="color:#e1e4e8;">The password must be at least 8 characters long.</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">Directory Manager password:    &lt;--输入密码（Directory manager password）</span></span>
<span class="line"><span style="color:#e1e4e8;">Password (confirm):    &lt;--输入密码（Directory manager password）</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">The IPA server requires an administrative user, named &#39;admin&#39;.</span></span>
<span class="line"><span style="color:#e1e4e8;">This user is a regular system account used for IPA server administration.</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">IPA admin password:    &lt;--输入密码（IPA Admin password）</span></span>
<span class="line"><span style="color:#e1e4e8;">Password (confirm):    &lt;--输入密码（IPA Admin password）</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">#安装ipa-server，也就是FreeIPA服务。如果不需要配置dns，也可以不安装ipa-server-dns包</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">[root@ipa ~]#yum -y install bind bind-utils bind-dyndb-ldap</span></span>
<span class="line"><span style="color:#24292e;">[root@ipa ~]# yum -y install ipa-server ipa-server-dns</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">vi /etc/named.conf  -- 将以下两个参数改为 yes</span></span>
<span class="line"><span style="color:#24292e;">dnssec-enable yes;</span></span>
<span class="line"><span style="color:#24292e;">dnssec-validation yes;</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">[root@ipa ~]# ipa-server-install --allow-zone-overlap</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">The log file for this installation can be found in /var/log/ipaserver-install.log</span></span>
<span class="line"><span style="color:#24292e;">==============================================================================</span></span>
<span class="line"><span style="color:#24292e;">This program will set up the IPA Server.</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">This includes:</span></span>
<span class="line"><span style="color:#24292e;">* Configure a stand-alone CA (dogtag) for certificate management</span></span>
<span class="line"><span style="color:#24292e;">* Configure the Network Time Daemon (ntpd)</span></span>
<span class="line"><span style="color:#24292e;">* Create and configure an instance of Directory Server</span></span>
<span class="line"><span style="color:#24292e;">* Create and configure a Kerberos Key Distribution Center (KDC)</span></span>
<span class="line"><span style="color:#24292e;">* Configure Apache (httpd)</span></span>
<span class="line"><span style="color:#24292e;">* Configure the KDC to enable PKINIT</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">To accept the default shown in brackets, press the Enter key.</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">Do you want to configure integrated DNS (BIND)? [no]: no     ---&gt;用不到dns</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">Enter the fully qualified domain name of the computer</span></span>
<span class="line"><span style="color:#24292e;">on which you&#39;re setting up server software. Using the form</span></span>
<span class="line"><span style="color:#24292e;">&lt;hostname&gt;.&lt;domainname&gt;</span></span>
<span class="line"><span style="color:#24292e;">Example: master.example.com.</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">Server host name [ipa.freehan.ink]: ipa.freehan.ink</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">Warning: skipping DNS resolution of host ipa.kclouder.local</span></span>
<span class="line"><span style="color:#24292e;">The domain name has been determined based on the host name.</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">Please confirm the domain name [kclouder.local]: freehan.ink</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">The kerberos protocol requires a Realm name to be defined.</span></span>
<span class="line"><span style="color:#24292e;">This is typically the domain name converted to uppercase.</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">-------------------------------------</span></span>
<span class="line"><span style="color:#24292e;">警告：不要将您的根域（example.com）用作您的IPA域名。这可能会导致DNS问题</span></span>
<span class="line"><span style="color:#24292e;">Server host name [ipa.example.org]: ipa.example.org</span></span>
<span class="line"><span style="color:#24292e;">Please confirm the domain name [example.org]: ipa.example.org</span></span>
<span class="line"><span style="color:#24292e;">Please provide a realm name [EXAMPLE.ORG]: IPA.EXAMPLE.ORG</span></span>
<span class="line"><span style="color:#24292e;">-------------------------------------</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">Please provide a realm name [KCLOUDER.LOCAL]: FREEHAN.INK</span></span>
<span class="line"><span style="color:#24292e;">Certain directory server operations require an administrative user.</span></span>
<span class="line"><span style="color:#24292e;">This user is referred to as the Directory Manager and has full access</span></span>
<span class="line"><span style="color:#24292e;">to the Directory for system management tasks and will be added to the</span></span>
<span class="line"><span style="color:#24292e;">instance of directory server created for IPA.</span></span>
<span class="line"><span style="color:#24292e;">The password must be at least 8 characters long.</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">Directory Manager password:    &lt;--输入密码（Directory manager password）</span></span>
<span class="line"><span style="color:#24292e;">Password (confirm):    &lt;--输入密码（Directory manager password）</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">The IPA server requires an administrative user, named &#39;admin&#39;.</span></span>
<span class="line"><span style="color:#24292e;">This user is a regular system account used for IPA server administration.</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">IPA admin password:    &lt;--输入密码（IPA Admin password）</span></span>
<span class="line"><span style="color:#24292e;">Password (confirm):    &lt;--输入密码（IPA Admin password）</span></span></code></pre></div><h2 id="状态" tabindex="-1">状态 <a class="header-anchor" href="#状态" aria-label="Permalink to &quot;状态&quot;">​</a></h2><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">[root@ipa openldap]# ipactl status</span></span>
<span class="line"><span style="color:#e1e4e8;">Directory Service: RUNNING</span></span>
<span class="line"><span style="color:#e1e4e8;">krb5kdc Service: RUNNING</span></span>
<span class="line"><span style="color:#e1e4e8;">kadmin Service: RUNNING</span></span>
<span class="line"><span style="color:#e1e4e8;">httpd Service: RUNNING</span></span>
<span class="line"><span style="color:#e1e4e8;">ipa-custodia Service: RUNNING</span></span>
<span class="line"><span style="color:#e1e4e8;">ntpd Service: RUNNING</span></span>
<span class="line"><span style="color:#e1e4e8;">pki-tomcatd Service: RUNNING</span></span>
<span class="line"><span style="color:#e1e4e8;">ipa-otpd Service: RUNNING</span></span>
<span class="line"><span style="color:#e1e4e8;">ipa: INFO: The ipactl command was successful</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">[root@ipa openldap]# ipactl status</span></span>
<span class="line"><span style="color:#24292e;">Directory Service: RUNNING</span></span>
<span class="line"><span style="color:#24292e;">krb5kdc Service: RUNNING</span></span>
<span class="line"><span style="color:#24292e;">kadmin Service: RUNNING</span></span>
<span class="line"><span style="color:#24292e;">httpd Service: RUNNING</span></span>
<span class="line"><span style="color:#24292e;">ipa-custodia Service: RUNNING</span></span>
<span class="line"><span style="color:#24292e;">ntpd Service: RUNNING</span></span>
<span class="line"><span style="color:#24292e;">pki-tomcatd Service: RUNNING</span></span>
<span class="line"><span style="color:#24292e;">ipa-otpd Service: RUNNING</span></span>
<span class="line"><span style="color:#24292e;">ipa: INFO: The ipactl command was successful</span></span></code></pre></div><h2 id="验证freeipa服务功能" tabindex="-1"><strong>验证FreeIPA服务功能</strong> <a class="header-anchor" href="#验证freeipa服务功能" aria-label="Permalink to &quot;**验证FreeIPA服务功能**&quot;">​</a></h2><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">#通过尝试为admin用户初始化Kerberos令牌来验证Kerberos域是否已正确安装</span></span>
<span class="line"><span style="color:#e1e4e8;">[root@ipa openldap]# kinit admin</span></span>
<span class="line"><span style="color:#e1e4e8;">Password for admin@FREEHAN.INK: 输入admin密码</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">[root@ipa openldap]# klist </span></span>
<span class="line"><span style="color:#e1e4e8;">Ticket cache: KEYRING:persistent:0:0</span></span>
<span class="line"><span style="color:#e1e4e8;">Default principal: admin@FREEHAN.INK</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">Valid starting       Expires              Service principal</span></span>
<span class="line"><span style="color:#e1e4e8;">11/25/2021 16:19:35  11/26/2021 16:19:32  krbtgt/FREEHAN.INK@FREEHAN.INK</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">#验证IPA服务器是否正常运行</span></span>
<span class="line"><span style="color:#e1e4e8;">[root@ipa openldap]# ipa user-find admin</span></span>
<span class="line"><span style="color:#e1e4e8;">--------------</span></span>
<span class="line"><span style="color:#e1e4e8;">1 user matched</span></span>
<span class="line"><span style="color:#e1e4e8;">--------------</span></span>
<span class="line"><span style="color:#e1e4e8;">  User login: admin</span></span>
<span class="line"><span style="color:#e1e4e8;">  Last name: Administrator</span></span>
<span class="line"><span style="color:#e1e4e8;">  Home directory: /home/admin</span></span>
<span class="line"><span style="color:#e1e4e8;">  Login shell: /bin/bash</span></span>
<span class="line"><span style="color:#e1e4e8;">  Principal alias: admin@FREEHAN.INK</span></span>
<span class="line"><span style="color:#e1e4e8;">  UID: 428200000</span></span>
<span class="line"><span style="color:#e1e4e8;">  GID: 428200000</span></span>
<span class="line"><span style="color:#e1e4e8;">  Account disabled: False</span></span>
<span class="line"><span style="color:#e1e4e8;">----------------------------</span></span>
<span class="line"><span style="color:#e1e4e8;">Number of entries returned 1</span></span>
<span class="line"><span style="color:#e1e4e8;">----------------------------</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">#通过尝试为admin用户初始化Kerberos令牌来验证Kerberos域是否已正确安装</span></span>
<span class="line"><span style="color:#24292e;">[root@ipa openldap]# kinit admin</span></span>
<span class="line"><span style="color:#24292e;">Password for admin@FREEHAN.INK: 输入admin密码</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">[root@ipa openldap]# klist </span></span>
<span class="line"><span style="color:#24292e;">Ticket cache: KEYRING:persistent:0:0</span></span>
<span class="line"><span style="color:#24292e;">Default principal: admin@FREEHAN.INK</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">Valid starting       Expires              Service principal</span></span>
<span class="line"><span style="color:#24292e;">11/25/2021 16:19:35  11/26/2021 16:19:32  krbtgt/FREEHAN.INK@FREEHAN.INK</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">#验证IPA服务器是否正常运行</span></span>
<span class="line"><span style="color:#24292e;">[root@ipa openldap]# ipa user-find admin</span></span>
<span class="line"><span style="color:#24292e;">--------------</span></span>
<span class="line"><span style="color:#24292e;">1 user matched</span></span>
<span class="line"><span style="color:#24292e;">--------------</span></span>
<span class="line"><span style="color:#24292e;">  User login: admin</span></span>
<span class="line"><span style="color:#24292e;">  Last name: Administrator</span></span>
<span class="line"><span style="color:#24292e;">  Home directory: /home/admin</span></span>
<span class="line"><span style="color:#24292e;">  Login shell: /bin/bash</span></span>
<span class="line"><span style="color:#24292e;">  Principal alias: admin@FREEHAN.INK</span></span>
<span class="line"><span style="color:#24292e;">  UID: 428200000</span></span>
<span class="line"><span style="color:#24292e;">  GID: 428200000</span></span>
<span class="line"><span style="color:#24292e;">  Account disabled: False</span></span>
<span class="line"><span style="color:#24292e;">----------------------------</span></span>
<span class="line"><span style="color:#24292e;">Number of entries returned 1</span></span>
<span class="line"><span style="color:#24292e;">----------------------------</span></span></code></pre></div><h2 id="dns说明" tabindex="-1"><strong>DNS说明</strong> <a class="header-anchor" href="#dns说明" aria-label="Permalink to &quot;**DNS说明**&quot;">​</a></h2><p>DNS用于机器名解析，如果安装FreeIPA双机（即主从Server），那就需要DNS 原因：我们需要执行类似于如下的命令：</p><div class="language-javascript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">ipa</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">replica</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">prepare hadoop197.example.com </span><span style="color:#F97583;">--</span><span style="color:#E1E4E8;">ip</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">address </span><span style="color:#79B8FF;">192.168</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">116.197</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">ipa</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">replica</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">prepare hadoop197.example.com </span><span style="color:#D73A49;">--</span><span style="color:#24292E;">ip</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">address </span><span style="color:#005CC5;">192.168</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">116.197</span></span></code></pre></div><p>此时它就会去DNS上面的解析，找不到，就直接报错。此时就导致从节点无法安装。如果我们只安装freeipa的单节点，就可以不使用DNS</p><h2 id="登录web界面" tabindex="-1">登录web界面 <a class="header-anchor" href="#登录web界面" aria-label="Permalink to &quot;登录web界面&quot;">​</a></h2><p><img src="https://nnaigos.oss-cn-hangzhou.aliyuncs.com/imgs/202310201037417.jpg" alt=""></p><p><img src="https://nnaigos.oss-cn-hangzhou.aliyuncs.com/imgs/202310201037317.jpg" alt=""></p><h2 id="更换证书ssl" tabindex="-1">更换证书ssl <a class="header-anchor" href="#更换证书ssl" aria-label="Permalink to &quot;更换证书ssl&quot;">​</a></h2><p>一般有 3 个文件</p><ul><li>ca.crt（CA 证书）</li><li>your_domain.crt（域名的公钥证书）</li><li>your_domain.key（域名的私钥证书）</li></ul><p>通过如下命令配置，这个命令不会将密码保存到 shell 的历史中，更安全。</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;"># ipa-cacert-manage -p your_directory_manager_password -n httpcrt -t C,, install ca.crt</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;"># ipa-cacert-manage -p your_directory_manager_password -n httpcrt -t C,, install ca.crt</span></span></code></pre></div><p>更新证书到数据库</p><div class="language-text vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">text</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">ipa-certupdate</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">ipa-certupdate</span></span></code></pre></div><p>安装站点的公钥和私钥</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;"># ipa-server-certinstall -w -d your_domain.key your_domain.crt</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;"># ipa-server-certinstall -w -d your_domain.key your_domain.crt</span></span></code></pre></div><p>重启服务</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">sysmtemctl restart ipa</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">sysmtemctl restart ipa</span></span></code></pre></div><h1 id="_2-用户管理" tabindex="-1">2.用户管理 <a class="header-anchor" href="#_2-用户管理" aria-label="Permalink to &quot;2.用户管理&quot;">​</a></h1><h2 id="配置ipa用户" tabindex="-1"><strong>配置IPA用户</strong> <a class="header-anchor" href="#配置ipa用户" aria-label="Permalink to &quot;**配置IPA用户**&quot;">​</a></h2><p>FreeIPA拥有非常广泛的用户管理和策略功能。与标准Unix用户类似，FreeIPA用户可以属于组。可以允许或拒绝组或个人用户基于策略访问主机（客户端计算机）或主机组（主机组）。FreeIPA还可以管理sudo访问，可以在主机或主机组上授予组或用户sudo访问权限</p><p>要添加用户，请单击“ <strong>标识”<strong>选项卡，然后单击“<strong>用户”</strong>。这将显示一个用户表。单击表格上方的</strong>+添加</strong>按钮以添加新用户。在打开的表单中填写必填字段（如名字和姓氏），然后单击<strong>添加</strong>以按原样添加用户或<strong>添加和编辑</strong>以配置高级详细信息。</p><p>单击原始表中的用户也可以访问高级详细信息。这是管理员在查看用户详细信息时看到的内容</p><p><img src="https://nnaigos.oss-cn-hangzhou.aliyuncs.com/imgs/202310201037589.jpg" alt=""></p><p>普通用户也可以登录IPA GUI。他们将能够查看自己的权限并编辑个人详细信息。</p><p>首次登录IPA计算机时，系统会要求新用户更改密码。这适用于IPA GUI以及SSH。IPA可以添加添加SSH密钥的能力。用户可以上传他们的公共SSH密钥并将它们传播到IPA机器，允许无密码登录。然后，用户可以随时删除SSH密钥，无需担心它仍存在于各个服务器上。</p><p>通过列表添加用户帐户和列出帐户进行测试</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">[root@ipa openldap]# ipa user-add jmumr  --first=Josphatmr --last=Mutaimr --email=jmutai@computingforgeeks.com  --shell=/bin/bash --password</span></span>
<span class="line"><span style="color:#e1e4e8;">Password: </span></span>
<span class="line"><span style="color:#e1e4e8;">Enter Password again to verify: </span></span>
<span class="line"><span style="color:#e1e4e8;">------------------</span></span>
<span class="line"><span style="color:#e1e4e8;">Added user &quot;jmumr&quot;</span></span>
<span class="line"><span style="color:#e1e4e8;">------------------</span></span>
<span class="line"><span style="color:#e1e4e8;">  User login: jmumr</span></span>
<span class="line"><span style="color:#e1e4e8;">  First name: Josphatmr</span></span>
<span class="line"><span style="color:#e1e4e8;">  Last name: Mutaimr</span></span>
<span class="line"><span style="color:#e1e4e8;">  Full name: Josphatmr Mutaimr</span></span>
<span class="line"><span style="color:#e1e4e8;">  Display name: Josphatmr Mutaimr</span></span>
<span class="line"><span style="color:#e1e4e8;">  Initials: JM</span></span>
<span class="line"><span style="color:#e1e4e8;">  Home directory: /home/jmumr</span></span>
<span class="line"><span style="color:#e1e4e8;">  GECOS: Josphatmr Mutaimr</span></span>
<span class="line"><span style="color:#e1e4e8;">  Login shell: /bin/bash</span></span>
<span class="line"><span style="color:#e1e4e8;">  Principal name: jmumr@FREEHAN.INK</span></span>
<span class="line"><span style="color:#e1e4e8;">  Principal alias: jmumr@FREEHAN.INK</span></span>
<span class="line"><span style="color:#e1e4e8;">  User password expiration: 20211125084700Z</span></span>
<span class="line"><span style="color:#e1e4e8;">  Email address: jmutai@computingforgeeks.com</span></span>
<span class="line"><span style="color:#e1e4e8;">  UID: 428200003</span></span>
<span class="line"><span style="color:#e1e4e8;">  GID: 428200003</span></span>
<span class="line"><span style="color:#e1e4e8;">  Password: True</span></span>
<span class="line"><span style="color:#e1e4e8;">  Member of groups: ipausers</span></span>
<span class="line"><span style="color:#e1e4e8;">  Kerberos keys available: True</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">[root@ipa openldap]# ipa user-add jmumr  --first=Josphatmr --last=Mutaimr --email=jmutai@computingforgeeks.com  --shell=/bin/bash --password</span></span>
<span class="line"><span style="color:#24292e;">Password: </span></span>
<span class="line"><span style="color:#24292e;">Enter Password again to verify: </span></span>
<span class="line"><span style="color:#24292e;">------------------</span></span>
<span class="line"><span style="color:#24292e;">Added user &quot;jmumr&quot;</span></span>
<span class="line"><span style="color:#24292e;">------------------</span></span>
<span class="line"><span style="color:#24292e;">  User login: jmumr</span></span>
<span class="line"><span style="color:#24292e;">  First name: Josphatmr</span></span>
<span class="line"><span style="color:#24292e;">  Last name: Mutaimr</span></span>
<span class="line"><span style="color:#24292e;">  Full name: Josphatmr Mutaimr</span></span>
<span class="line"><span style="color:#24292e;">  Display name: Josphatmr Mutaimr</span></span>
<span class="line"><span style="color:#24292e;">  Initials: JM</span></span>
<span class="line"><span style="color:#24292e;">  Home directory: /home/jmumr</span></span>
<span class="line"><span style="color:#24292e;">  GECOS: Josphatmr Mutaimr</span></span>
<span class="line"><span style="color:#24292e;">  Login shell: /bin/bash</span></span>
<span class="line"><span style="color:#24292e;">  Principal name: jmumr@FREEHAN.INK</span></span>
<span class="line"><span style="color:#24292e;">  Principal alias: jmumr@FREEHAN.INK</span></span>
<span class="line"><span style="color:#24292e;">  User password expiration: 20211125084700Z</span></span>
<span class="line"><span style="color:#24292e;">  Email address: jmutai@computingforgeeks.com</span></span>
<span class="line"><span style="color:#24292e;">  UID: 428200003</span></span>
<span class="line"><span style="color:#24292e;">  GID: 428200003</span></span>
<span class="line"><span style="color:#24292e;">  Password: True</span></span>
<span class="line"><span style="color:#24292e;">  Member of groups: ipausers</span></span>
<span class="line"><span style="color:#24292e;">  Kerberos keys available: True</span></span></code></pre></div><ul><li>web界面查看</li></ul><p><img src="https://nnaigos.oss-cn-hangzhou.aliyuncs.com/imgs/202310201037873.jpg" alt=""></p><h2 id="过滤用户" tabindex="-1">过滤用户 <a class="header-anchor" href="#过滤用户" aria-label="Permalink to &quot;过滤用户&quot;">​</a></h2><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">[root@ipa openldap]# ipa user-find |grep User |awk -F&#39;:&#39; &#39;{print $2}&#39;</span></span>
<span class="line"><span style="color:#e1e4e8;"> admin</span></span>
<span class="line"><span style="color:#e1e4e8;"> jmumr</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">[root@ipa openldap]# ipa user-find |grep User |awk -F&#39;:&#39; &#39;{print $2}&#39;</span></span>
<span class="line"><span style="color:#24292e;"> admin</span></span>
<span class="line"><span style="color:#24292e;"> jmumr</span></span></code></pre></div><h2 id="设置otp" tabindex="-1">设置otp <a class="header-anchor" href="#设置otp" aria-label="Permalink to &quot;设置otp&quot;">​</a></h2><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;"></span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;"></span></span></code></pre></div><h1 id="_3-安装client端" tabindex="-1">3.安装client端 <a class="header-anchor" href="#_3-安装client端" aria-label="Permalink to &quot;3.安装client端&quot;">​</a></h1><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">FreeIPA的客户端软件</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">yum -y install ipa-client ntp</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">FreeIPA的客户端软件</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">yum -y install ipa-client ntp</span></span></code></pre></div><h2 id="执行客户端安装" tabindex="-1"><strong>执行客户端安装</strong> <a class="header-anchor" href="#执行客户端安装" aria-label="Permalink to &quot;**执行客户端安装**&quot;">​</a></h2><p>客户端安装有两种方式，交互式和非交互式</p><h3 id="非交互式安装" tabindex="-1"><strong>非交互式安装</strong> <a class="header-anchor" href="#非交互式安装" aria-label="Permalink to &quot;**非交互式安装**&quot;">​</a></h3><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">[root@ipa112 ~]# ipa-client-install --domain=example.com --realm=EXAMPLE.COM --principal=admin@EXAMPLE.COM --password=hadoop123 --enable-dns-updates --permit --no-ntp</span></span>
<span class="line"><span style="color:#e1e4e8;">Provide your IPA server name (ex:ipa.example.com): ipa110.example.com  --输入ipaserver,需要注意后面一定不要带空格，否则就会抛出异常</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">[root@ipa112 ~]# ipa-client-install --domain=example.com --realm=EXAMPLE.COM --principal=admin@EXAMPLE.COM --password=hadoop123 --enable-dns-updates --permit --no-ntp</span></span>
<span class="line"><span style="color:#24292e;">Provide your IPA server name (ex:ipa.example.com): ipa110.example.com  --输入ipaserver,需要注意后面一定不要带空格，否则就会抛出异常</span></span></code></pre></div><h3 id="交互式安装" tabindex="-1"><strong>交互式安装</strong> <a class="header-anchor" href="#交互式安装" aria-label="Permalink to &quot;**交互式安装**&quot;">​</a></h3><p>执行下列的命令来执行安装</p><div class="language-javascript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">ipa</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">client</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">install</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">ipa</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">client</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">install</span></span></code></pre></div><p>开始安装：</p><div class="language-javascript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">[root@ipa </span><span style="color:#F97583;">~</span><span style="color:#E1E4E8;">]#ipa</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">client</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">install</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">WARNING</span><span style="color:#E1E4E8;">: ntpd time</span><span style="color:#F97583;">&amp;</span><span style="color:#E1E4E8;">date synchronizationservice will not be configured </span><span style="color:#F97583;">as</span></span>
<span class="line"><span style="color:#E1E4E8;">conflicting </span><span style="color:#B392F0;">service</span><span style="color:#E1E4E8;"> (chronyd) is enabled</span></span>
<span class="line"><span style="color:#E1E4E8;">Use </span><span style="color:#F97583;">--</span><span style="color:#E1E4E8;">force</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">ntpd option to disable it and forceconfiguration </span><span style="color:#F97583;">of</span><span style="color:#E1E4E8;"> ntpd</span></span>
<span class="line"><span style="color:#E1E4E8;"> </span></span>
<span class="line"></span>
<span class="line"><span style="color:#79B8FF;">DNS</span><span style="color:#E1E4E8;"> discovery failed to determine your </span><span style="color:#79B8FF;">DNS</span><span style="color:#E1E4E8;"> domain</span></span>
<span class="line"><span style="color:#E1E4E8;">Provide the domain name ofyour </span><span style="color:#79B8FF;">IPA</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">server</span><span style="color:#E1E4E8;"> (ex: example.com): gce.cloudera.com</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">Provide your </span><span style="color:#79B8FF;">IPA</span><span style="color:#E1E4E8;"> server </span><span style="color:#B392F0;">name</span><span style="color:#E1E4E8;">(ex: ipa.example.com): wang</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">1.gce.cloudera.com</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">The failure to use </span><span style="color:#79B8FF;">DNS</span><span style="color:#E1E4E8;"> to find your </span><span style="color:#79B8FF;">IPA</span><span style="color:#E1E4E8;"> serverindicates that your resolv.conf file is not properly configured.</span></span>
<span class="line"><span style="color:#E1E4E8;">Autodiscovery </span><span style="color:#F97583;">of</span><span style="color:#E1E4E8;"> servers for failover cannot workwith </span><span style="color:#79B8FF;">this</span><span style="color:#E1E4E8;"> configuration.</span></span>
<span class="line"><span style="color:#E1E4E8;">If you proceed </span><span style="color:#F97583;">with</span><span style="color:#E1E4E8;"> the installation, serviceswill be configured to always access the discovered server for all operationsand will not fail over to other servers </span><span style="color:#F97583;">in</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">case</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">of</span><span style="color:#E1E4E8;"> failure.</span></span>
<span class="line"><span style="color:#E1E4E8;">Proceed </span><span style="color:#F97583;">with</span><span style="color:#E1E4E8;"> fixed values andno </span><span style="color:#79B8FF;">DNS</span><span style="color:#E1E4E8;"> discovery</span><span style="color:#F97583;">?</span><span style="color:#E1E4E8;"> [no]</span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;"> yes</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">Client </span><span style="color:#B392F0;">hostname</span><span style="color:#E1E4E8;">: wang</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">2.gce.cloudera.com</span></span>
<span class="line"><span style="color:#B392F0;">Realm</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">GCE</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">CLOUDERA</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">COM</span></span>
<span class="line"><span style="color:#79B8FF;">DNS</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Domain</span><span style="color:#E1E4E8;">: gce.cloudera.com</span></span>
<span class="line"><span style="color:#79B8FF;">IPA</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Server</span><span style="color:#E1E4E8;">: wang</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">1.gce.cloudera.com</span></span>
<span class="line"><span style="color:#B392F0;">BaseDN</span><span style="color:#E1E4E8;">: dc</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">gce,dc</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">cloudera,dc</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">com</span></span>
<span class="line"><span style="color:#E1E4E8;"> </span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">Continue to configure thesystem </span><span style="color:#F97583;">with</span><span style="color:#E1E4E8;"> these values</span><span style="color:#F97583;">?</span><span style="color:#E1E4E8;"> [no]</span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;"> yes</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">Skipping synchronizing time </span><span style="color:#F97583;">with</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">NTP</span><span style="color:#E1E4E8;"> server.</span></span>
<span class="line"><span style="color:#E1E4E8;">User authorized to enroll </span><span style="color:#B392F0;">computers</span><span style="color:#E1E4E8;">: admin</span></span>
<span class="line"><span style="color:#E1E4E8;">Password for admin@</span><span style="color:#79B8FF;">GCE</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">CLOUDERA</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">COM</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">Successfully retrieved </span><span style="color:#79B8FF;">CA</span><span style="color:#E1E4E8;"> cert</span></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#B392F0;">Subject</span><span style="color:#E1E4E8;">:     </span><span style="color:#79B8FF;">CN</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">CertificateAuthority,</span><span style="color:#79B8FF;">O</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">GCE</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">CLOUDERA</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">COM</span></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#B392F0;">Issuer</span><span style="color:#E1E4E8;">:      </span><span style="color:#79B8FF;">CN</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">CertificateAuthority,</span><span style="color:#79B8FF;">O</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">GCE</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">CLOUDERA</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">COM</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">ValidFrom</span><span style="color:#E1E4E8;">:  </span><span style="color:#79B8FF;">2019</span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">08</span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">11</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">13</span><span style="color:#E1E4E8;">:</span><span style="color:#79B8FF;">44</span><span style="color:#E1E4E8;">:</span><span style="color:#79B8FF;">00</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">ValidUntil</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">2039</span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">08</span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">11</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">13</span><span style="color:#E1E4E8;">:</span><span style="color:#79B8FF;">44</span><span style="color:#E1E4E8;">:</span><span style="color:#79B8FF;">00</span></span>
<span class="line"><span style="color:#E1E4E8;"> </span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">Enrolled </span><span style="color:#F97583;">in</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">IPA</span><span style="color:#E1E4E8;"> realm </span><span style="color:#79B8FF;">GCE</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">CLOUDERA</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">COM</span></span>
<span class="line"><span style="color:#E1E4E8;">Created </span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">etc</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">ipa</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">default.conf</span></span>
<span class="line"><span style="color:#E1E4E8;">New </span><span style="color:#79B8FF;">SSSD</span><span style="color:#E1E4E8;"> config will be created</span></span>
<span class="line"><span style="color:#E1E4E8;">Configured sudoers </span><span style="color:#F97583;">in</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">etc</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">nsswitch.conf</span></span>
<span class="line"><span style="color:#E1E4E8;">Configured </span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">etc</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">sssd</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">sssd.conf</span></span>
<span class="line"><span style="color:#E1E4E8;">Configured </span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">etc</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">krb5.conf for </span><span style="color:#79B8FF;">IPA</span><span style="color:#E1E4E8;"> realmGCE.</span><span style="color:#79B8FF;">CLOUDERA</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">COM</span></span>
<span class="line"><span style="color:#E1E4E8;">trying </span><span style="color:#B392F0;">https</span><span style="color:#E1E4E8;">:</span><span style="color:#6A737D;">//wang-1.gce.cloudera.com/ipa/json</span></span>
<span class="line"><span style="color:#E1E4E8;">[try </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">]: Forwarding </span><span style="color:#9ECBFF;">&#39;schema&#39;</span><span style="color:#E1E4E8;"> to json server</span><span style="color:#9ECBFF;">&#39;https://wang-1.gce.cloudera.com/ipa/json&#39;</span></span>
<span class="line"><span style="color:#E1E4E8;">trying </span><span style="color:#B392F0;">https</span><span style="color:#E1E4E8;">:</span><span style="color:#6A737D;">//wang-1.gce.cloudera.com/ipa/session/json</span></span>
<span class="line"><span style="color:#E1E4E8;">[try </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">]: Forwarding </span><span style="color:#9ECBFF;">&#39;ping&#39;</span><span style="color:#E1E4E8;"> to json server</span><span style="color:#9ECBFF;">&#39;https://wang-1.gce.cloudera.com/ipa/session/json&#39;</span></span>
<span class="line"><span style="color:#E1E4E8;">[try </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">]: Forwarding </span><span style="color:#9ECBFF;">&#39;ca_is_enabled&#39;</span><span style="color:#E1E4E8;"> to json server</span><span style="color:#9ECBFF;">&#39;https://wang-1.gce.cloudera.com/ipa/session/json&#39;</span></span>
<span class="line"><span style="color:#E1E4E8;">Systemwide </span><span style="color:#79B8FF;">CA</span><span style="color:#E1E4E8;"> database updated.</span></span>
<span class="line"><span style="color:#E1E4E8;">Adding </span><span style="color:#79B8FF;">SSH</span><span style="color:#E1E4E8;"> public key from</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">etc</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">ssh</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">ssh_host_rsa_key.pub</span></span>
<span class="line"><span style="color:#E1E4E8;">Adding </span><span style="color:#79B8FF;">SSH</span><span style="color:#E1E4E8;"> public key from</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">etc</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">ssh</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">ssh_host_ecdsa_key.pub</span></span>
<span class="line"><span style="color:#E1E4E8;">Adding </span><span style="color:#79B8FF;">SSH</span><span style="color:#E1E4E8;"> public key from</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">etc</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">ssh</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">ssh_host_ed25519_key.pub</span></span>
<span class="line"><span style="color:#E1E4E8;">[try </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">]: Forwarding </span><span style="color:#9ECBFF;">&#39;host_mod&#39;</span><span style="color:#E1E4E8;"> to json server</span><span style="color:#9ECBFF;">&#39;https://wang-1.gce.cloudera.com/ipa/session/json&#39;</span></span>
<span class="line"><span style="color:#E1E4E8;">Could not update </span><span style="color:#79B8FF;">DNS</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">SSHFP</span><span style="color:#E1E4E8;"> records.</span></span>
<span class="line"><span style="color:#79B8FF;">SSSD</span><span style="color:#E1E4E8;"> enabled</span></span>
<span class="line"><span style="color:#E1E4E8;">Configured </span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">etc</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">openldap</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">ldap.conf</span></span>
<span class="line"><span style="color:#E1E4E8;">Configured </span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">etc</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">ssh</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">ssh_config</span></span>
<span class="line"><span style="color:#E1E4E8;">Configured </span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">etc</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">ssh</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">sshd_config</span></span>
<span class="line"><span style="color:#E1E4E8;">Configuring gce.cloudera.com </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">NIS</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">domain</span><span style="color:#E1E4E8;">.</span></span>
<span class="line"><span style="color:#E1E4E8;">Client configuration complete.</span></span>
<span class="line"><span style="color:#E1E4E8;">The ipa</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">client</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">install command was successful</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">[root@ipa </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]#ipa</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">client</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">install</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">WARNING</span><span style="color:#24292E;">: ntpd time</span><span style="color:#D73A49;">&amp;</span><span style="color:#24292E;">date synchronizationservice will not be configured </span><span style="color:#D73A49;">as</span></span>
<span class="line"><span style="color:#24292E;">conflicting </span><span style="color:#6F42C1;">service</span><span style="color:#24292E;"> (chronyd) is enabled</span></span>
<span class="line"><span style="color:#24292E;">Use </span><span style="color:#D73A49;">--</span><span style="color:#24292E;">force</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">ntpd option to disable it and forceconfiguration </span><span style="color:#D73A49;">of</span><span style="color:#24292E;"> ntpd</span></span>
<span class="line"><span style="color:#24292E;"> </span></span>
<span class="line"></span>
<span class="line"><span style="color:#005CC5;">DNS</span><span style="color:#24292E;"> discovery failed to determine your </span><span style="color:#005CC5;">DNS</span><span style="color:#24292E;"> domain</span></span>
<span class="line"><span style="color:#24292E;">Provide the domain name ofyour </span><span style="color:#005CC5;">IPA</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">server</span><span style="color:#24292E;"> (ex: example.com): gce.cloudera.com</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">Provide your </span><span style="color:#005CC5;">IPA</span><span style="color:#24292E;"> server </span><span style="color:#6F42C1;">name</span><span style="color:#24292E;">(ex: ipa.example.com): wang</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">1.gce.cloudera.com</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">The failure to use </span><span style="color:#005CC5;">DNS</span><span style="color:#24292E;"> to find your </span><span style="color:#005CC5;">IPA</span><span style="color:#24292E;"> serverindicates that your resolv.conf file is not properly configured.</span></span>
<span class="line"><span style="color:#24292E;">Autodiscovery </span><span style="color:#D73A49;">of</span><span style="color:#24292E;"> servers for failover cannot workwith </span><span style="color:#005CC5;">this</span><span style="color:#24292E;"> configuration.</span></span>
<span class="line"><span style="color:#24292E;">If you proceed </span><span style="color:#D73A49;">with</span><span style="color:#24292E;"> the installation, serviceswill be configured to always access the discovered server for all operationsand will not fail over to other servers </span><span style="color:#D73A49;">in</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">case</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">of</span><span style="color:#24292E;"> failure.</span></span>
<span class="line"><span style="color:#24292E;">Proceed </span><span style="color:#D73A49;">with</span><span style="color:#24292E;"> fixed values andno </span><span style="color:#005CC5;">DNS</span><span style="color:#24292E;"> discovery</span><span style="color:#D73A49;">?</span><span style="color:#24292E;"> [no]</span><span style="color:#D73A49;">:</span><span style="color:#24292E;"> yes</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">Client </span><span style="color:#6F42C1;">hostname</span><span style="color:#24292E;">: wang</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">2.gce.cloudera.com</span></span>
<span class="line"><span style="color:#6F42C1;">Realm</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">GCE</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">CLOUDERA</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">COM</span></span>
<span class="line"><span style="color:#005CC5;">DNS</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Domain</span><span style="color:#24292E;">: gce.cloudera.com</span></span>
<span class="line"><span style="color:#005CC5;">IPA</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Server</span><span style="color:#24292E;">: wang</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">1.gce.cloudera.com</span></span>
<span class="line"><span style="color:#6F42C1;">BaseDN</span><span style="color:#24292E;">: dc</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">gce,dc</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">cloudera,dc</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">com</span></span>
<span class="line"><span style="color:#24292E;"> </span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">Continue to configure thesystem </span><span style="color:#D73A49;">with</span><span style="color:#24292E;"> these values</span><span style="color:#D73A49;">?</span><span style="color:#24292E;"> [no]</span><span style="color:#D73A49;">:</span><span style="color:#24292E;"> yes</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">Skipping synchronizing time </span><span style="color:#D73A49;">with</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">NTP</span><span style="color:#24292E;"> server.</span></span>
<span class="line"><span style="color:#24292E;">User authorized to enroll </span><span style="color:#6F42C1;">computers</span><span style="color:#24292E;">: admin</span></span>
<span class="line"><span style="color:#24292E;">Password for admin@</span><span style="color:#005CC5;">GCE</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">CLOUDERA</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">COM</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">Successfully retrieved </span><span style="color:#005CC5;">CA</span><span style="color:#24292E;"> cert</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#6F42C1;">Subject</span><span style="color:#24292E;">:     </span><span style="color:#005CC5;">CN</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">CertificateAuthority,</span><span style="color:#005CC5;">O</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">GCE</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">CLOUDERA</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">COM</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#6F42C1;">Issuer</span><span style="color:#24292E;">:      </span><span style="color:#005CC5;">CN</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">CertificateAuthority,</span><span style="color:#005CC5;">O</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">GCE</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">CLOUDERA</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">COM</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">ValidFrom</span><span style="color:#24292E;">:  </span><span style="color:#005CC5;">2019</span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">08</span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">11</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">13</span><span style="color:#24292E;">:</span><span style="color:#005CC5;">44</span><span style="color:#24292E;">:</span><span style="color:#005CC5;">00</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">ValidUntil</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">2039</span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">08</span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">11</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">13</span><span style="color:#24292E;">:</span><span style="color:#005CC5;">44</span><span style="color:#24292E;">:</span><span style="color:#005CC5;">00</span></span>
<span class="line"><span style="color:#24292E;"> </span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">Enrolled </span><span style="color:#D73A49;">in</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">IPA</span><span style="color:#24292E;"> realm </span><span style="color:#005CC5;">GCE</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">CLOUDERA</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">COM</span></span>
<span class="line"><span style="color:#24292E;">Created </span><span style="color:#D73A49;">/</span><span style="color:#24292E;">etc</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">ipa</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">default.conf</span></span>
<span class="line"><span style="color:#24292E;">New </span><span style="color:#005CC5;">SSSD</span><span style="color:#24292E;"> config will be created</span></span>
<span class="line"><span style="color:#24292E;">Configured sudoers </span><span style="color:#D73A49;">in</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">/</span><span style="color:#24292E;">etc</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">nsswitch.conf</span></span>
<span class="line"><span style="color:#24292E;">Configured </span><span style="color:#D73A49;">/</span><span style="color:#24292E;">etc</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">sssd</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">sssd.conf</span></span>
<span class="line"><span style="color:#24292E;">Configured </span><span style="color:#D73A49;">/</span><span style="color:#24292E;">etc</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">krb5.conf for </span><span style="color:#005CC5;">IPA</span><span style="color:#24292E;"> realmGCE.</span><span style="color:#005CC5;">CLOUDERA</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">COM</span></span>
<span class="line"><span style="color:#24292E;">trying </span><span style="color:#6F42C1;">https</span><span style="color:#24292E;">:</span><span style="color:#6A737D;">//wang-1.gce.cloudera.com/ipa/json</span></span>
<span class="line"><span style="color:#24292E;">[try </span><span style="color:#005CC5;">1</span><span style="color:#24292E;">]: Forwarding </span><span style="color:#032F62;">&#39;schema&#39;</span><span style="color:#24292E;"> to json server</span><span style="color:#032F62;">&#39;https://wang-1.gce.cloudera.com/ipa/json&#39;</span></span>
<span class="line"><span style="color:#24292E;">trying </span><span style="color:#6F42C1;">https</span><span style="color:#24292E;">:</span><span style="color:#6A737D;">//wang-1.gce.cloudera.com/ipa/session/json</span></span>
<span class="line"><span style="color:#24292E;">[try </span><span style="color:#005CC5;">1</span><span style="color:#24292E;">]: Forwarding </span><span style="color:#032F62;">&#39;ping&#39;</span><span style="color:#24292E;"> to json server</span><span style="color:#032F62;">&#39;https://wang-1.gce.cloudera.com/ipa/session/json&#39;</span></span>
<span class="line"><span style="color:#24292E;">[try </span><span style="color:#005CC5;">1</span><span style="color:#24292E;">]: Forwarding </span><span style="color:#032F62;">&#39;ca_is_enabled&#39;</span><span style="color:#24292E;"> to json server</span><span style="color:#032F62;">&#39;https://wang-1.gce.cloudera.com/ipa/session/json&#39;</span></span>
<span class="line"><span style="color:#24292E;">Systemwide </span><span style="color:#005CC5;">CA</span><span style="color:#24292E;"> database updated.</span></span>
<span class="line"><span style="color:#24292E;">Adding </span><span style="color:#005CC5;">SSH</span><span style="color:#24292E;"> public key from</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">etc</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">ssh</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">ssh_host_rsa_key.pub</span></span>
<span class="line"><span style="color:#24292E;">Adding </span><span style="color:#005CC5;">SSH</span><span style="color:#24292E;"> public key from</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">etc</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">ssh</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">ssh_host_ecdsa_key.pub</span></span>
<span class="line"><span style="color:#24292E;">Adding </span><span style="color:#005CC5;">SSH</span><span style="color:#24292E;"> public key from</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">etc</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">ssh</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">ssh_host_ed25519_key.pub</span></span>
<span class="line"><span style="color:#24292E;">[try </span><span style="color:#005CC5;">1</span><span style="color:#24292E;">]: Forwarding </span><span style="color:#032F62;">&#39;host_mod&#39;</span><span style="color:#24292E;"> to json server</span><span style="color:#032F62;">&#39;https://wang-1.gce.cloudera.com/ipa/session/json&#39;</span></span>
<span class="line"><span style="color:#24292E;">Could not update </span><span style="color:#005CC5;">DNS</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">SSHFP</span><span style="color:#24292E;"> records.</span></span>
<span class="line"><span style="color:#005CC5;">SSSD</span><span style="color:#24292E;"> enabled</span></span>
<span class="line"><span style="color:#24292E;">Configured </span><span style="color:#D73A49;">/</span><span style="color:#24292E;">etc</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">openldap</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">ldap.conf</span></span>
<span class="line"><span style="color:#24292E;">Configured </span><span style="color:#D73A49;">/</span><span style="color:#24292E;">etc</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">ssh</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">ssh_config</span></span>
<span class="line"><span style="color:#24292E;">Configured </span><span style="color:#D73A49;">/</span><span style="color:#24292E;">etc</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">ssh</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">sshd_config</span></span>
<span class="line"><span style="color:#24292E;">Configuring gce.cloudera.com </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">NIS</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">domain</span><span style="color:#24292E;">.</span></span>
<span class="line"><span style="color:#24292E;">Client configuration complete.</span></span>
<span class="line"><span style="color:#24292E;">The ipa</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">client</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">install command was successful</span></span></code></pre></div><h1 id="_4-freeipa热备配置" tabindex="-1">4.FreeIPA热备配置 <a class="header-anchor" href="#_4-freeipa热备配置" aria-label="Permalink to &quot;4.FreeIPA热备配置&quot;">​</a></h1><p>文档建议，每个数据中心推荐2-3个副本，但不要超过4个</p><p>先在主服务器ipa server上执行</p><div class="language-javascript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">kinit admin </span></span>
<span class="line"><span style="color:#E1E4E8;">ipa</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">replica</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">prepare wang</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">3.gce.cloudera.com</span></span>
<span class="line"><span style="color:#E1E4E8;"> Replicacreation using </span><span style="color:#9ECBFF;">&#39;ipa-replica-prepare&#39;</span><span style="color:#E1E4E8;"> to generate replica file</span></span>
<span class="line"><span style="color:#E1E4E8;">is supported only </span><span style="color:#F97583;">in</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">level </span><span style="color:#79B8FF;">IPA</span><span style="color:#E1E4E8;"> domain.</span></span>
<span class="line"><span style="color:#E1E4E8;"> </span></span>
<span class="line"><span style="color:#E1E4E8;">The current </span><span style="color:#79B8FF;">IPA</span><span style="color:#E1E4E8;"> domain level is </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;"> and thus thereplica must</span></span>
<span class="line"><span style="color:#E1E4E8;">be created by promoting an existing </span><span style="color:#79B8FF;">IPA</span><span style="color:#E1E4E8;"> client.</span></span>
<span class="line"><span style="color:#E1E4E8;"> </span></span>
<span class="line"><span style="color:#E1E4E8;">To set up a replica use the following </span><span style="color:#B392F0;">procedure</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#79B8FF;">1.</span><span style="color:#E1E4E8;">) set up a client on the hostusing </span><span style="color:#9ECBFF;">&#39;ipa-client-install&#39;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#79B8FF;">2.</span><span style="color:#E1E4E8;">) promote the client to replicarunning </span><span style="color:#9ECBFF;">&#39;ipa-replica-install&#39;</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;">without</span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;"> replica filespecified</span></span>
<span class="line"><span style="color:#E1E4E8;"> </span></span>
<span class="line"><span style="color:#9ECBFF;">&#39;ipa-replica-prepare&#39;</span><span style="color:#E1E4E8;"> is allowed only </span><span style="color:#F97583;">in</span><span style="color:#E1E4E8;"> domainlevel </span><span style="color:#79B8FF;">0</span></span>
<span class="line"><span style="color:#E1E4E8;">The ipa</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">replica</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">prepare command failed.</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">kinit admin </span></span>
<span class="line"><span style="color:#24292E;">ipa</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">replica</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">prepare wang</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">3.gce.cloudera.com</span></span>
<span class="line"><span style="color:#24292E;"> Replicacreation using </span><span style="color:#032F62;">&#39;ipa-replica-prepare&#39;</span><span style="color:#24292E;"> to generate replica file</span></span>
<span class="line"><span style="color:#24292E;">is supported only </span><span style="color:#D73A49;">in</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">level </span><span style="color:#005CC5;">IPA</span><span style="color:#24292E;"> domain.</span></span>
<span class="line"><span style="color:#24292E;"> </span></span>
<span class="line"><span style="color:#24292E;">The current </span><span style="color:#005CC5;">IPA</span><span style="color:#24292E;"> domain level is </span><span style="color:#005CC5;">1</span><span style="color:#24292E;"> and thus thereplica must</span></span>
<span class="line"><span style="color:#24292E;">be created by promoting an existing </span><span style="color:#005CC5;">IPA</span><span style="color:#24292E;"> client.</span></span>
<span class="line"><span style="color:#24292E;"> </span></span>
<span class="line"><span style="color:#24292E;">To set up a replica use the following </span><span style="color:#6F42C1;">procedure</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#005CC5;">1.</span><span style="color:#24292E;">) set up a client on the hostusing </span><span style="color:#032F62;">&#39;ipa-client-install&#39;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#005CC5;">2.</span><span style="color:#24292E;">) promote the client to replicarunning </span><span style="color:#032F62;">&#39;ipa-replica-install&#39;</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">*</span><span style="color:#24292E;">without</span><span style="color:#D73A49;">*</span><span style="color:#24292E;"> replica filespecified</span></span>
<span class="line"><span style="color:#24292E;"> </span></span>
<span class="line"><span style="color:#032F62;">&#39;ipa-replica-prepare&#39;</span><span style="color:#24292E;"> is allowed only </span><span style="color:#D73A49;">in</span><span style="color:#24292E;"> domainlevel </span><span style="color:#005CC5;">0</span></span>
<span class="line"><span style="color:#24292E;">The ipa</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">replica</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">prepare command failed.</span></span></code></pre></div><p>以上操作报错：所以，先在 副本服务器安装 ipa-client及安装ipa-replica</p><h2 id="主服务器添加节点" tabindex="-1"><strong>主服务器添加节点</strong> <a class="header-anchor" href="#主服务器添加节点" aria-label="Permalink to &quot;**主服务器添加节点**&quot;">​</a></h2><p>在 wang-3副本服务器安装ipa-client 安装之前，先执行添加服务器操作</p><div class="language-javascript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">[root@wang</span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">2</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">~</span><span style="color:#E1E4E8;">]# ipa host</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">add </span><span style="color:#F97583;">--</span><span style="color:#E1E4E8;">force</span><span style="color:#F97583;">--</span><span style="color:#E1E4E8;">ip</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">address</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">172.31</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">115.236</span><span style="color:#E1E4E8;"> wang</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">3.gce.cloudera.com                                                </span></span>
<span class="line"><span style="color:#F97583;">------------------------------------</span></span>
<span class="line"><span style="color:#E1E4E8;">Added host </span><span style="color:#9ECBFF;">&quot;wang-3.gce.cloudera.com&quot;</span></span>
<span class="line"><span style="color:#F97583;">------------------------------------</span></span>
<span class="line"><span style="color:#E1E4E8;">  Host </span><span style="color:#B392F0;">name</span><span style="color:#E1E4E8;">:wang</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">3.gce.cloudera.com</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">Principalname</span><span style="color:#E1E4E8;">: host</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">wang</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">3.gce.cloudera.com@</span><span style="color:#79B8FF;">GCE</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">CLOUDERA</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">COM</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">Principalalias</span><span style="color:#E1E4E8;">: host</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">wang</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">3.gce.cloudera.com@</span><span style="color:#79B8FF;">GCE</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">CLOUDERA</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">COM</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">Password</span><span style="color:#E1E4E8;">:False</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">Keytab</span><span style="color:#E1E4E8;">:False</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">Managedby</span><span style="color:#E1E4E8;">: wang</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">3.gce.cloudera.com</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">[root@wang</span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">2</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# ipa host</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">add </span><span style="color:#D73A49;">--</span><span style="color:#24292E;">force</span><span style="color:#D73A49;">--</span><span style="color:#24292E;">ip</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">address</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">172.31</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">115.236</span><span style="color:#24292E;"> wang</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">3.gce.cloudera.com                                                </span></span>
<span class="line"><span style="color:#D73A49;">------------------------------------</span></span>
<span class="line"><span style="color:#24292E;">Added host </span><span style="color:#032F62;">&quot;wang-3.gce.cloudera.com&quot;</span></span>
<span class="line"><span style="color:#D73A49;">------------------------------------</span></span>
<span class="line"><span style="color:#24292E;">  Host </span><span style="color:#6F42C1;">name</span><span style="color:#24292E;">:wang</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">3.gce.cloudera.com</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">Principalname</span><span style="color:#24292E;">: host</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">wang</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">3.gce.cloudera.com@</span><span style="color:#005CC5;">GCE</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">CLOUDERA</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">COM</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">Principalalias</span><span style="color:#24292E;">: host</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">wang</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">3.gce.cloudera.com@</span><span style="color:#005CC5;">GCE</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">CLOUDERA</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">COM</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">Password</span><span style="color:#24292E;">:False</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">Keytab</span><span style="color:#24292E;">:False</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">Managedby</span><span style="color:#24292E;">: wang</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">3.gce.cloudera.com</span></span></code></pre></div><p>检查是否添加成功</p><div class="language-javascript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">[root@wang</span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">2</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">~</span><span style="color:#E1E4E8;">]# ipa host</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">find                                                                                                           </span></span>
<span class="line"><span style="color:#F97583;">---------------</span></span>
<span class="line"><span style="color:#79B8FF;">2</span><span style="color:#E1E4E8;"> hosts matched</span></span>
<span class="line"><span style="color:#F97583;">---------------</span></span>
<span class="line"><span style="color:#E1E4E8;">  Host </span><span style="color:#B392F0;">name</span><span style="color:#E1E4E8;">:wang</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">2.gce.cloudera.com</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">Principalname</span><span style="color:#E1E4E8;">: host</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">wang</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">2.gce.cloudera.com@</span><span style="color:#79B8FF;">GCE</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">CLOUDERA</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">COM</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">Principalalias</span><span style="color:#E1E4E8;">: host</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">wang</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">2.gce.cloudera.com@</span><span style="color:#79B8FF;">GCE</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">CLOUDERA</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">COM</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">SSH</span><span style="color:#E1E4E8;"> publickey </span><span style="color:#B392F0;">fingerprint</span><span style="color:#E1E4E8;">: </span><span style="color:#B392F0;">SHA256</span><span style="color:#E1E4E8;">:rwMkR</span><span style="color:#F97583;">/</span><span style="color:#79B8FF;">W</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">nz4EIzH3b</span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;">BLFLjb0tr7UA4vDR4wmBp4l9o root@wang</span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">2</span><span style="color:#E1E4E8;">(ssh</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">rsa),</span></span>
<span class="line"><span style="color:#E1E4E8;">                             </span><span style="color:#B392F0;">SHA256</span><span style="color:#E1E4E8;">:ppQgDl79Xw</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">IBqhzutNgqsLgvxAOfSGVOl1OhtV00cY root@wang</span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">2</span><span style="color:#E1E4E8;">(ecdsa</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">sha2</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">nistp256),</span></span>
<span class="line"><span style="color:#E1E4E8;">                             </span><span style="color:#B392F0;">SHA256</span><span style="color:#E1E4E8;">:IwracriO47xdmQLkvUODn47swUpp0f4tQ2OcmodVqQg root@wang</span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">2</span><span style="color:#E1E4E8;">(ssh</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">ed25519)</span></span>
<span class="line"><span style="color:#E1E4E8;"> </span></span>
<span class="line"><span style="color:#E1E4E8;">  Host </span><span style="color:#B392F0;">name</span><span style="color:#E1E4E8;">:wang</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">3.gce.cloudera.com</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">Principalname</span><span style="color:#E1E4E8;">: host</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">wang</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">3.gce.cloudera.com@</span><span style="color:#79B8FF;">GCE</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">CLOUDERA</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">COM</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">Principalalias</span><span style="color:#E1E4E8;">: host</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">wang</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">3.gce.cloudera.com@</span><span style="color:#79B8FF;">GCE</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">CLOUDERA</span><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">COM</span></span>
<span class="line"><span style="color:#F97583;">----------------------------</span></span>
<span class="line"><span style="color:#E1E4E8;">Number </span><span style="color:#F97583;">of</span><span style="color:#E1E4E8;"> entries returned </span><span style="color:#79B8FF;">2</span></span>
<span class="line"><span style="color:#F97583;">----------------------------</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">[root@wang</span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">2</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# ipa host</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">find                                                                                                           </span></span>
<span class="line"><span style="color:#D73A49;">---------------</span></span>
<span class="line"><span style="color:#005CC5;">2</span><span style="color:#24292E;"> hosts matched</span></span>
<span class="line"><span style="color:#D73A49;">---------------</span></span>
<span class="line"><span style="color:#24292E;">  Host </span><span style="color:#6F42C1;">name</span><span style="color:#24292E;">:wang</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">2.gce.cloudera.com</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">Principalname</span><span style="color:#24292E;">: host</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">wang</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">2.gce.cloudera.com@</span><span style="color:#005CC5;">GCE</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">CLOUDERA</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">COM</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">Principalalias</span><span style="color:#24292E;">: host</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">wang</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">2.gce.cloudera.com@</span><span style="color:#005CC5;">GCE</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">CLOUDERA</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">COM</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#005CC5;">SSH</span><span style="color:#24292E;"> publickey </span><span style="color:#6F42C1;">fingerprint</span><span style="color:#24292E;">: </span><span style="color:#6F42C1;">SHA256</span><span style="color:#24292E;">:rwMkR</span><span style="color:#D73A49;">/</span><span style="color:#005CC5;">W</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">nz4EIzH3b</span><span style="color:#D73A49;">+</span><span style="color:#24292E;">BLFLjb0tr7UA4vDR4wmBp4l9o root@wang</span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">2</span><span style="color:#24292E;">(ssh</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">rsa),</span></span>
<span class="line"><span style="color:#24292E;">                             </span><span style="color:#6F42C1;">SHA256</span><span style="color:#24292E;">:ppQgDl79Xw</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">IBqhzutNgqsLgvxAOfSGVOl1OhtV00cY root@wang</span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">2</span><span style="color:#24292E;">(ecdsa</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">sha2</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">nistp256),</span></span>
<span class="line"><span style="color:#24292E;">                             </span><span style="color:#6F42C1;">SHA256</span><span style="color:#24292E;">:IwracriO47xdmQLkvUODn47swUpp0f4tQ2OcmodVqQg root@wang</span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">2</span><span style="color:#24292E;">(ssh</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">ed25519)</span></span>
<span class="line"><span style="color:#24292E;"> </span></span>
<span class="line"><span style="color:#24292E;">  Host </span><span style="color:#6F42C1;">name</span><span style="color:#24292E;">:wang</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">3.gce.cloudera.com</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">Principalname</span><span style="color:#24292E;">: host</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">wang</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">3.gce.cloudera.com@</span><span style="color:#005CC5;">GCE</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">CLOUDERA</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">COM</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">Principalalias</span><span style="color:#24292E;">: host</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">wang</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">3.gce.cloudera.com@</span><span style="color:#005CC5;">GCE</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">CLOUDERA</span><span style="color:#24292E;">.</span><span style="color:#005CC5;">COM</span></span>
<span class="line"><span style="color:#D73A49;">----------------------------</span></span>
<span class="line"><span style="color:#24292E;">Number </span><span style="color:#D73A49;">of</span><span style="color:#24292E;"> entries returned </span><span style="color:#005CC5;">2</span></span>
<span class="line"><span style="color:#D73A49;">----------------------------</span></span></code></pre></div><h2 id="热备服务器安装client" tabindex="-1"><strong>热备服务器安装client</strong> <a class="header-anchor" href="#热备服务器安装client" aria-label="Permalink to &quot;**热备服务器安装client**&quot;">​</a></h2><p>[root@wang-2 ~]# ipa host-find</p><h1 id="_5-卸载" tabindex="-1">5.卸载 <a class="header-anchor" href="#_5-卸载" aria-label="Permalink to &quot;5.卸载&quot;">​</a></h1><div class="language-javascript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">ipa</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">server</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">install </span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">U</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">--</span><span style="color:#E1E4E8;">uninstall #服务端卸</span></span>
<span class="line"><span style="color:#E1E4E8;">ipa</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">client</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">install </span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">U</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">--</span><span style="color:#E1E4E8;">uninstall #客户端卸载</span></span>
<span class="line"><span style="color:#E1E4E8;">#删除残留文件，避免二次安装失败</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">cd </span><span style="color:#F97583;">/var</span><span style="color:#E1E4E8;">/lib/ipa/</span></span>
<span class="line"><span style="color:#E1E4E8;">rm </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">f ca</span><span style="color:#F97583;">*</span></span>
<span class="line"><span style="color:#E1E4E8;">rm </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">f </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;">.txt</span></span>
<span class="line"><span style="color:#E1E4E8;">rm </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">f sysrestore</span><span style="color:#6A737D;">/*</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">cd /var/lib/dirsrv/</span></span>
<span class="line"><span style="color:#6A737D;">rm -rf scripts*</span></span>
<span class="line"><span style="color:#6A737D;">cd /var/run/dirsrv/</span></span>
<span class="line"><span style="color:#6A737D;">rm -rf slapd*</span></span>
<span class="line"><span style="color:#6A737D;">cd /etc/ipa</span></span>
<span class="line"><span style="color:#6A737D;">rm -f ca.crt</span></span>
<span class="line"><span style="color:#6A737D;">cd /var/log/dirsrv</span></span>
<span class="line"><span style="color:#6A737D;">rm -rf slapd*</span></span>
<span class="line"><span style="color:#6A737D;">rm -rf /var/lib/pki* /var/log/pki* /etc/init.d/pki*</span></span>
<span class="line"><span style="color:#6A737D;">rm -rf /usr/share/pki /usr/share/tomcat5/var/lib/tomcat5/</span></span>
<span class="line"><span style="color:#6A737D;">#卸载软件包</span></span>
<span class="line"><span style="color:#6A737D;">yum erase -y \`rpmquery -a | grep freeipa\`\`rpmquery -a | grep ^pki-\` \`rpmquery -a | grep tomcat6\`  \`rpmquery -a | grep httpd\` 389-ds-base bind</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">ipa</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">server</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">install </span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">U</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">--</span><span style="color:#24292E;">uninstall #服务端卸</span></span>
<span class="line"><span style="color:#24292E;">ipa</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">client</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">install </span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">U</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">--</span><span style="color:#24292E;">uninstall #客户端卸载</span></span>
<span class="line"><span style="color:#24292E;">#删除残留文件，避免二次安装失败</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">cd </span><span style="color:#D73A49;">/var</span><span style="color:#24292E;">/lib/ipa/</span></span>
<span class="line"><span style="color:#24292E;">rm </span><span style="color:#D73A49;">-</span><span style="color:#24292E;">f ca</span><span style="color:#D73A49;">*</span></span>
<span class="line"><span style="color:#24292E;">rm </span><span style="color:#D73A49;">-</span><span style="color:#24292E;">f </span><span style="color:#D73A49;">*</span><span style="color:#24292E;">.txt</span></span>
<span class="line"><span style="color:#24292E;">rm </span><span style="color:#D73A49;">-</span><span style="color:#24292E;">f sysrestore</span><span style="color:#6A737D;">/*</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">cd /var/lib/dirsrv/</span></span>
<span class="line"><span style="color:#6A737D;">rm -rf scripts*</span></span>
<span class="line"><span style="color:#6A737D;">cd /var/run/dirsrv/</span></span>
<span class="line"><span style="color:#6A737D;">rm -rf slapd*</span></span>
<span class="line"><span style="color:#6A737D;">cd /etc/ipa</span></span>
<span class="line"><span style="color:#6A737D;">rm -f ca.crt</span></span>
<span class="line"><span style="color:#6A737D;">cd /var/log/dirsrv</span></span>
<span class="line"><span style="color:#6A737D;">rm -rf slapd*</span></span>
<span class="line"><span style="color:#6A737D;">rm -rf /var/lib/pki* /var/log/pki* /etc/init.d/pki*</span></span>
<span class="line"><span style="color:#6A737D;">rm -rf /usr/share/pki /usr/share/tomcat5/var/lib/tomcat5/</span></span>
<span class="line"><span style="color:#6A737D;">#卸载软件包</span></span>
<span class="line"><span style="color:#6A737D;">yum erase -y \`rpmquery -a | grep freeipa\`\`rpmquery -a | grep ^pki-\` \`rpmquery -a | grep tomcat6\`  \`rpmquery -a | grep httpd\` 389-ds-base bind</span></span></code></pre></div><h1 id="faq" tabindex="-1">FAQ <a class="header-anchor" href="#faq" aria-label="Permalink to &quot;FAQ&quot;">​</a></h1><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">ipa: ERROR: did not receive Kerberos credentials</span></span>
<span class="line"><span style="color:#e1e4e8;">#解决方式</span></span>
<span class="line"><span style="color:#e1e4e8;">kinit username（根据自己的修改）</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">解锁用户的话再执行</span></span>
<span class="line"><span style="color:#e1e4e8;">ipa user-unlock username</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">ipa: ERROR: did not receive Kerberos credentials</span></span>
<span class="line"><span style="color:#24292e;">#解决方式</span></span>
<span class="line"><span style="color:#24292e;">kinit username（根据自己的修改）</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">解锁用户的话再执行</span></span>
<span class="line"><span style="color:#24292e;">ipa user-unlock username</span></span></code></pre></div>`,84),o=[e];function c(r,t,i,y,E,d){return a(),n("div",null,o)}const m=s(p,[["render",c]]);export{u as __pageData,m as default};
