import{_ as s,o as n,c as a,R as l}from"./chunks/framework.zUbWieqp.js";const m=JSON.parse('{"title":"1.清理backend不存在的service对应的ingress资源","description":"","frontmatter":{},"headers":[],"relativePath":"guide/container/k8s/TroubleshootingMaintenanceManual/20-ingress-nginx.md","filePath":"guide/container/k8s/TroubleshootingMaintenanceManual/20-ingress-nginx.md","lastUpdated":1730111076000}'),p={name:"guide/container/k8s/TroubleshootingMaintenanceManual/20-ingress-nginx.md"},o=l(`<h1 id="_1-清理backend不存在的service对应的ingress资源" tabindex="-1">1.清理backend不存在的service对应的ingress资源 <a class="header-anchor" href="#_1-清理backend不存在的service对应的ingress资源" aria-label="Permalink to &quot;1.清理backend不存在的service对应的ingress资源&quot;">​</a></h1><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;"># cat clear_k8s_ingress.sh</span></span>
<span class="line"><span style="color:#79B8FF;">set</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-e</span></span>
<span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">get</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">ing</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-A</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-o=custom-columns=</span><span style="color:#9ECBFF;">&#39;NAMESPACE:.metadata.namespace,NAME:.metadata.name,SVCs:..service.name&#39;</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--no-headers</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;">while read line</span></span>
<span class="line"><span style="color:#F97583;">do</span></span>
<span class="line"><span style="color:#E1E4E8;">   namespa_name</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">$(</span><span style="color:#B392F0;">awk</span><span style="color:#9ECBFF;"> &#39;{print $1}&#39; </span><span style="color:#F97583;">&lt;&lt;&lt;</span><span style="color:#9ECBFF;">&quot;</span><span style="color:#E1E4E8;">$line</span><span style="color:#9ECBFF;">&quot;)</span></span>
<span class="line"><span style="color:#E1E4E8;">   ingress_name</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">$(</span><span style="color:#B392F0;">awk</span><span style="color:#9ECBFF;"> &#39;{print $2}&#39; </span><span style="color:#F97583;">&lt;&lt;&lt;</span><span style="color:#9ECBFF;">&quot;</span><span style="color:#E1E4E8;">$line</span><span style="color:#9ECBFF;">&quot;)</span></span>
<span class="line"><span style="color:#E1E4E8;">   service_name</span><span style="color:#F97583;">=</span><span style="color:#9ECBFF;">$(</span><span style="color:#79B8FF;">echo</span><span style="color:#9ECBFF;"> &quot;</span><span style="color:#E1E4E8;">$line</span><span style="color:#9ECBFF;">&quot;</span><span style="color:#F97583;">|</span><span style="color:#B392F0;">awk</span><span style="color:#9ECBFF;"> &#39;{print $3}&#39; </span><span style="color:#F97583;">|</span><span style="color:#B392F0;">awk</span><span style="color:#9ECBFF;"> </span><span style="color:#79B8FF;">-F</span><span style="color:#9ECBFF;"> &#39;,&#39; &#39;{print $1}&#39;)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> [[ </span><span style="color:#9ECBFF;">$(</span><span style="color:#B392F0;">kubectl</span><span style="color:#9ECBFF;"> get svc </span><span style="color:#79B8FF;">-A</span><span style="color:#9ECBFF;"> </span><span style="color:#F97583;">|</span><span style="color:#B392F0;">grep</span><span style="color:#9ECBFF;"> </span><span style="color:#E1E4E8;">$service_name</span><span style="color:#9ECBFF;">)</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">==</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;&quot;</span><span style="color:#E1E4E8;"> ]]</span></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#F97583;">then</span></span>
<span class="line"><span style="color:#E1E4E8;">       </span><span style="color:#79B8FF;">echo</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;</span><span style="color:#E1E4E8;">$service_name不存在</span><span style="color:#9ECBFF;">,需要删除</span><span style="color:#E1E4E8;">$namespa_name命名空间下的$ingress_name</span><span style="color:#9ECBFF;">&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">       </span><span style="color:#79B8FF;">echo</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-e</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;删除指令: \\033[32mkubectl delete ing -n </span><span style="color:#E1E4E8;">$namespa_name</span><span style="color:#9ECBFF;"> </span><span style="color:#E1E4E8;">$ingress_name</span><span style="color:#9ECBFF;">\\033[0m&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">       </span><span style="color:#B392F0;">kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">delete</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">ing</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-n</span><span style="color:#E1E4E8;"> $namespa_name $ingress_name</span></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#F97583;">fi</span></span>
<span class="line"><span style="color:#F97583;">done</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;"># cat clear_k8s_ingress.sh</span></span>
<span class="line"><span style="color:#005CC5;">set</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-e</span></span>
<span class="line"><span style="color:#6F42C1;">kubectl</span><span style="color:#24292E;">  </span><span style="color:#032F62;">get</span><span style="color:#24292E;"> </span><span style="color:#032F62;">ing</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-A</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-o=custom-columns=</span><span style="color:#032F62;">&#39;NAMESPACE:.metadata.namespace,NAME:.metadata.name,SVCs:..service.name&#39;</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--no-headers</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;">while read line</span></span>
<span class="line"><span style="color:#D73A49;">do</span></span>
<span class="line"><span style="color:#24292E;">   namespa_name</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">$(</span><span style="color:#6F42C1;">awk</span><span style="color:#032F62;"> &#39;{print $1}&#39; </span><span style="color:#D73A49;">&lt;&lt;&lt;</span><span style="color:#032F62;">&quot;</span><span style="color:#24292E;">$line</span><span style="color:#032F62;">&quot;)</span></span>
<span class="line"><span style="color:#24292E;">   ingress_name</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">$(</span><span style="color:#6F42C1;">awk</span><span style="color:#032F62;"> &#39;{print $2}&#39; </span><span style="color:#D73A49;">&lt;&lt;&lt;</span><span style="color:#032F62;">&quot;</span><span style="color:#24292E;">$line</span><span style="color:#032F62;">&quot;)</span></span>
<span class="line"><span style="color:#24292E;">   service_name</span><span style="color:#D73A49;">=</span><span style="color:#032F62;">$(</span><span style="color:#005CC5;">echo</span><span style="color:#032F62;"> &quot;</span><span style="color:#24292E;">$line</span><span style="color:#032F62;">&quot;</span><span style="color:#D73A49;">|</span><span style="color:#6F42C1;">awk</span><span style="color:#032F62;"> &#39;{print $3}&#39; </span><span style="color:#D73A49;">|</span><span style="color:#6F42C1;">awk</span><span style="color:#032F62;"> </span><span style="color:#005CC5;">-F</span><span style="color:#032F62;"> &#39;,&#39; &#39;{print $1}&#39;)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> [[ </span><span style="color:#032F62;">$(</span><span style="color:#6F42C1;">kubectl</span><span style="color:#032F62;"> get svc </span><span style="color:#005CC5;">-A</span><span style="color:#032F62;"> </span><span style="color:#D73A49;">|</span><span style="color:#6F42C1;">grep</span><span style="color:#032F62;"> </span><span style="color:#24292E;">$service_name</span><span style="color:#032F62;">)</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">==</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;&quot;</span><span style="color:#24292E;"> ]]</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#D73A49;">then</span></span>
<span class="line"><span style="color:#24292E;">       </span><span style="color:#005CC5;">echo</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;</span><span style="color:#24292E;">$service_name不存在</span><span style="color:#032F62;">,需要删除</span><span style="color:#24292E;">$namespa_name命名空间下的$ingress_name</span><span style="color:#032F62;">&quot;</span></span>
<span class="line"><span style="color:#24292E;">       </span><span style="color:#005CC5;">echo</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-e</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;删除指令: \\033[32mkubectl delete ing -n </span><span style="color:#24292E;">$namespa_name</span><span style="color:#032F62;"> </span><span style="color:#24292E;">$ingress_name</span><span style="color:#032F62;">\\033[0m&quot;</span></span>
<span class="line"><span style="color:#24292E;">       </span><span style="color:#6F42C1;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">delete</span><span style="color:#24292E;"> </span><span style="color:#032F62;">ing</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-n</span><span style="color:#24292E;"> $namespa_name $ingress_name</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#D73A49;">fi</span></span>
<span class="line"><span style="color:#D73A49;">done</span></span></code></pre></div><p><a href="https://www.cnblogs.com/yuhaohao/category/1366872.html" target="_blank" rel="noreferrer">https://www.cnblogs.com/yuhaohao/category/1366872.html</a></p>`,3),e=[o];function t(c,r,y,E,F,i){return n(),a("div",null,e)}const u=s(p,[["render",t]]);export{m as __pageData,u as default};
