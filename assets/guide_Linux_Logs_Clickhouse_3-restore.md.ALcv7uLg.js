import{_ as s,o as a,c as n,R as l}from"./chunks/framework.zUbWieqp.js";const C=JSON.parse('{"title":"1. ckPart恢复","description":"","frontmatter":{},"headers":[],"relativePath":"guide/Linux/Logs/Clickhouse/3-restore.md","filePath":"guide/Linux/Logs/Clickhouse/3-restore.md","lastUpdated":1730888659000}'),o={name:"guide/Linux/Logs/Clickhouse/3-restore.md"},p=l(`<h1 id="_1-ckpart恢复" tabindex="-1">1. ckPart恢复 <a class="header-anchor" href="#_1-ckpart恢复" aria-label="Permalink to &quot;1. ckPart恢复&quot;">​</a></h1><p><a href="https://clickhouse.com/docs/zh/sql-reference/statements/alter#alter_attach-partition" target="_blank" rel="noreferrer">官当</a></p><ul><li>删除表或者清空表</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">#模拟删除备份过的表，的重新创建表</span></span>
<span class="line"><span style="color:#79B8FF;">echo</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;drop table your_data_name.your_table_name&#39;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">clickhouse-client</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-udefault</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--password</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">123456</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">或者</span></span>
<span class="line"><span style="color:#79B8FF;">echo</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;truncate table your_data_name.your_table_name&#39;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">clickhouse-client</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-udefault</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--password</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">123456</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">#模拟删除备份过的表，的重新创建表</span></span>
<span class="line"><span style="color:#005CC5;">echo</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;drop table your_data_name.your_table_name&#39;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">clickhouse-client</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-udefault</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--password</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">123456</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">或者</span></span>
<span class="line"><span style="color:#005CC5;">echo</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;truncate table your_data_name.your_table_name&#39;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">clickhouse-client</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-udefault</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--password</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">123456</span></span></code></pre></div><ul><li>复制备份数据到清空表的目录下的detached</li></ul><p><em>将之前备份的表分区目录复制到新创建表的 detached 目录</em></p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">cp</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-r</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/var/lib/clickhouse/shadow/1/store/72a/72ad70a1-093a-4254-9098-14d5735fc0d3/</span><span style="color:#79B8FF;">*</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/var/lib/clickhouse/data/nginxlogs/nginx_access/detached/</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#修改权限，否则会报没有权限</span></span>
<span class="line"><span style="color:#B392F0;">chown</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-R</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">clickhouse.</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/var/lib/clickhouse/data/nginxlogs/nginx_access/detached/</span><span style="color:#79B8FF;">*</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#查看</span></span>
<span class="line"><span style="color:#E1E4E8;">[root@kubeadm-master01 detached]# pwd</span></span>
<span class="line"><span style="color:#B392F0;">/var/lib/clickhouse/data/nginxlogs/nginx_access/detached</span></span>
<span class="line"><span style="color:#E1E4E8;">[root@kubeadm-master01 detached]# ll</span></span>
<span class="line"><span style="color:#B392F0;">总用量</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0</span></span>
<span class="line"><span style="color:#B392F0;">drwxr-x---</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">root</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">root</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">244</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">11</span><span style="color:#9ECBFF;">月</span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">6</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">16</span><span style="color:#9ECBFF;">:58</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">20241101</span><span style="color:#9ECBFF;">_1_2_1</span></span>
<span class="line"><span style="color:#B392F0;">drwxr-x---</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">root</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">root</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">244</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">11</span><span style="color:#9ECBFF;">月</span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">6</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">16</span><span style="color:#9ECBFF;">:58</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">20241104</span><span style="color:#9ECBFF;">_3_10_2</span></span>
<span class="line"><span style="color:#B392F0;">drwxr-x---</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">root</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">root</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">244</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">11</span><span style="color:#9ECBFF;">月</span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">6</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">16</span><span style="color:#9ECBFF;">:58</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">20241105</span><span style="color:#9ECBFF;">_11_13_1</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">cp</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-r</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/var/lib/clickhouse/shadow/1/store/72a/72ad70a1-093a-4254-9098-14d5735fc0d3/</span><span style="color:#005CC5;">*</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/var/lib/clickhouse/data/nginxlogs/nginx_access/detached/</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#修改权限，否则会报没有权限</span></span>
<span class="line"><span style="color:#6F42C1;">chown</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-R</span><span style="color:#24292E;"> </span><span style="color:#032F62;">clickhouse.</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/var/lib/clickhouse/data/nginxlogs/nginx_access/detached/</span><span style="color:#005CC5;">*</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#查看</span></span>
<span class="line"><span style="color:#24292E;">[root@kubeadm-master01 detached]# pwd</span></span>
<span class="line"><span style="color:#6F42C1;">/var/lib/clickhouse/data/nginxlogs/nginx_access/detached</span></span>
<span class="line"><span style="color:#24292E;">[root@kubeadm-master01 detached]# ll</span></span>
<span class="line"><span style="color:#6F42C1;">总用量</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0</span></span>
<span class="line"><span style="color:#6F42C1;">drwxr-x---</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2</span><span style="color:#24292E;"> </span><span style="color:#032F62;">root</span><span style="color:#24292E;"> </span><span style="color:#032F62;">root</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">244</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">11</span><span style="color:#032F62;">月</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">6</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">16</span><span style="color:#032F62;">:58</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">20241101</span><span style="color:#032F62;">_1_2_1</span></span>
<span class="line"><span style="color:#6F42C1;">drwxr-x---</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2</span><span style="color:#24292E;"> </span><span style="color:#032F62;">root</span><span style="color:#24292E;"> </span><span style="color:#032F62;">root</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">244</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">11</span><span style="color:#032F62;">月</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">6</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">16</span><span style="color:#032F62;">:58</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">20241104</span><span style="color:#032F62;">_3_10_2</span></span>
<span class="line"><span style="color:#6F42C1;">drwxr-x---</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2</span><span style="color:#24292E;"> </span><span style="color:#032F62;">root</span><span style="color:#24292E;"> </span><span style="color:#032F62;">root</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">244</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">11</span><span style="color:#032F62;">月</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">6</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">16</span><span style="color:#032F62;">:58</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">20241105</span><span style="color:#032F62;">_11_13_1</span></span></code></pre></div><ul><li>执行 attach</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#79B8FF;">echo</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;alter table nginxlogs.nginx_access attach partition 20241105&#39;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#B392F0;">clickhouse-client</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-udefault</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--password</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">123456</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#查看表是否有数据</span></span>
<span class="line"><span style="color:#B392F0;">SELECT</span><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">*</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">FROM</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">nginxlogs.nginx_access</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">na</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">LIMIT</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">10</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#005CC5;">echo</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;alter table nginxlogs.nginx_access attach partition 20241105&#39;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#6F42C1;">clickhouse-client</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-udefault</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--password</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">123456</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#查看表是否有数据</span></span>
<span class="line"><span style="color:#6F42C1;">SELECT</span><span style="color:#24292E;">  </span><span style="color:#005CC5;">*</span><span style="color:#24292E;"> </span><span style="color:#032F62;">FROM</span><span style="color:#24292E;"> </span><span style="color:#032F62;">nginxlogs.nginx_access</span><span style="color:#24292E;"> </span><span style="color:#032F62;">na</span><span style="color:#24292E;"> </span><span style="color:#032F62;">LIMIT</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">10</span></span></code></pre></div><p>至此结束。</p>`,10),e=[p];function c(t,r,y,E,F,i){return a(),n("div",null,e)}const h=s(o,[["render",c]]);export{C as __pageData,h as default};
