import{_ as s,o as a,c as n,R as l}from"./chunks/framework.zUbWieqp.js";const F=JSON.parse('{"title":"1. Solana系统调优","description":"","frontmatter":{},"headers":[],"relativePath":"guide/Blockchain/solana/1.env.md","filePath":"guide/Blockchain/solana/1.env.md","lastUpdated":1736418315000}'),p={name:"guide/Blockchain/solana/1.env.md"},o=l(`<h1 id="_1-solana系统调优" tabindex="-1">1. Solana系统调优 <a class="header-anchor" href="#_1-solana系统调优" aria-label="Permalink to &quot;1. Solana系统调优&quot;">​</a></h1><p>基于centos系列</p><h2 id="_1-1-磁盘分区" tabindex="-1">1.1 磁盘分区 <a class="header-anchor" href="#_1-1-磁盘分区" aria-label="Permalink to &quot;1.1 磁盘分区&quot;">​</a></h2><p>由于后期区块太多，磁盘占用太大，磁盘建议设置成GPT分区</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">#  fdisk -l</span></span>
<span class="line"><span style="color:#B392F0;">root@solana:~#</span><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">parted</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/dev/vdb</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># 开始分区</span></span>
<span class="line"><span style="color:#E1E4E8;">	</span><span style="color:#B392F0;">mklabel</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">gpt</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># 将默认的MBR分区格式转为GPT分区格式</span></span>
<span class="line"><span style="color:#E1E4E8;">	</span><span style="color:#B392F0;">mkpart</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">primary</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">100</span><span style="color:#9ECBFF;">%</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># 划分一个主分区，并设置分区的开始位置和结束位置</span></span>
<span class="line"><span style="color:#E1E4E8;">	</span><span style="color:#B392F0;">align-check</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">optimal</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># 检查分区是否对齐</span></span>
<span class="line"><span style="color:#E1E4E8;">	</span><span style="color:#6A737D;"># 1 aligned # 运行结果如此行所示</span></span>
<span class="line"><span style="color:#E1E4E8;">	</span><span style="color:#79B8FF;">print</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># 查看分区表</span></span>
<span class="line"><span style="color:#E1E4E8;">	</span><span style="color:#B392F0;">quit</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># 退出Parted工具</span></span>
<span class="line"><span style="color:#6A737D;">#  partprobe</span></span>
<span class="line"><span style="color:#6A737D;">#  mkfs -t ext4 /dev/vdb1</span></span>
<span class="line"><span style="color:#6A737D;">#  mkdir /data</span></span>
<span class="line"><span style="color:#6A737D;">#  mount /dev/vdb1 /data/</span></span>
<span class="line"><span style="color:#6A737D;">#  df -h</span></span>
<span class="line"><span style="color:#6A737D;">#  cp /etc/fstab /etc/fstab.bak</span></span>
<span class="line"><span style="color:#6A737D;">#  echo \`blkid /dev/vdb1 | awk &#39;{print $2}&#39; | sed &#39;s/\\&quot;//g&#39;\` /data ext4 defaults 0 0 &gt;&gt; /etc/fstab</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">#  fdisk -l</span></span>
<span class="line"><span style="color:#6F42C1;">root@solana:~#</span><span style="color:#24292E;">  </span><span style="color:#032F62;">parted</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/dev/vdb</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 开始分区</span></span>
<span class="line"><span style="color:#24292E;">	</span><span style="color:#6F42C1;">mklabel</span><span style="color:#24292E;"> </span><span style="color:#032F62;">gpt</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 将默认的MBR分区格式转为GPT分区格式</span></span>
<span class="line"><span style="color:#24292E;">	</span><span style="color:#6F42C1;">mkpart</span><span style="color:#24292E;"> </span><span style="color:#032F62;">primary</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">100</span><span style="color:#032F62;">%</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 划分一个主分区，并设置分区的开始位置和结束位置</span></span>
<span class="line"><span style="color:#24292E;">	</span><span style="color:#6F42C1;">align-check</span><span style="color:#24292E;"> </span><span style="color:#032F62;">optimal</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 检查分区是否对齐</span></span>
<span class="line"><span style="color:#24292E;">	</span><span style="color:#6A737D;"># 1 aligned # 运行结果如此行所示</span></span>
<span class="line"><span style="color:#24292E;">	</span><span style="color:#005CC5;">print</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 查看分区表</span></span>
<span class="line"><span style="color:#24292E;">	</span><span style="color:#6F42C1;">quit</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 退出Parted工具</span></span>
<span class="line"><span style="color:#6A737D;">#  partprobe</span></span>
<span class="line"><span style="color:#6A737D;">#  mkfs -t ext4 /dev/vdb1</span></span>
<span class="line"><span style="color:#6A737D;">#  mkdir /data</span></span>
<span class="line"><span style="color:#6A737D;">#  mount /dev/vdb1 /data/</span></span>
<span class="line"><span style="color:#6A737D;">#  df -h</span></span>
<span class="line"><span style="color:#6A737D;">#  cp /etc/fstab /etc/fstab.bak</span></span>
<span class="line"><span style="color:#6A737D;">#  echo \`blkid /dev/vdb1 | awk &#39;{print $2}&#39; | sed &#39;s/\\&quot;//g&#39;\` /data ext4 defaults 0 0 &gt;&gt; /etc/fstab</span></span></code></pre></div><h2 id="_1-2-增加-udp-缓冲区" tabindex="-1">1.2 增加 UDP 缓冲区 <a class="header-anchor" href="#_1-2-增加-udp-缓冲区" aria-label="Permalink to &quot;1.2 增加 UDP 缓冲区&quot;">​</a></h2><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">cat</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">&gt;</span><span style="color:#9ECBFF;">/etc/sysctl.d/20-solana-udp-buffers.conf</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">&lt;&lt;</span><span style="color:#9ECBFF;">EOF</span></span>
<span class="line"><span style="color:#9ECBFF;"># Increase UDP buffer size</span></span>
<span class="line"><span style="color:#9ECBFF;">net.core.rmem_default = 134217728</span></span>
<span class="line"><span style="color:#9ECBFF;">net.core.rmem_max = 134217728</span></span>
<span class="line"><span style="color:#9ECBFF;">net.core.wmem_default = 134217728</span></span>
<span class="line"><span style="color:#9ECBFF;">net.core.wmem_max = 134217728</span></span>
<span class="line"><span style="color:#9ECBFF;"># Increase memory mapped files limit</span></span>
<span class="line"><span style="color:#9ECBFF;">vm.max_map_count = 1000000</span></span>
<span class="line"></span>
<span class="line"><span style="color:#9ECBFF;"># Increase number of allowed open file descriptors</span></span>
<span class="line"><span style="color:#9ECBFF;">fs.nr_open = 1000000</span></span>
<span class="line"><span style="color:#9ECBFF;">EOF</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">cat</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&gt;</span><span style="color:#032F62;">/etc/sysctl.d/20-solana-udp-buffers.conf</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&lt;&lt;</span><span style="color:#032F62;">EOF</span></span>
<span class="line"><span style="color:#032F62;"># Increase UDP buffer size</span></span>
<span class="line"><span style="color:#032F62;">net.core.rmem_default = 134217728</span></span>
<span class="line"><span style="color:#032F62;">net.core.rmem_max = 134217728</span></span>
<span class="line"><span style="color:#032F62;">net.core.wmem_default = 134217728</span></span>
<span class="line"><span style="color:#032F62;">net.core.wmem_max = 134217728</span></span>
<span class="line"><span style="color:#032F62;"># Increase memory mapped files limit</span></span>
<span class="line"><span style="color:#032F62;">vm.max_map_count = 1000000</span></span>
<span class="line"></span>
<span class="line"><span style="color:#032F62;"># Increase number of allowed open file descriptors</span></span>
<span class="line"><span style="color:#032F62;">fs.nr_open = 1000000</span></span>
<span class="line"><span style="color:#032F62;">EOF</span></span></code></pre></div><ul><li>生效</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">sysctl</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-p</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/etc/sysctl.d/20-solana-udp-buffers.conf</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">sysctl</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-p</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/etc/sysctl.d/20-solana-udp-buffers.conf</span></span></code></pre></div><h2 id="_1-3-增加内存映射文件限制" tabindex="-1">1.3 增加内存映射文件限制 <a class="header-anchor" href="#_1-3-增加内存映射文件限制" aria-label="Permalink to &quot;1.3 增加内存映射文件限制&quot;">​</a></h2><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">cat</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">&gt;</span><span style="color:#9ECBFF;">/etc/sysctl.d/20-solana-mmaps.conf</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">&lt;&lt;</span><span style="color:#9ECBFF;">EOF</span></span>
<span class="line"><span style="color:#9ECBFF;"># Increase memory mapped files limit</span></span>
<span class="line"><span style="color:#9ECBFF;">vm.max_map_count = 1000000</span></span>
<span class="line"><span style="color:#9ECBFF;">EOF</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">cat</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&gt;</span><span style="color:#032F62;">/etc/sysctl.d/20-solana-mmaps.conf</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&lt;&lt;</span><span style="color:#032F62;">EOF</span></span>
<span class="line"><span style="color:#032F62;"># Increase memory mapped files limit</span></span>
<span class="line"><span style="color:#032F62;">vm.max_map_count = 1000000</span></span>
<span class="line"><span style="color:#032F62;">EOF</span></span></code></pre></div><ul><li>生效</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">sysctl</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-p</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/etc/sysctl.d/20-solana-mmaps.conf</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">sysctl</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-p</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/etc/sysctl.d/20-solana-mmaps.conf</span></span></code></pre></div><h2 id="_1-4-systemd" tabindex="-1">1.4 systemd <a class="header-anchor" href="#_1-4-systemd" aria-label="Permalink to &quot;1.4 systemd&quot;">​</a></h2><p>在 /etc/systemd/system.conf 文件的 [Manager] 部分添加如下内容：</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">DefaultLimitNOFILE</span><span style="color:#F97583;">=</span><span style="color:#79B8FF;">1000000</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">DefaultLimitNOFILE</span><span style="color:#D73A49;">=</span><span style="color:#005CC5;">1000000</span></span></code></pre></div><ul><li>重新加载配置</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">systemctl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">daemon-reload</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">systemctl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">daemon-reload</span></span></code></pre></div><h2 id="_1-5-limit" tabindex="-1">1.5 limit <a class="header-anchor" href="#_1-5-limit" aria-label="Permalink to &quot;1.5 limit&quot;">​</a></h2><h3 id="_1-增加流程文件描述器的计数上限" tabindex="-1">1.增加流程文件描述器的计数上限 <a class="header-anchor" href="#_1-增加流程文件描述器的计数上限" aria-label="Permalink to &quot;1.增加流程文件描述器的计数上限&quot;">​</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">cat</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">&gt;</span><span style="color:#9ECBFF;">/etc/security/limits.d/90-solana-nofiles.conf</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">&lt;&lt;</span><span style="color:#9ECBFF;">EOF</span></span>
<span class="line"><span style="color:#9ECBFF;"># Increase process file descriptor count limit</span></span>
<span class="line"><span style="color:#9ECBFF;">* - nofile 1000000</span></span>
<span class="line"><span style="color:#9ECBFF;">EOF</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">cat</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&gt;</span><span style="color:#032F62;">/etc/security/limits.d/90-solana-nofiles.conf</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&lt;&lt;</span><span style="color:#032F62;">EOF</span></span>
<span class="line"><span style="color:#032F62;"># Increase process file descriptor count limit</span></span>
<span class="line"><span style="color:#032F62;">* - nofile 1000000</span></span>
<span class="line"><span style="color:#032F62;">EOF</span></span></code></pre></div><h3 id="_2-修改最大文件数" tabindex="-1">2.修改最大文件数 <a class="header-anchor" href="#_2-修改最大文件数" aria-label="Permalink to &quot;2.修改最大文件数&quot;">​</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;"># vim /etc/security/limits.conf</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">*</span><span style="color:#E1E4E8;"> soft nofile 700000</span></span>
<span class="line"><span style="color:#F97583;">*</span><span style="color:#E1E4E8;"> hard nofile 700000</span></span>
<span class="line"><span style="color:#F97583;">*</span><span style="color:#E1E4E8;"> soft nproc 700000</span></span>
<span class="line"><span style="color:#F97583;">*</span><span style="color:#E1E4E8;"> hard nproc 700000</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;"># vim /etc/security/limits.conf</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">*</span><span style="color:#24292E;"> soft nofile 700000</span></span>
<span class="line"><span style="color:#D73A49;">*</span><span style="color:#24292E;"> hard nofile 700000</span></span>
<span class="line"><span style="color:#D73A49;">*</span><span style="color:#24292E;"> soft nproc 700000</span></span>
<span class="line"><span style="color:#D73A49;">*</span><span style="color:#24292E;"> hard nproc 700000</span></span></code></pre></div><h2 id="_1-6-配置系统日志" tabindex="-1">1.6 配置系统日志 <a class="header-anchor" href="#_1-6-配置系统日志" aria-label="Permalink to &quot;1.6 配置系统日志&quot;">​</a></h2><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;"># vim /etc/rsyslog.d/50-default.conf</span></span>
<span class="line"><span style="color:#6A737D;"># 把下面这几行的注释去掉</span></span>
<span class="line"><span style="color:#F97583;">*</span><span style="color:#E1E4E8;">.=info;</span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;">.=notice;</span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;">.=warn;</span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#B392F0;">auth,authpriv.none</span><span style="color:#E1E4E8;">;</span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#B392F0;">cron,daemon.none</span><span style="color:#E1E4E8;">;</span><span style="color:#79B8FF;">\\</span></span>
<span class="line"><span style="color:#B392F0;">mail,news.none</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-/var/log/messages</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;"># vim /etc/rsyslog.d/50-default.conf</span></span>
<span class="line"><span style="color:#6A737D;"># 把下面这几行的注释去掉</span></span>
<span class="line"><span style="color:#D73A49;">*</span><span style="color:#24292E;">.=info;</span><span style="color:#D73A49;">*</span><span style="color:#24292E;">.=notice;</span><span style="color:#D73A49;">*</span><span style="color:#24292E;">.=warn;</span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#6F42C1;">auth,authpriv.none</span><span style="color:#24292E;">;</span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#6F42C1;">cron,daemon.none</span><span style="color:#24292E;">;</span><span style="color:#005CC5;">\\</span></span>
<span class="line"><span style="color:#6F42C1;">mail,news.none</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-/var/log/messages</span></span></code></pre></div><ul><li>重启服务</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">systemctl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">restart</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">rsyslog.service</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">systemctl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">restart</span><span style="color:#24292E;"> </span><span style="color:#032F62;">rsyslog.service</span></span></code></pre></div><div class="danger custom-block"><p class="custom-block-title">❌ 注意</p><p>最后重启系统防止不生效</p></div><h2 id="_1-7-时间服务" tabindex="-1">1.7 时间服务 <a class="header-anchor" href="#_1-7-时间服务" aria-label="Permalink to &quot;1.7 时间服务&quot;">​</a></h2><p>较大的系统时钟漂移会阻止节点正确参与 Solana 的 <a href="https://docs.anza.xyz/validator/gossip" target="_blank" rel="noreferrer">gossip 协议</a></p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">#保证是utc时间</span></span>
<span class="line"><span style="color:#B392F0;">timedatectl</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">#保证是utc时间</span></span>
<span class="line"><span style="color:#6F42C1;">timedatectl</span></span></code></pre></div>`,31),e=[o];function t(c,r,i,y,d,E){return a(),n("div",null,e)}const u=s(p,[["render",t]]);export{F as __pageData,u as default};
