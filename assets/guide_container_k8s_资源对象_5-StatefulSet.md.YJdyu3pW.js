import{_ as s,o as a,c as n,R as l}from"./chunks/framework.zUbWieqp.js";const C=JSON.parse('{"title":"1. StatefulSetåŸºæœ¬æ¦‚è¿°","description":"","frontmatter":{},"headers":[],"relativePath":"guide/container/k8s/èµ„æºå¯¹è±¡/5-StatefulSet.md","filePath":"guide/container/k8s/èµ„æºå¯¹è±¡/5-StatefulSet.md","lastUpdated":1723447064000}'),p={name:"guide/container/k8s/èµ„æºå¯¹è±¡/5-StatefulSet.md"},o=l(`<p>å®˜æ–¹æ–‡æ¡£,<a href="https://kubernetes.io/zh-cn/docs/concepts/workloads/controllers/statefulset/" target="_blank" rel="noreferrer">https://kubernetes.io/zh-cn/docs/concepts/workloads/controllers/statefulset/</a></p><h1 id="_1-statefulsetåŸºæœ¬æ¦‚è¿°" tabindex="-1">1. StatefulSetåŸºæœ¬æ¦‚è¿° <a class="header-anchor" href="#_1-statefulsetåŸºæœ¬æ¦‚è¿°" aria-label="Permalink to &quot;1. StatefulSetåŸºæœ¬æ¦‚è¿°&quot;">â€‹</a></h1><p>å¯¹äºæˆ‘ä»¬éƒ¨ç½²çš„åº”â½¤ï¼Œâ¼¤ä½“å¯ä»¥åˆ†ä¸ºä¸¤ç±»ï¼Œâ¼€ç±»æ˜¯<code>â½†çŠ¶æ€åº”â½¤</code>ï¼Œâ¼€ç±»æ˜¯<code>æœ‰çŠ¶æ€åº”â½¤</code></p><ul><li><p>åƒwebè¿™ç§ç±»å‹çš„åº”ç”¨ï¼Œå°±å±äºæ— çŠ¶æ€åº”ç”¨ï¼Œä»–ä»¬ä¸éœ€è¦å­˜å‚¨ä»»ä½•æ•°æ®è‡³æœ¬åœ°ï¼Œä¹Ÿæ²¡æœ‰ä»»ä½•æ¬¡åºä¹‹åˆ†ï¼ŒåŒæ—¶æ‰€æä¾›çš„æœåŠ¡ä¹Ÿæ˜¯å®Œå…¨ä¸€æ ·çš„ï¼Œåƒè¿™ç±»åº”ç”¨ï¼Œå°±å¯ä»¥é€šè¿‡Deploymentæ§åˆ¶å™¨æ¥è¿›è¡Œç¼–æ’å’Œéƒ¨ç½²ï¼›</p></li><li><p>åƒMySQLã€Redisè¿™ç±»éœ€è¦å­˜å‚¨æ•°æ®çš„åº”ç”¨ç¨‹åºï¼Œç§°ä¹‹ä¸ºæœ‰çŠ¶æ€åº”ç”¨ï¼Œå®ƒä»¬æœ‰çš„æœ‰è§’è‰²ä¹‹åˆ†ï¼Œæœ‰çš„æ˜¯ä¸»èŠ‚ç‚¹ï¼Œæœ‰çš„æ˜¯ä»èŠ‚ç‚¹ï¼Œè€Œæœ‰çš„åˆå­˜åœ¨å…ˆåæ¬¡åºä¹‹åˆ†ã€‚</p></li></ul><h2 id="_1-0-åº”ç”¨åœºæ™¯" tabindex="-1">1.0 åº”ç”¨åœºæ™¯ <a class="header-anchor" href="#_1-0-åº”ç”¨åœºæ™¯" aria-label="Permalink to &quot;1.0 åº”ç”¨åœºæ™¯&quot;">â€‹</a></h2><p>StatefulSetæ˜¯ä¸€ç§ç”¨äºè¿è¡Œ<code>æœ‰çŠ¶æ€åº”ç”¨ç¨‹åºçš„æ§åˆ¶å™¨</code>ï¼Œå®ƒå…·æœ‰<code>ç¨³å®šçš„ç½‘ç»œæ ‡è¯†ç¬¦</code>ã€<code>æœ‰åºçš„</code>ã€é€ä¸ªæ›´æ–°çš„éƒ¨ç½²æ–¹å¼<code>ä»¥</code>åŠ<code>æŒä¹…æ€§å­˜å‚¨</code>ç­‰ç‰¹ç‚¹ï¼Œé€‚ç”¨äºéœ€è¦è¿™äº›ç‰¹æ€§çš„æœ‰çŠ¶æ€åº”ç”¨ç¨‹åº</p><p>ç®€å•æ¥è¯´:</p><ul><li>Podæœ‰åºçš„éƒ¨ç½²ã€æ‰©å®¹ã€åˆ é™¤å’Œåœæ­¢</li><li>Podåˆ†é…ä¸€ä¸ªç¨³å®šçš„ä¸”å”¯ä¸€çš„ç½‘ç»œæ ‡è¯†</li><li>Podåˆ†é…ä¸€ä¸ªç‹¬äº«çš„å­˜å‚¨</li></ul><h2 id="_1-1-ä»€ä¹ˆæ˜¯statefulset" tabindex="-1">1.1 ä»€ä¹ˆæ˜¯StatefulSet <a class="header-anchor" href="#_1-1-ä»€ä¹ˆæ˜¯statefulset" aria-label="Permalink to &quot;1.1 ä»€ä¹ˆæ˜¯StatefulSet&quot;">â€‹</a></h2><p>StatefulSet æ˜¯ç”¨æ¥ç®¡ç†æœ‰çŠ¶æ€åº”ç”¨çš„å·¥ä½œè´Ÿè½½ API å¯¹è±¡ã€‚</p><p>StatefulSet ç”¨æ¥ç®¡ç†æŸ <a href="https://kubernetes.io/zh-cn/docs/concepts/workloads/pods/" target="_blank" rel="noreferrer">Pod</a> é›†åˆçš„éƒ¨ç½²å’Œæ‰©ç¼©ï¼Œ å¹¶ä¸ºè¿™äº› Pod æä¾›æŒä¹…å­˜å‚¨å’ŒæŒä¹…æ ‡è¯†ç¬¦ã€‚</p><blockquote><p>Kubernetes StatefulSetæ˜¯ä¸€ç§ç”¨äºè¿è¡Œæœ‰çŠ¶æ€åº”ç”¨çš„æ§åˆ¶å™¨ã€‚</p><p>StatefulSetæ˜¯ä¸€ä¸ªæœ‰åºçš„ã€å¯æ ‡è¯†çš„Podç»„ï¼Œå¹¶ä¸”æ¯ä¸ªPodéƒ½æœ‰ä¸€ä¸ªç‹¬ç‰¹çš„æ ‡è¯†ç¬¦ã€‚</p><p>è¿™ä½¿å¾—StatefulSetèƒ½å¤Ÿç®¡ç†æœ‰çŠ¶æ€åº”ç”¨ç¨‹åºï¼Œä¾‹å¦‚æ•°æ®åº“æˆ–é˜Ÿåˆ—æœåŠ¡ï¼Œè¿™äº›åº”ç”¨ç¨‹åºéœ€è¦ç¨³å®šçš„ç½‘ç»œæ ‡è¯†ç¬¦æˆ–æŒä¹…æ€§å­˜å‚¨ï¼Œå¹¶ä¸”éœ€è¦æœ‰åºçš„ã€é€ä¸ªæ›´æ–°çš„éƒ¨ç½²æ–¹å¼ã€‚</p></blockquote><p>ReplicaSet æ§åˆ¶å™¨èƒ½å¤Ÿä»ä¸€ä¸ªé¢„ç½®çš„ Pod æ¨¡æ¿åˆ›å»ºä¸€ä¸ªæˆ–è€…å¤šä¸ª Pod èµ„æºï¼Œé™¤äº†ä¸»æœºåå’Œ IP åœ°å€ä¹‹å¤–ï¼Œè¿™äº› Pod èµ„æºå¹¶æ²¡æœ‰æœ¬è´¨ä¸Šçš„åŒºåˆ«ï¼Œå°±è¿ Pod çš„åç§°ä¹Ÿæ˜¯ä½¿ç”¨åŒä¸€ç§æ•£åˆ—æ¨¡å¼ç”Ÿæˆï¼Œå…·æœ‰å¾ˆå¼ºçš„ç›¸ä¼¼æ€§ã€‚</p><p>è‹¥ ReplicaSet æ§åˆ¶å™¨åœ¨ Pod æ¨¡æ¿ä¸­åŒ…å«äº†æŸäº› PVCï¼ˆPersistent Volume Claimï¼‰çš„å¼•ç”¨ï¼Œåˆ™ç”±å®ƒåˆ›å»ºçš„æ‰€æœ‰ Pod èµ„æºéƒ½å°†å…±äº«æ­¤å­˜å‚¨å·ã€‚PVC åç«¯çš„ PV è®¿é—®æ¨¡å‹é…ç½®ä¸º ReadOnlyMany æˆ–è€… ReadWriteMany æ—¶ï¼Œè¿™äº› Pod èµ„æºä¸­çš„å®¹å™¨åº”ç”¨æŒ‚è½½å­˜å‚¨å·åä¹Ÿå°±æœ‰äº†ç›¸åŒçš„æ•°æ®é›†ã€‚</p><p>ä¸è¿‡å¤§å¤šæ•°æƒ…å†µæ˜¯ï¼Œä¸€ä¸ªé›†ç¾¤ç³»ç»Ÿçš„åˆ†å¸ƒå¼åº”ç”¨ä¸­ï¼Œæ¯ä¸ªå®ä¾‹éƒ½æœ‰å¯èƒ½éœ€è¦å­˜å‚¨ä½¿ç”¨ä¸åŒçš„æ•°æ®é›†ï¼Œæˆ–è€…å„è‡ªæ‹¥æœ‰å…¶ä¸“æœ‰çš„æ•°æ®å‰¯æœ¬ï¼Œä¾‹å¦‚ï¼šåˆ†å¸ƒå¼ç³»ç»Ÿ GlusterFS å’Œ åˆ†å¸ƒå¼æ–‡æ¡£å­˜å‚¨ MongoDB ä¸­çš„æ¯ä¸ªå®ä¾‹å„è‡ªä½¿ç”¨ä¸“æœ‰çš„æ•°æ®é›†ï¼Œåˆ†å¸ƒå¼æœåŠ¡æ¡†æ¶ Zookeeper ä»¥åŠä¸»ä»å¤åˆ¶é›†ç¾¤ä¸­çš„ Redis çš„æ¯ä¸ªå®ä¾‹å„è‡ªæ‹¥æœ‰å…¶ä¸“ç”¨çš„æ•°æ®å‰¯æœ¬ã€‚</p><p>ç”±äº ReplicaSet æ§åˆ¶å™¨ä½¿ç”¨åŒä¸€ä¸ªæ¨¡æ¿ç”Ÿæˆ Pod èµ„æºï¼Œæ˜¾ç„¶ï¼Œå®ƒæ— æ³•å®ç°ä¸ºæ¯ä¸ª Pod èµ„æºåˆ›å»ºä¸“ç”¨çš„å­˜å‚¨å·ï¼Œä»¥åŠç»„ç»‡å¤šä¸ªåªè´Ÿè´£ç”Ÿæˆä¸€ä¸ª Pod èµ„æºçš„ ReplicaSet æ§åˆ¶å™¨åˆ™æœ‰è§„æ¨¡æ‰©å±•ä¸å˜çš„å°´å°¬ã€‚è‡ªä¸»å¼ Pod èµ„æºåˆæ²¡æœ‰è‡ªæ„ˆèƒ½åŠ›ã€‚</p><p>å…¶æ¬¡ï¼Œé™¤äº†è¦ç”¨åˆ°ä¸“ç”¨æŒä¹…åŒ–å­˜å‚¨å·å¤–ï¼Œæœ‰äº›é›†ç¾¤ç±»çš„åˆ†å¸ƒå¼åº”ç”¨å®ä¾‹åœ¨è¿è¡ŒæœŸé—´è¿˜å­˜åœ¨è§’è‰²ä¸Šçš„å·®å¼‚ï¼Œå®ƒä»¬å­˜åœ¨ å•å‘/åŒå‘ çš„åŸºäº IP åœ°å€æˆ– ä¸»æœºå çš„å¼•ç”¨å…³ç³»ï¼Œä¾‹å¦‚ ä¸»ä»å¤åˆ¶é›†ç¾¤ä¸­çš„ MySQL ä»èŠ‚ç‚¹çš„å¼•ç”¨ã€‚è¿™ç±»åº”ç”¨å®ä¾‹ï¼Œæ¯ä¸€ä¸ªéƒ½åº”å½“ä½œä¸€ä¸ªç‹¬ç«‹çš„ä¸ªä½“å¯¹å¾…ã€‚ReplicaSet å¯¹è±¡æ§åˆ¶ä¸‹çš„ Pod èµ„æºé‡æ„åï¼Œå…¶ åç§° å’Œ IPåœ°å€ éƒ½å­˜åœ¨å˜åŠ¨çš„å¯èƒ½æ€§ï¼Œå› æ­¤æ— æ³•é€‚é…æ­¤ç§åœºæ™¯éœ€æ±‚ã€‚</p><p>å› æ­¤ï¼ŒStatefulSetï¼ˆæœ‰å‰¯æœ¬çŠ¶æ€é›†ï¼‰åˆ™æ˜¯ä¸“é—¨ç”¨æ¥æ»¡è¶³æ­¤ç±»åº”ç”¨çš„æ§åˆ¶å™¨ç±»å‹ï¼Œç”±å…¶ç®¡æ§çš„æ¯ä¸ª Pod å¯¹è±¡éƒ½æœ‰ç€å›ºå®šçš„ä¸»æœºåå’Œä¸“ç”¨å­˜å‚¨å·ï¼Œå³ä¾¿è¢«é‡æ„åäº¦èƒ½ä¿æŒä¸å˜ã€‚</p><h2 id="_1-2-statefulsetç‰¹ç‚¹" tabindex="-1">1.2 StatefulSetç‰¹ç‚¹ <a class="header-anchor" href="#_1-2-statefulsetç‰¹ç‚¹" aria-label="Permalink to &quot;1.2 StatefulSetç‰¹ç‚¹&quot;">â€‹</a></h2><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">1.</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">ç¨³å®šä¸”å”¯ä¸€çš„ç½‘ç»œæ ‡è¯†ç¬¦</span></span>
<span class="line"><span style="color:#B392F0;">2.</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">ç¨³å®šä¸”æŒä¹…çš„å­˜å‚¨.</span></span>
<span class="line"><span style="color:#B392F0;">3.</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">æœ‰åºã€å¹³æ»‘åœ°éƒ¨ç½²å’Œæ‰©å±•.</span></span>
<span class="line"><span style="color:#B392F0;">4.</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">æœ‰åºã€å¹³æ»‘çš„åˆ é™¤å’Œç»ˆæ­¢.</span></span>
<span class="line"><span style="color:#B392F0;">5.</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">æœ‰åºçš„æ»šåŠ¨æ›´æ–°</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">1.</span><span style="color:#24292E;"> </span><span style="color:#032F62;">ç¨³å®šä¸”å”¯ä¸€çš„ç½‘ç»œæ ‡è¯†ç¬¦</span></span>
<span class="line"><span style="color:#6F42C1;">2.</span><span style="color:#24292E;"> </span><span style="color:#032F62;">ç¨³å®šä¸”æŒä¹…çš„å­˜å‚¨.</span></span>
<span class="line"><span style="color:#6F42C1;">3.</span><span style="color:#24292E;"> </span><span style="color:#032F62;">æœ‰åºã€å¹³æ»‘åœ°éƒ¨ç½²å’Œæ‰©å±•.</span></span>
<span class="line"><span style="color:#6F42C1;">4.</span><span style="color:#24292E;"> </span><span style="color:#032F62;">æœ‰åºã€å¹³æ»‘çš„åˆ é™¤å’Œç»ˆæ­¢.</span></span>
<span class="line"><span style="color:#6F42C1;">5.</span><span style="color:#24292E;"> </span><span style="color:#032F62;">æœ‰åºçš„æ»šåŠ¨æ›´æ–°</span></span></code></pre></div><p>1.ï¼ˆStatefulSetæä¾›ç¨³å®šçš„Podåç§°ï¼Œç»“åˆHeadLessServiceæä¾›Podå”¯â¼€çš„DNSæ ‡è¯†ï¼‰</p><p>2.ä¸ºæ¯ä¸ªPodæä¾›â¼€ä¸ªPVCï¼Œä½œä¸ºåç«¯çš„å­˜å‚¨ï¼ŒPodæ•…éšœé‡æ–°å¯åŠ¨ä»»ç„¶ä¼šä½¿â½¤æ­¤å‰çš„PVC</p><p>3.â½å¦‚redisä¸»ä»å¤åˆ¶r1-r6ï¼Œâ¼€èˆ¬å…ˆå¯åŠ¨ä¸»èŠ‚ç‚¹r1ï¼Œâ½½åå¯åŠ¨ä»èŠ‚ç‚¹r2-r6</p><p>4.â½å¦‚redisä¸»ä»å¤åˆ¶r1-r6ï¼Œâ¼€èˆ¬å…ˆä»r6-r2ä»èŠ‚ç‚¹å¼€å§‹åˆ é™¤ï¼Œæœ€ååˆ é™¤r1ä¸»èŠ‚ç‚¹</p><p>5.â½å¦‚Redisä¸»ä»å¤åˆ¶r1-r6ï¼Œâ¼€èˆ¬å…ˆæ›´æ–°r2-r6ä»èŠ‚ç‚¹ï¼Œâ½½åæ›´æ–°r1ä¸»èŠ‚ç‚¹ï¼Œå‰ææ˜¯èƒ½å…¼å®¹</p><p>åœ¨ä¸Šâ¾¯æè¿°ä¸­ï¼Œâ€œç¨³å®šçš„â€æ„å‘³ç€ Pod è°ƒåº¦æˆ–é‡è°ƒåº¦çš„æ•´ä¸ªè¿‡ç¨‹æ˜¯æœ‰æŒä¹…æ€§çš„ï¼ˆåç§°ä¸å˜ã€pvcä¸å˜ï¼‰ã€‚å¦‚æœåº”â½¤ç¨‹åºä¸éœ€è¦ä»»ä½•ç¨³å®šçš„æ ‡è¯†ç¬¦æˆ–æœ‰åºçš„éƒ¨ç½²ä»¥åŠåˆ é™¤ï¼Œåˆ™åº”è¯¥ä½¿â½¤â½†çŠ¶æ€çš„å‰¯æœ¬æ§åˆ¶å™¨æ¥éƒ¨ç½²åº”â½¤ç¨‹åºï¼Œâ½å¦‚Deploymentæˆ–è€…ReplicaSet</p><h2 id="_1-3-statefulsetèµ„æºçŠ¶æ€" tabindex="-1">1.3 StatefulSetèµ„æºçŠ¶æ€ <a class="header-anchor" href="#_1-3-statefulsetèµ„æºçŠ¶æ€" aria-label="Permalink to &quot;1.3 StatefulSetèµ„æºçŠ¶æ€&quot;">â€‹</a></h2><p>StatefulSet èµ„æºçš„çŠ¶æ€ä¸»è¦åŒ…æ‹¬ä»¥ä¸‹å‡ ä¸ªæ–¹é¢:</p><ol><li>Replicas: æŒ‡å®šçš„å‰¯æœ¬æ•°,å³ .spec.replicaså­—æ®µçš„å€¼ã€‚è¡¨ç¤º StatefulSet ç®¡ç†çš„å‰¯æœ¬æ•°é‡ã€‚</li><li>ReadyReplicas: è¡¨ç¤ºå·²ç»å°±ç»ªçš„å‰¯æœ¬æ•°é‡,å³å½“å‰è¿è¡Œä¸”å·²ç»READYçš„Podæ•°ã€‚</li><li>CurrentReplicas: è¡¨ç¤ºå½“å‰æ­£åœ¨è¿è¡Œçš„å‰¯æœ¬æ•°é‡,å³è¿è¡Œä¸­çš„Podæ€»æ•°ã€‚</li><li>UpdatedReplicas: è¡¨ç¤ºå·²ç»æ›´æ–°çš„å‰¯æœ¬æ•°é‡,å³æœ€è¿‘ä¸€æ¬¡æ›´æ–°ä¸­,æ›´æ–°æˆåŠŸçš„Podæ•°ã€‚</li><li>CurrentRevision: å½“å‰æ­£åœ¨æ‰§è¡Œçš„ä¿®è®¢ç‰ˆæœ¬å·ã€‚</li><li>UpdateRevision: StatefulSet çš„å½“å‰ä¿®è®¢ç‰ˆæœ¬å·ã€‚ StatefulSet çš„æ¨¡æ¿(.spec.template)æ¯æ¬¡æ›´æ–°æ—¶,è¿™ä¸ªå€¼å°±ä¼šå¢åŠ 1</li><li>collisionCountï¼šè¡¨ç¤ºåœ¨åˆ›å»º Pod æ—¶å‘ç”Ÿçš„å‘½åå†²çªçš„æ¬¡æ•°ã€‚</li><li>UpdateStatus: æœ€è¿‘ä¸€æ¬¡æ›´æ–°çš„çŠ¶æ€,å¯ä»¥æ˜¯&quot;Running&quot;æˆ–è€…&quot;Failed&quot;ã€‚</li><li>ObservedGeneration: æœ€è¿‘ä¸€æ¬¡å¯¹ StatefulSet èµ„æºçš„æ›´æ”¹,å·²ç»è¢«çœ‹åˆ°çš„ Generation æ•°ã€‚ä¹Ÿå°±æ˜¯è¯´å¦‚æœ StatefulSet çš„ .spec å­—æ®µè¢«ä¿®æ”¹,è¯¥å€¼ä¼šæ›´æ–°ã€‚</li></ol><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;"> </span><span style="color:#85E89D;">status</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">observedGeneration</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">2</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">replicas</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">3</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">readyReplicas</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">3</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">currentReplicas</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">3</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">updatedReplicas</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">3</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">updateRevision</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;2&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">currentRevision</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;2&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;"> </span></span>
<span class="line"><span style="color:#9ECBFF;">observedGeneration æ˜¯ 2,è¡¨ç¤º StatefulSet çš„ .spec å­—æ®µå·²ç»ä¿®æ”¹è¿‡ä¸¤æ¬¡ã€‚</span></span>
<span class="line"><span style="color:#9ECBFF;">replicas æ˜¯ 3,è¡¨ç¤ºæŒ‡å®šçš„å‰¯æœ¬æ•°ä¸º 3ã€‚</span></span>
<span class="line"><span style="color:#9ECBFF;">readyReplicas, currentReplicas å’Œ updatedReplicas éƒ½æ˜¯ 3,è¡¨ç¤ºæ‰€æœ‰çš„ 3 ä¸ªå‰¯æœ¬éƒ½å·²ç»å‡†å¤‡å°±ç»ªã€‚</span></span>
<span class="line"><span style="color:#9ECBFF;">updateRevision å’Œ currentRevision éƒ½æ˜¯ &quot;2&quot;,è¡¨ç¤º StatefulSet çš„æ¨¡æ¿å·²ç»æ›´æ–°ä¸¤æ¬¡,å½“å‰æ­£åœ¨è¿è¡Œçš„ä¹Ÿæ˜¯ç¬¬ 2 ä¸ªç‰ˆæœ¬ã€‚</span></span>
<span class="line"><span style="color:#9ECBFF;">updateStatus æ²¡æœ‰å‡ºç°,è¡¨ç¤ºæœ€è¿‘ä¸€æ¬¡æ›´æ–°çŠ¶æ€æ˜¯æ­£å¸¸çš„ã€‚</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;"> </span><span style="color:#22863A;">status</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">observedGeneration</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">2</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">replicas</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">3</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">readyReplicas</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">3</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">currentReplicas</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">3</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">updatedReplicas</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">3</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">updateRevision</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;2&quot;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">currentRevision</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;2&quot;</span></span>
<span class="line"><span style="color:#24292E;"> </span></span>
<span class="line"><span style="color:#032F62;">observedGeneration æ˜¯ 2,è¡¨ç¤º StatefulSet çš„ .spec å­—æ®µå·²ç»ä¿®æ”¹è¿‡ä¸¤æ¬¡ã€‚</span></span>
<span class="line"><span style="color:#032F62;">replicas æ˜¯ 3,è¡¨ç¤ºæŒ‡å®šçš„å‰¯æœ¬æ•°ä¸º 3ã€‚</span></span>
<span class="line"><span style="color:#032F62;">readyReplicas, currentReplicas å’Œ updatedReplicas éƒ½æ˜¯ 3,è¡¨ç¤ºæ‰€æœ‰çš„ 3 ä¸ªå‰¯æœ¬éƒ½å·²ç»å‡†å¤‡å°±ç»ªã€‚</span></span>
<span class="line"><span style="color:#032F62;">updateRevision å’Œ currentRevision éƒ½æ˜¯ &quot;2&quot;,è¡¨ç¤º StatefulSet çš„æ¨¡æ¿å·²ç»æ›´æ–°ä¸¤æ¬¡,å½“å‰æ­£åœ¨è¿è¡Œçš„ä¹Ÿæ˜¯ç¬¬ 2 ä¸ªç‰ˆæœ¬ã€‚</span></span>
<span class="line"><span style="color:#032F62;">updateStatus æ²¡æœ‰å‡ºç°,è¡¨ç¤ºæœ€è¿‘ä¸€æ¬¡æ›´æ–°çŠ¶æ€æ˜¯æ­£å¸¸çš„ã€‚</span></span></code></pre></div><h2 id="_1-4-statefulsetç»„æˆéƒ¨åˆ†" tabindex="-1">1.4 StatefulSetç»„æˆéƒ¨åˆ† <a class="header-anchor" href="#_1-4-statefulsetç»„æˆéƒ¨åˆ†" aria-label="Permalink to &quot;1.4 StatefulSetç»„æˆéƒ¨åˆ†&quot;">â€‹</a></h2><p>StatefulSetç”±ä¸‰ä¸ªç»„ä»¶ç»„æˆï¼š<code>HeadLessService</code>ã€<code>StateFulSetæ§åˆ¶å™¨</code>ã€<code>VolumeClaimTemplate</code></p><p><img src="https://nnaigos.oss-cn-hangzhou.aliyuncs.com/imgs/202406051822414.png" alt="image-20240605182154021"></p><h3 id="statefulsetæ§åˆ¶å™¨" tabindex="-1">StatefulSetæ§åˆ¶å™¨ <a class="header-anchor" href="#statefulsetæ§åˆ¶å™¨" aria-label="Permalink to &quot;StatefulSetæ§åˆ¶å™¨&quot;">â€‹</a></h3><p>StatefulSetåç§°æ˜¯å›ºå®šï¼Œä¸”åˆ›å»ºæ—¶æŒ‰ç…§é¡ºåºè¿›â¾åˆ›å»ºï¼Œå¹¶å›ºå®šå¯¹åº”çš„Podåç§°</p><h3 id="headless-service" tabindex="-1">Headless Service <a class="header-anchor" href="#headless-service" aria-label="Permalink to &quot;Headless Service&quot;">â€‹</a></h3><p>ç”¨äºä¸ºPodèµ„æºæ ‡è¯†ç¬¦ç”Ÿæˆå¯è§£æçš„DNSè®°å½•</p><h4 id="ä¸ºä»€ä¹ˆè¦æœ‰headless" tabindex="-1">ä¸ºä»€ä¹ˆè¦æœ‰headless <a class="header-anchor" href="#ä¸ºä»€ä¹ˆè¦æœ‰headless" aria-label="Permalink to &quot;ä¸ºä»€ä¹ˆè¦æœ‰headless&quot;">â€‹</a></h4><p>åœ¨deploymentä¸­ï¼Œæ¯ä¸€ä¸ªpodæ˜¯æ²¡æœ‰åç§°ï¼Œæ˜¯éšæœºå­—ç¬¦ä¸²ï¼Œæ˜¯æ— åºçš„ã€‚è€Œstatefulsetä¸­æ˜¯è¦æ±‚æœ‰åºçš„ï¼Œæ¯ä¸€ä¸ªpodçš„åç§°å¿…é¡»æ˜¯å›ºå®šçš„ã€‚å½“èŠ‚ç‚¹æŒ‚äº†ï¼Œé‡å»ºä¹‹åçš„æ ‡è¯†ç¬¦æ˜¯ä¸å˜çš„ï¼Œæ¯ä¸€ä¸ªèŠ‚ç‚¹çš„èŠ‚ç‚¹åç§°æ˜¯ä¸èƒ½æ”¹å˜çš„ã€‚podåç§°æ˜¯ä½œä¸ºpodè¯†åˆ«çš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼Œå¿…é¡»ä¿è¯å…¶æ ‡è¯†ç¬¦çš„ç¨³å®šå¹¶ä¸”å”¯ä¸€ã€‚ â€‚â€‚â€‚â€‚ä¸ºäº†å®ç°æ ‡è¯†ç¬¦çš„ç¨³å®šï¼Œè¿™æ—¶å€™å°±éœ€è¦ä¸€ä¸ªheadless service è§£æç›´è¾¾åˆ°podï¼Œè¿˜éœ€è¦ç»™podé…ç½®ä¸€ä¸ªå”¯ä¸€çš„åç§°ã€‚</p><h4 id="headless-ä½¿ç”¨åœºæ™¯" tabindex="-1">headless ä½¿ç”¨åœºæ™¯ <a class="header-anchor" href="#headless-ä½¿ç”¨åœºæ™¯" aria-label="Permalink to &quot;headless ä½¿ç”¨åœºæ™¯&quot;">â€‹</a></h4><p>é›†ç¾¤å†…éƒ¨é€šä¿¡ï¼šHeadless Serviceå¯ä»¥è¢«ç”¨æ¥å®ç°Podä¹‹é—´çš„ç›´æ¥é€šä¿¡ï¼Œä¾‹å¦‚æ•°æ®åº“é›†ç¾¤ä¸­çš„å„ä¸ªèŠ‚ç‚¹ä¹‹é—´çš„é€šä¿¡ã€‚</p><p>åˆ†å¸ƒå¼è®¡ç®—ï¼šHeadless Serviceå¯ä»¥è¢«ç”¨æ¥å®ç°<code>åˆ†å¸ƒå¼è®¡ç®—</code>ä¸­çš„ä»»åŠ¡åˆ†å‘å’Œç»“æœæ”¶é›†ï¼Œä¾‹å¦‚MapReduceä¸­çš„Mapå’ŒReduceèŠ‚ç‚¹ä¹‹é—´çš„é€šä¿¡ã€‚</p><p>è‡ªå®šä¹‰æœåŠ¡å‘ç°ï¼šHeadless Serviceå¯ä»¥è¢«ç”¨æ¥å®ç°ä¸€äº›è‡ªå®šä¹‰çš„æœåŠ¡å‘ç°æœºåˆ¶ï¼Œä¾‹å¦‚ä¸€äº›å¤æ‚çš„åº”ç”¨ç¨‹åºä¸­çš„æœåŠ¡å‘ç°å’Œè·¯ç”±ã€‚</p><h4 id="headless-å’Œ-serviceå¯¹æ¯”" tabindex="-1">Headless å’Œ Serviceå¯¹æ¯” <a class="header-anchor" href="#headless-å’Œ-serviceå¯¹æ¯”" aria-label="Permalink to &quot;Headless å’Œ Serviceå¯¹æ¯”&quot;">â€‹</a></h4><p><img src="https://nnaigos.oss-cn-hangzhou.aliyuncs.com/imgs/202406061116195.png" alt="image-20240606111619188"></p><p>â½¤æ¥é…ç½®æ¯ä¸ªPodçš„DNSåç§°ï¼Œåªè¦Podçš„åç§°ä¸å˜åŒ–ï¼Œä»–ä»¬çš„DNSå°±æ˜¯ç¨³å®šä¸”æŒä¹…çš„</p><p>Headless Serviceæ˜¯æ²¡æœ‰Cluster IPçš„Serviceï¼ˆä¸æ™®é€šServiceçš„åŒºåˆ«ï¼‰ï¼Œåœ¨Headless Serviceä¸­å¯ä»¥çœ‹åˆ°spec.ClusterIP=Noneã€‚</p><p>è‹¥è§£æHeadless Serviceçš„DNSåŸŸåï¼Œè¿”å›çš„æ˜¯è¯¥Serviceå¯¹åº”çš„å…¨éƒ¨podçš„Endpointåˆ—è¡¨ï¼ŒStatefulSetåœ¨Headless ServiceåŸºç¡€ä¸Šä¸ºStatefulSetæ§åˆ¶çš„æ¯ä¸ªpodå®ä¾‹åˆ›å»ºDNSåŸŸåï¼Œæ ¼å¼ä¸º$(pod_name).$(headless_service_name)ï¼Œå…¨é™å®šåŸŸåä¸ºï¼šFQDNï¼š$(pod_name).$(headless_service_name).$(namespace_name).svc.cluster.local</p><h4 id="æ¡ˆä¾‹" tabindex="-1">æ¡ˆä¾‹ <a class="header-anchor" href="#æ¡ˆä¾‹" aria-label="Permalink to &quot;æ¡ˆä¾‹&quot;">â€‹</a></h4><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#85E89D;">apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">v1</span></span>
<span class="line"><span style="color:#85E89D;">kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Service</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;">#èµ„æºç±»å‹</span></span>
<span class="line"><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">nginx</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">labels</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">app</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">nginx</span></span>
<span class="line"><span style="color:#85E89D;">spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">ports</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  - </span><span style="color:#85E89D;">port</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">80</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">web</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">clusterIP</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">None</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># ä¸ºnoneï¼Œ</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">selector</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">app</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">nginx</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#22863A;">apiVersion</span><span style="color:#24292E;">: </span><span style="color:#032F62;">v1</span></span>
<span class="line"><span style="color:#22863A;">kind</span><span style="color:#24292E;">: </span><span style="color:#032F62;">Service</span><span style="color:#24292E;"> </span><span style="color:#6A737D;">#èµ„æºç±»å‹</span></span>
<span class="line"><span style="color:#22863A;">metadata</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">nginx</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">labels</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">app</span><span style="color:#24292E;">: </span><span style="color:#032F62;">nginx</span></span>
<span class="line"><span style="color:#22863A;">spec</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">ports</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  - </span><span style="color:#22863A;">port</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">80</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">web</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">clusterIP</span><span style="color:#24292E;">: </span><span style="color:#032F62;">None</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># ä¸ºnoneï¼Œ</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">selector</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">app</span><span style="color:#24292E;">: </span><span style="color:#032F62;">nginx</span></span></code></pre></div><p>è¿™ä¸ª Service è¢«åˆ›å»ºåå¹¶ä¸ä¼šè¢«åˆ†é…ä¸€ä¸ª VIPï¼Œè€Œæ˜¯ä¼šä»¥ DNS è®°å½•çš„æ–¹å¼æš´éœ²å‡ºå®ƒæ‰€ä»£ç†çš„ Podæ ¼å¼ä¸º</p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#9ECBFF;">&lt;pod-name&gt;.&lt;svc-name&gt;.&lt;namespace&gt;.svc.cluster.local</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#032F62;">&lt;pod-name&gt;.&lt;svc-name&gt;.&lt;namespace&gt;.svc.cluster.local</span></span></code></pre></div><h3 id="volumeclaimtemplate" tabindex="-1">VolumeClaimTemplate <a class="header-anchor" href="#volumeclaimtemplate" aria-label="Permalink to &quot;VolumeClaimTemplate&quot;">â€‹</a></h3><p>ä½œä¸ºåˆ†å¸ƒå¼ç³»ç»Ÿï¼Œæ¯ä¸ªPodçš„æ•°æ®æ˜¯ä¸â¼€æ ·çš„ï¼Œæ‰€ä»¥æ¯ä¸ªPodåº”è¯¥æœ‰â¾ƒâ¼°çš„ä¸“æœ‰æ•°æ®ï¼Œæ‰€ä»¥ä»–ä»¬ä¸èƒ½ä½¿â½¤åŒâ¼€ä¸ªå­˜å‚¨å·ï¼Œåº”è¯¥ä½¿â½¤å„â¾ƒâ¾ƒâ¼°çš„å­˜å‚¨å·ã€‚(å­˜å‚¨å·ç”³è¯·æ¨¡æ¿)</p><h4 id="ä¸ºä»€ä¹ˆè¦-æœ‰volumeclaintemplate" tabindex="-1">ä¸ºä»€ä¹ˆè¦ æœ‰volumeClainTemplate <a class="header-anchor" href="#ä¸ºä»€ä¹ˆè¦-æœ‰volumeclaintemplate" aria-label="Permalink to &quot;ä¸ºä»€ä¹ˆè¦ æœ‰volumeClainTemplate&quot;">â€‹</a></h4><p>å¤§éƒ¨åˆ†æœ‰çŠ¶æ€å‰¯æœ¬é›†éƒ½ä¼šç”¨åˆ°æŒä¹…å­˜å‚¨ï¼Œæ¯”å¦‚åˆ†å¸ƒå¼ç³»ç»Ÿæ¥è¯´ï¼Œç”±äºæ•°æ®æ˜¯ä¸ä¸€æ ·çš„ï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½éœ€è¦è‡ªå·±ä¸“ç”¨çš„å­˜å‚¨èŠ‚ç‚¹ã€‚è€Œåœ¨deploymentä¸­podæ¨¡æ¿ä¸­åˆ›å»ºçš„å­˜å‚¨å·æ˜¯<code>ä¸€ä¸ªå…±äº«çš„å­˜å‚¨å·</code>ï¼Œå¤šä¸ªpodä½¿ç”¨åŒä¸€ä¸ªå­˜å‚¨å·ï¼Œè€Œstatefulsetå®šä¹‰ä¸­çš„æ¯ä¸€ä¸ªpodéƒ½ä¸èƒ½ä½¿ç”¨åŒä¸€ä¸ªå­˜å‚¨å·ï¼Œç”±æ­¤åŸºäºpodæ¨¡æ¿åˆ›å»ºpodæ˜¯ä¸é€‚åº”çš„ï¼Œè¿™å°±éœ€è¦å¼•å…¥volumeClainTemplateï¼Œå½“åœ¨ä½¿ç”¨statefulsetåˆ›å»ºpodæ—¶ï¼Œä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªPVCï¼Œä»è€Œè¯·æ±‚ç»‘å®šä¸€ä¸ªPVï¼Œä»è€Œæœ‰è‡ªå·±ä¸“ç”¨çš„å­˜å‚¨å·ã€‚</p><h2 id="_1-4-statefulsetæ›´æ–°ç­–ç•¥" tabindex="-1">1.4 StatefulSetæ›´æ–°ç­–ç•¥ <a class="header-anchor" href="#_1-4-statefulsetæ›´æ–°ç­–ç•¥" aria-label="Permalink to &quot;1.4 StatefulSetæ›´æ–°ç­–ç•¥&quot;">â€‹</a></h2><p>Kubernetes 1.7 ç‰ˆæœ¬èµ·ï¼ŒStatefulSet èµ„æºæ”¯æŒè‡ªåŠ¨æ›´æ–°æœºåˆ¶ï¼Œå…¶æ›´æ–°ç­–ç•¥ç”± spec.updateStrategy å­—æ®µå®šä¹‰ï¼Œé»˜è®¤ä¸º RollingUpdateï¼Œå³æ»šåŠ¨æ›´æ–°</p><p>StatefulSet çš„æ›´æ–°â½€æŒä¸¤ç§ç­–ç•¥ï¼š<code>onDelete</code> å’Œ<code>RollingUpdate</code>ï¼Œåœ¨.spec.updateStrategy è¿›â¾è®¾å®š.å¹¶ä¸”æ»šåŠ¨æ›´æ–°æ”¯æŒ<code>åˆ†åŒº</code>æ»šåŠ¨æ›´æ–°</p><h3 id="rollingupdateæ»šåŠ¨æ›´æ–°" tabindex="-1">RollingUpdateæ»šåŠ¨æ›´æ–° <a class="header-anchor" href="#rollingupdateæ»šåŠ¨æ›´æ–°" aria-label="Permalink to &quot;RollingUpdateæ»šåŠ¨æ›´æ–°&quot;">â€‹</a></h3><blockquote><p>RollingUpdate æ›´æ–°ç­–ç•¥åœ¨ StatefulSet ä¸­å®ç° Pod çš„è‡ªåŠ¨æ»šåŠ¨æ›´æ–°ã€‚</p><p>å½“StatefulSetçš„ .spec.updateStrategy.type è®¾ç½®ä¸º RollingUpdate æ—¶ï¼Œé»˜è®¤ä¸ºï¼šRollingUpdateã€‚</p><p>StatefulSet æ§åˆ¶å™¨å°†åœ¨ StatefulSet ä¸­åˆ é™¤å¹¶é‡æ–°åˆ›å»ºæ¯ä¸ª Podã€‚ å®ƒå°†ä»¥ä¸ Pod ç»ˆæ­¢ç›¸åŒçš„é¡ºåºè¿›è¡Œï¼ˆä»æœ€å¤§çš„åºæ•°åˆ°æœ€å°çš„åºæ•°ï¼‰ï¼Œæ¯æ¬¡æ›´æ–°ä¸€ä¸ª Podã€‚ åœ¨æ›´æ–°å…¶å‰èº«ä¹‹å‰ï¼Œå®ƒå°†ç­‰å¾…æ­£åœ¨æ›´æ–°çš„ Pod çŠ¶æ€å˜æˆæ­£åœ¨è¿è¡Œå¹¶å°±ç»ªã€‚</p></blockquote><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">#é»˜è®¤æ›´æ–°ç­–ç•¥RollingUpdate</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">updateStrategy:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">rollingUpdate:</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#B392F0;">partition:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">       </span><span style="color:#6A737D;">#ä¸æ›´æ–°å°äº N çš„å‰¯æœ¬</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#79B8FF;">type</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">RollingUpdate</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">#é»˜è®¤æ›´æ–°ç­–ç•¥RollingUpdate</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">updateStrategy:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">rollingUpdate:</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#6F42C1;">partition:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">       </span><span style="color:#6A737D;">#ä¸æ›´æ–°å°äº N çš„å‰¯æœ¬</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#005CC5;">type</span><span style="color:#24292E;">: </span><span style="color:#032F62;">RollingUpdate</span></span></code></pre></div><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">#å‘½ä»¤è·Ÿè¸ª StatefulSet èµ„æºæ»šåŠ¨æ›´æ–°è¿‡ç¨‹ä¸­çš„çŠ¶æ€ä¿¡æ¯</span></span>
<span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">rollout</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">status</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">#å‘½ä»¤è·Ÿè¸ª StatefulSet èµ„æºæ»šåŠ¨æ›´æ–°è¿‡ç¨‹ä¸­çš„çŠ¶æ€ä¿¡æ¯</span></span>
<span class="line"><span style="color:#6F42C1;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">rollout</span><span style="color:#24292E;"> </span><span style="color:#032F62;">status</span></span></code></pre></div><h3 id="ondeleteæ›´æ–°" tabindex="-1">OnDeleteæ›´æ–° <a class="header-anchor" href="#ondeleteæ›´æ–°" aria-label="Permalink to &quot;OnDeleteæ›´æ–°&quot;">â€‹</a></h3><p>å½“ StatefulSet çš„ <code>.spec.updateStrategy.type</code> è®¾ç½®ä¸º<code>OnDelete</code> æ—¶ï¼Œ æ§åˆ¶å™¨å°†ä¸ä¼šâ¾ƒåŠ¨æ›´æ–° StatefulSet ä¸­çš„ Podã€‚â½¤æˆ·å¿…é¡»â¼¿åŠ¨åˆ é™¤ Pod ä»¥ä¾¿è®©æ§åˆ¶å™¨åˆ›å»ºæ–°çš„ Podï¼Œä»¥æ­¤æ¥å¯¹StatefulSet çš„ <code>.spec.template</code> çš„å˜åŠ¨ä½œå‡ºååº”ã€‚</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">ä¿®æ”¹ï¼š</span></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#B392F0;">updateStrategy:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">rollingUpdate:</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#B392F0;">partition:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#79B8FF;">type</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">RollingUpdate</span></span>
<span class="line"><span style="color:#E1E4E8;"> </span></span>
<span class="line"><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">æ”¹ä¸º:</span></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#B392F0;">updateStrategy:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#79B8FF;">type</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">OnDelete</span><span style="color:#E1E4E8;">   </span><span style="color:#6A737D;">#ä¿®æ”¹ä¸ºOnDeleteæ›´æ–°æ¨¡å¼å¹¶ä¿å­˜ï¼Œè¯¥æ›´æ–°ç­–ç•¥æ˜¯ï¼Œåˆ é™¤æ—¶æ‰ä¼šè¿›è¡Œæ›´æ–°</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">ä¿®æ”¹ï¼š</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#6F42C1;">updateStrategy:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">rollingUpdate:</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#6F42C1;">partition:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#005CC5;">type</span><span style="color:#24292E;">: </span><span style="color:#032F62;">RollingUpdate</span></span>
<span class="line"><span style="color:#24292E;"> </span></span>
<span class="line"><span style="color:#24292E;"> </span><span style="color:#6F42C1;">æ”¹ä¸º:</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#6F42C1;">updateStrategy:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#005CC5;">type</span><span style="color:#24292E;">: </span><span style="color:#032F62;">OnDelete</span><span style="color:#24292E;">   </span><span style="color:#6A737D;">#ä¿®æ”¹ä¸ºOnDeleteæ›´æ–°æ¨¡å¼å¹¶ä¿å­˜ï¼Œè¯¥æ›´æ–°ç­–ç•¥æ˜¯ï¼Œåˆ é™¤æ—¶æ‰ä¼šè¿›è¡Œæ›´æ–°</span></span></code></pre></div><div class="warning custom-block"><p class="custom-block-title">ğŸ’¡ æ€»ç»“</p><p>StatefulSet è¿™ä¸ªæ§åˆ¶å™¨çš„ä¸»è¦ä½œç”¨ä¹‹ä¸€ï¼Œå°±æ˜¯ä½¿ç”¨ Pod æ¨¡æ¿åˆ›å»º Pod çš„æ—¶å€™ï¼Œå¯¹å®ƒä»¬è¿›è¡Œç¼–å·ï¼Œå¹¶ä¸”æŒ‰ç…§ç¼–å·é¡ºåºé€ä¸€å®Œæˆåˆ›å»ºå·¥ä½œã€‚è€Œå½“ StatefulSet çš„â€œæ§åˆ¶å¾ªç¯â€å‘ç° Pod çš„â€œå®é™…çŠ¶æ€â€ä¸â€œæœŸæœ›çŠ¶æ€â€ä¸ä¸€è‡´ï¼Œéœ€è¦æ–°å»ºæˆ–è€…åˆ é™¤ Pod è¿›è¡Œâ€œè°ƒè°â€çš„æ—¶å€™ï¼Œå®ƒä¼šä¸¥æ ¼æŒ‰ç…§è¿™äº› Pod ç¼–å·çš„é¡ºåºï¼Œé€ä¸€å®Œæˆè¿™äº›æ“ä½œ.</p><p>åœ¨StatefulSetä¸­ï¼Œæ¯ä¸ªPodéƒ½ä¼šè¢«åˆ†é…ä¸€ä¸ªå”¯ä¸€çš„æ ‡è¯†ç¬¦å’ŒDNSè®°å½•ï¼Œä¾‹å¦‚web-0.web.default.svc.cluster.localã€web-1.web.default.svc.cluster.localç­‰</p></div><h2 id="_1-5-æš‚å­˜æ›´æ–°æ“ä½œ" tabindex="-1">1.5 æš‚å­˜æ›´æ–°æ“ä½œ <a class="header-anchor" href="#_1-5-æš‚å­˜æ›´æ–°æ“ä½œ" aria-label="Permalink to &quot;1.5 æš‚å­˜æ›´æ–°æ“ä½œ&quot;">â€‹</a></h2><p>å½“ç”¨æˆ·éœ€è¦è®¾å®šä¸€ä¸ªæ›´æ–°æ“ä½œï¼Œä½†åˆä¸å¸Œæœ›å®ƒç«‹å³æ‰§è¡Œæ—¶ï¼Œå¯å°†æ›´æ–°æ“ä½œäºˆä»¥ &quot;æš‚å­˜&quot;ï¼Œå¾…æ¡ä»¶æ»¡è¶³åå†æ‰‹åŠ¨è§¦å‘å…¶æ‰§è¡Œæ›´æ–°ã€‚</p><p>StatefulSet èµ„æºçš„åˆ†åŒºæ›´æ–°æœºåˆ¶èƒ½å¤Ÿå®ç°æ­¤é¡¹åŠŸèƒ½ã€‚åœ¨è®¾å®šæ›´æ–°æ“ä½œä¹‹å‰ï¼Œå°†.spec.updateStrategy.rollingUpdate.partition å­—æ®µçš„å€¼è®¾ç½®ä¸º Pod èµ„æºçš„å‰¯æœ¬æ•°é‡ï¼Œå³æ¯” Pod èµ„æºçš„æœ€å¤§ç´¢å¼•å·å¤§ 1ï¼Œè¿™å°±æ„å‘³ç€ï¼Œæ‰€æœ‰çš„ Pod èµ„æºéƒ½ä¸ä¼šå¤„äºå¯ç›´æ¥æ›´æ–°çš„åˆ†åŒºä¹‹å†…ï¼Œé‚£ä¹ˆäºå…¶åè®¾å®šçš„æ›´æ–°æ“ä½œä¹Ÿå°±ä¸ä¼šçœŸæ­£æ‰§è¡Œï¼Œç›´åˆ°ç”¨æˆ·é™ä½åˆ†åŒºç¼–å·è‡³ç°æœ‰ Pod èµ„æºç´¢å¼•å·èŒƒå›´ä¹‹å†…ã€‚</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">#æŸ¥çœ‹å¸®åŠ©</span></span>
<span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">explain</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">statefulset.spec.updateStrategy.rollingUpdate.partition</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">#æŸ¥çœ‹å¸®åŠ©</span></span>
<span class="line"><span style="color:#6F42C1;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">explain</span><span style="color:#24292E;"> </span><span style="color:#032F62;">statefulset.spec.updateStrategy.rollingUpdate.partition</span></span></code></pre></div><p>ä¸‹é¢æµ‹è¯•æ»šåŠ¨æ›´æ–°æš‚å­˜æ›´æ–°æ“ä½œï¼Œé¦–å…ˆå°† StatefulSet èµ„æºæ»šåŠ¨æ›´æ–°åˆ†åŒºå€¼è®¾å®šä¸º 3ï¼š</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">kubectl patch statefulset myapp -p &#39;{&quot;spec&quot;:{&quot;updateStrategy&quot;:{&quot;rollingUpdate&quot;:{&quot;partition&quot;:3}}}}&#39;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">kubectl patch statefulset myapp -p &#39;{&quot;spec&quot;:{&quot;updateStrategy&quot;:{&quot;rollingUpdate&quot;:{&quot;partition&quot;:3}}}}&#39;</span></span></code></pre></div><p>æš‚å­˜çŠ¶æ€çš„æ›´æ–°æ“ä½œå¯¹æ‰€æœ‰çš„ Pod èµ„æºå‡ä¸äº§ç”Ÿå½±å“ï¼Œæ¯”å¦‚å³ä½¿åˆ é™¤æŸ Pod èµ„æºï¼Œå®ƒä¾ç„¶ä¼šåŸºäºæ—§çš„ç‰ˆæœ¬é•œåƒè¿›è¡Œé‡å»º</p><h1 id="_2-æ¡ˆä¾‹" tabindex="-1">2. æ¡ˆä¾‹ <a class="header-anchor" href="#_2-æ¡ˆä¾‹" aria-label="Permalink to &quot;2. æ¡ˆä¾‹&quot;">â€‹</a></h1><div class="warning custom-block"><p class="custom-block-title">ğŸ’¡ è¯´æ˜</p><p>åˆ›å»ºé¡ºåºå¦‚ä¸‹ï¼š</p><p>1ã€Volume</p><p>2ã€Persistent Volume</p><p>3ã€Persistent Volume Claim</p><p>4ã€Headless Service</p><p>5ã€StatefulSet</p><p>Volumeå¯ä»¥æœ‰å¾ˆå¤šç§ç±»å‹ï¼Œæ¯”å¦‚nfsã€glusterfs,ceph RBDç­‰</p></div><h2 id="_2-1-statefulsetèµ„æºè§„èŒƒ" tabindex="-1">2.1 Statefulsetèµ„æºè§„èŒƒ <a class="header-anchor" href="#_2-1-statefulsetèµ„æºè§„èŒƒ" aria-label="Permalink to &quot;2.1 Statefulsetèµ„æºè§„èŒƒ&quot;">â€‹</a></h2><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">#æŸ¥çœ‹å¸®åŠ©</span></span>
<span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">explain</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">statefulset</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">[root@kube-master statefulSet]# kubectl explain statefulset.spec</span></span>
<span class="line"><span style="color:#B392F0;">KIND:</span><span style="color:#E1E4E8;">     </span><span style="color:#9ECBFF;">StatefulSet</span></span>
<span class="line"><span style="color:#B392F0;">VERSION:</span><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">apps/v1</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">RESOURCE:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">spec</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">Objec</span><span style="color:#E1E4E8;">t</span><span style="color:#F97583;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">DESCRIPTION:</span></span>
<span class="line"><span style="color:#E1E4E8;">     </span><span style="color:#B392F0;">Spec</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">defines</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">the</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">desired</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">identities</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">of</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pods</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">in</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">this</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">set.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">     </span><span style="color:#B392F0;">A</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">StatefulSetSpec</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">is</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">the</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">specification</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">of</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">a</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">StatefulSet.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">FIELDS:</span></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#B392F0;">podManagementPolicy</span><span style="color:#E1E4E8;">	</span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">strin</span><span style="color:#E1E4E8;">g</span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;">#Podç®¡ç†ç­–ç•¥</span></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#B392F0;">replicas</span><span style="color:#E1E4E8;">	</span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">intege</span><span style="color:#E1E4E8;">r</span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">#å‰¯æœ¬æ•°é‡</span></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#B392F0;">revisionHistoryLimit</span><span style="color:#E1E4E8;">	</span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">intege</span><span style="color:#E1E4E8;">r</span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;">   </span><span style="color:#6A737D;">#å†å²ç‰ˆæœ¬é™åˆ¶</span></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#B392F0;">selector</span><span style="color:#E1E4E8;">	</span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">Objec</span><span style="color:#E1E4E8;">t</span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-required-</span><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">#é€‰æ‹©å™¨ï¼Œå¿…é€‰é¡¹</span></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#B392F0;">serviceName</span><span style="color:#E1E4E8;">	</span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">strin</span><span style="color:#E1E4E8;">g</span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-required-</span><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;">#æœåŠ¡åç§°ï¼Œå¿…é€‰é¡¹</span></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#B392F0;">template</span><span style="color:#E1E4E8;">	</span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">Objec</span><span style="color:#E1E4E8;">t</span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-required-</span><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">#æ¨¡æ¿ï¼Œå¿…é€‰é¡¹</span></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#B392F0;">updateStrategy</span><span style="color:#E1E4E8;">	</span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">Objec</span><span style="color:#E1E4E8;">t</span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;">       </span><span style="color:#6A737D;">#æ›´æ–°ç­–ç•¥</span></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#B392F0;">volumeClaimTemplates</span><span style="color:#E1E4E8;">	</span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">[]Objec</span><span style="color:#E1E4E8;">t</span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;">   </span><span style="color:#6A737D;">#å­˜å‚¨å·ç”³è¯·æ¨¡æ¿ï¼Œåˆ—è¡¨å¯¹è±¡å½¢å¼</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">#æŸ¥çœ‹å¸®åŠ©</span></span>
<span class="line"><span style="color:#6F42C1;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">explain</span><span style="color:#24292E;"> </span><span style="color:#032F62;">statefulset</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">[root@kube-master statefulSet]# kubectl explain statefulset.spec</span></span>
<span class="line"><span style="color:#6F42C1;">KIND:</span><span style="color:#24292E;">     </span><span style="color:#032F62;">StatefulSet</span></span>
<span class="line"><span style="color:#6F42C1;">VERSION:</span><span style="color:#24292E;">  </span><span style="color:#032F62;">apps/v1</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">RESOURCE:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">spec</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">Objec</span><span style="color:#24292E;">t</span><span style="color:#D73A49;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">DESCRIPTION:</span></span>
<span class="line"><span style="color:#24292E;">     </span><span style="color:#6F42C1;">Spec</span><span style="color:#24292E;"> </span><span style="color:#032F62;">defines</span><span style="color:#24292E;"> </span><span style="color:#032F62;">the</span><span style="color:#24292E;"> </span><span style="color:#032F62;">desired</span><span style="color:#24292E;"> </span><span style="color:#032F62;">identities</span><span style="color:#24292E;"> </span><span style="color:#032F62;">of</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pods</span><span style="color:#24292E;"> </span><span style="color:#032F62;">in</span><span style="color:#24292E;"> </span><span style="color:#032F62;">this</span><span style="color:#24292E;"> </span><span style="color:#032F62;">set.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">     </span><span style="color:#6F42C1;">A</span><span style="color:#24292E;"> </span><span style="color:#032F62;">StatefulSetSpec</span><span style="color:#24292E;"> </span><span style="color:#032F62;">is</span><span style="color:#24292E;"> </span><span style="color:#032F62;">the</span><span style="color:#24292E;"> </span><span style="color:#032F62;">specification</span><span style="color:#24292E;"> </span><span style="color:#032F62;">of</span><span style="color:#24292E;"> </span><span style="color:#032F62;">a</span><span style="color:#24292E;"> </span><span style="color:#032F62;">StatefulSet.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">FIELDS:</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#6F42C1;">podManagementPolicy</span><span style="color:#24292E;">	</span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">strin</span><span style="color:#24292E;">g</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;">  </span><span style="color:#6A737D;">#Podç®¡ç†ç­–ç•¥</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#6F42C1;">replicas</span><span style="color:#24292E;">	</span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">intege</span><span style="color:#24292E;">r</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;">    </span><span style="color:#6A737D;">#å‰¯æœ¬æ•°é‡</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#6F42C1;">revisionHistoryLimit</span><span style="color:#24292E;">	</span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">intege</span><span style="color:#24292E;">r</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;">   </span><span style="color:#6A737D;">#å†å²ç‰ˆæœ¬é™åˆ¶</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#6F42C1;">selector</span><span style="color:#24292E;">	</span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">Objec</span><span style="color:#24292E;">t</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-required-</span><span style="color:#24292E;">    </span><span style="color:#6A737D;">#é€‰æ‹©å™¨ï¼Œå¿…é€‰é¡¹</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#6F42C1;">serviceName</span><span style="color:#24292E;">	</span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">strin</span><span style="color:#24292E;">g</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-required-</span><span style="color:#24292E;">  </span><span style="color:#6A737D;">#æœåŠ¡åç§°ï¼Œå¿…é€‰é¡¹</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#6F42C1;">template</span><span style="color:#24292E;">	</span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">Objec</span><span style="color:#24292E;">t</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-required-</span><span style="color:#24292E;">    </span><span style="color:#6A737D;">#æ¨¡æ¿ï¼Œå¿…é€‰é¡¹</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#6F42C1;">updateStrategy</span><span style="color:#24292E;">	</span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">Objec</span><span style="color:#24292E;">t</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;">       </span><span style="color:#6A737D;">#æ›´æ–°ç­–ç•¥</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#6F42C1;">volumeClaimTemplates</span><span style="color:#24292E;">	</span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">[]Objec</span><span style="color:#24292E;">t</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;">   </span><span style="color:#6A737D;">#å­˜å‚¨å·ç”³è¯·æ¨¡æ¿ï¼Œåˆ—è¡¨å¯¹è±¡å½¢å¼</span></span></code></pre></div><h2 id="_2-2-åˆ›å»ºheadless" tabindex="-1">2.2 åˆ›å»ºHeadless <a class="header-anchor" href="#_2-2-åˆ›å»ºheadless" aria-label="Permalink to &quot;2.2 åˆ›å»ºHeadless&quot;">â€‹</a></h2><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">[</span><span style="color:#9ECBFF;">root@kube-master statefulSet</span><span style="color:#E1E4E8;">]# </span><span style="color:#9ECBFF;">cat 01-web-headless.yaml</span></span>
<span class="line"><span style="color:#85E89D;">apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">v1</span></span>
<span class="line"><span style="color:#85E89D;">kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">Service</span></span>
<span class="line"><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">web-svc</span><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;">#è¿™é‡Œè¦åˆ›å»ºstatefulset é‡Œé¢çš„serviceNameçš„åå­—ä¿æŒä¸€è‡´</span></span>
<span class="line"><span style="color:#85E89D;">spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">selector</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">app</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">my-app</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">clusterIP</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">None</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">ports</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  - </span><span style="color:#85E89D;">port</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">80</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">targetPort</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">80</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">[</span><span style="color:#032F62;">root@kube-master statefulSet</span><span style="color:#24292E;">]# </span><span style="color:#032F62;">cat 01-web-headless.yaml</span></span>
<span class="line"><span style="color:#22863A;">apiVersion</span><span style="color:#24292E;">: </span><span style="color:#032F62;">v1</span></span>
<span class="line"><span style="color:#22863A;">kind</span><span style="color:#24292E;">: </span><span style="color:#032F62;">Service</span></span>
<span class="line"><span style="color:#22863A;">metadata</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">web-svc</span><span style="color:#24292E;">  </span><span style="color:#6A737D;">#è¿™é‡Œè¦åˆ›å»ºstatefulset é‡Œé¢çš„serviceNameçš„åå­—ä¿æŒä¸€è‡´</span></span>
<span class="line"><span style="color:#22863A;">spec</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">selector</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">app</span><span style="color:#24292E;">: </span><span style="color:#032F62;">my-app</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">clusterIP</span><span style="color:#24292E;">: </span><span style="color:#032F62;">None</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">ports</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  - </span><span style="color:#22863A;">port</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">80</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">targetPort</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">80</span></span></code></pre></div><ul><li>æ‰§è¡Œ</li></ul><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">[</span><span style="color:#9ECBFF;">root@kube-master statefulSet</span><span style="color:#E1E4E8;">]# </span><span style="color:#9ECBFF;">kubectl apply -f 01-web-headless.yaml</span></span>
<span class="line"><span style="color:#9ECBFF;">service/my-service-headless created</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">[</span><span style="color:#032F62;">root@kube-master statefulSet</span><span style="color:#24292E;">]# </span><span style="color:#032F62;">kubectl apply -f 01-web-headless.yaml</span></span>
<span class="line"><span style="color:#032F62;">service/my-service-headless created</span></span></code></pre></div><h2 id="_2-3-åˆ›å»ºstatefulsetæœåŠ¡" tabindex="-1">2.3 åˆ›å»ºStatefulSetæœåŠ¡ <a class="header-anchor" href="#_2-3-åˆ›å»ºstatefulsetæœåŠ¡" aria-label="Permalink to &quot;2.3 åˆ›å»ºStatefulSetæœåŠ¡&quot;">â€‹</a></h2><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">[</span><span style="color:#9ECBFF;">root@kube-master statefulSet</span><span style="color:#E1E4E8;">]# </span><span style="color:#9ECBFF;">cat 2-web-statefulset.yaml</span></span>
<span class="line"><span style="color:#85E89D;">apiVersion</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">apps/v1</span></span>
<span class="line"><span style="color:#85E89D;">kind</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">StatefulSet</span></span>
<span class="line"><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">web</span></span>
<span class="line"><span style="color:#85E89D;">spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">replicas</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">3</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">selector</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">matchLabels</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">app</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">my-app</span><span style="color:#E1E4E8;">        </span><span style="color:#6A737D;">#å¿…é¡»åŒ¹é… .spec.template.metadata.labels</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">serviceName</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">web-svc</span><span style="color:#E1E4E8;">   </span><span style="color:#6A737D;">#å£°æ˜å®ƒå±äºå“ªä¸ªHeadless Service.</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">template</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">labels</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">app</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">my-app</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">containers</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      - </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">my-app-web-nginx</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">image</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">nginx:1.16</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">ports</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">        - </span><span style="color:#85E89D;">containerPort</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">80</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">volumeMounts</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">        - </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">my-app-web-vol</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#85E89D;">mountPath</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">/usr/share/nginx/html</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">volumeClaimTemplates</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  - </span><span style="color:#85E89D;">metadata</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">my-app-web-vol</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">spec</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">accessModes</span><span style="color:#E1E4E8;">: [ </span><span style="color:#9ECBFF;">&quot;ReadWriteOnce&quot;</span><span style="color:#E1E4E8;"> ]</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">storageClassName</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;nfs-provisioner-storage&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">resources</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#85E89D;">requests</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#85E89D;">storage</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">1Gi</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">[</span><span style="color:#032F62;">root@kube-master statefulSet</span><span style="color:#24292E;">]# </span><span style="color:#032F62;">cat 2-web-statefulset.yaml</span></span>
<span class="line"><span style="color:#22863A;">apiVersion</span><span style="color:#24292E;">: </span><span style="color:#032F62;">apps/v1</span></span>
<span class="line"><span style="color:#22863A;">kind</span><span style="color:#24292E;">: </span><span style="color:#032F62;">StatefulSet</span></span>
<span class="line"><span style="color:#22863A;">metadata</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">web</span></span>
<span class="line"><span style="color:#22863A;">spec</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">replicas</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">3</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">selector</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">matchLabels</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">app</span><span style="color:#24292E;">: </span><span style="color:#032F62;">my-app</span><span style="color:#24292E;">        </span><span style="color:#6A737D;">#å¿…é¡»åŒ¹é… .spec.template.metadata.labels</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">serviceName</span><span style="color:#24292E;">: </span><span style="color:#032F62;">web-svc</span><span style="color:#24292E;">   </span><span style="color:#6A737D;">#å£°æ˜å®ƒå±äºå“ªä¸ªHeadless Service.</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">template</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">metadata</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">labels</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">app</span><span style="color:#24292E;">: </span><span style="color:#032F62;">my-app</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">spec</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">containers</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">my-app-web-nginx</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">image</span><span style="color:#24292E;">: </span><span style="color:#032F62;">nginx:1.16</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">ports</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">        - </span><span style="color:#22863A;">containerPort</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">80</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">volumeMounts</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">        - </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">my-app-web-vol</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#22863A;">mountPath</span><span style="color:#24292E;">: </span><span style="color:#032F62;">/usr/share/nginx/html</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">volumeClaimTemplates</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  - </span><span style="color:#22863A;">metadata</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">my-app-web-vol</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">spec</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">accessModes</span><span style="color:#24292E;">: [ </span><span style="color:#032F62;">&quot;ReadWriteOnce&quot;</span><span style="color:#24292E;"> ]</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">storageClassName</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;nfs-provisioner-storage&quot;</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">resources</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#22863A;">requests</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#22863A;">storage</span><span style="color:#24292E;">: </span><span style="color:#032F62;">1Gi</span></span></code></pre></div><div class="danger custom-block"><p class="custom-block-title">âŒ æ³¨æ„</p><p>å®šä¹‰ StatefulSet èµ„æºæ—¶ï¼Œspec ä¸­å¿…é¡»è¦åµŒå¥—çš„å­—æ®µä¸º &quot;serviceName&quot; å’Œ &quot;template&quot;ï¼Œç”¨äºæŒ‡å®šå…³è”çš„ Headless Service å’Œè¦ä½¿ç”¨çš„ Pod æ¨¡æ¿</p></div><ul><li>æŸ¥çœ‹</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">[root@kube-master </span><span style="color:#F97583;">~</span><span style="color:#E1E4E8;">]# kubectl get pod</span></span>
<span class="line"><span style="color:#B392F0;">NAME</span><span style="color:#E1E4E8;">                                      </span><span style="color:#9ECBFF;">READY</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">STATUS</span><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">RESTARTS</span><span style="color:#E1E4E8;">        </span><span style="color:#9ECBFF;">AGE</span></span>
<span class="line"><span style="color:#B392F0;">web-0</span><span style="color:#E1E4E8;">                                     </span><span style="color:#79B8FF;">1</span><span style="color:#9ECBFF;">/1</span><span style="color:#E1E4E8;">     </span><span style="color:#9ECBFF;">Running</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;"> (13m </span><span style="color:#9ECBFF;">ago</span><span style="color:#E1E4E8;">)     19m</span></span>
<span class="line"><span style="color:#B392F0;">web-1</span><span style="color:#E1E4E8;">                                     </span><span style="color:#79B8FF;">1</span><span style="color:#9ECBFF;">/1</span><span style="color:#E1E4E8;">     </span><span style="color:#9ECBFF;">Running</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;"> (12m </span><span style="color:#9ECBFF;">ago</span><span style="color:#E1E4E8;">)     19m</span></span>
<span class="line"><span style="color:#B392F0;">web-2</span><span style="color:#E1E4E8;">                                     </span><span style="color:#79B8FF;">1</span><span style="color:#9ECBFF;">/1</span><span style="color:#E1E4E8;">     </span><span style="color:#9ECBFF;">Running</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;"> (12m </span><span style="color:#9ECBFF;">ago</span><span style="color:#E1E4E8;">)     19m</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">[root@kube-master statefulSet]# kubectl get pvc,pv</span></span>
<span class="line"><span style="color:#B392F0;">NAME</span><span style="color:#E1E4E8;">                                                   </span><span style="color:#9ECBFF;">STATUS</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">VOLUME</span><span style="color:#E1E4E8;">                                     </span><span style="color:#9ECBFF;">CAPACITY</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">ACCESS</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">MODES</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">STORAGECLASS</span><span style="color:#E1E4E8;">              </span><span style="color:#9ECBFF;">AGE</span></span>
<span class="line"><span style="color:#B392F0;">persistentvolumeclaim/my-app-web-vol-myapp-web-sts-0</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">Bound</span><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">pvc-0aad5ba3-1921-4772-a410-44ab7239523e</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">1</span><span style="color:#9ECBFF;">Gi</span><span style="color:#E1E4E8;">        </span><span style="color:#9ECBFF;">RWO</span><span style="color:#E1E4E8;">            </span><span style="color:#9ECBFF;">nfs-provisioner-storage</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">82</span><span style="color:#9ECBFF;">m</span></span>
<span class="line"><span style="color:#B392F0;">persistentvolumeclaim/my-app-web-vol-myapp-web-sts-1</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">Bound</span><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">pvc-1348f5f1-1505-49fd-aa33-f251ef8ffc00</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">1</span><span style="color:#9ECBFF;">Gi</span><span style="color:#E1E4E8;">        </span><span style="color:#9ECBFF;">RWO</span><span style="color:#E1E4E8;">            </span><span style="color:#9ECBFF;">nfs-provisioner-storage</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">17</span><span style="color:#9ECBFF;">m</span></span>
<span class="line"><span style="color:#B392F0;">persistentvolumeclaim/my-app-web-vol-myapp-web-sts-2</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">Bound</span><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">pvc-7d8f415d-3ebe-49f9-9910-8f3ef36bba57</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">1</span><span style="color:#9ECBFF;">Gi</span><span style="color:#E1E4E8;">        </span><span style="color:#9ECBFF;">RWO</span><span style="color:#E1E4E8;">            </span><span style="color:#9ECBFF;">nfs-provisioner-storage</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">15</span><span style="color:#9ECBFF;">m</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">NAME</span><span style="color:#E1E4E8;">                                                        </span><span style="color:#9ECBFF;">CAPACITY</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">ACCESS</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">MODES</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">RECLAIM</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">POLICY</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">STATUS</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">CLAIM</span><span style="color:#E1E4E8;">                   </span><span style="color:#9ECBFF;">STORAGECLASS</span><span style="color:#E1E4E8;">              </span><span style="color:#9ECBFF;">REASON</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">AGE</span></span>
<span class="line"><span style="color:#B392F0;">persistentvolume/pvc-0aad5ba3-1921-4772-a410-44ab7239523e</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">1</span><span style="color:#9ECBFF;">Gi</span><span style="color:#E1E4E8;">        </span><span style="color:#9ECBFF;">RWO</span><span style="color:#E1E4E8;">            </span><span style="color:#9ECBFF;">Delete</span><span style="color:#E1E4E8;">           </span><span style="color:#9ECBFF;">Bound</span><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">default/my-app-web-vol-myapp-web-sts-0</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">nfs-provisioner-storage</span><span style="color:#E1E4E8;">            </span><span style="color:#79B8FF;">82</span><span style="color:#9ECBFF;">m</span></span>
<span class="line"><span style="color:#B392F0;">persistentvolume/pvc-1348f5f1-1505-49fd-aa33-f251ef8ffc00</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">1</span><span style="color:#9ECBFF;">Gi</span><span style="color:#E1E4E8;">        </span><span style="color:#9ECBFF;">RWO</span><span style="color:#E1E4E8;">            </span><span style="color:#9ECBFF;">Delete</span><span style="color:#E1E4E8;">           </span><span style="color:#9ECBFF;">Bound</span><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">default/my-app-web-vol-myapp-web-sts-1</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">nfs-provisioner-storage</span><span style="color:#E1E4E8;">            </span><span style="color:#79B8FF;">17</span><span style="color:#9ECBFF;">m</span></span>
<span class="line"><span style="color:#B392F0;">persistentvolume/pvc-7d8f415d-3ebe-49f9-9910-8f3ef36bba57</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">1</span><span style="color:#9ECBFF;">Gi</span><span style="color:#E1E4E8;">        </span><span style="color:#9ECBFF;">RWO</span><span style="color:#E1E4E8;">            </span><span style="color:#9ECBFF;">Delete</span><span style="color:#E1E4E8;">           </span><span style="color:#9ECBFF;">Bound</span><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">default/my-app-web-vol-myapp-web-sts-2</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">nfs-provisioner-storage</span><span style="color:#E1E4E8;">            </span><span style="color:#79B8FF;">15</span><span style="color:#9ECBFF;">m</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">[root@kube-master </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# kubectl get pod</span></span>
<span class="line"><span style="color:#6F42C1;">NAME</span><span style="color:#24292E;">                                      </span><span style="color:#032F62;">READY</span><span style="color:#24292E;">   </span><span style="color:#032F62;">STATUS</span><span style="color:#24292E;">    </span><span style="color:#032F62;">RESTARTS</span><span style="color:#24292E;">        </span><span style="color:#032F62;">AGE</span></span>
<span class="line"><span style="color:#6F42C1;">web-0</span><span style="color:#24292E;">                                     </span><span style="color:#005CC5;">1</span><span style="color:#032F62;">/1</span><span style="color:#24292E;">     </span><span style="color:#032F62;">Running</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">1</span><span style="color:#24292E;"> (13m </span><span style="color:#032F62;">ago</span><span style="color:#24292E;">)     19m</span></span>
<span class="line"><span style="color:#6F42C1;">web-1</span><span style="color:#24292E;">                                     </span><span style="color:#005CC5;">1</span><span style="color:#032F62;">/1</span><span style="color:#24292E;">     </span><span style="color:#032F62;">Running</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">1</span><span style="color:#24292E;"> (12m </span><span style="color:#032F62;">ago</span><span style="color:#24292E;">)     19m</span></span>
<span class="line"><span style="color:#6F42C1;">web-2</span><span style="color:#24292E;">                                     </span><span style="color:#005CC5;">1</span><span style="color:#032F62;">/1</span><span style="color:#24292E;">     </span><span style="color:#032F62;">Running</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">1</span><span style="color:#24292E;"> (12m </span><span style="color:#032F62;">ago</span><span style="color:#24292E;">)     19m</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">[root@kube-master statefulSet]# kubectl get pvc,pv</span></span>
<span class="line"><span style="color:#6F42C1;">NAME</span><span style="color:#24292E;">                                                   </span><span style="color:#032F62;">STATUS</span><span style="color:#24292E;">   </span><span style="color:#032F62;">VOLUME</span><span style="color:#24292E;">                                     </span><span style="color:#032F62;">CAPACITY</span><span style="color:#24292E;">   </span><span style="color:#032F62;">ACCESS</span><span style="color:#24292E;"> </span><span style="color:#032F62;">MODES</span><span style="color:#24292E;">   </span><span style="color:#032F62;">STORAGECLASS</span><span style="color:#24292E;">              </span><span style="color:#032F62;">AGE</span></span>
<span class="line"><span style="color:#6F42C1;">persistentvolumeclaim/my-app-web-vol-myapp-web-sts-0</span><span style="color:#24292E;">   </span><span style="color:#032F62;">Bound</span><span style="color:#24292E;">    </span><span style="color:#032F62;">pvc-0aad5ba3-1921-4772-a410-44ab7239523e</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">1</span><span style="color:#032F62;">Gi</span><span style="color:#24292E;">        </span><span style="color:#032F62;">RWO</span><span style="color:#24292E;">            </span><span style="color:#032F62;">nfs-provisioner-storage</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">82</span><span style="color:#032F62;">m</span></span>
<span class="line"><span style="color:#6F42C1;">persistentvolumeclaim/my-app-web-vol-myapp-web-sts-1</span><span style="color:#24292E;">   </span><span style="color:#032F62;">Bound</span><span style="color:#24292E;">    </span><span style="color:#032F62;">pvc-1348f5f1-1505-49fd-aa33-f251ef8ffc00</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">1</span><span style="color:#032F62;">Gi</span><span style="color:#24292E;">        </span><span style="color:#032F62;">RWO</span><span style="color:#24292E;">            </span><span style="color:#032F62;">nfs-provisioner-storage</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">17</span><span style="color:#032F62;">m</span></span>
<span class="line"><span style="color:#6F42C1;">persistentvolumeclaim/my-app-web-vol-myapp-web-sts-2</span><span style="color:#24292E;">   </span><span style="color:#032F62;">Bound</span><span style="color:#24292E;">    </span><span style="color:#032F62;">pvc-7d8f415d-3ebe-49f9-9910-8f3ef36bba57</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">1</span><span style="color:#032F62;">Gi</span><span style="color:#24292E;">        </span><span style="color:#032F62;">RWO</span><span style="color:#24292E;">            </span><span style="color:#032F62;">nfs-provisioner-storage</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">15</span><span style="color:#032F62;">m</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">NAME</span><span style="color:#24292E;">                                                        </span><span style="color:#032F62;">CAPACITY</span><span style="color:#24292E;">   </span><span style="color:#032F62;">ACCESS</span><span style="color:#24292E;"> </span><span style="color:#032F62;">MODES</span><span style="color:#24292E;">   </span><span style="color:#032F62;">RECLAIM</span><span style="color:#24292E;"> </span><span style="color:#032F62;">POLICY</span><span style="color:#24292E;">   </span><span style="color:#032F62;">STATUS</span><span style="color:#24292E;">   </span><span style="color:#032F62;">CLAIM</span><span style="color:#24292E;">                   </span><span style="color:#032F62;">STORAGECLASS</span><span style="color:#24292E;">              </span><span style="color:#032F62;">REASON</span><span style="color:#24292E;">   </span><span style="color:#032F62;">AGE</span></span>
<span class="line"><span style="color:#6F42C1;">persistentvolume/pvc-0aad5ba3-1921-4772-a410-44ab7239523e</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">1</span><span style="color:#032F62;">Gi</span><span style="color:#24292E;">        </span><span style="color:#032F62;">RWO</span><span style="color:#24292E;">            </span><span style="color:#032F62;">Delete</span><span style="color:#24292E;">           </span><span style="color:#032F62;">Bound</span><span style="color:#24292E;">    </span><span style="color:#032F62;">default/my-app-web-vol-myapp-web-sts-0</span><span style="color:#24292E;">   </span><span style="color:#032F62;">nfs-provisioner-storage</span><span style="color:#24292E;">            </span><span style="color:#005CC5;">82</span><span style="color:#032F62;">m</span></span>
<span class="line"><span style="color:#6F42C1;">persistentvolume/pvc-1348f5f1-1505-49fd-aa33-f251ef8ffc00</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">1</span><span style="color:#032F62;">Gi</span><span style="color:#24292E;">        </span><span style="color:#032F62;">RWO</span><span style="color:#24292E;">            </span><span style="color:#032F62;">Delete</span><span style="color:#24292E;">           </span><span style="color:#032F62;">Bound</span><span style="color:#24292E;">    </span><span style="color:#032F62;">default/my-app-web-vol-myapp-web-sts-1</span><span style="color:#24292E;">   </span><span style="color:#032F62;">nfs-provisioner-storage</span><span style="color:#24292E;">            </span><span style="color:#005CC5;">17</span><span style="color:#032F62;">m</span></span>
<span class="line"><span style="color:#6F42C1;">persistentvolume/pvc-7d8f415d-3ebe-49f9-9910-8f3ef36bba57</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">1</span><span style="color:#032F62;">Gi</span><span style="color:#24292E;">        </span><span style="color:#032F62;">RWO</span><span style="color:#24292E;">            </span><span style="color:#032F62;">Delete</span><span style="color:#24292E;">           </span><span style="color:#032F62;">Bound</span><span style="color:#24292E;">    </span><span style="color:#032F62;">default/my-app-web-vol-myapp-web-sts-2</span><span style="color:#24292E;">   </span><span style="color:#032F62;">nfs-provisioner-storage</span><span style="color:#24292E;">            </span><span style="color:#005CC5;">15</span><span style="color:#032F62;">m</span></span></code></pre></div><h2 id="_2-4-æµ‹è¯•dnsè§£æ" tabindex="-1">2.4 æµ‹è¯•dnsè§£æ <a class="header-anchor" href="#_2-4-æµ‹è¯•dnsè§£æ" aria-label="Permalink to &quot;2.4 æµ‹è¯•dnsè§£æ&quot;">â€‹</a></h2><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">æµ‹è¯•æ ¼å¼,$(pod_name</span><span style="color:#E1E4E8;">).</span><span style="color:#9ECBFF;">$(</span><span style="color:#B392F0;">headless_service_name</span><span style="color:#9ECBFF;">)</span><span style="color:#E1E4E8;">.</span><span style="color:#9ECBFF;">$(</span><span style="color:#B392F0;">namespace_name</span><span style="color:#9ECBFF;">)</span><span style="color:#E1E4E8;">.svc.cluster.local</span></span>
<span class="line"><span style="color:#B392F0;">ä¹Ÿå¯ä»¥ç®€å†™ä¸º,$(pod_name</span><span style="color:#E1E4E8;">).</span><span style="color:#9ECBFF;">$(</span><span style="color:#B392F0;">headless_service_name</span><span style="color:#9ECBFF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">run</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-it</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--image=busybox:1.28.3</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">dns-test</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--restart=Never</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--rm</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/bin/sh</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">/</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># nslookup web-1.web-svc</span></span>
<span class="line"><span style="color:#B392F0;">Server:</span><span style="color:#E1E4E8;">    </span><span style="color:#79B8FF;">192.168</span><span style="color:#9ECBFF;">.0.10</span></span>
<span class="line"><span style="color:#B392F0;">Address</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">1</span><span style="color:#9ECBFF;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">192.168</span><span style="color:#9ECBFF;">.0.10</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">kube-dns.kube-system.svc.cluster.local</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">Name:</span><span style="color:#E1E4E8;">      </span><span style="color:#9ECBFF;">web-1.web-svc</span></span>
<span class="line"><span style="color:#B392F0;">Address</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">1</span><span style="color:#9ECBFF;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">172.17</span><span style="color:#9ECBFF;">.74.114</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">web-1.web-svc.default.svc.cluster.local</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">æµ‹è¯•æ ¼å¼,$(pod_name</span><span style="color:#24292E;">).</span><span style="color:#032F62;">$(</span><span style="color:#6F42C1;">headless_service_name</span><span style="color:#032F62;">)</span><span style="color:#24292E;">.</span><span style="color:#032F62;">$(</span><span style="color:#6F42C1;">namespace_name</span><span style="color:#032F62;">)</span><span style="color:#24292E;">.svc.cluster.local</span></span>
<span class="line"><span style="color:#6F42C1;">ä¹Ÿå¯ä»¥ç®€å†™ä¸º,$(pod_name</span><span style="color:#24292E;">).</span><span style="color:#032F62;">$(</span><span style="color:#6F42C1;">headless_service_name</span><span style="color:#032F62;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">run</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-it</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--image=busybox:1.28.3</span><span style="color:#24292E;"> </span><span style="color:#032F62;">dns-test</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--restart=Never</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--rm</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/bin/sh</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">/</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># nslookup web-1.web-svc</span></span>
<span class="line"><span style="color:#6F42C1;">Server:</span><span style="color:#24292E;">    </span><span style="color:#005CC5;">192.168</span><span style="color:#032F62;">.0.10</span></span>
<span class="line"><span style="color:#6F42C1;">Address</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1</span><span style="color:#032F62;">:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">192.168</span><span style="color:#032F62;">.0.10</span><span style="color:#24292E;"> </span><span style="color:#032F62;">kube-dns.kube-system.svc.cluster.local</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">Name:</span><span style="color:#24292E;">      </span><span style="color:#032F62;">web-1.web-svc</span></span>
<span class="line"><span style="color:#6F42C1;">Address</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1</span><span style="color:#032F62;">:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">172.17</span><span style="color:#032F62;">.74.114</span><span style="color:#24292E;"> </span><span style="color:#032F62;">web-1.web-svc.default.svc.cluster.local</span></span></code></pre></div><ul><li>åˆ é™¤pod</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">[root@kube-master statefulSet]# kubectl get pod -owide -l app=my-app</span></span>
<span class="line"><span style="color:#B392F0;">NAME</span><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">READY</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">STATUS</span><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">RESTARTS</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">AGE</span><span style="color:#E1E4E8;">     </span><span style="color:#9ECBFF;">IP</span><span style="color:#E1E4E8;">               </span><span style="color:#9ECBFF;">NODE</span><span style="color:#E1E4E8;">          </span><span style="color:#9ECBFF;">NOMINATED</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">NODE</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">READINESS</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">GATES</span></span>
<span class="line"><span style="color:#B392F0;">web-0</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">1</span><span style="color:#9ECBFF;">/1</span><span style="color:#E1E4E8;">     </span><span style="color:#9ECBFF;">Running</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">          </span><span style="color:#79B8FF;">2</span><span style="color:#9ECBFF;">m58s</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">172.30</span><span style="color:#9ECBFF;">.0.148</span><span style="color:#E1E4E8;">     </span><span style="color:#9ECBFF;">kube-node01</span><span style="color:#E1E4E8;">   </span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">non</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;">           </span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">non</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span></span>
<span class="line"><span style="color:#B392F0;">web-1</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">1</span><span style="color:#9ECBFF;">/1</span><span style="color:#E1E4E8;">     </span><span style="color:#9ECBFF;">Running</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">          </span><span style="color:#79B8FF;">2</span><span style="color:#9ECBFF;">m56s</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">172.17</span><span style="color:#9ECBFF;">.74.117</span><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">kube-node03</span><span style="color:#E1E4E8;">   </span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">non</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;">           </span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">non</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span></span>
<span class="line"><span style="color:#B392F0;">web-2</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">1</span><span style="color:#9ECBFF;">/1</span><span style="color:#E1E4E8;">     </span><span style="color:#9ECBFF;">Running</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">          </span><span style="color:#79B8FF;">2</span><span style="color:#9ECBFF;">m54s</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">172.23</span><span style="color:#9ECBFF;">.127.102</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">kube-node02</span><span style="color:#E1E4E8;">   </span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">non</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;">           </span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">non</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">[root@kube-master statefulSet]# kubectl delete pod -l app=my-app</span></span>
<span class="line"><span style="color:#B392F0;">pod</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;web-0&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">deleted</span></span>
<span class="line"><span style="color:#B392F0;">pod</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;web-1&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">deleted</span></span>
<span class="line"><span style="color:#B392F0;">pod</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;web-2&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">deleted</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">[root@kube-master statefulSet]# kubectl get pod -owide -l app=my-app</span></span>
<span class="line"><span style="color:#B392F0;">NAME</span><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">READY</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">STATUS</span><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">RESTARTS</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">AGE</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">IP</span><span style="color:#E1E4E8;">              </span><span style="color:#9ECBFF;">NODE</span><span style="color:#E1E4E8;">          </span><span style="color:#9ECBFF;">NOMINATED</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">NODE</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">READINESS</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">GATES</span></span>
<span class="line"><span style="color:#B392F0;">web-0</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">1</span><span style="color:#9ECBFF;">/1</span><span style="color:#E1E4E8;">     </span><span style="color:#9ECBFF;">Running</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">          </span><span style="color:#79B8FF;">6</span><span style="color:#9ECBFF;">s</span><span style="color:#E1E4E8;">    </span><span style="color:#79B8FF;">172.30</span><span style="color:#9ECBFF;">.0.176</span><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">kube-node01</span><span style="color:#E1E4E8;">   </span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">non</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;">           </span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">non</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span></span>
<span class="line"><span style="color:#B392F0;">web-1</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">1</span><span style="color:#9ECBFF;">/1</span><span style="color:#E1E4E8;">     </span><span style="color:#9ECBFF;">Running</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">          </span><span style="color:#79B8FF;">4</span><span style="color:#9ECBFF;">s</span><span style="color:#E1E4E8;">    </span><span style="color:#79B8FF;">172.17</span><span style="color:#9ECBFF;">.74.115</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">kube-node03</span><span style="color:#E1E4E8;">   </span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">non</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;">           </span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">non</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span></span>
<span class="line"><span style="color:#B392F0;">web-2</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">1</span><span style="color:#9ECBFF;">/1</span><span style="color:#E1E4E8;">     </span><span style="color:#9ECBFF;">Running</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">          </span><span style="color:#79B8FF;">3</span><span style="color:#9ECBFF;">s</span><span style="color:#E1E4E8;">    </span><span style="color:#79B8FF;">172.23</span><span style="color:#9ECBFF;">.127.87</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">kube-node02</span><span style="color:#E1E4E8;">   </span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">non</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;">           </span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">non</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">[root@kube-master statefulSet]# kubectl get pod -owide -l app=my-app</span></span>
<span class="line"><span style="color:#6F42C1;">NAME</span><span style="color:#24292E;">    </span><span style="color:#032F62;">READY</span><span style="color:#24292E;">   </span><span style="color:#032F62;">STATUS</span><span style="color:#24292E;">    </span><span style="color:#032F62;">RESTARTS</span><span style="color:#24292E;">   </span><span style="color:#032F62;">AGE</span><span style="color:#24292E;">     </span><span style="color:#032F62;">IP</span><span style="color:#24292E;">               </span><span style="color:#032F62;">NODE</span><span style="color:#24292E;">          </span><span style="color:#032F62;">NOMINATED</span><span style="color:#24292E;"> </span><span style="color:#032F62;">NODE</span><span style="color:#24292E;">   </span><span style="color:#032F62;">READINESS</span><span style="color:#24292E;"> </span><span style="color:#032F62;">GATES</span></span>
<span class="line"><span style="color:#6F42C1;">web-0</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">1</span><span style="color:#032F62;">/1</span><span style="color:#24292E;">     </span><span style="color:#032F62;">Running</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">          </span><span style="color:#005CC5;">2</span><span style="color:#032F62;">m58s</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">172.30</span><span style="color:#032F62;">.0.148</span><span style="color:#24292E;">     </span><span style="color:#032F62;">kube-node01</span><span style="color:#24292E;">   </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">non</span><span style="color:#24292E;">e</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;">           </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">non</span><span style="color:#24292E;">e</span><span style="color:#D73A49;">&gt;</span></span>
<span class="line"><span style="color:#6F42C1;">web-1</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">1</span><span style="color:#032F62;">/1</span><span style="color:#24292E;">     </span><span style="color:#032F62;">Running</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">          </span><span style="color:#005CC5;">2</span><span style="color:#032F62;">m56s</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">172.17</span><span style="color:#032F62;">.74.117</span><span style="color:#24292E;">    </span><span style="color:#032F62;">kube-node03</span><span style="color:#24292E;">   </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">non</span><span style="color:#24292E;">e</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;">           </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">non</span><span style="color:#24292E;">e</span><span style="color:#D73A49;">&gt;</span></span>
<span class="line"><span style="color:#6F42C1;">web-2</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">1</span><span style="color:#032F62;">/1</span><span style="color:#24292E;">     </span><span style="color:#032F62;">Running</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">          </span><span style="color:#005CC5;">2</span><span style="color:#032F62;">m54s</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">172.23</span><span style="color:#032F62;">.127.102</span><span style="color:#24292E;">   </span><span style="color:#032F62;">kube-node02</span><span style="color:#24292E;">   </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">non</span><span style="color:#24292E;">e</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;">           </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">non</span><span style="color:#24292E;">e</span><span style="color:#D73A49;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">[root@kube-master statefulSet]# kubectl delete pod -l app=my-app</span></span>
<span class="line"><span style="color:#6F42C1;">pod</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;web-0&quot;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">deleted</span></span>
<span class="line"><span style="color:#6F42C1;">pod</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;web-1&quot;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">deleted</span></span>
<span class="line"><span style="color:#6F42C1;">pod</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;web-2&quot;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">deleted</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">[root@kube-master statefulSet]# kubectl get pod -owide -l app=my-app</span></span>
<span class="line"><span style="color:#6F42C1;">NAME</span><span style="color:#24292E;">    </span><span style="color:#032F62;">READY</span><span style="color:#24292E;">   </span><span style="color:#032F62;">STATUS</span><span style="color:#24292E;">    </span><span style="color:#032F62;">RESTARTS</span><span style="color:#24292E;">   </span><span style="color:#032F62;">AGE</span><span style="color:#24292E;">   </span><span style="color:#032F62;">IP</span><span style="color:#24292E;">              </span><span style="color:#032F62;">NODE</span><span style="color:#24292E;">          </span><span style="color:#032F62;">NOMINATED</span><span style="color:#24292E;"> </span><span style="color:#032F62;">NODE</span><span style="color:#24292E;">   </span><span style="color:#032F62;">READINESS</span><span style="color:#24292E;"> </span><span style="color:#032F62;">GATES</span></span>
<span class="line"><span style="color:#6F42C1;">web-0</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">1</span><span style="color:#032F62;">/1</span><span style="color:#24292E;">     </span><span style="color:#032F62;">Running</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">          </span><span style="color:#005CC5;">6</span><span style="color:#032F62;">s</span><span style="color:#24292E;">    </span><span style="color:#005CC5;">172.30</span><span style="color:#032F62;">.0.176</span><span style="color:#24292E;">    </span><span style="color:#032F62;">kube-node01</span><span style="color:#24292E;">   </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">non</span><span style="color:#24292E;">e</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;">           </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">non</span><span style="color:#24292E;">e</span><span style="color:#D73A49;">&gt;</span></span>
<span class="line"><span style="color:#6F42C1;">web-1</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">1</span><span style="color:#032F62;">/1</span><span style="color:#24292E;">     </span><span style="color:#032F62;">Running</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">          </span><span style="color:#005CC5;">4</span><span style="color:#032F62;">s</span><span style="color:#24292E;">    </span><span style="color:#005CC5;">172.17</span><span style="color:#032F62;">.74.115</span><span style="color:#24292E;">   </span><span style="color:#032F62;">kube-node03</span><span style="color:#24292E;">   </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">non</span><span style="color:#24292E;">e</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;">           </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">non</span><span style="color:#24292E;">e</span><span style="color:#D73A49;">&gt;</span></span>
<span class="line"><span style="color:#6F42C1;">web-2</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">1</span><span style="color:#032F62;">/1</span><span style="color:#24292E;">     </span><span style="color:#032F62;">Running</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">          </span><span style="color:#005CC5;">3</span><span style="color:#032F62;">s</span><span style="color:#24292E;">    </span><span style="color:#005CC5;">172.23</span><span style="color:#032F62;">.127.87</span><span style="color:#24292E;">   </span><span style="color:#032F62;">kube-node02</span><span style="color:#24292E;">   </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">non</span><span style="color:#24292E;">e</span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;">           </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">non</span><span style="color:#24292E;">e</span><span style="color:#D73A49;">&gt;</span></span></code></pre></div><p>Pod çš„åºå·ã€ä¸»æœºåã€SRV æ¡ç›®å’Œè®°å½•åç§°æ²¡æœ‰æ”¹å˜ï¼Œä½†å’Œ Pod ç›¸å…³è”çš„ IP åœ°å€å¯èƒ½å‘ç”Ÿäº†æ”¹å˜ å¦‚æœä½ éœ€è¦æŸ¥æ‰¾å¹¶è¿æ¥ä¸€ä¸ª StatefulSet çš„æ´»åŠ¨æˆå‘˜ï¼Œä½ åº”è¯¥æŸ¥è¯¢ Headless Service çš„ CNAMEå’Œ CNAME ç›¸å…³è”çš„ SRV è®°å½•åªä¼šåŒ…å« StatefulSet ä¸­å¤„äº Running å’Œ Ready çŠ¶æ€çš„ Podã€‚</p><h2 id="_2-5-æ‰©ç¼©statefulset" tabindex="-1">2.5 æ‰©ç¼©StatefulSet <a class="header-anchor" href="#_2-5-æ‰©ç¼©statefulset" aria-label="Permalink to &quot;2.5 æ‰©ç¼©StatefulSet&quot;">â€‹</a></h2><p>å¯¹ StatefulSet èµ„æºæ¥è¯´ï¼Œ<code>kubectl scale</code> å’Œ <code>kubectl path</code> å‘½ä»¤å‡å¯å®ç°æ­¤åŠŸèƒ½ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ kubectl edit å‘½ä»¤ç›´æ¥ä¿®æ”¹å…¶å‰¯æœ¬ï¼Œæˆ–è€…åœ¨ä¿®æ”¹é…ç½®æ–‡ä»¶ä¹‹åï¼Œç”± Kubectl apply å‘½ä»¤é‡æ–°å£°æ˜</p><p>æ‰©å±•StatefulSetå‰¯æœ¬æ•°ï¼Œå®ƒåˆ™ä¼šæŒ‰ç…§ç¼–å·â¼€ä¸ªâ¼€ä¸ªçš„é¡ºåºåˆ›å»ºå‡ºæ¥</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">kubectl scale statefulset web --replicas=5</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">kubectl scale statefulset web --replicas=5</span></span></code></pre></div><p>æŸ¥çœ‹Podçš„åˆ›å»ºè¿‡ç¨‹ï¼Œå¯¹äºåŒ…å« N ä¸ª å‰¯æœ¬çš„ StatefulSetï¼Œå½“éƒ¨ç½² Pod æ—¶ï¼Œå®ƒä»¬æ˜¯ä¾æ¬¡åˆ›å»ºçš„ï¼Œé¡ºåºä¸º0..N-1</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">get</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pod</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-l</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">app=my-app</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-w</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">get</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pod</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-l</span><span style="color:#24292E;"> </span><span style="color:#032F62;">app=my-app</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-w</span></span></code></pre></div><p>æˆ–è€…</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">kubectl patch sts web -p &#39;{&quot;spec&quot;:{&quot;replicas&quot;:4}}&#39; -n nginx-ss  #æ‰©å®¹</span></span>
<span class="line"><span style="color:#e1e4e8;">kubectl patch sts web -p &#39;{&quot;spec&quot;:{&quot;replicas&quot;:2}}&#39; -n nginx-ss  #ç¼©å®¹</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">kubectl patch sts web -p &#39;{&quot;spec&quot;:{&quot;replicas&quot;:4}}&#39; -n nginx-ss  #æ‰©å®¹</span></span>
<span class="line"><span style="color:#24292e;">kubectl patch sts web -p &#39;{&quot;spec&quot;:{&quot;replicas&quot;:2}}&#39; -n nginx-ss  #ç¼©å®¹</span></span></code></pre></div><h2 id="_2-6-æ›´æ–°ç­–ç•¥å’Œç‰ˆæœ¬å‡çº§" tabindex="-1">2.6 æ›´æ–°ç­–ç•¥å’Œç‰ˆæœ¬å‡çº§ <a class="header-anchor" href="#_2-6-æ›´æ–°ç­–ç•¥å’Œç‰ˆæœ¬å‡çº§" aria-label="Permalink to &quot;2.6 æ›´æ–°ç­–ç•¥å’Œç‰ˆæœ¬å‡çº§&quot;">â€‹</a></h2><p>ä¿®æ”¹æ›´æ–°ç­–ç•¥ï¼Œä»¥partitionæ–¹å¼è¿›è¡Œæ›´æ–°ï¼Œæ›´æ–°å€¼ä¸º2ï¼Œåªæœ‰myappç¼–å·å¤§äºç­‰äº2çš„æ‰ä¼šè¿›è¡Œæ›´æ–°ã€‚ç±»ä¼¼äºé‡‘ä¸é›€éƒ¨ç½²æ–¹å¼</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">updateStrategy</span><span style="color:#E1E4E8;"> </span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">rollingUpdate:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">partition:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2</span><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;">#å‰¯æœ¬å¤§äºè®¾ç½®çš„å€¼æ—¶è¿›è¡Œæ›´æ–°ï¼Œä¹Ÿå°±æ˜¯åˆ†æ®µæ›´æ–°,è¿™é‡Œæ˜¯å¤§äº2çš„å‰¯æœ¬æ›´æ–°</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">type</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">RollingUpdate</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">updateStrategy</span><span style="color:#24292E;"> </span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">rollingUpdate:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">partition:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2</span><span style="color:#24292E;">  </span><span style="color:#6A737D;">#å‰¯æœ¬å¤§äºè®¾ç½®çš„å€¼æ—¶è¿›è¡Œæ›´æ–°ï¼Œä¹Ÿå°±æ˜¯åˆ†æ®µæ›´æ–°,è¿™é‡Œæ˜¯å¤§äº2çš„å‰¯æœ¬æ›´æ–°</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#005CC5;">type</span><span style="color:#24292E;">: </span><span style="color:#032F62;">RollingUpdate</span></span></code></pre></div><p>partitonæ˜¯ä¿ç•™å‡ ä¸ªpodä¸æ›´æ–°ï¼Œå…¶ä»–çš„podè¿›è¡Œæ›´æ–°</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">[root@k8s-master mainfests]# kubectl edit sts web</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">æˆ–è€…</span></span>
<span class="line"><span style="color:#E1E4E8;">[root@k8s-master mainfests]# kubectl patch sts web -p </span><span style="color:#9ECBFF;">&#39;{&quot;spec&quot;:{&quot;updateStrategy&quot;:{&quot;rollingUpdate&quot;:{&quot;partition&quot;:2}}}}&#39;</span></span>
<span class="line"><span style="color:#B392F0;">statefulset.apps/myapp</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patched</span></span>
<span class="line"><span style="color:#E1E4E8;">[root@k8s-master </span><span style="color:#F97583;">~</span><span style="color:#E1E4E8;">]# kubectl get sts web</span></span>
<span class="line"><span style="color:#B392F0;">NAME</span><span style="color:#E1E4E8;">      </span><span style="color:#9ECBFF;">DESIRED</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">CURRENT</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">AGE</span></span>
<span class="line"><span style="color:#B392F0;">myapp</span><span style="color:#E1E4E8;">     </span><span style="color:#79B8FF;">4</span><span style="color:#E1E4E8;">         </span><span style="color:#79B8FF;">4</span><span style="color:#E1E4E8;">         </span><span style="color:#79B8FF;">1</span><span style="color:#9ECBFF;">h</span></span>
<span class="line"><span style="color:#E1E4E8;">[root@k8s-master </span><span style="color:#F97583;">~</span><span style="color:#E1E4E8;">]# kubectl describe sts web</span></span>
<span class="line"><span style="color:#B392F0;">Name:</span><span style="color:#E1E4E8;">               </span><span style="color:#9ECBFF;">myapp</span></span>
<span class="line"><span style="color:#B392F0;">Namespace:</span><span style="color:#E1E4E8;">          </span><span style="color:#9ECBFF;">default</span></span>
<span class="line"><span style="color:#B392F0;">CreationTimestamp:</span><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">Wed,</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">10</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Oct</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2018</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">21</span><span style="color:#9ECBFF;">:58:24</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-0400</span></span>
<span class="line"><span style="color:#B392F0;">Selector:</span><span style="color:#E1E4E8;">           </span><span style="color:#9ECBFF;">app=myapp-pod</span></span>
<span class="line"><span style="color:#B392F0;">Labels:</span><span style="color:#E1E4E8;">             </span><span style="color:#F97583;">&lt;</span><span style="color:#9ECBFF;">non</span><span style="color:#E1E4E8;">e</span><span style="color:#F97583;">&gt;</span></span>
<span class="line"><span style="color:#B392F0;">Annotations:</span><span style="color:#E1E4E8;">        </span><span style="color:#9ECBFF;">kubectl.kubernetes.io/last-applied-configuration={&quot;apiVersion&quot;:&quot;apps/v1&quot;,&quot;kind&quot;:&quot;StatefulSet&quot;,&quot;metadata&quot;:{&quot;annotations&quot;:{},&quot;name&quot;:&quot;myapp&quot;,&quot;namespace&quot;:&quot;default&quot;},&quot;spec&quot;:{&quot;replicas&quot;:3,&quot;selector&quot;:{&quot;match...</span></span>
<span class="line"><span style="color:#9ECBFF;">Replicas:           4 desired | 4 total</span></span>
<span class="line"><span style="color:#9ECBFF;">Update Strategy:    RollingUpdate</span></span>
<span class="line"><span style="color:#9ECBFF;">  Partition:        2</span></span>
<span class="line"><span style="color:#9ECBFF;">......</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">[root@k8s-master mainfests]# kubectl edit sts web</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">æˆ–è€…</span></span>
<span class="line"><span style="color:#24292E;">[root@k8s-master mainfests]# kubectl patch sts web -p </span><span style="color:#032F62;">&#39;{&quot;spec&quot;:{&quot;updateStrategy&quot;:{&quot;rollingUpdate&quot;:{&quot;partition&quot;:2}}}}&#39;</span></span>
<span class="line"><span style="color:#6F42C1;">statefulset.apps/myapp</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patched</span></span>
<span class="line"><span style="color:#24292E;">[root@k8s-master </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# kubectl get sts web</span></span>
<span class="line"><span style="color:#6F42C1;">NAME</span><span style="color:#24292E;">      </span><span style="color:#032F62;">DESIRED</span><span style="color:#24292E;">   </span><span style="color:#032F62;">CURRENT</span><span style="color:#24292E;">   </span><span style="color:#032F62;">AGE</span></span>
<span class="line"><span style="color:#6F42C1;">myapp</span><span style="color:#24292E;">     </span><span style="color:#005CC5;">4</span><span style="color:#24292E;">         </span><span style="color:#005CC5;">4</span><span style="color:#24292E;">         </span><span style="color:#005CC5;">1</span><span style="color:#032F62;">h</span></span>
<span class="line"><span style="color:#24292E;">[root@k8s-master </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# kubectl describe sts web</span></span>
<span class="line"><span style="color:#6F42C1;">Name:</span><span style="color:#24292E;">               </span><span style="color:#032F62;">myapp</span></span>
<span class="line"><span style="color:#6F42C1;">Namespace:</span><span style="color:#24292E;">          </span><span style="color:#032F62;">default</span></span>
<span class="line"><span style="color:#6F42C1;">CreationTimestamp:</span><span style="color:#24292E;">  </span><span style="color:#032F62;">Wed,</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">10</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Oct</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2018</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">21</span><span style="color:#032F62;">:58:24</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-0400</span></span>
<span class="line"><span style="color:#6F42C1;">Selector:</span><span style="color:#24292E;">           </span><span style="color:#032F62;">app=myapp-pod</span></span>
<span class="line"><span style="color:#6F42C1;">Labels:</span><span style="color:#24292E;">             </span><span style="color:#D73A49;">&lt;</span><span style="color:#032F62;">non</span><span style="color:#24292E;">e</span><span style="color:#D73A49;">&gt;</span></span>
<span class="line"><span style="color:#6F42C1;">Annotations:</span><span style="color:#24292E;">        </span><span style="color:#032F62;">kubectl.kubernetes.io/last-applied-configuration={&quot;apiVersion&quot;:&quot;apps/v1&quot;,&quot;kind&quot;:&quot;StatefulSet&quot;,&quot;metadata&quot;:{&quot;annotations&quot;:{},&quot;name&quot;:&quot;myapp&quot;,&quot;namespace&quot;:&quot;default&quot;},&quot;spec&quot;:{&quot;replicas&quot;:3,&quot;selector&quot;:{&quot;match...</span></span>
<span class="line"><span style="color:#032F62;">Replicas:           4 desired | 4 total</span></span>
<span class="line"><span style="color:#032F62;">Update Strategy:    RollingUpdate</span></span>
<span class="line"><span style="color:#032F62;">  Partition:        2</span></span>
<span class="line"><span style="color:#032F62;">......</span></span></code></pre></div><p>ç‰ˆæœ¬å‡çº§ï¼Œå°†imageçš„ç‰ˆæœ¬å‡çº§ä¸ºv2ï¼Œå‡çº§åå¯¹æ¯”web-2å’Œweb-1çš„imageç‰ˆæœ¬æ˜¯ä¸åŒçš„ã€‚è¿™æ ·å°±å®ç°äº†é‡‘ä¸é›€å‘å¸ƒçš„æ•ˆæœã€‚</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">[root@k8s-master mainfests]# kubectl set image sts/web myapp=ikubernetes/myapp:v3</span></span>
<span class="line"><span style="color:#B392F0;">statefulset.apps/myapp</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">image</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">updated</span></span>
<span class="line"><span style="color:#E1E4E8;">[root@k8s-master </span><span style="color:#F97583;">~</span><span style="color:#E1E4E8;">]# kubectl get sts -o wide</span></span>
<span class="line"><span style="color:#B392F0;">NAME</span><span style="color:#E1E4E8;">      </span><span style="color:#9ECBFF;">DESIRED</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">CURRENT</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">AGE</span><span style="color:#E1E4E8;">       </span><span style="color:#9ECBFF;">CONTAINERS</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">IMAGES</span></span>
<span class="line"><span style="color:#B392F0;">web</span><span style="color:#E1E4E8;">     </span><span style="color:#79B8FF;">4</span><span style="color:#E1E4E8;">         </span><span style="color:#79B8FF;">4</span><span style="color:#E1E4E8;">         </span><span style="color:#79B8FF;">1</span><span style="color:#9ECBFF;">h</span><span style="color:#E1E4E8;">        </span><span style="color:#9ECBFF;">myapp</span><span style="color:#E1E4E8;">        </span><span style="color:#9ECBFF;">ikubernetes/myapp:v3</span></span>
<span class="line"><span style="color:#E1E4E8;">[root@k8s-master </span><span style="color:#F97583;">~</span><span style="color:#E1E4E8;">]# kubectl get pods web-2 -o yaml </span><span style="color:#F97583;">|</span><span style="color:#B392F0;">grep</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">image</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">-</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">image:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">ikubernetes/myapp:v3</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">imagePullPolicy:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">IfNotPresent</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">image:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">ikubernetes/myapp:v3</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">imageID:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">docker-pullable://ikubernetes/myapp@sha256:b8d74db2515d3c1391c78c5768272b9344428035ef6d72158fd9f6c4239b2c69</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">[root@k8s-master </span><span style="color:#F97583;">~</span><span style="color:#E1E4E8;">]# kubectl get pods web-1 -o yaml </span><span style="color:#F97583;">|</span><span style="color:#B392F0;">grep</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">image</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">-</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">image:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">ikubernetes/myapp:v2</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">imagePullPolicy:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">IfNotPresent</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">image:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">ikubernetes/myapp:v2</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">imageID:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">docker-pullable://ikubernetes/myapp@sha256:85a2b81a62f09a414ea33b74fb8aa686ed9b168294b26b4c819df0be0712d358</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">[root@k8s-master mainfests]# kubectl set image sts/web myapp=ikubernetes/myapp:v3</span></span>
<span class="line"><span style="color:#6F42C1;">statefulset.apps/myapp</span><span style="color:#24292E;"> </span><span style="color:#032F62;">image</span><span style="color:#24292E;"> </span><span style="color:#032F62;">updated</span></span>
<span class="line"><span style="color:#24292E;">[root@k8s-master </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# kubectl get sts -o wide</span></span>
<span class="line"><span style="color:#6F42C1;">NAME</span><span style="color:#24292E;">      </span><span style="color:#032F62;">DESIRED</span><span style="color:#24292E;">   </span><span style="color:#032F62;">CURRENT</span><span style="color:#24292E;">   </span><span style="color:#032F62;">AGE</span><span style="color:#24292E;">       </span><span style="color:#032F62;">CONTAINERS</span><span style="color:#24292E;">   </span><span style="color:#032F62;">IMAGES</span></span>
<span class="line"><span style="color:#6F42C1;">web</span><span style="color:#24292E;">     </span><span style="color:#005CC5;">4</span><span style="color:#24292E;">         </span><span style="color:#005CC5;">4</span><span style="color:#24292E;">         </span><span style="color:#005CC5;">1</span><span style="color:#032F62;">h</span><span style="color:#24292E;">        </span><span style="color:#032F62;">myapp</span><span style="color:#24292E;">        </span><span style="color:#032F62;">ikubernetes/myapp:v3</span></span>
<span class="line"><span style="color:#24292E;">[root@k8s-master </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# kubectl get pods web-2 -o yaml </span><span style="color:#D73A49;">|</span><span style="color:#6F42C1;">grep</span><span style="color:#24292E;"> </span><span style="color:#032F62;">image</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">-</span><span style="color:#24292E;"> </span><span style="color:#032F62;">image:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">ikubernetes/myapp:v3</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">imagePullPolicy:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">IfNotPresent</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">image:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">ikubernetes/myapp:v3</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">imageID:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">docker-pullable://ikubernetes/myapp@sha256:b8d74db2515d3c1391c78c5768272b9344428035ef6d72158fd9f6c4239b2c69</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">[root@k8s-master </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# kubectl get pods web-1 -o yaml </span><span style="color:#D73A49;">|</span><span style="color:#6F42C1;">grep</span><span style="color:#24292E;"> </span><span style="color:#032F62;">image</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">-</span><span style="color:#24292E;"> </span><span style="color:#032F62;">image:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">ikubernetes/myapp:v2</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">imagePullPolicy:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">IfNotPresent</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">image:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">ikubernetes/myapp:v2</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">imageID:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">docker-pullable://ikubernetes/myapp@sha256:85a2b81a62f09a414ea33b74fb8aa686ed9b168294b26b4c819df0be0712d358</span></span></code></pre></div><p>å°†å‰©ä½™çš„Podä¹Ÿæ›´æ–°ç‰ˆæœ¬ï¼Œåªéœ€è¦å°†æ›´æ–°ç­–ç•¥çš„partitionå€¼æ”¹ä¸º0å³å¯ï¼Œå¦‚ä¸‹ï¼š</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">[root@k8s-master mainfests]#  kubectl patch sts web -p </span><span style="color:#9ECBFF;">&#39;{&quot;spec&quot;:{&quot;updateStrategy&quot;:{&quot;rollingUpdate&quot;:{&quot;partition&quot;:0}}}}&#39;</span></span>
<span class="line"><span style="color:#B392F0;">statefulset.apps/web</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">patched</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">[root@k8s-master </span><span style="color:#F97583;">~</span><span style="color:#E1E4E8;">]# kubectl get pods -w</span></span>
<span class="line"><span style="color:#B392F0;">NAME</span><span style="color:#E1E4E8;">                     </span><span style="color:#9ECBFF;">READY</span><span style="color:#E1E4E8;">     </span><span style="color:#9ECBFF;">STATUS</span><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">RESTARTS</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">AGE</span></span>
<span class="line"><span style="color:#B392F0;">web-0</span><span style="color:#E1E4E8;">                  </span><span style="color:#79B8FF;">1</span><span style="color:#9ECBFF;">/1</span><span style="color:#E1E4E8;">       </span><span style="color:#9ECBFF;">Running</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">          </span><span style="color:#79B8FF;">58</span><span style="color:#9ECBFF;">m</span></span>
<span class="line"><span style="color:#B392F0;">web-1</span><span style="color:#E1E4E8;">                  </span><span style="color:#79B8FF;">1</span><span style="color:#9ECBFF;">/1</span><span style="color:#E1E4E8;">       </span><span style="color:#9ECBFF;">Running</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">          </span><span style="color:#79B8FF;">58</span><span style="color:#9ECBFF;">m</span></span>
<span class="line"><span style="color:#B392F0;">web-2</span><span style="color:#E1E4E8;">                  </span><span style="color:#79B8FF;">1</span><span style="color:#9ECBFF;">/1</span><span style="color:#E1E4E8;">       </span><span style="color:#9ECBFF;">Running</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">          </span><span style="color:#79B8FF;">13</span><span style="color:#9ECBFF;">m</span></span>
<span class="line"><span style="color:#B392F0;">web-3</span><span style="color:#E1E4E8;">                  </span><span style="color:#79B8FF;">1</span><span style="color:#9ECBFF;">/1</span><span style="color:#E1E4E8;">       </span><span style="color:#9ECBFF;">Running</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">          </span><span style="color:#79B8FF;">13</span><span style="color:#9ECBFF;">m</span></span>
<span class="line"><span style="color:#B392F0;">web-1</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">1</span><span style="color:#9ECBFF;">/1</span><span style="color:#E1E4E8;">       </span><span style="color:#9ECBFF;">Terminating</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">         </span><span style="color:#79B8FF;">58</span><span style="color:#9ECBFF;">m</span></span>
<span class="line"><span style="color:#B392F0;">web-1</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">0</span><span style="color:#9ECBFF;">/1</span><span style="color:#E1E4E8;">       </span><span style="color:#9ECBFF;">Terminating</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">         </span><span style="color:#79B8FF;">58</span><span style="color:#9ECBFF;">m</span></span>
<span class="line"><span style="color:#B392F0;">web-1</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">0</span><span style="color:#9ECBFF;">/1</span><span style="color:#E1E4E8;">       </span><span style="color:#9ECBFF;">Terminating</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">         </span><span style="color:#79B8FF;">58</span><span style="color:#9ECBFF;">m</span></span>
<span class="line"><span style="color:#B392F0;">web-1</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">0</span><span style="color:#9ECBFF;">/1</span><span style="color:#E1E4E8;">       </span><span style="color:#9ECBFF;">Terminating</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">         </span><span style="color:#79B8FF;">58</span><span style="color:#9ECBFF;">m</span></span>
<span class="line"><span style="color:#B392F0;">web-1</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">0</span><span style="color:#9ECBFF;">/1</span><span style="color:#E1E4E8;">       </span><span style="color:#9ECBFF;">Pending</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">         </span><span style="color:#79B8FF;">0</span><span style="color:#9ECBFF;">s</span></span>
<span class="line"><span style="color:#B392F0;">web-1</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">0</span><span style="color:#9ECBFF;">/1</span><span style="color:#E1E4E8;">       </span><span style="color:#9ECBFF;">Pending</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">         </span><span style="color:#79B8FF;">0</span><span style="color:#9ECBFF;">s</span></span>
<span class="line"><span style="color:#B392F0;">web-1</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">0</span><span style="color:#9ECBFF;">/1</span><span style="color:#E1E4E8;">       </span><span style="color:#9ECBFF;">ContainerCreating</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">         </span><span style="color:#79B8FF;">0</span><span style="color:#9ECBFF;">s</span></span>
<span class="line"><span style="color:#B392F0;">web-1</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">1</span><span style="color:#9ECBFF;">/1</span><span style="color:#E1E4E8;">       </span><span style="color:#9ECBFF;">Running</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">         </span><span style="color:#79B8FF;">2</span><span style="color:#9ECBFF;">s</span></span>
<span class="line"><span style="color:#B392F0;">web-0</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">1</span><span style="color:#9ECBFF;">/1</span><span style="color:#E1E4E8;">       </span><span style="color:#9ECBFF;">Terminating</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">         </span><span style="color:#79B8FF;">58</span><span style="color:#9ECBFF;">m</span></span>
<span class="line"><span style="color:#B392F0;">web-0</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">0</span><span style="color:#9ECBFF;">/1</span><span style="color:#E1E4E8;">       </span><span style="color:#9ECBFF;">Terminating</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">         </span><span style="color:#79B8FF;">58</span><span style="color:#9ECBFF;">m</span></span>
<span class="line"><span style="color:#B392F0;">web-0</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">0</span><span style="color:#9ECBFF;">/1</span><span style="color:#E1E4E8;">       </span><span style="color:#9ECBFF;">Terminating</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">         </span><span style="color:#79B8FF;">58</span><span style="color:#9ECBFF;">m</span></span>
<span class="line"><span style="color:#B392F0;">web-0</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">0</span><span style="color:#9ECBFF;">/1</span><span style="color:#E1E4E8;">       </span><span style="color:#9ECBFF;">Terminating</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">         </span><span style="color:#79B8FF;">58</span><span style="color:#9ECBFF;">m</span></span>
<span class="line"><span style="color:#B392F0;">web-0</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">0</span><span style="color:#9ECBFF;">/1</span><span style="color:#E1E4E8;">       </span><span style="color:#9ECBFF;">Pending</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">         </span><span style="color:#79B8FF;">0</span><span style="color:#9ECBFF;">s</span></span>
<span class="line"><span style="color:#B392F0;">web-0</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">0</span><span style="color:#9ECBFF;">/1</span><span style="color:#E1E4E8;">       </span><span style="color:#9ECBFF;">Pending</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">         </span><span style="color:#79B8FF;">0</span><span style="color:#9ECBFF;">s</span></span>
<span class="line"><span style="color:#B392F0;">web-0</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">0</span><span style="color:#9ECBFF;">/1</span><span style="color:#E1E4E8;">       </span><span style="color:#9ECBFF;">ContainerCreating</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">         </span><span style="color:#79B8FF;">0</span><span style="color:#9ECBFF;">s</span></span>
<span class="line"><span style="color:#B392F0;">web-0</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">1</span><span style="color:#9ECBFF;">/1</span><span style="color:#E1E4E8;">       </span><span style="color:#9ECBFF;">Running</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">         </span><span style="color:#79B8FF;">2</span><span style="color:#9ECBFF;">s</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">[root@k8s-master mainfests]#  kubectl patch sts web -p </span><span style="color:#032F62;">&#39;{&quot;spec&quot;:{&quot;updateStrategy&quot;:{&quot;rollingUpdate&quot;:{&quot;partition&quot;:0}}}}&#39;</span></span>
<span class="line"><span style="color:#6F42C1;">statefulset.apps/web</span><span style="color:#24292E;"> </span><span style="color:#032F62;">patched</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">[root@k8s-master </span><span style="color:#D73A49;">~</span><span style="color:#24292E;">]# kubectl get pods -w</span></span>
<span class="line"><span style="color:#6F42C1;">NAME</span><span style="color:#24292E;">                     </span><span style="color:#032F62;">READY</span><span style="color:#24292E;">     </span><span style="color:#032F62;">STATUS</span><span style="color:#24292E;">    </span><span style="color:#032F62;">RESTARTS</span><span style="color:#24292E;">   </span><span style="color:#032F62;">AGE</span></span>
<span class="line"><span style="color:#6F42C1;">web-0</span><span style="color:#24292E;">                  </span><span style="color:#005CC5;">1</span><span style="color:#032F62;">/1</span><span style="color:#24292E;">       </span><span style="color:#032F62;">Running</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">          </span><span style="color:#005CC5;">58</span><span style="color:#032F62;">m</span></span>
<span class="line"><span style="color:#6F42C1;">web-1</span><span style="color:#24292E;">                  </span><span style="color:#005CC5;">1</span><span style="color:#032F62;">/1</span><span style="color:#24292E;">       </span><span style="color:#032F62;">Running</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">          </span><span style="color:#005CC5;">58</span><span style="color:#032F62;">m</span></span>
<span class="line"><span style="color:#6F42C1;">web-2</span><span style="color:#24292E;">                  </span><span style="color:#005CC5;">1</span><span style="color:#032F62;">/1</span><span style="color:#24292E;">       </span><span style="color:#032F62;">Running</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">          </span><span style="color:#005CC5;">13</span><span style="color:#032F62;">m</span></span>
<span class="line"><span style="color:#6F42C1;">web-3</span><span style="color:#24292E;">                  </span><span style="color:#005CC5;">1</span><span style="color:#032F62;">/1</span><span style="color:#24292E;">       </span><span style="color:#032F62;">Running</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">          </span><span style="color:#005CC5;">13</span><span style="color:#032F62;">m</span></span>
<span class="line"><span style="color:#6F42C1;">web-1</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">1</span><span style="color:#032F62;">/1</span><span style="color:#24292E;">       </span><span style="color:#032F62;">Terminating</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">         </span><span style="color:#005CC5;">58</span><span style="color:#032F62;">m</span></span>
<span class="line"><span style="color:#6F42C1;">web-1</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">0</span><span style="color:#032F62;">/1</span><span style="color:#24292E;">       </span><span style="color:#032F62;">Terminating</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">         </span><span style="color:#005CC5;">58</span><span style="color:#032F62;">m</span></span>
<span class="line"><span style="color:#6F42C1;">web-1</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">0</span><span style="color:#032F62;">/1</span><span style="color:#24292E;">       </span><span style="color:#032F62;">Terminating</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">         </span><span style="color:#005CC5;">58</span><span style="color:#032F62;">m</span></span>
<span class="line"><span style="color:#6F42C1;">web-1</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">0</span><span style="color:#032F62;">/1</span><span style="color:#24292E;">       </span><span style="color:#032F62;">Terminating</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">         </span><span style="color:#005CC5;">58</span><span style="color:#032F62;">m</span></span>
<span class="line"><span style="color:#6F42C1;">web-1</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">0</span><span style="color:#032F62;">/1</span><span style="color:#24292E;">       </span><span style="color:#032F62;">Pending</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">         </span><span style="color:#005CC5;">0</span><span style="color:#032F62;">s</span></span>
<span class="line"><span style="color:#6F42C1;">web-1</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">0</span><span style="color:#032F62;">/1</span><span style="color:#24292E;">       </span><span style="color:#032F62;">Pending</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">         </span><span style="color:#005CC5;">0</span><span style="color:#032F62;">s</span></span>
<span class="line"><span style="color:#6F42C1;">web-1</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">0</span><span style="color:#032F62;">/1</span><span style="color:#24292E;">       </span><span style="color:#032F62;">ContainerCreating</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">         </span><span style="color:#005CC5;">0</span><span style="color:#032F62;">s</span></span>
<span class="line"><span style="color:#6F42C1;">web-1</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">1</span><span style="color:#032F62;">/1</span><span style="color:#24292E;">       </span><span style="color:#032F62;">Running</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">         </span><span style="color:#005CC5;">2</span><span style="color:#032F62;">s</span></span>
<span class="line"><span style="color:#6F42C1;">web-0</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">1</span><span style="color:#032F62;">/1</span><span style="color:#24292E;">       </span><span style="color:#032F62;">Terminating</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">         </span><span style="color:#005CC5;">58</span><span style="color:#032F62;">m</span></span>
<span class="line"><span style="color:#6F42C1;">web-0</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">0</span><span style="color:#032F62;">/1</span><span style="color:#24292E;">       </span><span style="color:#032F62;">Terminating</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">         </span><span style="color:#005CC5;">58</span><span style="color:#032F62;">m</span></span>
<span class="line"><span style="color:#6F42C1;">web-0</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">0</span><span style="color:#032F62;">/1</span><span style="color:#24292E;">       </span><span style="color:#032F62;">Terminating</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">         </span><span style="color:#005CC5;">58</span><span style="color:#032F62;">m</span></span>
<span class="line"><span style="color:#6F42C1;">web-0</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">0</span><span style="color:#032F62;">/1</span><span style="color:#24292E;">       </span><span style="color:#032F62;">Terminating</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">         </span><span style="color:#005CC5;">58</span><span style="color:#032F62;">m</span></span>
<span class="line"><span style="color:#6F42C1;">web-0</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">0</span><span style="color:#032F62;">/1</span><span style="color:#24292E;">       </span><span style="color:#032F62;">Pending</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">         </span><span style="color:#005CC5;">0</span><span style="color:#032F62;">s</span></span>
<span class="line"><span style="color:#6F42C1;">web-0</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">0</span><span style="color:#032F62;">/1</span><span style="color:#24292E;">       </span><span style="color:#032F62;">Pending</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">         </span><span style="color:#005CC5;">0</span><span style="color:#032F62;">s</span></span>
<span class="line"><span style="color:#6F42C1;">web-0</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">0</span><span style="color:#032F62;">/1</span><span style="color:#24292E;">       </span><span style="color:#032F62;">ContainerCreating</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">         </span><span style="color:#005CC5;">0</span><span style="color:#032F62;">s</span></span>
<span class="line"><span style="color:#6F42C1;">web-0</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">1</span><span style="color:#032F62;">/1</span><span style="color:#24292E;">       </span><span style="color:#032F62;">Running</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">         </span><span style="color:#005CC5;">2</span><span style="color:#032F62;">s</span></span></code></pre></div><h2 id="_2-7-åˆ é™¤statefulset" tabindex="-1">2.7 åˆ é™¤StatefulSet <a class="header-anchor" href="#_2-7-åˆ é™¤statefulset" aria-label="Permalink to &quot;2.7 åˆ é™¤StatefulSet&quot;">â€‹</a></h2><p>åˆ é™¤StatefulSetï¼Œå®ƒä¼šä»åå¾€å‰åˆ é™¤ï¼Œå…ˆåˆ é™¤web-1ï¼Œç„¶ååˆ é™¤web-0</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">delete</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">statefulsets</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">name</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">delete</span><span style="color:#24292E;"> </span><span style="color:#032F62;">statefulsets</span><span style="color:#24292E;"> </span><span style="color:#032F62;">name</span></span></code></pre></div><p>åˆ é™¤ Pod æ—¶ï¼Œå®ƒä»¬æ˜¯é€†åºç»ˆâ½Œçš„ï¼Œé¡ºåºä¸º N-1..0</p><blockquote><p>statefulsetåˆ é™¤åˆ†ä¸ºä¸¤ç§</p><p>çº§è”åˆ é™¤[é»˜è®¤] åˆ é™¤statefulsetæ—¶åˆ é™¤pod</p><p>éçº§è”åˆ é™¤ åˆ é™¤statefulsetæ—¶ä¸åˆ é™¤pod</p></blockquote><h3 id="çº§è”åˆ é™¤" tabindex="-1">çº§è”åˆ é™¤ <a class="header-anchor" href="#çº§è”åˆ é™¤" aria-label="Permalink to &quot;çº§è”åˆ é™¤&quot;">â€‹</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">kubectl</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">delete</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">statefulsets</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">name</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">kubectl</span><span style="color:#24292E;"> </span><span style="color:#032F62;">delete</span><span style="color:#24292E;"> </span><span style="color:#032F62;">statefulsets</span><span style="color:#24292E;"> </span><span style="color:#032F62;">name</span></span></code></pre></div><h3 id="éçº§è”åˆ é™¤" tabindex="-1">éçº§è”åˆ é™¤ <a class="header-anchor" href="#éçº§è”åˆ é™¤" aria-label="Permalink to &quot;éçº§è”åˆ é™¤&quot;">â€‹</a></h3><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">[root@kube-master statefulSet]# kubectl delete sts web --cascade=orphan</span></span>
<span class="line"><span style="color:#e1e4e8;">statefulset.apps &quot;web&quot; deleted</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">[root@kube-master statefulSet]# kubectl delete sts web --cascade=orphan</span></span>
<span class="line"><span style="color:#24292e;">statefulset.apps &quot;web&quot; deleted</span></span></code></pre></div><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">[root@kube-master statefulSet]# kubectl get pod -l app=my-app</span></span>
<span class="line"><span style="color:#B392F0;">NAME</span><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">READY</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">STATUS</span><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">RESTARTS</span><span style="color:#E1E4E8;">   </span><span style="color:#9ECBFF;">AGE</span></span>
<span class="line"><span style="color:#B392F0;">web-0</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">1</span><span style="color:#9ECBFF;">/1</span><span style="color:#E1E4E8;">     </span><span style="color:#9ECBFF;">Running</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">          </span><span style="color:#79B8FF;">58</span><span style="color:#9ECBFF;">m</span></span>
<span class="line"><span style="color:#B392F0;">web-1</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">1</span><span style="color:#9ECBFF;">/1</span><span style="color:#E1E4E8;">     </span><span style="color:#9ECBFF;">Running</span><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">          </span><span style="color:#79B8FF;">58</span><span style="color:#9ECBFF;">m</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">[root@kube-master statefulSet]# kubectl get sts</span></span>
<span class="line"><span style="color:#B392F0;">No</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">resources</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">found</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">in</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">default</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">namespace.</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">[root@kube-master statefulSet]# kubectl get pod -l app=my-app</span></span>
<span class="line"><span style="color:#6F42C1;">NAME</span><span style="color:#24292E;">    </span><span style="color:#032F62;">READY</span><span style="color:#24292E;">   </span><span style="color:#032F62;">STATUS</span><span style="color:#24292E;">    </span><span style="color:#032F62;">RESTARTS</span><span style="color:#24292E;">   </span><span style="color:#032F62;">AGE</span></span>
<span class="line"><span style="color:#6F42C1;">web-0</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">1</span><span style="color:#032F62;">/1</span><span style="color:#24292E;">     </span><span style="color:#032F62;">Running</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">          </span><span style="color:#005CC5;">58</span><span style="color:#032F62;">m</span></span>
<span class="line"><span style="color:#6F42C1;">web-1</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">1</span><span style="color:#032F62;">/1</span><span style="color:#24292E;">     </span><span style="color:#032F62;">Running</span><span style="color:#24292E;">   </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">          </span><span style="color:#005CC5;">58</span><span style="color:#032F62;">m</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">[root@kube-master statefulSet]# kubectl get sts</span></span>
<span class="line"><span style="color:#6F42C1;">No</span><span style="color:#24292E;"> </span><span style="color:#032F62;">resources</span><span style="color:#24292E;"> </span><span style="color:#032F62;">found</span><span style="color:#24292E;"> </span><span style="color:#032F62;">in</span><span style="color:#24292E;"> </span><span style="color:#032F62;">default</span><span style="color:#24292E;"> </span><span style="color:#032F62;">namespace.</span></span></code></pre></div><div class="warning custom-block"><p class="custom-block-title">ğŸ’¡ è¯´æ˜</p><p>éçº§è”åˆ é™¤æ—¶ï¼Œåˆ é™¤äº†sts ä½†æ˜¯podå¹¶æœªè¢«åˆ é™¤</p><p>kubernetes 1.24ä»¥å‰ç‰ˆæœ¬å‚æ•° --cascade=false</p><p>kubernetes 1.24ä»¥åç‰ˆæœ¬å‚æ•° --cascade=orphan</p></div>`,120),e=[o];function t(c,r,y,E,F,i){return a(),n("div",null,e)}const u=s(p,[["render",t]]);export{C as __pageData,u as default};
